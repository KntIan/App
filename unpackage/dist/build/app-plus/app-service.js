var __defProp=Object.defineProperty,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__publicField=(e,t,n)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),n);if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((n=>t.resolve(e()).then((()=>n))),(n=>t.resolve(e()).then((()=>{throw n}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";var t,n,o,a,i,s,r,c,l,u,d,p,h,g,m,f,v,_;function y(e){return weex.requireModule(e)}function I(e,t,...n){uni.__log__?uni.__log__(e,t,...n):console[e].apply(console,[...n,t])}function E(e,t){return"string"==typeof e?t:e}const C=t=>(n,o=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,n,o)},k=C("onShow"),T=C("onHide"),M=C("onLoad"),S=C("onReady"),D=C("onUnload"),b=C("onReachBottom"),w=C("onPullDownRefresh"),N=C("onNavigationBarButtonTap"),L=(e,t)=>{const n=e.__vccOpts||e;for(const[o,a]of t)n[o]=a;return n};const R=L({data:()=>({constants:{}}),onLoad(){const e=uni.getStorageSync("hasViewedStartupPage");let t=!1;e?(I("log","at pages/index/index.vue:47","1111跳转到登录页"),t||(t=!0,uni.navigateTo({url:"/pages/login/login",success:()=>{I("log","at pages/index/index.vue:53","成功跳转到登录页")},fail:e=>{I("error","at pages/index/index.vue:56","跳转失败:",e),t=!1}}))):(uni.setStorageSync("hasViewedStartupPage",!0),setTimeout((()=>{I("log","at pages/index/index.vue:31","跳转到登录页"),t||(t=!0,uni.navigateTo({url:"/pages/login/login",success:()=>{I("log","at pages/index/index.vue:37","成功跳转到登录页")},fail:e=>{I("error","at pages/index/index.vue:40","跳转失败:",e),t=!1}}))}),3e3))},methods:{}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"box1"},[e.createElementVNode("image",{class:"image_2",referrerpolicy:"no-referrer",src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng4253829e1a377894ca42c94d7edf9cdfd758b5bf890e937604ce7635bfc36c30"}),e.createElementVNode("text",{class:"text-group_2"},"练习书法 习得一手好字")]),e.createElementVNode("view",{class:"box2"},[e.createElementVNode("view",{class:"box_2 flex-col"}),e.createElementVNode("text",{class:"text2"},"泽熙书画")])])}]]);
/*!
   * pinia v2.1.7
   * (c) 2023 Eduardo San Martin Morote
   * @license MIT
   */
let A;const O=e=>A=e,U=Symbol();function P(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var G,x;(x=G||(G={})).direct="direct",x.patchObject="patch object",x.patchFunction="patch function";const B=()=>{};function V(t,n,o,a=B){t.push(n);const i=()=>{const e=t.indexOf(n);e>-1&&(t.splice(e,1),a())};return!o&&e.getCurrentScope()&&e.onScopeDispose(i),i}function F(e,...t){e.slice().forEach((e=>{e(...t)}))}const H=e=>e();function j(t,n){t instanceof Map&&n instanceof Map&&n.forEach(((e,n)=>t.set(n,e))),t instanceof Set&&n instanceof Set&&n.forEach(t.add,t);for(const o in n){if(!n.hasOwnProperty(o))continue;const a=n[o],i=t[o];P(i)&&P(a)&&t.hasOwnProperty(o)&&!e.isRef(a)&&!e.isReactive(a)?t[o]=j(i,a):t[o]=a}return t}const q=Symbol();const{assign:z}=Object;function K(t,n,o={},a,i,s){let r;const c=z({actions:{}},o),l={deep:!0};let u,d,p,h=[],g=[];const m=a.state.value[t];let f;function v(n){let o;u=d=!1,"function"==typeof n?(n(a.state.value[t]),o={type:G.patchFunction,storeId:t,events:p}):(j(a.state.value[t],n),o={type:G.patchObject,payload:n,storeId:t,events:p});const i=f=Symbol();e.nextTick().then((()=>{f===i&&(u=!0)})),d=!0,F(h,o,a.state.value[t])}s||m||(a.state.value[t]={}),e.ref({});const _=s?function(){const{state:e}=o,t=e?e():{};this.$patch((e=>{z(e,t)}))}:B;function y(e,n){return function(){O(a);const o=Array.from(arguments),i=[],s=[];let r;F(g,{args:o,name:e,store:E,after:function(e){i.push(e)},onError:function(e){s.push(e)}});try{r=n.apply(this&&this.$id===t?this:E,o)}catch(c){throw F(s,c),c}return r instanceof Promise?r.then((e=>(F(i,e),e))).catch((e=>(F(s,e),Promise.reject(e)))):(F(i,r),r)}}const I={_p:a,$id:t,$onAction:V.bind(null,g),$patch:v,$reset:_,$subscribe(n,o={}){const i=V(h,n,o.detached,(()=>s())),s=r.run((()=>e.watch((()=>a.state.value[t]),(e=>{("sync"===o.flush?d:u)&&n({storeId:t,type:G.direct,events:p},e)}),z({},l,o))));return i},$dispose:function(){r.stop(),h=[],g=[],a._s.delete(t)}},E=e.reactive(I);a._s.set(t,E);const C=(a._a&&a._a.runWithContext||H)((()=>a._e.run((()=>(r=e.effectScope()).run(n)))));for(const M in C){const n=C[M];if(e.isRef(n)&&(T=n,!e.isRef(T)||!T.effect)||e.isReactive(n))s||(!m||P(k=n)&&k.hasOwnProperty(q)||(e.isRef(n)?n.value=m[M]:j(n,m[M])),a.state.value[t][M]=n);else if("function"==typeof n){const e=y(M,n);C[M]=e,c.actions[M]=n}}var k,T;return z(E,C),z(e.toRaw(E),C),Object.defineProperty(E,"$state",{get:()=>a.state.value[t],set:e=>{v((t=>{z(t,e)}))}}),a._p.forEach((e=>{z(E,r.run((()=>e({store:E,app:a._a,pinia:a,options:c}))))})),m&&s&&o.hydrate&&o.hydrate(E.$state,m),u=!0,d=!0,E}const $=e=>async(t,n)=>new Promise(((o,a)=>{uni.request({url:`http://admin.zexishuhua.com/api${t}`,method:e.toUpperCase(),sslVerify:!1,data:n,header:{token:uni.getStorageSync("token")||""},success:e=>{200===e.statusCode?o(e.data):a(new Error(`API错误: ${e.statusCode}`))},fail:n=>{I("error","at utils/request.js:22",`请求 ${e.toUpperCase()} ${t} 时出错:`,n),a(n)}})})),Y=$("get"),W=$("post"),J=e=>W("/sms/send",e),X=e=>W("/user/resetpwd",e),Z=e=>Y("/activity/list",e),Q=e=>Y("/adv/list?position_mark=index",e),ee=e=>Y("/news/list",e),te=e=>Y("/user/lessons",e),ne=e=>W("/index/index",e),oe=e=>Y("/user/homeworkpast",e),ae=e=>Y("/user/homeworknow",e),ie=e=>Y("/user/homeworkai",e),se=function(t,n,o){let a,i;const s="function"==typeof n;function r(t,o){const r=e.hasInjectionContext();(t=t||(r?e.inject(U,null):null))&&O(t),(t=A)._s.has(a)||(s?K(a,n,i,t):function(t,n,o){const{state:a,actions:i,getters:s}=n,r=o.state.value[t];let c;c=K(t,(function(){r||(o.state.value[t]=a?a():{});const n=e.toRefs(o.state.value[t]);return z(n,i,Object.keys(s||{}).reduce(((n,a)=>(n[a]=e.markRaw(e.computed((()=>{O(o);const e=o._s.get(t);return s[a].call(e,e)}))),n)),{}))}),n,o,0,!0)}(a,i,t));return t._s.get(a)}return"string"==typeof t?(a=t,i=s?o:n):(i=t,a=t.id),r.$id=a,r}("main",{unistorage:!0,state:()=>({token:null,privacyPolicy:"",userAgreement:"",listdataIndex:[],images:[],selectedSwiperIndex:null,campusData:[],classData:[],userinfo:null,resultDivData:null,messageList:[],infoList:[],evaluationDesc:null,onlineOngoingActivities:null,offlineOngoingActivities:null}),actions:{setToken(e){this.token=e},setUserinfo(e){this.userinfo=e},setListdataIndex(e){this.listdataIndex=e},setInfoList(e){this.infoList=e},setMessageList(e){this.messageList=e},setImages(e){this.images=e},setSelectedSwiperIndex(e){this.selectedSwiperIndex=e},setCampusData(e){this.campusData=e},setClassData(e){this.classData=e},setResultDiv(e){this.resultDivData=e,I("log","at store/index.js:117","resultDivData:",this.resultDivData)},setEvaluationDesc(e){this.evaluationDesc=e},setOnlineOngoingActivities(e){this.onlineOngoingActivities=e},setOfflineOngoingActivities(e){this.offlineOngoingActivities=e}}});var re="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},ce=[],le=[],ue="undefined"!=typeof Uint8Array?Uint8Array:Array,de=!1;function pe(){de=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)ce[t]=e[t],le[e.charCodeAt(t)]=t;le["-".charCodeAt(0)]=62,le["_".charCodeAt(0)]=63}function he(e,t,n){for(var o,a,i=[],s=t;s<n;s+=3)o=(e[s]<<16)+(e[s+1]<<8)+e[s+2],i.push(ce[(a=o)>>18&63]+ce[a>>12&63]+ce[a>>6&63]+ce[63&a]);return i.join("")}function ge(e){var t;de||pe();for(var n=e.length,o=n%3,a="",i=[],s=0,r=n-o;s<r;s+=16383)i.push(he(e,s,s+16383>r?r:s+16383));return 1===o?(t=e[n-1],a+=ce[t>>2],a+=ce[t<<4&63],a+="=="):2===o&&(t=(e[n-2]<<8)+e[n-1],a+=ce[t>>10],a+=ce[t>>4&63],a+=ce[t<<2&63],a+="="),i.push(a),i.join("")}function me(e,t,n,o,a){var i,s,r=8*a-o-1,c=(1<<r)-1,l=c>>1,u=-7,d=n?a-1:0,p=n?-1:1,h=e[t+d];for(d+=p,i=h&(1<<-u)-1,h>>=-u,u+=r;u>0;i=256*i+e[t+d],d+=p,u-=8);for(s=i&(1<<-u)-1,i>>=-u,u+=o;u>0;s=256*s+e[t+d],d+=p,u-=8);if(0===i)i=1-l;else{if(i===c)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,o),i-=l}return(h?-1:1)*s*Math.pow(2,i-o)}function fe(e,t,n,o,a,i){var s,r,c,l=8*i-a-1,u=(1<<l)-1,d=u>>1,p=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,h=o?0:i-1,g=o?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(r=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?p/c:p*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=u?(r=0,s=u):s+d>=1?(r=(t*c-1)*Math.pow(2,a),s+=d):(r=t*Math.pow(2,d-1)*Math.pow(2,a),s=0));a>=8;e[n+h]=255&r,h+=g,r/=256,a-=8);for(s=s<<a|r,l+=a;l>0;e[n+h]=255&s,h+=g,s/=256,l-=8);e[n+h-g]|=128*m}var ve={}.toString,_e=Array.isArray||function(e){return"[object Array]"==ve.call(e)};function ye(){return Ee.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Ie(e,t){if(ye()<t)throw new RangeError("Invalid typed array length");return Ee.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Ee.prototype:(null===e&&(e=new Ee(t)),e.length=t),e}function Ee(e,t,n){if(!(Ee.TYPED_ARRAY_SUPPORT||this instanceof Ee))return new Ee(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Te(this,e)}return Ce(this,e,t,n)}function Ce(e,t,n,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,o){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,n):new Uint8Array(t,n,o),Ee.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Ee.prototype:e=Me(e,t),e}(e,t,n,o):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!Ee.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|be(t,n),a=(e=Ie(e,o)).write(t,n);return a!==o&&(e=e.slice(0,a)),e}(e,t,n):function(e,t){if(De(t)){var n=0|Se(t.length);return 0===(e=Ie(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(o=t.length)!=o?Ie(e,0):Me(e,t);if("Buffer"===t.type&&_e(t.data))return Me(e,t.data)}var o;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function ke(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Te(e,t){if(ke(t),e=Ie(e,t<0?0:0|Se(t)),!Ee.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function Me(e,t){var n=t.length<0?0:0|Se(t.length);e=Ie(e,n);for(var o=0;o<n;o+=1)e[o]=255&t[o];return e}function Se(e){if(e>=ye())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ye().toString(16)+" bytes");return 0|e}function De(e){return!(null==e||!e._isBuffer)}function be(e,t){if(De(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return nt(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return ot(e).length;default:if(o)return nt(e).length;t=(""+t).toLowerCase(),o=!0}}function we(e,t,n){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return qe(this,t,n);case"utf8":case"utf-8":return Ve(this,t,n);case"ascii":return He(this,t,n);case"latin1":case"binary":return je(this,t,n);case"base64":return Be(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ze(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function Ne(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function Le(e,t,n,o,a){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=Ee.from(t,o)),De(t))return 0===t.length?-1:Re(e,t,n,o,a);if("number"==typeof t)return t&=255,Ee.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):Re(e,[t],n,o,a);throw new TypeError("val must be string, number or Buffer")}function Re(e,t,n,o,a){var i,s=1,r=e.length,c=t.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;s=2,r/=2,c/=2,n/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(a){var u=-1;for(i=n;i<r;i++)if(l(e,i)===l(t,-1===u?0:i-u)){if(-1===u&&(u=i),i-u+1===c)return u*s}else-1!==u&&(i-=i-u),u=-1}else for(n+c>r&&(n=r-c),i=n;i>=0;i--){for(var d=!0,p=0;p<c;p++)if(l(e,i+p)!==l(t,p)){d=!1;break}if(d)return i}return-1}function Ae(e,t,n,o){n=Number(n)||0;var a=e.length-n;o?(o=Number(o))>a&&(o=a):o=a;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");o>i/2&&(o=i/2);for(var s=0;s<o;++s){var r=parseInt(t.substr(2*s,2),16);if(isNaN(r))return s;e[n+s]=r}return s}function Oe(e,t,n,o){return at(nt(t,e.length-n),e,n,o)}function Ue(e,t,n,o){return at(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,o)}function Pe(e,t,n,o){return Ue(e,t,n,o)}function Ge(e,t,n,o){return at(ot(t),e,n,o)}function xe(e,t,n,o){return at(function(e,t){for(var n,o,a,i=[],s=0;s<e.length&&!((t-=2)<0);++s)o=(n=e.charCodeAt(s))>>8,a=n%256,i.push(a),i.push(o);return i}(t,e.length-n),e,n,o)}function Be(e,t,n){return 0===t&&n===e.length?ge(e):ge(e.slice(t,n))}function Ve(e,t,n){n=Math.min(e.length,n);for(var o=[],a=t;a<n;){var i,s,r,c,l=e[a],u=null,d=l>239?4:l>223?3:l>191?2:1;if(a+d<=n)switch(d){case 1:l<128&&(u=l);break;case 2:128==(192&(i=e[a+1]))&&(c=(31&l)<<6|63&i)>127&&(u=c);break;case 3:i=e[a+1],s=e[a+2],128==(192&i)&&128==(192&s)&&(c=(15&l)<<12|(63&i)<<6|63&s)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:i=e[a+1],s=e[a+2],r=e[a+3],128==(192&i)&&128==(192&s)&&128==(192&r)&&(c=(15&l)<<18|(63&i)<<12|(63&s)<<6|63&r)>65535&&c<1114112&&(u=c)}null===u?(u=65533,d=1):u>65535&&(u-=65536,o.push(u>>>10&1023|55296),u=56320|1023&u),o.push(u),a+=d}return function(e){var t=e.length;if(t<=Fe)return String.fromCharCode.apply(String,e);for(var n="",o=0;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=Fe));return n}(o)}Ee.TYPED_ARRAY_SUPPORT=void 0===re.TYPED_ARRAY_SUPPORT||re.TYPED_ARRAY_SUPPORT,Ee.poolSize=8192,Ee._augment=function(e){return e.__proto__=Ee.prototype,e},Ee.from=function(e,t,n){return Ce(null,e,t,n)},Ee.TYPED_ARRAY_SUPPORT&&(Ee.prototype.__proto__=Uint8Array.prototype,Ee.__proto__=Uint8Array),Ee.alloc=function(e,t,n){return o=null,i=t,s=n,ke(a=e),a<=0?Ie(o,a):void 0!==i?"string"==typeof s?Ie(o,a).fill(i,s):Ie(o,a).fill(i):Ie(o,a);var o,a,i,s},Ee.allocUnsafe=function(e){return Te(null,e)},Ee.allocUnsafeSlow=function(e){return Te(null,e)},Ee.isBuffer=it,Ee.compare=function(e,t){if(!De(e)||!De(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,o=t.length,a=0,i=Math.min(n,o);a<i;++a)if(e[a]!==t[a]){n=e[a],o=t[a];break}return n<o?-1:o<n?1:0},Ee.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Ee.concat=function(e,t){if(!_e(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Ee.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=Ee.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var i=e[n];if(!De(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(o,a),a+=i.length}return o},Ee.byteLength=be,Ee.prototype._isBuffer=!0,Ee.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Ne(this,t,t+1);return this},Ee.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Ne(this,t,t+3),Ne(this,t+1,t+2);return this},Ee.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Ne(this,t,t+7),Ne(this,t+1,t+6),Ne(this,t+2,t+5),Ne(this,t+3,t+4);return this},Ee.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Ve(this,0,e):we.apply(this,arguments)},Ee.prototype.equals=function(e){if(!De(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Ee.compare(this,e)},Ee.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Ee.prototype.compare=function(e,t,n,o,a){if(!De(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===a&&(a=this.length),t<0||n>e.length||o<0||a>this.length)throw new RangeError("out of range index");if(o>=a&&t>=n)return 0;if(o>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(a>>>=0)-(o>>>=0),s=(n>>>=0)-(t>>>=0),r=Math.min(i,s),c=this.slice(o,a),l=e.slice(t,n),u=0;u<r;++u)if(c[u]!==l[u]){i=c[u],s=l[u];break}return i<s?-1:s<i?1:0},Ee.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Ee.prototype.indexOf=function(e,t,n){return Le(this,e,t,n,!0)},Ee.prototype.lastIndexOf=function(e,t,n){return Le(this,e,t,n,!1)},Ee.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===o&&(o="utf8")):(o=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return Ae(this,e,t,n);case"utf8":case"utf-8":return Oe(this,e,t,n);case"ascii":return Ue(this,e,t,n);case"latin1":case"binary":return Pe(this,e,t,n);case"base64":return Ge(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xe(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0}},Ee.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Fe=4096;function He(e,t,n){var o="";n=Math.min(e.length,n);for(var a=t;a<n;++a)o+=String.fromCharCode(127&e[a]);return o}function je(e,t,n){var o="";n=Math.min(e.length,n);for(var a=t;a<n;++a)o+=String.fromCharCode(e[a]);return o}function qe(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var a="",i=t;i<n;++i)a+=et(e[i]);return a}function ze(e,t,n){for(var o=e.slice(t,n),a="",i=0;i<o.length;i+=2)a+=String.fromCharCode(o[i]+256*o[i+1]);return a}function Ke(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function $e(e,t,n,o,a,i){if(!De(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function Ye(e,t,n,o){t<0&&(t=65535+t+1);for(var a=0,i=Math.min(e.length-n,2);a<i;++a)e[n+a]=(t&255<<8*(o?a:1-a))>>>8*(o?a:1-a)}function We(e,t,n,o){t<0&&(t=4294967295+t+1);for(var a=0,i=Math.min(e.length-n,4);a<i;++a)e[n+a]=t>>>8*(o?a:3-a)&255}function Je(e,t,n,o,a,i){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Xe(e,t,n,o,a){return a||Je(e,0,n,4),fe(e,t,n,o,23,4),n+4}function Ze(e,t,n,o,a){return a||Je(e,0,n,8),fe(e,t,n,o,52,8),n+8}Ee.prototype.slice=function(e,t){var n,o=this.length;if((e=~~e)<0?(e+=o)<0&&(e=0):e>o&&(e=o),(t=void 0===t?o:~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),t<e&&(t=e),Ee.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Ee.prototype;else{var a=t-e;n=new Ee(a,void 0);for(var i=0;i<a;++i)n[i]=this[i+e]}return n},Ee.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||Ke(e,t,this.length);for(var o=this[e],a=1,i=0;++i<t&&(a*=256);)o+=this[e+i]*a;return o},Ee.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||Ke(e,t,this.length);for(var o=this[e+--t],a=1;t>0&&(a*=256);)o+=this[e+--t]*a;return o},Ee.prototype.readUInt8=function(e,t){return t||Ke(e,1,this.length),this[e]},Ee.prototype.readUInt16LE=function(e,t){return t||Ke(e,2,this.length),this[e]|this[e+1]<<8},Ee.prototype.readUInt16BE=function(e,t){return t||Ke(e,2,this.length),this[e]<<8|this[e+1]},Ee.prototype.readUInt32LE=function(e,t){return t||Ke(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Ee.prototype.readUInt32BE=function(e,t){return t||Ke(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Ee.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||Ke(e,t,this.length);for(var o=this[e],a=1,i=0;++i<t&&(a*=256);)o+=this[e+i]*a;return o>=(a*=128)&&(o-=Math.pow(2,8*t)),o},Ee.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||Ke(e,t,this.length);for(var o=t,a=1,i=this[e+--o];o>0&&(a*=256);)i+=this[e+--o]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},Ee.prototype.readInt8=function(e,t){return t||Ke(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Ee.prototype.readInt16LE=function(e,t){t||Ke(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Ee.prototype.readInt16BE=function(e,t){t||Ke(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Ee.prototype.readInt32LE=function(e,t){return t||Ke(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Ee.prototype.readInt32BE=function(e,t){return t||Ke(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Ee.prototype.readFloatLE=function(e,t){return t||Ke(e,4,this.length),me(this,e,!0,23,4)},Ee.prototype.readFloatBE=function(e,t){return t||Ke(e,4,this.length),me(this,e,!1,23,4)},Ee.prototype.readDoubleLE=function(e,t){return t||Ke(e,8,this.length),me(this,e,!0,52,8)},Ee.prototype.readDoubleBE=function(e,t){return t||Ke(e,8,this.length),me(this,e,!1,52,8)},Ee.prototype.writeUIntLE=function(e,t,n,o){e=+e,t|=0,n|=0,o||$e(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},Ee.prototype.writeUIntBE=function(e,t,n,o){e=+e,t|=0,n|=0,o||$e(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+n},Ee.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,1,255,0),Ee.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Ee.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,2,65535,0),Ee.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ye(this,e,t,!0),t+2},Ee.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,2,65535,0),Ee.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ye(this,e,t,!1),t+2},Ee.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,4,4294967295,0),Ee.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):We(this,e,t,!0),t+4},Ee.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,4,4294967295,0),Ee.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):We(this,e,t,!1),t+4},Ee.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t|=0,!o){var a=Math.pow(2,8*n-1);$e(this,e,t,n,a-1,-a)}var i=0,s=1,r=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===r&&0!==this[t+i-1]&&(r=1),this[t+i]=(e/s|0)-r&255;return t+n},Ee.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t|=0,!o){var a=Math.pow(2,8*n-1);$e(this,e,t,n,a-1,-a)}var i=n-1,s=1,r=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===r&&0!==this[t+i+1]&&(r=1),this[t+i]=(e/s|0)-r&255;return t+n},Ee.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,1,127,-128),Ee.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Ee.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,2,32767,-32768),Ee.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ye(this,e,t,!0),t+2},Ee.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,2,32767,-32768),Ee.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ye(this,e,t,!1),t+2},Ee.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,4,2147483647,-2147483648),Ee.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):We(this,e,t,!0),t+4},Ee.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||$e(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Ee.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):We(this,e,t,!1),t+4},Ee.prototype.writeFloatLE=function(e,t,n){return Xe(this,e,t,!0,n)},Ee.prototype.writeFloatBE=function(e,t,n){return Xe(this,e,t,!1,n)},Ee.prototype.writeDoubleLE=function(e,t,n){return Ze(this,e,t,!0,n)},Ee.prototype.writeDoubleBE=function(e,t,n){return Ze(this,e,t,!1,n)},Ee.prototype.copy=function(e,t,n,o){if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var a,i=o-n;if(this===e&&n<t&&t<o)for(a=i-1;a>=0;--a)e[a+t]=this[a+n];else if(i<1e3||!Ee.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},Ee.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!Ee.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=De(e)?e:nt(new Ee(e,o).toString()),r=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%r]}return this};var Qe=/[^+\/0-9A-Za-z-_]/g;function et(e){return e<16?"0"+e.toString(16):e.toString(16)}function nt(e,t){var n;t=t||1/0;for(var o=e.length,a=null,i=[],s=0;s<o;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===o){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function ot(e){return function(e){var t,n,o,a,i,s;de||pe();var r=e.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i="="===e[r-2]?2:"="===e[r-1]?1:0,s=new ue(3*r/4-i),o=i>0?r-4:r;var c=0;for(t=0,n=0;t<o;t+=4,n+=3)a=le[e.charCodeAt(t)]<<18|le[e.charCodeAt(t+1)]<<12|le[e.charCodeAt(t+2)]<<6|le[e.charCodeAt(t+3)],s[c++]=a>>16&255,s[c++]=a>>8&255,s[c++]=255&a;return 2===i?(a=le[e.charCodeAt(t)]<<2|le[e.charCodeAt(t+1)]>>4,s[c++]=255&a):1===i&&(a=le[e.charCodeAt(t)]<<10|le[e.charCodeAt(t+1)]<<4|le[e.charCodeAt(t+2)]>>2,s[c++]=a>>8&255,s[c++]=255&a),s}(function(e){if((e=(t=e,t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(Qe,"")).length<2)return"";for(var t;e.length%4!=0;)e+="=";return e}(e))}function at(e,t,n,o){for(var a=0;a<o&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function it(e){return null!=e&&(!!e._isBuffer||st(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&st(t.slice(0,0)));var t}function st(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function rt(e,t){return e(t={exports:{}},t.exports),t.exports}var ct=rt((function(e,t){var n,o,a,i,s,r,c,l,u,d,p,h,g;e.exports=(n=n||(o=Math,a=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),s=(i={}).lib={},r=s.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes,a=e.sigBytes;if(this.clamp(),o%4)for(var i=0;i<a;i++){var s=n[i>>>2]>>>24-i%4*8&255;t[o+i>>>2]|=s<<24-(o+i)%4*8}else for(i=0;i<a;i+=4)t[o+i>>>2]=n[i>>>2];return this.sigBytes+=a,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=o.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,n=[],a=function(e){var t=987654321,n=4294967295;return function(){var a=((t=36969*(65535&t)+(t>>16)&n)<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n;return a/=4294967296,(a+=.5)*(o.random()>.5?1:-1)}},i=0;i<e;i+=4){var s=a(4294967296*(t||o.random()));t=987654071*s(),n.push(4294967296*s()|0)}return new c.init(n,e)}}),l=i.enc={},u=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],a=0;a<n;a++){var i=t[a>>>2]>>>24-a%4*8&255;o.push((i>>>4).toString(16)),o.push((15&i).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new c.init(n,t/2)}},d=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],a=0;a<n;a++){var i=t[a>>>2]>>>24-a%4*8&255;o.push(String.fromCharCode(i))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new c.init(n,t)}},p=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=s.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,a=t.sigBytes,i=this.blockSize,s=a/(4*i),r=(s=e?o.ceil(s):o.max((0|s)-this._minBufferSize,0))*i,l=o.min(4*r,a);if(r){for(var u=0;u<r;u+=i)this._doProcessBlock(n,u);var d=n.splice(0,r);t.sigBytes-=l}return new c.init(d,l)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),s.Hasher=h.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}}),g=i.algo={},i),n)})),lt=(rt((function(e,t){var n,o,a,i,s,r;e.exports=(a=(o=n=ct).lib,i=a.Base,s=a.WordArray,(r=o.x64={}).Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),r.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],o=0;o<t;o++){var a=e[o];n.push(a.high),n.push(a.low)}return s.create(n,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),n=t.length,o=0;o<n;o++)t[o]=t[o].clone();return e}}),n)})),rt((function(e,t){var n;e.exports=(n=ct,function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,o=[],a=0;a<n;a++)o[a>>>2]|=e[a]<<24-a%4*8;t.call(this,o,n)}else t.apply(this,arguments)}).prototype=e}}(),n.lib.WordArray)})),rt((function(e,t){var n;e.exports=(n=ct,function(){var e=n,t=e.lib.WordArray,o=e.enc;function a(e){return e<<8&4278255360|e>>>8&16711935}o.Utf16=o.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],a=0;a<n;a+=2){var i=t[a>>>2]>>>16-a%4*8&65535;o.push(String.fromCharCode(i))}return o.join("")},parse:function(e){for(var n=e.length,o=[],a=0;a<n;a++)o[a>>>1]|=e.charCodeAt(a)<<16-a%2*16;return t.create(o,2*n)}},o.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],i=0;i<n;i+=2){var s=a(t[i>>>2]>>>16-i%4*8&65535);o.push(String.fromCharCode(s))}return o.join("")},parse:function(e){for(var n=e.length,o=[],i=0;i<n;i++)o[i>>>1]|=a(e.charCodeAt(i)<<16-i%2*16);return t.create(o,2*n)}}}(),n.enc.Utf16)})),rt((function(e,t){var n,o,a;e.exports=(a=(o=n=ct).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,o=this._map;e.clamp();for(var a=[],i=0;i<n;i+=3)for(var s=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,r=0;r<4&&i+.75*r<n;r++)a.push(o.charAt(s>>>6*(3-r)&63));var c=o.charAt(64);if(c)for(;a.length%4;)a.push(c);return a.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var s=n.charAt(64);if(s){var r=e.indexOf(s);-1!==r&&(t=r)}return function(e,t,n){for(var o=[],i=0,s=0;s<t;s++)if(s%4){var r=n[e.charCodeAt(s-1)]<<s%4*2,c=n[e.charCodeAt(s)]>>>6-s%4*2;o[i>>>2]|=(r|c)<<24-i%4*8,i++}return a.create(o,i)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)})),rt((function(e,t){var n;e.exports=(n=ct,function(e){var t=n,o=t.lib,a=o.WordArray,i=o.Hasher,s=t.algo,r=[];!function(){for(var t=0;t<64;t++)r[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=s.MD5=i.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,a=e[o];e[o]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var i=this._hash.words,s=e[t+0],c=e[t+1],h=e[t+2],g=e[t+3],m=e[t+4],f=e[t+5],v=e[t+6],_=e[t+7],y=e[t+8],I=e[t+9],E=e[t+10],C=e[t+11],k=e[t+12],T=e[t+13],M=e[t+14],S=e[t+15],D=i[0],b=i[1],w=i[2],N=i[3];D=l(D,b,w,N,s,7,r[0]),N=l(N,D,b,w,c,12,r[1]),w=l(w,N,D,b,h,17,r[2]),b=l(b,w,N,D,g,22,r[3]),D=l(D,b,w,N,m,7,r[4]),N=l(N,D,b,w,f,12,r[5]),w=l(w,N,D,b,v,17,r[6]),b=l(b,w,N,D,_,22,r[7]),D=l(D,b,w,N,y,7,r[8]),N=l(N,D,b,w,I,12,r[9]),w=l(w,N,D,b,E,17,r[10]),b=l(b,w,N,D,C,22,r[11]),D=l(D,b,w,N,k,7,r[12]),N=l(N,D,b,w,T,12,r[13]),w=l(w,N,D,b,M,17,r[14]),D=u(D,b=l(b,w,N,D,S,22,r[15]),w,N,c,5,r[16]),N=u(N,D,b,w,v,9,r[17]),w=u(w,N,D,b,C,14,r[18]),b=u(b,w,N,D,s,20,r[19]),D=u(D,b,w,N,f,5,r[20]),N=u(N,D,b,w,E,9,r[21]),w=u(w,N,D,b,S,14,r[22]),b=u(b,w,N,D,m,20,r[23]),D=u(D,b,w,N,I,5,r[24]),N=u(N,D,b,w,M,9,r[25]),w=u(w,N,D,b,g,14,r[26]),b=u(b,w,N,D,y,20,r[27]),D=u(D,b,w,N,T,5,r[28]),N=u(N,D,b,w,h,9,r[29]),w=u(w,N,D,b,_,14,r[30]),D=d(D,b=u(b,w,N,D,k,20,r[31]),w,N,f,4,r[32]),N=d(N,D,b,w,y,11,r[33]),w=d(w,N,D,b,C,16,r[34]),b=d(b,w,N,D,M,23,r[35]),D=d(D,b,w,N,c,4,r[36]),N=d(N,D,b,w,m,11,r[37]),w=d(w,N,D,b,_,16,r[38]),b=d(b,w,N,D,E,23,r[39]),D=d(D,b,w,N,T,4,r[40]),N=d(N,D,b,w,s,11,r[41]),w=d(w,N,D,b,g,16,r[42]),b=d(b,w,N,D,v,23,r[43]),D=d(D,b,w,N,I,4,r[44]),N=d(N,D,b,w,k,11,r[45]),w=d(w,N,D,b,S,16,r[46]),D=p(D,b=d(b,w,N,D,h,23,r[47]),w,N,s,6,r[48]),N=p(N,D,b,w,_,10,r[49]),w=p(w,N,D,b,M,15,r[50]),b=p(b,w,N,D,f,21,r[51]),D=p(D,b,w,N,k,6,r[52]),N=p(N,D,b,w,g,10,r[53]),w=p(w,N,D,b,E,15,r[54]),b=p(b,w,N,D,c,21,r[55]),D=p(D,b,w,N,y,6,r[56]),N=p(N,D,b,w,S,10,r[57]),w=p(w,N,D,b,v,15,r[58]),b=p(b,w,N,D,T,21,r[59]),D=p(D,b,w,N,m,6,r[60]),N=p(N,D,b,w,C,10,r[61]),w=p(w,N,D,b,h,15,r[62]),b=p(b,w,N,D,I,21,r[63]),i[0]=i[0]+D|0,i[1]=i[1]+b|0,i[2]=i[2]+w|0,i[3]=i[3]+N|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,a=8*t.sigBytes;n[a>>>5]|=128<<24-a%32;var i=e.floor(o/4294967296),s=o;n[15+(a+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(a+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(n.length+1),this._process();for(var r=this._hash,c=r.words,l=0;l<4;l++){var u=c[l];c[l]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return r},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,n,o,a,i,s){var r=e+(t&n|~t&o)+a+s;return(r<<i|r>>>32-i)+t}function u(e,t,n,o,a,i,s){var r=e+(t&o|n&~o)+a+s;return(r<<i|r>>>32-i)+t}function d(e,t,n,o,a,i,s){var r=e+(t^n^o)+a+s;return(r<<i|r>>>32-i)+t}function p(e,t,n,o,a,i,s){var r=e+(n^(t|~o))+a+s;return(r<<i|r>>>32-i)+t}t.MD5=i._createHelper(c),t.HmacMD5=i._createHmacHelper(c)}(Math),n.MD5)})),rt((function(e,t){var n,o,a,i,s,r,c,l;e.exports=(a=(o=n=ct).lib,i=a.WordArray,s=a.Hasher,r=o.algo,c=[],l=r.SHA1=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],a=n[1],i=n[2],s=n[3],r=n[4],l=0;l<80;l++){if(l<16)c[l]=0|e[t+l];else{var u=c[l-3]^c[l-8]^c[l-14]^c[l-16];c[l]=u<<1|u>>>31}var d=(o<<5|o>>>27)+r+c[l];d+=l<20?1518500249+(a&i|~a&s):l<40?1859775393+(a^i^s):l<60?(a&i|a&s|i&s)-1894007588:(a^i^s)-899497514,r=s,s=i,i=a<<30|a>>>2,a=o,o=d}n[0]=n[0]+o|0,n[1]=n[1]+a|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+r|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(o+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),o.SHA1=s._createHelper(l),o.HmacSHA1=s._createHmacHelper(l),n.SHA1)})),rt((function(e,t){var n;e.exports=(n=ct,function(e){var t=n,o=t.lib,a=o.WordArray,i=o.Hasher,s=t.algo,r=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),o=2;o<=n;o++)if(!(t%o))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var o=2,a=0;a<64;)t(o)&&(a<8&&(r[a]=n(e.pow(o,.5))),c[a]=n(e.pow(o,1/3)),a++),o++}();var l=[],u=s.SHA256=i.extend({_doReset:function(){this._hash=new a.init(r.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],a=n[1],i=n[2],s=n[3],r=n[4],u=n[5],d=n[6],p=n[7],h=0;h<64;h++){if(h<16)l[h]=0|e[t+h];else{var g=l[h-15],m=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,f=l[h-2],v=(f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10;l[h]=m+l[h-7]+v+l[h-16]}var _=o&a^o&i^a&i,y=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),I=p+((r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25))+(r&u^~r&d)+c[h]+l[h];p=d,d=u,u=r,r=s+I|0,s=i,i=a,a=o,o=I+(y+_)|0}n[0]=n[0]+o|0,n[1]=n[1]+a|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+r|0,n[5]=n[5]+u|0,n[6]=n[6]+d|0,n[7]=n[7]+p|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,a=8*t.sigBytes;return n[a>>>5]|=128<<24-a%32,n[14+(a+64>>>9<<4)]=e.floor(o/4294967296),n[15+(a+64>>>9<<4)]=o,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(u),t.HmacSHA256=i._createHmacHelper(u)}(Math),n.SHA256)})),rt((function(e,t){var n,o,a,i,s,r;e.exports=(a=(o=n=ct).lib.WordArray,i=o.algo,s=i.SHA256,r=i.SHA224=s.extend({_doReset:function(){this._hash=new a.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=4,e}}),o.SHA224=s._createHelper(r),o.HmacSHA224=s._createHmacHelper(r),n.SHA224)})),rt((function(e,t){var n;e.exports=(n=ct,function(){var e=n,t=e.lib.Hasher,o=e.x64,a=o.Word,i=o.WordArray,s=e.algo;function r(){return a.create.apply(a,arguments)}var c=[r(1116352408,3609767458),r(1899447441,602891725),r(3049323471,3964484399),r(3921009573,2173295548),r(961987163,4081628472),r(1508970993,3053834265),r(2453635748,2937671579),r(2870763221,3664609560),r(3624381080,2734883394),r(310598401,1164996542),r(607225278,1323610764),r(1426881987,3590304994),r(1925078388,4068182383),r(2162078206,991336113),r(2614888103,633803317),r(3248222580,3479774868),r(3835390401,2666613458),r(4022224774,944711139),r(264347078,2341262773),r(604807628,2007800933),r(770255983,1495990901),r(1249150122,1856431235),r(1555081692,3175218132),r(1996064986,2198950837),r(2554220882,3999719339),r(2821834349,766784016),r(2952996808,2566594879),r(3210313671,3203337956),r(3336571891,1034457026),r(3584528711,2466948901),r(113926993,3758326383),r(338241895,168717936),r(666307205,1188179964),r(773529912,1546045734),r(1294757372,1522805485),r(1396182291,2643833823),r(1695183700,2343527390),r(1986661051,1014477480),r(2177026350,1206759142),r(2456956037,344077627),r(2730485921,1290863460),r(2820302411,3158454273),r(3259730800,3505952657),r(3345764771,106217008),r(3516065817,3606008344),r(3600352804,1432725776),r(4094571909,1467031594),r(275423344,851169720),r(430227734,3100823752),r(506948616,1363258195),r(659060556,3750685593),r(883997877,3785050280),r(958139571,3318307427),r(1322822218,3812723403),r(1537002063,2003034995),r(1747873779,3602036899),r(1955562222,1575990012),r(2024104815,1125592928),r(2227730452,2716904306),r(2361852424,442776044),r(2428436474,593698344),r(2756734187,3733110249),r(3204031479,2999351573),r(3329325298,3815920427),r(3391569614,3928383900),r(3515267271,566280711),r(3940187606,3454069534),r(4118630271,4000239992),r(116418474,1914138554),r(174292421,2731055270),r(289380356,3203993006),r(460393269,320620315),r(685471733,587496836),r(852142971,1086792851),r(1017036298,365543100),r(1126000580,2618297676),r(1288033470,3409855158),r(1501505948,4234509866),r(1607167915,987167468),r(1816402316,1246189591)],l=[];!function(){for(var e=0;e<80;e++)l[e]=r()}();var u=s.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],a=n[1],i=n[2],s=n[3],r=n[4],u=n[5],d=n[6],p=n[7],h=o.high,g=o.low,m=a.high,f=a.low,v=i.high,_=i.low,y=s.high,I=s.low,E=r.high,C=r.low,k=u.high,T=u.low,M=d.high,S=d.low,D=p.high,b=p.low,w=h,N=g,L=m,R=f,A=v,O=_,U=y,P=I,G=E,x=C,B=k,V=T,F=M,H=S,j=D,q=b,z=0;z<80;z++){var K=l[z];if(z<16)var $=K.high=0|e[t+2*z],Y=K.low=0|e[t+2*z+1];else{var W=l[z-15],J=W.high,X=W.low,Z=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=l[z-2],te=ee.high,ne=ee.low,oe=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,ae=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ie=l[z-7],se=ie.high,re=ie.low,ce=l[z-16],le=ce.high,ue=ce.low;$=($=($=Z+se+((Y=Q+re)>>>0<Q>>>0?1:0))+oe+((Y+=ae)>>>0<ae>>>0?1:0))+le+((Y+=ue)>>>0<ue>>>0?1:0),K.high=$,K.low=Y}var de,pe=G&B^~G&F,he=x&V^~x&H,ge=w&L^w&A^L&A,me=N&R^N&O^R&O,fe=(w>>>28|N<<4)^(w<<30|N>>>2)^(w<<25|N>>>7),ve=(N>>>28|w<<4)^(N<<30|w>>>2)^(N<<25|w>>>7),_e=(G>>>14|x<<18)^(G>>>18|x<<14)^(G<<23|x>>>9),ye=(x>>>14|G<<18)^(x>>>18|G<<14)^(x<<23|G>>>9),Ie=c[z],Ee=Ie.high,Ce=Ie.low,ke=j+_e+((de=q+ye)>>>0<q>>>0?1:0),Te=ve+me;j=F,q=H,F=B,H=V,B=G,V=x,G=U+(ke=(ke=(ke=ke+pe+((de+=he)>>>0<he>>>0?1:0))+Ee+((de+=Ce)>>>0<Ce>>>0?1:0))+$+((de+=Y)>>>0<Y>>>0?1:0))+((x=P+de|0)>>>0<P>>>0?1:0)|0,U=A,P=O,A=L,O=R,L=w,R=N,w=ke+(fe+ge+(Te>>>0<ve>>>0?1:0))+((N=de+Te|0)>>>0<de>>>0?1:0)|0}g=o.low=g+N,o.high=h+w+(g>>>0<N>>>0?1:0),f=a.low=f+R,a.high=m+L+(f>>>0<R>>>0?1:0),_=i.low=_+O,i.high=v+A+(_>>>0<O>>>0?1:0),I=s.low=I+P,s.high=y+U+(I>>>0<P>>>0?1:0),C=r.low=C+x,r.high=E+G+(C>>>0<x>>>0?1:0),T=u.low=T+V,u.high=k+B+(T>>>0<V>>>0?1:0),S=d.low=S+H,d.high=M+F+(S>>>0<H>>>0?1:0),b=p.low=b+q,p.high=D+j+(b>>>0<q>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[30+(o+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(o+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(u),e.HmacSHA512=t._createHmacHelper(u)}(),n.SHA512)})),rt((function(e,t){var n,o,a,i,s,r,c,l;e.exports=(a=(o=n=ct).x64,i=a.Word,s=a.WordArray,r=o.algo,c=r.SHA512,l=r.SHA384=c.extend({_doReset:function(){this._hash=new s.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),o.SHA384=c._createHelper(l),o.HmacSHA384=c._createHmacHelper(l),n.SHA384)})),rt((function(e,t){var n;e.exports=(n=ct,function(e){var t=n,o=t.lib,a=o.WordArray,i=o.Hasher,s=t.x64.Word,r=t.algo,c=[],l=[],u=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var o=(2*e+3*t)%5;e=t%5,t=o}for(e=0;e<5;e++)for(t=0;t<5;t++)l[e+5*t]=t+(2*e+3*t)%5*5;for(var a=1,i=0;i<24;i++){for(var r=0,d=0,p=0;p<7;p++){if(1&a){var h=(1<<p)-1;h<32?d^=1<<h:r^=1<<h-32}128&a?a=a<<1^113:a<<=1}u[i]=s.create(r,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=s.create()}();var p=r.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,o=this.blockSize/2,a=0;a<o;a++){var i=e[t+2*a],s=e[t+2*a+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),(b=n[a]).high^=s,b.low^=i}for(var r=0;r<24;r++){for(var p=0;p<5;p++){for(var h=0,g=0,m=0;m<5;m++)h^=(b=n[p+5*m]).high,g^=b.low;var f=d[p];f.high=h,f.low=g}for(p=0;p<5;p++){var v=d[(p+4)%5],_=d[(p+1)%5],y=_.high,I=_.low;for(h=v.high^(y<<1|I>>>31),g=v.low^(I<<1|y>>>31),m=0;m<5;m++)(b=n[p+5*m]).high^=h,b.low^=g}for(var E=1;E<25;E++){var C=(b=n[E]).high,k=b.low,T=c[E];T<32?(h=C<<T|k>>>32-T,g=k<<T|C>>>32-T):(h=k<<T-32|C>>>64-T,g=C<<T-32|k>>>64-T);var M=d[l[E]];M.high=h,M.low=g}var S=d[0],D=n[0];for(S.high=D.high,S.low=D.low,p=0;p<5;p++)for(m=0;m<5;m++){var b=n[E=p+5*m],w=d[E],N=d[(p+1)%5+5*m],L=d[(p+2)%5+5*m];b.high=w.high^~N.high&L.high,b.low=w.low^~N.low&L.low}b=n[0];var R=u[r];b.high^=R.high,b.low^=R.low}},_doFinalize:function(){var t=this._data,n=t.words,o=(this._nDataBytes,8*t.sigBytes),i=32*this.blockSize;n[o>>>5]|=1<<24-o%32,n[(e.ceil((o+1)/i)*i>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var s=this._state,r=this.cfg.outputLength/8,c=r/8,l=[],u=0;u<c;u++){var d=s[u],p=d.high,h=d.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),l.push(h),l.push(p)}return new a.init(l,r)},clone:function(){for(var e=i.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=i._createHelper(p),t.HmacSHA3=i._createHmacHelper(p)}(Math),n.SHA3)})),rt((function(e,t){var n;e.exports=(n=ct,function(){var e=n,t=e.lib,o=t.WordArray,a=t.Hasher,i=e.algo,s=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),r=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),c=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),u=o.create([0,1518500249,1859775393,2400959708,2840853838]),d=o.create([1352829926,1548603684,1836072691,2053994217,0]),p=i.RIPEMD160=a.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,a=e[o];e[o]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var i,p,y,I,E,C,k,T,M,S,D,b=this._hash.words,w=u.words,N=d.words,L=s.words,R=r.words,A=c.words,O=l.words;for(C=i=b[0],k=p=b[1],T=y=b[2],M=I=b[3],S=E=b[4],n=0;n<80;n+=1)D=i+e[t+L[n]]|0,D+=n<16?h(p,y,I)+w[0]:n<32?g(p,y,I)+w[1]:n<48?m(p,y,I)+w[2]:n<64?f(p,y,I)+w[3]:v(p,y,I)+w[4],D=(D=_(D|=0,A[n]))+E|0,i=E,E=I,I=_(y,10),y=p,p=D,D=C+e[t+R[n]]|0,D+=n<16?v(k,T,M)+N[0]:n<32?f(k,T,M)+N[1]:n<48?m(k,T,M)+N[2]:n<64?g(k,T,M)+N[3]:h(k,T,M)+N[4],D=(D=_(D|=0,O[n]))+S|0,C=S,S=M,M=_(T,10),T=k,k=D;D=b[1]+y+M|0,b[1]=b[2]+I+S|0,b[2]=b[3]+E+C|0,b[3]=b[4]+i+k|0,b[4]=b[0]+p+T|0,b[0]=D},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var a=this._hash,i=a.words,s=0;s<5;s++){var r=i[s];i[s]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}return a},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,n){return e^t^n}function g(e,t,n){return e&t|~e&n}function m(e,t,n){return(e|~t)^n}function f(e,t,n){return e&n|t&~n}function v(e,t,n){return e^(t|~n)}function _(e,t){return e<<t|e>>>32-t}e.RIPEMD160=a._createHelper(p),e.HmacRIPEMD160=a._createHmacHelper(p)}(),n.RIPEMD160)})),rt((function(e,t){var n,o,a,i;e.exports=(o=(n=ct).lib.Base,a=n.enc,i=a.Utf8,void(n.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,o=4*n;t.sigBytes>o&&(t=e.finalize(t)),t.clamp();for(var a=this._oKey=t.clone(),s=this._iKey=t.clone(),r=a.words,c=s.words,l=0;l<n;l++)r[l]^=1549556828,c[l]^=909522486;a.sigBytes=s.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))})),rt((function(e,t){var n,o,a,i,s,r,c,l,u;e.exports=(i=(a=(o=n=ct).lib).Base,s=a.WordArray,c=(r=o.algo).SHA1,l=r.HMAC,u=r.PBKDF2=i.extend({cfg:i.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,o=l.create(n.hasher,e),a=s.create(),i=s.create([1]),r=a.words,c=i.words,u=n.keySize,d=n.iterations;r.length<u;){var p=o.update(t).finalize(i);o.reset();for(var h=p.words,g=h.length,m=p,f=1;f<d;f++){m=o.finalize(m),o.reset();for(var v=m.words,_=0;_<g;_++)h[_]^=v[_]}a.concat(p),c[0]++}return a.sigBytes=4*u,a}}),o.PBKDF2=function(e,t,n){return u.create(n).compute(e,t)},n.PBKDF2)})),rt((function(e,t){var n,o,a,i,s,r,c,l;e.exports=(i=(a=(o=n=ct).lib).Base,s=a.WordArray,c=(r=o.algo).MD5,l=r.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,o=n.hasher.create(),a=s.create(),i=a.words,r=n.keySize,c=n.iterations;i.length<r;){l&&o.update(l);var l=o.update(e).finalize(t);o.reset();for(var u=1;u<c;u++)l=o.finalize(l),o.reset();a.concat(l)}return a.sigBytes=4*r,a}}),o.EvpKDF=function(e,t,n){return l.create(n).compute(e,t)},n.EvpKDF)})),rt((function(e,t){var n,o,a,i,s,r,c,l,u,d,p,h,g,m,f,v,_,y,I,E,C,k,T;e.exports=void((n=ct).lib.Cipher||(o=n,a=o.lib,i=a.Base,s=a.WordArray,r=a.BufferedBlockAlgorithm,c=o.enc,c.Utf8,l=c.Base64,u=o.algo,d=u.EvpKDF,p=a.Cipher=r.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?T:E}return function(t){return{encrypt:function(n,o,a){return e(o).encrypt(t,n,o,a)},decrypt:function(n,o,a){return e(o).decrypt(t,n,o,a)}}}}()}),a.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h=o.mode={},g=a.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),m=h.CBC=function(){var e=g.extend();function t(e,t,n){var o=this._iv;if(o){var a=o;this._iv=undefined}else a=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=a[i]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,a=o.blockSize;t.call(this,e,n,a),o.encryptBlock(e,n),this._prevBlock=e.slice(n,n+a)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,a=o.blockSize,i=e.slice(n,n+a);o.decryptBlock(e,n),t.call(this,e,n,a),this._prevBlock=i}}),e}(),f=o.pad={},v=f.Pkcs7={pad:function(e,t){for(var n=4*t,o=n-e.sigBytes%n,a=o<<24|o<<16|o<<8|o,i=[],r=0;r<o;r+=4)i.push(a);var c=s.create(i,o);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},a.BlockCipher=p.extend({cfg:p.cfg.extend({mode:m,padding:v}),reset:function(){p.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var o=n.createEncryptor;else{o=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==o?this._mode.init(this,t&&t.words):(this._mode=o.call(n,this,t&&t.words),this._mode.__creator=o)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{t=this._process(!0);e.unpad(t)}return t},blockSize:4}),_=a.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),y=o.format={},I=y.OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var o=s.create([1398893684,1701076831]).concat(n).concat(t);else o=t;return o.toString(l)},parse:function(e){var t=l.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){var o=s.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return _.create({ciphertext:t,salt:o})}},E=a.SerializableCipher=i.extend({cfg:i.extend({format:I}),encrypt:function(e,t,n,o){o=this.cfg.extend(o);var a=e.createEncryptor(n,o),i=a.finalize(t),s=a.cfg;return _.create({ciphertext:i,key:n,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,t,n,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),e.createDecryptor(n,o).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),C=o.kdf={},k=C.OpenSSL={execute:function(e,t,n,o){o||(o=s.random(8));var a=d.create({keySize:t+n}).compute(e,o),i=s.create(a.words.slice(t),4*n);return a.sigBytes=4*t,_.create({key:a,iv:i,salt:o})}},T=a.PasswordBasedCipher=E.extend({cfg:E.cfg.extend({kdf:k}),encrypt:function(e,t,n,o){var a=(o=this.cfg.extend(o)).kdf.execute(n,e.keySize,e.ivSize);o.iv=a.iv;var i=E.encrypt.call(this,e,t,a.key,o);return i.mixIn(a),i},decrypt:function(e,t,n,o){o=this.cfg.extend(o),t=this._parse(t,o.format);var a=o.kdf.execute(n,e.keySize,e.ivSize,t.salt);return o.iv=a.iv,E.decrypt.call(this,e,t,a.key,o)}})))})),rt((function(e,t){var n;e.exports=((n=ct).mode.CFB=function(){var e=n.lib.BlockCipherMode.extend();function t(e,t,n,o){var a=this._iv;if(a){var i=a.slice(0);this._iv=void 0}else i=this._prevBlock;o.encryptBlock(i,0);for(var s=0;s<n;s++)e[t+s]^=i[s]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,a=o.blockSize;t.call(this,e,n,a,o),this._prevBlock=e.slice(n,n+a)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,a=o.blockSize,i=e.slice(n,n+a);t.call(this,e,n,a,o),this._prevBlock=i}}),e}(),n.mode.CFB)})),rt((function(e,t){var n,o,a;e.exports=((n=ct).mode.CTR=(a=(o=n.lib.BlockCipherMode.extend()).Encryptor=o.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,a=this._iv,i=this._counter;a&&(i=this._counter=a.slice(0),this._iv=void 0);var s=i.slice(0);n.encryptBlock(s,0),i[o-1]=i[o-1]+1|0;for(var r=0;r<o;r++)e[t+r]^=s[r]}}),o.Decryptor=a,o),n.mode.CTR)})),rt((function(e,t){var n;e.exports=((n=ct).mode.CTRGladman=function(){var e=n.lib.BlockCipherMode.extend();function t(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,n=e>>8&255,o=255&e;255===t?(t=0,255===n?(n=0,255===o?o=0:++o):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=o}return e}var o=e.Encryptor=e.extend({processBlock:function(e,n){var o,a=this._cipher,i=a.blockSize,s=this._iv,r=this._counter;s&&(r=this._counter=s.slice(0),this._iv=void 0),0===((o=r)[0]=t(o[0]))&&(o[1]=t(o[1]));var c=r.slice(0);a.encryptBlock(c,0);for(var l=0;l<i;l++)e[n+l]^=c[l]}});return e.Decryptor=o,e}(),n.mode.CTRGladman)})),rt((function(e,t){var n,o,a;e.exports=((n=ct).mode.OFB=(a=(o=n.lib.BlockCipherMode.extend()).Encryptor=o.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,a=this._iv,i=this._keystream;a&&(i=this._keystream=a.slice(0),this._iv=void 0),n.encryptBlock(i,0);for(var s=0;s<o;s++)e[t+s]^=i[s]}}),o.Decryptor=a,o),n.mode.OFB)})),rt((function(e,t){var n,o;e.exports=((n=ct).mode.ECB=((o=n.lib.BlockCipherMode.extend()).Encryptor=o.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),o.Decryptor=o.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),o),n.mode.ECB)})),rt((function(e,t){var n;e.exports=((n=ct).pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,o=4*t,a=o-n%o,i=n+a-1;e.clamp(),e.words[i>>>2]|=a<<24-i%4*8,e.sigBytes+=a},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Ansix923)})),rt((function(e,t){var n;e.exports=((n=ct).pad.Iso10126={pad:function(e,t){var o=4*t,a=o-e.sigBytes%o;e.concat(n.lib.WordArray.random(a-1)).concat(n.lib.WordArray.create([a<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126)})),rt((function(e,t){var n;e.exports=((n=ct).pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.Iso97971)})),rt((function(e,t){var n;e.exports=((n=ct).pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},n.pad.ZeroPadding)})),rt((function(e,t){var n;e.exports=((n=ct).pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)})),rt((function(e,t){var n,o,a,i;e.exports=(a=(o=n=ct).lib.CipherParams,i=o.enc.Hex,o.format.Hex={stringify:function(e){return e.ciphertext.toString(i)},parse:function(e){var t=i.parse(e);return a.create({ciphertext:t})}},n.format.Hex)})),rt((function(e,t){var n;e.exports=(n=ct,function(){var e=n,t=e.lib.BlockCipher,o=e.algo,a=[],i=[],s=[],r=[],c=[],l=[],u=[],d=[],p=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,o=0;for(t=0;t<256;t++){var g=o^o<<1^o<<2^o<<3^o<<4;g=g>>>8^255&g^99,a[n]=g,i[g]=n;var m=e[n],f=e[m],v=e[f],_=257*e[g]^16843008*g;s[n]=_<<24|_>>>8,r[n]=_<<16|_>>>16,c[n]=_<<8|_>>>24,l[n]=_,_=16843009*v^65537*f^257*m^16843008*n,u[g]=_<<24|_>>>8,d[g]=_<<16|_>>>16,p[g]=_<<8|_>>>24,h[g]=_,n?(n=m^e[e[e[v^m]]],o^=e[e[o]]):n=o=1}}();var g=[0,1,2,4,8,16,32,64,128,27,54],m=o.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,o=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],s=0;s<o;s++)if(s<n)i[s]=t[s];else{var r=i[s-1];s%n?n>6&&s%n==4&&(r=a[r>>>24]<<24|a[r>>>16&255]<<16|a[r>>>8&255]<<8|a[255&r]):(r=a[(r=r<<8|r>>>24)>>>24]<<24|a[r>>>16&255]<<16|a[r>>>8&255]<<8|a[255&r],r^=g[s/n|0]<<24),i[s]=i[s-n]^r}for(var c=this._invKeySchedule=[],l=0;l<o;l++)s=o-l,r=l%4?i[s]:i[s-4],c[l]=l<4||s<=4?r:u[a[r>>>24]]^d[a[r>>>16&255]]^p[a[r>>>8&255]]^h[a[255&r]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,r,c,l,a)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,d,p,h,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,o,a,i,s,r){for(var c=this._nRounds,l=e[t]^n[0],u=e[t+1]^n[1],d=e[t+2]^n[2],p=e[t+3]^n[3],h=4,g=1;g<c;g++){var m=o[l>>>24]^a[u>>>16&255]^i[d>>>8&255]^s[255&p]^n[h++],f=o[u>>>24]^a[d>>>16&255]^i[p>>>8&255]^s[255&l]^n[h++],v=o[d>>>24]^a[p>>>16&255]^i[l>>>8&255]^s[255&u]^n[h++],_=o[p>>>24]^a[l>>>16&255]^i[u>>>8&255]^s[255&d]^n[h++];l=m,u=f,d=v,p=_}m=(r[l>>>24]<<24|r[u>>>16&255]<<16|r[d>>>8&255]<<8|r[255&p])^n[h++],f=(r[u>>>24]<<24|r[d>>>16&255]<<16|r[p>>>8&255]<<8|r[255&l])^n[h++],v=(r[d>>>24]<<24|r[p>>>16&255]<<16|r[l>>>8&255]<<8|r[255&u])^n[h++],_=(r[p>>>24]<<24|r[l>>>16&255]<<16|r[u>>>8&255]<<8|r[255&d])^n[h++],e[t]=m,e[t+1]=f,e[t+2]=v,e[t+3]=_},keySize:8});e.AES=t._createHelper(m)}(),n.AES)})),rt((function(e,t){var n;e.exports=(n=ct,function(){var e=n,t=e.lib,o=t.WordArray,a=t.BlockCipher,i=e.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],r=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],u=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=i.DES=a.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var o=s[n]-1;t[n]=e[o>>>5]>>>31-o%32&1}for(var a=this._subKeys=[],i=0;i<16;i++){var l=a[i]=[],u=c[i];for(n=0;n<24;n++)l[n/6|0]|=t[(r[n]-1+u)%28]<<31-n%6,l[4+(n/6|0)]|=t[28+(r[n+24]-1+u)%28]<<31-n%6;for(l[0]=l[0]<<1|l[0]>>>31,n=1;n<7;n++)l[n]=l[n]>>>4*(n-1)+3;l[7]=l[7]<<5|l[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=a[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),p.call(this,1,1431655765);for(var o=0;o<16;o++){for(var a=n[o],i=this._lBlock,s=this._rBlock,r=0,c=0;c<8;c++)r|=l[c][((s^a[c])&u[c])>>>0];this._lBlock=s,this._rBlock=i^r}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,p.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function h(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=a._createHelper(d);var g=i.TripleDES=a.extend({_doReset:function(){var e=this._key.words;this._des1=d.createEncryptor(o.create(e.slice(0,2))),this._des2=d.createEncryptor(o.create(e.slice(2,4))),this._des3=d.createEncryptor(o.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=a._createHelper(g)}(),n.TripleDES)})),rt((function(e,t){var n;e.exports=(n=ct,function(){var e=n,t=e.lib.StreamCipher,o=e.algo,a=o.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,o=this._S=[],a=0;a<256;a++)o[a]=a;a=0;for(var i=0;a<256;a++){var s=a%n,r=t[s>>>2]>>>24-s%4*8&255;i=(i+o[a]+r)%256;var c=o[a];o[a]=o[i],o[i]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=i.call(this)},keySize:8,ivSize:0});function i(){for(var e=this._S,t=this._i,n=this._j,o=0,a=0;a<4;a++){n=(n+e[t=(t+1)%256])%256;var i=e[t];e[t]=e[n],e[n]=i,o|=e[(e[t]+e[n])%256]<<24-8*a}return this._i=t,this._j=n,o}e.RC4=t._createHelper(a);var s=o.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)i.call(this)}});e.RC4Drop=t._createHelper(s)}(),n.RC4)})),rt((function(e,t){var n;e.exports=(n=ct,function(){var e=n,t=e.lib.StreamCipher,o=e.algo,a=[],i=[],s=[],r=o.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var o=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)a[n]^=o[n+4&7];if(t){var i=t.words,s=i[0],r=i[1],l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),u=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=l>>>16|4294901760&u,p=u<<16|65535&l;for(a[0]^=l,a[1]^=d,a[2]^=u,a[3]^=p,a[4]^=l,a[5]^=d,a[6]^=u,a[7]^=p,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),a[0]=n[0]^n[5]>>>16^n[3]<<16,a[1]=n[2]^n[7]>>>16^n[5]<<16,a[2]=n[4]^n[1]>>>16^n[7]<<16,a[3]=n[6]^n[3]>>>16^n[1]<<16;for(var o=0;o<4;o++)a[o]=16711935&(a[o]<<8|a[o]>>>24)|4278255360&(a[o]<<24|a[o]>>>8),e[t+o]^=a[o]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)i[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],a=65535&o,r=o>>>16,c=((a*a>>>17)+a*r>>>15)+r*r,l=((4294901760&o)*o|0)+((65535&o)*o|0);s[n]=c^l}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.Rabbit=t._createHelper(r)}(),n.Rabbit)})),rt((function(e,t){var n;e.exports=(n=ct,function(){var e=n,t=e.lib.StreamCipher,o=e.algo,a=[],i=[],s=[],r=o.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var a=0;a<4;a++)c.call(this);for(a=0;a<8;a++)o[a]^=n[a+4&7];if(t){var i=t.words,s=i[0],r=i[1],l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),u=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=l>>>16|4294901760&u,p=u<<16|65535&l;for(o[0]^=l,o[1]^=d,o[2]^=u,o[3]^=p,o[4]^=l,o[5]^=d,o[6]^=u,o[7]^=p,a=0;a<4;a++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),a[0]=n[0]^n[5]>>>16^n[3]<<16,a[1]=n[2]^n[7]>>>16^n[5]<<16,a[2]=n[4]^n[1]>>>16^n[7]<<16,a[3]=n[6]^n[3]>>>16^n[1]<<16;for(var o=0;o<4;o++)a[o]=16711935&(a[o]<<8|a[o]>>>24)|4278255360&(a[o]<<24|a[o]>>>8),e[t+o]^=a[o]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)i[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],a=65535&o,r=o>>>16,c=((a*a>>>17)+a*r>>>15)+r*r,l=((4294901760&o)*o|0)+((65535&o)*o|0);s[n]=c^l}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.RabbitLegacy=t._createHelper(r)}(),n.RabbitLegacy)})),rt((function(e,t){e.exports=ct})));function ut(){throw new Error("setTimeout has not been defined")}function dt(){throw new Error("clearTimeout has not been defined")}var pt=ut,ht=dt;function gt(e){if(pt===setTimeout)return setTimeout(e,0);if((pt===ut||!pt)&&setTimeout)return pt=setTimeout,setTimeout(e,0);try{return pt(e,0)}catch(t){try{return pt.call(null,e,0)}catch(n){return pt.call(this,e,0)}}}"function"==typeof re.setTimeout&&(pt=setTimeout),"function"==typeof re.clearTimeout&&(ht=clearTimeout);var mt,ft=[],vt=!1,_t=-1;function yt(){vt&&mt&&(vt=!1,mt.length?ft=mt.concat(ft):_t=-1,ft.length&&It())}function It(){if(!vt){var e=gt(yt);vt=!0;for(var t=ft.length;t;){for(mt=ft,ft=[];++_t<t;)mt&&mt[_t].run();_t=-1,t=ft.length}mt=null,vt=!1,function(e){if(ht===clearTimeout)return clearTimeout(e);if((ht===dt||!ht)&&clearTimeout)return ht=clearTimeout,clearTimeout(e);try{ht(e)}catch(t){try{return ht.call(null,e)}catch(n){return ht.call(this,e)}}}(e)}}function Et(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ft.push(new Ct(e,t)),1!==ft.length||vt||gt(It)}function Ct(e,t){this.fun=e,this.array=t}Ct.prototype.run=function(){this.fun.apply(null,this.array)};var kt=re.performance||{};function Tt(){}function Mt(){Mt.init.call(this)}function St(e){return void 0===e._maxListeners?Mt.defaultMaxListeners:e._maxListeners}function Dt(e,t,n,o){var a,i,s,r;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]):(i=e._events=new Tt,e._eventsCount=0),s){if("function"==typeof s?s=i[t]=o?[n,s]:[s,n]:o?s.unshift(n):s.push(n),!s.warned&&(a=St(e))&&a>0&&s.length>a){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,r=c,"function"==typeof console.warn?I("warn","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2",r):I("log","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2",r)}}else s=i[t]=n,++e._eventsCount;return e}function bt(e,t,n){var o=!1;function a(){e.removeListener(t,a),o||(o=!0,n.apply(e,arguments))}return a.listener=n,a}function wt(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Nt(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}kt.now||kt.mozNow||kt.msNow||kt.oNow||kt.webkitNow,Tt.prototype=Object.create(null),Mt.EventEmitter=Mt,Mt.usingDomains=!1,Mt.prototype.domain=void 0,Mt.prototype._events=void 0,Mt.prototype._maxListeners=void 0,Mt.defaultMaxListeners=10,Mt.init=function(){this.domain=null,Mt.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Tt,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Mt.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Mt.prototype.getMaxListeners=function(){return St(this)},Mt.prototype.emit=function(e){var t,n,o,a,i,s,r,c="error"===e;if(s=this._events)c=c&&null==s.error;else if(!c)return!1;if(r=this.domain,c){if(t=arguments[1],!r){if(t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=r,t.domainThrown=!1,r.emit("error",t),!1}if(!(n=s[e]))return!1;var u="function"==typeof n;switch(o=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var o=e.length,a=Nt(e,o),i=0;i<o;++i)a[i].call(n)}(n,u,this);break;case 2:!function(e,t,n,o){if(t)e.call(n,o);else for(var a=e.length,i=Nt(e,a),s=0;s<a;++s)i[s].call(n,o)}(n,u,this,arguments[1]);break;case 3:!function(e,t,n,o,a){if(t)e.call(n,o,a);else for(var i=e.length,s=Nt(e,i),r=0;r<i;++r)s[r].call(n,o,a)}(n,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,o,a,i){if(t)e.call(n,o,a,i);else for(var s=e.length,r=Nt(e,s),c=0;c<s;++c)r[c].call(n,o,a,i)}(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=new Array(o-1),i=1;i<o;i++)a[i-1]=arguments[i];!function(e,t,n,o){if(t)e.apply(n,o);else for(var a=e.length,i=Nt(e,a),s=0;s<a;++s)i[s].apply(n,o)}(n,u,this,a)}return!0},Mt.prototype.addListener=function(e,t){return Dt(this,e,t,!1)},Mt.prototype.on=Mt.prototype.addListener,Mt.prototype.prependListener=function(e,t){return Dt(this,e,t,!0)},Mt.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,bt(this,e,t)),this},Mt.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,bt(this,e,t)),this},Mt.prototype.removeListener=function(e,t){var n,o,a,i,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(n=o[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Tt:(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(a=-1,i=n.length;i-- >0;)if(n[i]===t||n[i].listener&&n[i].listener===t){s=n[i].listener,a=i;break}if(a<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Tt,this;delete o[e]}else!function(e,t){for(var n=t,o=n+1,a=e.length;o<a;n+=1,o+=1)e[n]=e[o];e.pop()}(n,a);o.removeListener&&this.emit("removeListener",e,s||t)}return this},Mt.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Tt,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Tt:delete n[e]),this;if(0===arguments.length){for(var o,a=Object.keys(n),i=0;i<a.length;++i)"removeListener"!==(o=a[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=new Tt,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Mt.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},Mt.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):wt.call(e,t)},Mt.prototype.listenerCount=wt,Mt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Lt="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},Rt=/%[sdj%]/g;function At(e){if(!zt(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(Gt(arguments[n]));return t.join(" ")}n=1;for(var o=arguments,a=o.length,i=String(e).replace(Rt,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":try{return JSON.stringify(o[n++])}catch(t){return"[Circular]"}default:return e}})),s=o[n];n<a;s=o[++n])qt(s)||!Yt(s)?i+=" "+s:i+=" "+Gt(s);return i}function Ot(e,t){if(Kt(re.process))return function(){return Ot(e,t).apply(this,arguments)};var n=!1;return function(){return n||(I("error","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2",t),n=!0),e.apply(this,arguments)}}var Ut,Pt={};function Gt(e,t){var n={seen:[],stylize:Bt};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),jt(t)?n.showHidden=t:t&&function(e,t){if(!t||!Yt(t))return e;for(var n=Object.keys(t),o=n.length;o--;)e[n[o]]=t[n[o]]}(n,t),Kt(n.showHidden)&&(n.showHidden=!1),Kt(n.depth)&&(n.depth=2),Kt(n.colors)&&(n.colors=!1),Kt(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=xt),Vt(n,e,n.depth)}function xt(e,t){var n=Gt.styles[t];return n?"["+Gt.colors[n][0]+"m"+e+"["+Gt.colors[n][1]+"m":e}function Bt(e,t){return e}function Vt(e,t,n){if(e.customInspect&&t&&Xt(t.inspect)&&t.inspect!==Gt&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return zt(o)||(o=Vt(e,o,n)),o}var a=function(e,t){if(Kt(t))return e.stylize("undefined","undefined");if(zt(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return"number"==typeof t?e.stylize(""+t,"number"):jt(t)?e.stylize(""+t,"boolean"):qt(t)?e.stylize("null","null"):void 0}(e,t);if(a)return a;var i,s=Object.keys(t),r=(i={},s.forEach((function(e,t){i[e]=!0})),i);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),Jt(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return Ft(t);if(0===s.length){if(Xt(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if($t(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Wt(t))return e.stylize(Date.prototype.toString.call(t),"date");if(Jt(t))return Ft(t)}var l,u,d="",p=!1,h=["{","}"];return l=t,Array.isArray(l)&&(p=!0,h=["[","]"]),Xt(t)&&(d=" [Function"+(t.name?": "+t.name:"")+"]"),$t(t)&&(d=" "+RegExp.prototype.toString.call(t)),Wt(t)&&(d=" "+Date.prototype.toUTCString.call(t)),Jt(t)&&(d=" "+Ft(t)),0!==s.length||p&&0!=t.length?n<0?$t(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=p?function(e,t,n,o,a){for(var i=[],s=0,r=t.length;s<r;++s)Qt(t,String(s))?i.push(Ht(e,t,n,o,String(s),!0)):i.push("");return a.forEach((function(a){a.match(/^\d+$/)||i.push(Ht(e,t,n,o,a,!0))})),i}(e,t,n,r,s):s.map((function(o){return Ht(e,t,n,r,o,p)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(u,d,h)):h[0]+d+h[1]}function Ft(e){return"["+Error.prototype.toString.call(e)+"]"}function Ht(e,t,n,o,a,i){var s,r,c;if((c=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?r=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(r=e.stylize("[Setter]","special")),Qt(o,a)||(s="["+a+"]"),r||(e.seen.indexOf(c.value)<0?(r=qt(n)?Vt(e,c.value,null):Vt(e,c.value,n-1)).indexOf("\n")>-1&&(r=i?r.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+r.split("\n").map((function(e){return"   "+e})).join("\n")):r=e.stylize("[Circular]","special")),Kt(s)){if(i&&a.match(/^\d+$/))return r;(s=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+r}function jt(e){return"boolean"==typeof e}function qt(e){return null===e}function zt(e){return"string"==typeof e}function Kt(e){return void 0===e}function $t(e){return Yt(e)&&"[object RegExp]"===Zt(e)}function Yt(e){return"object"==typeof e&&null!==e}function Wt(e){return Yt(e)&&"[object Date]"===Zt(e)}function Jt(e){return Yt(e)&&("[object Error]"===Zt(e)||e instanceof Error)}function Xt(e){return"function"==typeof e}function Zt(e){return Object.prototype.toString.call(e)}function Qt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function en(){this.head=null,this.tail=null,this.length=0}Gt.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Gt.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},en.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},en.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},en.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},en.prototype.clear=function(){this.head=this.tail=null,this.length=0},en.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},en.prototype.concat=function(e){if(0===this.length)return Ee.alloc(0);if(1===this.length)return this.head.data;for(var t=Ee.allocUnsafe(e>>>0),n=this.head,o=0;n;)n.data.copy(t,o),o+=n.data.length,n=n.next;return t};var tn=Ee.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function nn(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!tn(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=an;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=sn;break;default:return void(this.write=on)}this.charBuffer=new Ee(6),this.charReceived=0,this.charLength=0}function on(e){return e.toString(this.encoding)}function an(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function sn(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}nn.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((o=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&o<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var o,a=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,a),a-=this.charReceived),a=(t+=e.toString(this.encoding,0,a)).length-1,(o=t.charCodeAt(a))>=55296&&o<=56319){var i=this.surrogateSize;return this.charLength+=i,this.charReceived+=i,this.charBuffer.copy(this.charBuffer,i,0,i),e.copy(this.charBuffer,0,0,i),t.substring(0,a)}return t},nn.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},nn.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,o=this.charBuffer,a=this.encoding;t+=o.slice(0,n).toString(a)}return t},un.ReadableState=ln;var rn,cn=(rn="stream",Kt(Ut)&&(Ut=""),rn=rn.toUpperCase(),Pt[rn]||(new RegExp("\\b"+rn+"\\b","i").test(Ut)?Pt[rn]=function(){var e=At.apply(null,arguments);I("error","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2","%s %d: %s",rn,0,e)}:Pt[rn]=function(){}),Pt[rn]);function ln(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof xn&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o,this.highWaterMark=~~this.highWaterMark,this.buffer=new en,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new nn(e.encoding),this.encoding=e.encoding)}function un(e){if(!(this instanceof un))return new un(e);this._readableState=new ln(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),Mt.call(this)}function dn(e,t,n,o,a){var i,s,r,c=(i=t,r=null,it(s=n)||"string"==typeof s||null==s||i.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r);if(c)e.emit("error",c);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,gn(e)}}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!a){var l=new Error("stream.push() after EOF");e.emit("error",l)}else if(t.endEmitted&&a){var u=new Error("stream.unshift() after end event");e.emit("error",u)}else{var d;!t.decoder||a||o||(n=t.decoder.write(n),d=!t.objectMode&&0===n.length),a||(t.reading=!1),d||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,a?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&gn(e))),function(e,t){t.readingMore||(t.readingMore=!0,Et(fn,e,t))}(e,t)}else a||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}Lt(un,Mt),un.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=Ee.from(e,t),t=""),dn(this,n,e,t,!1)},un.prototype.unshift=function(e){return dn(this,this._readableState,e,"",!0)},un.prototype.isPaused=function(){return!1===this._readableState.flowing},un.prototype.setEncoding=function(e){return this._readableState.decoder=new nn(e),this._readableState.encoding=e,this};var pn=8388608;function hn(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=((n=e)>=pn?n=pn:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var n}function gn(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(cn("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?Et(mn,e):mn(e))}function mn(e){cn("emit readable"),e.emit("readable"),yn(e)}function fn(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(cn("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function vn(e){cn("readable nexttick read 0"),e.read(0)}function _n(e,t){t.reading||(cn("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),yn(e),t.flowing&&!t.reading&&e.read(0)}function yn(e){var t=e._readableState;for(cn("flow",t.flowing);t.flowing&&null!==e.read(););}function In(e,t){return 0===t.length?null:(t.objectMode?s=t.buffer.shift():!e||e>=t.length?(s=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):(n=e,o=t.buffer,a=t.decoder,n<o.head.data.length?(i=o.head.data.slice(0,n),o.head.data=o.head.data.slice(n)):i=n===o.head.data.length?o.shift():a?function(e,t){var n=t.head,o=1,a=n.data;for(e-=a.length;n=n.next;){var i=n.data,s=e>i.length?i.length:e;if(s===i.length?a+=i:a+=i.slice(0,e),0==(e-=s)){s===i.length?(++o,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=i.slice(s));break}++o}return t.length-=o,a}(n,o):function(e,t){var n=Ee.allocUnsafe(e),o=t.head,a=1;for(o.data.copy(n),e-=o.data.length;o=o.next;){var i=o.data,s=e>i.length?i.length:e;if(i.copy(n,n.length-e,0,s),0==(e-=s)){s===i.length?(++a,o.next?t.head=o.next:t.head=t.tail=null):(t.head=o,o.data=i.slice(s));break}++a}return t.length-=a,n}(n,o),s=i),s);var n,o,a,i,s}function En(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,Et(Cn,t,e))}function Cn(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function kn(e,t){for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function Tn(){}function Mn(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function Sn(e,t){Object.defineProperty(this,"buffer",{get:Ot((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof xn&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n,o=e._writableState,a=o.sync,i=o.writecb;if((n=o).writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0,t)!function(e,t,n,o,a){--t.pendingcb,n?Et(a,o):a(o),e._writableState.errorEmitted=!0,e.emit("error",o)}(e,o,a,t,i);else{var s=Ln(o);s||o.corked||o.bufferProcessing||!o.bufferedRequest||Nn(e,o),a?Et(wn,e,o,s,i):wn(e,o,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new On(this)}function Dn(e){if(!(this instanceof Dn||this instanceof xn))return new Dn(e);this._writableState=new Sn(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),Mt.call(this)}function bn(e,t,n,o,a,i,s){t.writelen=o,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(a,t.onwrite):e._write(a,i,t.onwrite),t.sync=!1}function wn(e,t,n,o){var a,i;n||(a=e,0===(i=t).length&&i.needDrain&&(i.needDrain=!1,a.emit("drain"))),t.pendingcb--,o(),An(e,t)}function Nn(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var o=t.bufferedRequestCount,a=new Array(o),i=t.corkedRequestsFree;i.entry=n;for(var s=0;n;)a[s]=n,n=n.next,s+=1;bn(e,t,!0,t.length,a,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new On(t)}else{for(;n;){var r=n.chunk,c=n.encoding,l=n.callback;if(bn(e,t,!1,t.objectMode?1:r.length,r,c,l),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function Ln(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function Rn(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function An(e,t){var n=Ln(t);return n&&(0===t.pendingcb?(Rn(e,t),t.finished=!0,e.emit("finish")):Rn(e,t)),n}function On(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var o=t.entry;for(t.entry=null;o;){var a=o.callback;e.pendingcb--,a(n),o=o.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}un.prototype.read=function(e){cn("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return cn("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?En(this):gn(this),null;if(0===(e=hn(e,t))&&t.ended)return 0===t.length&&En(this),null;var o,a=t.needReadable;return cn("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&cn("length less than watermark",a=!0),t.ended||t.reading?cn("reading or ended",a=!1):a&&(cn("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=hn(n,t))),null===(o=e>0?In(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&En(this)),null!==o&&this.emit("data",o),o},un.prototype._read=function(e){this.emit("error",new Error("not implemented"))},un.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,cn("pipe count=%d opts=%j",o.pipesCount,t);var a=t&&!1===t.end?l:s;function i(e){cn("onunpipe"),e===n&&l()}function s(){cn("onend"),e.end()}o.endEmitted?Et(a):n.once("end",a),e.on("unpipe",i);var r=function(e){return function(){var t=e._readableState;cn("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,yn(e))}}(n);e.on("drain",r);var c=!1;function l(){cn("cleanup"),e.removeListener("close",h),e.removeListener("finish",g),e.removeListener("drain",r),e.removeListener("error",p),e.removeListener("unpipe",i),n.removeListener("end",s),n.removeListener("end",l),n.removeListener("data",d),c=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||r()}var u=!1;function d(t){cn("ondata"),u=!1,!1!==e.write(t)||u||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==kn(o.pipes,e))&&!c&&(cn("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,u=!0),n.pause())}function p(t){cn("onerror",t),m(),e.removeListener("error",p),0===e.listeners("error").length&&e.emit("error",t)}function h(){e.removeListener("finish",g),m()}function g(){cn("onfinish"),e.removeListener("close",h),m()}function m(){cn("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",p),e.once("close",h),e.once("finish",g),e.emit("pipe",n),o.flowing||(cn("pipe resume"),n.resume()),e},un.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<o;a++)n[a].emit("unpipe",this);return this}var i=kn(t.pipes,e);return-1===i||(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},un.prototype.on=function(e,t){var n=Mt.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var o=this._readableState;o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.emittedReadable=!1,o.reading?o.length&&gn(this):Et(vn,this))}return n},un.prototype.addListener=un.prototype.on,un.prototype.resume=function(){var e,t,n=this._readableState;return n.flowing||(cn("resume"),n.flowing=!0,e=this,(t=n).resumeScheduled||(t.resumeScheduled=!0,Et(_n,e,t))),this},un.prototype.pause=function(){return cn("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(cn("pause"),this._readableState.flowing=!1,this.emit("pause")),this},un.prototype.wrap=function(e){var t=this._readableState,n=!1,o=this;for(var a in e.on("end",(function(){if(cn("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&o.push(e)}o.push(null)})),e.on("data",(function(a){cn("wrapped data"),t.decoder&&(a=t.decoder.write(a)),t.objectMode&&null==a||(t.objectMode||a&&a.length)&&(o.push(a)||(n=!0,e.pause()))})),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));return function(e,t){for(var n=0,o=e.length;n<o;n++)t(e[n])}(["error","close","destroy","pause","resume"],(function(t){e.on(t,o.emit.bind(o,t))})),o._read=function(t){cn("wrapped _read",t),n&&(n=!1,e.resume())},o},un._fromList=In,Dn.WritableState=Sn,Lt(Dn,Mt),Sn.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},Dn.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Dn.prototype.write=function(e,t,n){var o,a,i,s=this._writableState,r=!1;return"function"==typeof t&&(n=t,t=null),Ee.isBuffer(e)?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof n&&(n=Tn),s.ended?(o=this,a=n,i=new Error("write after end"),o.emit("error",i),Et(a,i)):function(e,t,n,o){var a=!0,i=!1;return null===n?i=new TypeError("May not write null values to stream"):Ee.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i&&(e.emit("error",i),Et(o,i),a=!1),a}(this,s,e,n)&&(s.pendingcb++,r=function(e,t,n,o,a){var i,s,r;s=n,r=o,(i=t).objectMode||!1===i.decodeStrings||"string"!=typeof s||(s=Ee.from(s,r)),n=s,Ee.isBuffer(n)&&(o="buffer");var c=t.objectMode?1:n.length;t.length+=c;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest=new Mn(n,o,a),u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else bn(e,t,!1,c,n,o,a);return l}(this,s,e,t,n)),r},Dn.prototype.cork=function(){this._writableState.corked++},Dn.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||Nn(this,e))},Dn.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Dn.prototype._write=function(e,t,n){n(new Error("not implemented"))},Dn.prototype._writev=null,Dn.prototype.end=function(e,t,n){var o,a,i,s=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),s.corked&&(s.corked=1,this.uncork()),s.ending||s.finished||(o=this,i=n,(a=s).ending=!0,An(o,a),i&&(a.finished?Et(i):o.once("finish",i)),a.ended=!0,o.writable=!1)},Lt(xn,un);for(var Un=Object.keys(Dn.prototype),Pn=0;Pn<Un.length;Pn++){var Gn=Un[Pn];xn.prototype[Gn]||(xn.prototype[Gn]=Dn.prototype[Gn])}function xn(e){if(!(this instanceof xn))return new xn(e);un.call(this,e),Dn.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",Bn)}function Bn(){this.allowHalfOpen||this._writableState.ended||Et(Vn,this)}function Vn(e){e.end()}function Fn(e){this.afterTransform=function(t,n){return function(e,t,n){var o=e._transformState;o.transforming=!1;var a=o.writecb;if(!a)return e.emit("error",new Error("no writecb in Transform class"));o.writechunk=null,o.writecb=null,null!=n&&e.push(n),a(t);var i=e._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&e._read(i.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Hn(e){if(!(this instanceof Hn))return new Hn(e);xn.call(this,e),this._transformState=new Fn(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){jn(t,e)})):jn(t)}))}function jn(e,t){if(t)return e.emit("error",t);var n=e._writableState,o=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(o.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function qn(e){if(!(this instanceof qn))return new qn(e);Hn.call(this,e)}function zn(){Mt.call(this)}Lt(Hn,xn),Hn.prototype.push=function(e,t){return this._transformState.needTransform=!1,xn.prototype.push.call(this,e,t)},Hn.prototype._transform=function(e,t,n){throw new Error("Not implemented")},Hn.prototype._write=function(e,t,n){var o=this._transformState;if(o.writecb=n,o.writechunk=e,o.writeencoding=t,!o.transforming){var a=this._readableState;(o.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},Hn.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},Lt(qn,Hn),qn.prototype._transform=function(e,t,n){n(null,e)},Lt(zn,Mt),zn.Readable=un,zn.Writable=Dn,zn.Duplex=xn,zn.Transform=Hn,zn.PassThrough=qn,zn.Stream=zn,zn.prototype.pipe=function(e,t){var n=this;function o(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function a(){n.readable&&n.resume&&n.resume()}n.on("data",o),e.on("drain",a),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",r));var i=!1;function s(){i||(i=!0,e.end())}function r(){i||(i=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(l(),0===Mt.listenerCount(this,"error"))throw e}function l(){n.removeListener("data",o),e.removeListener("drain",a),n.removeListener("end",s),n.removeListener("close",r),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",l),n.removeListener("close",l),e.removeListener("close",l)}return n.on("error",c),e.on("error",c),n.on("end",l),n.on("close",l),e.on("close",l),e.emit("pipe",n),e};var Kn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function $n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Yn(e,t,n,o,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+o),a);else for(var i=0;i<o;i++)e[a+i]=t[n+i]}var Wn=Uint8Array,Jn=Uint16Array,Xn=Int32Array;function Zn(e){for(var t=e.length;--t>=0;)e[t]=0}var Qn=256,eo=286,to=30,no=15,oo=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ao=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],io=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],so=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ro=new Array(576);Zn(ro);var co=new Array(60);Zn(co);var lo=new Array(512);Zn(lo);var uo=new Array(256);Zn(uo);var po=new Array(29);Zn(po);var ho,go,mo,fo=new Array(to);function vo(e,t,n,o,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=o,this.max_length=a,this.has_stree=e&&e.length}function _o(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function yo(e){return e<256?lo[e]:lo[256+(e>>>7)]}function Io(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function Eo(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Io(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function Co(e,t,n){Eo(e,n[2*t],n[2*t+1])}function ko(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function To(e,t,n){var o,a,i=new Array(16),s=0;for(o=1;o<=no;o++)i[o]=s=s+n[o-1]<<1;for(a=0;a<=t;a++){var r=e[2*a+1];0!==r&&(e[2*a]=ko(i[r]++,r))}}function Mo(e){var t;for(t=0;t<eo;t++)e.dyn_ltree[2*t]=0;for(t=0;t<to;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function So(e){e.bi_valid>8?Io(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Do(e,t,n,o){var a=2*t,i=2*n;return e[a]<e[i]||e[a]===e[i]&&o[t]<=o[n]}function bo(e,t,n){for(var o=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&Do(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Do(t,o,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=o}function wo(e,t,n){var o,a,i,s,r=0;if(0!==e.last_lit)do{o=e.pending_buf[e.d_buf+2*r]<<8|e.pending_buf[e.d_buf+2*r+1],a=e.pending_buf[e.l_buf+r],r++,0===o?Co(e,a,t):(Co(e,(i=uo[a])+Qn+1,t),0!==(s=oo[i])&&Eo(e,a-=po[i],s),Co(e,i=yo(--o),n),0!==(s=ao[i])&&Eo(e,o-=fo[i],s))}while(r<e.last_lit);Co(e,256,t)}function No(e,t){var n,o,a,i=t.dyn_tree,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==i[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)i[2*(a=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[a]=0,e.opt_len--,r&&(e.static_len-=s[2*a+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)bo(e,i,n);a=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],bo(e,i,1),o=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=o,i[2*a]=i[2*n]+i[2*o],e.depth[a]=(e.depth[n]>=e.depth[o]?e.depth[n]:e.depth[o])+1,i[2*n+1]=i[2*o+1]=a,e.heap[1]=a++,bo(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,o,a,i,s,r,c=t.dyn_tree,l=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(i=0;i<=no;i++)e.bl_count[i]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(i=c[2*c[2*(o=e.heap[n])+1]+1]+1)>g&&(i=g,m++),c[2*o+1]=i,o>l||(e.bl_count[i]++,s=0,o>=h&&(s=p[o-h]),r=c[2*o],e.opt_len+=r*(i+s),d&&(e.static_len+=r*(u[2*o+1]+s)));if(0!==m){do{for(i=g-1;0===e.bl_count[i];)i--;e.bl_count[i]--,e.bl_count[i+1]+=2,e.bl_count[g]--,m-=2}while(m>0);for(i=g;0!==i;i--)for(o=e.bl_count[i];0!==o;)(a=e.heap[--n])>l||(c[2*a+1]!==i&&(e.opt_len+=(i-c[2*a+1])*c[2*a],c[2*a+1]=i),o--)}}(e,t),To(i,l,e.bl_count)}function Lo(e,t,n){var o,a,i=-1,s=t[1],r=0,c=7,l=4;for(0===s&&(c=138,l=3),t[2*(n+1)+1]=65535,o=0;o<=n;o++)a=s,s=t[2*(o+1)+1],++r<c&&a===s||(r<l?e.bl_tree[2*a]+=r:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[32]++):r<=10?e.bl_tree[34]++:e.bl_tree[36]++,r=0,i=a,0===s?(c=138,l=3):a===s?(c=6,l=3):(c=7,l=4))}function Ro(e,t,n){var o,a,i=-1,s=t[1],r=0,c=7,l=4;for(0===s&&(c=138,l=3),o=0;o<=n;o++)if(a=s,s=t[2*(o+1)+1],!(++r<c&&a===s)){if(r<l)do{Co(e,a,e.bl_tree)}while(0!=--r);else 0!==a?(a!==i&&(Co(e,a,e.bl_tree),r--),Co(e,16,e.bl_tree),Eo(e,r-3,2)):r<=10?(Co(e,17,e.bl_tree),Eo(e,r-3,3)):(Co(e,18,e.bl_tree),Eo(e,r-11,7));r=0,i=a,0===s?(c=138,l=3):a===s?(c=6,l=3):(c=7,l=4)}}Zn(fo);var Ao=!1;function Oo(e,t,n,o){var a,i,s;Eo(e,0+(o?1:0),3),i=t,s=n,So(a=e),Io(a,s),Io(a,~s),Yn(a.pending_buf,a.window,i,s,a.pending),a.pending+=s}function Uo(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(uo[n]+Qn+1)]++,e.dyn_dtree[2*yo(t)]++),e.last_lit===e.lit_bufsize-1}function Po(e,t,n,o){for(var a=65535&e,i=e>>>16&65535,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{i=i+(a=a+t[o++]|0)|0}while(--s);a%=65521,i%=65521}return a|i<<16}var Go=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function xo(e,t,n,o){var a=Go,i=o+n;e^=-1;for(var s=o;s<i;s++)e=e>>>8^a[255&(e^t[s])];return~e}var Bo,Vo=-2,Fo=258,Ho=262,jo=103,qo=113,zo=666;function Ko(e,t){return e.msg=Kn[t],t}function $o(e){return(e<<1)-(e>4?9:0)}function Yo(e){for(var t=e.length;--t>=0;)e[t]=0}function Wo(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(Yn(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function Jo(e,t){(function(e,t,n,o){var a,i,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Qn;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),No(e,e.l_desc),No(e,e.d_desc),s=function(e){var t;for(Lo(e,e.dyn_ltree,e.l_desc.max_code),Lo(e,e.dyn_dtree,e.d_desc.max_code),No(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*so[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(i=e.static_len+3+7>>>3)<=a&&(a=i)):a=i=n+5,n+4<=a&&-1!==t?Oo(e,t,n,o):4===e.strategy||i===a?(Eo(e,2+(o?1:0),3),wo(e,ro,co)):(Eo(e,4+(o?1:0),3),function(e,t,n,o){var a;for(Eo(e,t-257,5),Eo(e,n-1,5),Eo(e,o-4,4),a=0;a<o;a++)Eo(e,e.bl_tree[2*so[a]+1],3);Ro(e,e.dyn_ltree,t-1),Ro(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),wo(e,e.dyn_ltree,e.dyn_dtree)),Mo(e),o&&So(e)})(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Wo(e.strm)}function Xo(e,t){e.pending_buf[e.pending++]=t}function Zo(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Qo(e,t){var n,o,a=e.max_chain_length,i=e.strstart,s=e.prev_length,r=e.nice_match,c=e.strstart>e.w_size-Ho?e.strstart-(e.w_size-Ho):0,l=e.window,u=e.w_mask,d=e.prev,p=e.strstart+Fo,h=l[i+s-1],g=l[i+s];e.prev_length>=e.good_match&&(a>>=2),r>e.lookahead&&(r=e.lookahead);do{if(l[(n=t)+s]===g&&l[n+s-1]===h&&l[n]===l[i]&&l[++n]===l[i+1]){i+=2,n++;do{}while(l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&i<p);if(o=Fo-(p-i),i=p-Fo,o>s){if(e.match_start=t,s=o,o>=r)break;h=l[i+s-1],g=l[i+s]}}}while((t=d[t&u])>c&&0!=--a);return s<=e.lookahead?s:e.lookahead}function ea(e){var t,n,o,a,i,s,r,c,l,u,d=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-Ho)){Yn(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{o=e.head[--t],e.head[t]=o>=d?o-d:0}while(--n);t=n=d;do{o=e.prev[--t],e.prev[t]=o>=d?o-d:0}while(--n);a+=d}if(0===e.strm.avail_in)break;if(s=e.strm,r=e.window,c=e.strstart+e.lookahead,l=a,u=void 0,(u=s.avail_in)>l&&(u=l),n=0===u?0:(s.avail_in-=u,Yn(r,s.input,s.next_in,u,c),1===s.state.wrap?s.adler=Po(s.adler,r,u,c):2===s.state.wrap&&(s.adler=xo(s.adler,r,u,c)),s.next_in+=u,s.total_in+=u,u),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+3-1])&e.hash_mask,e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Ho&&0!==e.strm.avail_in)}function ta(e,t){for(var n,o;;){if(e.lookahead<Ho){if(ea(e),e.lookahead<Ho&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Ho&&(e.match_length=Qo(e,n)),e.match_length>=3)if(o=Uo(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else o=Uo(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(Jo(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(Jo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Jo(e,!1),0===e.strm.avail_out)?1:2}function na(e,t){for(var n,o,a;;){if(e.lookahead<Ho){if(ea(e),e.lookahead<Ho&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ho&&(e.match_length=Qo(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,o=Uo(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(Jo(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((o=Uo(e,0,e.window[e.strstart-1]))&&Jo(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Uo(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(Jo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Jo(e,!1),0===e.strm.avail_out)?1:2}function oa(e,t,n,o,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=o,this.func=a}function aa(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Jn(1146),this.dyn_dtree=new Jn(122),this.bl_tree=new Jn(78),Yo(this.dyn_ltree),Yo(this.dyn_dtree),Yo(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Jn(16),this.heap=new Jn(573),Yo(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Jn(573),Yo(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ia(e){var t,n,o,a=(n=e)&&n.state?(n.total_in=n.total_out=0,n.data_type=2,(o=n.state).pending=0,o.pending_out=0,o.wrap<0&&(o.wrap=-o.wrap),o.status=o.wrap?42:qo,n.adler=2===o.wrap?0:1,o.last_flush=0,function(e){Ao||(function(){var e,t,n,o,a,i=new Array(16);for(n=0,o=0;o<28;o++)for(po[o]=n,e=0;e<1<<oo[o];e++)uo[n++]=o;for(uo[n-1]=o,a=0,o=0;o<16;o++)for(fo[o]=a,e=0;e<1<<ao[o];e++)lo[a++]=o;for(a>>=7;o<to;o++)for(fo[o]=a<<7,e=0;e<1<<ao[o]-7;e++)lo[256+a++]=o;for(t=0;t<=no;t++)i[t]=0;for(e=0;e<=143;)ro[2*e+1]=8,e++,i[8]++;for(;e<=255;)ro[2*e+1]=9,e++,i[9]++;for(;e<=279;)ro[2*e+1]=7,e++,i[7]++;for(;e<=287;)ro[2*e+1]=8,e++,i[8]++;for(To(ro,287,i),e=0;e<to;e++)co[2*e+1]=5,co[2*e]=ko(e,5);ho=new vo(ro,oo,257,eo,no),go=new vo(co,ao,0,to,no),mo=new vo(new Array(0),io,0,19,7)}(),Ao=!0),e.l_desc=new _o(e.dyn_ltree,ho),e.d_desc=new _o(e.dyn_dtree,go),e.bl_desc=new _o(e.bl_tree,mo),e.bi_buf=0,e.bi_valid=0,Mo(e)}(o),0):Ko(n,Vo);return 0===a&&((t=e.state).window_size=2*t.w_size,Yo(t.head),t.max_lazy_match=Bo[t.level].max_lazy,t.good_match=Bo[t.level].good_length,t.nice_match=Bo[t.level].nice_length,t.max_chain_length=Bo[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),a}function sa(e,t){var n,o,a,i;if(!e||!e.state||t>5||t<0)return e?Ko(e,Vo):Vo;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===zo&&4!==t)return Ko(e,0===e.avail_out?-5:Vo);if(o.strm=e,n=o.last_flush,o.last_flush=t,42===o.status)if(2===o.wrap)e.adler=0,Xo(o,31),Xo(o,139),Xo(o,8),o.gzhead?(Xo(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),Xo(o,255&o.gzhead.time),Xo(o,o.gzhead.time>>8&255),Xo(o,o.gzhead.time>>16&255),Xo(o,o.gzhead.time>>24&255),Xo(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),Xo(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(Xo(o,255&o.gzhead.extra.length),Xo(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=xo(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(Xo(o,0),Xo(o,0),Xo(o,0),Xo(o,0),Xo(o,0),Xo(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),Xo(o,3),o.status=qo);else{var s=8+(o.w_bits-8<<4)<<8;s|=(o.strategy>=2||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(s|=32),s+=31-s%31,o.status=qo,Zo(o,s),0!==o.strstart&&(Zo(o,e.adler>>>16),Zo(o,65535&e.adler)),e.adler=1}if(69===o.status)if(o.gzhead.extra){for(a=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>a&&(e.adler=xo(e.adler,o.pending_buf,o.pending-a,a)),Wo(e),a=o.pending,o.pending!==o.pending_buf_size));)Xo(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>a&&(e.adler=xo(e.adler,o.pending_buf,o.pending-a,a)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(e.adler=xo(e.adler,o.pending_buf,o.pending-a,a)),Wo(e),a=o.pending,o.pending===o.pending_buf_size)){i=1;break}i=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,Xo(o,i)}while(0!==i);o.gzhead.hcrc&&o.pending>a&&(e.adler=xo(e.adler,o.pending_buf,o.pending-a,a)),0===i&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(e.adler=xo(e.adler,o.pending_buf,o.pending-a,a)),Wo(e),a=o.pending,o.pending===o.pending_buf_size)){i=1;break}i=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,Xo(o,i)}while(0!==i);o.gzhead.hcrc&&o.pending>a&&(e.adler=xo(e.adler,o.pending_buf,o.pending-a,a)),0===i&&(o.status=jo)}else o.status=jo;if(o.status===jo&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&Wo(e),o.pending+2<=o.pending_buf_size&&(Xo(o,255&e.adler),Xo(o,e.adler>>8&255),e.adler=0,o.status=qo)):o.status=qo),0!==o.pending){if(Wo(e),0===e.avail_out)return o.last_flush=-1,0}else if(0===e.avail_in&&$o(t)<=$o(n)&&4!==t)return Ko(e,-5);if(o.status===zo&&0!==e.avail_in)return Ko(e,-5);if(0!==e.avail_in||0!==o.lookahead||0!==t&&o.status!==zo){var r=2===o.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(ea(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=Uo(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Jo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Jo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Jo(e,!1),0===e.strm.avail_out)?1:2}(o,t):3===o.strategy?function(e,t){for(var n,o,a,i,s=e.window;;){if(e.lookahead<=Fo){if(ea(e),e.lookahead<=Fo&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(o=s[a=e.strstart-1])===s[++a]&&o===s[++a]&&o===s[++a]){i=e.strstart+Fo;do{}while(o===s[++a]&&o===s[++a]&&o===s[++a]&&o===s[++a]&&o===s[++a]&&o===s[++a]&&o===s[++a]&&o===s[++a]&&a<i);e.match_length=Fo-(i-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=Uo(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Uo(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Jo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Jo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Jo(e,!1),0===e.strm.avail_out)?1:2}(o,t):Bo[o.level].func(o,t);if(3!==r&&4!==r||(o.status=zo),1===r||3===r)return 0===e.avail_out&&(o.last_flush=-1),0;if(2===r&&(1===t?function(e){var t;Eo(e,2,3),Co(e,256,ro),16===(t=e).bi_valid?(Io(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(o):5!==t&&(Oo(o,0,0,!1),3===t&&(Yo(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),Wo(e),0===e.avail_out))return o.last_flush=-1,0}return 4!==t?0:o.wrap<=0?1:(2===o.wrap?(Xo(o,255&e.adler),Xo(o,e.adler>>8&255),Xo(o,e.adler>>16&255),Xo(o,e.adler>>24&255),Xo(o,255&e.total_in),Xo(o,e.total_in>>8&255),Xo(o,e.total_in>>16&255),Xo(o,e.total_in>>24&255)):(Zo(o,e.adler>>>16),Zo(o,65535&e.adler)),Wo(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?0:1)}Bo=[new oa(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ea(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var o=e.block_start+n;if((0===e.strstart||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,Jo(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-Ho&&(Jo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Jo(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Jo(e,!1),e.strm.avail_out),1)})),new oa(4,4,8,4,ta),new oa(4,5,16,8,ta),new oa(4,6,32,32,ta),new oa(4,4,16,16,na),new oa(8,16,32,32,na),new oa(8,16,128,128,na),new oa(8,32,128,256,na),new oa(32,128,258,1024,na),new oa(32,258,258,4096,na)];function ra(e,t){var n,o,a,i,s,r,c,l,u,d,p,h,g,m,f,v,_,y,I,E,C,k,T,M,S;n=e.state,o=e.next_in,M=e.input,a=o+(e.avail_in-5),i=e.next_out,S=e.output,s=i-(t-e.avail_out),r=i+(e.avail_out-257),c=n.dmax,l=n.wsize,u=n.whave,d=n.wnext,p=n.window,h=n.hold,g=n.bits,m=n.lencode,f=n.distcode,v=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{g<15&&(h+=M[o++]<<g,g+=8,h+=M[o++]<<g,g+=8),y=m[h&v];t:for(;;){if(h>>>=I=y>>>24,g-=I,0==(I=y>>>16&255))S[i++]=65535&y;else{if(!(16&I)){if(!(64&I)){y=m[(65535&y)+(h&(1<<I)-1)];continue t}if(32&I){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}E=65535&y,(I&=15)&&(g<I&&(h+=M[o++]<<g,g+=8),E+=h&(1<<I)-1,h>>>=I,g-=I),g<15&&(h+=M[o++]<<g,g+=8,h+=M[o++]<<g,g+=8),y=f[h&_];n:for(;;){if(h>>>=I=y>>>24,g-=I,!(16&(I=y>>>16&255))){if(!(64&I)){y=f[(65535&y)+(h&(1<<I)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(C=65535&y,g<(I&=15)&&(h+=M[o++]<<g,(g+=8)<I&&(h+=M[o++]<<g,g+=8)),(C+=h&(1<<I)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(h>>>=I,g-=I,C>(I=i-s)){if((I=C-I)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=0,T=p,0===d){if(k+=l-I,I<E){E-=I;do{S[i++]=p[k++]}while(--I);k=i-C,T=S}}else if(d<I){if(k+=l+d-I,(I-=d)<E){E-=I;do{S[i++]=p[k++]}while(--I);if(k=0,d<E){E-=I=d;do{S[i++]=p[k++]}while(--I);k=i-C,T=S}}}else if(k+=d-I,I<E){E-=I;do{S[i++]=p[k++]}while(--I);k=i-C,T=S}for(;E>2;)S[i++]=T[k++],S[i++]=T[k++],S[i++]=T[k++],E-=3;E&&(S[i++]=T[k++],E>1&&(S[i++]=T[k++]))}else{k=i-C;do{S[i++]=S[k++],S[i++]=S[k++],S[i++]=S[k++],E-=3}while(E>2);E&&(S[i++]=S[k++],E>1&&(S[i++]=S[k++]))}break}}break}}while(o<a&&i<r);o-=E=g>>3,h&=(1<<(g-=E<<3))-1,e.next_in=o,e.next_out=i,e.avail_in=o<a?a-o+5:5-(o-a),e.avail_out=i<r?r-i+257:257-(i-r),n.hold=h,n.bits=g}var ca=15,la=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ua=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],da=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],pa=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function ha(e,t,n,o,a,i,s,r){var c,l,u,d,p,h,g,m,f,v=r.bits,_=0,y=0,I=0,E=0,C=0,k=0,T=0,M=0,S=0,D=0,b=null,w=0,N=new Jn(16),L=new Jn(16),R=null,A=0;for(_=0;_<=ca;_++)N[_]=0;for(y=0;y<o;y++)N[t[n+y]]++;for(C=v,E=ca;E>=1&&0===N[E];E--);if(C>E&&(C=E),0===E)return a[i++]=20971520,a[i++]=20971520,r.bits=1,0;for(I=1;I<E&&0===N[I];I++);for(C<I&&(C=I),M=1,_=1;_<=ca;_++)if(M<<=1,(M-=N[_])<0)return-1;if(M>0&&(0===e||1!==E))return-1;for(L[1]=0,_=1;_<ca;_++)L[_+1]=L[_]+N[_];for(y=0;y<o;y++)0!==t[n+y]&&(s[L[t[n+y]]++]=y);if(0===e?(b=R=s,h=19):1===e?(b=la,w-=257,R=ua,A-=257,h=256):(b=da,R=pa,h=-1),D=0,y=0,_=I,p=i,k=C,T=0,u=-1,d=(S=1<<C)-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){g=_-T,s[y]<h?(m=0,f=s[y]):s[y]>h?(m=R[A+s[y]],f=b[w+s[y]]):(m=96,f=0),c=1<<_-T,I=l=1<<k;do{a[p+(D>>T)+(l-=c)]=g<<24|m<<16|f}while(0!==l);for(c=1<<_-1;D&c;)c>>=1;if(0!==c?(D&=c-1,D+=c):D=0,y++,0==--N[_]){if(_===E)break;_=t[n+s[y]]}if(_>C&&(D&d)!==u){for(0===T&&(T=C),p+=I,M=1<<(k=_-T);k+T<E&&!((M-=N[k+T])<=0);)k++,M<<=1;if(S+=1<<k,1===e&&S>852||2===e&&S>592)return 1;a[u=D&d]=C<<24|k<<16|p-i}}return 0!==D&&(a[p+D]=_-T<<24|64<<16),r.bits=C,0}var ga=-2,ma=12,fa=30;function va(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function _a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Jn(320),this.work=new Jn(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ya(e){var t,n,o;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,(n=e)&&n.state?(o=n.state,n.total_in=n.total_out=o.total=0,n.msg="",o.wrap&&(n.adler=1&o.wrap),o.mode=1,o.last=0,o.havedict=0,o.dmax=32768,o.head=null,o.hold=0,o.bits=0,o.lencode=o.lendyn=new Xn(852),o.distcode=o.distdyn=new Xn(592),o.sane=1,o.back=-1,0):ga):ga}var Ia,Ea,Ca=!0;function ka(e){if(Ca){var t;for(Ia=new Xn(512),Ea=new Xn(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ha(1,e.lens,0,288,Ia,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ha(2,e.lens,0,32,Ea,0,e.work,{bits:5}),Ca=!1}e.lencode=Ia,e.lenbits=9,e.distcode=Ea,e.distbits=5}var Ta;function Ma(e){if(e<1||e>7)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function Sa(e,t){for(var n=0;n<e.length;n++)this[t+n]=e[n]}Ma.prototype.init=function(e,t,n,o,a){var i;switch(this.windowBits=e,this.level=t,this.memLevel=n,this.strategy=o,3!==this.mode&&4!==this.mode||(this.windowBits+=16),7===this.mode&&(this.windowBits+=32),5!==this.mode&&6!==this.mode||(this.windowBits=-this.windowBits),this.strm=new $n,this.mode){case 1:case 3:case 5:i=function(e,t,n,o,a,i){if(!e)return Vo;var s=1;if(-1===t&&(t=6),o<0?(s=0,o=-o):o>15&&(s=2,o-=16),a<1||a>9||o<8||o>15||t<0||t>9||i<0||i>4)return Ko(e,Vo);8===o&&(o=9);var r=new aa;return e.state=r,r.strm=e,r.wrap=s,r.gzhead=null,r.w_bits=o,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=a+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+3-1)/3),r.window=new Wn(2*r.w_size),r.head=new Jn(r.hash_size),r.prev=new Jn(r.w_size),r.lit_bufsize=1<<a+6,r.pending_buf_size=4*r.lit_bufsize,r.pending_buf=new Wn(r.pending_buf_size),r.d_buf=1*r.lit_bufsize,r.l_buf=3*r.lit_bufsize,r.level=t,r.strategy=i,r.method=8,ia(e)}(this.strm,this.level,0,this.windowBits,this.memLevel,this.strategy);break;case 2:case 4:case 6:case 7:i=function(e,t){var n,o,a,i,s,r;return e?(o=new _a,e.state=o,o.window=null,0!==(i=t,n=(a=e)&&a.state?(r=a.state,i<0?(s=0,i=-i):(s=1+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?ga:(null!==r.window&&r.wbits!==i&&(r.window=null),r.wrap=s,r.wbits=i,ya(a))):ga)&&(e.state=null),n):ga}(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}0===i?(this.write_in_progress=!1,this.init_done=!0):this._error(i)},Ma.prototype.params=function(){throw new Error("deflateParams Not supported")},Ma.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(0===this.mode)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},Ma.prototype.write=function(e,t,n,o,a,i,s){this._writeCheck(),this.write_in_progress=!0;var r=this;return Et((function(){r.write_in_progress=!1;var c=r._write(e,t,n,o,a,i,s);r.callback(c[0],c[1]),r.pending_close&&r.close()})),this},Ma.prototype.writeSync=function(e,t,n,o,a,i,s){return this._writeCheck(),this._write(e,t,n,o,a,i,s)},Ma.prototype._write=function(e,t,n,o,a,i,s){if(this.write_in_progress=!0,0!==e&&1!==e&&2!==e&&3!==e&&4!==e&&5!==e)throw new Error("Invalid flush value");null==t&&(t=new Ee(0),o=0,n=0),a._set?a.set=a._set:a.set=Sa;var r,c=this.strm;switch(c.avail_in=o,c.input=t,c.next_in=n,c.avail_out=s,c.output=a,c.next_out=i,this.mode){case 1:case 3:case 5:r=sa(c,e);break;case 7:case 2:case 4:case 6:r=function(e,t){var n,o,a,i,s,r,c,l,u,d,p,h,g,m,f,v,_,y,I,E,C,k,T,M,S,D,b,w,N,L,R=0,A=new Wn(4),O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return ga;(n=e.state).mode===ma&&(n.mode=13),s=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,o=e.input,r=e.avail_in,l=n.hold,u=n.bits,d=r,p=c,k=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(2&n.wrap&&35615===l){n.check=0,A[0]=255&l,A[1]=l>>>8&255,n.check=xo(n.check,A,2,0),l=0,u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=fa;break}if(8!=(15&l)){e.msg="unknown compression method",n.mode=fa;break}if(u-=4,C=8+(15&(l>>>=4)),0===n.wbits)n.wbits=C;else if(C>n.wbits){e.msg="invalid window size",n.mode=fa;break}n.dmax=1<<C,e.adler=n.check=1,n.mode=512&l?10:ma,l=0,u=0;break;case 2:for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(n.flags=l,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=fa;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=fa;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&(A[0]=255&l,A[1]=l>>>8&255,n.check=xo(n.check,A,2,0)),l=0,u=0,n.mode=3;case 3:for(;u<32;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.head&&(n.head.time=l),512&n.flags&&(A[0]=255&l,A[1]=l>>>8&255,A[2]=l>>>16&255,A[3]=l>>>24&255,n.check=xo(n.check,A,4,0)),l=0,u=0,n.mode=4;case 4:for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&(A[0]=255&l,A[1]=l>>>8&255,n.check=xo(n.check,A,2,0)),l=0,u=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&(A[0]=255&l,A[1]=l>>>8&255,n.check=xo(n.check,A,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((h=n.length)>r&&(h=r),h&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Yn(n.head.extra,o,i,h,C)),512&n.flags&&(n.check=xo(n.check,o,h,i)),r-=h,i+=h,n.length-=h),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===r)break e;h=0;do{C=o[i+h++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C))}while(C&&h<r);if(512&n.flags&&(n.check=xo(n.check,o,h,i)),r-=h,i+=h,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===r)break e;h=0;do{C=o[i+h++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C))}while(C&&h<r);if(512&n.flags&&(n.check=xo(n.check,o,h,i)),r-=h,i+=h,C)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=fa;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=ma;break;case 10:for(;u<32;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}e.adler=n.check=va(l),l=0,u=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=r,n.hold=l,n.bits=u,2;e.adler=n.check=1,n.mode=ma;case ma:if(5===t||6===t)break e;case 13:if(n.last){l>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}switch(n.last=1&l,u-=1,3&(l>>>=1)){case 0:n.mode=14;break;case 1:if(ka(n),n.mode=20,6===t){l>>>=2,u-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=fa}l>>>=2,u-=2;break;case 14:for(l>>>=7&u,u-=7&u;u<32;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=fa;break}if(n.length=65535&l,l=0,u=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(h=n.length){if(h>r&&(h=r),h>c&&(h=c),0===h)break e;Yn(a,o,i,h,s),r-=h,i+=h,c-=h,s+=h,n.length-=h;break}n.mode=ma;break;case 17:for(;u<14;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(n.nlen=257+(31&l),l>>>=5,u-=5,n.ndist=1+(31&l),l>>>=5,u-=5,n.ncode=4+(15&l),l>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=fa;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.lens[O[n.have++]]=7&l,l>>>=3,u-=3}for(;n.have<19;)n.lens[O[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},k=ha(0,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,k){e.msg="invalid code lengths set",n.mode=fa;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;v=(R=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,_=65535&R,!((f=R>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(_<16)l>>>=f,u-=f,n.lens[n.have++]=_;else{if(16===_){for(M=f+2;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(l>>>=f,u-=f,0===n.have){e.msg="invalid bit length repeat",n.mode=fa;break}C=n.lens[n.have-1],h=3+(3&l),l>>>=2,u-=2}else if(17===_){for(M=f+3;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}u-=f,C=0,h=3+(7&(l>>>=f)),l>>>=3,u-=3}else{for(M=f+7;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}u-=f,C=0,h=11+(127&(l>>>=f)),l>>>=7,u-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=fa;break}for(;h--;)n.lens[n.have++]=C}}if(n.mode===fa)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=fa;break}if(n.lenbits=9,T={bits:n.lenbits},k=ha(1,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,k){e.msg="invalid literal/lengths set",n.mode=fa;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},k=ha(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,k){e.msg="invalid distances set",n.mode=fa;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(r>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=r,n.hold=l,n.bits=u,ra(e,p),s=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,o=e.input,r=e.avail_in,l=n.hold,u=n.bits,n.mode===ma&&(n.back=-1);break}for(n.back=0;v=(R=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,_=65535&R,!((f=R>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(v&&!(240&v)){for(y=f,I=v,E=_;v=(R=n.lencode[E+((l&(1<<y+I)-1)>>y)])>>>16&255,_=65535&R,!(y+(f=R>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}l>>>=y,u-=y,n.back+=y}if(l>>>=f,u-=f,n.back+=f,n.length=_,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=ma;break}if(64&v){e.msg="invalid literal/length code",n.mode=fa;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(M=n.extra;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;v=(R=n.distcode[l&(1<<n.distbits)-1])>>>16&255,_=65535&R,!((f=R>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(!(240&v)){for(y=f,I=v,E=_;v=(R=n.distcode[E+((l&(1<<y+I)-1)>>y)])>>>16&255,_=65535&R,!(y+(f=R>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}l>>>=y,u-=y,n.back+=y}if(l>>>=f,u-=f,n.back+=f,64&v){e.msg="invalid distance code",n.mode=fa;break}n.offset=_,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(M=n.extra;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=fa;break}n.mode=25;case 25:if(0===c)break e;if(h=p-c,n.offset>h){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=fa;break}h>n.wnext?(h-=n.wnext,g=n.wsize-h):g=n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=a,g=s-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do{a[s++]=m[g++]}while(--h);0===n.length&&(n.mode=21);break;case 26:if(0===c)break e;a[s++]=n.length,c--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===r)break e;r--,l|=o[i++]<<u,u+=8}if(p-=c,e.total_out+=p,n.total+=p,p&&(e.adler=n.check=n.flags?xo(n.check,a,p,s-p):Po(n.check,a,p,s-p)),p=c,(n.flags?l:va(l))!==n.check){e.msg="incorrect data check",n.mode=fa;break}l=0,u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=fa;break}l=0,u=0}n.mode=29;case 29:k=1;break e;case fa:k=-3;break e;case 31:return-4;default:return ga}return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=r,n.hold=l,n.bits=u,(n.wsize||p!==e.avail_out&&n.mode<fa&&(n.mode<27||4!==t))&&(S=e,D=e.output,b=e.next_out,w=p-e.avail_out,null===(L=S.state).window&&(L.wsize=1<<L.wbits,L.wnext=0,L.whave=0,L.window=new Wn(L.wsize)),w>=L.wsize?(Yn(L.window,D,b-L.wsize,L.wsize,0),L.wnext=0,L.whave=L.wsize):((N=L.wsize-L.wnext)>w&&(N=w),Yn(L.window,D,b-w,N,L.wnext),(w-=N)?(Yn(L.window,D,b-w,w,0),L.wnext=w,L.whave=L.wsize):(L.wnext+=N,L.wnext===L.wsize&&(L.wnext=0),L.whave<L.wsize&&(L.whave+=N)))),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,n.total+=p,n.wrap&&p&&(e.adler=n.check=n.flags?xo(n.check,a,p,e.next_out-p):Po(n.check,a,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(n.mode===ma?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===p||4===t)&&0===k&&(k=-5),k}(c,e);break;default:throw new Error("Unknown mode "+this.mode)}return 1!==r&&0!==r&&this._error(r),this.write_in_progress=!1,[c.avail_in,c.avail_out]},Ma.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,1===this.mode||3===this.mode||5===this.mode?function(e){var t;e&&e.state&&(42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==jo&&t!==qo&&t!==zo?Ko(e,Vo):(e.state=null,t===qo&&Ko(e,-3)))}(this.strm):function(e){if(!e||!e.state)return ga;var t=e.state;t.window&&(t.window=null),e.state=null}(this.strm),this.mode=0)},Ma.prototype.reset=function(){switch(this.mode){case 1:case 5:Ta=ia(this.strm);break;case 2:case 6:Ta=ya(this.strm)}0!==Ta&&this._error(Ta)},Ma.prototype._error=function(e){this.onerror(Kn[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()};var Da=Object.freeze({NONE:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8,Zlib:Ma}),ba={};Object.keys(Da).forEach((function(e){ba[e]=Da[e]})),ba.Z_MIN_WINDOWBITS=8,ba.Z_MAX_WINDOWBITS=15,ba.Z_DEFAULT_WINDOWBITS=15,ba.Z_MIN_CHUNK=64,ba.Z_MAX_CHUNK=1/0,ba.Z_DEFAULT_CHUNK=16384,ba.Z_MIN_MEMLEVEL=1,ba.Z_MAX_MEMLEVEL=9,ba.Z_DEFAULT_MEMLEVEL=8,ba.Z_MIN_LEVEL=-1,ba.Z_MAX_LEVEL=9,ba.Z_DEFAULT_LEVEL=ba.Z_DEFAULT_COMPRESSION;var wa={Z_OK:ba.Z_OK,Z_STREAM_END:ba.Z_STREAM_END,Z_NEED_DICT:ba.Z_NEED_DICT,Z_ERRNO:ba.Z_ERRNO,Z_STREAM_ERROR:ba.Z_STREAM_ERROR,Z_DATA_ERROR:ba.Z_DATA_ERROR,Z_MEM_ERROR:ba.Z_MEM_ERROR,Z_BUF_ERROR:ba.Z_BUF_ERROR,Z_VERSION_ERROR:ba.Z_VERSION_ERROR};function Na(e,t){if("string"==typeof t&&(t=new Ee(t)),!it(t))throw new TypeError("Not a string or buffer");var n=ba.Z_FINISH;return e._processChunk(t,n)}function La(e){if(!(this instanceof La))return new La(e);xa.call(this,e,ba.DEFLATE)}function Ra(e){if(!(this instanceof Ra))return new Ra(e);xa.call(this,e,ba.INFLATE)}function Aa(e){if(!(this instanceof Aa))return new Aa(e);xa.call(this,e,ba.GZIP)}function Oa(e){if(!(this instanceof Oa))return new Oa(e);xa.call(this,e,ba.GUNZIP)}function Ua(e){if(!(this instanceof Ua))return new Ua(e);xa.call(this,e,ba.DEFLATERAW)}function Pa(e){if(!(this instanceof Pa))return new Pa(e);xa.call(this,e,ba.INFLATERAW)}function Ga(e){if(!(this instanceof Ga))return new Ga(e);xa.call(this,e,ba.UNZIP)}function xa(e,t){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||ba.Z_DEFAULT_CHUNK,Hn.call(this,e),e.flush&&e.flush!==ba.Z_NO_FLUSH&&e.flush!==ba.Z_PARTIAL_FLUSH&&e.flush!==ba.Z_SYNC_FLUSH&&e.flush!==ba.Z_FULL_FLUSH&&e.flush!==ba.Z_FINISH&&e.flush!==ba.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||ba.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<ba.Z_MIN_CHUNK||e.chunkSize>ba.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<ba.Z_MIN_WINDOWBITS||e.windowBits>ba.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<ba.Z_MIN_LEVEL||e.level>ba.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<ba.Z_MIN_MEMLEVEL||e.memLevel>ba.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=ba.Z_FILTERED&&e.strategy!=ba.Z_HUFFMAN_ONLY&&e.strategy!=ba.Z_RLE&&e.strategy!=ba.Z_FIXED&&e.strategy!=ba.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!it(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new ba.Zlib(t);var n=this;this._hadError=!1,this._binding.onerror=function(e,t){n._binding=null,n._hadError=!0;var o=new Error(e);o.errno=t,o.code=ba.codes[t],n.emit("error",o)};var o=ba.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(o=e.level);var a=ba.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(a=e.strategy),this._binding.init(e.windowBits||ba.Z_DEFAULT_WINDOWBITS,o,e.memLevel||ba.Z_DEFAULT_MEMLEVEL,a,e.dictionary),this._buffer=new Ee(this._chunkSize),this._offset=0,this._closed=!1,this._level=o,this._strategy=a,this.once("end",this.close)}Object.keys(wa).forEach((function(e){wa[wa[e]]=e})),Lt(xa,Hn),xa.prototype.params=function(e,t,n){if(e<ba.Z_MIN_LEVEL||e>ba.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(t!=ba.Z_FILTERED&&t!=ba.Z_HUFFMAN_ONLY&&t!=ba.Z_RLE&&t!=ba.Z_FIXED&&t!=ba.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+t);if(this._level!==e||this._strategy!==t){var o=this;this.flush(ba.Z_SYNC_FLUSH,(function(){o._binding.params(e,t),o._hadError||(o._level=e,o._strategy=t,n&&n())}))}else Et(n)},xa.prototype.reset=function(){return this._binding.reset()},xa.prototype._flush=function(e){this._transform(new Ee(0),"",e)},xa.prototype.flush=function(e,t){var n=this._writableState;if(("function"==typeof e||void 0===e&&!t)&&(t=e,e=ba.Z_FULL_FLUSH),n.ended)t&&Et(t);else if(n.ending)t&&this.once("end",t);else if(n.needDrain){var o=this;this.once("drain",(function(){o.flush(t)}))}else this._flushFlag=e,this.write(new Ee(0),"",t)},xa.prototype.close=function(e){if(e&&Et(e),!this._closed){this._closed=!0,this._binding.close();var t=this;Et((function(){t.emit("close")}))}},xa.prototype._transform=function(e,t,n){var o,a=this._writableState,i=(a.ending||a.ended)&&(!e||a.length===e.length);if(null===!e&&!it(e))return n(new Error("invalid input"));i?o=ba.Z_FINISH:(o=this._flushFlag,e.length>=a.length&&(this._flushFlag=this._opts.flush||ba.Z_NO_FLUSH)),this._processChunk(e,o,n)},xa.prototype._processChunk=function(e,t,n){var o=e&&e.length,a=this._chunkSize-this._offset,i=0,s=this,r="function"==typeof n;if(!r){var c,l=[],u=0;this.on("error",(function(e){c=e}));do{var d=this._binding.writeSync(t,e,i,o,this._buffer,this._offset,a)}while(!this._hadError&&g(d[0],d[1]));if(this._hadError)throw c;var p=Ee.concat(l,u);return this.close(),p}var h=this._binding.write(t,e,i,o,this._buffer,this._offset,a);function g(c,d){if(!s._hadError){var p=a-d;if(function(e){if(!e)throw new Error("have should not go down")}(p>=0),p>0){var h=s._buffer.slice(s._offset,s._offset+p);s._offset+=p,r?s.push(h):(l.push(h),u+=h.length)}if((0===d||s._offset>=s._chunkSize)&&(a=s._chunkSize,s._offset=0,s._buffer=new Ee(s._chunkSize)),0===d){if(i+=o-c,o=c,!r)return!0;var m=s._binding.write(t,e,i,o,s._buffer,s._offset,s._chunkSize);return m.callback=g,void(m.buffer=e)}if(!r)return!1;n()}}h.buffer=e,h.callback=g},Lt(La,xa),Lt(Ra,xa),Lt(Aa,xa),Lt(Oa,xa),Lt(Ua,xa),Lt(Pa,xa),Lt(Ga,xa);var Ba=function(e,t){return Na(new La(t),e)},Va=function(e,t){return Na(new Ra(t),e)};class Fa{constructor(e,t,n){this.SDKAPPID=e,this.EXPIRETIME=n,this.PRIVATEKEY=t}genTestUserSig(e){return this._isNumber(this.SDKAPPID)?this._isString(this.PRIVATEKEY)?this._isString(e)?this._isNumber(this.EXPIRETIME)?(I("log","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2","sdkAppID="+this.SDKAPPID+" key="+this.PRIVATEKEY+" userID="+e+" expire="+this.EXPIRETIME),this.genSigWithUserbuf(e,this.EXPIRETIME,null)):(I("error","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2","expireTime must be a number"),""):(I("error","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2","userID must be a string"),""):(I("error","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2","privateKey must be a string"),""):(I("error","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2","sdkAppID must be a number"),"")}newBuffer(e,t){return Ee.from?Ee.from(e,t):new Ee(e,t)}unescape(e){return e.replace(/_/g,"=").replace(/\-/g,"/").replace(/\*/g,"+")}escape(e){return e.replace(/\+/g,"*").replace(/\//g,"-").replace(/=/g,"_")}encode(e){return this.escape(this.newBuffer(e).toString("base64"))}decode(e){return this.newBuffer(this.unescape(e),"base64")}base64encode(e){return this.newBuffer(e).toString("base64")}base64decode(e){return this.newBuffer(e,"base64").toString()}_hmacsha256(e,t,n,o){let a="TLS.identifier:"+e+"\n";a+="TLS.sdkappid:"+this.SDKAPPID+"\n",a+="TLS.time:"+t+"\n",a+="TLS.expire:"+n+"\n",null!=o&&(a+="TLS.userbuf:"+o+"\n");let i=lt.HmacSHA256(a,this.PRIVATEKEY);return lt.enc.Base64.stringify(i)}_utc(){return Math.round(Date.now()/1e3)}_isNumber(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"==typeof e&&e.constructor===Number)}_isString(e){return"string"==typeof e}genSigWithUserbuf(e,t,n){let o=this._utc(),a={"TLS.ver":"2.0","TLS.identifier":e,"TLS.sdkappid":this.SDKAPPID,"TLS.time":o,"TLS.expire":t},i="";if(null!=n){let s=this.base64encode(n);a["TLS.userbuf"]=s,i=this._hmacsha256(e,o,t,s)}else i=this._hmacsha256(e,o,t,null);a["TLS.sig"]=i;let s=JSON.stringify(a),r=Ba(this.newBuffer(s)).toString("base64"),c=this.escape(r);return I("log","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2","ret="+c),c}validate(e){let t=this.decode(e);I("log","at TUIKit/debug/lib-generate-test-usersig-es.min.js:2","validate ret="+Va(t))}}function Ha(e){const{SDKAppID:t,secretKey:n,userID:o}=e;return{SDKAppID:t,userSig:new Fa(t,n,604800).genTestUserSig(o)}}var ja="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function qa(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var za={exports:{}};za.exports=function(){function e(e,t){var n,o=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)),o}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){s(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function d(e,t,n){return(d=u()?Reflect.construct.bind():function(e,t,n){var o=[null];return o.push.apply(o,t),t=new(Function.bind.apply(e,o)),n&&l(t,n.prototype),t}).apply(null,arguments)}function p(e){var t="function"==typeof Map?new Map:void 0;return function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return d(e,arguments,c(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),l(n,e)}(e)}function h(e,t){if(null==e)return{};var n,o=function(e,t){if(null==e)return{};for(var n,o={},a=Object.keys(e),i=0;i<a.length;i++)n=a[i],0<=t.indexOf(n)||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols)for(var a=Object.getOwnPropertySymbols(e),i=0;i<a.length;i++)n=a[i],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n]);return o}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){var t=u();return function(){var n,o=c(e);if(n=t?(n=c(this).constructor,Reflect.construct(o,arguments,n)):o.apply(this,arguments),o=this,n&&("object"==typeof n||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return g(o)}}function f(e,t){return _(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,a,i=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(o=n.next()).done)&&(i.push(o.value),!t||i.length!==t);s=!0);}catch(c){r=!0,a=c}finally{try{s||null==n.return||n.return()}finally{if(r)throw a}}return i}}(e,t)||E(e,t)||k()}function v(e){return function(e){if(Array.isArray(e))return C(e)}(e)||y(e)||E(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e){if(Array.isArray(e))return e}function y(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function E(e,t){var n;if(e)return"string"==typeof e?C(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){var n,o,a,i,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return a=!(o=!0),{s:function(){s=s.call(e)},n:function(){var e=s.next();return o=e.done,e},e:function(e){a=!0,n=e},f:function(){try{o||null==s.return||s.return()}finally{if(a)throw n}}};if(Array.isArray(e)||(s=E(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),i=0,{s:t=function(){},n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var M={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",ROOM_CUSTOM_DATA_RECEIVED:"onRoomCustomDataReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",MESSAGE_REACTIONS_UPDATED:"onMessageReactionsUpdated",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",MY_FOLLOWERS_LIST_UPDATED:"onMyFollowersListUpdated",MY_FOLLOWING_LIST_UPDATED:"onMyFollowingListUpdated",MUTUAL_FOLLOWERS_LIST_UPDATED:"onMutualFollowersListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",ALL_RECEIVE_MESSAGE_OPT_UPDATED:"onAllReceiveMessageOptUpdated"},S={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_ROOM:"Room",GRP_LIVE:"Live",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",RECEIVE_WITH_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_MSG_EXCEPT_AT:"NotReceiveMsgExceptAt",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3,IOS_OFFLINE_PUSH_NO_SOUND:"push.no_sound",IOS_OFFLINE_PUSH_DEFAULT_SOUND:"default"},D={NEW_INVITATION_RECEIVED:"newInvitationReceived",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",INVITATION_MODIFIED:"ts_invitation_modified",ACTION_TYPE_UNKNOWN:0,ACTION_TYPE_INVITE:1,ACTION_TYPE_CANCEL_INVITE:2,ACTION_TYPE_ACCEPT_INVITE:3,ACTION_TYPE_REJECT_INVITE:4,ACTION_TYPE_INVITE_TIMEOUT:5},b=(i(F,[{key:"use",value:function(e){if("function"!=typeof e)throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&0<this.middlewares.length)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}]),F),w=(i(V,[{key:"equal",value:function(e){return null!==e&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),V),N={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"},INDONESIA:{DEFAULT:"wss://wssidn-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT0:"wss://*w4s.my-imcloud.com",DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com",ANYCAST:"wss://162.14.19.159"},KOREA:{DEFAULT0:"wss://*w4k.my-imcloud.com",DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com",ANYCAST:"wss://162.14.13.104"},GERMANY:{DEFAULT0:"wss://*w4g.my-imcloud.com",DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com",ANYCAST:"wss://162.14.3.17"},IND:{DEFAULT0:"wss://*w4i.my-imcloud.com",DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com",ANYCAST:"wss://162.14.18.188"},JPN:{DEFAULT0:"wss://*w4j.my-imcloud.com",DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT0:"wss://*w4u.my-imcloud.com",DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com",ANYCAST:"wss://162.14.10.42"},INDONESIA:{DEFAULT0:"wss://*w4y.my-imcloud.com",DEFAULT:"wss://wssidn.im.qcloud.com",BACKUP:"wss://wssidn.my-imcloud.com",STAT:"https://apiidn.my-imcloud.com",ANYCAST:"wss://43.129.34.169"}}},L={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15,DONUT_NATIVE_APP:19,NS_NATIVE_APP:20,RN_NATIVE_APP:21},R="1.7.3",A=537048168,O="CHINA",U={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){this.CURRENT=N.PRODUCTION[0<arguments.length&&void 0!==arguments[0]?arguments[0]:O]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GRP:"group_open_http_svc",GRP_AV:"group_open_avchatroom_http_svc",GRP_COMMUNITY:"million_group_open_http_svc",GRP_ATTR:"group_open_attr_http_svc",FD:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GRP_NO_AUTH:"group_open_http_noauth_svc",BIG_GRP_POLLING:"group_open_long_polling_http_svc",BIG_GRP_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MSG:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate",IM_OPEN_SPEECH:"im_open_speech",MSG_SEARCH:"message_search",FOLLOW:"follow",OFFLINE_PUSH_REPORT:"offline_push_report",IM_MSG_LOGIC:"im_msg_db_logic"}},P={SEARCH_GRP_SNS:new w(0,Math.pow(2,1)).toString(),AV_HISTORY_MSG:new w(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new w(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new w(0,Math.pow(2,4)).toString(),AV_MBR_LIST:new w(0,Math.pow(2,6)).toString(),USER_STATUS:new w(0,Math.pow(2,7)).toString(),CONV_MARK:new w(0,Math.pow(2,9)).toString(),CONV_GROUP:new w(0,Math.pow(2,10)).toString(),AV_BAN_MBR:new w(0,Math.pow(2,11)).toString(),MSG_EXT:new w(0,Math.pow(2,13)).toString(),GRP_COUNTER:new w(0,Math.pow(2,15)).toString(),PLUGIN_TRANSLATE:new w(Math.pow(2,6)).toString(),PLUGIN_VOICE_TO_TEXT:new w(Math.pow(2,7)).toString(),PLUGIN_CS:new w(Math.pow(2,8)).toString(),PLUGIN_PUSH:new w(Math.pow(2,9)).toString(),PLUGIN_BOT:new w(Math.pow(2,10)).toString(),MSG_REACTION:new w(Math.pow(2,16)).toString(),FOLLOW:new w(Math.pow(2,20)).toString()},G="group_profile",x=["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],B=["Role","JoinTime","MsgSeq","MsgFlag"];function V(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;o(this,V),this.high=e,this.low=t}function F(){o(this,F),this.cache=[],this.options=null}U.HOST.setCurrent(O);for(var H,j="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),q=j&&"function"==typeof wx.createGamePortal,z="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),K="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),$="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),Y="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),W="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,J="undefined"!=typeof uni&&"undefined"==typeof window&&!0,X=j&&"object"===n(wx.miniapp),Z="undefined"!=typeof uni,Q=j||z||K||$||Y||J||W,ee="undefined"==typeof window&&!Q&&void 0!==ja&&void 0!==ja.NativeScriptGlobals,te=void 0!==ja&&(void 0!==ja.nativeModuleProxy||void 0!==ja.ReactNative),ne="undefined"!=typeof uni?!Q:"undefined"!=typeof window&&!Q&&!te,oe=z?qq:K?tt:$?swan:Y?my:j?wx:J?uni:W?jd:{},ae=ne&&window&&window.navigator&&window.navigator.userAgent||"",ie=(W="WEB",/(micromessenger|webbrowser)/i.test(ae)?W="WEB":z?W="QQ_MP":K?W="TT_MP":$?W="BAIDU_MP":Y?W="ALI_MP":j?W=X?"DONUT_NATIVE_APP":"WX_MP":J?W="UNI_NATIVE_APP":ee?W="NS_NATIVE_APP":te&&(W="RN_NATIVE_APP"),L[W]),se=(X=/iPad/i.test(ae),ee=/iPhone/i.test(ae)&&!X,W=/iPod/i.test(ae),ee||X||W),re=(ee=ae.match(/OS (\d+)_/i))&&ee[1]?ee[1]:null,ce=/Android/i.test(ae),le=(X=ae.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i))?(W=X[1]&&parseFloat(X[1]),ee=X[2]&&parseFloat(X[2]),W&&ee?parseFloat(X[1]+"."+X[2]):W||null):null,ue=(X=!(ee=/Edge/i.test(ae))&&/Chrome/i.test(ae),/MSIE/.test(ae)||-1<ae.indexOf("Trident")&&-1<ae.indexOf("rv:11.0")),de=W=!(W=(W=/MSIE\s(\d+)\.\d/.exec(ae))&&parseFloat(W[1]))&&/Trident\/7.0/i.test(ae)&&/rv:11.0/.test(ae)?11:W,pe=(W=/Safari/i.test(ae)&&!X&&!ce&&!ee,/Windows/i.test(ae)),he=/MAC OS X/i.test(ae),ge=ne&&"undefined"!=typeof Worker&&!ue,me=ce||se,fe=ne&&void 0!==window.tencent_cloud_im_csig_flutter_for_web_25F_cy,ve="undefined"!=typeof window&&void 0!==window.navigator&&(X=window.navigator.standalone,!(!se||X||W)),_e="undefined"!=typeof console?console:void 0!==ja&&ja.console?ja.console:"undefined"!=typeof window&&window.console?window.console:{},ye=function(){},Ie=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],Ee=Ie.length;Ee--;)H=Ie[Ee],console[H]||(_e[H]=ye);function Ce(){var e=new Date;return e.setTime(De()),e}function ke(){Se=0}function Te(){return Math.floor(De()/1e3)}var Me=_e,Se=0,De=function(){return(new Date).getTime()+Se},be=0;function we(){return Ft()?"%c Chat %c":"Chat"}function Ne(){var e=Ce();return e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){var t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())}var Le={arguments2String:function(e){var t="";if(1===e.length)t=e[0];else for(var n=0,o=e.length;n<o;n++){if(dt(e[n]))try{t+=pt(e[n])?JSON.stringify(e[n],["message","code"]):JSON.stringify(e[n])}catch(a){t+=a?a.message:"";break}else t+=e[n];t+=" "}return t},_exec:function(e,t){Ft()?Me[e](we(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",Ne(),t):Me[e]("".concat(we()," ").concat(Ne()," ").concat(t))},d:function(){var e;be<=-1&&(e=this.arguments2String(arguments),this._exec("debug",e))},l:function(){var e;be<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},log:function(){var e;be<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},i:function(){var e;be<=1&&(e=this.arguments2String(arguments),this._exec("info",e))},w:function(){var e;be<=2&&(e=this.arguments2String(arguments),this._exec("warn",e))},e:function(){var e;be<=3&&(e=this.arguments2String(arguments),this._exec("error",e))},setLevel:function(e){e<4&&this._exec("log","set level from "+be+" to "+e),be=e},getLevel:function(){return be}},Re={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},Ae={NICK:"".concat(ee="Tag_Profile_IM_","Nick"),GENDER:"".concat(ee,"Gender"),BIRTHDAY:"".concat(ee,"BirthDay"),LOCATION:"".concat(ee,"Location"),SELFSIGNATURE:"".concat(ee,"SelfSignature"),ALLOWTYPE:"".concat(ee,"AllowType"),LANGUAGE:"".concat(ee,"Language"),AVATAR:"".concat(ee,"Image"),MESSAGESETTINGS:"".concat(ee,"MsgSettings"),ADMINFORBIDTYPE:"".concat(ee,"AdminForbidType"),LEVEL:"".concat(ee,"Level"),ROLE:"".concat(ee,"Role")},Oe={GROUP:"".concat("Tag_SNS_IM_","Group"),REMARK:"".concat("Tag_SNS_IM_","Remark"),ADDSOURCE:"".concat("Tag_SNS_IM_","AddSource"),ADDWORDING:"".concat("Tag_SNS_IM_","Wording"),ADDTIME:"".concat("Tag_SNS_IM_","AddTime")},Ue={UNKNOWN:"".concat(X="Gender_Type_","Unknown"),FEMALE:"".concat(X,"Female"),MALE:"".concat(X,"Male")},Pe={NONE:"".concat("AdminForbid_Type_","None"),SEND_OUT:"".concat("AdminForbid_Type_","SendOut")},Ge={NEED_CONFIRM:"".concat("AllowType_Type_","NeedConfirm"),ALLOW_ANY:"".concat("AllowType_Type_","AllowAny"),DENY_ANY:"".concat("AllowType_Type_","DenyAny")},xe="JoinedSuccess",Be="WaitAdminApproval",Ve="@TOPIC#_",Fe=Object.prototype.hasOwnProperty;function He(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(Ye(e)){for(var t in e)if(Fe.call(e,t))return!1;return!0}return!!(je(e)||qe(e)||ze(e))&&0===e.size}function je(e){return"map"===ht(e)}function qe(e){return"set"===ht(e)}function ze(e){return"file"===ht(e)}function Ke(e){return null!==e&&("number"==typeof e&&!isNaN(+e)||"object"===n(e)&&e.constructor===Number)}function $e(e){return null!==e&&"object"===n(e)}function Ye(e){if("object"===n(e)&&null!==e){if(null===(e=Object.getPrototypeOf(e)))return 1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return e===t}}function We(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===ht(e)}function Je(e){return"function"==typeof e}function Xe(e){return"filelist"===ht(e)}function Ze(e){return"string"==typeof e&&(e=e[0],!/[^a-zA-Z0-9]/.test(e))}function Qe(e,t,n,o){if(!dt(e)||!dt(t))return 0;for(var a,i=0,s=Object.keys(t),r=0,c=s.length;r<c;r++)if(a=s[r],!(ut(t[a])||n&&n.includes(a)))if(dt(e[a])&&dt(t[a]))i+=Qe(e[a],t[a],n,o);else{if(o&&o.includes(t[a]))continue;e[a]!==t[a]&&(e[a]=t[a],i+=1)}return i}function et(e,t){var n,o=new Map,a=T(e.entries());try{for(a.s();!(n=a.n()).done;){var i=f(n.value,2),s=i[0],r=i[1];r&&o.set(s,t?JSON.stringify(r):JSON.parse(JSON.stringify(r)))}}catch(c){a.e(c)}finally{a.f()}return o}function nt(e){if(0===e.length)return 0;for(var t=0,n=0,o="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===o?3:2;return n}function ot(e){return e=e||99999999,Math.round(Math.random()*e)}function at(){for(var e="",t=32;0<t;--t)e+=gt[Math.floor(Math.random()*mt)];return e}function it(e,t){for(var n in e)if(e[n]===t)return 1}function st(e){return-1===e.indexOf("http://")||-1===e.indexOf("https://")?"https://"+e:e.replace(/https|http/,"https")}function rt(e){if(0===Object.getOwnPropertyNames(e).length)return Object.create(null);var t,o,a=Array.isArray(e)?[]:Object.create(null);for(o in e)null!==e[o]?void 0!==e[o]?(t=n(e[o]),0<=["string","number","function","boolean"].indexOf(t)?a[o]=e[o]:a[o]=rt(e[o])):a[o]=void 0:a[o]=null;return a}var ct=["url"],lt=function(e){return"string"==typeof e},ut=function(e){return void 0===e},dt=function(e){return We(e)||$e(e)},pt=function(e){return e instanceof Error},ht=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},gt=(Date.now||(Date.now=function(){return(new Date).getTime()}),"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),mt=gt.length,ft={};function vt(e,t){var n;return!(!We(e)||!We(t))&&(n=!1,t.forEach((function(t){var o=t.key,a=(t=t.value,e.find((function(e){return e.key===o})));a?a.value!==t&&(a.value=t,n=!0):(e.push({key:o,value:t}),n=!0)})),n)}function _t(e){return He(e)?[]:e.filter((function(e){return!0===e.isModified}))}function yt(e){return He(e)?[]:e.filter((function(e){return!1===e.isModified}))}function It(e){return e===S.GRP_AVCHATROOM}function Et(e){var t=e.type;return e=e.groupID,t===S.GRP_COMMUNITY||"".concat(e).startsWith("@TGS#_")&&!"".concat(e).includes(Ve)}function Ct(e){return"".concat(e).startsWith("@TGS#_")&&"".concat(e).includes(Ve)}function kt(e){return lt(e)&&e.slice(0,3)===S.CONV_C2C}function Tt(e){return lt(e)&&e.slice(0,5)===S.CONV_GROUP}function Mt(e){return lt(e)&&e===S.CONV_SYSTEM}function St(e,t){var n={};return Object.keys(e).forEach((function(o){n[o]=t(e[o],o)})),n}function Dt(e){return te?Promise.resolve({width:0,height:0}):Q?new Promise((function(t,n){oe.getImageInfo({src:e,success:function(e){t({width:e.width,height:e.height})},fail:function(){t({width:0,height:0})}})})):ue&&9===de?Promise.resolve({width:0,height:0}):new Promise((function(t,n){var o=new Image;o.onload=function(){t({width:this.width,height:this.height}),o=null},o.onerror=function(){t({width:0,height:0}),o=null},o.src=e}))}function bt(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function wt(){var e=ce?"android":se?"ios":pe?"windows":he?"mac":"unknown";if(Q)try{var t=oe.getSystemInfoSync().platform;void 0!==t&&(e=t)}catch(n){}return e}function Nt(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var o=0;o<n;o++){var a=parseInt(e[o]),i=parseInt(t[o]);if(i<a)return 1;if(a<i)return-1}return 0}function Lt(e){var t=void 0===(t=e.originUrl)?void 0:t,n=e.originWidth,o=e.originHeight,a=(e=void 0===(e=e.min)?198:e,{url:void 0,width:0,height:0});return((n=parseInt(n))<=(o=parseInt(o))?n:o)<=e?(a.url=t,a.width=n,a.height=o):(o<=n?(a.width=Math.ceil(n*e/o),a.height=e):(a.width=e,a.height=Math.ceil(o*e/n)),o=t&&-1<t.indexOf("?")?"".concat(t,"&"):"".concat(t,"?"),a.url="".concat(o,198===e?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")),ut(t)?h(a,ct):a}function Rt(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function At(e){return(e=e.servcmd).slice(e.indexOf(".")+1)}function Ot(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function Ut(e,t){return e.includes(t)}function Pt(e,t){return e.includes(t)}function Gt(e){return e.split(Ve)[0]}var xt=function(e,t,n){if(ut(t))return"";switch(e){case S.MSG_TEXT:return t.text;case S.MSG_IMAGE:return n?"[Image]":"[图片]";case S.MSG_LOCATION:return n?"[Location]":"[位置]";case S.MSG_AUDIO:return n?"[Voice]":"[语音]";case S.MSG_VIDEO:return n?"[Video]":"[视频]";case S.MSG_FILE:return n?"[File]":"[文件]";case S.MSG_CUSTOM:return n?"[Custom Messages]":"[自定义消息]";case S.MSG_GRP_TIP:return n?"[Group Notification]":"[群提示消息]";case S.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[群系统通知]";case S.MSG_FACE:return n?"[Animated Sticker]":"[动画表情]";case S.MSG_MERGER:return n?"[Chat Record]":"[聊天记录]";default:return""}};function Bt(e){return e===S.MSG_TEXT||e===S.MSG_CUSTOM||e===S.MSG_LOCATION||e===S.MSG_FACE}function Vt(e){var t=[];if(lt(e)){var n=e.length;if(0!==n)for(var o=n-1;0<=o;o--)"1"===e[o]&&t.push(Math.pow(2,n-o-1))}return t}function Ft(){return!ue&&!Q}function Ht(e){return"the length of userIDList cannot exceed ".concat(e)}function jt(e){var t;if(We(e)&&0!==e.length)return t=0,e.forEach((function(e){t+=e})),t.toFixed(0)}function qt(e){var t;if(We(e)&&0!==e.length)return t=0,e.forEach((function(e){t+=e})),(t/e.length).toFixed(0)}function zt(e,t,n){t=!(1<arguments.length&&void 0!==t)||t,n=!(2<arguments.length&&void 0!==n)||n;var o=Date.now();return t?n?"".concat(o-e," ms"):"".concat(Math.round((o-e)/1e3)," s"):n?o-e:Math.round((o-e)/1e3)}function Kt(e){return!!(e&&1<e)}function $t(e,t,n,o){var a,i,s;return void 0===t||(a=!0,t.required&&He(e)&&(Le.e("[".concat(n,'] Missing required params: "').concat(o,'".')),a=!1),He(e)||(i=ht(e))===(s=t.type.toLowerCase())||"asyncfunction"===i&&"function"===s||(Le.e("[".concat(n,'] Invalid params: type check failed for "').concat(o,'". Expected ').concat(t.type,".")),a=!1),t.validator&&!t.validator(e,n,o)&&(Le.e("[".concat(n,'] Invalid params: custom validator check failed for "').concat(o,'".')),a=!1),a)}function Yt(e){return!(!e||!(kt(e)||Tt(e)||Mt(e))&&((e=Ln("InvalidConversationID",e))&&Le.w(e),1))}function Wt(e){""!==e.desc&&""!==Ln("API_REFER")&&Le.w("[".concat(e.api,"] | ").concat(e.paramName," | ").concat(e.desc,", ").concat(Ln("API_REFER")).concat(e.api))}function Jt(){return Ln("StringRequiredLog")}function Xt(e){return Ln("NonEmptyStringRequiredLog",e)}function Zt(){return Ln("NumberRequiredLog")}function Qt(){return Ln("UndefinedNotAllowedLog")}function en(){return Ln("FileRequiredLog")}function tn(){return Ln("FunctionRequiredLog")}function nn(){return Ln("ArrayRequiredLog")}function on(){return Ln("NonEmptyArrayLog")}function an(){return Ln("CallbackMissingLog")}function sn(){return Ln("PositiveIntegerRequiredLog")}function rn(e,t){return Ln("StringNotLongerThanLog",e,t)}function cn(e,t){return Ln("NumberGreaterOrEqualLog",e,t)}function ln(e){return Ln("KeyValueStringRequiredLog",e)}function un(){return Ln("PlainObjectRequiredLog")}function dn(){return Ln("NonEmptyContentRequiredLog")}function pn(){return Ln("FileNotSelectedLog")}function hn(){return Ln("MessageInstanceRequiredLog")}function gn(){return Ln("NonAnonymousFunctionLog")}function mn(){return Ln("MessageExtensionNotAvailableLog")}function fn(){return Ln("MessageReactionRequiredLog")}function vn(e,t){return Ln("MaximumArrayLengthLog",e,t)}function _n(e){return{code:0,data:e||{}}}function yn(e){return Promise.resolve(_n(e))}function In(e){var t,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return e instanceof On?(n&&null!==Pn&&Pn.emit(M.ERROR,e),Promise.reject(e)):e instanceof Error?(t=new On({code:Un.UNCAUGHT_ERROR}),n&&null!==Pn&&Pn.emit(M.ERROR,t),Promise.reject(t)):ut(e)||ut(e.code)?Promise.reject(new On({code:Un.UNCAUGHT_ERROR})):(t=new On(e),n&&null!==Pn&&Pn.emit(M.ERROR,t),Promise.reject(t))}var En,Cn="unSend",kn="success",Tn="fail",Mn="notStart",Sn="pending",Dn="resolved",bn="rejected",wn={type:"Boolean",required:!0},Nn={type:"number",required:!0},Ln=null,Rn={hookGetAPITips:function(e){Ln=e},login:{userID:W={type:"String",required:!0},userSig:W},addToBlacklist:{userIDList:ee={type:"Array",required:!0}},removeFromBlacklist:{userIDList:ee},on:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:Xt(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:tn()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:Xt(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:tn()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:Xt(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:tn()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],sendMessage:[t({name:"message"},X={type:"Object",required:!0})],setMessageExtensions:[t(t({name:"message"},X),{},{validator:function(e,t,n){return e.status===kn&&!0===e.isSupportExtension||(Wt({api:t,paramName:n,desc:mn()}),!1)}}),t({name:"extensions"},ee)],getMessageExtensions:[t(t({name:"message"},X),{},{validator:function(e,t,n){return e.status===kn&&!0===e.isSupportExtension||(Wt({api:t,paramName:n,desc:mn()}),!1)}})],deleteMessageExtensions:[t(t({name:"message"},X),{},{validator:function(e,t,n){return e.status===kn&&!0===e.isSupportExtension||(Wt({api:t,paramName:n,desc:mn()}),!1)}})],addMessageReaction:[t(t({name:"message"},X),{},{validator:function(e,t,n){return e.status===kn||(Wt({api:t,paramName:n,desc:fn()}),!1)}}),t({name:"reactionID"},W)],removeMessageReaction:[t(t({name:"message"},X),{},{validator:function(e,t,n){return e.status===kn||(Wt({api:t,paramName:n,desc:fn()}),!1)}}),t({name:"reactionID"},W)],getMessageReactions:{messageList:t({},ee)},getAllUserListOfMessageReaction:{message:t(t({},X),{},{validator:function(e,t,n){return e.status===kn||(Wt({api:t,paramName:n,desc:fn()}),!1)}}),reactionID:t({},W),nextSeq:{type:"Number"},count:{type:"Number"}},getMessageList:{conversationID:t(t({},W),{},{validator:Yt}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e,t,n){return!(!ut(e)&&!/^[1-9][0-9]*$/.test(e)&&(Wt({api:t,paramName:n,desc:sn()}),1))}}},getMessageListHopping:{conversationID:t(t({},W),{},{validator:Yt}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e,t,n){return!(!ut(e)&&0!==e&&1!==e&&(Wt({api:t,paramName:n,desc:Ln("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(e,t,n){return!(!ut(e)&&!/^[1-9][0-9]*$/.test(e)&&(Wt({api:t,paramName:n,desc:sn}),1))}}},setMessageRead:{conversationID:t(t({},W),{},{validator:Yt})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e,t,n){return!e||-1!==[S.READ_ALL_C2C_MSG,S.READ_ALL_GROUP_MSG,S.READ_ALL_MSG].indexOf(e)||(Wt({api:t,paramName:n,desc:Ln("ValidScopeRequired")}),!1)}}},getConversationProfile:[t(t({name:"conversationID"},W),{},{validator:Yt})],clearHistoryMessage:[t(t({name:"conversationID"},W),{},{validator:Yt})],pinConversation:{conversationID:t(t({},W),{},{validator:Yt}),isPinned:t({},wn)},setConversationDraft:{conversationID:t(t({},W),{},{validator:Yt}),draftText:{type:"String",validator:function(e,t,n){return!!lt(e)||(Wt({api:t,paramName:n,desc:Jt()}),!1)}}},setConversationCustomData:{conversationIDList:t({},ee),customData:{type:"String",validator:function(e,t,n){return lt(e)?!(256<e.length&&(Wt({api:t,paramName:n,desc:rn(n,256)}),1)):(Wt({api:t,paramName:n,desc:Jt()}),!1)}}},markConversation:{conversationIDList:t({},ee),markType:{type:"number",validator:function(e,t,n){return Ke(e)?e<=0?(Wt({api:t,paramName:n,desc:Ln("NumberGreaterThanLog",n,0)}),!1):!(e>=Math.pow(2,64)&&(Wt({api:t,paramName:n,desc:Ln("NumberLessThanLog",n,"Math.pow(2,64)")}),1)):(Wt({api:t,paramName:n,desc:Zt()}),!1)}},enableMark:t({},wn)},createConversationGroup:{conversationIDList:t({},ee),groupName:t(t({},W),{},{validator:function(e,t,n){return!(!e||32<e.length&&(Wt({api:t,paramName:n,desc:rn(n,32)}),1))}})},deleteConversationGroup:[t({name:"groupName"},W)],renameConversationGroup:{oldName:t({},W),newName:t(t({},W),{},{validator:function(e,t,n){return!(!e||32<e.length&&(Wt({api:t,paramName:n,desc:rn(n,32)}),1))}})},addConversationsToGroup:{conversationIDList:t({},ee),groupName:t({},W)},deleteConversationsFromGroup:{conversationIDList:t({},ee),groupName:t({},W)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:W,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:ee},createGroup:{name:W},joinGroup:{groupID:W,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[t({name:"groupID"},W)],handleApplication:{message:X,handleAction:W,handleMessage:{type:"String"}},changeGroupOwner:{groupID:W,newOwnerID:W},updateGroupProfile:{groupID:W,muteAllMembers:{type:"Boolean"}},dismissGroup:[t({name:"groupID"},W)],searchGroupByID:[t({name:"groupID"},W)],getGroupOnlineMemberCount:[t({name:"groupID"},W)],initGroupAttributes:{groupID:W,groupAttributes:t(t({},X),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach((function(a){if(!lt(e[a]))return Wt({api:t,paramName:n,desc:ln("value")}),o=!1})),o}})},setGroupAttributes:{groupID:W,groupAttributes:t(t({},X),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach((function(a){if(!lt(e[a]))return Wt({api:t,paramName:n,desc:ln("value")}),o=!1})),o}})},deleteGroupAttributes:{groupID:W,keyList:{type:"Array",validator:function(e,t,n){var o;return ut(e)||!We(e)?(Wt({api:t,paramName:n,desc:nn()}),!1):!!He(e)||(o=!0,e.forEach((function(e){if(!lt(e))return Wt({api:t,paramName:n,desc:Ln("StringArrayRequiredLog")}),o=!1})),o)}}},getGroupAttributes:{groupID:W,keyList:{type:"Array",validator:function(e,t,n){var o;return ut(e)||!We(e)?(Wt({api:t,paramName:n,desc:nn()}),!1):!!He(e)||(o=!0,e.forEach((function(e){if(!lt(e))return Wt({api:t,paramName:n,desc:ln("key")}),o=!1})),o)}}},setGroupCounters:{groupID:W,counters:X},increaseGroupCounter:{groupID:W,key:W,value:Nn},decreaseGroupCounter:{groupID:W,key:W,value:Nn},getGroupCounters:{groupID:W},getGroupMemberList:{groupID:W,count:{type:"Number"}},getGroupMemberProfile:{groupID:W,userIDList:ee,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:W,userIDList:ee},setGroupMemberRole:{groupID:W,userID:W,role:W},setGroupMemberMuteTime:{groupID:W,userID:W,muteTime:{type:"Number",validator:function(e){return 0<=e}}},setGroupMemberNameCard:{groupID:W,userID:{type:"String"},nameCard:{type:"String",validator:function(e,t,n){return lt(e)?(e.length,!0):(Wt({api:t,paramName:n,desc:Jt()}),!1)}}},setGroupMemberCustomField:{groupID:W,userID:{type:"String"},memberCustomField:ee},deleteGroupMember:{groupID:W},markGroupMemberList:{groupID:W,markType:{type:"number",validator:function(e,t,n){return Ke(e)?!(e<1e3&&(Wt({api:t,paramName:n,desc:cn(n,1e3)}),1)):(Wt({api:t,paramName:n,desc:Zt()}),!1)}},userIDList:t({},ee),enableMark:t({},wn)},createTextMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){return Ye(e)?lt(e.text)?0!==e.text.length||(Wt({api:t,paramName:"payload.text",desc:dn()}),!1):(Wt({api:t,paramName:"payload.text",desc:Jt()}),!1):(Wt({api:t,paramName:n,desc:un()}),!1)}})},createTextAtMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){return Ye(e)?lt(e.text)?0===e.text.length?(Wt({api:t,paramName:"payload.text",desc:dn()}),!1):!(e.atUserList&&!We(e.atUserList)&&(Wt({api:t,paramName:"payload.atUserList",desc:nn()}),1)):(Wt({api:t,paramName:"payload.text",desc:Jt()}),!1):(Wt({api:t,paramName:n,desc:un()}),!1)}})},createCustomMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){return Ye(e)?e.data&&!lt(e.data)?(Wt({api:t,paramName:"payload.data",desc:Jt()}),!1):e.description&&!lt(e.description)?(Wt({api:t,paramName:"payload.description",desc:Jt()}),!1):!(e.extension&&!lt(e.extension)&&(Wt({api:t,paramName:"payload.extension",desc:Jt()}),1)):(Wt({api:t,paramName:"payload",desc:un()}),!1)}})},createImageMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){if(!Ye(e))return Wt({api:t,paramName:n,desc:un()}),!1;if(ut(e.file))return Wt({api:t,paramName:"payload.file",desc:Qt()}),!1;if(ne){if(!(e.file instanceof HTMLInputElement||ze(e.file)))return Ye(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(Wt({api:t,paramName:"payload.file",desc:pn()}),!1):(Wt({api:t,paramName:"payload.file",desc:en()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Wt({api:t,paramName:"payload.file",desc:pn()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:an()}),!0}}})},createAudioMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){return!!Ye(e)||(Wt({api:t,paramName:n,desc:un()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:an()}),!0}}},createVideoMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){if(!Ye(e))return Wt({api:t,paramName:n,desc:un()}),!1;if(ut(e.file))return Wt({api:t,paramName:"payload.file",desc:Qt()}),!1;if(ne){if(!(e.file instanceof HTMLInputElement||ze(e.file)))return Ye(e.file)&&"undefined"!=typeof uni?!!ze(e.file.tempFile)||(Wt({api:t,paramName:"payload.file",desc:pn()}),!1):(Wt({api:t,paramName:"payload.file",desc:en()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Wt({api:t,paramName:"payload.file",desc:pn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:an()}),!0}}},createFaceMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){return Ye(e)?Ke(e.index)?!!lt(e.data)||(Wt({api:t,paramName:"payload.data",desc:Jt()}),!1):(Wt({api:t,paramName:"payload.index",desc:Zt()}),!1):(Wt({api:t,paramName:n,desc:un()}),!1)}})},createFileMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){if(!Ye(e))return Wt({api:t,paramName:n,desc:un()}),!1;if(ut(e.file))return Wt({api:t,paramName:"payload.file",desc:Qt()}),!1;if(ne){if(!(e.file instanceof HTMLInputElement||ze(e.file)))return Ye(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(Wt({api:t,paramName:"payload.file",desc:pn()}),!1):(Wt({api:t,paramName:"payload.file",desc:en()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Wt({api:t,paramName:"payload.file",desc:pn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:an()}),!0}}},createLocationMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){return Ye(e)?lt(e.description)?Ke(e.longitude)?!!Ke(e.latitude)||(Wt({api:t,paramName:"payload.latitude",desc:Zt()}),!1):(Wt({api:t,paramName:"payload.longitude",desc:Zt()}),!1):(Wt({api:t,paramName:"payload.description",desc:Jt()}),!1):(Wt({api:t,paramName:n,desc:un()}),!1)}})},createMergerMessage:{to:W,conversationType:W,payload:t(t({},X),{},{validator:function(e,t,n){var o;return He(e.messageList)?(Wt({api:t,paramName:"payload.messageList",desc:on()}),!1):He(e.compatibleText)?(Wt({api:t,paramName:"payload.compatibleText",desc:Xt("compatibleText")}),!1):(o=!1,e.messageList.forEach((function(e){e.status===Tn&&(o=!0)})),!o||(Wt({api:t,paramName:"payload.messageList",desc:Ln("MergeFailedMessageLog")}),!1))}})},revokeMessage:[t(t({name:"message"},X),{},{validator:function(e,t,n){return He(e)?(Wt({api:t,paramName:n,desc:hn()}),!1):e.conversationType===S.CONV_SYSTEM?(Wt({api:t,paramName:n,desc:Ln("MessageCanBeRevokedDesc")}),!1):!0!==e.isRevoked||(Wt({api:t,paramName:n,desc:Ln("MessageRevokedLog")}),!1)}})],deleteMessage:[t(t({name:"messageList"},ee),{},{validator:function(e,t,n){return!He(e)||(Wt({api:t,paramName:n,desc:on()}),!1)}})],translateText:{sourceTextList:ee,sourceLanguage:W,targetLanguage:W},convertVoiceToText:{message:t(t({},X),{},{validator:function(e,t,n){return He(e)?(Wt({api:t,paramName:n,desc:hn()}),!1):e.type===S.MSG_AUDIO&&e.status===kn||(Wt({api:t,paramName:n,desc:Ln("AudioMessageRequiredLog")}),!1)}})},modifyMessage:[t(t({name:"message"},X),{},{validator:function(e,t,n){return He(e)?(Wt({api:t,paramName:n,desc:hn()}),!1):e.conversationType===S.CONV_SYSTEM?(Wt({api:t,paramName:n,desc:Ln("MessageCanBeModifiedLog")}),!1):!0!==e._onlineOnlyFlag||(Wt({api:t,paramName:n,desc:Ln("OnlineMessageNotSupportLog")}),!1)}})],searchCloudMessages:{keywordList:{type:"Array",required:!1,validator:function(e,t,n){return!(e&&(We(e)?0===e.length?(Wt({api:t,paramName:n,desc:on()}),1):5<e.length&&(Wt({api:t,paramName:n,desc:vn(n,5)}),1):(Wt({api:t,paramName:n,desc:nn()}),1)))}},keywordListMatchType:{type:"String",required:!1,validator:function(e,t,n){return!e||"or"===e||"and"===e||Wt({api:t,paramName:n,desc:"".concat(e," is invalid match type")})}},senderUserIDList:{type:"Array",required:!1,validator:function(e,t,n){return!(e&&(We(e)?(0===e.length&&Wt({api:t,paramName:n,desc:on()}),5<e.length&&(Wt({api:t,paramName:n,desc:vn(n,5)}),1)):(Wt({api:t,paramName:n,desc:nn()}),1)))}},messageTypeList:{type:"Array",required:!1,validator:function(e,t,n){if(!e)return!0;if(!We(e))return Wt({api:t,paramName:n,desc:nn()}),!1;0===e.length&&Wt({api:t,paramName:n,desc:on()});var o=[S.MSG_TEXT,S.MSG_IMAGE,S.MSG_AUDIO,S.MSG_FILE,S.MSG_VIDEO,S.MSG_LOCATION,S.MSG_CUSTOM,S.MSG_MERGER];return!(0<e.filter((function(e){return-1===o.indexOf(e)})).length&&(Wt({api:t,paramName:n,desc:Ln("ContainsUnsupportedMessageTypeLog",n)}),1))}},conversationID:{type:"String",required:!1,validator:function(e){return!e||Yt(e)}},timePosition:{type:"number",required:!1,validator:function(e,t,n){return!(e&&e<0&&(Wt({api:t,paramName:n,desc:cn(n,0)}),1))}},timePeriod:{type:"number",required:!1,validator:function(e,t,n){return!(e&&e<0&&(Wt({api:t,paramName:n,desc:cn(n,0)}),1))}},cursor:{type:"String",required:!1}},getUserProfile:{userIDList:{type:"Array",validator:function(e,t,n){return We(e)?(0===e.length&&Wt({api:t,paramName:n,desc:on()}),!0):(Wt({api:t,paramName:n,desc:nn()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e,t,n){return!!ut(e)||!!We(e)||(Wt({api:t,paramName:n,desc:nn()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e,t,n){return!!lt(e)||(Wt({api:t,paramName:n,desc:Jt()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return We(e)?0!==e.length||(Wt({api:t,paramName:n,desc:on()}),!1):(Wt({api:t,paramName:n,desc:nn()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return We(e)?0!==e.length||(Wt({api:t,paramName:n,desc:on()}),!1):(Wt({api:t,paramName:n,desc:nn()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return!e||!!We(e)||(Wt({api:t,paramName:n,desc:nn()}),!1)}}},addFriend:{to:W,source:{type:"String",required:!0,validator:function(e,t,n){return!(!e||(e.startsWith("AddSource_Type_")?8<e.replace("AddSource_Type_","").length&&(Wt({api:t,paramName:n,desc:rn("keyword",8)}),1):(Wt({api:t,paramName:n,desc:Ln("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(e,t,n){return!(lt(e)&&96<e.length&&(Wt({api:t,paramName:n,desc:rn(n,96)}),1))}}},deleteFriend:{userIDList:ee},checkFriend:{userIDList:ee},getFriendProfile:{userIDList:ee},updateFriend:{userID:W,remark:{type:"String",required:!1,validator:function(e,t,n){return!(lt(e)&&96<e.length&&(Wt({api:t,paramName:n,desc:rn(n,96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(e,t,n){var o;return!e||(We(e)?(o=!0,e.forEach((function(e){return lt(e.key)&&-1!==e.key.indexOf("Tag_SNS_Custom")?lt(e.value)?8<e.key.replace("Tag_SNS_Custom_","").length?(Wt({api:t,paramName:n,desc:rn("keyword",8)}),o=!1):void 0:(Wt({api:t,paramName:n,desc:ln("value")}),o=!1):(Wt({api:t,paramName:n,desc:Ln("FriendCustomFieldPrefixLog")}),o=!1)})),o):(Wt({api:t,paramName:n,desc:nn()}),!1))}}},acceptFriendApplication:{userID:W},refuseFriendApplication:{userID:W},deleteFriendApplication:{userID:W},createFriendGroup:{name:W},deleteFriendGroup:{name:W},addToFriendGroup:{name:W,userIDList:ee},removeFromFriendGroup:{name:W,userIDList:ee},renameFriendGroup:{oldName:W,newName:W},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e,t,n){return We(e)?0!==e.length||(Wt({api:t,paramName:n,desc:on()}),!1):(Wt({api:t,paramName:n,desc:nn()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e,t,n){return We(e)?0!==e.length||(Wt({api:t,paramName:n,desc:on()}),!1):(Wt({api:t,paramName:n,desc:nn()}),!1)}}],createTopicInCommunity:{groupID:W,topicName:W},deleteTopicFromCommunity:{groupID:W,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!We(e)||(Wt({api:t,paramName:n,desc:nn()}),!1)}}},updateTopicProfile:{groupID:W,topicID:W},getTopicList:{groupID:W,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!We(e)||(Wt({api:t,paramName:n,desc:nn()}),!1)}}},followUser:[t({name:"userIDList"},ee)],unfollowUser:[t({name:"userIDList"},ee)],getMyFollowingList:[t(t({name:"startIndex"},W),{},{required:!1})],getMyFollowersList:[t(t({name:"startIndex"},W),{},{required:!1})],getMutualFollowersList:[t(t({name:"startIndex"},W),{},{required:!1})],getUserFollowInfo:[t(t({name:"userIDList"},ee),{},{required:!1})],checkFollowType:[t({name:"userIDList"},ee)],addSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:Xt(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:tn()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],removeSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:Xt(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:tn()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],invite:{userID:W},inviteSync:[t(t({},X),{},{validator:function(e,t,n){return Ye(e)?!!lt(e.userID)||(Wt({api:t,paramName:"options.userID",desc:Jt()}),!1):(Wt({api:t,paramName:"options",desc:un()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:tn()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:tn()}),!0}}],inviteInGroup:{groupID:W,inviteeList:ee},inviteInGroupSync:[t(t({},X),{},{validator:function(e,t,n){return Ye(e)?lt(e.groupID)?!!We(e.inviteeList)||(Wt({api:t,paramName:"options.inviteeList",desc:nn()}),!1):(Wt({api:t,paramName:"options.groupID",desc:Jt()}),!1):(Wt({api:t,paramName:"options",desc:un()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:tn()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:tn()}),!0}}],accept:{inviteID:W},reject:{inviteID:W},getSignalingInfo:[t(t({name:"message"},X),{},{validator:function(e,t,n){return!He(e)||(Wt({api:t,paramName:n,desc:hn()}),!1)}})],modifyInvitation:{inviteID:W,data:W}},An={login:1,logout:1,getLoginUser:1,getServerTime:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,isReady:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,convertVoiceToText:1,modifyMessage:1,searchCloudMessages:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,addMessageReaction:1,removeMessageReaction:1,getMessageReactions:1,getAllUserListOfMessageReaction:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,setConversationDraft:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,setMessageRemindType:1,setAllReceiveMessageOpt:1,getAllReceiveMessageOpt:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,followUser:1,unfollowUser:1,getMyFollowingList:1,getMyFollowersList:1,getMutualFollowersList:1,getUserFollowInfo:1,checkFollowType:1,callExperimentalAPI:1,addSignalingListener:1,removeSignalingListener:1,invite:1,inviteSync:1,inviteInGroup:1,inviteInGroupSync:1,cancel:1,accept:1,reject:1,getSignalingInfo:1,modifyInvitation:1},On=(r(oo,p(Error)),En=m(oo),i(oo)),Un={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MSG_SEND_FAIL:2100,MSG_SEND_FAIL_NOT_IN_AV:2101,MSG_INSTANCE_REQUIRED:2105,MSG_INVALID_CONV_TYPE:2106,MSG_F_IS_EMPTY:2108,MSG_ONPROGRESS_ERR:2109,MSG_REVOKE_FAIL:2110,MSG_DELETE_FAIL:2111,MSG_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MSG_LIST_EMPTY:2114,MSG_SEND_GRP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GRP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,VOICE_TO_TEXT_FAIL:2118,UNSUPPORTED_VOICE_FORMAT:2119,MSG_I_SELECT_F_FIRST:2251,MSG_I_TYPES_LIMIT:2252,MSG_I_SIZE_LIMIT:2253,MSG_A_UPLOAD_FAIL:2300,MSG_A_SIZE_LIMIT:2301,MSG_V_UPLOAD_FAIL:2350,MSG_V_SIZE_LIMIT:2351,MSG_V_TYPES_LIMIT:2352,MSG_F_UPLOAD_FAIL:2400,MSG_F_SELECT_F_FIRST:2401,MSG_F_SIZE_LIMIT:2402,MSG_F_URL_IS_EMPTY:2403,MSG_MERGER_TYPE_INVALID:2450,MSG_MERGER_KEY_INVALID:2451,MSG_MERGER_DOWNLOAD_FAIL:2452,MSG_FORWARD_TYPE_INVALID:2453,MSG_FORWARD_INVALID_ELEMENTS:2454,MSG_MODIFY_CONFLICT:2480,MSG_MODIFY_DISABLED_IN_AV:2481,CONV_NOT_FOUND:2500,USER_OR_GRP_NOT_FOUND:2501,CONV_UN_RECORDED_TYPE:2502,INVALID_CONV_ID:2503,ILLEGAL_GRP_TYPE:2600,ILLEGAL_GRP_ID:2602,CANNOT_FIND_GRP:2603,CANNOT_CHANGE_OWNER_IN_AV:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,MEMBER_NOT_IN_GRP:2623,JOIN_GRP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AV:2661,CANNOT_JOIN_NON_AV_WITHOUT_LOGIN:2662,NOT_OWNER:2681,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,OPERATION_NOT_SUPPORTED_IN_AV:2687,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GRP_EXISTED:2710,FRIEND_GRP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,INVALID_TRTC_CMD:2995,OVER_FREQUENCY_LIMIT:2996,NO_PROTOCOL:2997,NO_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,NO_USE:3122,PROFANITY_FOUND:3123,OPTIONS_IS_EMPTY:3153,MSG_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022,SIGNALING_INVALID_INVITE_ID:8010,SIGNALING_NO_PERMISSION:8011,SIGNALING_ALREADY_EXISTS:8012,INVALID_CANCEL_MESSAGE:8020,MSG_SEARCH_CURSOR_INVALID:27002,MSG_SEARCH_CURSOR_EXPIRED:27003},Pn=null,Gn=(i(no,[{key:"isLoggedIn",value:function(){return this._m.get(12).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.get(12).isOversea()}},{key:"isPrivateNetWork",value:function(){var e=this._m.get(12);return e.isPrivateNetWork()&&!e.getFileDownloadProxy()}},{key:"getFileDownloadProxy",value:function(){return this._m.get(12).getFileDownloadProxy()}},{key:"getDowloadFileAuthKey",value:function(){return this._m.get(12).getDowloadFileAuthKey()}},{key:"getMyUserID",value:function(){return this._m.get(12).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.get(12).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.get(12).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.get(12).isIntl()}},{key:"isUsingChatCore",value:function(){return this._m.get(12).isUsingChatCore()}},{key:"isDevMode",value:function(){return this._m.get(12).isDevMode()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"getPlatform",value:function(){return ie}},{key:"getCloudConfig",value:function(e){return this._m.get(23).getCloudConfig(e)}},{key:"emitOEvt",value:function(e,t){this._m.getOEmitInst().emit(e,t)}},{key:"emitIEvt",value:function(e,t){this._m.getIEmitInst().emit(e,t)}},{key:"getIEmitInst",value:function(){return this._m.getIEmitInst()}},{key:"req",value:function(e){return this._m.get(20).req(e)}},{key:"canIUse",value:function(e){return this._m.get(27).canIUse(e)}},{key:"getErrMsg",value:function(e,t,n){return this._m.getErrMsg(e,t,n)}},{key:"warn",value:function(e,t,n){(e=this.getErrMsg(e,t,n))&&Le.w(e)}},{key:"noUse",value:function(e){var t=Un.NO_USE;return In({code:t,message:this.getErrMsg(t,e)})}}]),Nn=no,{LOGIN:"wslogin",LOGOUT:"wslogout",HELLO:"wshello",KICK_OTHER:"KickOther",SYNC_UNREAD_MSG:"getmsg",SEND_C2C_MSG:"sendmsg",SEND_GRP_MSG:"send_group_msg",GET_USER_PROFILE:"portrait_get_all",UPDATE_MY_PROFILE:"portrait_set",GET_BL:"black_list_get",ADD_TO_BL:"black_list_add",RM_FROM_BL:"black_list_delete",GET_FD_LIST:"friend_get",GET_FD_PROFILE:"friend_get_specified",CHECK_FD:"friend_check",DEL_FD:"friend_delete",ADD_FD:"friend_add",UPDATE_FD:"friend_update",RESPOND_FD_APPLICATION:"friend_response",GET_FD_APPLICATION_LIST:"pendency_get",DEL_FD_APPLICATION:"pendency_delete",REFUSE_FD_APPLICATION:"pendency_refuse",REPORT_FD_APPLICATION:"pendency_report",GET_FD_GRP_LIST:"group_get",CREATE_FD_GRP:"group_add",DEL_FD_GRP:"group_delete",UPDATE_FD_GRP:"group_update",REVOKE_C2C_MSG:"msgwithdraw",SET_C2C_MSG_READ:"msgreaded",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_C2C_ROAMING_MSG:"getroammsg",GET_C2C_PEER_READ_TIME:"get_peer_read_time",DEL_C2C_MSG:"delete_c2c_msg_ramble",MODIFY_C2C_MSG:"modify_c2c_msg",MODIFY_C2C_MSG_EXT:"set_key_values",GET_C2C_MSG_EXT:"get_key_values",ADD_C2C_MSG_REACTION:"reaction_add",RM_C2C_MSG_REACTION:"reaction_del",GET_C2C_MSG_REACTIONS:"reaction_multi_stat",GET_C2C_MSG_REACTION_USER_LIST:"reaction_iterate",PAGING_GET_CONV_LIST:"page_get",DEL_CONV:"batch_delete",CLEAR_HISTORY_MSG:"clear_msg",PIN_CONV:"top",DEL_GROUP_AT_TIPS:"deletemsg",SET_CONV_CUSTOM_DATA:"set_conv_custom_data",MARK_CONV:"mark_contact",CREATE_CONV_GRP:"create_contact_group",DEL_CONV_GRP:"del_contact_group",RENAME_CONV_GRP:"update_contact_group",ADD_CONV_TO_GRP:"add_conv_to_group",DEL_CONV_FROM_GRP:"del_conv_from_group",GET_CONV_GRP_LIST:"get_contact_group",SEARCH_CONV_GRP_MARK:"search_contact_group",GET_GRP_LIST:"get_joined_group_list",GET_GRP_PROFILE:"get_group_self_member_info",CREATE_GRP:"create_group",DISMISS_GRP:"destroy_group",UPDATE_GRP_PROFILE:"modify_group_base_info",APPLY_JOIN_GRP:"apply_join_group",APPLY_JOIN_GRP_NOAUTH:"apply_join_group_noauth",QUIT_GRP:"quit_group",SEARCH_GRP:"get_group_public_info",CHANGE_GRP_OWNER:"change_group_owner",HANDLE_GRP_APPLICATION:"handle_apply_join_group",HANDLE_INVITE_JOIN_GRP:"handle_invite_join_permission_group",HANDLE_GRP_INVITATION:"handle_invite_join_group",REVOKE_GRP_MSG:"group_msg_recall",SET_GRP_MSG_READ:"msg_read_report",SET_ALL_MSG_READ:"read_all_unread_msg",GET_GRP_ROAMING_MSG:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",GET_GRP_PENDENCY:"get_pendency",DEL_GRP_SYSTEM_NOTICE:"deletemsg",AV_POLLING:"get_msg",AV_NOAUTH_POLLING:"get_msg_noauth",GET_ONLINE_MBR_NUM:"get_online_member_num",DEL_GRP_MSG:"delete_group_ramble_msg_by_seq",MODIFY_GRP_MSG:"modify_group_msg",SET_GRP_ATTR:"set_group_attr",MODIFY_GRP_ATTR:"modify_group_attr",DEL_GRP_ATTR:"delete_group_attr",CLEAR_GRP_ATTR:"clear_group_attr",GET_GRP_ATTR:"get_group_attr",MODIFY_GRP_MSG_EXT:"group_set_key_values",GET_GRP_MSG_EXT:"group_get_key_values",GET_GRP_NOTIFY:"batch_get_group_notify",UPDATE_GRP_COUNTER:"update_group_counter",GET_GRP_COUNTER:"get_group_counter",ADD_GRP_MSG_REACTION:"group_reaction_add",RM_GRP_MSG_REACTION:"group_reaction_del",GET_GRP_MSG_REACTIONS:"group_reaction_multi_stat",GET_GRP_MSG_REACTION_USER_LIST:"group_reaction_iterate",GET_GRP_MBR_LIST:"get_group_member_info",GET_AV_MBR_LIST:"get_members",GET_GRP_MBR_PROFILE:"get_specified_group_member_info",ADD_GRP_MBR:"add_group_member",DEL_GRP_MBR:"delete_group_member",BAN_AV_MBR:"ban_group_member",MODIFY_GRP_MBR_INFO:"modify_group_member_info",MARK_AV_MBR_INFO:"modify_user_info",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",SIMPLE_COS_PRE_SIG:"simple_sig",GET_IMAGE_INFO:"get_imageinfo",GET_IP:"get_final_ip",VIDEO_COVER:"video_cover",SSO_STAT:"tim_web_report_v2",PING:"alive",MSG_PUSH:"msg_push",MSG_CLOUD_SEARCH:"query",MULTI_MSG_PUSH:"multi_msg_push_ws",MSG_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",UPLOAD_MERGER_MSG:"save_relay_json_msg",DOWNLOAD_MERGER_MSG:"get_relay_json_msg",FETCH_CLOUD_CTRL_CONFIG:"fetch_config",PUSHED_CLOUD_CTRL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",OVERLOAD_NOTIFY:"notify2",CREATE_TOPIC:"create_topic",DEL_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUB_USER_STATUS:"ws_status_subscribe",UNSUB_USER_STATUS:"ws_status_unsubscribe",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PUSH_REPORT:"uniapp_sdk_report",GET_PROFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",VOICE_TO_TEXT:"ws_sentence_recognition",FOLLOW:"follow_add",UNFOLLOW:"follow_delete",GET_FOLLOW:"follow_get",GET_FOLLOW_INFO:"follow_get_info",CHECK_FOLLOW_TYPE:"follow_check",SET_ALL_RECEIVE_MSG_OPT:"ws_set_do_not_disturb",GET_ALL_RECEIVE_MSG_OPT:"ws_get_do_not_disturb"}),xn="networkRTT",Bn="messageE2EDelay",Vn="sendMessageC2C",Fn="sendMessageGroup",Hn="sendMessageGroupAV",jn="sendMessageRichMedia",qn="cosUpload",zn="messageReceivedGroup",Kn="messageReceivedGroupAVPush",$n="messageReceivedGroupAVPull",Yn=(s(wn={},xn,2),s(wn,Bn,3),s(wn,Vn,4),s(wn,Fn,5),s(wn,Hn,6),s(wn,jn,7),s(wn,zn,8),s(wn,Kn,9),s(wn,$n,10),s(wn,qn,11),wn),Wn={info:4,warning:5,error:6},Jn={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},Xn={login:4,plugin_search:16,plugin_translate:16,plugin_voice_to_text:16,plugin_cs:16,plugin_push:16,plugin_bot:16,plugin_emoji_reaction:16},Zn=(i(to,[{key:"updateTimeStamp",value:function(){this.timestamp=De()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e,t=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._sentFlag||(this._netMonitorModule&&(e=this._netMonitorModule.getNetworkType(),this.setNetworkType(e)),e=De(),0===this.costTime&&(this.costTime=e-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(e)),n?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout((function(){t._sentFlag=!0,t._eventStatModule&&t._eventStatModule.pushIn(t)}),0))}},{key:"setError",value:function(e){var t;return e instanceof Error?this._sentFlag||(t=!0,(t=this._netMonitorModule?this._netMonitorModule.isOnline():t)?(e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message)):this.setCode(Un.NO_NETWORK),this.setLevel("error")):Le.w("".concat(this._n,".setError value not instanceof Error, please check!")),this}},{key:"setCode",value:function(e){return ut(e)||this._sentFlag||("ECONNABORTED"===e&&(this.code=103),Ke(e)?this.code=e:Le.w("".concat(this._n,".setCode value not a number, please check!"),e,n(e))),this}},{key:"setMessage",value:function(e){return ut(e)||this._sentFlag||(Ke(e)&&(this.message=e.toString()),lt(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return ut(e)||this._sentFlag||(this.level=Wn[e]),this}},{key:"setMoreMessage",value:function(e){return He(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){return ut(e)?Le.w("".concat(this._n,".setNetworkType value is undefined, please check!")):(e=Jn[e.toLowerCase()],ut(e)||(this.networkType=e)),this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){return this.uiPlatform=e,this}},{key:"setExtension",value:function(e){return this.extension=e,this}},{key:"setEventType",value:function(e){return this.eventType=e,this}}],[{key:"bindEventStatModule",value:function(e){to.prototype._eventStatModule=e}},{key:"bindNetMonitorModule",value:function(e){to.prototype._netMonitorModule=e}}]),to),Qn=(i(eo,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return 0!==this.content.text.length}}]),eo);function eo(e){o(this,eo),this.type=S.MSG_TEXT,this.content={text:e.text||""}}function to(e){o(this,to),this._n="SSOLogData",this.eventType=Xn[e]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=e,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=De()}function no(e){o(this,no),this._m=e,this._n=""}function oo(e){o(this,oo),t=En.call(this);var t,n=e.code,a=e.message;return e=e.data,t.code=n,a?t.message=a:t._getErrMsg&&(t.message=t._getErrMsg(t.code)),t.data=e||{},t}function ao(e,t,n,o){var a;if(o=3<arguments.length&&void 0!==o?o:[],e)return a=e,t&&(e.startsWith("http://")?a=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(a=e.replace(/^https:\/\/[^/]+/,t))),n&&-1===a.indexOf("authKey=")&&ro(a,o)?(-1<a.indexOf("?")?"".concat(a,"&authKey="):"".concat(a,"?authKey=")).concat(n):a}function io(e,t,n){return n=2<arguments.length&&void 0!==n?n:[],e===S.MSG_VIDEO?ro((t[0].content||t[0].payload).snapshotUrl,n)&&(t[0].content?(t[0].content.snapshotUrl=so(t[0].content.snapshotUrl),t[0].content.thumbUrl=so(t[0].content.thumbUrl)):(t[0].payload.snapshotUrl=so(t[0].payload.snapshotUrl),t[0].payload.thumbUrl=so(t[0].payload.thumbUrl))):e===S.MSG_FILE?ro((t[0].content||t[0].payload).fileUrl,n)&&(t[0].content?t[0].content.fileUrl=so(t[0].content.fileUrl):t[0].payload.fileUrl=so(t[0].payload.fileUrl)):e===S.MSG_MERGER&&(e=(n=t[0].content||t[0].payload).downloadKey,n=void 0===(n=n.messageList)?[]:n,He(void 0===e?"":e))&&n.forEach((function(e){io(e.messageBody[0].type,e.messageBody)})),t}function so(e){if(!e)return e;if(-1===e.indexOf("authKey="))return e;for(var t=(e=e.split("?"))[1].split("&"),n=0,o=0;o<t.length;o++)if(-1<t[o].indexOf("authKey=")){n=o;break}return t.splice(n,1),0<t.length?"".concat(e[0],"?").concat(t.join("&")):e[0]}function ro(e,t){var n=!1;if(e){var o=(e=e.match(/:\/\/([0-9]?\.)?(.[^/:]+)/))&&e[2]||"";if(o.includes("rich-dev"))return 1;for(var a=0;a<t.length;a++)if(o.endsWith(t[a])){n=!0;break}}return n}i(Uo,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=ot(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.imageUrl||t.url||"",this.url=ao(t.url||e._imageMemoryURL,e._fileDownloadProxy,e._authKey,e._fileDNList)},this._ImageInfoModel.prototype={setSizeType:function(e){this.sizeType=e},setType:function(e){this.type=e},setImageUrl:function(e){e&&(this.imageUrl=e)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t,n=0,o=null;n<=2;)t=ut(e)||ut(e[n])?{type:0,size:0,width:0,height:0,url:""}:e[n],(o=new this._ImageInfoModel(t)).setSizeType(n+1),o.setType(n),this.addImageInfo(o),n++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,o=0;o<n;o++)t=this.content.imageInfoArray[o],e[o].size&&(t.size=e[o].size),e[o].url&&t.setImageUrl(e[o].url),e[o].width&&(t.width=e[o].width),e[o].height&&(t.height=e[o].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",o=["http","https"],a=null,i=0;i<e;i++)this.content.imageInfoArray[i].url&&""!==(a=this.content.imageInfoArray[i]).imageUrl&&(n=a.imageUrl.slice(0,a.imageUrl.indexOf("://")+1),t=a.imageUrl.slice(a.imageUrl.indexOf("://")+1),o.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[i].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=Re[e.toUpperCase()]||Re.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){void 0!==e&&0<e.files.length&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURL",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){3<=this.content.imageInfoArray.length||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,t=void 0===(t=(n=e[0]).width)?0:t,n=void 0===(n=n.height)?0:n;0!==t&&0!==n&&(Rt(e),Object.assign(e[2],Lt({originWidth:t,originHeight:n,min:720})))}},{key:"sendable",value:function(){return 0!==this.content.imageInfoArray.length&&""!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size}}]);var co=Uo,lo=(i(Oo,[{key:"sendable",value:function(){return null!==this.content}}]),Oo),uo=(i(Ao,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return""!==this.content.remoteAudioUrl}}]),Ao),po={from:!0,groupID:!0,groupName:!0,to:!0},ho=(i(Ro,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"remarkInfo":case"memberExtraInfo":case"onlineMemberInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"operatorInfo":t.content.operatorInfo={},t._initOperatorInfo(e[n]);break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}})),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];po[o]&&(this.content.groupProfile[o]=e[o])}}},{key:"_initOperatorInfo",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];this.content.operatorInfo[o]=e[o]}}},{key:"_updateMemberList",value:function(e){He(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach((function(t){e.forEach((function(e){t.userID===e.userID&&Object.assign(t,e)}))}))}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];this.content.newGroupProfile[o]="muteAllMembers"!==o?e[o]:1===e[o]}}}]),Ro),go={from:!0,groupID:!0,groupName:!0,to:!0,groupType:!0},mo=(i(Lo,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}}))}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];go[o]&&("groupName"===o?this.content.groupProfile.name=e[o]:this.content.groupProfile[o]=e[o])}}}]),Lo),fo=(i(No,[{key:"_getFileInfo",value:function(e){var t,n;return ut(e.fileName)||ut(e.fileSize)?(t=e.file.files[0],J&&(t.path&&-1!==t.path.indexOf(".")&&(n=t.path.slice(t.path.lastIndexOf(".")+1).toLowerCase(),t.type=n,t.name||(t.name="".concat(ot(999999),".").concat(n))),t.name||(t.type="",t.name=t.path.slice(t.path.lastIndexOf("/")+1).toLowerCase()),t.suffix&&(t.type=t.suffix),t.url||(t.url=t.path)),{size:t.size,name:t.name}):{size:e.fileSize,name:e.fileName}}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return""!==this.content.fileUrl&&""!==this.content.fileName&&0!==this.content.fileSize}}]),No),vo=(i(wo,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),wo),_o=(i(bo,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(e){var t=e.snapshotUrl,n=e.snapshotWidth;e=e.snapshotHeight,He(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),He(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),He(e)||(this.content.thumbHeight=this.content.snapshotHeight=Number(e))}},{key:"sendable",value:function(){return""!==this.content.remoteVideoUrl}}]),bo),yo=(i(Do,[{key:"sendable",value:function(){return!0}}]),Do),Io=(i(So,[{key:"_patchRichMediaPayload",value:function(e,t){e===S.MSG_IMAGE?t.imageInfoArray.forEach((function(e){!e.imageUrl&&e.url&&(e.imageUrl=e.url,e.sizeType=e.type,1===e.type?e.type=0:3===e.type&&(e.type=1))})):e===S.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===S.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===S.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n,o,a){(n||o)&&(e===S.MSG_IMAGE?t.imageInfoArray.forEach((function(e){e.url=ao(e.url,n,o,a)})):e===S.MSG_VIDEO?(t.videoUrl=ao(t.videoUrl,n,o,a),t.snapshotUrl=ao(t.thumbUrl,n,o,a),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===S.MSG_AUDIO?t.url=ao(t.url,n,o,a):e===S.MSG_FILE&&(t.fileUrl=ao(t.fileUrl,n,o,a)))}}]),So),Eo=(i(Mo,[{key:"sendable",value:function(){return!He(this.content.messageList)||!He(this.content.downloadKey)}}]),Mo),Co={1:S.MSG_PRIORITY_HIGH,2:S.MSG_PRIORITY_NORMAL,3:S.MSG_PRIORITY_LOW,4:S.MSG_PRIORITY_LOWEST},ko=(i(To,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){null!==e&&(lt(e.nick)&&(this.nick=e.nick),lt(e.avatar)&&(this.avatar=e.avatar),Ye(e=e.messageFromAccountExtraInformation))&&lt(e.nameCard)&&(this.nameCard=e.nameCard)}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach((function(e){e!==S.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:e}),t.atUserList.push(e)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(S.MSG_AT_ALL))})),We(e.groupAtInfo)&&e.groupAtInfo.forEach((function(e){0===e.groupAtAllFlag?t.atUserList.push(e.groupAtUserID):1===e.groupAtAllFlag&&t.atUserList.push(S.MSG_AT_ALL)}))}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?kn:Cn,!this.from)&&(this.from=e),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return 0!==this._elements.length&&(!0===this._relayFlag||"function"==typeof this._elements[0].sendable&&this._elements[0].sendable())}},{key:"_initTo",value:function(e){this.conversationType===S.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){var t,n,o;0===this.clientSequence&&e&&(this.clientSequence=!!e&&(void 0===ft[e]&&(t="3".concat((o=new Date).getHours()).slice(-2),n="0".concat(o.getMinutes()).slice(-2),o="0".concat(o.getSeconds()).slice(-2),ft[e]=parseInt([t,n,o,"0001"].join("")),o=n=t=null,Le.l("autoIncrementIndex start index:".concat(ft[e]))),ft[e]++)),0===this.sequence&&this.conversationType===S.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===S.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){""!==e&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n=this.conversationType;n!==S.CONV_SYSTEM?(e=n===S.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=e?"".concat(n).concat(e):null):this.conversationID=S.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof Qn||e instanceof co||e instanceof lo||e instanceof uo||e instanceof fo||e instanceof _o||e instanceof ho||e instanceof mo||e instanceof vo||e instanceof yo||e instanceof Eo}},{key:"setElement",value:function(e,t,n,o){var a=this;if(this.isElement(e))this._elements=[e];else{var i=function(e){if(e.type&&e.content)switch(e.type){case S.MSG_TEXT:a.setTextElement(e.content);break;case S.MSG_IMAGE:a.setImageElement(e.content,t,n,o);break;case S.MSG_AUDIO:a.setAudioElement(e.content,t,n,o);break;case S.MSG_FILE:a.setFileElement(e.content,t,n,o);break;case S.MSG_VIDEO:a.setVideoElement(e.content,t,n,o);break;case S.MSG_CUSTOM:a.setCustomElement(e.content);break;case S.MSG_LOCATION:a.setLocationElement(e.content);break;case S.MSG_GRP_TIP:a.setGroupTipElement(e.content);break;case S.MSG_GRP_SYS_NOTICE:a.setGroupSystemNoticeElement(e.content);break;case S.MSG_FACE:a.setFaceElement(e.content);break;case S.MSG_MERGER:a.setMergerElement(e.content,t,n,o)}};if(We(e))for(var s=0;s<e.length;s++)i(e[s]);else i(e)}this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){e="string"==typeof e?e:e.text,e=new Qn({text:e}),this._elements.push(e)}},{key:"setImageElement",value:function(e,t,n,o){e=new co(e,t,n,o),this._elements.push(e)}},{key:"setAudioElement",value:function(e,t,n,o){e=new uo(e,t,n,o),this._elements.push(e)}},{key:"setFileElement",value:function(e,t,n,o){e=new fo(e,t,n,o),this._elements.push(e)}},{key:"setVideoElement",value:function(e,t,n,o){e=new _o(e,t,n,o),this._elements.push(e)}},{key:"setLocationElement",value:function(e){e=new yo(e),this._elements.push(e)}},{key:"setCustomElement",value:function(e){e=new vo(e),this._elements.push(e)}},{key:"setGroupTipElement",value:function(e){var t,n={},o=e.operationType;He(e.memberInfoList)?e.operatorInfo&&(n=e.operatorInfo):o!==S.GRP_TIP_MBR_JOIN&&o!==S.GRP_TIP_MBR_KICKED_OUT&&o!==S.GRP_TIP_MBR_SET_ADMIN&&o!==S.GRP_TIP_MBR_CANCELED_ADMIN||(n=e.memberInfoList[0]),He(e.memberExtraInfo)||(t=e.memberExtraInfo.reason,e.msgMemberInfo.forEach((function(e){e.reason=t}))),o=n.nick,n=n.avatar,lt(o)&&(this.nick=o),lt(n)&&(this.avatar=n),o=new ho(e),this._elements.push(o)}},{key:"setGroupSystemNoticeElement",value:function(e){e=new mo(e),this._elements.push(e)}},{key:"setFaceElement",value:function(e){e=new lo(e),this._elements.push(e)}},{key:"setMergerElement",value:function(e,t,n,o){e=new Eo(e,t,n,o),this._elements.push(e)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"_computePriority",value:function(e){if(!ut(e)){if(lt(e)&&-1!==Object.values(Co).indexOf(e))return e;if(Ke(e)&&(e=""+e,-1!==Object.keys(Co).indexOf(e)))return Co[e]}return S.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(e){var t=e.nick;e=e.avatar,lt(t)&&(this.nick=t),lt(e)&&(this.avatar=e)}},{key:"setNameCard",value:function(e){lt(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){var t=e.readReceiptSentByPeer;e=void 0===(e=e.timestamp)?0:e,this.conversationType===S.CONV_C2C&&!0===this.needReadReceipt&&(this.readReceiptInfo.isPeerRead=1===(void 0===t?void 0:t),this.readReceiptInfo.timestamp=e)}}]),To);function To(e){o(this,To),this.ID="",this.conversationID=e.conversationID||null,this.conversationType=e.conversationType||S.CONV_C2C,this.conversationSubType=e.conversationSubType,this.time=e.time||Math.ceil(Date.now()/1e3),this.sequence=e.sequence||0,this.clientSequence=e.clientSequence||e.sequence||0,this.random=e.random||0===e.random?e.random:ot(),this.priority=this._computePriority(e.priority),this.nick=e.nick||"",this.avatar=e.avatar||"",this.isPeerRead=!1,this.nameCard="",this.hasRiskContent=Kt(e.checkResult),this._elements=[],this.isPlaceMessage=e.isPlaceMessage||0,this.isRevoked=2===e.isPlaceMessage||8===e.msgFlagBits,this.from=e.from||null,this.to=e.to||null,this.flow="",this.isSystemMessage=e.isSystemMessage||!1,this.protocol=e.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=e.status||kn,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=e.cloudCustomData||"",this.isDeleted=!1,this.isModified=!!e.messageVersion,this._isExcludedFromUnreadCount=!(!e.messageControlInfo||1!==e.messageControlInfo.excludedFromUnreadCount),this._isExcludedFromLastMessage=!(!e.messageControlInfo||1!==e.messageControlInfo.excludedFromLastMessage),this.clientTime=e.clientTime||Te()||0,this.senderTinyID=e.senderTinyID||e.tinyID||"",this.readReceiptInfo=e.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0,timestamp:0},this.needReadReceipt=!0===e.needReadReceipt||1===e.needReadReceipt,this.version=e.messageVersion||0,this.isBroadcastMessage=e.isBroadcastMessage||!1,this._receiverList=e.receiverList||void 0,this.isSupportExtension=!0===e.isSupportExtension||1===e.isSupportExtension,this._cmConfigID=e.customModerationConfigurationID,this.revoker=e.revokerInfo&&e.revokerInfo.revoker||"",this.revokerInfo=e.revokerInfo||{userID:"",nick:"",avatar:""},this.revokeReason=e.revokeReason||"",this.reInitialize(e.currentUser),this.extractGroupInfo(e.groupProfile||null),this.handleGroupAtInfo(e),this.initC2CReadReceiptInfo(e)}function Mo(e,t,n,a){var i,s,r,c,l,u,d;o(this,Mo),this.type=S.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},e.downloadKey?(s=e.downloadKey,r=e.pbDownloadKey,c=e.title,l=e.abstractList,u=e.compatibleText,i=e.version,this.content.downloadKey=s,this.content.pbDownloadKey=r,this.content.title=c,this.content.abstractList=l,this.content.compatibleText=u,this.content.version=i||0):He(e.messageList)?1===e.layersOverLimit&&(this.content.layersOverLimit=!0):(s=e.messageList,r=e.title,c=e.abstractList,l=e.compatibleText,u=e.version,d=[],s.forEach((function(e){He(e)||(e=new Io(e,t,n,a),d.push(e))})),this.content.messageList=d,this.content.title=r,this.content.abstractList=c,this.content.compatibleText=l,this.content.version=u||0)}function So(e,t,n,a){var i,s;o(this,So),this.from=e.from,this.messageSender=e.from,this.time=e.time,this.messageSequence=e.sequence,this.clientSequence=e.clientSequence||e.sequence,this.messageRandom=e.random,this.cloudCustomData=e.cloudCustomData||"",this.clientTime=e.clientTime||void 0,e.ID?(this.ID=e.ID||"",this.nick=e.nick||"",this.avatar=e.avatar||"",e.messageBody?this.messageBody=JSON.parse(JSON.stringify(e.messageBody)):this.messageBody=[{type:e.type,payload:e.payload}],e.conversationType?e.conversationType.startsWith(S.CONV_C2C)?this.receiverUserID=e.to:e.conversationType.startsWith(S.CONV_GROUP)&&(this.receiverGroupID=e.to):e.receiverGroupID?this.receiverGroupID=e.receiverGroupID:e.receiverUserID&&(this.receiverUserID=e.receiverUserID),this.messageReceiver=e.to||e.messageReceiver):(this.nick=e.nick||"",this.avatar=e.avatar||"",this.messageBody=[],i=e.elements[0].type,s=e.elements[0].content,this._patchRichMediaPayload(i,s),this._updateRichMediaDownloadUrl(i,s,t,n,a),i===S.MSG_MERGER?this.messageBody.push({type:i,payload:new Eo(s,t,n,a).content}):this.messageBody.push({type:i,payload:s}),e.groupID&&(this.receiverGroupID=e.groupID,this.messageReceiver=e.groupID),e.to&&(this.receiverUserID=e.to,this.messageReceiver=e.to),this.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random))}function Do(e){o(this,Do),this.type=S.MSG_LOCATION;var t=e.description,n=e.longitude;e=e.latitude,this.content={description:t,longitude:n,latitude:e}}function bo(e,t,n,a){o(this,bo),this.type=S.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:e.remoteVideoUrl||e.videoUrl||"",videoFormat:e.videoFormat,videoSecond:parseInt(e.videoSecond,10),videoSize:e.videoSize,videoUrl:ao(e.videoUrl,t,n,a),videoDownloadFlag:2,videoUUID:e.videoUUID,thumbUUID:e.thumbUUID,thumbFormat:e.thumbFormat,thumbWidth:e.thumbWidth,snapshotWidth:e.thumbWidth,thumbHeight:e.thumbHeight,snapshotHeight:e.thumbHeight,thumbSize:e.thumbSize,snapshotSize:e.thumbSize,thumbDownloadFlag:2,thumbUrl:ao(e.thumbUrl,t,n,a),snapshotUrl:ao(e.thumbUrl,t,n,a)}}function wo(e){o(this,wo),this.type=S.MSG_CUSTOM,this.content={data:e.data||"",description:e.description||"",extension:e.extension||""}}function No(e,t,n,a){o(this,No),this.type=S.MSG_FILE,this._percent=0;var i=this._getFileInfo(e);this.content={downloadFlag:2,fileUrl:ao(e.url||e.fileUrl,t,n,a)||"",uuid:e.uuid,fileName:i.name||"",fileSize:i.size||0}}function Lo(e){o(this,Lo),this.type=S.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(e)}function Ro(e){o(this,Ro),this.type=S.MSG_GRP_TIP,this.content={},this._initContent(e)}function Ao(e,t,n,a){o(this,Ao),this.type=S.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:e.second,size:e.size,url:ao(e.url,t,n,a),remoteAudioUrl:e.url||"",uuid:e.uuid}}function Oo(e){o(this,Oo),this.type=S.MSG_FACE,this.content=e||null}function Uo(e,t,n,a){o(this,Uo),this._imageMemoryURL="",this._fileDownloadProxy=t,this._authKey=n,this._fileDNList=a,Q||te?this.createImageDataASURL(e.file):this.createImageDataASURLInWeb(e.file),this._initImageInfoModel(),this.type=S.MSG_IMAGE,this._percent=0,this.content={imageFormat:e.imageFormat||Re.UNKNOWN,uuid:e.uuid,imageInfoArray:[]},this.initImageInfoArray(e.imageInfoArray),this._autoFixUrl()}function Po(e){if(Ye(e))return{pushFlag:!0===e.disablePush?1:0,title:e.title||"",desc:e.description||"",ext:e.extension||"",apnsInfo:(o=void 0===(o=(n=e).apnsInfo)?{}:o,a=n.ignoreIOSBadge,n=n.disableVoipPush,a=!0===o.ignoreIOSBadge||!0===(void 0!==a&&a)?1:0,i=void 0,ut(n)||(i=!1===n?1:0),ut(o.disableVoipPush)||(i=!1===o.disableVoipPush?1:0),t(t({},o),{},{badgeMode:a,isVoipPush:i})),androidInfo:(o=void 0===(o=(n=e).androidInfo)?{}:o,n=n.androidOPPOChannelID,n=o.OPPOChannelID||(void 0===n?"":n),t(t({},o),{},{Sound:-1===(i=(a=o.sound||"").lastIndexOf("."))?a:a.slice(0,i),OPPOChannelID:n,GoogleChannelID:o.FCMChannelID||""}))};var n,o,a,i}r(Ho,Nn),Go=m(Ho),i(Ho,[{key:"onNewMessage",value:function(e){var t=e.dataList,n=e.isInstantMessage,o=e.C2CRemainingUnreadList,a=e.C2CPairUnreadList,i=(e=e.isSyncingEnded,o=(n||Le.l("".concat(this._n,".onNewMessage C2CPairUnreadList:"),a,"C2CRemainingUnreadList:",o),t=this._assembly({dataList:t,C2CRemainingUnreadList:o,C2CPairUnreadList:a,isInstantMessage:n})).conversationOptionsList,a=t.messageList,t=t.isUnreadC2CMessage,0<(i=_t(a)).length&&this.emitOEvt(M.MESSAGE_MODIFIED,i),this.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:n,isUnreadC2CMessage:t,isSyncingEnded:e}),yt(a));n&&0<i.length&&this.emitOEvt(M.MESSAGE_RECEIVED,i),a.length=0}},{key:"_assembly",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,o=e.C2CPairUnreadList,a=e.isInstantMessage,i=null,s=[],r=[],c={},l=this.get(26),u=!1,d=this.get(11),p=this.get(4),h=(e=this.get(17),this.getFileDownloadProxy()),g=this.getDowloadFileAuthKey(),m=e.getFileDNList(),f=0,v=t.length;f<v;f++)if(this._isC2CNotice(t[f]))this._noticeFromUnreadDBList.push(t[f].eventArray[0].c2CNotifyMsgArray[0]);else{var _=t[f],y=(_.currentUser=this.getMyUserID(),_.conversationType=S.CONV_C2C,_.isSystemMessage=!!_.isSystemMessage,(ut(_.nick)||ut(_.avatar))&&(u=!0),(i=new ko(_)).setElement(_.elements,h,g,m),i.setNickAndAvatar({nick:_.nick,avatar:_.avatar}),i.conversationID);if(a){if(this._msgFromUnreadDBMap.get(i.ID))continue;var I,E,C=!1,k=(i.from!==this.getMyUserID()?(E=d.getLatestMessageSentByPeer(y))&&(I=E.nick,E=E.avatar,u?i.setNickAndAvatar({nick:I,avatar:E}):I===i.nick&&E===i.avatar||(C=!0)):(I=d.getLatestMessageSentByMe(y))&&(E=I.nick,k=I.avatar,E===i.nick&&k===i.avatar||(d.modifyMessageSentByMe({conversationID:y,latestNick:i.nick,latestAvatar:i.avatar}),p.mockOnNickAvatarModified(i.nick,i.avatar))),1===t[f].isModified);if(d.isMessageSentByCurrentInstance(i)?i.isModified=k:k=!1,0===_.msgLifeTime)i._onlineOnlyFlag=!0,d.isMessageSentByCurrentInstance(i)||r.push(i);else{if(!d.pushIntoMessageList(r,i,k))continue;C&&(d.modifyMessageSentByPeer({conversationID:y,latestNick:i.nick,latestAvatar:i.avatar}),d.updateUserProfileSpecifiedKey({conversationID:y,nick:i.nick,avatar:i.avatar}))}a&&0<i.clientTime&&l.addMessageDelay(i.clientTime)}else this._msgFromUnreadDBMap.set(i.ID,i);if(0!==_.msgLifeTime){if(!1===i._onlineOnlyFlag){if(Ke(C=d.getLastMessageTime(y))&&i.time<C)continue;a&&(ut(c[y])?(_=0,"in"!==i.flow||i._isExcludedFromUnreadCount||(_=1),c[y]=s.push({conversationID:y,unreadCount:_,type:i.conversationType,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1):(_=c[y],s[_].type=i.conversationType,s[_].subType=i.conversationSubType,s[_].lastMessage=i._isExcludedFromLastMessage?"":i,"in"!==i.flow||i._isExcludedFromUnreadCount||s[_].unreadCount++))}}else i._onlineOnlyFlag=!0}this._handleNoticeFromUnreadDB();var T=!1;if(We(o)&&0<o.length)for(var M=0,D=o.length;M<D;M++)!function(e){if(o[e].from!==S.CONV_SYSTEM){T=!0;var t=s.find((function(t){return t.conversationID==="".concat(S.CONV_C2C).concat(o[e].from)}));t?t.unreadCount=o[e].unreadCount:s.push({conversationID:"".concat(S.CONV_C2C).concat(o[e].from),unreadCount:o[e].unreadCount,type:S.CONV_C2C})}}(M);if(We(n))for(var b=0,w=n.length;b<w;b++)!function(e){s.find((function(t){return t.conversationID==="".concat(S.CONV_C2C).concat(n[e].from)}))||s.push({conversationID:"".concat(S.CONV_C2C).concat(n[e].from),type:S.CONV_C2C,lastMsgTime:n[e].lastMsgTime})}(b);return{conversationOptionsList:s,messageList:r,isUnreadC2CMessage:T}}},{key:"getMessageListFromUnreadDB",value:function(){return v(this._msgFromUnreadDBMap.values())}},{key:"_isC2CNotice",value:function(e){return!(!We(e=e.eventArray)||10!==e[0].event)}},{key:"_handleNoticeFromUnreadDB",value:function(){var e,t=this._noticeFromUnreadDBList.length;0!==t&&(Le.l("".concat(this._n,"._handleNoticeFromUnreadDB count:").concat(t)),e=[],this._noticeFromUnreadDBList.forEach((function(t){t.hasOwnProperty("c2cMessageRevokedNotify")&&e.push(t)})),this.onMsgRevoked({dataList:e}),this._noticeFromUnreadDBList.length=0,e.length=0)}},{key:"onMsgRevoked",value:function(e){var t,n=this,o=this.get(11),a=[];e.dataList.forEach((function(e){e.c2cMessageRevokedNotify&&(e=e.c2cMessageRevokedNotify.revokedInfos,ut(e)||e.forEach((function(e){var i=n.getMyUserID()===e.from?"".concat(S.CONV_C2C).concat(e.to):"".concat(S.CONV_C2C).concat(e.from);t=o.revoke(i,e.sequence,e.random);var s,r=e.revokerInfo&&e.revokerInfo.revoker,c=e.revokerInfo&&e.revokerInfo.reason||"";t?s=t:(s={conversationID:i,sequence:e.sequence},e.tinyID&&e.clientTime&&e.random&&(s.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random)),e.time&&(s.time=e.time)),s&&(s.revoker=r,s.revokeReason=c,s.revokerInfo={userID:r,nick:"",avatar:""},a.push(s))})))})),0!==a.length&&(o.onMessageRevoked(a),Le.l("".concat(this._n,".onMsgRevoked count:").concat(a.length)),o.updateRevokerInfo(a).then((function(e){n.emitOEvt(M.MESSAGE_REVOKED,e)})))}},{key:"onMsgReadReceipt",value:function(e){var t=this;e.dataList.forEach((function(e){var n;He(e.c2cMessageReadReceipt)||(n=e.c2cMessageReadReceipt.to,e.c2cMessageReadReceipt.uinPairReadArray.forEach((function(e){e=e.peerReadTime;var o=(Le.l("".concat(t._n,".onMsgReadReceipt to:").concat(n," peerReadTime:").concat(e)),"".concat(S.CONV_C2C).concat(n)),a=t.get(11);a.recordPeerReadTime(o,e),a.updateMsgIsPeerReadProp(o,e)})))}))}},{key:"onMsgReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n;He(e.c2cMessageReadNotice)||(n=t.get(11),e.c2cMessageReadNotice.uinPairReadArray.forEach((function(e){var o=e.from;e=e.peerReadTime,Le.l("".concat(t._n,".onMsgReadNotice from:").concat(o," lastReadTime:").concat(e)),o="".concat(S.CONV_C2C).concat(o),n.updateIsReadAfterReadReport({conversationID:o,lastMessageTime:e}),n.updateUnreadCount(o)})))}))}},{key:"onMsgModified",value:function(e){Le.l("".concat(this._n,".onMsgModified options:"),e);var n=this.get(11);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:S.CONV_C2C}))}))}},{key:"onReadReceiptList",value:function(e){Le.l("".concat(this._n,".onReadReceiptList options:"),e),this.get(11).updateReadReceiptInfo(e.dataList)}},{key:"sendMessage",value:function(e,t){return e=this._createC2CMessagePack(e,t),this.req(e)}},{key:"_createC2CMessagePack",value:function(e,t){var n=null,o=(t&&(t.offlinePushInfo&&(n=t.offlinePushInfo),!0===t.onlineUserOnly)&&(n?n.disablePush=!0:n={disablePush:!0}),""),a=(lt(e.cloudCustomData)&&0<e.cloudCustomData.length&&(o=e.cloudCustomData),[]),i=(Ye(t)&&Ye(t.messageControlInfo)&&(i=(r=t.messageControlInfo).excludedFromUnreadCount,s=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===i&&a.push("NoUnread"),!0===s&&a.push("NoLastMsg"),!0===r)&&a.push("NoMsgCheck"),this.isOnlineMessage(e,t)?0:void 0),s=JSON.parse(JSON.stringify(e.getElements())),r=this.get(17).getFileDNList();return{P:Gn.SEND_C2C_MSG,data:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:io(e.type,s,r),cloudCustomData:o,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:i,nick:e.nick,avatar:e.avatar,offlinePushInfo:Po(n),messageControlInfo:0!==i?a:void 0,clientTime:e.clientTime,needReadReceipt:!0===e.needReadReceipt?1:0,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0,cmConfigID:e._cmConfigID}}}},{key:"isOnlineMessage",value:function(e,t){return!(!t||!0!==t.onlineUserOnly)}},{key:"revokeMessage",value:function(e){return this.req({P:Gn.REVOKE_C2C_MSG,data:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var t=e.to;return e=e.keyList,Le.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(e.length)),this.req({P:Gn.DEL_C2C_MSG,data:{fromAccount:this.getMyUserID(),to:t,keyList:e}})}},{key:"modifyRemoteMessage",value:function(e){var t=e.from,n=e.to,o=void 0===(o=e.version)?0:o,a=e.sequence,i=e.random,s=e.time,r=e.payload,c=e.type,l=e.cloudCustomData,u=void(e=e._elements);return Bt(c)&&(1<e.length&&e.splice(0,1,{type:c,content:r}),u=e),this.req({P:Gn.MODIFY_C2C_MSG,data:{from:t,to:n,version:o,sequence:a,random:i,time:s,elements:u,cloudCustomData:l}})}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,o=e.lastMessageTime,a="".concat(this._n,".").concat("setMessageRead"),i=(e="convID:".concat(n," lastMessageTime:").concat(o),Le.l("".concat(a," ").concat(e)),Ke(o)||this.warn("DoNotModifyLastTime"),new Zn("setMessageRead"));return i.setMessage(e),this.req({P:Gn.SET_C2C_MSG_READ,data:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:o,receipt:1}]}}}).then((function(){i.end(),Le.l("".concat(a," ok"));var e=t.get(11);return e.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:o}),e.updateUnreadCount(n),_n()})).catch((function(e){return i.setError(e).end(),Le.l("".concat(a," failed. error:"),e),In(e)}))}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessage"),o=e.peerAccount,a=e.conversationID,i=e.count,s=e.lastMessageTime,r=(e=e.messageKey,"peerAccount:".concat(o," count:").concat(i||15," lastMessageTime:").concat(s||0," messageKey:").concat(e)),c=(Le.l("".concat(n," ").concat(r)),new Zn("getRoamingMessage"));return this.req({P:Gn.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:i||15,lastMessageTime:s||0,messageKey:e}}).then((function(e){var o=(e=e.data).complete,i=e.messageList,s=e.messageKey,l=(e=e.lastMessageTime,ut(i)?Le.l("".concat(n," ok. complete:").concat(o," but messageList is undefined!")):Le.l("".concat(n," ok. complete:").concat(o," count:").concat(i.length)),c.setMessage("".concat(r," complete:").concat(o," length:").concat(i.length)).end(),t.get(11)),u=((o=1===o)&&l.setCompleted(a),[]);return i=l.onRoamingMessage(i,a,!0,u),l.modifyMessageList(a),l.updateIsRead(a),l.updateRoamingMsgKeyAndTime(a,s,e),s=l.getPeerReadTime(a),Le.l("".concat(n," update isPeerRead property. convID:").concat(a," peerReadTime:").concat(s)),s?l.updateMsgIsPeerReadProp(a,s):(e=a.replace(S.CONV_C2C,""),t.getRemotePeerReadTime([e]).then((function(){l.updateMsgIsPeerReadProp(a,l.getPeerReadTime(a))}))),s="",0<i.length?s=i[0].ID:(e=l.getLocalOldestMessage(a))&&(s=e.ID),Le.l("".concat(n," nextReqID:").concat(s," storedMsgCount:").concat(i.length)),{nextReqID:s,storedMessageList:i,assembledMessageList:u,isPullingCompleted:o}})).catch((function(e){return c.setMessage(r).setError(e).end(),Le.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessagesHopping"),o=e.peerAccount,a=void 0===(a=e.time)?0:a,i=e.count,s=e.direction,r="".concat(S.CONV_C2C).concat(o),c="peerAccount:".concat(o," count:").concat(i," time:").concat(a," direction:").concat(s),l=(Le.l("".concat(n," ").concat(c)),new Zn("getRoamingMessagesHopping"));return this.req({P:Gn.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:i+1,lastMessageTime:a,direction:s}}).then((function(e){var o=(e=e.data).complete,a=void 0===(a=e.messageList)?[]:a,i=(e=e.lastMessageTime,"complete:".concat(o," count:").concat(a.length)),u=(Le.l("".concat(n," ok. ").concat(i)),l.setMessage("".concat(c," ").concat(i)).end(),1!==o&&(1===s?a.pop():a.shift()),t.get(11));return i=u.onRoamingMessage(a,r,!1),t._modifyMessageList(r,i),a=t._computeResult({complete:o,lastMessageTime:e,resultList:i}),u.storeHoppingMessageList(a.messageList),o=u.getPeerReadTime(r),Le.l("".concat(n," update isPeerRead property. convID:").concat(r," peerReadTime:").concat(o)),o?u.updateMsgIsPeerReadProp(r,o):(e=r.replace(S.CONV_C2C,""),t.getRemotePeerReadTime([e]).then((function(){u.updateMsgIsPeerReadProp(r,u.getPeerReadTime(r))}))),_n(a)})).catch((function(e){return l.setMessage(c).setError(e).end(),Le.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"_computeResult",value:function(e){var t=void 0===(t=e.complete)?0:t,n=e.lastMessageTime;return e={messageList:v(void 0===(e=e.resultList)?[]:e),isCompleted:!1,nextMessageTime:""},1===t?e.isCompleted=!0:e.nextMessageTime=n,e}},{key:"_modifyMessageList",value:function(e,t){if(e=this.get(11).getLocalConversation(e))for(var n=e.userProfile.nick,o=e.userProfile.avatar,a=(e=this.get(4).getNickAndAvatarByUserID(this.getMyUserID())).nick,i=e.avatar,s=t.length-1;0<=s;s--){var r=t[s];"in"===r.flow&&(r.nick!==n&&r.setNickAndAvatar({nick:n}),r.avatar!==o)&&r.setNickAndAvatar({avatar:o}),"out"===r.flow&&(r.nick!==a&&r.setNickAndAvatar({nick:a}),r.avatar!==i)&&r.setNickAndAvatar({avatar:i})}}},{key:"getRemotePeerReadTime",value:function(e){var t,n=this,o="".concat(this._n,".").concat("getRemotePeerReadTime");return He(e)?Promise.resolve():(t=new Zn("getRemotePeerReadTime"),Le.l("".concat(o," userIDList:").concat(e)),this.req({P:Gn.GET_C2C_PEER_READ_TIME,data:{userIDList:e}}).then((function(a){var i=a.data.peerReadTimeList;Le.l("".concat(o," ok. peerReadTimeList:").concat(i));for(var s="",r=n.get(11),c=0;c<e.length;c++)s+="".concat(e[c],"-").concat(i[c]," "),0<i[c]&&r.recordPeerReadTime("".concat(S.CONV_C2C).concat(e[c]),i[c]);t.setMessage(s).end()})).catch((function(e){t.setError(e).end(),Le.w("".concat(o," failed. error:"),e)})))}},{key:"sendReadReceipt",value:function(e){var t,n=e[0].conversationID.replace(S.CONV_C2C,""),o=new Zn("sendReadReceipt"),a=(o.setMessage("peerAccount:".concat(n)),this.getMyUserID());return 0===(e=e.filter((function(e){return e.from!==a&&!0===e.needReadReceipt})).map((function(e){return{fromAccount:e.from,toAccount:e.to,sequence:e.sequence,random:e.random,time:e.time,clientTime:e.clientTime}}))).length?In({code:Un.READ_RECEIPT_MSG_LIST_EMPTY}):(t="".concat(this._n,".").concat("sendReadReceipt"),Le.l("".concat(t,". peerAccount:").concat(n," length:").concat(e.length)),this.req({P:Gn.SEND_C2C_READ_RECEIPT,data:{peerAccount:n,messageInfoList:e}}).then((function(e){return o.end(),Le.l("".concat(t," ok")),_n()})).catch((function(e){return o.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)})))}},{key:"getReadReceiptList",value:function(e){var t=e[0].conversationID.replace(S.CONV_C2C,"");return Le.l("".concat(this._n,".getReadReceiptList peerAccount:").concat(t," msgCount:").concat(e.length)),yn({messageList:e})}},{key:"getMessageExtensions",value:function(e,t){return Le.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({P:Gn.GET_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),startSequence:t}})}},{key:"modifyMsgExts",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return Le.l("".concat(this._n,".modifyMsgExts operateType:").concat(n)),this.req({P:Gn.MODIFY_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),extensionList:t,operateType:n}})}},{key:"getMessageKey",value:function(e){var t=e.clientSequence,n=e.random;return e=e.time,"".concat(t,"_").concat(n,"_").concat(e)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._msgFromUnreadDBMap.clear(),this._noticeFromUnreadDBList.length=0}}]);var Go,xo=Ho,Bo={A2KEY_AND_TINYID_UPDATED:"_inner".concat(1),CLOUD_CONFIG:"_inner".concat(2),PROFILE_UPDATED:"_inner".concat(3),CONV_SYNC_COMPLETED:"_inner".concat(4),C2C_UNREAD_HANDLE_COMPLETED:"_inner".concat(5)},Vo=(i(Fo,[{key:"_onCloudConfig",value:function(){var e=this._convM.getCloudConfig("topic_msg_limit");ut(e)||(this.TOPIC_MSG_LIMIT=Number(e)),Le.l("".concat(this._n,"._onCloudConfig topicMsgLimit:").concat(this.TOPIC_MSG_LIMIT))}},{key:"onCheckTimer",value:function(e){if(e%20==0&&0<this._map.size){var t,n=T(this._map);try{for(n.s();!(t=n.n()).done;){var o=f(t.value,2),a=o[0],i=o[1];a.includes(Ve)&&i.size>=this.TOPIC_MSG_LIMIT&&this._convM.clearMemMsg(a,!0)}}catch(s){n.e(s)}finally{n.f()}}}},{key:"pushIn",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=e.conversationID,o=!0,a=(this._map.has(n)||this._map.set(n,new Map),this._getUniqueIDOfMsg(e));if(this._map.get(n).has(a)){var i=this._map.get(n).get(a);if(!t||!0===i.isModified)return!1}return this._map.get(n).set(a,e),this._setLatestMsgSentByPeer(n,e),this._setLatestMsgSentByMe(n,e),o}},{key:"unshift",value:function(e,t){var n;if(We(e)?0<e.length&&(n=e[0].conversationID,this._unshiftMultipleMsgs(e,t)):(n=e.conversationID,this._unshiftSingleMsg(e,t)),n){var o=Array.from(this._map.get(n).values());if(0!==(e=o.length)){for(var a=e-1;0<=a;a--)if("out"===o[a].flow){this._setLatestMsgSentByMe(n,o[a]);break}if(n.startsWith(S.CONV_C2C))for(var i=e-1;0<=i;i--)if("in"===o[i].flow){this._setLatestMsgSentByPeer(n,o[i]);break}}}}},{key:"_unshiftSingleMsg",value:function(e,t){var n,o,a=e.conversationID,i=this._getUniqueIDOfMsg(e);this._map.has(a)?(n=this._map.get(a),o=Array.from(n),n.has(i)||(o.unshift([i,e]),this._map.set(a,new Map(o)),t.push(e))):(this._map.set(a,new Map),this._map.get(a).set(i,e),t.push(e))}},{key:"_unshiftMultipleMsgs",value:function(e,t){for(var n=e.length,o=[],a=e[0].conversationID,i=this._map.get(a),s=this._map.has(a)?Array.from(i):[],r=0;r<n;r++){var c=this._getUniqueIDOfMsg(e[r]);i&&i.has(c)||(o.push([c,e[r]]),t.push(e[r]))}this._map.set(a,new Map(o.concat(s)))}},{key:"remove",value:function(e){var t=e.conversationID;e=this._getUniqueIDOfMsg(e),this._map.has(t)&&this._map.get(t).delete(e)}},{key:"revoke",value:function(e,t,n){var o;return this._map.has(e)?(o=this._map.get(e),this._updateMsgIsRevoked(o,t,n)):this._hoppingMsgMap.has(e)?(o=this._hoppingMsgMap.get(e),this._updateMsgIsRevoked(o,t,n)):null}},{key:"_updateMsgIsRevoked",value:function(e,t,n){var o,a=T(e);try{for(a.s();!(o=a.n()).done;){var i=f(o.value,2)[1];if(i.sequence===t&&(ut(n)||i.random===n))return i.isRevoked||(i.isRevoked=!0),i}}catch(s){a.e(s)}finally{a.f()}}},{key:"removeByConvID",value:function(e){var t=this._map.has(e);Le.l("".concat(this._n,".removeByConvID convID:").concat(e," has:").concat(t)),t&&(this._map.delete(e),this._latestMsgSentByPeerMap.delete(e),this._latestMsgSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){return this._findMsg(e,this._map)||this._findMsg(e,this._hoppingMsgMap)}},{key:"_findMsg",value:function(e,t){var n,o=null,a=T(t);try{for(a.s();!(n=a.n()).done;)for(var i=v(f(n.value,2)[1].values()),s=i.length,r=0;r<s;r++)if(i[r].ID===e){o=i[r];break}}catch(c){a.e(c)}finally{a.f()}return o}},{key:"updateMsgIsPeerReadProp",value:function(e,t){var n,o=[];return this._map.has(e)?(n=this._map.get(e),o=this._updateMsgIsPeerReadProp(n,t)):this._hoppingMsgMap.has(e)&&(n=this._hoppingMsgMap.get(e),o=this._updateMsgIsPeerReadProp(n,t)),Le.l("".concat(this._n,".updateMsgIsPeerReadProp convID:").concat(e," peerReadTime:").concat(t," count:").concat(o.length)),o}},{key:"_updateMsgIsPeerReadProp",value:function(e,t){var n,o=[],a=T(e);try{for(a.s();!(n=a.n()).done;){var i=f(n.value,2)[1];i.time<=t&&!i.isPeerRead&&"out"===i.flow&&(i.isPeerRead=!0,o.push(i))}}catch(s){a.e(s)}finally{a.f()}return o}},{key:"updateMsgIsModifiedProp",value:function(e){var t=e.conversationID;this._map.has(t)&&(e=this._getUniqueIDOfMsg(e),t=this._map.get(t).get(e))&&(t.isModified=!0)}},{key:"hasLocalMsgList",value:function(e){return this._map.has(e)}},{key:"getLocalMsgList",value:function(e){return this.hasLocalMsgList(e)?v(this._map.get(e).values()):[]}},{key:"getLocalMaxSeq",value:function(e){return this.hasLocalMsgList(e)?(e=v(this._map.get(e).values()).map((function(e){return e.sequence})),Math.max.apply(Math,v(e))):0}},{key:"getLocalMaxTime",value:function(e){return this.hasLocalMsgList(e)?(e=v(this._map.get(e).values()).map((function(e){return e.time})),Math.max.apply(Math,v(e))):0}},{key:"hasLocalMsg",value:function(e,t){for(var n=!1,o=this.getLocalMsgList(e),a=o.length,i=0;i<a;i++)o[i].ID===t&&(n=!0);return n}},{key:"getLocalMsg",value:function(e,t){for(var n=null,o=this.getLocalMsgList(e),a=o.length,i=0;i<a;i++)if(o[i].ID===t){n=o[i];break}return n}},{key:"getLocalLastMsg",value:function(e){return(e=this.getLocalMsgList(e))[e.length-1]}},{key:"getLocalSecondLastMsg",value:function(e){return(e=this.getLocalMsgList(e))[e.length-2]}},{key:"getLocalOldestMsg",value:function(e){return this.getLocalMsgList(e)[0]}},{key:"_setLatestMsgSentByPeer",value:function(e,t){e.startsWith(S.CONV_C2C)&&"in"===t.flow&&this._latestMsgSentByPeerMap.set(e,t)}},{key:"_setLatestMsgSentByMe",value:function(e,t){"out"===t.flow&&this._latestMsgSentByMeMap.set(e,t)}},{key:"getLatestMsgSentByPeer",value:function(e){return this._latestMsgSentByPeerMap.get(e)}},{key:"getLatestMsgSentByMe",value:function(e){return this._latestMsgSentByMeMap.get(e)}},{key:"modifyMsgSentByPeer",value:function(e){var t=e.conversationID,n=e.latestNick,o=e.latestAvatar;if(!He(e=this._map.get(t))){var a=Array.from(e.values());if(0!==(e=a.length)){for(var i=null,s=0,r=!1,c=e-1;0<=c;c--)"in"===a[c].flow&&((i=a[c]).nick!==n&&(i.setNickAndAvatar({nick:n}),r=!0),i.avatar!==o&&(i.setNickAndAvatar({avatar:o}),r=!0),r)&&(s+=1);Le.l("".concat(this._n,".modifyMsgSentByPeer convID:").concat(t," count:").concat(s))}}}},{key:"modifyMsgSentByMe",value:function(e){var t=e.conversationID,n=e.latestNick,o=e.latestAvatar;if(!He(e=this._map.get(t))){var a=Array.from(e.values());if(0!==(e=a.length)){for(var i=null,s=0,r=!1,c=e-1;0<=c;c--)"out"===a[c].flow&&((i=a[c]).nick!==n&&(i.setNickAndAvatar({nick:n}),r=!0),i.avatar!==o&&(i.setNickAndAvatar({avatar:o}),r=!0),r)&&(s+=1);Le.l("".concat(this._n,".modifyMsgSentByMe convID:").concat(t," count:").concat(s))}}}},{key:"getTopicConvIDList",value:function(e){return v(this._map.keys()).filter((function(t){return t.startsWith("".concat(S.CONV_GROUP).concat(e))}))}},{key:"onMsgModified",value:function(e,t){var n,o,a,i;return(this._map.has(e)||this._hoppingMsgMap.has(e))&&(n="".concat(this._n,".onMsgModified"),a=this._getUniqueIDOfMsg(t),i=!!(o=this._getTargetMsg(e,a)),Le.l("".concat(n," convID:").concat(e," uniqueID:").concat(a," has:").concat(i)),i)?(e=t.messageVersion,a=t.elements,i=t.cloudCustomData,t=t.checkResult,Le.l("".concat(n," localVersion:").concat(o.version," remoteVersion:").concat(e)),o.version<e?(o.version=e,o._elements=JSON.parse(JSON.stringify(a)),o.payload=JSON.parse(JSON.stringify(a[0].content)),o.type=a[0].type,o.cloudCustomData=i,o.isModified=!0,o.hasRiskContent=Kt(t),{isUpdated:!0,message:o}):{isUpdated:!1,message:o}):{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMsg",value:function(e){var t=e.from,n=e.to,o=e.random,a=e.sequence;return e=e.time,"".concat(t,"-").concat(n,"-").concat(o,"-").concat(a,"-").concat(e)}},{key:"_getTargetMsg",value:function(e,t){if(this._map.has(e))return this._map.get(e).get(t);var n=void 0;if(this._hoppingMsgMap.has(e))for(var o=v(this._hoppingMsgMap.get(e).values()),a=0;a<o.length;a++)if(this._getUniqueIDOfMsg(o[a])===t){n=o[a];break}return n}},{key:"storeHoppingMsgList",value:function(e){if(0!==e.length){var t=e[0].conversationID,n=e.length;this._hoppingMsgMap.has(t)||this._hoppingMsgMap.set(t,new Map);for(var o=this._hoppingMsgMap.get(t),a=0;a<n;a++){var i=e[a];o.has(i.ID)||o.set(i.ID,i)}}}},{key:"getHoppingMsg",value:function(e,t){if(this._hoppingMsgMap.has(e))return this._hoppingMsgMap.get(e).get(t)}},{key:"reset",value:function(){this._map.clear(),this._latestMsgSentByPeerMap.clear(),this._latestMsgSentByMeMap.clear(),this._hoppingMsgMap.clear()}}]),Fo);function Fo(e){o(this,Fo),this._convM=e,this._map=new Map,this._n="MsgListHandler",this._latestMsgSentByPeerMap=new Map,this._latestMsgSentByMeMap=new Map,this._hoppingMsgMap=new Map,this.TOPIC_MSG_LIMIT=1e3,this._convM.getIEmitInst().on(Bo.CLOUD_CONFIG,this._onCloudConfig,this)}function Ho(e){return o(this,Ho),(e=Go.call(this,e))._n="C2CModule",e._msgFromUnreadDBMap=new Map,e._noticeFromUnreadDBList=[],e}function jo(e){this.mixin(e)}function qo(e,n,o){return ut(e)?{lastTime:0,lastSequence:0,fromAccount:"",messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:o&&e.ID||e instanceof ko?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:xt(e.type,e.payload,n),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:t(t({},e),{},{messageForShow:xt(e.type,e.payload,n)})}function zo(e,t){return He(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",avatar:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:xt(e.type,e.payload,t),nick:e.nick||"",avatar:e.avatar||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}}function Ko(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var o,a,i=0,s=0;a=t.charAt(s++);~a&&(o=i%4?64*o+a:a,i++%4)&&(n+=String.fromCharCode(255&o>>(-2*i&6))))a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a);try{return decodeURIComponent(escape(n))}catch(r){return""}}jo.mixin=function(e){(e=e.prototype||e)._isReady=!1,e.ready=function(e){if(e)return this._isReady?void(1<arguments.length&&void 0!==arguments[1]&&arguments[1]?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},e.triggerReady=function(){var e=this;this._isReady=!0,setTimeout((function(){var t=e._readyQueue;e._readyQueue=[],t&&0<t.length&&t.forEach((function(e){e.call(this)}),e)}),1)},e.resetReady=function(){this._isReady=!1,this._readyQueue=[]},e.isReady=function(){return this._isReady}};var $o,Yo,Wo,Jo,Xo,Zo=["jpg","jpeg","gif","png","bmp","image","webp"],Qo=["mp4","quicktime","mov"],ea=(i(ai,[{key:"validate",value:function(e){var t,n=!0,o="";if(He(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var a=e.profileCustomField.length,i=null,s=0;s<a;s++){if(i=e.profileCustomField[s],!lt(i.key)||-1===i.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!lt(i.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if("profileCustomField"===t)continue;if(He(e[t])&&!lt(e[t])&&!Ke(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":lt(e[t])||(n=!(o="nick must be a string")),500<nt(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(nt(e[t])," bytes"),n=!1);break;case"gender":it(Ue,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":Ke(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":lt(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":lt(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":it(Ge,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":Ke(e.language)||(n=!(o="language must be a number"));break;case"avatar":lt(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":it(Pe,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":Ke(e.level)||(n=!(o="level must be a number"));break;case"role":Ke(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}}]),ai),ta=(i(oi,[{key:"set",value:function(e){var t;this.map.size>=this.MAX_LENGTH&&(t=this.map.entries().next().value[0],this.map.delete(t)),this.map.set(e,1)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"reset",value:function(){this.map.clear()}}]),oi),na=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],oa=(i(ni,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)na.indexOf(t)<0||("selfInfo"!==t?("memberNum"===t&&(this.memberCount=e[t]),"maxMemberNum"===t&&(this.maxMemberCount=e[t]),"isSupportTopic"!==t?this[t]=e[t]:this.isSupportTopic=1===e[t]):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(e){var t=this;(e.appid=void 0,e.grossTopicNextMsgSeq=void 0,e.selfInfo&&(e.selfInfo.grossTopicReadSeq=void 0),e=JSON.parse(JSON.stringify(e))).lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),ut(e.muteAllMembers)||("On"===e.muteAllMembers?e.muteAllMembers=!0:e.muteAllMembers=!1),e.groupCustomField&&vt(this.groupCustomField,e.groupCustomField),ut(e.memberNum)||(this.memberCount=e.memberNum),ut(e.maxMemberNum)||(this.maxMemberCount=e.maxMemberNum),ut(e.isSupportTopic)||(this.isSupportTopic=Ke(e.isSupportTopic)?1===e.isSupportTopic:e.isSupportTopic),Qe(this,e,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),We(e.members)&&0<e.members.length&&e.members.forEach((function(e){e.userID===t.selfInfo.userID&&Qe(t.selfInfo,e,["sequence"])}))}},{key:"updateSelfInfo",value:function(e){e={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList},Qe(this.selfInfo,t({},e),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),ni),aa=(i(ti,[{key:"toAccount",get:function(){return this.conversationID.startsWith(S.CONV_C2C)?this.conversationID.replace(S.CONV_C2C,""):this.conversationID.startsWith(S.CONV_GROUP)?this.conversationID.replace(S.CONV_GROUP,""):""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}})),ut(this.userProfile)&&this.type===S.CONV_C2C?this.userProfile=new ea({userID:e.conversationID.replace("C2C","")}):ut(this.groupProfile)&&this.type===S.CONV_GROUP&&(this.groupProfile=new oa({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e){var t=e.nextUnreadCount,n=e.isFromGetConversations;e=e.isUnreadC2CMessage,ut(t)||(It(this.subType)?this.unreadCount=0:n&&this.type===S.CONV_GROUP||n&&this.type===S.CONV_TOPIC||e&&this.type===S.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=qo(e)}},{key:"updateGroupAtInfoList",value:function(e){var t;this._isNeedMergeGroupAtInfo(e)||(-1!==(t=(_(t=e.groupAtType)||y(t)||E(t)||k()).slice(0)).indexOf(S.CONV_AT_ME)&&-1!==t.indexOf(S.CONV_AT_ALL)&&(t=[S.CONV_AT_ALL_AT_ME]),t={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:t,__random:e.__random,__sequence:e.__sequence},this.groupAtInfoList.push(t))}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t,n=e.groupID,o=e.sequence;return!!Et({groupID:n})&&(t=!1,this.groupAtInfoList.forEach((function(n){n.messageSequence===o&&(-1<n.atTypeArray.indexOf(S.CONV_AT_ME)&&-1<e.groupAtType.indexOf(S.CONV_AT_ALL)&&(n.atTypeArray=[S.CONV_AT_ALL_AT_ME]),-1<n.atTypeArray.indexOf(S.CONV_AT_ALL)&&-1<e.groupAtType.indexOf(S.CONV_AT_ME)&&(n.atTypeArray=[S.CONV_AT_ALL_AT_ME],n.__random=e.__random,n.__sequence=e.__sequence),t=!0)})),t)}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){var t=e.sequence;return e=e.time,this.type===S.CONV_C2C&&t===this.lastMessage.lastSequence&&e===this.lastMessage.lastTime||this.type===S.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}},{key:"setDraftText",value:function(e){this.draftText=e}}]),ti),ia=(s(ee={},S.MSG_REMIND_ACPT_AND_NOTE,0),s(ee,S.MSG_REMIND_DISCARD,1),s(ee,S.MSG_REMIND_ACPT_NOT_NOTE,2),ee),sa=(i(ei,[{key:"onAllRcvMsgOptNotify",value:function(e){e=this._handleResult(e),this._convM.emitOEvt(M.ALL_RECEIVE_MESSAGE_OPT_UPDATED,e)}},{key:"getC2CMsgRemindType",value:function(e){var t=this,n="".concat(this._n,".getC2CMsgRemindType");return this._convM.req({P:Gn.GET_C2C_PEER_MUTE_NOTIFICATIONS,data:{toAccount:this._convM.getMyUserID(),userIDList:e}}).then((function(o){Le.l("".concat(n," ok. userIDList:").concat(e)),o=o.data.muteFlagList,t._convM.onC2CMsgRemindTypeFetched(o)})).catch((function(e){Le.e("".concat(n," failed. error:"),e)}))}},{key:"set",value:function(e){return e.groupID?this._setGroupMsgRemindType(e):We(e.userIDList)?this._setC2CMsgRemindType(e):void 0}},{key:"_setGroupMsgRemindType",value:function(e){var t=this,n="".concat(this._n,".").concat("_setGroupMsgRemindType"),o=e.groupID,a=e.messageRemindType,i="groupID:".concat(o," messageRemindType:").concat(a),s=new Zn("_setGroupMsgRemindType"),r=(s.setMessage(i),this._get(7));return r?r.modifyGroupMemberInfo({groupID:o,messageRemindType:a,userID:this._convM.getMyUserID()}).then((function(){s.end(),Le.l("".concat(n," ok. ").concat(i));var o=t.onGroupMsgRemindTypeUpdated(e);return t._convM.onTotalUnreadCountUpdate(),_n(o)})).catch((function(e){return s.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)})):In({code:Un.NO_MODULE})}},{key:"onGroupMsgRemindTypeUpdated",value:function(e){var t,n,o=e.groupID,a=(e=e.messageRemindType,Le.l("".concat(this._n,".onGroupMsgRemindTypeUpdated groupID:").concat(o," messageRemindType:").concat(e)),this._get(7).getLocalGroupProfile(o));return a&&(a.selfInfo.messageRemindType=e),Ct(o)?(t=Gt(n=o),(n=this._get(10).getLocalTopic(t,n))&&n.updateSelfInfo({messageRemindType:e})&&this._convM.emitOEvt(M.TOPIC_UPDATED,{groupID:t,topic:n}),{topic:n}):(this._convM.patchMsgRemindType({ID:o,isC2CConversation:!1,messageRemindType:e})&&this._emitConvUpdate(),{group:a})}},{key:"_setC2CMsgRemindType",value:function(e){var t=this,n="".concat(this._n,".").concat("_setC2CMsgRemindType"),o=e.userIDList,a=e.messageRemindType,i=o.slice(0,30),s=(e=ia[a]||0,"userIDList:".concat(i," messageRemindType:").concat(a)),r=new Zn("_setC2CMsgRemindType");return r.setMessage(s),this._convM.req({P:Gn.SET_C2C_PEER_MUTE_NOTIFICATIONS,data:{userIDList:i,muteFlag:e}}).then((function(e){r.end(),e=e.data.errorList;var o=[],c=[],l=(We(e)&&e.forEach((function(e){o.push(e.userID),c.push({userID:e.userID,code:e.errorCode})})),e=i.filter((function(e){return-1===o.indexOf(e)})),Le.l("".concat(n," ok. ").concat(s," successUserIDList:").concat(e," failureUserIDList:").concat(JSON.stringify(c))),0);return e.forEach((function(e){t._convM.patchMsgRemindType({ID:e,isC2CConversation:!0,messageRemindType:a})&&(l+=1)})),1<=l&&t._emitConvUpdate(),i.length=o.length=0,t._convM.onTotalUnreadCountUpdate(),yn({successUserIDList:e.map((function(e){return{userID:e}})),failureUserIDList:c})})).catch((function(e){return r.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"_get",value:function(e){return this._convM.get(e)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"setAllRcvMsgOpt",value:function(e){var t="".concat(this._n,".").concat("setAllRcvMsgOpt"),n=void 0===(n=e.messageRemindType)?S.MSG_REMIND_ACPT_NOT_NOTE:n,o=void 0===(o=e.isRepeated)||o,a=void 0===(a=(i=this._calcStartAndEndTime(e)).startTime)?0:a,i=void 0===(i=i.endTime)?0:i,s=(e=JSON.stringify(e),new Zn("setAllRcvMsgOpt"));return s.setMessage(e),Le.l("".concat(t," options:").concat(e)),this._convM.req({P:Gn.SET_ALL_RECEIVE_MSG_OPT,data:{messageRemindType:ia[n],startTime:a,endTime:i,isRepeated:o?1:0}}).then((function(e){return s.end(),Le.l("".concat(t," ok.")),_n(e)})).catch((function(e){return s.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"_calcStartAndEndTime",value:function(e){var t=void 0===(t=e.startHour)?0:t,n=void 0===(n=e.startMinute)?0:n,o=void 0===(o=e.startSecond)?0:o,a=void 0===(a=e.duration)?0:a,i=(e=void 0===(e=e.isRepeated)||e,(r=new Date).getFullYear()),s=r.getMonth(),r=r.getDate();return{startTime:i=Math.round(new Date(i,s,r,t,n,o).getTime()/1e3),endTime:e&&86400<=a?i+86400:i+a}}},{key:"getAllRcvMsgOpt",value:function(){var e=this,t="".concat(this._n,".").concat("getAllRcvMsgOpt"),n=new Zn("getAllRcvMsgOpt");return this._convM.req({P:Gn.GET_ALL_RECEIVE_MSG_OPT,data:{toAccount:this._convM.getMyUserID()}}).then((function(o){return o=o.data,n.setMessage(JSON.stringify(o)).end(),Le.l("".concat(t," ok. data:").concat(JSON.stringify(o))),_n(o=e._handleResult(o))})).catch((function(e){return n.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"_handleResult",value:function(e){var t=e.messageRemindType,n=e.startTime,o=e.endTime,a=(e=e.isRepeated,S.MSG_REMIND_ACPT_AND_NOTE);return 1===t&&(a=S.MSG_REMIND_DISCARD),{messageRemindType:a=2===t?S.MSG_REMIND_ACPT_NOT_NOTE:a,startTime:n,endTime:o,isRepeated:1===e}}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),ei),ra=(i(Qa,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),o=e.conversationIDList,a=e.customData,i=(Le.l("".concat(n," options:"),e),new Zn("setConvCustomData")),s=(i.setMessage(JSON.stringify(e)),{fromAccount:this._getMyUserID(),itemList:[]}),r=[],c=[];return o.forEach((function(e){var n;return t._hasLocalConv(e)?kt(e)||Tt(e)?(n={operationType:2,contactItem:void 0,customMark:a},kt(e)?n.contactItem={type:1,toAccount:e.replace(S.CONV_C2C,"")}:Tt(e)&&(n.contactItem={type:2,groupID:e.replace(S.CONV_GROUP,"")}),void s.itemList.push(n)):(t._onConvIDInvalid(c,e),!0):(t._onConvNotFound(c,e),!0)})),c.length===o.length?yn({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({P:Gn.SET_CONV_CUSTOM_DATA,data:s}).then((function(e){var o,s,l;return i.end(),Le.l("".concat(n," ok")),We(e=e.data.resultItem)&&(l=!1,e.forEach((function(e){o=t._concatConvID(e.contactItem),0===e.resultCode?(r.push(o),(s=t._getLocalConv(o))&&s.customData!==a&&(s.customData=a,l=!0)):c.push({conversationID:o,code:e.resultCode,message:e.resultInfo})})),!0===l)&&t._emitConvUpdate(),_n({successConversationIDList:r,failureConversationIDList:c})})).catch((function(e){return i.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"markConv",value:function(e){var t,n,o,a,i,s,r,c,l,u,d=this;return this._convM.canIUse(P.CONV_MARK)?(t="".concat(this._n,".").concat("markConv"),n=e.conversationIDList,o=e.markType,a=e.enableMark,Le.l("".concat(t," options:"),e),i=new Zn("markConv"),s=void i.setMessage(JSON.stringify(e)),r=void 0,e=this._getFlagBit(o),!0===a?r=[e]:s=[e],c={fromAccount:this._getMyUserID(),itemList:[]},l=[],u=[],n.forEach((function(e){var t;return d._hasLocalConv(e)?kt(e)||Tt(e)?(t={operationType:1,contactItem:void 0,clearMark:s,setMark:r},kt(e)?t.contactItem={type:1,toAccount:e.replace(S.CONV_C2C,"")}:Tt(e)&&(t.contactItem={type:2,groupID:e.replace(S.CONV_GROUP,"")}),void c.itemList.push(t)):(d._onConvIDInvalid(u,e),!0):(d._onConvNotFound(u,e),!0)})),u.length===n.length?yn({successConversationIDList:l,failureConversationIDList:u}):this._convM.req({P:Gn.MARK_CONV,data:c}).then((function(e){var n,s,r;return i.end(),Le.l("".concat(t," ok")),We(e=e.data.resultItem)&&(r=!1,e.forEach((function(e){var t;n=d._concatConvID(e.contactItem),0===e.resultCode?(l.push(n),(s=d._getLocalConv(n))&&(t=s.markList.indexOf(o),!0===a?-1===t&&(s.markList.push(o),r=!0):-1!==t&&(s.markList.splice(t,1),r=!0))):u.push({conversationID:n,code:e.resultCode,message:e.resultInfo})})),!0===r)&&d._emitConvUpdate(),_n({successConversationIDList:l,failureConversationIDList:u})})).catch((function(e){return i.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._convM.noUse("markConv")}},{key:"getLocalConvGroupList",value:function(){var e=this;return Le.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===bn?this.getRemoteConvGroupList().then((function(){return _n(v(e._convGroupMap.values()))})):yn(v(this._convGroupMap.values()))}},{key:"searchConvGroupAndMark",value:function(e,t){var n=this,o="".concat(this._n,".searchConvGroupAndMark"),a=[];return e.forEach((function(e){1===t?a.push({type:1,toAccount:e}):2===t&&a.push({type:2,groupID:e})})),Le.l("".concat(o," type:").concat(t," list:"),e),this._convM.req({P:Gn.SEARCH_CONV_GRP_MARK,data:{fromAccount:this._getMyUserID(),contactItem:a}}).then((function(e){var t=(e=e.data).contactItem;e=e.groupItem,Le.l("".concat(o," ok. contactItem:"),t,"groupItem:",e),n._fillConvGroupMap(e),n._handleContactItem(t),n._emitConvUpdate()})).catch((function(e){Le.w("".concat(o," failed. error:"),e)}))}},{key:"_fillConvGroupMap",value:function(e){var t=this;We(e)&&e.forEach((function(e){var n=e.convGroupID;e=e.groupName,t._convGroupMap.set(n,e)}))}},{key:"_handleContactItem",value:function(e){var t,n=this;We(e)&&e.forEach((function(e){var o=[],a=e.standardMark,i=e.customData,s=e.convGroupIDList;We(s)&&s.forEach((function(e){n._convGroupMap.has(e)&&o.push(n._convGroupMap.get(e))})),t=n._concatConvID(e),(t=n._getLocalConv(t))&&(t.markList=Vt(a),t.customData=i||"",t.conversationGroupList=[].concat(o))}))}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=Sn,this._convM.req({P:Gn.GET_CONV_GRP_LIST,data:{fromAccount:this._getMyUserID(),startIndex:this._startIndex}}).then((function(n){var o=(n=n.data).completeFlag,a=n.contactItem,i=void 0===(i=n.nextStartIndex)?0:i;if(n=n.groupItem,e._startIndex=i,Le.l("".concat(t," completeFlag:").concat(o," nextStartIndex:").concat(i,", groupItem:"),n,"contactItem:",a),e._fillConvGroupMap(n),e._handleContactItem(a),0===o)return e.getRemoteConvGroupList();1===o&&(e._pagingStatus=Dn,e._emitConvUpdate(),e._emitConvGroupListUpdate())})).catch((function(n){e._pagingStatus=bn,Le.w("".concat(t," failed. error:"),n)}))}},{key:"createConvGroup",value:function(e){var t,n,o,a,i,s,r=this;return this._convM.canIUse(P.CONV_GROUP)?(t="".concat(this._n,".").concat("createConvGroup"),Le.l("".concat(t," options:"),e),(n=new Zn("createConvGroup")).setMessage(JSON.stringify(e)),o=e.groupName,e=e.conversationIDList,a={fromAccount:this._getMyUserID(),itemList:[{groupName:o,contactItem:[]}]},i=[],s=[],e.forEach((function(e){return r._hasLocalConv(e)?kt(e)||Tt(e)?void(kt(e)?a.itemList[0].contactItem.push({type:1,toAccount:e.replace(S.CONV_C2C,"")}):Tt(e)&&a.itemList[0].contactItem.push({type:2,groupID:e.replace(S.CONV_GROUP,"")})):(r._onConvIDInvalid(s,e),!0):(r._onConvNotFound(s,e),!0)})),s.length===e.length?yn({successConversationIDList:i,failureConversationIDList:s}):this._convM.req({P:Gn.CREATE_CONV_GRP,data:a}).then((function(e){n.end(),Le.l("".concat(t," ok"));var a,c,l,u=(e=e.data.groupResultItem[0]).groupItem;return e=e.resultItem,Ye(u)&&(r._convGroupMap.set(u.convGroupID,u.groupName),r._emitConvGroupListUpdate()),We(e)&&(l=!1,e.forEach((function(e){a=r._concatConvID(e.contactItem),0===e.resultCode?(i.push(a),(c=r._getLocalConv(a))&&-1===c.conversationGroupList.indexOf(o)&&(c.conversationGroupList.push(o),l=!0)):s.push({conversationID:a,code:e.resultCode,message:e.resultInfo})})),!0===l)&&(r._emitConvUpdate(),r._emitConvGroupListUpdate()),_n({successConversationIDList:i,failureConversationIDList:s})})).catch((function(e){return n.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._convM.noUse("createConvGroup")}},{key:"deleteConvGroup",value:function(e){var t,n,o=this;return this._convM.canIUse(P.CONV_GROUP)?(t="".concat(this._n,".").concat("deleteConvGroup"),Le.l("".concat(t," groupName:").concat(e)),(n=new Zn("deleteConvGroup")).setMessage(e),this._convM.req({P:Gn.DEL_CONV_GRP,data:{fromAccount:this._getMyUserID(),groupName:[e]}}).then((function(a){var i;n.end(),Le.l("".concat(t," ok")),We(a=a.data.groupItem)&&(i=!1,a.forEach((function(e){o._convGroupMap.has(e.convGroupID)&&(o._convGroupMap.delete(e.convGroupID),i=!0)})),!0===i)&&o._emitConvGroupListUpdate(),o._eraseFromConversationGroupList([e])})).catch((function(e){return n.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._convM.noUse("deleteConvGroup")}},{key:"renameConvGroup",value:function(e){var t,n,o,a,i=this;return this._convM.canIUse(P.CONV_GROUP)?(t="".concat(this._n,".").concat("renameConvGroup"),Le.l("".concat(t," options:"),e),(n=new Zn("renameConvGroup")).setMessage(JSON.stringify(e)),o=e.oldName,a=e.newName,this._convM.req({P:Gn.RENAME_CONV_GRP,data:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:o,newName:a}}}).then((function(e){n.end(),Le.l("".concat(t," ok")),e=e.data.updateGroupResult.convGroupID,i._convGroupMap.set(e,a),i._emitConvGroupListUpdate(),e=i._convM.getLocalConvList();var s,r,c=!1;e.forEach((function(e){s=e.conversationGroupList,-1!==(r=s.indexOf(o))&&(s.splice(r,1,a),c=!0)})),!0===c&&i._emitConvUpdate()})).catch((function(e){return n.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._convM.noUse("renameConvGroup")}},{key:"addConvsToGroup",value:function(e){var t,n,o,a,i,s,r,c=this;return this._convM.canIUse(P.CONV_GROUP)?(t="".concat(this._n,".").concat("addConvsToGroup"),Le.l("".concat(t," options:"),e),(n=new Zn("addConvsToGroup")).setMessage(JSON.stringify(e)),o=e.conversationIDList,a=e.groupName,i={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:a,updateItem:[]}},s=[],r=[],o.forEach((function(e){return c._hasLocalConv(e)?kt(e)||Tt(e)?void(kt(e)?i.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:e.replace(S.CONV_C2C,"")}}):Tt(e)&&i.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:e.replace(S.CONV_GROUP,"")}})):(c._onConvIDInvalid(r,e),!0):(c._onConvNotFound(r,e),!0)})),r.length===o.length?yn({successConversationIDList:s,failureConversationIDList:r}):this._convM.req({P:Gn.ADD_CONV_TO_GRP,data:i}).then((function(e){var o,i,l;return n.end(),Le.l("".concat(t," ok")),We(e=e.data.updateGroupResult.contactResultItem)&&(l=!1,e.forEach((function(e){o=c._concatConvID(e.contactItem),0===e.resultCode?(i=c._getLocalConv(o))&&-1===i.conversationGroupList.indexOf(a)&&(i.conversationGroupList.push(a),s.push(o),l=!0):r.push({conversationID:o,code:e.resultCode,message:e.resultInfo})})),!0===l)&&(c._emitConvUpdate(),c._emitConvInGroupUpdate(a)),_n({successConversationIDList:s,failureConversationIDList:r})})).catch((function(e){return n.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._convM.noUse("addConvsToGroup")}},{key:"deleteConvsFromGroup",value:function(e){var t,n,o,a,i,s,r,c=this,l="deleteConvsFromGroup";return this._convM.canIUse(P.CONV_GROUP)?(t="".concat(this._n,".").concat(l),Le.l("".concat(t," options:"),e),(n=new Zn(l)).setMessage(JSON.stringify(e)),o=e.conversationIDList,a=e.groupName,i={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:a,updateItem:[]}},s=[],r=[],o.forEach((function(e){return c._hasLocalConv(e)?kt(e)||Tt(e)?void(kt(e)?i.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:e.replace(S.CONV_C2C,"")}}):Tt(e)&&i.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:e.replace(S.CONV_GROUP,"")}})):(c._onConvIDInvalid(r,e),!0):(c._onConvNotFound(r,e),!0)})),r.length===o.length?yn({successConversationIDList:s,failureConversationIDList:r}):this._convM.req({P:Gn.DEL_CONV_FROM_GRP,data:i}).then((function(e){var o,i,l;return n.end(),Le.l("".concat(t," ok")),We(e=e.data.updateGroupResult.contactResultItem)&&(l=!1,e.forEach((function(e){var t;o=c._concatConvID(e.contactItem),0===e.resultCode?(i=c._getLocalConv(o))&&-1!==(t=i.conversationGroupList.indexOf(a))&&(i.conversationGroupList.splice(t,1),s.push(o),l=!0):r.push({conversationID:o,code:e.resultCode,message:e.resultInfo})})),!0===l)&&(c._emitConvUpdate(),c._emitConvInGroupUpdate(a)),_n({successConversationIDList:s,failureConversationIDList:r})})).catch((function(e){return n.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._convM.noUse(l)}},{key:"onConvMarkUpdated",value:function(e){var t,n,o=this;He(e)||(Le.l("".concat(this._n,".onConvMarkUpdated markItemList:"),e),n=!1,e.forEach((function(e){var a=e.recentContactItem,i=e.optType,s=e.standardMark;e=e.customMark,t=o._concatConvID(a),(t=o._getLocalConv(t))&&(1===i?n=o._diffStandardMark(t,s):2===i?n=o._diffCustomMark(t,e):3===i&&(a=o._diffStandardMark(t,s),i=o._diffCustomMark(t,e),n=a||i))})),!0===n&&this._emitConvUpdate())}},{key:"_diffStandardMark",value:function(e,t){t=Vt(t);var n=!1;return!0!==function(e,t){if(e!==t){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,o=e.length;n<o;n++)if(e[n]!==t[n])return!1}return!0}(e.markList,t)&&(e.markList=t,n=!0),n}},{key:"_diffCustomMark",value:function(e,t){var n=!1;return e.customData!==t&&void 0!==t&&(e.customData=t,n=!0),n}},{key:"onConvGroupCreated",value:function(e){var t=this,n=(Le.l("".concat(this._n,".onConvGroupCreated resultList:"),e),!1),o=!1;We(e)&&(e.forEach((function(e){var a,i,s=(i=e.msgGroupItem).groupID,r=i.groupName;t._convGroupMap.get(s)!==r&&(t._convGroupMap.set(s,r),o=!0),We(i=e.msgRecentContactItem)&&i.forEach((function(e){a=t._concatConvID(e),(a=t._getLocalConv(a))&&-1===a.conversationGroupList.indexOf(r)&&(a.conversationGroupList.push(r),n=!0)}))})),!0===n&&this._emitConvUpdate(),!0===o)&&this._emitConvGroupListUpdate()}},{key:"onConvGroupDeleted",value:function(e){var t,n=this,o=(Le.l("".concat(this._n,".onConvGroupDeleted groupItemList:"),e),[]);We(e)&&(t=!1,e.forEach((function(e){var a=e.groupID;e=e.groupName,n._convGroupMap.has(a)&&(n._convGroupMap.delete(a),t=!0,o.push(e))})),!0===t)&&this._emitConvGroupListUpdate(),this._eraseFromConversationGroupList(o)}},{key:"_eraseFromConversationGroupList",value:function(e){He(e)||(this._convM.getLocalConvList().forEach((function(t){t.conversationGroupList=t.conversationGroupList.filter((function(t){return!e.includes(t)}))})),this._emitConvUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){Le.l("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t,n,o,a=e.groupID,i=e.groupName,s=e.oldGroupName;this._convGroupMap.get(a)!==i&&(this._convGroupMap.set(a,i),this._emitConvGroupListUpdate(),e=this._convM.getLocalConvList(),o=!1,e.forEach((function(e){t=e.conversationGroupList,-1!==(n=t.indexOf(s))&&(t.splice(n,1,i),o=!0)})),!0===o)&&this._emitConvUpdate()}},{key:"onConvInGroupUpdated",value:function(e){var t,n,o,a=this,i=(Le.l("".concat(this._n,".onConvInGroupUpdated options:"),e),e.oldGroupName);We(e=e.recentContactUpdateGroupItem)&&(o=!1,e.forEach((function(e){var s=e.contactOptType;e=e.recentContactItem,t=a._concatConvID(e),(t=a._getLocalConv(t))&&(n=t.conversationGroupList.indexOf(i),1===s?-1===n&&(t.conversationGroupList.push(i),o=!0):2===s&&-1!==n&&(t.conversationGroupList.splice(n,1),o=!0))})),!0===o)&&(this._emitConvUpdate(),this._emitConvInGroupUpdate(i))}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){var t,n,o=this,a=(Le.l("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),e),e.msgRecentContactItem),i=(e=e.msgRecentContactUpdateContactItem,a=this._concatConvID(a),this._getLocalConv(a));i&&We(e)&&(n=!1,e.forEach((function(e){var a=e.groupOptType;e=e.recentContactGroupItem.groupName,t=i.conversationGroupList.indexOf(e),1===a?-1===t&&(i.conversationGroupList.push(e),n=!0):2===a&&-1!==t&&(i.conversationGroupList.splice(t,1),n=!0),!0===n&&o._emitConvInGroupUpdate(e)})),!0===n)&&this._emitConvUpdate()}},{key:"onConvGroupListSynced",value:function(e){We(e)&&0!==e.length&&(Le.l("".concat(this._n,".onConvGroupListSynced groupItem:"),e),this._fillConvGroupMap(e))}},{key:"getConvGroupListByID",value:function(e){var t,n=this;if(!He(e))return t=[],e.forEach((function(e){n._convGroupMap.has(e)&&t.push(n._convGroupMap.get(e))})),t}},{key:"_onConvNotFound",value:function(e,t){e.push({conversationID:t,code:Un.CONV_NOT_FOUND,message:this._convM.getErrMsg(Un.CONV_NOT_FOUND)})}},{key:"_onConvIDInvalid",value:function(e,t){e.push({conversationID:t,code:Un.INVALID_CONV_ID,message:this._convM.getErrMsg(Un.INVALID_CONV_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,o=n-1;0<=o;o--)if("1"===t[o])return n-o-1}},{key:"_concatConvID",value:function(e){var t,n=e.type,o=e.to,a=e.groupID;return e=e.userID,1===n?ut(e)?ut(o)||(t="".concat(S.CONV_C2C).concat(o)):t="".concat(S.CONV_C2C).concat(e):2===n&&(t="".concat(S.CONV_GROUP).concat(a)),t}},{key:"_getMyUserID",value:function(){return this._convM.getMyUserID()}},{key:"_getLocalConv",value:function(e){return this._convM.getLocalConversation(e)}},{key:"_hasLocalConv",value:function(e){return this._convM.hasLocalConversation(e)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._convM.emitOEvt(M.CONVERSATION_GROUP_LIST_UPDATED,v(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._convM.getLocalConvList();t.conversationList=n.filter((function(t){return t.conversationGroupList.includes(e)})),this._convM.emitOEvt(M.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=Mn}}]),Qa),ca=(r(Za,Nn),Xo=m(Za),i(Za,[{key:"_initListeners",value:function(){var e=this.getIEmitInst();e.on(Bo.A2KEY_AND_TINYID_UPDATED,this._init,this),e.on(Bo.PROFILE_UPDATED,this._onProfileUpdated,this),e.on(Bo.CLOUD_CONFIG,this._onCloudConfig,this)}},{key:"_init",value:function(){var e=this,t=(Le.l("".concat(this._n,"._init")),this.get(13).getItem("conversationMap")),n=this.isIntl(),o=this.isUsingChatCore();if(t){for(var a=t.length,i=0;i<a;i++){var s=t[i];if(s){if(this._isNonExistentAccount(s.conversationID))continue;if(s.groupProfile&&It(s.groupProfile.type))continue}this._convMap.set(s.conversationID,new aa(t[i],n,o))}this.emitConvUpdate(!0,!1)}this.ready((function(){0<e._tmpGroupList.length&&(e.updateConvGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)})),this.syncConvList()}},{key:"_isNonExistentAccount",value:function(e){var t;return"@TLS#ERROR"===(t=e.startsWith(S.CONV_C2C)?e.replace(S.CONV_C2C,""):t)||"@TLS#NOT_FOUND"===t}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&this._msgListHandler.onCheckTimer(e)}},{key:"onMessageSent",value:function(e){this._onSendOrRcvMsg({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrRcvMsg(e)}},{key:"_onSendOrRcvMsg",value:function(e){var t=this,n=e.conversationOptionsList,o=void 0===(o=e.isInstantMessage)||o,a=void 0!==(a=e.isUnreadC2CMessage)&&a,i=void 0===(i=e.updateUnreadCount)||i,s=void 0!==(s=e.isSyncingEnded)&&s;this._isReady?0!==n.length?(!0===o&&this._checkNewConv(n),this._updateLocalConvList({conversationOptionsList:n,isInstantMessage:o,isUnreadC2CMessage:a,isFromGetConversations:!1,updateUnreadCount:i}),o||(this._convIDFromUnreadDBMap=new Map([].concat(v(this._convIDFromUnreadDBMap),v(n.map((function(e){return[e.conversationID,1]}))))),this._diffAndDeleteConv(),s&&this.emitIEvt(Bo.C2C_UNREAD_HANDLE_COMPLETED)),0<n.filter((function(e){return!t._isConvNeedShow(e.conversationID)})).length||this.emitConvUpdate()):s&&this.emitIEvt(Bo.C2C_UNREAD_HANDLE_COMPLETED):this.ready((function(){t._onSendOrRcvMsg(e)}))}},{key:"updateConvGroupProfile",value:function(e){var t,n=this;We(e)&&0===e.length||(0!==this._convMap.size?(t=!1,e.forEach((function(e){var o="".concat(S.CONV_GROUP).concat(e.groupID);n._convMap.has(o)&&(t=!0,(o=n._convMap.get(o)).groupProfile=JSON.parse(JSON.stringify(e)),o.lastMessage.lastSequence<e.nextMessageSeq&&(o.lastMessage.lastSequence=e.nextMessageSeq-1),o.subType||(o.subType=e.type))})),t&&this.emitConvUpdate(!0,!1)):this._tmpGroupList=e)}},{key:"onMessageRevoked",value:function(e,t){var n,o,a,i=this;0!==e.length&&(n=null,o=!1,a=[],e.forEach((function(e){(n=i._convMap.get(e.conversationID))&&(t&&n.reduceUnreadCount()&&(o=n.type!==S.CONV_TOPIC),n.type===S.CONV_TOPIC?a.push(e):n.isLastMessageRevoked({sequence:e.sequence,time:e.time})&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),o=!0))})),this.get(10).onMessageRevoked(a),o)&&this.emitConvUpdate(!0,!1)}},{key:"updateRevokerInfo",value:function(e){for(var t=new Set,n=0;n<e.length;n++){var o=e[n].revoker;t.add(o)}var a=v(t),i=this.get(4);return new Promise((function(t){i.getUserProfile({userIDList:a}).then((function(n){if(!We(n=n.data)||0===n.length)return t(e);var o,a={},i=T(n);try{for(i.s();!(o=i.n()).done;){var s=o.value,r=s.userID,c=s.nick,l=s.avatar;a[r]={nick:c,avatar:l}}}catch(u){i.e(u)}finally{i.f()}e.forEach((function(e){var t=e.revoker;a[t]&&(e.revokerInfo.nick=a[t].nick||"",e.revokerInfo.avatar=a[t].avatar||"")})),t(e)})).catch((function(){t(e)}))}))}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,o=e.sequence,a=e.time,i=this._convMap.get(n);return i&&(t=i.type===S.CONV_TOPIC?this.get(10).isLastMessageRevoked({topicID:n.replace(S.CONV_GROUP,""),sequence:o}):i.isLastMessageRevoked({sequence:o,time:a})),Le.l("".concat(this._n,".isLastMessageRevoked options:"),e,"ret:".concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(0!==e.length){var n=null;e.forEach((function(e){(n=t._msgListHandler.getLocalMsg(e.conversationID,e.ID))&&(n.isDeleted=!0),e!==n&&(e.isDeleted=!0)})),e=e[0].conversationID;for(var o=this._msgListHandler.getLocalMsgList(e),a={},i=o.length-1;0<=i;i--)if(!o[i].isDeleted){a=o[i];break}var s,r=this._convMap.get(e);r&&(s=!1,r.lastMessage.lastSequence===a.sequence&&r.lastMessage.lastTime===a.time||(He(a)&&(a=void 0),r.updateLastMessage(a),r.type!==S.CONV_TOPIC&&(s=!0),Le.l("".concat(this._n,".onMessageDeleted. update convID:").concat(e," with lastMessage:"),r.lastMessage)),e.startsWith(S.CONV_C2C)&&this.updateUnreadCount(e),s)&&this.emitConvUpdate(!0,!1)}}},{key:"onMessageModified",value:function(e){var t="".concat(this._n,".onMessageModified"),n=e.conversationType,o=e.from,a=e.to,i=e.time,s=e.sequence,r=e.elements,c=e.cloudCustomData,l=e.messageVersion,u=this.getMyUserID(),d="".concat(n).concat(a),p=(n=(a===u&&n===S.CONV_C2C&&(d="".concat(n).concat(o)),u=this._msgListHandler.onMsgModified(d,e)).isUpdated,u=u.message,!0===n&&this.emitOEvt(M.MESSAGE_MODIFIED,[u]),this._isTopicConv(d));return null===u?Le.l("".concat(t," message is null! options:"),e):Le.l("".concat(t," isUpdated:").concat(n," isTopicMessage:").concat(p," from:").concat(o," to:").concat(a," sequence:").concat(u.sequence," time:").concat(u.time)),p?this.get(10).onMessageModified(e):(n=this._convMap.get(d))&&(o=n.lastMessage)&&o.lastTime===i&&o.lastSequence===s&&o.version!==l&&(Le.l("".concat(t," convID:").concat(d," lastMessage updated")),o.type=r[0].type,o.payload=r[0].content,o.messageForShow=xt(o.type,o.payload,this.isIntl()),o.cloudCustomData=c,o.version=l,this.emitConvUpdate(!0,!1)),u}},{key:"onNewGroupAtTips",value:function(e){var n=this,o=(e=e.dataList,null);e.forEach((function(e){e.groupAtTips?o=e.groupAtTips:e.elements?o=t(t({},e.elements),{},{sync:!0}):e.groupAtType&&(o=t(t({},e),{},{sync:!0})),o.__random=e.random,o.__sequence=e.clientSequence,n._tmpGroupAtTipsList.push(o)})),Le.l("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e,t=this;0!==this._tmpGroupAtTipsList.length&&(e=!1,this._tmpGroupAtTipsList.forEach((function(n){var o,a=n.groupID,i=n.from,s=void 0===(s=n.topicID)?void 0:s,r=void 0!==(r=n.sync)&&r;i!==t.getMyUserID()&&(ut(s)?(i=t._convMap.get("".concat(S.CONV_GROUP).concat(a)))&&(i.updateGroupAtInfoList(n),e=!0):((a=t._convMap.get("".concat(S.CONV_GROUP).concat(s)))&&(a.updateGroupAtInfoList(n),i=t.get(10),o=a.groupAtInfoList,i.onAtInfoUpdated({topicID:s,groupAtInfoList:o})),He(a)&&r&&(t.updateTopicConversation([{conversationID:"".concat(S.CONV_GROUP).concat(s),type:S.CONV_TOPIC}]),t._convMap.get("".concat(S.CONV_GROUP).concat(s)).updateGroupAtInfoList(n))))})),e&&this.emitConvUpdate(!0,!1),this._tmpGroupAtTipsList.length=0)}},{key:"_checkNewConv",value:function(e){var t=this,n=[],o=[];e.forEach((function(e){t._convMap.has(e.conversationID)||(e.type===S.CONV_C2C?n.push(e.conversationID.replace(S.CONV_C2C,"")):e.type===S.CONV_GROUP&&o.push(e.conversationID.replace(S.CONV_GROUP,"")))})),0<n.length&&(this._onNewC2CConv(n),n=null),0<o.length&&(this._onNewGroupConv(o),o=null)}},{key:"_onNewC2CConv",value:function(e){var t=this.get(6);return Promise.all([t.getRemotePeerReadTime(e),this._msgRemindHandler.getC2CMsgRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,1)])}},{key:"_onNewGroupConv",value:function(e){var t=this.get(7);return t?Promise.all([t.getMsgRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,2)]):Promise.resolve()}},{key:"_setStorageConvList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=this.getLocalConvList().filter((function(e){return e.type===S.CONV_C2C||e.type===S.CONV_GROUP&&e.lastMessage.type!==S.MSG_GRP_TIP})).slice(0,20).map((function(e){return{conversationID:e.conversationID,type:e.type,subType:e.subType,lastMessage:e.lastMessage,groupProfile:e.groupProfile,userProfile:e.userProfile}}));this.get(13).setItem("conversationMap",t,e)}},{key:"emitConvUpdate",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.getLocalConvList();t&&(t=this.get(7))&&t.updateGroupLastMessage(n),e&&(this.get(12).isPartialUpdatedConvs()?(this._diffConvMap(this._convMapForDiff,this._convMap),0<this._partialUpdatedConvMap.size&&(this.emitOEvt(M.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate(),this._convMapForDiff.clear(),this._convMapForDiff=et(this._convMap,!0)),0===this._convMapForDiff.size&&(this._convMapForDiff=et(this._convMap,!0))):(this.emitOEvt(M.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate()))}},{key:"_diffConvMap",value:function(e,t){var n,o=T(t);try{for(o.s();!(n=o.n()).done;){var a=f(n.value,2),i=a[0],s=a[1];e.has(i)&&JSON.stringify(s)===e.get(i)||this._partialUpdatedConvMap.set(i,s)}}catch(r){o.e(r)}finally{o.f()}}},{key:"getPartialUpdatedConvs",value:function(){var e=v(et(this._partialUpdatedConvMap,!1).values());return this._partialUpdatedConvMap.clear(),e}},{key:"getLocalConvList",value:function(){var e=this;return v(this._convMap.values()).filter((function(t){return e._isConvNeedShow(t.conversationID)}))}},{key:"getLocalConversation",value:function(e){return this._convMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._convMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._msgListHandler.getLocalOldestMsg(e)}},{key:"syncConvList",value:function(){var e=this,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n="syncConvList",o=new Zn(n);return this._pagingStatus===Mn&&this._convMap.clear(),this._pagingGetConvList(t).then((function(t){var a=qt(e._pagingGetCostList),i=jt(e._pagingGetCostList);return e._pagingGetCostList.length=0,e._pagingStatus=Dn,e._diffAndDeleteConv(),e.emitConvUpdate(!0,!1),e._setStorageConvList(),e._handleC2CPeerReadTime(),e.emitIEvt(Bo.CONV_SYNC_COMPLETED),i="count:".concat(e._convMap.size," sum:").concat(i," avg:").concat(a),Le.l("".concat(e._n,".").concat(n,". ").concat(i)),o.setMessage(i).end(),t})).catch((function(t){return e._pagingStatus=bn,o.setMessage(e._pagingTs).setError(t).end(),In(t)}))}},{key:"_diffAndDeleteConv",value:function(){var e,t=this;this._isSyncCompleted()&&(e=[],this._convMap.forEach((function(n,o){!t._pagingConvIDMap.has(o)&&t._convIDFromUnreadDBMap.has(o)&&(t._convMap.delete(o),e.push(o))})),Le.l("".concat(this._n,"._diffAndDeleteConv list:").concat(e)),e=null)}},{key:"_pagingGetConvList",value:function(){var e=this,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n="".concat(this._n,"._pagingGetConvList"),o=(Le.l("".concat(n," incrementalPullFlag:").concat(t," ts:").concat(this._pagingTs," startIdx:").concat(this._pagingStartIdx)+" pinnedTs:".concat(this._pagingPinnedTs," pinnedStartIdx:").concat(this._pagingPinnedStartIdx)),Date.now());return this._pagingStatus=Sn,this.req({P:Gn.PAGING_GET_CONV_LIST,data:{fromAccount:this.getMyUserID(),timeStamp:t?this._pagingTs:0,startIndex:t?this._pagingStartIdx:0,pinnedTimeStamp:t?this._pagingPinnedTs:0,pinnedStartIndex:t?this._pagingPinnedStartIdx:0,orderType:1}}).then((function(t){var a=(t=t.data).completeFlag,i=void 0===(i=t.conversations)?[]:i,s=t.timeStamp,r=t.startIndex,c=t.pinnedTimeStamp,l=t.pinnedStartIndex;if(t=t.groupItem,e._pagingGetCostList.push(zt(o,!1)),Le.l("".concat(n," ok. completeFlag:").concat(a," count:").concat(i.length," cost:").concat(zt(o))),e._convGroupHandler.onConvGroupListSynced(t),0<i.length&&(t=e._getConvOptions(i),e._pagingConvIDMap=new Map([].concat(v(e._pagingConvIDMap),v(t.map((function(e){return[e.conversationID,1]}))))),e._updateLocalConvList({conversationOptionsList:t,isFromGetConversations:!0,updateUnreadCount:!0}),e.isLoggedIn())&&e.emitConvUpdate(),!e._isReady){if(!e.isLoggedIn())return yn();e.triggerReady()}return e._pagingTs=s,e._pagingStartIdx=r,e._pagingPinnedTs=c,e._pagingPinnedStartIdx=l,1!==a?e._pagingGetConvList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),yn())})).catch((function(t){throw!e.isLoggedIn()||e._isReady||(Le.w("".concat(n," failed. error:"),t),e.triggerReady()),t}))}},{key:"_updateLocalConvList",value:function(e){var t=e.isFromGetConversations,n=Date.now();e=this._getTmpConvListMapping(e).newConvList,this._convMap=new Map(this._sortConvList(v(this._convMap))),t||this._updateUserOrGroupProfile(e),Le.l("".concat(this._n,"._updateLocalConvList cost:").concat(zt(n)))}},{key:"_getTmpConvListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,o=e.isInstantMessage,a=e.isUnreadC2CMessage,i=void 0!==a&&a,s=e.updateUnreadCount,r=[],c=[],l=this.get(7),u=this.get(8),d=this.isIntl(),p=this.isUsingChatCore(),h=0,g=t.length;h<g;h++){var m=new aa(t[h],d,p),f=m.conversationID,v=m.type;if(!this._isNonExistentAccount(f)){if(this._convMap.has(f)){var _=this._convMap.get(f);if(n){this._convMap.set(f,m),v===S.CONV_C2C?m.unreadCount=_.unreadCount:v===S.CONV_GROUP&&(m.groupProfile=JSON.parse(JSON.stringify(_.groupProfile)));continue}var y=["unreadCount","allowType","adminForbidType","payload"],I=(!1===o&&y.push("lastMessage"),"boolean"==typeof o&&y.push("isPinned"),t[h].lastMessage),E=!ut(I);E||t[h].type===S.CONV_TOPIC||this._onLastMsgNotExist(t[h]),ut(o)&&E&&null===_.lastMessage.payload&&(_.lastMessage.payload=I.payload),He(_.lastMessage.revoker)||(_.lastMessage.revoker=null),Qe(_,m,y,[null,void 0,"",0,NaN]),!0===s&&_.updateUnreadCount({nextUnreadCount:m.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:i}),o&&E&&(I.payload&&(_.lastMessage.payload=I.payload),_.type===S.CONV_GROUP)&&(_.lastMessage.nameCard=I.nameCard,_.lastMessage.nick=I.nick),E&&_.lastMessage.cloudCustomData!==I.cloudCustomData&&(_.lastMessage.cloudCustomData=I.cloudCustomData||"")}else v===S.CONV_GROUP&&l?(y=m.groupProfile.groupID,(E=l.getLocalGroupProfile(y))&&(m.groupProfile=E,!0===s)&&m.updateUnreadCount({nextUnreadCount:0})):v===S.CONV_C2C&&(_=f.replace(S.CONV_C2C,""),u)&&u.isMyFriend(_)&&(m.remark=u.getFriendRemark(_)),r.push(m),this._convMap.set(f,m);this._convMap.get(f).type===S.CONV_TOPIC&&c.push(this._convMap.get(f))}}for(var C=this.get(10),k=0,T=c.length;k<T;k++){var M,D=(M=c[k]).conversationID;He(M=M.groupAtInfoList)||C.onAtInfoUpdated({topicID:D.replace(S.CONV_GROUP,""),groupAtInfoList:M})}return{newConvList:r}}},{key:"_onLastMsgNotExist",value:function(e){new Zn("lastMsgNotExist").setMessage(JSON.stringify(e)).end()}},{key:"_sortConvList",value:function(e){var t=[],n=[],o=[],a=[];return e.forEach((function(e){(!0===e[1].isPinned?He(e[1].lastMessage.lastTime)?n:t:He(e[1].lastMessage.lastTime)?a:o).push(e)})),t.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})).concat(n).concat(o.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}))).concat(a)}},{key:"_sortConvListAndEmitEvent",value:function(){this._convMap=new Map(this._sortConvList(v(this._convMap))),this.emitConvUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t,n,o,a,i=this;0!==e.length&&(t=[],n=[],o=this.get(4),a=this.get(7),e.forEach((function(e){var o;e.type===S.CONV_C2C?t.push(e.toAccount):e.type===S.CONV_GROUP&&(o=e.toAccount,a.hasLocalGroup(o)?e.groupProfile=a.getLocalGroupProfile(o):n.push(o))})),Le.l("".concat(this._n,"._updateUserOrGroupProfile userIDList:").concat(t," groupIDList:").concat(n)),0<t.length&&o.getUserProfile({userIDList:t}).then((function(e){We(e=e.data)?e.forEach((function(e){i._doUpdateUserProfile("".concat(S.CONV_C2C).concat(e.userID),e)})):i._doUpdateUserProfile("".concat(S.CONV_C2C).concat(e.userID),e)})),0<n.length)&&a.getGroupProfileAdvance({groupIDList:n,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then((function(e){e=e.data.successGroupList;var t=!1;e.forEach((function(e){var n="".concat(S.CONV_GROUP).concat(e.groupID);i._convMap.has(n)&&(Qe((n=i._convMap.get(n)).groupProfile,e,[],[null,void 0,"",0,NaN]),!n.subType&&e.type&&(n.subType=e.type),t=!0)})),t&&i.emitConvUpdate()}))}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t,this.emitConvUpdate())}},{key:"_getConvOptions",value:function(e){var n=this,o=[],a=(e=e.filter((function(e){var t=e.type;return e=e.userID,1===t&&!n._isNonExistentAccount(e)||2===t})),this.getMyUserID());return e=e.map((function(e){var i;return ut(e.lastMsg)&&(e.lastMsg={elements:[]}),1===e.type?(i={userID:e.userID,nick:e.peerNick,avatar:e.peerAvatar},o.push(i),{conversationID:"".concat(S.CONV_C2C).concat(e.userID),type:S.CONV_C2C,lastMessage:{lastTime:e.time,lastSequence:e.sequence,fromAccount:e.lastC2CMsgFromAccount,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?n._amendLayersOverLimitProp(e.lastMsg.elements[0].content):null,cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:8===e.lastMessageFlag,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:e.lastC2CMsgFromAccount===a&&e.time<=e.c2cPeerReadTime,revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null},unreadCount:0,userProfile:new ea(i),peerReadTime:e.c2cPeerReadTime,isPinned:1===e.isPinned,customData:e.customMark||"",markList:Vt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId),remark:e.friendRemark||"",messageRemindType:n._transMsgRemindType(e.messageRemindType)}):{conversationID:"".concat(S.CONV_GROUP).concat(e.groupID),type:S.CONV_GROUP,lastMessage:t(t({lastTime:e.time,lastSequence:e.sequence,fromAccount:e.msgGroupFromAccount},n._patchTypeAndPayload(e)),{},{cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:2===e.lastMessageFlag,onlineOnlyFlag:!1,nick:e.senderNick||"",nameCard:e.senderNameCard||"",revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null}),groupProfile:new oa({groupID:e.groupID,name:e.groupNick,avatar:e.groupImage,type:e.groupType,nextMessageSeq:e.nextMessageSeq}),unreadCount:n._computeGroupUnreadCount(e),peerReadTime:0,isPinned:1===e.isPinned,version:0,customData:e.customMark||"",markList:Vt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId),messageRemindType:n._transMsgRemindType(e.messageRemindType)}})),0<o.length&&this.get(4).onConvProfileUpdated(o),e}},{key:"_transMsgRemindType",value:function(e){var t="";return 0===e?t=S.MSG_REMIND_ACPT_AND_NOTE:1===e?t=S.MSG_REMIND_DISCARD:2===e?t=S.MSG_REMIND_ACPT_NOT_NOTE:3===e&&(t=S.NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT),t}},{key:"_computeGroupUnreadCount",value:function(e){var t;return 0<(t=(void 0===(t=e.unreadCount)?0:t)-(void 0===(e=e.noUnreadCount)?0:e))?t:0}},{key:"_patchTypeAndPayload",value:function(e){var n=(e=e.lastMsg).event,o=void 0===(o=e.elements)?[]:o;return e=void 0===(e=e.groupTips)?{}:e,ut(void 0===n?void 0:n)||He(e)?{type:o[0]?o[0].type:null,payload:o[0]?this._amendLayersOverLimitProp(o[0].content):null}:((n=new ko(e)).setElement({type:S.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}),o=JSON.parse(JSON.stringify(n.payload)),n=null,{type:S.MSG_GRP_TIP,payload:o})}},{key:"_amendLayersOverLimitProp",value:function(e){var t=e.layersOverLimit;return 0===t?e.layersOverLimit=!1:1===t&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._msgListHandler.getLocalMsgList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof ko&&this._msgListHandler.remove(e)}},{key:"onConvDeleted",value:function(e){We(e)&&(e=e.map((function(e){var t=e.type,n=e.userID;return e=e.groupID,1===t?"".concat(S.CONV_C2C).concat(n):2===t?"".concat(S.CONV_GROUP).concat(e):void 0})),Le.l("".concat(this._n,".onConvDeleted convIDList:").concat(e)),this.deleteLocalConvList(e))}},{key:"onConvPinnedStatus",value:function(e,t){var n,o=this;We(e)&&(n=!1,e.forEach((function(e){var a,i=e.type,s=e.userID;e=e.groupID,1===i?a=o.getLocalConversation("".concat(S.CONV_C2C).concat(s)):2===i&&(a=o.getLocalConversation("".concat(S.CONV_GROUP).concat(e))),a&&(Le.l("".concat(o._n,".onConvPinnedStatus convID:").concat(a.conversationID," localPinned:").concat(a.isPinned," remotePinned:").concat(t)),t?a.isPinned||(a.isPinned=!0,n=!0):a.isPinned&&(a.isPinned=!1,n=!0))})),n)&&this._sortConvListAndEmitEvent()}},{key:"getMessageList",value:function(e){var t=this,n=e.conversationID,o=e.nextReqMessageID,a=(e=e.count,"".concat(this._n,".getMessageList")),i="";if((r=this.getLocalConversation(n))&&r.groupProfile&&(i=r.groupProfile.type),It(i))return Le.l("".concat(a," not available in ").concat(i,". convID:").concat(n)),yn({messageList:[],nextReqMessageID:"",isCompleted:!0});(ut(e)||15<e)&&(e=15),o||this._isMeInCommunity(n)||this.clearMemMsg(n);var s=this._computeRemainingCount({conversationID:n,nextReqMessageID:o}),r=this._completedMap.has(n);return Le.l("".concat(a," convID:").concat(n," isEverCleared:").concat(this._isEverCleared(n)," nextReqMessageID:").concat(o)+" remainingCount:".concat(s," count:").concat(e," isCompleted:").concat(r)),this._needGetHistory({conversationID:n,remainingCount:s,count:e})?this.getHistoryMessages({conversationID:n,nextReqMessageID:o,count:20}).then((function(e){var o=e.nextReqID,i=e.storedMessageList,r=e.assembledMessageList,c=(e=e.isPullingCompleted,t._completedMap.has(n)),l=i,u=(0<s&&(l=t._msgListHandler.getLocalMsgList(n).slice(0,i.length+s)),{nextReqMessageID:void 0,messageList:void 0,isCompleted:void 0});return t._isEverCleared(n)?(u.nextReqMessageID=o,u.messageList=r,u.isCompleted=e):(u.nextReqMessageID=c?"":o,u.messageList=l,u.isCompleted=c),i=u.messageList.filter((function(e){return e.isRevoked}))||[],r=u.messageList.map((function(e){return e.sequence})),Le.l("".concat(a," ret.nextReqMessageID:").concat(u.nextReqMessageID," ret.isCompleted:").concat(u.isCompleted," sequenceList:"),r),We(i)&&0!==i.length?t.updateRevokerInfo(i).then((function(e){return e.forEach((function(e){var t=e.revokerInfo;u.messageList=u.messageList.map((function(n){return n.ID===e.ID&&t&&(n.revokeReason=t.reason||"",n.revokerInfo={userID:t.revoker||n.revoker,nick:t.nick,avatar:t.avatar}),n}))})),_n(u)})):_n(u)})):(this.modifyMessageList(n),yn(i=this._getMsgListFromMem({conversationID:n,nextReqMessageID:o,count:e})))}},{key:"_isEverCleared",value:function(e){return this._everClearedMap.has(e)}},{key:"_getMsgListFromMem",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,o=(e=e.count,"".concat(this._n,"._getMsgListFromMem")),a=this._msgListHandler.getLocalMsgList(t),i=a.length,s=kt(t),r=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(r=s?a.findIndex((function(e){return e.ID===n})):a.findIndex((function(e){return e.sequence+""===n})))>e?(c.messageList=a.slice(r-e,r),c.nextReqMessageID=s?a[r-e].ID:a[r-e].sequence+""):(c.messageList=a.slice(0,r),c.isCompleted=!0):e<i?(c.messageList=a.slice(r=i-e,i),c.nextReqMessageID=s?a[r].ID:a[r].sequence+""):(c.messageList=a.slice(0,i),c.isCompleted=!0),e=c.messageList.map((function(e){return e.sequence})),Le.l("".concat(o," convID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," sequenceList:").concat(e)),c}},{key:"getMessageListHopping",value:function(e){var t,n,o=e.conversationID,a=e.sequence,i=e.time,s=e.count;return e=void 0===(e=e.direction)?0:e,(ut(s)||15<s)&&(s=15),o.startsWith(S.CONV_C2C)?(t=this.get(6),n=o.replace(S.CONV_C2C,""),t.getRoamingMessagesHopping({peerAccount:n,time:i,count:s,direction:e})):o.startsWith(S.CONV_GROUP)?(t=this.get(7),n=o.replace(S.CONV_GROUP,""),t.getRoamingMessagesHopping({groupID:n,sequence:a,count:s,direction:e})):void 0}},{key:"_computeRemainingCount",value:function(e){var t,n=e.conversationID,o=e.nextReqMessageID,a=(e=this._msgListHandler.getLocalMsgList(n)).length;return Le.l("".concat(this._n,"._computeRemainingCount convID:").concat(n," nextReqMessageID:").concat(o," length:").concat(a)),o?(t=0,kt(n)?t=e.findIndex((function(e){return e.ID===o})):Tt(n)&&(t=-1!==o.indexOf("-")?e.findIndex((function(e){return e.ID===o})):e.findIndex((function(e){return e.sequence+""===o}))),-1===t?0:t):a}},{key:"_needGetHistory",value:function(e){var t=e.conversationID,n=e.remainingCount,o=(e=e.count,this.getLocalConversation(t)),a="";return o&&o.groupProfile&&(a=o.groupProfile.type),!(Mt(t)||It(a)||!this._isEverCleared(t)&&(o=n<=e&&!this._completedMap.has(t),Le.l("".concat(this._n,"._needGetHistory convID:").concat(t," ret:").concat(o)),!o))}},{key:"_isTopicConv",value:function(e){return Ct(e=e.replace(S.CONV_GROUP,""))}},{key:"getHistoryMessages",value:function(e){var t,n,o,a,i,s,r=e.conversationID,c=e.count;return e=e.nextReqMessageID,r===S.CONV_SYSTEM?yn():(c=20<c?20:15,t=null,kt(r)?(s=0,n="",o=!1,i=this._roamingMsgKeyAndTimeMap.has(r),e&&(o=!0,i?(s=this._roamingMsgKeyAndTimeMap.get(r).lastMessageTime,n=this._roamingMsgKeyAndTimeMap.get(r).messageKey):(a=this._msgListHandler.findMessage(e))&&(s=a.time,Le.l("".concat(this._n,".getHistoryMessages convID:").concat(r," isRelayInfoExisted:").concat(i," lastMessageTime:").concat(s)))),(t=this.get(6)).getRoamingMessage({conversationID:r,peerAccount:r.replace(S.CONV_C2C,""),count:c,lastMessageTime:o?s:0,messageKey:o?n:""})):Tt(r)?(t=this.get(7))?(a=r.replace(S.CONV_GROUP,""),i=null,this._convMap.has(r)&&!Ct(a)&&(i=this._convMap.get(r).lastMessage),s=0,e?s=Number(e):i&&(s=i.lastSequence),t.getRoamingMessage({conversationID:r,groupID:a,count:c,sequence:s})):In({code:Un.NO_MODULE}):yn())}},{key:"patchConvLastMessage",value:function(e){var t,n,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=this.getLocalConversation(e);a&&(t=(n=a.lastMessage).messageForShow,n=n.payload,He(t)||He(n)||o)&&0!==(t=this._msgListHandler.getLocalMsgList(e)).length&&(n=t[t.length-1],Le.l("".concat(this._n,".patchConvLastMessage bForceUpdate:").concat(o," convID:").concat(e," payload:"),n.payload),a.updateLastMessage(n))}},{key:"onRoamingMessage",value:function(){var e,n,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=3<arguments.length?arguments[3]:void 0,s=(l=1<arguments.length?arguments[1]:void 0).startsWith(S.CONV_C2C)?S.CONV_C2C:S.CONV_GROUP,r=null,c=[],l=[],u=0,d=o.length,p=s===S.CONV_GROUP,h=this.getFileDownloadProxy(),g=this.getDowloadFileAuthKey(),m=We(i),f=this.get(17).getFileDNList(),v=function(){p?--u:++u},_=function(){return p?d<=u:u<d};for(u=p?o.length-1:0,d=p?0:o.length;_();v())1!==o[u].isPlaceMessage&&((r=new ko(o[u])).to=o[u].to,s!==S.CONV_GROUP||ut(o[u].topicID)||(r.to=o[u].topicID),r.isSystemMessage=!!o[u].isSystemMessage,r.conversationType=s,e=4===o[u].event?{type:S.MSG_GRP_TIP,content:t(t({},o[u].elements),{},{groupProfile:o[u].groupProfile})}:o[u].elements,p||r.setNickAndAvatar({nick:o[u].nick,avatar:o[u].avatar}),He(e)?((n=new Zn("emptyMessageBody")).setMessage("from:".concat(r.from," to:").concat(r.to," sequence:").concat(r.sequence," event:").concat(o[u].event)),n.setLevel("warning").end()):(r.setElement(e,h,g,f),r.reInitialize(this.getMyUserID()),c.push(r),m&&i.push(r)));return v=_=null,a?(this._msgListHandler.unshift(c,l),c=null,l):c}},{key:"findMessage",value:function(e){return this._msgListHandler.findMessage(e)}},{key:"_isMeInCommunity",value:function(e){var t=!0;return this._isTopicConv(e)&&(e=Gt(e.replace(S.CONV_GROUP,"")),this.get(7).hasLocalGroup(e)||(t=!1,Le.l("".concat(this._n,"._isMeInCommunity groupID:").concat(e," ret:").concat(t)))),t}},{key:"deleteTopicRoamingInfo",value:function(e){var t=this;Et({groupID:e})&&this._msgListHandler.getTopicConvIDList(e).forEach((function(e){t.clearMemMsg(e)}))}},{key:"deleteGroupRoamingInfo",value:function(e){e="".concat(S.CONV_GROUP).concat(e),0<this._msgListHandler.getLocalMsgList(e).length&&this.clearMemMsg(e)}},{key:"setMessageRead",value:function(e){var t=e.conversationID,n=this.getLocalConversation(t);if(e="".concat(this._n,".setMessageRead"),Le.l("".concat(e," convID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n)return yn();if(n.type!==S.CONV_GROUP&&n.type!==S.CONV_TOPIC||He(n.groupAtInfoList)||this.deleteGroupAtTips(t),0===n.unreadCount)return yn();var o=this._msgListHandler.getLocalLastMsg(t),a=n.lastMessage.lastTime,i=(a<(i=this._msgListHandler.getLocalMaxTime(t))&&(Le.l("".concat(e," update lastMessageTime from ").concat(a," to ").concat(i)),a=i),this._msgListHandler.getLocalMaxSeq(t)),s=n.lastMessage.lastSequence,r=(s<i&&(Le.l("".concat(e," update lastMessageSeq from ").concat(s," to ").concat(i)),s=i),n.type===S.CONV_TOPIC&&ut(o)&&(e=this.get(10),o=Gt(i=t.replace(S.CONV_GROUP,"")),e=e.getLocalTopic(o,i))&&(s=e.nextMessageSeq-1),null);switch(n.type){case S.CONV_C2C:return(r=this.get(6))?r.setMessageRead({conversationID:t,lastMessageTime:a}):In({code:Un.NO_MODULE});case S.CONV_GROUP:case S.CONV_TOPIC:return(r=this.get(7))?r.setMessageRead({conversationID:t,lastMessageSeq:s}):In({code:Un.NO_MODULE});case S.CONV_SYSTEM:return n.unreadCount=0,this.emitConvUpdate(!0,!1),yn();default:return yn()}}},{key:"setAllMessageRead",value:function(){var e,t=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o="setAllMessageRead",a="".concat(this._n,".").concat(o),i=(n.scope||(n.scope=S.READ_ALL_MSG),Le.l("".concat(a," options:"),n),this._createSetAllMessageReadPack(n));return 0===i.readAllC2CMessage&&0===i.groupMessageReadInfoList.length?yn():(e=new Zn(o),this.req({P:Gn.SET_ALL_MSG_READ,data:i}).then((function(o){return o=o.data,o=t._handleAllMsgRead(o),e.setMessage("scope:".concat(n.scope," failureGroups:").concat(JSON.stringify(o))).end(),yn()})).catch((function(t){return e.setError(t).end(),Le.w("".concat(a," failed. error:"),t),In({code:t&&t.code?t.code:Un.MSG_UNREAD_ALL_FAIL,message:t&&t.message?t.message:void 0})})))}},{key:"setConvCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConv",value:function(e){return this._convGroupHandler.markConv(e)}},{key:"getConvGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConvGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConvGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConvGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConvsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConvsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConvMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConvGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConvGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConvGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConvInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConvLastMessageSeq",value:function(e){var t=this._msgListHandler.getLocalLastMsg(e.conversationID);return e=e.lastMessage.lastSequence,t&&e<t.sequence?t.sequence:e}},{key:"_getConvLastMessageTime",value:function(e){var t=this._msgListHandler.getLocalLastMsg(e.conversationID);return e=e.lastMessage.lastTime,t&&e<t.time?t.time:e}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},o=e.scope,a=T(this._convMap);try{for(a.s();!(t=a.n()).done;){var i,s=f(t.value,2)[1];if(0<s.unreadCount)if(s.type===S.CONV_C2C&&0===n.readAllC2CMessage){if(o===S.READ_ALL_MSG)n.readAllC2CMessage=1;else if(o===S.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else s.type!==S.CONV_GROUP||o!==S.READ_ALL_GROUP_MSG&&o!==S.READ_ALL_MSG||(i=this._getConvLastMessageSeq(s),n.groupMessageReadInfoList.push({groupID:s.groupProfile.groupID,messageSequence:i}))}}catch(r){a.e(r)}finally{a.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMsgRead(e)}},{key:"_handleAllMsgRead",value:function(e){var t=e.groupMessageReadInfoList;return e=e.readAllC2CMessage,t=this._parseGroupReadInfo(t),1<=this._updateAllConvUnreadCount({readAllC2CMessage:e})&&this.emitConvUpdate(!0,!1),t}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,o=e.length;n<o;n++){var a=(r=e[n]).groupID,i=r.sequence,s=r.retCode,r=r.lastMessageSeq;ut(s)?this._remoteGroupReadSeqMap.set(a,r):(this._remoteGroupReadSeqMap.set(a,i),0!==s&&t.push("".concat(a,"-").concat(i,"-").concat(s)))}return t}},{key:"_updateAllConvUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,o=0,a=T(this._convMap);try{for(a.s();!(t=a.n()).done;){var i,s,r,c,l=f(t.value,2),u=l[0],d=l[1];1<=d.unreadCount&&(1===n&&d.type===S.CONV_C2C?(i=this._getConvLastMessageTime(d),this.updateIsReadAfterReadReport({conversationID:u,lastMessageTime:i})):d.type===S.CONV_GROUP&&(s=u.replace(S.CONV_GROUP,""),this._remoteGroupReadSeqMap.has(s))&&(r=this._remoteGroupReadSeqMap.get(s),c=this._getConvLastMessageSeq(d),this.updateIsReadAfterReadReport({conversationID:u,remoteReadSequence:r}),r<=c)&&this._remoteGroupReadSeqMap.delete(s),this.updateUnreadCount(u,!1))&&(o+=1)}}catch(p){a.e(p)}finally{a.f()}return o}},{key:"isRemoteRead",value:function(e){var t,n=e.conversationID,o=(e=e.sequence,n.replace(S.CONV_GROUP,"")),a=!1;return this._remoteGroupReadSeqMap.has(o)&&(e<=(t=this._remoteGroupReadSeqMap.get(o))&&(a=!0,Le.l("".concat(this._n,".isRemoteRead convID:").concat(n," msgSeq:").concat(e," remoteReadSeq:").concat(t))),t+10<=e)&&this._remoteGroupReadSeqMap.delete(o),a}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,o=e.lastMessageTime,a=this._msgListHandler.getLocalMsgList(t);if(0!==a.length)for(var i,s=a.length-1;0<=s;s--)if(i=a[s],!(o&&i.time>o||n&&i.sequence>n)){if("in"===i.flow&&i.isRead)break;i.setIsRead(!0)}}},{key:"updateUnreadCount",value:function(e){var t,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=!1,a=this.getLocalConversation(e),i=this._msgListHandler.getLocalMsgList(e);if(a)return(t=a.unreadCount)!==(i=i.filter((function(e){return!e.isRead&&!e._onlineOnlyFlag&&!e.isDeleted})).length)&&(a.unreadCount=i,o=!0,Le.l("".concat(this._n,".updateUnreadCount from ").concat(t," to ").concat(i,", convID:").concat(e)),!0===n)&&this.emitConvUpdate(!0,!1),o&&a.type===S.CONV_TOPIC&&(t=a.unreadCount,i=this.get(10),n=e.replace(S.CONV_GROUP,""),i.onUnreadCountUpdatedFromConv(n,t)),o}},{key:"clearGroupAtInfoList",value:function(e){var t,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=this.getLocalConversation(e);o&&0<o.groupAtInfoList.length&&(o.clearGroupAtInfoList(),Le.l("".concat(this._n,".clearGroupAtInfoList convID:").concat(e)),o.type===S.CONV_TOPIC&&(o=o.groupAtInfoList,t=this.get(10),e=e.replace(S.CONV_GROUP,""),t.onAtInfoUpdated({topicID:e,groupAtInfoList:o})),!0===n)&&this.emitConvUpdate(!0,!1)}},{key:"updateReadReceiptInfo",value:function(e){var t,n,o,a=this,i=void 0===(r=e.userID)?void 0:r,s=void 0===(r=e.groupID)?void 0:r,r=e.readReceiptList,c=void 0===(e=e.timestamp)?0:e;He(r)||(t=[],ut(i)?ut(s)||(n="".concat(S.CONV_GROUP).concat(s),r.forEach((function(e){var o=e.tinyID,i=e.clientTime,r=e.random,c=e.readCount;e=e.unreadCount,o="".concat(o,"-").concat(i,"-").concat(r),i=a._msgListHandler.getLocalMsg(n,o)||a._msgListHandler.getHoppingMsg(n,o),r={groupID:s,messageID:o,readCount:0,unreadCount:0},i&&(Ke(c)&&(i.readReceiptInfo.readCount=c,r.readCount=c),Ke(e)&&(i.readReceiptInfo.unreadCount=e,r.unreadCount=e),t.push(r))}))):(o="".concat(S.CONV_C2C).concat(i),r.forEach((function(e){var n=e.tinyID,s=e.clientTime;e=e.random,n="".concat(n,"-").concat(s,"-").concat(e),(s=a._msgListHandler.getLocalMsg(o,n)||a._msgListHandler.getHoppingMsg(o,n))&&!s.readReceiptInfo.isPeerRead&&(s.readReceiptInfo.isPeerRead=!0,s.readReceiptInfo.timestamp=c,t.push({userID:i,messageID:n,isPeerRead:!0,timestamp:c}))}))),0<t.length&&this.emitOEvt(M.MESSAGE_READ_RECEIPT_RECEIVED,t))}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&0!==n.length&&!Mt(t.type)){for(var o=[],a=0,i=n.length;a<i;a++)"in"!==n[a].flow?"out"!==n[a].flow||n[a].isRead||n[a].setIsRead(!0):o.push(n[a]);var s=0;s=t.type===S.CONV_C2C?(e=o.slice(-t.unreadCount).filter((function(e){return e.isRevoked})).length,o.length-t.unreadCount-e):o.length-t.unreadCount;for(var r=0;r<s&&!o[r].isRead;r++)o[r].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t,n,o,a=this,i="".concat(this._n,".deleteGroupAtTips"),s=(Le.l("".concat(i)),this._convMap.get(e));return s&&0!==(t=s.groupAtInfoList).length?(s=void 0,e.startsWith(S.CONV_GROUP)&&(s=e.replace(S.CONV_GROUP,"")),n=v(t),(Et({groupID:s})||Ct(s))&&0===(n=t.filter((function(e){return!e.atTypeArray.includes(S.CONV_AT_ALL)}))).length?(this.clearGroupAtInfoList(e,!1),Promise.resolve()):(o=this.getMyUserID(),this.req({P:Gn.DEL_GROUP_AT_TIPS,data:{messageListToDelete:n.map((function(e){return{from:e.from,to:o,messageSeq:e.__sequence,messageRandom:e.__random,groupID:ut(e.topicID)?e.groupID:e.topicID}}))}}).then((function(){return Le.l("".concat(i," ok. count:").concat(t.length)),a.clearGroupAtInfoList(e,!1),Promise.resolve()})).catch((function(e){return Le.e("".concat(i," failed. error:"),e),In(e)})))):Promise.resolve()}},{key:"appendToMessageList",value:function(e){return this._msgListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this._sll.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this._sll.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._msgListHandler.pushIn(t,n)||this._sll.has(t.random)&&!n||(e.push(t),0))}},{key:"revoke",value:function(e,t,n){return this._msgListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){(!this._peerReadTimeMap.has(e)||this._peerReadTimeMap.get(e)<t)&&this._peerReadTimeMap.set(e,t)}},{key:"updateMsgIsPeerReadProp",value:function(e,t){var n;e.startsWith(S.CONV_C2C)&&0<t&&(0<(n=this._msgListHandler.updateMsgIsPeerReadProp(e,t)).length&&this.emitOEvt(M.MESSAGE_READ_BY_PEER,n),this._convMap.has(e))&&!He(n=this._convMap.get(e).lastMessage)&&n.fromAccount===this.getMyUserID()&&n.lastTime<=t&&!n.isPeerRead&&(n.isPeerRead=!0,this.emitConvUpdate(!0,!1))}},{key:"updateMsgIsModifiedProp",value:function(e){this._msgListHandler.updateMsgIsModifiedProp(e)}},{key:"setCompleted",value:function(e){Le.l("".concat(this._n,".setCompleted convID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMsgKeyAndTime",value:function(e,t,n){this._roamingMsgKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"getConvList",value:function(e){var t,n=this,o="".concat(this._n,".").concat("getConvList"),a="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._convMap.size,", options:").concat(JSON.stringify(e));return Le.l("".concat(o,". ").concat(a)),this._pagingStatus===bn?((t=new Zn("getConvList")).setMessage(a),this.syncConvList().then((function(){return t.end(),_n({conversationList:n._getConvList(e),isSyncCompleted:n._isSyncCompleted()})})).catch((function(e){return t.setError(e).end(),Le.e("".concat(o," failed. error:"),e),In(e)}))):(a=this._getConvList(e),Le.l("".concat(o,". returned conversation count:").concat(a.length)),yn({conversationList:a,isSyncCompleted:this._isSyncCompleted()}))}},{key:"_getConvList",value:function(e){var t,n,o,a,i,s=this;return ut(e)?this.getLocalConvList():We(e)?0===e.length?[]:this.getLocalConvList().filter((function(t){return e.includes(t.conversationID)})):Ye(e)?(t=e.type,n=e.markType,o=e.groupName,a=e.hasUnreadCount,i=e.hasGroupAtInfo,this.getLocalConvList().filter((function(e){return s._filterType(e,t)&&s._filterMarkType(e,n)&&s._filterGroupName(e,o)&&s._filterUnreadCount(e,a)&&s._filterGroupAtInfo(e,i)}))):[]}},{key:"_filterType",value:function(e,t){return t!==S.CONV_C2C&&t!==S.CONV_GROUP||e.type===t}},{key:"_filterGroupName",value:function(e,t){return!lt(t)||(""===t?0===e.conversationGroupList.length:e.conversationGroupList.includes(t))}},{key:"_filterMarkType",value:function(e,t){return!Ke(t)||(0===t?0===e.markList.length:e.markList.includes(t))}},{key:"_filterUnreadCount",value:function(e,t){var n=!0;return!0===t?n=1<=e.unreadCount:!1===t&&(n=0===e.unreadCount),n}},{key:"_filterGroupAtInfo",value:function(e,t){var n=!0;return!0===t?n=1<=e.groupAtInfoList.length:!1===t&&(n=0===e.groupAtInfoList.length),n}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=T(this._convMap);try{for(t.s();!(e=t.n()).done;){var n=f(e.value,2),o=n[0],a=n[1];a.type===S.CONV_C2C&&this.recordPeerReadTime(o,a.peerReadTime)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){var e=this.get(7);return!e||e.isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){var e=this.get(7);return e?e.getLocalGroupList().length:0}},{key:"_hasLocalGroup",value:function(e){var t=this.get(7);return!!t&&t.hasLocalGroup(e.replace(S.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this,o=!1;if(this._convMap.has(e)?t=this._convMap.get(e):(t=new aa({conversationID:e,type:kt(e)?S.CONV_C2C:S.CONV_GROUP},this.isIntl(),this.isUsingChatCore()),o=!0),t._isInfoCompleted||t.type===S.CONV_SYSTEM)return yn({conversation:t});if(Tt(e)){if(!this.get(7))return In({code:Un.NO_MODULE});if(!this._hasLocalGroup(e))return yn({conversation:t})}var a="".concat(this._n,".").concat("getConversationProfile"),i=new Zn("getConversationProfile");return Le.l("".concat(a,". convID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._getUserOrGroupProfile(t).then((function(s){i.setMessage("convID:".concat(e," unreadCount:").concat(s.data.conversation.unreadCount)).end();var r,c=n.get(8);if(c&&t.type===S.CONV_C2C&&(r=e.replace(S.CONV_C2C,""),c.isMyFriend(r))&&(c=c.getFriendRemark(r),t.remark!==c)&&(t.remark=c,Le.l("".concat(a,". convID:").concat(e," patch remark:").concat(t.remark))),Le.l("".concat(a," ok. isNewConv:").concat(o," convID:").concat(e)),o){if(t.type===S.CONV_C2C)return n._onNewC2CConv([e.replace(S.CONV_C2C,"")]).then((function(){return yn({conversation:t})}));if(t.type===S.CONV_GROUP)return n._onNewGroupConv([e.replace(S.CONV_GROUP,"")]).then((function(){return yn({conversation:t})}))}return s})).catch((function(t){return i.setError(t).setMessage("convID:".concat(e)).end(),Le.e("".concat(a," failed. error:"),t),In(t)}))}},{key:"_getUserOrGroupProfile",value:function(e){var t=this;return e.type===S.CONV_C2C?this.get(4).getUserProfile({userIDList:[e.toAccount]}).then((function(n){return 0===(n=n.data).length?In({code:Un.USER_OR_GRP_NOT_FOUND}):(e.userProfile=n[0],e._isInfoCompleted=!0,t._insertConvAfterTopmost(e),yn({conversation:e}))})):this.get(7).getGroupProfile({groupID:e.toAccount}).then((function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._insertConvAfterTopmost(e),yn({conversation:e})}))}},{key:"_insertConvAfterTopmost",value:function(e){var t,n;e instanceof aa&&!this._convMap.has(e.conversationID)&&(n=(t=v(this._convMap)).findIndex((function(e){return!1===e[1].isPinned})),t.splice(n,0,[e.conversationID,e]),this._convMap=new Map(t),this._setStorageConvList(),this.emitConvUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach((function(e){var n=e.userID;n===t.getMyUserID()?t._onMyProfileModified({latestNick:e.nick,latestAvatar:e.avatar}):(n=t._convMap.get("".concat(S.CONV_C2C).concat(n)))&&(n.userProfile=e)}))}},{key:"_onCloudConfig",value:function(e){"0"===this.getCloudConfig("pull_on_invite")&&(this._bPullOnInvite=!1),Le.l("".concat(this._n,"._onCloudConfig bPullOnInvite:").concat(this._bPullOnInvite))}},{key:"disableMsgPullOnInvite",value:function(){this._bPullOnInvite=!1}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===Dn}},{key:"_errorLog",value:function(e,t,n,o){var a=new Error("Params validate failed."),i="".concat(this.getErrMsg("API_REFER")).concat(e);throw Le.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrMsg(n,o),", ").concat(i)),Le.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),a}},{key:"_isValidConvID",value:function(e){return kt(e)||Tt(e)||Mt(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return lt(e)||$e(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),lt(e)?(this._isValidConvID(e)||this._errorLog(n,"options","InvalidConversationID",e),Le.l("".concat(this._n,".").concat(n," convID:").concat(e)),this.deleteConvList({conversationIDList:[e],flag:1})):(We(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),0===e.conversationIDList.length&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach((function(e){t._isValidConvID(e)||t._errorLog(n,"conversationIDList","InvalidConversationID",e)})),"clearHistoryMessage"in e&&"boolean"!=typeof e.clearHistoryMessage&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),100<e.conversationIDList.length&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConvList(e))}},{key:"deleteConvList",value:function(e){var t=void 0===(t=e.conversationIDList)?[]:t,n=void 0===(n=e.clearHistoryMessage)||n,o=void 0===(e=e.flag)?0:e,a="".concat(this._n,".").concat("deleteConvList"),i=(e="convIDList:".concat(t," clearHistoryMessage:").concat(n),Le.l("".concat(a," ").concat(e)),new Zn("deleteConvList"));return i.setMessage(e),Promise.all([this.rmLocalOnlyConvList(t),this.rmLocalAndRemoteConvList(t,n)]).then((function(e){return i.end(),0===(e=[].concat(v(e[0]),v(e[1]))).length?In(new On({code:Un.CONV_NOT_FOUND})):(Le.l("".concat(a," ok")),yn(1===o?{conversationID:e[0]}:{conversationIDList:e}))})).catch((function(e){return i.setError(e).end(),Le.e("".concat(a," failed. error:"),e),In(e)}))}},{key:"rmLocalOnlyConvList",value:function(e){var t=this;return e.filter((function(e){var n;return!!t._convMap.has(e)&&((n=t.getLocalConversation(e).type)!==S.CONV_GROUP||t._hasLocalGroup(e)?n===S.CONV_SYSTEM&&(t.get(7).deleteGroupSystemNotice({messageList:t._msgListHandler.getLocalMsgList(e)}),t.deleteLocalConv(e),!0):(t.deleteLocalConv(e),!0))}))}},{key:"rmLocalAndRemoteConvList",value:function(e,t){var n=this,o={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach((function(e){var t;n._convMap.has(e)&&((t=n.getLocalConversation(e).type)===S.CONV_C2C?o.conversationList.push({toAccount:e.replace(t,""),type:1}):t===S.CONV_GROUP&&n._hasLocalGroup(e)&&o.conversationList.push({toGroupID:e.replace(t,""),type:2}))})),0===o.conversationList.length?[]:this.req({P:Gn.DEL_CONV,data:o}).then((function(e){var t=[];return 0<e.data.resultList.length&&e.data.resultList.map((function(e){0===e.code&&(e=1===e.type?"".concat(S.CONV_C2C).concat(e.to):"".concat(S.CONV_GROUP).concat(e.groupID),t.push(e))})),n.deleteLocalConvList(t),t}))}},{key:"setConvDraft",value:function(e){var t=e.conversationID,n=(e=e.draftText,"".concat(this._n,".").concat("setConvDraft"));return Le.l("".concat(n," convID:").concat(t," draftText:").concat(e)),this._convMap.has(t)?((n=this._convMap.get(t)).setDraftText(e),this.emitConvUpdate(),yn({code:0,conversation:n})):In({code:Un.CONV_NOT_FOUND})}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._convMap.has(e))return In({code:Un.CONV_NOT_FOUND});var o=this._convMap.get(e).type;if(o===S.CONV_C2C)n.type=1,n.toAccount=e.replace(S.CONV_C2C,"");else{if(o!==S.CONV_GROUP)return o===S.CONV_SYSTEM?(this.get(7).deleteGroupSystemNotice({messageList:this._msgListHandler.getLocalMsgList(e)}),yn({conversationID:e})):In({code:Un.CONV_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(S.CONV_GROUP,"")}var a="".concat(this._n,".").concat("clearHistoryMessage"),i=new Zn("clearHistoryMessage");return i.setMessage("convID:".concat(e)),Le.l("".concat(a,". convID:").concat(e)),this.setMessageRead({conversationID:e}).then((function(){return t.req({P:Gn.CLEAR_HISTORY_MSG,data:n})})).then((function(){i.end(),Le.l("".concat(a," ok")),t.clearMemMsg(e);var n=t.getLocalConversation(e);return n&&(n.updateLastMessage(),t._sortConvListAndEmitEvent()),yn({conversationID:e})})).catch((function(e){return i.setError(e).end(),Le.e("".concat(a," failed. error:"),e),In(e)}))}},{key:"pinConversation",value:function(e){var t,n,o,a=this,i=e.conversationID,s=e.isPinned,r=this.getLocalConversation(i);return r&&r.isPinned===s?yn({conversationID:i}):Mt(i)?(r&&(r.isPinned=s),this._sortConvListAndEmitEvent(),yn({conversationID:i})):(e=null,kt(i)?e={type:1,toAccount:i.replace(S.CONV_C2C,"")}:Tt(i)&&(e={type:2,groupID:i.replace(S.CONV_GROUP,"")}),null===e?In({code:Un.INVALID_CONV_ID}):(t="".concat(this._n,".").concat("pinConversation"),n="convID:".concat(i," isPinned:").concat(s),(o=new Zn("pinConversation")).setMessage(n),Le.l("".concat(t,". ").concat(n)),this.req({P:Gn.PIN_CONV,data:{fromAccount:this.getMyUserID(),operationType:!0===s?1:2,itemList:[e]}}).then((function(){return o.end(),Le.l("".concat(t," ok")),r?r.isPinned!==s&&(r.isPinned=s):a._convMap.set(i,new aa({conversationID:i,type:kt(i)?S.CONV_C2C:S.CONV_GROUP,isPinned:s},a.isIntl(),a.isUsingChatCore())),a._sortConvListAndEmitEvent(),_n({conversationID:i})})).catch((function(e){return o.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))))}},{key:"setMessageRemindType",value:function(e){return this._msgRemindHandler.set(e)}},{key:"patchMsgRemindType",value:function(e){var t=e.ID,n=e.isC2CConversation,o=e.messageRemindType,a=!1;return(n=this.getLocalConversation("".concat(n?S.CONV_C2C:S.CONV_GROUP).concat(t)))&&n.messageRemindType!==o&&(n.messageRemindType=o,a=!0),Le.l("".concat(this._n,".patchMsgRemindType options:"),e,"ret:".concat(a)),a}},{key:"onC2CMsgRemindTypeFetched",value:function(e){var t,n=this;We(e)&&0<e.length&&(t=0,e.forEach((function(e){var o=e.userID;e=e.muteFlag,e=n._transMsgRemindType(e),!0===n.patchMsgRemindType({ID:o,isC2CConversation:!0,messageRemindType:e})&&(t+=1)})),Le.l("".concat(this._n,".onC2CMsgRemindTypeFetched updateCount:").concat(t)),1<=t)&&this.emitConvUpdate(!0,!1)}},{key:"onC2CMsgRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMsgRemindTypeSynced");e.dataList.forEach((function(e){var o;He(e.muteNotificationsSync)||(o=(e=e.muteNotificationsSync).to,e=e.muteFlag,e=t._transMsgRemindType(e),t.patchMsgRemindType({ID:o,isC2CConversation:!(o=0),messageRemindType:e})&&(o+=1),Le.l("".concat(n," updateCount:").concat(o)),1<=o&&t.emitConvUpdate(!0,!1))}))}},{key:"onGroupMsgRemindTypeUpdated",value:function(e){this._msgRemindHandler.onGroupMsgRemindTypeUpdated(e)}},{key:"deleteLocalConv",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this._convMap.has(e);Le.l("".concat(this._n,".deleteLocalConv convID:").concat(e," has:").concat(n)),n&&(this._convMap.delete(e),this._convMapForDiff.delete(e),this.clearMemMsg(e),this._setStorageConvList(!0),t)&&(n=!this._isTopicConv(e),this.emitConvUpdate(n,!1))}},{key:"pullMsgOnInvite",value:function(e){var t,n,o,a,i,s=this.get(7);s&&(t="".concat(this._n,".pullMsgOnInvite"),Le.l("".concat(t," flag:").concat(this._bPullOnInvite)),this._bPullOnInvite)&&(i=this.getLocalLastMessage(e),n=this.getLocalSecondLastMessage(e),a=o=1,i&&(o=i.sequence),n&&(a=n.sequence),i=s.getGroupRemoteLastSeq(e.replace(S.CONV_GROUP,"")),Le.l("".concat(t," convID:").concat(e," localLastSeq:").concat(o," localSecondLastSeq:").concat(a," remoteLastSeq:").concat(i)),this.clearMemMsg(e),1<o-a?this._recursiveGetMsgList([],e,!1,o,a):1<i-o&&this._recursiveGetMsgList([],e,!0,i,o))}},{key:"_recursiveGetMsgList",value:function(e,t,n,o,a,i){var s=this;this.getMessageList({conversationID:t,nextReqMessageID:i}).then((function(i){var r=(i=i.data).messageList,c=i.isCompleted,l=(i=i.nextReqMessageID,r.filter((function(e){return n?e.sequence>a&&e.sequence<=o:e.sequence>a&&e.sequence<o})));e.unshift.apply(e,v(l)),!c&&0<r.length&&r[0].sequence>a&&e.length<60?s._recursiveGetMsgList(e,t,n,o,a,i):s._emitMsgReceived(t,e)}))}},{key:"_emitMsgReceived",value:function(e,t){var n,o,a=this;0<t.length&&(t=t.filter((function(e,t,n){return t===n.findIndex((function(t){return t.sequence===e.sequence}))})),n=this.hasLocalConversation(e),o=t.map((function(e){return e.sequence})),Le.l("".concat(this._n,"._emitMsgReceived convID:").concat(e," has:").concat(n," count:").concat(o.length," sequenceList:"),o),this.emitOEvt(M.MESSAGE_RECEIVED,t),n?this.patchConvLastMessage(e,!0):this.getConversationProfile(e).then((function(){a.patchConvLastMessage(e,!0)})))}},{key:"deleteLocalConvList",value:function(e){var t=this,n=!1;e.forEach((function(e){t._convMap.has(e)&&(t.deleteLocalConv(e,!1),n=!0)})),Le.l("".concat(this._n,".deleteLocalConvList convID:").concat(e," isConvIDExisted:").concat(n)),n&&this.emitConvUpdate(!0,!1)}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._msgListHandler.hasLocalMsg(e.conversationID,e.ID)&&!this._sll.has(e.random))}},{key:"modifyMessageList",value:function(e){var t,n;e.startsWith(S.CONV_C2C)&&this._convMap.has(e)&&(n=this._convMap.get(e),t=Date.now(),this._msgListHandler.modifyMsgSentByPeer({conversationID:e,latestNick:n.userProfile.nick,latestAvatar:n.userProfile.avatar}),n=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),this._msgListHandler.modifyMsgSentByMe({conversationID:e,latestNick:n.nick,latestAvatar:n.avatar}),Le.l("".concat(this._n,".modifyMessageList convID:").concat(e," cost:").concat(zt(t))))}},{key:"updateUserProfileSpecifiedKey",value:function(e){Le.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),e);var t=e.conversationID,n=e.nick;e=e.avatar,this._convMap.has(t)&&(t=this._convMap.get(t).userProfile,lt(n)&&t.nick!==n&&(t.nick=n),lt(e)&&t.avatar!==e&&(t.avatar=e),this.emitConvUpdate(!0,!1))}},{key:"_onMyProfileModified",value:function(e){var n=this,o=this.getLocalConvList(),a=Date.now();o.forEach((function(o){n.modifyMessageSentByMe(t({conversationID:o.conversationID},e))})),Le.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost:").concat(zt(a)))}},{key:"modifyMessageSentByMe",value:function(e){this._msgListHandler.modifyMsgSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._msgListHandler.getLatestMsgSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._msgListHandler.modifyMsgSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._msgListHandler.getLatestMsgSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._msgListHandler.pushIn(t)||this._sll.has(t.random)||(e.push(t),0))}},{key:"getLocalLastMessage",value:function(e){return this._msgListHandler.getLocalLastMsg(e)}},{key:"getLocalSecondLastMessage",value:function(e){return this._msgListHandler.getLocalSecondLastMsg(e)}},{key:"checkAndPatchRemark",value:function(){var e,t,n=this.get(8);0!==this._convMap.size&&n&&0!==(e=v(this._convMap.values()).filter((function(e){return e.type===S.CONV_C2C}))).length&&(t=0,e.forEach((function(e){var o=e.conversationID.replace(S.CONV_C2C,"");n.isMyFriend(o)&&(o=n.getFriendRemark(o),e.remark!==o)&&(e.remark=o,t+=1)})),Le.l("".concat(this._n,".checkAndPatchRemark. c2cConvCount:").concat(e.length," patchedCount:").concat(t)),0<t)&&this.emitConvUpdate(!0,!1)}},{key:"updateTopicConversation",value:function(e){this._updateLocalConvList({conversationOptionsList:e,isFromGetConversations:!0,updateUnreadCount:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===S.CONV_C2C?n=this._m.get(6):t.conversationType===S.CONV_GROUP&&(n=this._m.get(7)),n?n.sendReadReceipt(e):In({code:Un.NO_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===S.CONV_C2C?n=this._m.get(6):t.conversationType===S.CONV_GROUP&&(n=this._m.get(7)),n?n.getReadReceiptList(e):In({code:Un.NO_MODULE})}},{key:"getLastMessageTime",value:function(e){return(e=this.getLocalConversation(e))?e.lastMessage.lastTime:0}},{key:"getTotalUnreadCount",value:function(){var e=this.getLocalConvList(),t=0;return e.forEach((function(e){e.type===S.CONV_SYSTEM||""!==e.messageRemindType&&e.messageRemindType!==S.MSG_REMIND_ACPT_AND_NOTE||(t+=e.unreadCount)})),t}},{key:"onTotalUnreadCountUpdate",value:function(){var e=this.getTotalUnreadCount();this._convTotalUnreadCount!==e&&(Le.l("".concat(this._n,".onTotalUnreadCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOEvt(M.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"_isConvNeedShow",value:function(e){var t,n;return e=this.getLocalConversation(e),!(!ut(e)&&(t=e.type===S.CONV_TOPIC,n=e.type===S.CONV_GROUP&&e.groupProfile.type===S.GRP_ROOM,e=e.type===S.CONV_GROUP&&e.groupProfile.type===S.GRP_LIVE,t||n||e))}},{key:"setAllRcvMsgOpt",value:function(e){return this._msgRemindHandler.setAllRcvMsgOpt(e)}},{key:"getAllRcvMsgOpt",value:function(){return this._msgRemindHandler.getAllRcvMsgOpt()}},{key:"onAllRcvMsgOptNotify",value:function(e){this._msgRemindHandler.onAllRcvMsgOptNotify(e)}},{key:"clearUnreadCount",value:function(e){(e=this.getLocalConversation(e))&&0<e.unreadCount&&(e.unreadCount=0,this.emitConvUpdate(!0,!1))}},{key:"storeHoppingMessageList",value:function(e){this._msgListHandler.storeHoppingMsgList(e)}},{key:"clearMemMsg",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Le.l("".concat(this._n,".clearMemMsg convID:").concat(e," isOverLimit:").concat(t)),this._msgListHandler.removeByConvID(e),this._completedMap.delete(e),this._roamingMsgKeyAndTimeMap.delete(e),this._everClearedMap.set(e,1)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._setStorageConvList(!0),this._pagingStatus=Mn,this._msgListHandler.reset(),this._msgRemindHandler.reset(),this._roamingMsgKeyAndTimeMap.clear(),this._sll.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._convMap.clear(),this._pagingTs=0,this._pagingStartIdx=0,this._pagingPinnedTs=0,this._pagingPinnedStartIdx=0,this._remoteGroupReadSeqMap.clear(),this._convTotalUnreadCount=0,this._pagingGetCostList.length=0,this._pagingConvIDMap.clear(),this._convIDFromUnreadDBMap.clear(),this._pagingGetCostList.length=0,this._convMapForDiff.clear(),this._partialUpdatedConvMap.clear(),this._everClearedMap.clear(),this._bPullOnInvite=!0,this._convGroupHandler.reset(),this.resetReady()}}]),Za),la=(i(Xa,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupTipsMap.size&&this._check()}},{key:"_check",value:function(){var e=this;this._cachedGroupTipsMap.forEach((function(t,n){var o=e._checkCountMap.get(n),a=e._grpM.hasLocalGroup(n);Le.l("".concat(e._n,"._check groupID:").concat(n," hasLocalGroup:").concat(a," checkCount:").concat(o)),a?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)}))}},{key:"onNewGroupTips",value:function(e){Le.l("".concat(this._n,".onNewGroupTips options:").concat(JSON.stringify(e.dataList)));var t=(e=this._assembly(e)).eventDataList,n=e.result;0<(e=e.AVChatRoomMessageList).length&&this._grpM.onAVChatRoomMessage(e),0<n.length&&(this._grpM.emitOEvt(M.MESSAGE_RECEIVED,n),this._handleTips(n)),0<t.length&&(this._grpM.updateNextMessageSeq(t),this._grpM.get(11).onNewMessage({conversationOptionsList:t,isInstantMessage:!0}))}},{key:"_assembly",value:function(e){for(var n=e.event,o=e.dataList,a=null,i=[],s=[],r={},c=[],l=0,u=o.length;l<u;l++){var d=rt(o[l]);if(6===n){if(this._grpM.isGroupAttributesUpdatedNotice(d))continue;if(this._grpM.isGroupCountersNotice(d))continue}var p=(f=d.groupProfile).groupID,h=void 0===(h=f.communityType)?0:h,g=void 0===(g=f.topicID)?void 0:g,m=f.invisible,f=void 0===(f=f.groupType)?void 0:f,v=void 0;if((y=this._grpM.isMessageFromTopic(h,g))&&(v=S.CONV_TOPIC,d.to=g),(_=this._grpM.hasLocalGroup(p))||!this._grpM.isUnjoinedAVChatRoom(p))if(_||y)if(this._grpM.isMessageFromOrToAVChatroom(p))d.event=n,c.push(d);else if(d.currentUser=this._grpM.getMyUserID(),d.conversationType=S.CONV_GROUP,(a=new ko(d)).setElement({type:S.MSG_GRP_TIP,content:t(t({},d.elements),{},{groupProfile:d.groupProfile})}),a.isSystemMessage=!1,1!==m){var _=this._grpM.get(11),y=(m=(y=a).conversationID,y.sequence);if(6===n)a._onlineOnlyFlag=!0,s.push(a);else if(!_.pushIntoNoticeResult(s,a))continue;this._grpM.isMessageFromCommunityOfTopic(h,g)||6===n&&_.getLocalConversation(m)||(6!==n&&this._qualityStat(a),h=_.isRemoteRead({conversationID:m,sequence:y}),ut(r[m])?(g=0,"in"!==a.flow||a._isExcludedFromUnreadCount||a._onlineOnlyFlag||h||(g=1),r[m]=i.push({conversationID:m,unreadCount:g,type:ut(v)?a.conversationType:v,subType:a.conversationSubType,lastMessage:a._isExcludedFromLastMessage?"":a})-1):(i[_=r[m]].type=a.conversationType,i[_].subType=a.conversationSubType,i[_].lastMessage=a._isExcludedFromLastMessage?"":a,"in"!==a.flow||a._isExcludedFromUnreadCount||a._onlineOnlyFlag||h||i[_].unreadCount++))}else this._qualityStat(a);else this._cacheAndCompare({groupID:p,event:n,item:d,groupType:f})}return{eventDataList:i,result:s,AVChatRoomMessageList:c}}},{key:"_qualityStat",value:function(e){this._grpM.get(26).addMessageSequence({key:zn,message:e})}},{key:"_handleTips",value:function(e){var t=this;e.forEach((function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;case 8:t._onTopicProfileUpdated(e);break;default:Le.w("".concat(t._n,"._handleTips unknown operationType:").concat(e.payload.operationType))}}))}},{key:"_onNewMemberComeIn",value:function(e){var t=(e=e.payload).memberNum;e=e.groupProfile.groupID,(e=this._grpM.getLocalGroupProfile(e))&&Ke(t)&&e.memberCount!==t&&(e.memberCount=t,this._updateConvGroupProfile(e))}},{key:"_onMemberQuit",value:function(e){var t=(n=e.payload).memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&Ke(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConvGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var t=(n=e.payload).memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&Ke(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConvGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_updateConvGroupProfile",value:function(e){this._grpM.get(11).updateConvGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=(e=e.payload.userIDList,this._grpM.getGroupMemberHandler());e.forEach((function(e){(e=n.getLocalGroupMemberInfo(t,e))&&e.updateRole(S.GRP_MBR_ROLE_ADMIN)}))}},{key:"_onMemberCancelledAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=(e=e.payload.userIDList,this._grpM.getGroupMemberHandler());e.forEach((function(e){(e=n.getLocalGroupMemberInfo(t,e))&&e.updateRole(S.GRP_MBR_ROLE_MEMBER)}))}},{key:"_onGroupProfileModified",value:function(e){var t=this,n=(e=e.payload).newGroupProfile,o=e.groupProfile,a=e.operatorInfo,i=(e=o.groupID,this._grpM.getLocalGroupProfile(e));Object.keys(n).forEach((function(e){switch(e){case"ownerID":t._ownerChanged(i,n);break;case"groupName":i.name=n[e];break;default:i[e]=n[e]}})),ut(a)||Object.keys(a).forEach((function(e){"nameCard"===e?i.updateSelfInfo({nameCard:a[e]}):"role"===e&&i.updateSelfInfo({role:a[e]})})),o=!i.isSupportTopic,this._grpM.emitGroupListUpdate(!0,o)}},{key:"_ownerChanged",value:function(e,t){e=e.groupID;var n=this._grpM.getLocalGroupProfile(e),o=this._grpM.getMyUserID();o===t.ownerID&&(n.updateGroup({selfInfo:{role:S.GRP_MBR_ROLE_OWNER}}),n=(t=this._grpM.getGroupMemberHandler()).getLocalGroupMemberInfo(e,o),o=this._grpM.getLocalGroupProfile(e).ownerID,t=t.getLocalGroupMemberInfo(e,o),n&&n.updateRole(S.GRP_MBR_ROLE_OWNER),t)&&t.updateRole(S.GRP_MBR_ROLE_MEMBER)}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,n=(o=e.payload).groupProfile,o=o.memberList,a=n.groupID,i=(Ct(t)&&this._updateTopicMuteTime(e),this._grpM.getGroupMemberHandler());o.forEach((function(e){var t=i.getLocalGroupMemberInfo(a,e.userID);t&&Ke(e.muteTime)&&t.updateMuteUntil(e.muteTime)}))}},{key:"_updateTopicMuteTime",value:function(e){var t=e.to,n=(e=e.payload).groupProfile,o=void 0===(e=e.memberList)?[]:e,a=(e=this._grpM.get(10),n=n.groupID,e.getLocalTopic(n,t));if(a){for(var i=!1,s=0;s<o.length;s++){var r=o[s];if(r.userID===this._grpM.getMyUserID()&&0<=r.muteTime){a.updateSelfInfo({muteTime:r.muteTime}),i=!0;break}}i&&this._grpM.emitOEvt(M.TOPIC_UPDATED,{groupID:n,topic:a})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=(o=e.payload).groupProfile.groupID,o=o.newTopicInfo;this._grpM.get(10).onTopicProfileUpdated(t({groupID:n,topicID:e.to},o))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e,t){var n=this,o=this._cachedGroupTipsMap.get(e)||[];Le.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," groupType:").concat(t," count:").concat(o.length)),o.forEach((function(e){n.onNewGroupTips(e)})),this._deleteCachedGroupTips(e)}},{key:"_cacheAndCompare",value:function(e){var t=e.groupID,n=e.event,o=e.item;e=e.groupType,Le.l("".concat(this._n,"._cacheAndCompare groupID:").concat(t," groupType:").concat(e)),this._cacheGroupTips(t,{event:n,dataList:[o]}),n={groupID:t,type:e},e===S.GRP_AVCHATROOM?this._grpM.hasLocalGroup(t)?this._notifyCachedGroupTips(t,e):this._grpM.setUnjoinedAVChatRoom(t):(this._grpM.updateGroupMap([n]),this._notifyCachedGroupTips(t,e)),this._checkCountMap.has(t)||this._checkCountMap.set(t,0)}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear()}}]),Xa),ua=(i(Ja,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupMessageMap.size&&this._check()}},{key:"_check",value:function(){var e=this;this._cachedGroupMessageMap.forEach((function(t,n){var o=e._checkCountMap.get(n),a=e._grpM.hasLocalGroup(n);Le.l("".concat(e._n,"._check groupID:").concat(n," hasLocalGroup:").concat(a," checkCount:").concat(o)),a?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)}))}},{key:"updateLastMsg",value:function(e){var n="".concat(this._n,".updateLastMsg");if(0!==this._grpM.getGroupMap().size){for(var o,a,i,s,r=!1,c=e.length,l=0;l<c;l++)(o=e[l]).type===S.CONV_GROUP&&0!==o.lastMessage.lastSequence&&null!==o.lastMessage.payload&&(a=o.conversationID.split(/^GROUP/)[1],a=this._grpM.getLocalGroupProfile(a))&&(i=a.lastMessage,s=o.lastMessage,JSON.stringify(i)!==JSON.stringify(s))&&(a.lastMessage=t({},o.lastMessage),r=!0);Le.l("".concat(n," convCount:").concat(c," groupCount:").concat(this._grpM.getLocalGroupList().length," isUpdated:").concat(r)),r&&(this._grpM.sortLocalGroupList(),this._grpM.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewMessage",value:function(e){var t,n=(t=this._assembly(e)).conversationOptionsList,o=t.messageList;0<(0<(0<(t=t.AVChatRoomMessageList).length&&this._grpM.onAVChatRoomMessage(t),t=_t(o)).length&&this._grpM.emitOEvt(M.MESSAGE_MODIFIED,t),0<n.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:n,isInstantMessage:!1!==e.isInstantMessage,updateUnreadCount:!1!==e.updateUnreadCount}),this._grpM.updateNextMessageSeq(n)),t=yt(o)).length&&this._grpM.emitOEvt(M.MESSAGE_RECEIVED,t),o.length=0}},{key:"_assembly",value:function(e){var t=e.dataList,n=e.event,o=e.isInstantMessage,a=null,i=[],s=[],r=[],c={},l=this._grpM.getFileDownloadProxy(),u=this._grpM.getDowloadFileAuthKey(),d=this._grpM.get(17).getFileDNList(),p=t.length;1<p&&t.sort((function(e,t){return e.sequence-t.sequence}));for(var h=this._grpM.get(11),g=this._grpM.get(4),m=0;m<p;m++){var f,v=rt(t[m]),_=(C=v.groupProfile).groupID,y=void 0===(y=C.communityType)?0:y,I=void 0===(I=C.topicID)?void 0:I,E=C.invisible,C=void 0===(C=C.groupType)?void 0:C,k=void 0,T=this._grpM.isMessageFromTopic(y,I),M=(T&&(k=S.CONV_TOPIC,v.to=I),this._grpM.hasLocalGroup(_));!M&&this._grpM.isUnjoinedAVChatRoom(_)||(M||T?this._grpM.isMessageFromOrToAVChatroom(_)?(v.event=n,r.push(v)):(v.currentUser=this._grpM.getMyUserID(),v.conversationType=S.CONV_GROUP,v.isSystemMessage=!!v.isSystemMessage,(a=new ko(v)).setElement(v.elements,l,u,d),1!==E?(M=1===t[m].isModified,h.isMessageSentByCurrentInstance(a)?a.isModified=M:M=!1,1===v.onlineOnlyFlag?(a._onlineOnlyFlag=!0,h.isMessageSentByCurrentInstance(a)||s.push(a)):this._grpM.isMessageFromCommunityOfTopic(y,I)?s.push(a):(a.from===this._grpM.getMyUserID()&&(T=h.getLatestMessageSentByMe(a.conversationID))&&(E=T.nick,y=T.avatar,E===a.nick&&y===a.avatar||(h.modifyMessageSentByMe({conversationID:f,latestNick:a.nick,latestAvatar:a.avatar}),g.mockOnNickAvatarModified(a.nick,a.avatar))),h.pushIntoMessageList(s,a,M)&&(this._qualityStat(o,a),f=(I=a).conversationID,T=I.sequence,E=h.isRemoteRead({conversationID:f,sequence:T}),ut(c[f])?(y=0,"in"!==a.flow||a._isExcludedFromUnreadCount||E||(y=1),c[f]=i.push({conversationID:f,unreadCount:y,type:ut(k)?a.conversationType:k,subType:a.conversationSubType,lastMessage:a._isExcludedFromLastMessage?"":a})-1):(i[M=c[f]].type=ut(k)?a.conversationType:k,i[M].subType=a.conversationSubType,i[M].lastMessage=a._isExcludedFromLastMessage?"":a,"in"!==a.flow||a._isExcludedFromUnreadCount||E||i[M].unreadCount++)))):this._qualityStat(o,a)):this._cacheAndCompare({groupID:_,event:n,item:v,groupType:C}))}return{conversationOptionsList:i,messageList:s,AVChatRoomMessageList:r}}},{key:"_qualityStat",value:function(e,t){var n=this._grpM.get(26);n.addMessageSequence({key:zn,message:t}),e&&0<t.clientTime&&n.addMessageDelay(t.clientTime)}},{key:"onMsgRevoked",value:function(e,t){var n=this,o=this._grpM.get(11),a=[],i=[];e.dataList.forEach((function(e){var t=e.elements.revokedInfos,n=e.revokerInfo,s=e.groupProfile,r=!1;s&&(r=Et({groupID:s.groupID})||!He(s.topicID)),ut(t)||t.forEach((function(e){var t,c=He(e.topicID)?"GROUP".concat(e.groupID):"GROUP".concat(e.topicID),l=o.getLocalConversation(c),u=e.revokerInfo&&e.revokerInfo.revoker||n&&n.revoker,d=n&&n.reason||"";l&&It(l.type)?t={conversationID:c,sequence:e.sequence,ID:"".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random)}:(l=o.revoke(c,e.sequence,e.random))?t=l:(t={conversationID:c,sequence:e.sequence},e.tinyID&&e.clientTime&&e.random&&(t.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random)),e.time&&(t.time=e.time)),t&&(t.revoker=u,t.revokeReason=d,t.revokerInfo={userID:u,nick:"",avatar:""},(r?(t.revokerInfo.nick=s.nick,t.revokerInfo.avatar=s.avatar,a):i).push(t))}))})),0===i.length&&0===a.length||(o.onMessageRevoked([].concat(a,i),t),0<a.length&&this._grpM.emitOEvt(M.MESSAGE_REVOKED,a),0<i.length&&o.updateRevokerInfo(i).then((function(e){n._grpM.emitOEvt(M.MESSAGE_REVOKED,e)})))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(v(this._grpM.getGroupMap())),n=0,o=e.length;n<o;n++)t.delete(e[n].groupID);this._grpM.hasJoinedAVChatRoom()&&this._grpM.getJoinedAVChatRoom().forEach((function(e){t.delete(e)})),this._grpM.getGroupMap().forEach((function(e,n){e.isSupportTopic&&t.delete(n)}));for(var a=v(t.keys()),i=0,s=a.length;i<s;i++)this._grpM.deleteGroup(a[i])}},{key:"syncGroupList",value:function(){var e,t,n=this,o=0<arguments.length&&void 0!==arguments[0]&&arguments[0],a=(this._pagingStatus===Mn&&this._grpM.clearGroupMap(),v(x)),i=this.PAGING_GRP_COUNT_LIMIT,s=[];return!0===o?this._pagingGetGroupListWithTopic({limit:i,offset:0,groupBaseInfoFilter:a,groupList:s}):(o="syncGroupList",e="".concat(this._n,".").concat(o),t=new Zn(o),this._pagingGetGroupList({limit:i,offset:0,groupBaseInfoFilter:a,groupList:s}).then((function(){var o=qt(n._pagingGetCostList),a=jt(n._pagingGetCostList),i=(n._pagingGetCostList.length=0,n._pagingStatus=Dn,n._groupListTreeShaking(s),n._grpM.updateGroupMap(s),n._grpM.getLocalGroupList().length);return i="count:".concat(i," sum:").concat(a," avg:").concat(o),Le.l("".concat(e," ok. ").concat(i)),t.setMessage(i).end(),n.tempConversationList&&(n.updateLastMsg(n.tempConversationList),n.tempConversationList=null),n._grpM.emitGroupListUpdate(!0,!0),_n({groupList:n._grpM.getLocalGroupList()})})).catch((function(o){return n._pagingStatus=bn,t.setError(o).end(),Le.e("".concat(e," failed. error:"),o),In(o)})))}},{key:"getGroupList",value:function(){var e,t=this,n="".concat(this._n,".").concat("getGroupList");return Le.l("".concat(n," pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===bn||this._pagingStatus===Mn?this.syncGroupList().then((function(){return _n({groupList:t._grpM.getLocalGroupList(),isSyncCompleted:t.isPagingGetCompleted()})})).catch((function(e){return Le.e("".concat(n," failed. error:"),e),In(e)})):(e=this._grpM.getLocalGroupList(),Le.l("".concat(n,". returned group count:").concat(e.length)),yn({groupList:e,isSyncCompleted:this.isPagingGetCompleted()}))}},{key:"isPagingGetCompleted",value:function(){return this._pagingStatus===Dn}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),o=e.isCommunityRelay,a=void 0!==o&&o,i=e.limit,s=e.offset,r=e.groupBaseInfoFilter,c=e.groupList,l=Date.now();return this._grpM.req({P:Gn.GET_GRP_LIST,data:{type:a?S.GRP_COMMUNITY:void 0,memberAccount:this._grpM.getMyUserID(),limit:i,offset:s,responseFilter:{groupBaseInfoFilter:r,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then((function(e){var o=void 0===(o=(e=e.data).groups)?[]:o,u=(e=e.totalCount,c.push.apply(c,v(o)),t._handleGroupAtInfoWithoutTopic(a,o),!((o=s+i)<e));return e="offset:".concat(s," limit:").concat(i," total:").concat(e," isCompleted:").concat(u," ")+"current:".concat(c.length," isCommunityRelay:").concat(a),t._pagingGetCostList.push(zt(l,!1)),Le.l("".concat(n," ok. ").concat(e," cost:").concat(zt(l))),a||u?!a&&u?(Le.l("".concat(n," start to get community list")),s=0,t._pagingGetGroupList({limit:i,offset:s,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):a&&!u?(s=o,t._pagingGetGroupList({limit:i,offset:s,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):_n({groupList:c}):(s=o,t._pagingGetGroupList({limit:i,offset:s,groupBaseInfoFilter:r,groupList:c}))})).catch((function(e){return 10018===e.code?(Le.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(i)),i=50,t._pagingGetGroupList({limit:i,offset:s,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:a})):a?(11e3===e.code&&Le.l("".concat(n," ok. community unavailable")),yn({groupList:c})):In(e)}))}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),o=e.limit,a=e.offset,i=e.groupBaseInfoFilter,s=e.groupList,r=Date.now();return this._grpM.req({P:Gn.GET_GRP_LIST,data:{type:S.GRP_COMMUNITY,memberAccount:this._grpM.getMyUserID(),limit:o,offset:a,responseFilter:{groupBaseInfoFilter:i,selfInfoFilter:v(B)},isSupportTopic:1,needAppDefineData:1}}).then((function(e){var c=(e=e.data).groups,l=(e=e.totalCount,s.push.apply(s,v(void 0===c?[]:c)),!((c=a+o)<e));return Le.l("".concat(n," ok. offset:").concat(a," limit:").concat(o," totalCount:").concat(e," isCompleted:").concat(l," currentCount:").concat(s.length," cost:").concat(zt(r))),l?(t._grpM.updateGroupMap(s),t._grpM.emitGroupListUpdate(!0,!1),_n({groupList:e=t._grpM.getLocalGroupList().filter((function(e){return!0===e.isSupportTopic}))})):(a=c,t._pagingGetGroupListWithTopic({limit:o,offset:a,groupBaseInfoFilter:i,groupList:s}))})).catch((function(e){return 10018===e.code?(Le.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(o)),o=50,t._pagingGetGroupListWithTopic({limit:o,offset:a,groupBaseInfoFilter:i,groupList:s})):In(e)}))}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e,t){var n=this,o=this._cachedGroupMessageMap.get(e)||[];Le.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," groupType:").concat(t," count:").concat(o.length)),o.forEach((function(e){n.onNewMessage(e)})),this._deleteCachedGroupMessage(e)}},{key:"_cacheAndCompare",value:function(e){var t=e.groupID,n=e.event,o=e.item;e=e.groupType,Le.l("".concat(this._n,"._cacheAndCompare groupID:").concat(t," groupType:").concat(e)),this._cacheGroupMessage(t,{event:n,dataList:[o]}),n={groupID:t,type:e},e===S.GRP_AVCHATROOM?this._grpM.hasLocalGroup(t)?this._notifyCachedGroupMessage(t,e):this._grpM.setUnjoinedAVChatRoom(t):(this._grpM.updateGroupMap([n]),this._notifyCachedGroupMessage(t,e)),this._checkCountMap.has(t)||this._checkCountMap.set(t,0)}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,n){var o=this;e&&0!==n.length&&n.forEach((function(e){var n=e.groupID,a=(e=e.groupAtInfoList,[]);ut(e)||(e.forEach((function(e){a.push(t(t({},e),{},{groupID:n}))})),o._grpM.get(11).onNewGroupAtTips({dataList:a}))}))}},{key:"setPagingGroupCount",value:function(e){ut(e)||(this.PAGING_GRP_COUNT_LIMIT=parseInt(e,10))}},{key:"reset",value:function(){this.PAGING_GRP_COUNT_LIMIT=200,this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._pagingStatus=Mn,this._pagingGetCostList=[]}}]),Ja),da=(i(Wa,[{key:"_onCloudConfig",value:function(){var e=this._grpM.getCloudConfig("grp_attr_cache_time");ut(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach((function(e){e.localMainSequence=0}))}},{key:"isGroupAttributesUpdatedNotice",value:function(e){var t=e.to,n=(e=e.elements.newGroupProfile,!ut(e)&&!He(e.groupAttributeOption));return n&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:e.groupAttributeOption}),n}},{key:"_onGroupAttributesUpdated",value:function(e){var t,n=this,o=e.groupID,a=(e=e.groupAttributeOption).mainSequence,i=e.isWithChangedAttributeInfo,s=void 0===(s=e.groupAttributeList)?[]:s;e=e.operationType,Le.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(o," isWithChangedAttributeInfo:").concat(i," operationType:").concat(e)),ut(e)||(this._groupAttributesCopy=this._getCachedAttributes({groupID:o}),0!=(t=a-this._getLocalGroupAttributes(o).localMainSequence)&&(1===i&&1==t?(this._refreshCachedGroupAttributes({groupID:o,remoteMainSequence:a,groupAttributeList:s,operationType:e}),this._emitGroupAttributesUpdated(o)):this._hasLocalGroupAttributes(o)&&(i=this._getLocalGroupAttributes(o).avChatRoomKey,this._getGroupAttributes({groupID:o,avChatRoomKey:i}).then((function(){n._emitGroupAttributesUpdated(o)})))))}},{key:"initGroupAttributesCache",value:function(e){var t=e.groupID;e=void 0===(e=e.avChatRoomKey)?void 0:e,this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:e}),Le.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(e))}},{key:"initGroupAttributes",value:function(e){var t=this,n=e.groupID,o=e.groupAttributes,a=(e=this._getLocalGroupAttributes(n)).remoteMainSequence,i=(e=e.avChatRoomKey,new Zn("initGroupAttributes"));return i.setMessage("groupID:".concat(n," avChatRoomKey:").concat(e," mainSequence:").concat(a)),this._grpM.req({P:Gn.SET_GRP_ATTR,data:{groupID:n,avChatRoomKey:e,mainSequence:a,groupAttributeList:this._transformGroupAttributes(o)}}).then((function(e){Le.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n));var a=(e=e.data).mainSequence;return(e=v(e.groupAttributeList)).forEach((function(e){e.value=o[e.key]})),t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:a,groupAttributeList:e,operationType:1}),t._emitGroupAttributesUpdated(n),i.end(),_n({groupAttributes:o})})).catch((function(e){return i.setError(e).end(),In(e)}))}},{key:"setGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),o=e.groupID,a=e.groupAttributes,i=(e=this._getLocalGroupAttributes(o)).remoteMainSequence,s=e.avChatRoomKey,r=e.attributes,c=((e=this._transformGroupAttributes(a)).forEach((function(e){var t=e.key;e.sequence=0,r.has(t)&&(e.sequence=r.get(t).sequence)})),new Zn("setGroupAttributes"));return c.setMessage("groupID:".concat(o," groupAttributes:").concat(JSON.stringify(a))),Le.l("".concat(n,". groupID:").concat(o," mainSequence:").concat(i)),this._grpM.req({P:Gn.MODIFY_GRP_ATTR,data:{groupID:o,avChatRoomKey:s,mainSequence:i,groupAttributeList:e}}).then((function(e){Le.l("".concat(n," ok."));var i=(e=e.data).mainSequence;return(e=v(e.groupAttributeList)).forEach((function(e){e.value=a[e.key]})),t._groupAttributesCopy=t._getCachedAttributes({groupID:o}),t._refreshCachedGroupAttributes({groupID:o,remoteMainSequence:i,groupAttributeList:e,operationType:2}),t._emitGroupAttributesUpdated(o),c.end(),_n({groupAttributes:a})})).catch((function(e){return c.setError(e).end(),In(e)}))}},{key:"deleteGroupAttributes",value:function(e){var t=this,n=e.groupID,o=(e=void 0===(e=e.keyList)?[]:e,(r=this._getLocalGroupAttributes(n)).remoteMainSequence),a=r.avChatRoomKey,i=r.attributes,s=v(i.keys()),r=Gn.CLEAR_GRP_ATTR,c=3,l=(a={groupID:n,avChatRoomKey:a,mainSequence:o},[]),u=(0<e.length&&(s=[],r=Gn.DEL_GRP_ATTR,c=4,e.forEach((function(e){var t=0;i.has(e)&&(t=i.get(e).sequence,s.push(e)),l.push({key:e,sequence:t})})),a.groupAttributeList=l),new Zn("deleteGroupAttributes"));return u.setMessage("groupID:".concat(n," mainSequence:").concat(o," keyList:").concat(e," proto:").concat(r)),this._grpM.req({P:r,data:a}).then((function(e){return Le.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n)),e=e.data.mainSequence,t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:e,groupAttributeList:l,operationType:c}),t._emitGroupAttributesUpdated(n),u.end(),_n({keyList:s})})).catch((function(e){return u.setError(e).end(),In(e)}))}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),o=e.groupID,a=(r=this._getLocalGroupAttributes(o)).avChatRoomKey,i=r.lastUpdateTime,s=r.localMainSequence,r=r.remoteMainSequence,c=new Zn("getGroupAttributes");return c.setMessage("groupID:".concat(o," localMainSequence:").concat(s," remoteMainSequence:").concat(r," keyList:").concat(e.keyList)),Date.now()-i>=this.CACHE_EXPIRE_TIME||s<r?this._getGroupAttributes({groupID:o,avChatRoomKey:a}).then((function(a){return c.setMoreMessage("get attributes from remote. count:".concat(a.length)).end(),Le.l("".concat(n," from remote. groupID:").concat(o)),_n({groupAttributes:a=t._getCachedAttributes(e)})})).catch((function(e){return c.setError(e).end(),In(e)})):(c.setMoreMessage("get attributes from cache").end(),Le.l("".concat(n," from cache. groupID:").concat(o)),yn({groupAttributes:i=this._getCachedAttributes(e)}))}},{key:"_getGroupAttributes",value:function(e){var n=this,o=0;return ut(e.avChatRoomKey)||(o=1),this._grpM.req({P:Gn.GET_GRP_ATTR,data:t(t({},e),{},{groupType:o})}).then((function(t){Le.l("".concat(n._n,"._getGroupAttributes ok. groupID:").concat(e.groupID));var o=(t=t.data).mainSequence,a=v(t=t.groupAttributeList);return ut(o)||n._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:o,groupAttributeList:a,operationType:5}),t})).catch((function(e){return In(e)}))}},{key:"_refreshCachedGroupAttributes",value:function(e){var t=e.groupID,n=e.remoteMainSequence,o=e.groupAttributeList;if(e=e.operationType,this._hasLocalGroupAttributes(t)){var a=this._getLocalGroupAttributes(t),i=a.localMainSequence;if(5===e||n-i==1)a.remoteMainSequence=n,a.localMainSequence=n,a.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:a,groupAttributeList:o,operationType:e});else{if(i===n)return;a.remoteMainSequence=n}this._groupAttributesMap.set(t,a),o="operationType:".concat(e," localMainSequence:").concat(i," remoteMainSequence:").concat(n),Le.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(o))}}},{key:"_getCachedAttributes",value:function(e){var t=e.groupID,n=(e=void 0===(e=e.keyList)?[]:e,{});if(this._hasLocalGroupAttributes(t)){var o=this._getLocalGroupAttributes(t).attributes;if(0<e.length)e.forEach((function(e){o.has(e)&&(n[e]=o.get(e).value)}));else{var a,i=T(o.keys());try{for(i.s();!(a=i.n()).done;){var s=a.value;n[s]=o.get(s).value}}catch(r){i.e(r)}finally{i.f()}}}return n}},{key:"_updateCachedAttributes",value:function(e){var t=e.groupAttributes,n=e.groupAttributeList;3!==(e=e.operationType)?4!==e?(1===e&&t.attributes.clear(),n.forEach((function(e){var n=e.key,o=e.value;e=e.sequence,t.attributes.set(n,{value:o,sequence:e})}))):n.forEach((function(e){t.attributes.delete(e.key)})):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),n=(o=this._computeAttrChangedInfo(t)).updatedKeyList,o=o.deletedKeyList;Le.l("".concat(this._n,"._emitGroupAttributesUpdated update:").concat(n.length,", delete:").concat(o.length)),0===n.length&&0===o.length||this._grpM.emitOEvt(M.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:n,deletedKeyList:o})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],o=[];return Object.keys(e).forEach((function(o){e[o]!==t._groupAttributesCopy[o]&&n.push(o)})),Object.keys(this._groupAttributesCopy).forEach((function(t){ut(e[t])&&o.push(t)})),this._groupAttributesCopy={},{updatedKeyList:n,deletedKeyList:o}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),Wa),pa=(i(Ya,[{key:"_onCloudConfig",value:function(){var e=this._grpM.getCloudConfig("grp_counter_expire_time");ut(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(e){var t=e.to,n=!1;return He(e=e.elements.groupCounterInfo)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:e}),n=!0),n}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach((function(e){var o=e.type,a=e.groupCounterSeq;e=void 0===(e=e.counterList)?[]:e,0!==o&&2!==o||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:a,counterList:e}),e.forEach((function(e){t._grpM.emitOEvt(M.GROUP_COUNTER_UPDATED,{groupID:n,key:e.key,value:e.value})}))),1===o&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:a,counterList:e})})),Le.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(e){var t=e.groupID;e=e.avChatRoomKey,this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:e}),Le.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(e))}},{key:"setGroupCounters",value:function(e){var t,n,o,a,i;return this._grpM.canIUse(P.GRP_COUNTER)?(t="".concat(this._n,".").concat("setGroupCounters"),n=e.groupID,e=e.counters,e=this._convertObjectToList(e),o=this._getLocalGroupCounters(n).avChatRoomKey,a="groupID:".concat(n," count:").concat(e.length),(i=new Zn("setGroupCounters")).setMessage("".concat(a)),Le.l("".concat(t,". ").concat(a)),this._updateGroupCounters({groupID:n,counterList:e,avChatRoomKey:o,mode:"Set"}).then((function(e){return i.end(),Le.l("".concat(t," ok.")),_n({counters:e})})).catch((function(e){return i.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._grpM.noUse("setGroupCounters")}},{key:"increaseGroupCounter",value:function(e){var t,n,o,a,i,s,r="increaseGroupCounter";return this._grpM.canIUse(P.GRP_COUNTER)?(t="".concat(this._n,".").concat(r),n=e.groupID,o=e.key,e=e.value,a=this._getLocalGroupCounters(n).avChatRoomKey,i="groupID:".concat(n," key:").concat(o," value:").concat(e),(s=new Zn(r)).setMessage("".concat(i)),Le.l("".concat(t,". ").concat(i)),this._updateGroupCounters({groupID:n,counterList:[{key:o,value:e}],avChatRoomKey:a,mode:"Increase"}).then((function(e){return s.end(),Le.l("".concat(t," ok.")),_n({counters:e})})).catch((function(e){return s.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._grpM.noUse(r)}},{key:"decreaseGroupCounter",value:function(e){var t,n,o,a,i,s,r="decreaseGroupCounter";return this._grpM.canIUse(P.GRP_COUNTER)?(t="".concat(this._n,".").concat(r),n=e.groupID,o=e.key,e=e.value,a=this._getLocalGroupCounters(n).avChatRoomKey,i="groupID:".concat(n," key:").concat(o," value:").concat(e),(s=new Zn(r)).setMessage("".concat(i)),Le.l("".concat(t,". ").concat(i)),this._updateGroupCounters({groupID:n,counterList:[{key:o,value:e}],avChatRoomKey:a,mode:"Decrease"}).then((function(e){return s.end(),Le.l("".concat(t," ok.")),_n({counters:e})})).catch((function(e){return s.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._grpM.noUse(r)}},{key:"getGroupCounters",value:function(e){var t=this;if(!this._grpM.canIUse(P.GRP_COUNTER))return this._grpM.noUse("getGroupCounters");var n="".concat(this._n,".").concat("getGroupCounters"),o=e.groupID,a=void 0===(e=e.keyList)?[]:e,i=(e=this._getLocalGroupCounters(o)).avChatRoomKey,s=(e=e.lastUpdateTime,new Zn("getGroupCounters"));return s.setMessage("groupID:".concat(o)),Date.now()-e>=this.EXPIRE_TIME?this._getRemoteGroupCounters({groupID:o,avChatRoomKey:i}).then((function(e){return s.setMoreMessage("from remote. count:".concat(e.length)).end(),Le.l("".concat(n," from remote. groupID:").concat(o)),_n({counters:e=t._getLocalCounters(o,a)})})).catch((function(e){return s.setError(e).end(),In(e)})):(s.setMoreMessage("from cache").end(),Le.l("".concat(n," from cache. groupID:").concat(o)),yn({counters:e=this._getLocalCounters(o,a)}))}},{key:"_getRemoteGroupCounters",value:function(e){var n=this;return this._grpM.req({P:Gn.GET_GRP_COUNTER,data:t({},e)}).then((function(t){var o=void 0===(o=(t=t.data).counterList)?[]:o;return t=t.groupCounterSeq,n._updateLocalGroupCounters({groupID:e.groupID,counterList:o,groupCounterSeq:t}),Le.l("".concat(n._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),o})).catch((function(e){return In(e)}))}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_updateGroupCounters",value:function(e){var n="".concat(this._n,"._updateGroupCounters"),o=e.groupID,a=e.avChatRoomKey,i=e.mode;return Le.l("".concat(n,". groupID:").concat(o," avChatRoomKey:").concat(a," mode:").concat(i)),this._grpM.req({P:Gn.UPDATE_GRP_COUNTER,data:t({},e)}).then((function(e){Le.l("".concat(n," ok.")),e=e.data.counterList;var t={};return(void 0===e?[]:e).forEach((function(e){var n=e.key;e=e.value,t[n]=e})),t})).catch((function(e){return In(e)}))}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(e){var t,n,o,a=e.groupID,i=void 0===(i=e.counterList)?[]:i;e=e.groupCounterSeq,this._hasLocalGroupCounters(a)&&(o=this._getLocalGroupCounters(a),t=o.counters,n=o.avChatRoomKey,o=o.groupCounterSeq,0<e&&e<o||(i.forEach((function(e){var n=e.key;e=e.value,t.set(n,e)})),this._groupCountersMap.set(a,{lastUpdateTime:Date.now(),groupCounterSeq:e,counters:t,avChatRoomKey:n})))}},{key:"_deleteLocalGroupCounters",value:function(e){var t,n,o=e.groupID,a=void 0===(a=e.counterList)?[]:a;e=e.groupCounterSeq,this._hasLocalGroupCounters(o)&&(n=this._getLocalGroupCounters(o),t=n.counters,n=n.avChatRoomKey,a.forEach((function(e){t.delete(e.key)})),this._groupCountersMap.set(o,{lastUpdateTime:Date.now(),groupCounterSeq:e,counters:t,avChatRoomKey:n}))}},{key:"_getLocalCounters",value:function(e,t){var n={};if(this._hasLocalGroupCounters(e)){var o=this._getLocalGroupCounters(e).counters;if(0<t.length)t.forEach((function(e){o.has(e)&&(n[e]=o.get(e))}));else{var a,i=T(o.keys());try{for(i.s();!(a=i.n()).done;){var s=a.value;n[s]=o.get(s)}}catch(r){i.e(r)}finally{i.f()}}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),Ya),ha=(i($a,[{key:"start",value:function(){var e=this._grpM.isLoggedIn();e||(this._proto=Gn.AV_NOAUTH_POLLING),Le.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._grpM.req({P:this._proto,data:t}).then((function(t){e._onSuccess(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))})).catch((function(t){e._onFail(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))}))}},{key:"stop",value:function(){Le.l("".concat(this._n,".stop")),0<this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}},{key:"getPollingTimerID",value:function(){return this._timeoutID}}]),$a),ga={3:!0,4:!0,5:!0,6:!0,17:!0,20:!0,21:!0,100:!0},ma=(i(Ka,[{key:"hasJoinedAVChatRoom",value:function(){var e=[];return 0<(e=0<this._joinedGroupMap.size?v(this._joinedGroupMap.values()).filter((function(e){return e.type===S.GRP_AVCHATROOM})):e).length}},{key:"getJoinedLiveList",value:function(){var e=[];return 0<this._joinedGroupMap.size?v(this._joinedGroupMap.values()).filter((function(e){return e.type===S.GRP_LIVE})):e}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return 0<this._joinedGroupMap.size?v(this._joinedGroupMap.keys()):[]}},{key:"_updatedata",value:function(e){var n=this._pollingRequestInfoMap.get(e);return e===v(this._pollingInstanceMap.keys())[0]?t(t({},n),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):t(t({},n),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n,o=(c=t.data).key,a=c.nextSeq,i=c.rspMsgList,s=c.errorCode,r=c.nextBroadcastSeq,c=c.broadcastMessageList;0!==s?(s=this._pollingRequestInfoMap.get(e),n=new Zn("longPollingAVError"),s=s?"".concat(s.key,"-").concat(s.startSeq):"requestInfo is undefined",n.setMessage("".concat(e,"-").concat(s,"-").concat(t.errorInfo)).setCode(t.errorCode).end(!0)):this.checkJoinedAVChatRoomByID(e)&&(lt(o)&&Ke(a)&&this._pollingRequestInfoMap.set(e,{key:o,startSeq:a}),Ke(r)&&r>this._startBroadcastSeq&&(this._startBroadcastSeq=r),We(i)&&0<i.length?(i.forEach((function(e){e.to=e.groupID})),this.onMessage(i,e)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c))}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e,t){if(We(e)&&0!==e.length){var n="".concat(this._n,".onMessage"),o=(t&&(n+=" groupID:".concat(t)),0!==this._pollingNoMessageCount&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL),null),a=[],i=this._get(11),s=this._get(26),r=e.length,c=(1<r&&e.sort((function(e,t){return e.sequence-t.sequence})),this._get(12).isUnlimitedAVChatRoom()),l=!1;Le.getLevel()<=0&&(t=e.map((function(e){return e.sequence})),Le.l("".concat(n," count:").concat(t.length," sequenceList:").concat(t)),t.length=0);for(var u=0;u<r;u++){var d=this.restoreMessageFromSimplified(e[u]);if(ga[d.event]){if(6===d.event){if(this._grpM.isGroupAttributesUpdatedNotice(d))continue;if(this._grpM.isGroupCountersNotice(d))continue}if(20!==d.event)if(21!==d.event)if(100!==d.event){o=this.packMessage(d,d.event);var p=1===d.isModified;if(l=1===d.isHistoryMessage,!c){if(this._seqSll.has(o.sequence))continue;this._seqSll.set(o.sequence)}var h=this._IDSll.has(o.ID);h?Le.w("".concat(n," ID:").concat(o.ID," has:").concat(h)):(this._IDSll.set(o.ID),h=!1,!l&&this._isMessageSentByCurrentInstance(o)?p&&(h=!0,o.isModified=p,i.updateMsgIsModifiedProp(o)):h=!0,h&&(o.conversationType===S.CONV_SYSTEM&&5===o.payload.operationType&&this._onGroupDismissed(o.payload.groupProfile.groupID),l||o.conversationType===S.CONV_SYSTEM||(p=o.conversationID.replace(S.CONV_GROUP,""),this._pollingInstanceMap.has(p)?this._grpM.isLoggedIn()&&s.addMessageSequence({key:$n,message:o}):(o.type!==S.MSG_GRP_TIP&&0<o.clientTime&&s.addMessageDelay(o.clientTime),s.addMessageSequence({key:Kn,message:o}))),a.push(o)))}else this.onRoomCustomData(d);else this._get(34).onMessageReactionNotify({event:21,dataList:d.elements.messageReactionNotifyList});else this.handleMessageRevokedNotice(d)}else Le.w("".concat(n,". unknown event:").concat(d.event))}0!==a.length&&(0<(t=_t(a)).length&&this._grpM.emitOEvt(M.MESSAGE_MODIFIED,t),l||0<(t=this.packConversationOption(a)).length&&i.onNewMessage({conversationOptionsList:t,isInstantMessage:!0}),this._checkMessageStacked(a),0<(t=yt(a)).length&&this._grpM.emitOEvt(M.MESSAGE_RECEIVED,t),a.length=0)}}},{key:"handleMessageRevokedNotice",value:function(e){var t=this,n=e.groupID,o=e.elements.revokeMsgList,a=e.revokerInfo,i=[];o.forEach((function(e){var t=e.tinyID,o=e.clientTime,s=e.random;e=e.sequence,t={conversationID:"".concat(S.CONV_GROUP).concat(n),ID:"".concat(t,"-").concat(o,"-").concat(s),revoker:a.revoker,revokeReason:a.reason||"",revokerInfo:{userID:a.revoker,nick:"",avatar:""},sequence:e},i.push(t)})),0!==i.length&&this._get(11).updateRevokerInfo(i).then((function(e){t._grpM.emitOEvt(M.MESSAGE_REVOKED,e)}))}},{key:"isBroadcastOrNormal",value:function(e){return 3===e||17===e}},{key:"isGroupTip",value:function(e){return 4===e||6===e}},{key:"isGroupSystemNotice",value:function(e){return 5===e}},{key:"restoreGroupTipElements",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=void 0===(t=e.operatorInfo)?{}:t,n=e.operatorID,o=void 0===(o=e.userIDList)?[]:o,a=e.operationType,i=(Ke(e.groupJoinType)||1!==a&&2!==a||(e.groupJoinType=2===a?0:1),a=t.userID,t.avatar);return t=t.nick,e.operatorInfo={userID:void 0===a?n:a,avatar:void 0===i?"":i,nick:void 0===t?"":t},n=o.map((function(e){return{userID:e}})),e.memberInfoList=e.memberInfoList||n,e}},{key:"restoreMessageFromSimplified",value:function(e){var n,o,a,i=e.event;return this.isBroadcastOrNormal(i)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map((function(e){var n;return e.type===S.MSG_CUSTOM&&(n=e.content,e.content=t({data:"",description:"",extension:""},void 0===n?{}:n)),e}))),(this.isGroupTip(i)||this.isGroupSystemNotice(i))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(i)&&(e.elements=this.restoreGroupTipElements(e.elements),o=(a=void 0===(a=e.elements)?{}:a).operationType,n=a.operatorInfo,1===o)&&(o=[{userID:(void 0===n?{}:n).userID}],a.memberInfoList=a.memberInfoList||o),this.isGroupSystemNotice(i)&&(a=(n=e.elements).memberInfoList,o=n.operatorInfo,e.elements.memberInfoList=t({userID:e.elements.operatorID,avatar:"",nick:""},a=a||(void 0===o?{}:o)),e.elements=t({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements),i=Object.keys(e.elements).filter((function(e){return"operatorInfo"!==e})).reduce((function(n,o){return t(t({},n),{},s({},o,e.elements[o]))}),{}),e.elements=i),e}},{key:"_onGroupDismissed",value:function(e){Le.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(e){var t="MessageStacked";100<=(e=e.length)&&(this._grpM.warn(t,e),this._reportMessageStackedCount<5)&&(new Zn(t).setMessage("count:".concat(e," groupID:").concat(v(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1)}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._get(11).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,t){e.currentUser=this._grpM.getMyUserID(),e.conversationType=5===t?S.CONV_SYSTEM:S.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new ko(e),o=(e=this.packElements(e,t),t=this._grpM.getFileDownloadProxy(),this._grpM.getDowloadFileAuthKey()),a=this._get(17).getFileDNList();return n.setElement(e,t,o,a),n}},{key:"packElements",value:function(e,n){return 4===n||6===n?(this._updateMemberCountByGroupTips(e),{type:S.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}):5===n?{type:S.MSG_GRP_SYS_NOTICE,content:t(t({},e.elements),{},{groupProfile:t(t({},e.groupProfile),{},{groupID:e.groupID})})}:e.elements}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var o,a=e[n],i=a.conversationID;t.has(i)?"in"===((o=t.get(i)).lastMessage=a).flow&&o.unreadCount++:t.set(i,{conversationID:a.conversationID,unreadCount:"out"===a.flow?0:1,type:a.conversationType,subType:a.conversationSubType,lastMessage:a})}return v(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(e){var t,n,o,a=e.groupProfile.groupID;He(e=void 0===(e=e.elements.onlineMemberInfo)?void 0:e)||(t=void 0===(t=e.onlineMemberNum)?0:t,e=void 0===(e=e.expireTime)?this.DEFAULT_EXPIRE_TIME:e,n=this._onlineMemberCountMap.get(a)||{},o=Date.now(),He(n)?Object.assign(n,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:o,memberCount:t,expireTime:e}):(n.latestUpdateTime=o,n.memberCount=t),this._onlineMemberCountMap.set(a,n))}},{key:"_onBroadcastMessage",value:function(e){if(!He(e)){for(var t=[],n=e.length,o=null,a=0;a<n;a++){var i=this.restoreMessageFromSimplified(e[a]);ga[i.event]?((o=this.packMessage(i,i.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(o.ID)||(t.push(o),this._broadcastMessageIDMap.set(o.ID,1))):Le.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(i.event))}0<t.length&&this._grpM.emitOEvt(M.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){var t;this._pollingInstanceMap.has(e)?(t=this._pollingInstanceMap.get(e)).isRunning()||t.start():((t=new ha({manager:this,groupID:e,onInit:this._updatedata.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)})).start(),this._pollingInstanceMap.set(e,t),Le.l("".concat(this._n,".start groupID:").concat(e)))}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck(e.group).then((function(){var n=e.longPollingKey,o=e.group,a=o.groupID;return t._joinedGroupMap.set(a,o),t._grpM.updateGroupMap([o]),t._grpM.deleteUnjoinedAVChatRoom(a),t._grpM.emitGroupListUpdate(!0,!1),ut(n)?yn({status:xe,group:o}):Promise.resolve()}))}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then((function(){var n=e.longPollingKey,o=e.group,a=e.startSeq,i=o.groupID;return t._pollingRequestInfoMap.set(i,{key:n,startSeq:void 0===a?0:a}),t.start(i),t._grpM.isLoggedIn()?yn({status:xe,group:o}):yn({status:xe})}))}},{key:"_preCheck",value:function(e){if(!this._get(12).isUnlimitedAVChatRoom()&&this.hasJoinedAVChatRoom()&&e.type!==S.GRP_LIVE){var t=(e=f(this._joinedGroupMap.entries().next().value,2))[0];if(e=e[1],this._grpM.isLoggedIn()&&e.selfInfo.role!==S.GRP_MBR_ROLE_OWNER&&e.ownerID!==this._grpM.getMyUserID())return this._grpM.quitGroup(t);this._grpM.deleteLocalGroupAndConversation(t),this.reset(t)}return Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,o="".concat(this._n,".").concat("joinWithoutAuth"),a=new Zn("joinWithoutAuth");return this._grpM.req({P:Gn.APPLY_JOIN_GRP_NOAUTH,data:e}).then((function(e){if(e=e.data.longPollingKey,a.setMessage("groupID:".concat(n," longPollingKey:").concat(e)).end(!0),ut(e))return In({code:Un.CANNOT_JOIN_NON_AV_WITHOUT_LOGIN});Le.l("".concat(o," ok. groupID:").concat(n)),t._get(11).setCompleted("".concat(S.CONV_GROUP).concat(n));var i=new oa({groupID:n});return t.startRunLoop({group:i,longPollingKey:e}),_n({status:xe})})).catch((function(e){return Le.e("".concat(o," failed. groupID:").concat(n," error:"),e),a.setError(e).setMessage("groupID:".concat(n)).end(!0),In(e)})).finally((function(){t._grpM.get(14).reportAtOnce()}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return He(t)||n-t.lastSyncTime>1e3*t.expireTime&&1e4<n-t.latestUpdateTime&&3e3<n-t.lastReqTime?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then((function(e){return _n({memberCount:e.memberCount})})).catch((function(e){return In(e)}))):yn({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount"),o=new Zn("_getGroupOnlineMemberCount");return this._grpM.requestOnlineCount(e).then((function(o){var a=t._onlineMemberCountMap.get(e)||{},i=void 0===(i=(o=o.data).memberCount)?0:i,s=(o=void 0===(o=o.expireTime)?t.DEFAULT_EXPIRE_TIME:o,Le.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(i," expireTime:").concat(o)),Date.now());return He(a)&&(a.lastReqTime=s),t._onlineMemberCountMap.set(e,Object.assign(a,{lastSyncTime:s,latestUpdateTime:s,memberCount:i,expireTime:o})),{memberCount:i}})).catch((function(t){return Le.w("".concat(n," failed. error:"),t),o.setCode(t.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(t))).end(),Promise.reject(t)}))}},{key:"_get",value:function(e){return this._grpM.get(e)}},{key:"setPollingInterval",value:function(e){ut(e)||(Ke(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){ut(e)||(Ke(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){ut(e)||(Ke(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){ut(e)||"0"!==e&&"1"!==e||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){e=e.payload.groupProfile.groupID,Le.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"restartPolling",value:function(){Le.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=T(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(o){t.e(o)}finally{t.f()}}},{key:"getPollingTimerID",value:function(e){var t;return this._pollingInstanceMap.has(e)?(t=this._pollingInstanceMap.get(e).getPollingTimerID(),Le.l("".concat(this._n,".getPollingTimerID groupID:").concat(e," timerID:").concat(t)),t):-1}},{key:"hasPollingInstance",value:function(e){return this._pollingInstanceMap.has(e)}},{key:"onRoomCustomData",value:function(e){var t=e.groupID,n=e.sequence,o=e.time;e=(e=e.elements)&&e.content,this._get(30).onRoomCustomDataReceived(e),Le.l("".concat(this._n,".onRoomCustomData groupID:").concat(t," sequence:").concat(n," time:").concat(o," data:").concat(e))}},{key:"reset",value:function(e){if(e){Le.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{Le.l("".concat(this._n,".reset all"));var n,o=T(this._pollingInstanceMap.values());try{for(o.s();!(n=o.n()).done;)n.value.stop()}catch(a){o.e(a)}finally{o.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this._seqSll.reset(),this._IDSll.reset(),this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),Ka),fa=(i(za,[{key:"updateMember",value:function(e){ut(e.onlineStatus)||(this.isOnline="Online"===e.onlineStatus);var t=[null,void 0,"",0,NaN];e.memberCustomField&&vt(this.memberCustomField,e.memberCustomField),Qe(this,e,["memberCustomField","marks","onlineStatus"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){ut(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){ut(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&vt(this.memberCustomField,e)}}]),za),va=(i(qa,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,o=0;o<n.length;o++)!function(e){var o=n[e];t.groupMemberListMap.forEach((function(e){e.has(o.userID)&&e.get(o.userID).updateMember({nick:o.nick,avatar:o.avatar})}))}(o)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var t,n=this,o=e.groupID,a=void 0===(a=e.role)?void 0:a,i=void 0===(c=e.offset)?0:c,s=void 0===(c=e.count)?15:c,r=(e=void 0===(c=e.filter)?void 0:c,"".concat(this._n,".").concat("getGroupMemberList")),c=this._grpM.hasLocalGroup(o);if(Le.l("".concat(r," groupID:").concat(o," role:").concat(a," offset:").concat(i," count:").concat(s," hasLocalGroup:").concat(c)),!c)return yn({memberList:[],offset:0});if(this._grpM.getLocalGroupProfile(o).type===S.GRP_AVCHATROOM){if(this._grpM.canIUse(P.AV_MBR_LIST))return this._getAVChatRoomMemberList({groupID:o,offset:i,filter:e});this._grpM.warn("LiveOnlineMember")}a!==S.GRP_MBR_ROLE_ADMIN&&a!==S.GRP_MBR_ROLE_OWNER&&a!==S.GRP_MBR_ROLE_MEMBER||(t=a);var l=new Zn("getGroupMemberList"),u=0,d=(c={groupID:o,limit:100<s?100:s,memberRoleFilter:t?[t]:void 0,memberInfoFilter:this.DEFAULT_MEMBER_INFO_FILTER},Et({groupID:o})?c.next="".concat(i):u=(c.offset=i)+s,[]);return this._grpM.req({P:Gn.GET_GRP_MBR_LIST,data:c}).then((function(e){var t=(e=e.data).members,a=e.memberNum;return e=e.next,ut(e=void 0===e?void 0:e)||(u=He(e)?0:e),We(t)&&0!==t.length?(n._grpM.hasLocalGroup(o)&&(n._grpM.getLocalGroupProfile(o).memberNum=a),d=n._updateLocalGroupMemberMap(o,t),n._grpM.get(4).getUserProfile({userIDList:t.map((function(e){return e.userID})),tagList:[Ae.NICK,Ae.AVATAR]})):(u=0,Promise.resolve([]))})).then((function(e){return We(e=e.data)&&0!==e.length?(e=e.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}})),n._updateLocalGroupMemberMap(o,e),d.length<s&&(u=0),l.setMessage("groupID:".concat(o," offset:").concat(i," count:").concat(s)).end(),Le.l("".concat(r," ok.")),_n({memberList:d,offset:u})):yn({memberList:[],offset:u})})).catch((function(e){return l.setError(e).end(),Le.e("".concat(r," failed. error:"),e),In(e)}))}},{key:"_getAVChatRoomMemberList",value:function(e){var n=this,o=e.groupID,a=e.offset,i=(e=e.filter,"".concat(this._n,".").concat("_getAVChatRoomMemberList")),s=new Zn("_getAVChatRoomMemberList");return s.setMessage("groupID:".concat(o," offset:").concat(a," filter:").concat(e)),this._grpM.req({P:Gn.GET_AV_MBR_LIST,data:{groupID:o,offset:a,filter:e}}).then((function(e){var a=void 0===(a=(e=e.data).memberList)?[]:a;return e=void 0===(e=e.offset)?0:e,s.end(),Le.l("".concat(i," ok. member count:").concat(a.length,", next request timestamp:").concat(e)),a=a.map((function(e){return t(t({},e),{},{onlineStatus:"Online"})})),_n({memberList:a=n._updateLocalGroupMemberMap(o,a),offset:e})})).catch((function(e){return s.setError(e).end(),Le.e("".concat(i," failed. error:"),e),In(e)}))}},{key:"getGroupMemberProfile",value:function(e){var n,o=this,a="getGroupMemberProfile",i="".concat(this._n,".").concat(a),s="groupID:".concat(e.groupID),r=(5<e.userIDList.length?s+=" userIDList.length:".concat(e.userIDList.length):s+=" userIDList:".concat(e.userIDList),Le.l("".concat(i," ").concat(s)),50<e.userIDList.length&&(e.userIDList=e.userIDList.slice(0,50)),e.groupID),c=e.userIDList;return(i=this._grpM.getLocalGroupProfile(r))&&It(i.type)?In({code:i=Un.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(i,a)}):((n=new Zn(a)).setMessage(s),this._getGroupMemberProfileAdvance(t(t({},e),{},{userIDList:c})).then((function(e){return We(e=e.data.members)&&0!==e.length?(o._updateLocalGroupMemberMap(r,e),o._grpM.get(4).getUserProfile({userIDList:e.map((function(e){return e.userID})),tagList:[Ae.NICK,Ae.AVATAR]})):yn([])})).then((function(e){return e=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}})),o._updateLocalGroupMemberMap(r,e),e=c.filter((function(e){return o.hasLocalGroupMember(r,e)})).map((function(e){return o.getLocalGroupMemberInfo(r,e)})),n.end(),_n({memberList:e})})))}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),o=e.groupID,a=this._grpM.getLocalGroupProfile(o),i=a.type,s=new Zn("addGroupMember");return s.setMessage("groupID:".concat(o," groupType:").concat(i)),It(i)?(i=new On({code:Un.CANNOT_ADD_MEMBER_IN_AV}),s.setError(i).end(),In(i)):(e.userIDList=e.userIDList.map((function(e){return{userID:e}})),Le.l("".concat(n," groupID:").concat(o)),this._grpM.req({P:Gn.ADD_GRP_MBR,data:e}).then((function(o){o=o.data.members;var i=(Le.l("".concat(n," ok")),o.filter((function(e){return 1===e.result})).map((function(e){return e.userID}))),r=o.filter((function(e){return 0===e.result})).map((function(e){return e.userID})),c=o.filter((function(e){return 2===e.result})).map((function(e){return e.userID})),l=(o=o.filter((function(e){return 4===e.result})).map((function(e){return e.userID})),"groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(i,", ")+"failureUserIDList:".concat(r,", ")+"existedUserIDList:".concat(c,", ")+"overLimitUserIDList:".concat(o));return s.setMoreMessage(l).end(),0===i.length?_n({successUserIDList:i,failureUserIDList:r,existedUserIDList:c,overLimitUserIDList:o}):(t._updateConvGroupProfile(a),_n({successUserIDList:i,failureUserIDList:r,existedUserIDList:c,overLimitUserIDList:o,group:a}))})).catch((function(e){return s.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)})))}},{key:"deleteGroupMember",value:function(e){var t,n,o=this,a="".concat(this._n,".").concat("deleteGroupMember"),i=e.groupID,s=e.userIDList,r=this._grpM.getLocalGroupProfile(i);return ut(r)?In({code:Un.CANNOT_FIND_GRP}):It(r.type)?this._grpM.canIUse(P.AV_BAN_MBR)?this._banAVChatRoomMember(e):this._grpM.noUse("deleteGroupMember"):(t="groupID:".concat(i," ").concat(5<s.length?"userIDList.length:".concat(s.length):"userIDList:".concat(s)),Le.l("".concat(a," groupID:").concat(i," userIDList:"),s),(n=new Zn("deleteGroupMember")).setMessage(t),this._grpM.req({P:Gn.DEL_GRP_MBR,data:e}).then((function(){return n.end(),Le.l("".concat(a," ok")),o._updateConvGroupProfile(r),o.deleteLocalGroupMembers(i,s),_n({group:r,userIDList:s})})).catch((function(e){return n.setError(e).end(),Le.e("".concat(a," failed. error:"),e),In(e)})))}},{key:"_updateConvGroupProfile",value:function(e){this._grpM.get(11).updateConvGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("_banAVChatRoomMember"),o=e.groupID,a=e.userIDList,i="groupID:".concat(o," ").concat(5<a.length?"userIDList.length:".concat(a.length):"userIDList:".concat(a)),s=new Zn("_banAVChatRoomMember"),r=(s.setMessage(i),Le.l("".concat(n," groupID:").concat(o," userIDList:"),a),this._grpM.getLocalGroupProfile(o));return ut(e.duration)||0===e.duration?In({code:Un.BAN_DURATION_INVALID}):this._grpM.req({P:Gn.BAN_AV_MBR,data:e}).then((function(){return s.end(),Le.l("".concat(n," ok")),t.deleteLocalGroupMembers(o,a),_n({group:r,userIDList:a})})).catch((function(e){return s.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"setGroupMemberMuteTime",value:function(e){var t,n,o=this,a=e.groupID,i=e.userID,s=(e=e.muteTime,"".concat(this._n,".").concat("setGroupMemberMuteTime"));return i===this._grpM.getMyUserID()?In({code:Un.CANNOT_MUTE_SELF}):(t="groupID:".concat(a," userID:").concat(i," muteTime:").concat(e),Le.l("".concat(s," ").concat(t)),(n=new Zn("setGroupMemberMuteTime")).setMessage(t),this.modifyGroupMemberInfo({groupID:a,userID:i,muteTime:e}).then((function(e){return n.end(),Le.l("".concat(s," ok")),_n({group:o._grpM.getLocalGroupProfile(a),member:e})})).catch((function(e){return n.setError(e).end(),Le.e("".concat(s," failed. error:"),e),In(e)})))}},{key:"setGroupMemberRole",value:function(e){var t,n,o="".concat(this._n,".").concat("setGroupMemberRole"),a=e.groupID,i=e.userID,s=(e=e.role,"groupID:".concat(a," userID:").concat(i," role:").concat(e)),r=this._grpM.getLocalGroupProfile(a);return r&&r.selfInfo.role!==S.GRP_MBR_ROLE_OWNER?In({code:Un.NOT_OWNER}):(t=[S.GRP_MBR_ROLE_ADMIN,S.GRP_MBR_ROLE_MEMBER],Et({groupID:a})&&t.push(S.GRP_MBR_ROLE_CUSTOM),t.indexOf(e)<0?In({code:Un.INVALID_MEMBER_ROLE}):i===this._grpM.getMyUserID()?In({code:Un.CANNOT_SET_SELF_MEMBER_ROLE}):((n=new Zn("setGroupMemberRole")).setMessage(s),Le.l("".concat(o," ").concat(s)),this.modifyGroupMemberInfo({groupID:a,userID:i,role:e}).then((function(e){return n.end(),Le.l("".concat(o," ok")),_n({group:r,member:e})})).catch((function(e){return n.setError(e).end(),Le.e("".concat(o," failed. error:"),e),In(e)}))))}},{key:"_filterProfanity",value:function(e,t){var n,o=this._grpM.get(29);return!o||(n=(o=o.filterText(t[e],"group_member_profile")).isAllowedToSend,o=o.modifiedText,!0===n&&(t[e]=o,!0))}},{key:"setGroupMemberNameCard",value:function(e){var t,n,o,a,i,s=this,r="setGroupMemberNameCard",c="".concat(this._n,".").concat(r);return e.nameCard&&!1===this._filterProfanity("nameCard",e)?In({code:Un.PROFANITY_FOUND}):(t=e.groupID,a=e.userID,n=void 0===a?this._grpM.getMyUserID():a,o=e.nameCard,a="groupID:".concat(t," userID:").concat(n," nameCard:").concat(o),Le.l("".concat(c," ").concat(a)),(e=this._grpM.getLocalGroupProfile(t))&&It(e.type)?In({code:e=Un.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(e,r)}):((i=new Zn(r)).setMessage(a),this.modifyGroupMemberInfo({groupID:t,userID:n,nameCard:o}).then((function(e){Le.l("".concat(c," ok")),i.end();var a=s._grpM.getLocalGroupProfile(t);return n===s._grpM.getMyUserID()&&a&&a.setSelfNameCard(o),_n({group:a,member:e})})).catch((function(e){return i.setError(e).end(),Le.e("".concat(c," failed. error:"),e),In(e)}))))}},{key:"setGroupMemberCustomField",value:function(e){var t,n=this,o="setGroupMemberCustomField",a="".concat(this._n,".").concat(o),i=e.groupID,s=void 0===(s=e.userID)?this._grpM.getMyUserID():s,r=(e=e.memberCustomField,"groupID:".concat(i," userID:").concat(s," memberCustomField:").concat(JSON.stringify(e))),c=(Le.l("".concat(a," ").concat(r)),this._grpM.getLocalGroupProfile(i));return c&&It(c.type)?In({code:c=Un.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(c,o)}):((t=new Zn(o)).setMessage(r),this.modifyGroupMemberInfo({groupID:i,userID:s,memberCustomField:e}).then((function(e){return t.end(),Le.l("".concat(a," ok")),_n({group:n._grpM.getLocalGroupProfile(i),member:e})})).catch((function(e){return t.setError(e).end(),Le.e("".concat(a," failed. error:"),e),In(e)})))}},{key:"modifyGroupMemberInfo",value:function(e){var n=this,o=e.groupID,a=e.userID,i=void 0;return Ct(o)&&(o=Gt(i=o)),this._grpM.req({P:Gn.MODIFY_GRP_MBR_INFO,data:t(t({},e),{},{groupID:o,topicID:i})}).then((function(){var t;return n.hasLocalGroupMember(o,a)?(t=n.getLocalGroupMemberInfo(o,a),ut(e.muteTime)||t.updateMuteUntil(e.muteTime),ut(e.role)||t.updateRole(e.role),ut(e.nameCard)||t.updateNameCard(e.nameCard),ut(e.memberCustomField)||t.updateMemberCustomField(e.memberCustomField),t):(t=n._grpM.getLocalGroupProfile(o))&&!It(t.type)?n.getGroupMemberProfile({groupID:o,userIDList:[a]}).then((function(e){return f(e.data.memberList,1)[0]})):void 0}))}},{key:"markGroupMemberList",value:function(e){var t="".concat(this._n,".").concat("markGroupMemberList"),n=e.groupID,o=e.markType,a=e.enableMark,i=void 0===(e=e.userIDList)?[]:e,s=(e="groupID:".concat(n," markType:").concat(o," enableMark:").concat(a," userIDList count:").concat(i.length),Le.l("".concat(t," ").concat(e)),2),r=[],c=(!0===a&&(s=1),a=v(i),500<i.length&&(a=i.slice(0,500),Le.w("".concat(t," ").concat(Ht(500)))),a.forEach((function(e){r.push({userID:e,markType:[o]})})),a=null,new Zn("markGroupMemberList"));return c.setMessage(e),this._grpM.req({P:Gn.MARK_AV_MBR_INFO,data:{groupID:n,operationType:s,memberList:r}}).then((function(e){e=e.data.memberList;var n=[],o=[];return(e=void 0===e?[]:e).length===i.length?n.push.apply(n,v(i)):(e.forEach((function(e){n.push(e.userID)})),i.forEach((function(e){n.includes(e)||o.push(e)}))),e="success count:".concat(n.length," fail count:").concat(o.length),c.setMessage(e).end(),Le.l("".concat(t," ok. ").concat(e)),_n({successUserIDList:n,failureUserIDList:o})})).catch((function(e){return c.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this._grpM.req({P:Gn.GET_GRP_MBR_PROFILE,data:t(t({},e),{},{memberInfoFilter:e.memberInfoFilter||this.DEFAULT_MEMBER_INFO_FILTER})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return We(t)&&0!==t.length?t.map((function(t){return n.hasLocalGroupMember(e,t.userID)?n.getLocalGroupMemberInfo(e,t.userID).updateMember(t):n.setLocalGroupMember(e,new fa(t)),n.getLocalGroupMemberInfo(e,t.userID)})):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach((function(e){n.delete(e)}))}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).set(t.userID,t):(t=(new Map).set(t.userID,t),this.groupMemberListMap.set(e,t))}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),qa),_a=[17,18,20],ya=(i(Ha,[{key:"onNewGroupSystemNotice",value:function(e){var t=e.dataList,n=e.isSyncingEnded,o=(e=e.isInstantMessage,(Le.d("".concat(this._n,".onReceiveSystemNotice count:").concat(t.length)),t=this._assembly({notifiesList:t,isInstantMessage:e})).eventDataList);t=t.result,0<o.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:e}),this._onReceivedGroupSystemNotice({result:t,isInstantMessage:e})),e?0<t.length&&this._grpM.emitOEvt(M.MESSAGE_RECEIVED,t):!0===n&&this._clearGroupSystemNotice()}},{key:"_assembly",value:function(e){var n=e.notifiesList,o=e.isInstantMessage,a=null,i=n.length,s=0,r=[],c={conversationID:S.CONV_SYSTEM,unreadCount:0,type:S.CONV_SYSTEM,subType:null,lastMessage:null};for(s=0;s<i;s++){var l=n[s],u=(d=l.groupProfile).communityType,d=void 0===(d=d.topicID)?void 0:d,p=void 0===(p=(h=l.elements).topicIDList)?void 0:p,h=h.operationType;if(!(2!==(void 0===u?0:u)||He(d)&&He(p))){if(_a.includes(h)){this._handleTopicSystemNotice(l);continue}He(d)||(l.to=d)}15!==l.elements.operationType&&(l.currentUser=this._grpM.getMyUserID(),l.conversationType=S.CONV_SYSTEM,l.conversationID=S.CONV_SYSTEM,(a=new ko(l)).setElement({type:S.MSG_GRP_SYS_NOTICE,content:t(t({},l.elements),{},{groupProfile:t({},l.groupProfile)})}),a.isSystemMessage=!0,(1===a.sequence&&1===a.random||2===a.sequence&&2===a.random)&&(a.sequence=ot(),a.random=ot(),a.generateMessageID(),Le.l("".concat(this._n,"._assembly regenerate ID:").concat(a.ID))),this._grpM.get(11).pushIntoNoticeResult(r,a))&&(o?c.unreadCount++:a.setIsRead(!0),c.subType=a.conversationSubType)}return c.lastMessage=r[r.length-1],{eventDataList:0<r.length?[c]:[],result:r}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then((function(t){t.forEach((function(t){e.pendencyMap.set("".concat(t.from,"_").concat(t.groupID,"_").concat(t.to),t)})),t=e._grpM.get(11).getLocalMessageList(S.CONV_SYSTEM);var n=[];t.forEach((function(t){var o=(i=t.payload).operatorID,a=i.operationType,i=i.groupProfile;1===a&&(a="".concat(o,"_").concat(i.groupID,"_").concat(i.to),o=e.pendencyMap.get(a))&&Ke(o.handled)&&0!==o.handled&&n.push(t)})),e.deleteGroupSystemNotice({messageList:n})}))}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return We(e.messageList)&&0!==e.messageList.length?(Le.l("".concat(n," ")+e.messageList.map((function(e){return e.ID}))),this._grpM.req({P:Gn.DEL_GRP_SYSTEM_NOTICE,data:{messageListToDelete:e.messageList.map((function(e){return{from:S.CONV_SYSTEM,messageSeq:e.clientSequence,messageRandom:e.random}}))}}).then((function(){Le.l("".concat(n," ok"));var o=t._grpM.get(11);return e.messageList.forEach((function(e){o.deleteLocalMessage(e)})),_n()})).catch((function(e){return Le.e("".concat(n," error:"),e),In(e)}))):yn()}},{key:"_getPendencyList",value:function(){var e=this,t=(o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type,n=o.startTime,o=o.limit;return this._grpM.req({P:Gn.GET_GRP_PENDENCY,data:{type:void 0===t?void 0:t,startTime:void 0===n?0:n,limit:void 0===o?20:o,handleAccount:this._grpM.getMyUserID()}}).then((function(t){var n=t.data.pendencyList;return 0!==t.data.nextStartTime?e._getPendencyList({startTime:t.data.nextStartTime}).then((function(e){return[].concat(v(n),v(e))})):n}))}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then((function(t){return e._getPendencyList({type:S.GRP_COMMUNITY}).then((function(n){return t.push.apply(t,v(n)),e._handlePendencyResult(t)})).catch((function(n){return e._handlePendencyResult(t)}))}))}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach((function(e){t.pendencyMap.set("".concat(e.from,"_").concat(e.groupID,"_").concat(e.to),e),0===e.handled&&n.push({applicant:e.from,applicantNick:e.fromUserNickName,groupName:e.groupName,groupID:e.groupID,authentication:e.authentication,messageKey:e.time,applicationType:e.applicationType,userID:e.userID,note:e.note})})),yn({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach((function(e){switch(e.payload.operationType){case 1:case 3:case 6:case 11:case 12:case 15:break;case 2:t._onApplyJoinGroup(e);break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 20:t._onMessageRemindTypeSynced(e);break;case 21:t._grpM.onAVChatRoomMemberBanned(e)}}))}},{key:"_onApplyJoinGroup",value:function(e){var t=this,n=(e=e.payload.groupProfile).groupID,o=(e=e.groupType,this._grpM.hasLocalGroup(n));Le.l("".concat(this._n,"._onApplyJoinGroup groupID:").concat(n," groupType:").concat(e," hasGroup:").concat(o)),o||It(e)||this._grpM.getGroupProfile({groupID:n}).then((function(e){(e=e.data.group)&&(t._grpM.updateGroupMap([e]),e=!e.isSupportTopic,t._grpM.emitGroupListUpdate(!0,e))}))}},{key:"_onMemberKicked",value:function(e){e=e.payload.groupProfile.groupID,this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e)}},{key:"_onGroupDismissed",value:function(e){e=e.payload.groupProfile.groupID;var t=(this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e),this._grpM._AVChatRoomHandler);t&&t.checkJoinedAVChatRoomByID(e)&&t.reset(e)}},{key:"_onInviteGroup",value:function(e){var t=this,n=e.payload.groupProfile.groupID;e=this._grpM.hasLocalGroup(n),Le.l("".concat(this._n,"._onInviteGroup groupID:").concat(n," hasGroup:").concat(e)),this._grpM.getGroupProfile({groupID:n}).then((function(){t._grpM.emitGroupListUpdate(),t._grpM.get(11).pullMsgOnInvite("".concat(S.CONV_GROUP).concat(n))}))}},{key:"_onQuitGroup",value:function(e){var t=(e=e.payload.groupProfile).groupID,n=(e=e.groupType,this._grpM.hasLocalGroup(t));Le.l("".concat(this._n,"._onQuitGroup groupID:").concat(t," groupType:").concat(e," hasGroup:").concat(n)),n&&this._grpM.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(e){var t=(e=e.payload.groupProfile).to;e=e.groupID,(e=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(e,t))&&e.updateRole(S.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(e){var t=(e=e.payload.groupProfile).to;e=e.groupID,(e=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(e,t))&&e.updateRole(S.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(e){var t=e.payload.groupProfile.groupID;e=e.payload.messageRemindType,this._grpM.get(11).onGroupMsgRemindTypeUpdated({groupID:t,messageRemindType:e})}},{key:"_handleTopicSystemNotice",value:function(e){var t=(n=e.groupProfile).groupID,n=n.topicID,o=(e=e.elements).operationType,a=e.topicIDList,i=(e=e.messageRemindType,this._grpM.get(10));17===o?i.onTopicCreated({groupID:t,topicID:n}):18===o?i.onTopicDeleted({groupID:t,topicIDList:a}):20===o&&i.onMessageRemindTypeUpdated({groupID:t,topicID:n,messageRemindType:e})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),Ha),Ia=["relayFlag"],Ea=(r(Fa,Nn),Jo=m(Fa),i(Fa,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),o=this.getCloudConfig("polling_simplified_msg"),a=this.getCloudConfig("paging_grp_count");Le.l("".concat(this._n,"._onCloudConfig pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(o," pagingGroupCount:").concat(a)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(o),this._commonGroupHandler.setPagingGroupCount(a)}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t,n=this;return e.conversationType!==S.CONV_GROUP||(t=Ct(e.to)?Gt(e.to):e.to,this.hasLocalGroup(t))?yn():this.getGroupProfile({groupID:t}).then((function(o){return o=o.data.group.type,Le.l("".concat(n._n,".guardForAVChatRoom. groupID:").concat(t," type:").concat(o)),o===S.GRP_AVCHATROOM?In(new On({code:o=Un.MSG_SEND_FAIL_NOT_IN_AV,message:n.getErrMsg(o,e.from,t),data:{message:e}})):yn()}))}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewMessage",value:function(e){this._commonGroupHandler.onNewMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t,n=this;We(e)&&(t=this.get(10),e.forEach((function(e){var o=e.conversationID.replace(S.CONV_GROUP,"");Ct(o)&&t.updateUnreadCountAndLastMsg(o,e.lastMessage),n.groupMap.has(o)&&(n.groupMap.get(o).nextMessageSeq=e.lastMessage.sequence+1)})))}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler.onNewGroupTips(e)}},{key:"onMsgRevoked",value:function(e){this._commonGroupHandler.onMsgRevoked(e,!(1<arguments.length&&void 0!==arguments[1])||arguments[1])}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onMsgReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n;e=e.elements.groupMessageReadNotice,ut(e)||(n=t.get(11),e.forEach((function(e){var o=e.groupID,a=void 0===(a=e.topicID)?void 0:a,i=(e=e.lastMessageSeq,Le.l("".concat(t._n,".onMsgReadNotice groupID:").concat(o," lastMessageSeq:").concat(e)),o="".concat(S.CONV_GROUP).concat(o),!0);He(a)||(o="".concat(S.CONV_GROUP).concat(a),i=!1),n.updateIsReadAfterReadReport({conversationID:o,lastMessageSeq:e}),n.updateUnreadCount(o,i),n.clearGroupAtInfoList(o,i)})))}))}},{key:"onReadReceiptList",value:function(e){var t=this;Le.l("".concat(this._n,".onReadReceiptList options:"),e),e.dataList.forEach((function(e){var n=e.groupProfile,o=(e=e.elements,n=n.groupID,t.get(11));e=e.readReceiptList,o.updateReadReceiptInfo({groupID:n,readReceiptList:e})}))}},{key:"onMsgModified",value:function(e){Le.l("".concat(this._n,".onMsgModified options:"),e);var n=this.get(11);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:S.CONV_GROUP,to:e.topicID||e.groupID}))}))}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new oa(e))}},{key:"clearGroupMap",value:function(){this.groupMap.clear()}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,o=this.get(11);e.forEach((function(e){t=e.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(e):(n.groupMap.set(t,new oa(e)),o.deleteGroupRoamingInfo(t))}));var a,i=this.getMyUserID(),s=T(this.groupMap);try{for(s.s();!(a=s.n()).done;){var r=f(a.value,2)[1];r.selfInfo.userID=i,"Owner"===r.selfInfo.role&&(r.ownerID=i)}}catch(c){s.e(c)}finally{s.f()}}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return v(this.groupMap.values()).filter((function(e){return e.type!==S.GRP_ROOM&&e.type!==S.GRP_LIVE}))}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=v(this.groupMap).filter((function(e){return(e=f(e,2))[0],!He(e[1].lastMessage)}));e.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})),this.groupMap=new Map(v(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler.updateLastMsg(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroupList();e&&this.emitOEvt(M.GROUP_LIST_UPDATED),t&&(e=JSON.parse(JSON.stringify(n)),this.get(11).updateConvGroupProfile(e))}},{key:"getMyNameCardByGroupID",value:function(e){return(e=this.getLocalGroupProfile(e))?e.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return this._commonGroupHandler.isPagingGetCompleted()}},{key:"getMsgRemindType",value:function(e){var t=this;return We(e)&&0!==e.length&&0!==(e=e.filter((function(e){return!It(t.getLocalGroupProfile(e).type)}))).length?(Le.l("".concat(this._n,".getMsgRemindType groupIDList:").concat(e)),this.getGroupProfileAdvance({groupIDList:e,responseFilter:{memberInfoFilter:["MsgFlag"]}}).then((function(e){e=e.data.successGroupList;var n=t.get(11);e.forEach((function(e){n.onGroupMsgRemindTypeUpdated({groupID:e.groupID,messageRemindType:We(e.members)?e.members[0].messageRemindType:""})}))}))):Promise.resolve()}},{key:"getGroupList",value:function(){return this._commonGroupHandler.getGroupList()}},{key:"syncCommunityWithTopic",value:function(){return this._commonGroupHandler.syncGroupList(!0)}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),o=new Zn("getGroupProfile"),a=e.groupID,i=e.groupCustomFieldFilter;return Le.l("".concat(n," groupID:").concat(a)),i={groupIDList:[a],responseFilter:{groupBaseInfoFilter:v(x),groupCustomFieldFilter:i,memberInfoFilter:[].concat(v(B),["NameCard"])}},this.getGroupProfileAdvance(i).then((function(e){var i=(e=e.data).successGroupList;return e=e.failureGroupList,Le.l("".concat(n," ok")),0<e.length?In(e[0]):((e=It(i[0].type)&&!t.hasLocalGroup(a)?new oa(i[0]):(t.updateGroupMap(i),t.getLocalGroupProfile(a))).isSupportTopic||t.get(11).updateConvGroupProfile([e]),o.setMessage("groupID:".concat(a," type:").concat(e.type," muteAllMembers:").concat(e.muteAllMembers," ownerID:").concat(e.ownerID)).end(),_n({group:e}))})).catch((function(t){return o.setError(t).setMessage("groupID:".concat(e.groupID)).end(),Le.e("".concat(n," failed. error:"),t),In(t)}))}},{key:"getGroupProfileAdvance",value:function(e){var n,o="".concat(this._n,".getGroupProfileAdvance"),a=(We(s=e.groupIDList)&&50<s.length&&(this.warn("GetGroupProfileLimit"),s.length=50),[]),i=[],s=(s.forEach((function(e){(Et({groupID:e})?i:a).push(e)})),[]);return 0<a.length&&(n=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:a})),s.push(n)),0<i.length&&(n=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:i,relayFlag:0<a.length})),s.push(n)),Promise.all(s).then((function(e){var t=[],n=[];return e.forEach((function(e){t.push.apply(t,v(e.successGroupList)),n.push.apply(n,v(e.failureGroupList))})),_n({successGroupList:t,failureGroupList:n})})).catch((function(e){return Le.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,o=void 0!==n&&n,a=h(e,Ia);return this.req({P:Gn.GET_GRP_PROFILE,data:a}).then((function(e){return Le.l("".concat(t._n,"._getGroupProfileAdvance ok. options:"),a),{successGroupList:(e=e.data.groups).filter((function(e){return ut(e.errorCode)||0===e.errorCode})),failureGroupList:e.filter((function(e){return e.errorCode&&0!==e.errorCode})).map((function(e){return new On({code:e.errorCode,message:e.errorInfo,data:{groupID:e.groupID}})}))}})).catch((function(t){return o&&Et({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:In(t)}))}},{key:"createGroup",value:function(e){var n=this,o=[S.GRP_PUBLIC,S.GRP_WORK,S.GRP_MEETING,S.GRP_AVCHATROOM,S.GRP_COMMUNITY],a="".concat(this._n,".").concat("createGroup"),i=e.type,s=e.groupID;if(e.name&&!1===this._filterProfanity("name",e))return In({code:Un.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return In({code:Un.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return In({code:Un.PROFANITY_FOUND});if(!o.includes(i))return In({code:Un.ILLEGAL_GRP_TYPE});if(!Et({type:i})){if(!He(s)&&Et({groupID:s}))return In({code:Un.ILLEGAL_GRP_ID});e.isSupportTopic=void 0}if(It(i)&&!ut(e.memberList)&&0<e.memberList.length&&(e.memberList=void 0),this._canIUseJoinOption(i)||ut(e.joinOption)||(e.joinOption=void 0),Et({type:i})){if(!He(s)&&!Et({groupID:s}))return In({code:Un.ILLEGAL_GRP_ID});e.isSupportTopic=!0===e.isSupportTopic?1:0}var r=new Zn("createGroup"),c=(Le.l("".concat(a," options:"),e),null),l=[];return this.req({P:Gn.CREATE_GRP,data:t(t({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then((function(o){var i,s,u,d=(o=o.data).groupID,p=void 0===(o=o.overLimitUserIDList)?[]:o;return c=d,l=p,o="groupType:".concat(e.type," groupID:").concat(d," overLimitUserIDList:").concat(p),r.setMessage(o).end(),Le.l("".concat(a," ok. ").concat(o)),e.type===S.GRP_AVCHATROOM||e.type===S.GRP_COMMUNITY&&1===e.isSupportTopic||(He(e.memberList)||He(p)||(e.memberList=e.memberList.filter((function(e){return-1===p.indexOf(e.userID)}))),n.updateGroupMap([t(t({},e),{},{groupID:d})]),o=n.get(2),u="",i=0,e.type===S.GRP_COMMUNITY?(u=n.isIntl()?"Create Community":"创建社群",i=1):u=n.isIntl()?"Create Group":"创建群组",s=n.get(4).getMyNick(),u=o.createCustomMessage({to:d,conversationType:S.CONV_GROUP,payload:{data:JSON.stringify({businessID:"group_create",content:u,cmd:i,opUser:s||n.getMyUserID(),version:4})}}),o.sendMessageInstance(u),n.emitGroupListUpdate()),n.getGroupProfile({groupID:d})})).then((function(e){var t=(n=(e=e.data.group).selfInfo).nameCard,n=n.joinTime;return e.updateSelfInfo({nameCard:t,joinTime:n,messageRemindType:S.MSG_REMIND_ACPT_AND_NOTE,role:S.GRP_MBR_ROLE_OWNER}),_n({group:e,overLimitUserIDList:l})})).catch((function(o){var i;return r.setMessage("groupType:".concat(e.type)).setError(o).end(),10010===o.code||10007===o.code?(n._silentlyGetGroupProfile(o.code,c),n.updateGroupMap([t(t({},e),{},{groupID:c})]),(i=n.getLocalGroupProfile(c)).selfInfo.role=S.GRP_MBR_ROLE_OWNER,_n({group:i,overLimitUserIDList:l})):(Le.e("".concat(a," failed. error:"),o),In(o))}))}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup"),o="groupID:".concat(e),a=new Zn("dismissGroup");return a.setMessage(o),Le.l("".concat(n," ").concat(o)),this.req({P:Gn.DISMISS_GRP,data:{groupID:e}}).then((function(){return a.end(),Le.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),_n({groupID:e})})).catch((function(e){return a.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"updateGroupProfile",value:function(e){var t,n,o=this,a="".concat(this._n,".").concat("updateGroupProfile");return this.hasLocalGroup(e.groupID)&&(t=this.getLocalGroupProfile(e.groupID).type,this._canIUseJoinOption(t)||ut(e.joinOption)||(Le.w("".concat(a," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)),ut(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&!1===this._filterProfanity("name",e)||e.introduction&&!1===this._filterProfanity("introduction",e)||e.notification&&!1===this._filterProfanity("notification",e)?In({code:Un.PROFANITY_FOUND}):((n=new Zn("updateGroupProfile")).setMessage(JSON.stringify(e)),Le.l("".concat(a," groupID:").concat(e.groupID)),this.req({P:Gn.UPDATE_GRP_PROFILE,data:e}).then((function(){return n.end(),Le.l("".concat(a," ok")),o.hasLocalGroup(e.groupID)&&o.groupMap.get(e.groupID).updateGroup(e),_n({group:o.groupMap.get(e.groupID)})})).catch((function(e){return n.setError(e).end(),Le.l("".concat(a," failed. error:"),e),In(e)})))}},{key:"_filterProfanity",value:function(e,t){var n,o=this.get(29);return!o||(n=(o=o.filterText(t[e],G)).isAllowedToSend,o=o.modifiedText,!0===n&&(t[e]=o,!0))}},{key:"joinGroup",value:function(e){var t,n=this,o=e.groupID,a="".concat(this._n,".joinGroup");return this.deleteUnjoinedAVChatRoom(o),this.hasLocalGroup(o)?this.isLoggedIn()?(t=new Zn("applyJoinGroup"),this.getGroupProfile({groupID:o}).then((function(){return t.setMessage("groupID:".concat(o," joinedStatus:").concat(S.JOIN_STATUS_ALREADY_IN_GROUP)).end(),yn({status:S.JOIN_STATUS_ALREADY_IN_GROUP})})).catch((function(i){return t.setMessage("groupID:".concat(o," unjoined")).end(),Le.w("".concat(a," ").concat(o," was unjoined, now join!")),n.groupMap.delete(o),n.applyJoinGroup(e)}))):yn({status:S.JOIN_STATUS_ALREADY_IN_GROUP}):(Le.l("".concat(a," groupID:").concat(o)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e))}},{key:"applyJoinGroup",value:function(e){var n,o,a=this,i="".concat(this._n,".").concat("applyJoinGroup"),s=e.groupID;return He(e.applyMessage)||!1!==this._filterProfanity("applyMessage",e)?(n=new Zn("applyJoinGroup"),e=t({},e),(o=this.canIUse(P.AV_HISTORY_MSG))&&(e.historyMessageFlag=1),this.get(11).deleteTopicRoamingInfo(s),this.req({P:Gn.APPLY_JOIN_GRP,data:e}).then((function(e){var t=(e=e.data).joinedStatus,r=e.longPollingKey,c=e.startSeq,l=e.avChatRoomFlag,u=e.avChatRoomKey,d=e.messageList;switch(e="groupID:".concat(s," joinedStatus:").concat(t," longPollingKey:").concat(r," startSeq:").concat(c)+" avChatRoomFlag:".concat(l," canGetAVChatRoomHistoryMsg:").concat(o,",")+" historyMsgCount:".concat(He(d)?0:d.length),n.setMessage(e).end(),Le.l("".concat(i," ok. ").concat(e)),t){case Be:return _n({status:Be});case xe:return a.getGroupProfile({groupID:s}).then((function(e){return e=e.data.group,a._handleJoinResult({group:e,avChatRoomFlag:l,longPollingKey:r,startSeq:c,avChatRoomKey:u,messageList:d})})).catch((function(e){var t;return 10010===e.code||10007===e.code?(a._silentlyGetGroupProfile(e.code,s),t=new oa({groupID:s}),a.updateGroupMap([t]),a._handleJoinResult({group:t,avChatRoomFlag:l,longPollingKey:r,startSeq:c,avChatRoomKey:u,messageList:d})):(Le.e("".concat(i," failed. error:"),e),In(e))}));default:var p=new On({code:Un.JOIN_GRP_FAIL});return Le.e("".concat(i," failed. error:"),p),In(p)}})).catch((function(e){return n.setMessage("groupID:".concat(s)).setError(e).end(),Le.e("".concat(i," failed. error:"),e),In(e)}))):In({code:Un.PROFANITY_FOUND})}},{key:"_handleJoinResult",value:function(e){var t=this,n=e.group,o=e.avChatRoomFlag,a=e.longPollingKey,i=e.startSeq,s=e.avChatRoomKey,r=e.messageList,c=n.groupID;return 1===o?(this.get(11).setCompleted("".concat(S.CONV_GROUP).concat(c)),this._groupAttributesHandler.initGroupAttributesCache({groupID:c,avChatRoomKey:s}),this._groupCountersHandler.initGroupCountersCache({groupID:c,avChatRoomKey:s}),(e=ut(a)?this._AVChatRoomHandler.handleJoinResult({group:n}):this._AVChatRoomHandler.startRunLoop({group:n,longPollingKey:a,startSeq:i})).then((function(){t._onAVChatRoomHistoryMessage(r,c)})),e):(this.emitGroupListUpdate(!0,!1),_n({status:xe,group:n}))}},{key:"quitGroup",value:function(e){var t,n=this,o="".concat(this._n,".").concat("quitGroup"),a="groupID:".concat(e),i=(Le.l("".concat(o," ").concat(a)),this.checkJoinedAVChatRoomByID(e));return i||this.hasLocalGroup(e)?i&&!this.isLoggedIn()?(Le.l("".concat(o," anonymously ok. ").concat(a)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),yn({groupID:e})):((t=new Zn("quitGroup")).setMessage(a),this.req({P:Gn.QUIT_GRP,data:{groupID:e}}).then((function(){return t.end(),Le.l("".concat(o," ok")),n.deleteLocalGroupAndConversation(e),i&&n._AVChatRoomHandler.reset(e),n._groupAttributesHandler.deleteLocalGroupAttributes(e),_n({groupID:e})})).catch((function(e){return t.setError(e).end(),Le.e("".concat(o," failed. error:"),e),In(e)}))):In({code:Un.MEMBER_NOT_IN_GRP})}},{key:"searchGroupByID",value:function(e){var t="".concat(this._n,".").concat("searchGroupByID"),n={groupIDList:[e]},o=new Zn("searchGroupByID");return o.setMessage("groupID:".concat(e)),Le.l("".concat(t," groupID:").concat(e)),this.req({P:Gn.SEARCH_GRP,data:n}).then((function(e){if(0!==(e=e.data.groupProfile)[0].errorCode)throw new On({code:e[0].errorCode,message:e[0].errorInfo});return o.end(),Le.l("".concat(t," ok")),_n({group:new oa(e[0])})})).catch((function(e){return o.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"changeGroupOwner",value:function(e){var t,n=this,o="".concat(this._n,".").concat("changeGroupOwner");return this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===S.GRP_AVCHATROOM?In({code:Un.CANNOT_CHANGE_OWNER_IN_AV}):e.newOwnerID===this.getMyUserID()?In({code:Un.CANNOT_CHANGE_OWNER_TO_SELF}):((t=new Zn("changeGroupOwner")).setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),Le.l("".concat(o," groupID:").concat(e.groupID)),this.req({P:Gn.CHANGE_GRP_OWNER,data:e}).then((function(){t.end(),Le.l("".concat(o," ok"));var a,i=e.groupID,s=e.newOwnerID,r=(n.groupMap.get(i).ownerID=s,n._groupMemberHandler.getLocalGroupMemberList(i));return r instanceof Map&&(a=r.get(n.getMyUserID()),ut(a)||(a.updateRole("Member"),n.groupMap.get(i).selfInfo.role="Member"),a=r.get(s),ut(a)||a.updateRole("Owner")),n.emitGroupListUpdate(!0,!1),_n({group:n.groupMap.get(i)})})).catch((function(e){return t.setError(e).end(),Le.e("".concat(o," failed. error:"),e),In(e)})))}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,o,a,i,s=this,r="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,l=e.handleMessage,u=e.message,d=e.application,p=(u?(t=u.payload.operatorID,n=u.payload.groupProfile.groupID,o=u.payload.authentication,a=u.payload.messageKey):d&&(t=d.applicant,n=d.groupID,o=d.authentication,a=d.messageKey),Gn.HANDLE_GRP_APPLICATION),h=(d&&2===d.applicationType&&(p=Gn.HANDLE_INVITE_JOIN_GRP,i=d.userID),new Zn("handleGroupApplication"));return h.setMessage("groupID:".concat(n)),Le.l("".concat(r," groupID:").concat(n)),this.req({P:p,data:{handleAction:c,handleMessage:l,applicant:t,invitee:i,groupID:n,authentication:o,messageKey:a}}).then((function(){return h.end(),Le.l("".concat(r," ok")),u&&s._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),_n({group:s.getLocalGroupProfile(n)})})).catch((function(e){return h.setError(e).end(),Le.e("".concat(r," failed. error"),e),In(e)}))}},{key:"handleGroupInvitation",value:function(e){var n=this,o="".concat(this._n,".").concat("handleGroupInvitation"),a=(r=e.message.payload).groupProfile.groupID,i=r.authentication,s=r.messageKey,r=r.operatorID,c=e.handleAction,l=new Zn("handleGroupInvitation");return l.setMessage("groupID:".concat(a," inviter:").concat(r," handleAction:").concat(c)),Le.l("".concat(o," groupID:").concat(a," inviter:").concat(r," handleAction:").concat(c)),this.req({P:Gn.HANDLE_GRP_INVITATION,data:t(t({},e),{},{inviter:r,groupID:a,authentication:i,messageKey:s})}).then((function(){return l.end(),Le.l("".concat(o," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),_n({group:n.getLocalGroupProfile(a)})})).catch((function(e){return l.setError(e).end(),Le.e("".concat(o," failed. error"),e),In(e)}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".getGroupOnlineMemberCount"),o=this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e),a=this.hasLocalGroup(e);if(Le.l("".concat(n," groupID:").concat(e," isAVChatRoom:").concat(o," has:").concat(a)),o)return this._AVChatRoomHandler.getGroupOnlineMemberCount(e);if(!a)return yn({memberCount:0});if(o=Date.now(),this._onlineMemberCountMap.has(e)){if(o-(a=this._onlineMemberCountMap.get(e)).lastReqTime<=6e4)return yn({memberCount:a.memberCount});a.lastReqTime=o}return this.requestOnlineCount(e).then((function(o){return o=void 0===(o=o.data.memberCount)?0:o,t._onlineMemberCountMap.set(e,{lastReqTime:Date.now(),memberCount:o}),Le.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(o)),yn({memberCount:o})})).catch((function(e){return Le.w("".concat(n," failed. error:"),e),Promise.reject(e)}))}},{key:"requestOnlineCount",value:function(e){return this.req({P:Gn.GET_ONLINE_MBR_NUM,data:{groupID:e}})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t=this.checkJoinedAVChatRoomByID(e),n=(Le.l("".concat(this._n,".deleteLocalGroupAndConversation groupID:").concat(e," isJoinedAVChatRoom:").concat(t)),this.get(11)),o="".concat(S.CONV_GROUP).concat(e);t&&(this.stopMessageLongPolling({groupID:e}),n.deleteLocalConv(o)),Et({groupID:e})&&(t=this.getLocalGroupProfile(e))&&!0===t.isSupportTopic&&this.get(10).deleteTopicListInCommunity(e),n.clearUnreadCount(o),n.setCompleted(o),this._deleteLocalGroup(e),this._onlineMemberCountMap.delete(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this._groupMemberHandler.deleteGroupMemberList(e)}},{key:"sendMessage",value:function(e,t){return We(e._receiverList)&&0<e._receiverList.length&&!this.canIUse(P.MSG_TO_SPECIFIED_GRP_MBR)?this.noUse("Targeted Group Message"):(e=this.createGroupMessagePack(e,t),this.req(e))}},{key:"createGroupMessagePack",value:function(e,t){var n=null,o=(t&&t.offlinePushInfo&&(n=t.offlinePushInfo),""),a=(lt(e.cloudCustomData)&&0<e.cloudCustomData.length&&(o=e.cloudCustomData),[]),i=void(Ye(t)&&Ye(t.messageControlInfo)&&(i=(r=t.messageControlInfo).excludedFromUnreadCount,s=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===i&&a.push("NoUnread"),!0===s&&a.push("NoLastMsg"),!0===r)&&a.push("NoMsgCheck")),s=(We(e._receiverList)&&0<e._receiverList.length&&(i=e._receiverList,50<e._receiverList.length)&&(i=e._receiverList.slice(0,50),this.warn("ReceiverListLimit")),this.isOnlineMessage(e,t)?1:0),r=JSON.parse(JSON.stringify(e.getElements())),c=(t=this.get(17).getFileDNList(),e.getGroupAtInfoList());return r={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:io(e.type,r,t),cloudCustomData:o,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==S.MSG_TEXT||He(c)?void 0:c,onlineOnlyFlag:s,clientTime:e.clientTime,offlinePushInfo:Po(n),messageControlInfo:0==s?a:void 0,needReadReceipt:!0!==e.needReadReceipt||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:i,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0,cmConfigID:e._cmConfigID},Ct(e.to)&&(r.groupID=Gt(e.to),r.topicID=e.to),{P:Gn.SEND_GRP_MSG,data:r}}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return Ct(e.to)&&(t.groupID=Gt(e.to),t.topicID=e.to),this.req({P:Gn.REVOKE_GRP_MSG,data:t})}},{key:"deleteMessage",value:function(e){var t=e.to;return e=e.keyList,Le.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(e.length)),e={groupID:t,deleter:this.getMyUserID(),keyList:e},Ct(t)&&(e.groupID=Gt(t),e.topicID=t),this.req({P:Gn.DEL_GRP_MSG,data:e})}},{key:"modifyRemoteMessage",value:function(e){var t=e.to,n=e.sequence,o=e.payload,a=e.type,i=void 0===(i=e.version)?0:i,s=e.cloudCustomData,r=(e=e._elements,t),c=void 0;return t=void(Ct(t)&&(r=Gt(t),c=t)),Bt(a)&&(1<e.length&&e.splice(0,1,{type:a,content:o}),t=e),this.req({P:Gn.MODIFY_GRP_MSG,data:{groupID:r,topicID:c,sequence:n,version:i,elements:t,cloudCustomData:s}})}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessage"),o=e.conversationID,a=e.groupID,i=(e=e.sequence,new Zn("getRoamingMessage")),s=0,r=void 0;return Ct(a)&&(a=Gt(r=a)),this._computeLastSequence({groupID:a,topicID:r,sequence:e}).then((function(e){return s=e,Le.l("".concat(n," groupID:").concat(a," startSequence:").concat(s)),t.req({P:Gn.GET_GRP_ROAMING_MSG,data:{groupID:a,count:21,sequence:s,topicID:r}})})).then((function(e){var c=(u=e.data).messageList,l=u.complete,u=void 0===(u=u.invisibleSequenceList)?[]:u,d=(e=void 0===(e=e.data.nextSequence)?0:e,ut(c)?Le.l("".concat(n," ok. complete:").concat(l," nextSequence:").concat(e," but messageList is undefined!")):Le.l("".concat(n," ok. complete:").concat(l," nextSequence:").concat(e," count:").concat(c.length)),i.setMessage("groupID:".concat(a," topicID:").concat(r," startSequence:").concat(s," complete:").concat(l," nextSequence:").concat(e)).end(),t.get(11)),p=[],h=[];return He(c)||(p=d.onRoamingMessage(c,o,!0,h),d.updateIsRead(o),d.patchConvLastMessage(o)),(c=2===l||e<1)&&(d.setCompleted(o),e=""),Le.l("".concat(n," isPullingCompleted:").concat(c," nextReqID:").concat(e," storedMsgCount:").concat(p.length)+" invisibleSeqCount:".concat(u.length)),{nextReqID:e+"",storedMessageList:p,assembledMessageList:h,isPullingCompleted:c}})).catch((function(e){return i.setError(e).setMessage("groupID:".concat(a," topicID:").concat(r," startSequence:").concat(s)).end(),Le.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(S.CONV_GROUP,"")}},{key:"getReadReceiptList",value:function(e){var t,n="".concat(this._n,".").concat("getReadReceiptList"),o=this._getGroupIDOfMessage(e[0]),a=this.getMyUserID(),i=e.filter((function(e){return e.from===a&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));return Le.l("".concat(n," groupID:").concat(o," sequenceList:").concat(JSON.stringify(i))),0===i.length?yn({messageList:e}):((t=new Zn("getReadReceiptList")).setMessage("groupID:".concat(o)),this.req({P:Gn.GET_READ_RECEIPT,data:{groupID:o,sequenceList:i}}).then((function(o){return t.end(),Le.l("".concat(n," ok")),We(o=o.data.readReceiptList)&&o.forEach((function(t){e.forEach((function(e){0===t.code&&t.sequence===e.sequence&&(e.readReceiptInfo.readCount=t.readCount,e.readReceiptInfo.unreadCount=t.unreadCount)}))})),_n({messageList:e})})).catch((function(e){return t.setError(e).end(),Le.w("".concat(n," failed. error:"),e),In(e)})))}},{key:"sendReadReceipt",value:function(e){var t="".concat(this._n,".").concat("sendReadReceipt"),n=this._getGroupIDOfMessage(e[0]),o=new Zn("sendReadReceipt"),a=(o.setMessage("groupID:".concat(n)),this.getMyUserID());return 0===(e=e.filter((function(e){return e.from!==a&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}))).length?In({code:Un.READ_RECEIPT_MSG_LIST_EMPTY}):(Le.l("".concat(t,". sequenceList:").concat(JSON.stringify(e))),this.req({P:Gn.SEND_READ_RECEIPT,data:{groupID:n,sequenceList:e}}).then((function(e){return o.end(),Le.l("".concat(t," ok")),_n()})).catch((function(e){return o.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)})))}},{key:"getReadReceiptDetail",value:function(e){var t=this,n=e.message,o=e.filter,a=e.cursor,i=(e=e.count,this._getGroupIDOfMessage(n)),s=n.ID,r=(n=n.sequence,"".concat(this._n,".").concat("getReadReceiptDetail")),c=this._receiptDetailCompleteMap.get(s)||!1,l=0!==o&&1!==o?0:o,u=(o=lt(a)?a:"",a=!Ke(e)||e<=0||100<=e?100:e,e="groupID:".concat(i," sequence:").concat(n," cursor:").concat(o," filter:").concat(l," completeFlag:").concat(c),Le.l("".concat(r," ").concat(e)),{cursor:"",isCompleted:!1,messageID:s,unreadUserIDList:[],readUserIDList:[]}),d=new Zn("getReadReceiptDetail");return d.setMessage(e),this.req({P:Gn.GET_READ_RECEIPT_DETAIL,data:{groupID:i,sequence:n,flag:l,cursor:o,count:a}}).then((function(e){d.end();var n=(e=e.data).cursor,o=e.isCompleted,a=e.unreadUserIDList;return e=e.readUserIDList,u.cursor=n,1===o&&(u.isCompleted=!0,t._receiptDetailCompleteMap.set(s,!0)),0===l?u.readUserIDList=e.map((function(e){return e.userID})):1===l&&(u.unreadUserIDList=a.map((function(e){return e.userID}))),Le.l("".concat(r," ok")),_n(u)})).catch((function(e){return d.setError(e).end(),Le.w("".concat(r," failed. error:"),e),In(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessagesHopping"),o=e.groupID,a=e.count,i=e.sequence,s=e.direction,r=void 0;return ut(i)&&1===s?yn({messageList:[],isCompleted:!0,nextMessageSeq:""}):(Ct(o)&&(o=Gt(r=o)),this._computeReqSeqHopping({groupID:o,topicID:r,sequence:i}).then((function(c){ut(i)||1!==s||(c=i+a-1);var l="".concat(r?"topicID:".concat(r):"groupID:".concat(o)," sequence:").concat(i," reqSeq:").concat(c," direction:").concat(s),u=(Le.l("".concat(n," ").concat(l)),new Zn("getRoamingMessagesHopping"));return t.req({P:Gn.GET_GRP_ROAMING_MSG,data:{groupID:o,topicID:r,count:a,sequence:c}}).then((function(o){var a=void 0===(a=(o=o.data).messageList)?[]:a,r=o.complete,c=void 0===(c=o.nextSequence)?0:c,d=(o=void 0===(o=o.invisibleSequenceList)?[]:o,"complete:".concat(r," nextSequence:").concat(c," remoteMsgCount:").concat(a.length," invisibleSequenceList:").concat(o)),p=(u.setMessage("".concat(l," ").concat(d)).end(),Le.l("".concat(n," ok. ").concat(d)),d="".concat(S.CONV_GROUP).concat(e.groupID),t.get(11));return d=p.onRoamingMessage(a,d,!1),a=t._computeResult({groupID:e.groupID,direction:s,sequence:i,remoteMessageList:a,processedMessageList:d,complete:r,nextSequence:c,invisibleSequenceList:o}),p.storeHoppingMessageList(a.messageList),_n(a)})).catch((function(e){return u.setError(e).setMessage("groupID:".concat(o," sequence:").concat(i," count:").concat(a)).end(),Le.w("".concat(n," failed. error:"),e),In(e)}))})))}},{key:"_computeReqSeqHopping",value:function(e){var t=this,n=e.groupID,o=void 0===(o=e.topicID)?void 0:o;return 0<(e=void 0===(e=e.sequence)?void 0:e)?Promise.resolve(e):ut(o)?this.getGroupProfileAdvance({groupIDList:[n],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then((function(e){var o=0;return He(e=e.data.successGroupList)||(o=e[0].nextMessageSeq-1),Le.l("".concat(t._n,"._computeReqSeqHopping groupID:").concat(n," lastSequence:").concat(o," from remote")),o})).catch((function(e){return In(e)})):Promise.resolve(0)}},{key:"_computeResult",value:function(e){var t={messageList:[],isCompleted:!1,nextMessageSeq:""},n=e.groupID,o=e.direction,a=e.sequence,i=void 0===(i=e.remoteMessageList)?[]:i,s=void 0===(s=e.processedMessageList)?[]:s,r=e.complete,c=e.nextSequence;if(e=e.invisibleSequenceList,0===o)return t.nextMessageSeq=c,(2===r||c<1)&&(t.isCompleted=!0,t.nextMessageSeq=""),t.messageList=s,t;if(1===o){if(He(i)){if(He(e))return t.isCompleted=!0,t.nextMessageSeq="",t;t.nextMessageSeq=e[0]+1}else r=i[0].sequence,c=e[0]||0,t.nextMessageSeq=c<r?r+1:c+1;return s.forEach((function(e){e.sequence>=a&&t.messageList.push(e)})),(Et({groupID:n})||Ct(n))&&0===t.messageList.length&&i[0].sequence<a&&(t.isCompleted=!0,t.nextMessageSeq=""),t}}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,o=e.lastMessageSeq,a="".concat(this._n,".").concat("setMessageRead"),i=(e="convID:".concat(n," lastMessageSeq:").concat(o),Le.l("".concat(a," ").concat(e)),Ke(o)||this.warn("DoNotModifyLastSeq"),new Zn("setMessageRead")),s=(i.setMessage(e),n.replace(S.CONV_GROUP,"")),r=void 0;return Ct(s)&&(s=Gt(r=s)),this.req({P:Gn.SET_GRP_MSG_READ,data:{groupID:s,topicID:r,messageReadSeq:o}}).then((function(){i.end(),Le.l("".concat(a," ok"));var e,c=t.get(11),l=(c.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:o}),!0);return!ut(r)&&(l=!1,e=t.get(10).getLocalTopic(s,r))&&e.updateSelfInfo({readedSequence:o}),c.updateUnreadCount(n,l),_n()})).catch((function(e){return i.setError(e).end(),Le.l("".concat(a," failed. error:"),e),In(e)}))}},{key:"_computeLastSequence",value:function(e){var t=e.groupID,n=void 0===(n=e.topicID)?void 0:n;return 0<(e=e.sequence)?Promise.resolve(e):ut(n)?this.getGroupLastSequence(t):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t="".concat(this._n,".").concat("getGroupLastSequence"),n=new Zn("getGroupLastSequence"),o=0,a="",i="groupID:".concat(e);if(this.hasLocalGroup(e)){var s=this.getLocalGroupProfile(e),r=s.lastMessage;if(0<r.lastSequence&&!1===r.onlineOnlyFlag)return o=r.lastSequence,a="".concat(i,", ").concat(o," from group.lastMessage.lastSequence"),Le.l("".concat(t," ").concat(a)),n.setMessage(a).end(),Promise.resolve(o);if(1<s.nextMessageSeq)return o=s.nextMessageSeq-1,a="".concat(i,", ").concat(o," from group.nextMessageSeq"),Le.l("".concat(t," ").concat(a)),n.setMessage(a).end(),Promise.resolve(o)}return(r=this.get(11).getLocalConversation("GROUP".concat(e)))&&r.lastMessage.lastSequence&&!1===r.lastMessage.onlineOnlyFlag?(o=r.lastMessage.lastSequence,a="".concat(i,", ").concat(o," from conversation.lastMessage.lastSequence"),Le.l("".concat(t," ").concat(a)),n.setMessage(a).end(),Promise.resolve(o)):this.getGroupProfileAdvance({groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then((function(e){return He(e=e.data.successGroupList)?Le.w("".concat(t," ").concat(i,", empty successGroupList")):(o=e[0].nextMessageSeq-1,a="".concat(i,", ").concat(o," from remote"),Le.l("".concat(t," ").concat(a))),n.setMessage(a).end(),o})).catch((function(e){return n.setError(e).setMessage(i).end(),Le.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"isMessageFromOrToAVChatroom",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.hasJoinedAVChatRoom()}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.getJoinedAVChatRoom()}},{key:"getGroupRemoteLastSeq",value:function(e){return(e=this.getLocalGroupProfile(e))?e.nextMessageSeq-1:1}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||!0!==t.onlineUserOnly)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==S.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e,n){var o;He(e)||(Le.l("".concat(this._n,"._onAVChatRoomHistoryMessage groupID:").concat(n," count:").concat(e.length)),o=[],e.forEach((function(e){o.push(t(t({},e),{},{isHistoryMessage:1}))})),this.onAVChatRoomMessage(o,n))}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler.onMessage(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"")}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return 2===e&&!He(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return 2===e&&He(t)}},{key:"getMessageExtensions",value:function(e,t){return Le.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({P:Gn.GET_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMsgExts",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return Le.l("".concat(this._n,".modifyMsgExts operateType:").concat(n)),this.req({P:Gn.MODIFY_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"_genNotifyReqList",value:function(e){for(var t,n,o,a,i=[],s=0,r=e.length;s<r;s++)t=e[s],a=this.getLocalGroupProfile(t).type,n=this._getGroupLastRevokedTime(t),o=1e3*De(),a={notifyType:1,limit:20,type:Et({type:a,groupID:t})?S.GRP_COMMUNITY:void 0,groupID:t,beginTime:n,endTime:o},i.push(a);return i}},{key:"getNotice",value:function(e){var t=this,n="".concat(this._n,".getNotice");0!==(e=e.filter((function(e){var n;return!!t.hasLocalGroup(e)&&(n=(e=t.getLocalGroupProfile(e)).type,e=e.isSupportTopic,!It(n))&&!e}))).length&&(Le.l("".concat(n," list:").concat(e)),this.req({P:Gn.GET_GRP_NOTIFY,data:{notifyReqList:this._genNotifyReqList(e)}}).then((function(e){e=e.data.notifyRspList;var o,a,i=[];We(e)&&(o={dataList:[]},a="".concat(n," ok."),e.forEach((function(e){var n=e.nextRevokedTime,s=e.groupID,r=e.notifyList;a+=" groupID:".concat(s," nextRevokedTime:").concat(n," count:").concat(r.length,"\n"),o.dataList.push({elements:{revokedInfos:t._genRevokedInfos(e)}}),0!==n?(t._setGroupLastRevokedTime(s,n),i.push(s)):t._setGroupLastRevokedTime(s,1e3*De())})),Le.l(a),t.onMsgRevoked(o,!1)),0<i.length&&t.getNotice(i)})).catch((function(e){Le.e("".concat(n," failed. error:"),e)})))}},{key:"_genRevokedInfos",value:function(e){var n=e.notifyList,o=e.groupID,a=[];return We(n)&&n.forEach((function(e){a.push({groupID:o,sequence:e.sequence,random:e.random,revokerInfo:t({},e.revokerInfo)})})),a}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"getGroupMemberHandler",value:function(){return this._groupMemberHandler}},{key:"getGroupMemberList",value:function(e){return this._groupMemberHandler.getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._groupMemberHandler.getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._groupMemberHandler.addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._groupMemberHandler.deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._groupMemberHandler.setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._groupMemberHandler.setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._groupMemberHandler.setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._groupMemberHandler.setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._groupMemberHandler.markGroupMemberList(e)}},{key:"modifyGroupMemberInfo",value:function(e){return this._groupMemberHandler.modifyGroupMemberInfo(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler.restartPolling()}},{key:"getPollingTimerID",value:function(e){var t;return e&&(t=this.getLocalGroupProfile(e))&&It(t.type)?this._AVChatRoomHandler.getPollingTimerID(e):-1}},{key:"_canIUseJoinOption",value:function(e){return e===S.GRP_PUBLIC||Et({type:e})}},{key:"_silentlyGetGroupProfile",value:function(e,t){var n=setTimeout(this.getGroupProfile.bind(this,{groupID:t}),3e3);this._timeoutIDs.push(n),Le.l("".concat(this._n,"._silentlyGetGroupProfile errorCode:").concat(e," groupID:").concat(t," timeoutIDs:").concat(this._timeoutIDs))}},{key:"_clearTimeoutIDs",value:function(){this._timeoutIDs.forEach((function(e){clearTimeout(e)})),this._timeoutIDs=[]}},{key:"startMessageLongPolling",value:function(e){var t=e.groupID,n=e.longPollingKey,o=(e=void 0===(e=e.longPollingSequence)?1:e,this.get(12).isUnlimitedAVChatRoom()),a=(this._AVChatRoomHandler.hasPollingInstance(t)&&this.stopMessageLongPolling({groupID:t}),this._AVChatRoomHandler.getJoinedLiveList());return!o&&0<a.length&&this.stopMessageLongPolling({groupID:a[0]}),o=new oa({groupID:t,type:S.GRP_LIVE}),Le.l("".concat(this._n,".startMessageLongPolling groupID:").concat(t," longPollingKey:").concat(n," longPollingSequence:").concat(e)),this._AVChatRoomHandler.startRunLoop({group:o,longPollingKey:n,startSeq:e})}},{key:"stopMessageLongPolling",value:function(e){e=e.groupID;var t=this.get(11);return this._AVChatRoomHandler.reset(e),this._deleteLocalGroup(e),t.deleteLocalConv("".concat(S.CONV_GROUP).concat(e)),Le.l("".concat(this._n,".stopMessageLongPolling ok, groupID:").concat(e)),yn({groupID:e})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._onlineMemberCountMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler.reset(),this._groupMemberHandler.reset(),this._clearTimeoutIDs()}}]),Fa),Ca=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],ka=(i(Va,[{key:"_initTopic",value:function(e){for(var t in e)Ca.indexOf(t)<0||("selfInfo"===t?this.updateSelfInfo(e[t]):this[t]="muteAllMembers"===t?1===e[t]:e[t])}},{key:"updateUnreadCount",value:function(){this.unreadCount=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=zo(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){ut(e.selfInfo)||this.updateSelfInfo(e.selfInfo),ut(e.muteAllMembers)||(this.muteAllMembers=1===e.muteAllMembers),Qe(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return 0===Qe(this.selfInfo,e,[],[""])}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),Va),Ta=(r(Ba,Nn),Wo=m(Ba),i(Ba,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");ut(e)||(this.TOPIC_CACHE_TIME=Number(e)),ut(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOEvt(M.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,o=e.topicIDList;(void 0===o?[]:o).forEach((function(e){t._deleteLocalTopic(n,e)})),this.emitOEvt(M.TOPIC_DELETED,e)}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID;(n=this.getLocalTopic(t,n))&&(n.updateTopic(e),this.emitOEvt(M.TOPIC_UPDATED,{groupID:t,topic:n}))}},{key:"onTopicLatestMsg",value:function(e){var t,n,o=(e=e||{}).topicLatestMessage;e=e.excludedUnreadSequenceList,He(o)||(t=o.groupProfile.topicID,o.conversationType=S.CONV_GROUP,o.to=t,(n=new ko(o)).setElement(o.elements),this.updateUnreadCountAndLastMsg(t,n,e))}},{key:"onMessageRemindTypeUpdated",value:function(e){var t,n=e.groupID,o=e.topicID,a=(e=e.messageRemindType,this.getLocalTopic(n,o));a&&((t=a.updateSelfInfo({messageRemindType:e}))&&this.emitOEvt(M.TOPIC_UPDATED,{groupID:n,topic:a}),Le.l("".concat(this._n,".onMessageRemindTypeUpdated topicID:").concat(o," messageRemindType:").concat(e," isUpdated:").concat(t)))}},{key:"onAtInfoUpdated",value:function(e){var t=e.topicID,n=(e=e.groupAtInfoList,Gt(t));(t=this.getLocalTopic(n,t))&&!ut(e)&&(t.updateGroupAtInfoList(e),this.emitOEvt(M.TOPIC_UPDATED,{groupID:n,topic:t}))}},{key:"onUnreadCountUpdatedFromConv",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=Gt(e);(e=this.getLocalTopic(n,e))&&e.unreadCount!==t&&(e.updateUnreadCount(t),0===t&&e.updateSelfInfo({readedSequence:e.lastMessage.lastSequence}),this.emitOEvt(M.TOPIC_UPDATED,{groupID:n,topic:e}))}},{key:"onMessageSent",value:function(e){var t,n,o=e.groupID,a=e.topicID;e=e.lastMessage,(a=this.getLocalTopic(o,a))&&(n=(t=void 0===(t=e.sequence)?0:t)+1)>a.nextMessageSeq&&(a.updateNextMessageSeq(n),a.updateLastMessage(e),a.updateSelfInfo({readedSequence:t}),a.updateUnreadCount(0),this.emitOEvt(M.TOPIC_UPDATED,{groupID:o,topic:a}))}},{key:"onMessageModified",value:function(e){var t,n=e.to,o=e.time,a=e.sequence,i=e.elements,s=e.cloudCustomData,r=e.messageVersion,c=Gt(n),l=this.getLocalTopic(c,n);l&&(t=l.lastMessage,Le.d("".concat(this._n,".onMessageModified topicID:").concat(n," lastMessage:"),JSON.stringify(t),"options:",JSON.stringify(e)),t)&&(null===t.payload||t.lastTime===o&&t.lastSequence===a&&t.version!==r)&&(t.type=i[0].type,t.payload=i[0].content,t.messageForShow=xt(t.type,t.payload,this.isIntl()),t.cloudCustomData=s,t.version=r,t.lastSequence=a,t.lastTime=o,this.emitOEvt(M.TOPIC_UPDATED,{groupID:c,topic:l}))}},{key:"onMessageRevoked",value:function(e){var t,n,o,a=this;0!==e.length&&(n=t=null,o=!1,e.forEach((function(e){var i=e.to;n=Gt(i),(t=a.getLocalTopic(n,i))&&(t.reduceUnreadCount()&&(o=!0),t.isLastMessageRevoked(e)&&(t.setLastMessageRevoked(!0),t.setLastMessageRevoker(e.revoker),o=!0),(i=t.selfInfo.excludedUnreadSequenceList||[]).push(e.sequence),t.updateSelfInfo({excludedUnreadSequenceList:i}))})),o)&&this.emitOEvt(M.TOPIC_UPDATED,{groupID:n,topic:t})}},{key:"isLastMessageRevoked",value:function(e){var t=e.topicID,n=(e=e.sequence,Gt(t));return n=this.getLocalTopic(n,t),t=!1,n?n.isLastMessageRevoked({sequence:e}):t}},{key:"updateUnreadCountAndLastMsg",value:function(e,t,n){var o,a=Gt(e),i=this.getLocalTopic(a,e);i&&(o=i.selfInfo.excludedUnreadSequenceList||[],ut(n)||(o=n),t._isExcludedFromUnreadCount&&o.push(t.sequence),i.updateSelfInfo({excludedUnreadSequenceList:o}),Le.l("".concat(this._n,".updateUnreadCountAndLastMsg seq:").concat(t.sequence," lastSeq:").concat(i.lastMessage.lastSequence)),t.sequence>i.lastMessage.lastSequence)&&(i.updateLastMessage(t),n=t.sequence+1,i.updateNextMessageSeq(n),o=this._computeUnreadCount(i),i.updateUnreadCount(o),(t=this.get(11).getLocalConversation("".concat(S.CONV_GROUP).concat(e)))&&t.updateUnreadCount({nextUnreadCount:o,isFromGetConversations:!0}),this.emitOEvt(M.TOPIC_UPDATED,{groupID:a,topic:i}))}},{key:"getJoinedCommunityList",value:function(){return this.get(7).syncCommunityWithTopic()}},{key:"createTopicInCommunity",value:function(e){var n,o=this,a="".concat(this._n,".").concat("createTopicInCommunity"),i=e.topicID;return ut(i)||Ct(i)?e.topicName&&!1===this._filterProfanity("topicName",e)||e.introduction&&!1===this._filterProfanity("introduction",e)||e.notification&&!1===this._filterProfanity("notification",e)?In({code:Un.PROFANITY_FOUND}):(n=new Zn("createTopicInCommunity"),this.req({P:Gn.CREATE_TOPIC,data:t({},e)}).then((function(i){return i=i.data.topicID,n.setMessage("topicID:".concat(i)).end(),Le.l("".concat(a," ok. topicID:").concat(i)),o._updateTopicMap([t(t({},e),{},{topicID:i})]),_n({topicID:i})})).catch((function(e){return n.setError(e).end(),Le.e("".concat(a," failed. error:"),e),In(e)}))):In({code:Un.ILLEGAL_TOPIC_ID})}},{key:"deleteTopicFromCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),o=e.groupID,a=(e=void 0===(e=e.topicIDList)?[]:e,new Zn("deleteTopicFromCommunity"));return a.setMessage("groupID:".concat(o," topicIDList:").concat(e)),this.req({P:Gn.DEL_TOPIC,data:{groupID:o,topicIDList:e}}).then((function(e){e=e.data.resultList;var i=[],s=[];return(void 0===e?[]:e).forEach((function(e){var t=e.topicID,n=e.errorCode;e=e.errorInfo,0===n?i.push({topicID:t}):s.push({topicID:t,code:n,message:e})})),e="success count:".concat(i.length,", fail count:").concat(s.length),a.setMoreMessage(e).end(),Le.l("".concat(n," ok. ").concat(e)),i.forEach((function(e){t._deleteLocalTopic(o,e.topicID)})),_n({successTopicList:i,failureTopicList:s})})).catch((function(e){return a.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"updateTopicProfile",value:function(e){var n,o=this,a="".concat(this._n,".").concat("updateTopicProfile");return Le.l("".concat(a," options:"),e),e.topicName&&!1===this._filterProfanity("topicName",e)||e.introduction&&!1===this._filterProfanity("introduction",e)||e.notification&&!1===this._filterProfanity("notification",e)?In({code:Un.PROFANITY_FOUND}):((n=new Zn("updateTopicProfile")).setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),ut(e.muteAllMembers)||(e.muteAllMembers=!0===e.muteAllMembers?"On":"Off"),this.req({P:Gn.UPDATE_TOPIC_PROFILE,data:t({},e)}).then((function(){return n.end(),Le.l("".concat(a," ok")),o._updateTopicMap([e]),_n({topic:o.getLocalTopic(e.groupID,e.topicID)})})).catch((function(e){return n.setError(e).end(),Le.e("".concat(a," failed. error:"),e),In(e)})))}},{key:"getTopicList",value:function(e){var n=this,o="".concat(this._n,".").concat("getTopicList"),a=e.groupID,i=0===(e=void 0===(e=e.topicIDList)?[]:e).length,s=new Zn("getTopicList");if(s.setMessage("groupID:".concat(a)),this._getTopicTimeMap.has(a)){var r=(c=this._getTopicTimeMap.get(a)).isGetAll,c=c.time;if((r||!r&&!i)&&Date.now()-c<1e3*this.TOPIC_CACHE_TIME&&(r=this._getLocalTopicList(a,e),i||r.length===e.length))return s.setMoreMessage("from cache, topic count:".concat(r.length)).end(),Le.l("".concat(o," groupID:").concat(a," from cache, topic count:").concat(r.length)),yn({successTopicList:r,failureTopicList:[]})}return this.req({P:Gn.GET_TOPIC_LIST,data:{groupID:a,topicIDList:e}}).then((function(e){e=e.data.topicInfoList;var r=[],c=[],l=[];return(void 0===e?[]:e).forEach((function(e){var n=e.topic,o=e.selfInfo,a=e.errorCode,i=(e=e.errorInfo,n.topicID);0===a?(r.push(t(t({},n),{},{selfInfo:o})),c.push(i)):l.push({topicID:i,code:a,message:e})})),n._updateTopicMap(r),n._handleTopicAtInfo(r),e="success count:".concat(c.length,", fail count:").concat(l.length),s.setMoreMessage(e).end(),Le.l("".concat(o," groupID:").concat(a," from remote, ").concat(e)),e=[],He(c)||(n._getTopicTimeMap.set(a,{time:Date.now(),isGetAll:i}),e=n._getLocalTopicList(a,c)),_n({successTopicList:e,failureTopicList:l})})).catch((function(e){return s.setError(e).end(),Le.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){var n=null;return this._topicMap.has(e)?this._topicMap.get(e).get(t):n}},{key:"_getLocalTopicList",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=[];return(e=this._topicMap.get(e))&&(n=v(e.values())),0===t.length?n:n.filter((function(e){return t.includes(e.topicID)}))}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&this._topicMap.get(e).has(t)&&(this._topicMap.get(e).delete(t),Le.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach((function(e){var o=e.groupID,a=e.topicID,i=null;t._topicMap.has(o)||t._topicMap.set(o,new Map),t._topicMap.get(o).has(a)?(i=t._topicMap.get(o).get(a)).updateTopic(e):(t._getTopicLastMessage(e),i=new ka(e,t.isIntl()),t._topicMap.get(o).set(a,i)),e=t._computeUnreadCount(i),i.updateUnreadCount(e),n.push({conversationID:"".concat(S.CONV_GROUP).concat(a),type:S.CONV_TOPIC,unreadCount:e})})),0<n.length&&this.get(11).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;ut(e)?v(this._getTopicTimeMap.keys()).forEach((function(e){t._getTopicTimeMap.set(e,0)})):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=v(this._topicMap.keys()),n=[],o=this.get(11);t.forEach((function(t){var a=[],i=e._getLocalTopicList(t);o.deleteTopicRoamingInfo(t),i.forEach((function(t){var n=void 0===(n=t.lastMessage.lastTime)?0:n;Date.now()-1e3*n<1e3*e.TOPIC_LAST_ACTIVE_TIME&&a.push(t.topicID)})),0<a.length&&n.push({groupID:t,topicIDList:a})})),Le.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t,n,o,a=this;0!==e.length&&(n=5<(t=e.shift()).topicIDList.length?"topicIDList.length:".concat(t.topicIDList.length):"topicIDList:".concat(t.topicIDList),(o=new Zn("relayGetTopicList")).setMessage(n),Le.l("".concat(this._n,"._relayGetTopicList. ").concat(n)),this.getTopicList(t).then((function(){o.end(),a._relayGetTopicList(e)})).catch((function(t){o.setError(t).end(),a._relayGetTopicList(e)})))}},{key:"_handleTopicAtInfo",value:function(e){var n=this;0!==e.length&&e.forEach((function(e){var o=e.groupID,a=e.topicID,i=(e=e.groupAtInfoList,[]);ut(e)||(e.forEach((function(e){i.push(t(t({},e),{},{groupID:o,topicID:a}))})),n.get(11).onNewGroupAtTips({dataList:i}))}))}},{key:"_getTopicLastMessage",value:function(e){var t;ut(e.lastMsg)||(t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,avatar:e.lastMsg.avatar,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:2===e.lastMsg.isPlaceMessage,revoker:He(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker},e.lastMessage=t)}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),o=this.get(11);n.forEach((function(n){n=n.topicID,t._deleteLocalTopic(e,n),t._getTopicTimeMap.delete(e),o.deleteLocalConv("".concat(S.CONV_GROUP).concat(n))}))}},{key:"_computeUnreadCount",value:function(e){var t,n=(a=e.selfInfo).excludedUnreadSequenceList,o=a.readedSequence,a=e.nextMessageSeq-e.selfInfo.readedSequence-1;return We(n)&&(t=0,n.forEach((function(n){o<n&&n<=e.nextMessageSeq-1&&(t+=1)})),1<=t)&&(a-=t),a<0?0:a}},{key:"_filterProfanity",value:function(e,t){var n,o=this.get(29);return!o||(n=(o=o.filterText(t[e],G)).isAllowedToSend,o=o.modifiedText,!0===n&&(t[e]=o,!0))}},{key:"getMessageExtensions",value:function(e,t){Le.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=Gt(e.to);return this.req({P:Gn.GET_GRP_MSG_EXT,data:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMsgExts",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=(Le.l("".concat(this._n,".modifyMsgExts operateType:").concat(n)),Gt(e.to));return this.req({P:Gn.MODIFY_GRP_MSG_EXT,data:{groupID:o,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),Ba),Ma=(i(xa,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),o=e.userIDList;e.fromAccount=this._userM.getMyAccount(),100<o.length&&(Le.w("".concat(n," ").concat(Ht(100))),o.length=100);for(var a,i=[],s=[],r=0,c=o.length;r<c;r++)a=o[r],this._userM.isMyFriend(a)&&this._contains(a)?s.push(this._getProfileFromMap(a)):i.push(a);if(0===i.length)return yn(s);e.toAccount=i;var l=e.bFromGetMyProfile||!1,u=[],d=(e.toAccount.forEach((function(e){u.push({toAccount:e,standardSequence:0,customSequence:0})})),e.userItem=u,new Zn("getUserProfile"));return d.setMessage(5<o.length?"userIDList.length:".concat(o.length):"userIDList:".concat(o)),this._userM.req({P:Gn.GET_USER_PROFILE,data:e}).then((function(e){return d.end(),Le.i("".concat(n," ok")),e=t._handleResponse(e).concat(s),_n(l?e[0]:e)})).catch((function(e){return d.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"getMyProfile",value:function(){var e,t=this._userM.getMyAccount(),n="".concat(this._n,".getMyProfile");return Le.l("".concat(n," myAccount:").concat(t)),this._fill(),this._contains(t)?(e=this._getProfileFromMap(t),Le.d("".concat(n," from cache, myProfile:").concat(JSON.stringify(e))),yn(e)):this.getUserProfile({fromAccount:t,userIDList:[t],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!We(t))return[];for(var n=[],o=(e=Date.now(),0),a=t.length;o<a;o++){var i=(s=t[o]).to,s=s.profileItem;"@TLS#NOT_FOUND"!==i&&""!==i&&(i=this._update(i,this._getLatestProfileFromResponse(i,s)).latestProfile,n.push(i))}return Le.l("".concat(this._n,"._handleResponse cost:").concat(zt(e))),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!He(t))for(var o=0,a=t.length;o<a;o++)if(-1<t[o].tag.indexOf("Tag_Profile_Custom"))n.profileCustomField.push({key:t[o].tag,value:t[o].value});else switch(t[o].tag){case Ae.NICK:n.nick=t[o].value;break;case Ae.GENDER:n.gender=t[o].value;break;case Ae.BIRTHDAY:n.birthday=t[o].value;break;case Ae.LOCATION:n.location=t[o].value;break;case Ae.SELFSIGNATURE:n.selfSignature=t[o].value;break;case Ae.ALLOWTYPE:n.allowType=t[o].value;break;case Ae.LANGUAGE:n.language=t[o].value;break;case Ae.AVATAR:n.avatar=t[o].value;break;case Ae.MESSAGESETTINGS:n.messageSettings=t[o].value;break;case Ae.ADMINFORBIDTYPE:n.adminForbidType=t[o].value;break;case Ae.LEVEL:n.level=t[o].value;break;case Ae.ROLE:n.role=t[o].value;break;default:Le.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[o].tag,t[o].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&!1===this._userM.filterProfanity("nick",e))return In({code:Un.PROFANITY_FOUND});if(e.selfSignature&&!1===this._userM.filterProfanity("selfSignature",e))return In({code:Un.PROFANITY_FOUND});var o=new Zn("updateMyProfile"),a=(o.setMessage(JSON.stringify(e)),(new ea).validate(e));if(!a.valid)return o.setCode(Un.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(a.tips)).end(),Le.e("".concat(n," info:").concat(a.tips)),In({code:Un.UPDATE_PROFILE_INVALID_PARAM});var i,s,r=[];for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&("profileCustomField"===i?e.profileCustomField.forEach((function(e){r.push({tag:e.key,value:e.value})})):r.push({tag:Ae[i.toUpperCase()],value:e[i]}));return 0===r.length?(a=new On({code:Un.UPDATE_PROFILE_NO_KEY}),o.setError(a).end(),Le.e("".concat(n," failed. error:"),a),In(a)):(s=this._userM.getMyAccount(),this._userM.req({P:Gn.UPDATE_MY_PROFILE,data:{fromAccount:s,profileItem:r}}).then((function(a){o.end(),Le.i("".concat(n," ok"));var i=(r=t._update(s,e)).isProfileUpdated,r=r.latestProfile;return!0===i&&t._userM.emitOEvt(M.PROFILE_UPDATED,[r]),yn(r)})).catch((function(e){return o.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)})))}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!He(t)){var n=t.length;Le.d("".concat(this._n,".onProfileModified count:").concat(n," dataList:"),e.dataList);for(var o=[],a=0;a<n;a++){var i=t[a].userID,s=(i=this._update(i,this._getLatestProfileFromResponse(i,t[a].profileList))).isProfileUpdated;i=i.latestProfile,!0===s&&o.push(i)}0<o.length&&(this._userM.emitIEvt(Bo.PROFILE_UPDATED,o),this._userM.emitOEvt(M.PROFILE_UPDATED,o))}}},{key:"_fill",value:function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,o=e.length;n<o;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);Le.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,o=!1,a=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&!0===vt(n.profileCustomField,t.profileCustomField)&&(n.lastUpdatedTime=a,o=!0),0<Qe(n,t,["profileCustomField"])&&(n.lastUpdatedTime=a,o=!0)):(n=new ea(t),!this._userM.isMyFriend(e)&&e!==this._userM.getMyAccount()||(n.lastUpdatedTime=a,o=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userM.getMyAccount()),!0===o&&Le.l("".concat(this._n,"._update account:").concat(e," isUpdated:").concat(o)),{isProfileUpdated:o,latestProfile:n}}},{key:"_flush",value:function(e){var t=v(this.accountProfileMap.values()),n=this._userM.getStorageModule();Le.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userM.getStorageModule().getItem(this.TAG);return He(e)?[]:e}},{key:"onConvProfileUpdated",value:function(e){for(var t,n,o=[],a=0,i=e.length;a<i;a++)n=(t=e[a]).userID,this._userM.isMyFriend(n)&&(this._contains(n)?0<Qe(this._getProfileFromMap(n),t)&&o.push(n):o.push(t.userID));0!==o.length&&(Le.l("".concat(this._n,".onConvProfileUpdated toAccountList:").concat(o)),this.getUserProfile({userIDList:o}))}},{key:"getNickAndAvatarByUserID",value:function(e){return this._contains(e)?{nick:(e=this._getProfileFromMap(e)).nick,avatar:e.avatar}:{nick:"",avatar:""}}},{key:"getUserNickAndAvatar",value:function(e){var t,n=this,o=v(new Set(e)),a=(Le.l("".concat(this._n,".getUserNickAndAvatar userIDList.length:").concat(e.length," uniqueUserIDList.length:").concat(o.length)),[]);return 0===e.length?Promise.resolve(a):(e=this._createUserIDListGroup(o),t=[],e.forEach((function(e){t.push(n.getUserProfile({userIDList:e}))})),Promise.all(t).then((function(e){return e.forEach((function(e){e=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}})),a.push.apply(a,v(e))})),a})))}},{key:"_createUserIDListGroup",value:function(e){for(var t=[],n=0;n<e.length;)t.push(e.slice(n,n+=100));return t}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),xa),Sa=i((function e(t){o(this,e)})),Da=(i(Ga,[{key:"getLocalBlacklist",value:function(){return v(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userM.getMyAccount(),maxLimited:this.maxLimited,startIndex:0,lastSequence:this.currentSequence},o=new Zn("getBlacklist");return this._userM.req({P:Gn.GET_BL,data:n}).then((function(n){var a=(n=n.data).blackListItem,i=(n=n.currentSequence,He(a)?0:a.length);o.setMessage("count:".concat(i)).end(),Le.i("".concat(t," ok")),e.currentSequence=n,e._handleResponse(a,!0),e._userM.emitOEvt(M.BLACKLIST_UPDATED,v(e._blacklistMap.keys()))})).catch((function(e){return o.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"addBlacklist",value:function(e){var t,n,o=this,a=new Zn("addToBlacklist"),i="".concat(this._n,".addBlacklist"),s=this._userM.getMyAccount();return 1===e.userIDList.length&&e.userIDList[0]===s?(n=this._userM.getErrMsg(t=Un.CANNOT_ADD_SELF_TO_BLACKLIST),a.setCode(t).setMessage(n).end(),n=new On({code:t}),Le.e("".concat(i," failed. error:"),n),In(n)):(e.userIDList.includes(s)&&(e.userIDList=e.userIDList.filter((function(e){return e!==s}))),e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({P:Gn.ADD_TO_BL,data:e}).then((function(t){return a.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Le.i("".concat(i," ok")),o._handleResponse(t.resultItem,!0),_n(v(o._blacklistMap.keys()))})).catch((function(e){return a.setError(e).end(),Le.e("".concat(i," failed. error:"),e),In(e)})))}},{key:"_handleResponse",value:function(e,t){if(!He(e))for(var n,o,a,i=0,s=e.length;i<s;i++)o=e[i].to,a=e[i].resultCode,!ut(a)&&0!==a||(t?((n=this._blacklistMap.has(o)?this._blacklistMap.get(o):new Sa).userID=o,He(e[i].addBlackTimeStamp)||(n.timeStamp=e[i].addBlackTimeStamp),this._blacklistMap.set(o,n)):this._blacklistMap.has(o)&&(n=this._blacklistMap.get(o),this._blacklistMap.delete(o)));Le.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),o=new Zn("removeFromBlacklist");return e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({P:Gn.RM_FROM_BL,data:e}).then((function(a){return o.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Le.i("".concat(n," ok")),t._handleResponse(a.data.resultItem,!1),_n(v(t._blacklistMap.keys()))})).catch((function(e){return o.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"onAccountDeleted",value:function(e){for(var t=0,n=e.length;t<n;t++){var o=e[t];this._blacklistMap.has(o)&&this._blacklistMap.delete(o)}var a=e.length;0<a&&(Le.l("".concat(this._n,".onAccountDeleted count:").concat(a," ").concat(a<30?"userIDList:".concat(e):"")),this._userM.emitOEvt(M.BLACKLIST_UPDATED,v(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],o=0,a=e.length;o<a;o++)t=e[o],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new Sa({userID:t})),n.push(t));0<n.length&&(Le.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userM.emitOEvt(M.BLACKLIST_UPDATED,v(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.currentSequence=0}}]),Ga),ba=(i(Pa,[{key:"_onCloudConfig",value:function(){var e=this._userM.getCloudConfig("status_query_count"),t=this._userM.getCloudConfig("status_sub_count"),n=this._userM.getCloudConfig("status_unsub_count");Le.l("".concat(this._n,"._onCloudConfig statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),ut(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),ut(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),ut(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(e){e=e.dataList;var t=this._userM.getMyUserID(),n=this._userM.get(12);e=e.map((function(e){var o=e.to,a=e.statusType;return e=Ko(e=e.customStatus),o===t&&n.setCustomStatus(e),{userID:o,statusType:a,customStatus:e}})),Le.l("".concat(this._n,".onUserStatusUpdated list:").concat(JSON.stringify(e))),this._userM.emitOEvt(M.USER_STATUS_UPDATED,e)}},{key:"setSelfStatus",value:function(e){var t,n,o=this,a="".concat(this._n,".setSelfStatus");return!1===this._userM.filterProfanity("customStatus",e)?In({code:Un.PROFANITY_FOUND}):(t=new Zn("setSelfStatus"),n=e.customStatus,this._userM.req({P:Gn.SET_SELF_STATUS,data:{customStatus:n}}).then((function(e){return t.setMessage("customStatus:".concat(n)).end(),Le.l("".concat(a," ok. customStatus:").concat(n)),o._userM.get(12).setCustomStatus(n),_n({userID:o._userM.getMyUserID(),statusType:1,customStatus:n})})).catch((function(e){return t.setError(e).end(),Le.e("".concat(a," failed. error:"),e),In(e)})))}},{key:"getUserStatus",value:function(e){var t="".concat(this._n,".").concat("getUserStatus"),n=void 0===(e=e.userIDList)?[]:e,o=(e=this._userM.getMyUserID(),v(n)),a=void 0,i=o.indexOf(e);if(-1<i&&(o.splice(i,1),a={userID:e,statusType:1,customStatus:this._userM.get(12).getCustomStatus()}),0===o.length)return yn({successUserList:[a],failureUserList:[]});if(!this._userM.canIUse(P.USER_STATUS))return this._userM.noUse("getUserStatus");o.length>this.MAX_QUERY_USER_COUNT&&(Le.w("".concat(t," ").concat(Ht(this.MAX_QUERY_USER_COUNT))),o=n.slice(0,this.MAX_QUERY_USER_COUNT));var s=new Zn("getUserStatus");return this._userM.req({P:Gn.GET_USER_STATUS,data:{userIDList:o}}).then((function(e){var o=void 0===(o=(e=e.data).successUserList)?[]:o,i=(e=void 0===(e=e.failureUserList)?[]:e,o=o.map((function(e){return{userID:e.userID,statusType:e.statusType,customStatus:Ko(e=e.customStatus)}})),e=e.map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode;return e=e.errorInfo,{userID:He(n)?t:n,code:o,message:e}})),ut(a)||o.unshift(a),"userID count:".concat(n.length,", success count:").concat(o.length,", fail count:").concat(e.length));return s.setMessage("".concat(i)).end(),Le.l("".concat(t," ok. ").concat(i,".")),_n({successUserList:o,failureUserList:e})})).catch((function(e){return s.setMessage("userID count:".concat(n.length)).setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"subscribeUserStatus",value:function(e){var t,n,o,a,i="subscribeUserStatus";return this._userM.canIUse(P.USER_STATUS)?(t="".concat(this._n,".").concat(i),(n=v(e=void 0===(e=e.userIDList)?[]:e)).length>this.MAX_SUBSCRIBE_USER_COUNT&&(Le.w("".concat(t," ").concat(Ht(this.MAX_SUBSCRIBE_USER_COUNT))),n=e.slice(0,this.MAX_SUBSCRIBE_USER_COUNT)),o=new Zn(i),a="userID count:".concat(e.length),Le.l("".concat(t," ").concat(a)),this._userM.req({P:Gn.SUB_USER_STATUS,data:{userIDList:n}}).then((function(e){return e=(void 0===(e=e.data.failureUserList)?[]:e).map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode;return e=e.errorInfo,{userID:He(n)?t:n,code:o,message:e}})),o.setMessage("".concat(a," fail count:").concat(e.length)).end(),Le.l("".concat(t," ok. fail count:").concat(e.length,".")),_n({failureUserList:e})})).catch((function(e){return o.setMessage(a).setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._userM.noUse(i)}},{key:"unsubscribeUserStatus",value:function(e){var t,n,o,a,i="unsubscribeUserStatus";return this._userM.canIUse(P.USER_STATUS)?(t="".concat(this._n,".").concat(i),n=v(e=void 0===(e=(e||{}).userIDList)?[]:e),e.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(Le.w("".concat(t," ").concat(Ht(this.MAX_UNSUBSCRIBE_USER_COUNT))),n=e.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT)),o=new Zn(i),a="userID count:".concat(e.length),Le.l("".concat(t," ").concat(a)),e={userIDList:n},0===n.length&&(e.userIDList=void 0,e.unsubscribeAll=1),this._userM.req({P:Gn.UNSUB_USER_STATUS,data:e}).then((function(e){return e=(void 0===(e=e.data.failureUserList)?[]:e).map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode;return e=e.errorInfo,{userID:He(n)?t:n,code:o,message:e}})),o.setMessage("".concat(a," fail count:").concat(e.length)).end(),Le.l("".concat(t," ok. fail count:").concat(e.length,".")),_n({failureUserList:e})})).catch((function(e){return o.setMessage("".concat(a)).setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this._userM.noUse(i)}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),Pa),wa=(r(Ua,Nn),Yo=m(Ua),i(Ua,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"mockOnNickAvatarModified",value:function(e,t){Le.l("".concat(this._n,"._mockOnNickAvatarModified nick:").concat(e," avatar:").concat(t)),this.onProfileModified({dataList:[{pushType:1,userID:this.getMyUserID(),profileList:[{tag:Ae.NICK,value:e},{tag:Ae.AVATAR,value:t}]}]})}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var t,n;He(e=e.dataList)||(t=[],e.forEach((function(e){e.blackListDelAccount&&t.push.apply(t,v(e.blackListDelAccount))})),0<t.length&&this._blacklistHandler.onAccountDeleted(t),n=[],e.forEach((function(e){e.blackListAddAccount&&n.push.apply(n,v(e.blackListAddAccount))})),0<n.length&&this._blacklistHandler.onAccountAdded(n))}},{key:"onConvProfileUpdated",value:function(e){this._profileHandler.onConvProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyNick",value:function(){return this._profileHandler.getNickAndAvatarByUserID(this.getMyUserID()).nick}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.get(13)}},{key:"filterProfanity",value:function(e,t){var n,o=this.get(29);return!o||(n=(o=o.filterText(t[e],"user_profile")).isAllowedToSend,o=o.modifiedText,!0===n&&(t[e]=o,!0))}},{key:"isMyFriend",value:function(e){var t=this.get(8);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getUserNickAndAvatar",value:function(e){return this._profileHandler.getUserNickAndAvatar(e)}},{key:"getLocalBlacklist",value:function(){return yn(this._blacklistHandler.getLocalBlacklist())}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),Ua),Na=(i(Oa,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isTestEnv",value:function(){return this._isTestEnv}},{key:"isPartialUpdatedConvs",value:function(){return this._isPartialUpdatedConvs}},{key:"isSingaporeSite",value:function(){return 2e7<=this._SDKAppID&&this._SDKAppID<3e7||172e7<=this._SDKAppID&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return 3e7<=this._SDKAppID&&this._SDKAppID<4e7||173e7<=this._SDKAppID&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return 4e7<=this._SDKAppID&&this._SDKAppID<5e7||174e7<=this._SDKAppID&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return 5e7<=this._SDKAppID&&this._SDKAppID<6e7||175e7<=this._SDKAppID&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return 6e7<=this._SDKAppID&&this._SDKAppID<7e7||176e7<=this._SDKAppID&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return 7e7<=this._SDKAppID&&this._SDKAppID<8e7||177e7<=this._SDKAppID&&this._SDKAppID<178e7}},{key:"isIndonesiaSite",value:function(){return 8e7<=this._SDKAppID&&this._SDKAppID<9e7||178e7<=this._SDKAppID&&this._SDKAppID<179e7}},{key:"isIntl",value:function(){return 0===(e=this._SDKAppID)||2e7<=e&&e<9e7||172e7<=e&&e<179e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"isUsingChatCore",value:function(){return this._isUsingChatCore}},{key:"setUsingChatCore",value:function(e){this._isUsingChatCore=e}},{key:"getUIPlatform",value:function(){return this._uiPlatform}},{key:"setUIPlatform",value:function(e){this._uiPlatform=e}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return fe?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"setApplicationID",value:function(e){this._applicationID=e}},{key:"getApplicationID",value:function(){return this._applicationID}},{key:"setDowloadFileAuthKey",value:function(e){this._authKey=e}},{key:"getDowloadFileAuthKey",value:function(){return this._authKey}},{key:"setCustomLoginInfo",value:function(e){this._customLoginInfo=e}},{key:"getCustomLoginInfo",value:function(){return this._customLoginInfo}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,o=!1,a=[];Q&&(a=Object.keys(oe));for(var i=0,s=(a=ne?Z?Object.keys(uni):Object.keys(window):a).length;i<s;i++)if(a[i].toLowerCase().includes("uikit")){e=!0;break}a=null;var r,c=(Q&&!Je(oe.createGamePortal)&&Je(getApp)&&!ut(getApp())&&Ye(r=getApp().globalData)&&!0===r.isTUIKit&&(t=!0),!0===this._m.get(13).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))&&(n=!0),null);if(j&&!K&&"undefined"==typeof uni&&__wxConfig&&(c=__wxConfig.pages),z&&"undefined"==typeof uni&&__qqConfig&&(c=__qqConfig.pages),We(c)&&0<c.length){for(var l=0,u=c.length;l<u;l++)if(c[l].toLowerCase().includes("tui")){o=!0;break}c=null}return e||t||n||o}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),Oa),La={"k-vue2-pc":1,"k-vue2-h5":2,"k-vue2-h5-uni":3,"k-vue2-app-uni":4,"k-vue2-mp-uni":5,"k-vue2-pc-uni":6,"k-vue3-pc":7,"k-vue3-h5":8,"k-vue3-h5-uni":9,"k-vue3-app-uni":10,"k-vue3-mp-uni":11,"k-vue3-pc-uni":12,"k-rn":13},Ra=(r(Aa,Nn),$o=m(Aa),i(Aa,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"getPushModule",value:function(){var e=void 0,t=this.get(36),n=this.get(28);return t.canIUseTIMPush()?e=t:n.canIUseOfflinePush()&&(e=n),e}},{key:"login",value:function(e){if(this.isLoggedIn())return n=this.getMyUserID(),(n=this.getErrMsg("RepeatLogin",n))&&Le.w(n),yn({actionStatus:"OK",errorCode:0,errorInfo:n,repeatLogin:!0});if(Date.now()-this._lastLoginTs<=15e3)return this.warn("LoggingIn",e.userID),In({code:Un.REPEAT_LOGIN});Le.l("".concat(this._n,".login userID:").concat(e.userID));var t,n=this._checkLoginInfo(e);return 0!==n.code?In(n):(n=this.get(12),t=e.userID,e=e.userSig,n.setUserID(t),n.setUserSig(e),this.get(20).updateProtocolConfig(),this._login())}},{key:"_login",value:function(){var e=this,t=this.get(12),n=t.getScene(),o=0,a=n,i=(n&&n.startsWith("k-")&&(a=La[n],n="tuikit"),new Zn("login")),s=(i.setMessage("".concat(a)).setMoreMessage("identifier:".concat(this.getMyUserID())),"tuikit"===n),r=0,c=(Z?r=s?3===a||4===a||5===a||6===a?31:9===a||10===a||11===a||12===a?32:4:3:Q?r=q?36:"tuikit"===n?12:11:ne?r=fe?"flutter_web_uikit"===n?21:20:this._isReactUIKit()?me?25:24:s?1===a||2===a?29:7===a||8===a?30:me?17:14:me?16:13:13===a&&(r=38),i.setUIPlatform(r),t.setUIPlatform(r),(s=this.getPushModule())&&(this._isWebUniapp=s.getUniAppPlatform(),a=this._getStatusInstanceID(),t.setStatusInstanceID(a),this.get(20).updateProtocolConfig(),o=s.getDeviceBrand()),"".concat(this._n,"._login"));return this._lastLoginTs=Date.now(),this.req({P:Gn.LOGIN,data:{deviceBrand:o,isWebUniapp:this._isWebUniapp,customInfo:t.getCustomLoginInfo()}}).then((function(o){e._lastLoginTs=0;var a=Date.now(),s=null,r=(m=o.data).a2Key,l=m.tinyID,u=m.helloInterval,d=m.instanceID,p=m.timeStamp,h=void 0===(h=m.customStatus)?"":h,g=m.purchaseBits,m=void 0===(m=m.authKey)?"":m,f=1e3*p,v=a-i.getStartTs();if(v=f+parseInt(v/2)-a,a=i.getStartTs()+v,i.start(a),a=f,Se=v,(f=new Date).setTime(a),Le.i("baseTime from server:".concat(f," offset:").concat(Se)),l){if(r)return a=e.get(21).getSocketID(),f=Ko(h),h="socketID:".concat(a," scene:").concat(n," helloInterval:").concat(u," instanceID:").concat(d," timeStamp:").concat(p)+" offset:".concat(v," customStatus:").concat(f," isWebUniapp:").concat(e._isWebUniapp),Le.l("".concat(c," ok. ").concat(h)),p=a="",j&&Je(oe.getAccountInfoSync)&&(v=oe.getAccountInfoSync().miniProgram)&&(a=v.appId,p=v.envVersion),i.setMoreMessage("".concat(h," href:").concat(ne?window.location.href:""," mpAppId:").concat(a," envVersion:").concat(p," authKey:").concat(m)).end(),t.setA2Key(r),t.setTinyID(l),t.setStatusInstanceID(d),t.setCustomStatus(f),t.setDowloadFileAuthKey(m),g&&e.get(27).onPushedConfig({errorCode:0,expiredTime:0,purchaseBits:g}),e.get(20).updateProtocolConfig(),e.emitIEvt(Bo.A2KEY_AND_TINYID_UPDATED),e._helloInterval=u,e.triggerReady(),(v=e.getPushModule())&&(uni.setStorageSync("timUniAppInstanceID",d),v.init()),e._fetchCloudControlConfig(),e.get(29).init(),o;s=new On({code:Un.NO_A2KEY})}else s=new On({code:Un.NO_TINYID});throw i.setError(s).end(),s})).catch((function(t){return i.setError(t).end(!0),e._m.setNotReadyReason(Un.LOGIN_FAILED),Le.e("".concat(c," failed. error:"),t),e._lastLoginTs=0,e._m.onLoginFailed(),In(t)}))}},{key:"logout",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n="".concat(this._n,".logout"),o=this.isLoggedIn();return Le.i("".concat(n," type:").concat(t," isLoggedIn:").concat(o," isWebUniapp:").concat(this._isWebUniapp)),o?(new Zn("logout").setMessage("identifier:".concat(this.getMyUserID())).end(!0),0===t&&this._m.setNotReadyReason(Un.LOGGED_OUT),this.req({P:Gn.LOGOUT,data:{type:t,isWebUniapp:this._isWebUniapp}}).then((function(){return e.resetReady(),yn({})})).catch((function(t){return Le.e("".concat(n," error:"),t),e.resetReady(),yn({})}))):In({code:Un.USER_NOT_LOGGED_IN})}},{key:"getLoginUser",value:function(){return this.isLoggedIn()?this.getMyUserID():""}},{key:"_fetchCloudControlConfig",value:function(){this.get(23).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")||0}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.req({P:Gn.HELLO,data:{isWebUniapp:this._isWebUniapp}}).catch((function(t){Le.w("".concat(e._n,"._hello error:"),t)}))}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return He(this.get(12).getSDKAppID())?t=Un.NO_SDKAPPID:He(e.userID)?t=Un.NO_IDENTIFIER:He(e.userSig)&&(t=Un.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return ne&&void 0!==window.tencent_cloud_im_csig_react_uikit_23F_xa}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new Zn("kickedOut").setMessage("type:".concat(S.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Le.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOEvt(M.KICKED_OUT,{type:S.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(Un.KICKED_OUT_MULT_ACCOUNT),t._m.reset()}))}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new Zn("kickedOut").setMessage("type:".concat(S.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Le.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOEvt(M.KICKED_OUT,{type:S.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(Un.KICKED_OUT_MULT_DEVICE),t._m.reset()}))}},{key:"onUserSigExpired",value:function(){new Zn("kickedOut").setMessage(S.KICKED_OUT_USERSIG_EXPIRED).end(!0),Le.w("".concat(this._n,".onUserSigExpired userID:").concat(this.getMyUserID())),0!==this.get(12).getStatusInstanceID()&&(this.emitOEvt(M.KICKED_OUT,{type:S.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(Un.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new Zn("kickedOut").setMessage("type:".concat(S.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Le.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),0!==this.get(12).getStatusInstanceID()&&(this.emitOEvt(M.KICKED_OUT,{type:S.KICKED_OUT_REST_API}),this._m.setNotReadyReason(Un.KICKED_OUT_REST_API),this._m.reset(),this.get(21).onRestApiKickedOut())}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),Aa);function Aa(e){return o(this,Aa),(e=$o.call(this,e))._n="SignModule",e._helloInterval=120,e._lastLoginTs=0,e._lastWsHelloTs=0,e._isWebUniapp=0,jo.mixin(g(e)),e}function Oa(e,t){o(this,Oa),this._m=e,this._isLoggedIn=!1,this._SDKAppID=t.SDKAppID,this._userID=t.userID||"",this._userSig=t.userSig||"",this._version="3.4.7",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=t.unlimitedAVChatRoom,this._scene=t.scene||"",this._oversea=t.oversea,this._instanceID=t.instanceID,this._statusInstanceID=0,this._isDevMode=t.devMode,this._isTestEnv=t.testEnv,this._proxyServer=t.proxyServer,this._fileUploadProxy=t.fileUploadProxy,this._fileDownloadProxy=t.fileDownloadProxy,this._applicationID=0,this._isPartialUpdatedConvs=t.partialUpdatedConversations,this._isUsingChatCore=!1,this._uiPlatform=0,this._authKey="",this._customLoginInfo=""}function Ua(e){return o(this,Ua),(e=Yo.call(this,e))._n="UserModule",e._profileHandler=new Ma(g(e)),e._blacklistHandler=new Da(g(e)),e._userStatusHandler=new ba(g(e)),e.getIEmitInst().on(Bo.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,g(e)),e}function Pa(e){o(this,Pa),this._userM=e,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userM.getIEmitInst().on(Bo.CLOUD_CONFIG,this._onCloudConfig,this)}function Ga(e){o(this,Ga),this._userM=e,this._n="BlacklistHandler",this._blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.currentSequence=0}function xa(e){o(this,xa),this._userM=e,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}function Ba(e){return o(this,Ba),(e=Wo.call(this,e))._n="TopicModule",e._topicMap=new Map,e._getTopicTimeMap=new Map,e.TOPIC_CACHE_TIME=300,e.TOPIC_LAST_ACTIVE_TIME=3600,e.getIEmitInst().on(Bo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Va(e,t){o(this,Va),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=zo(e.lastMessage,t),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(e)}function Fa(e){return o(this,Fa),(e=Jo.call(this,e))._n="GroupModule",e._commonGroupHandler=new ua(g(e)),e._groupAttributesHandler=new da(g(e)),e._groupCountersHandler=new pa(g(e)),e._AVChatRoomHandler=new ma(g(e)),e._groupTipsHandler=new la(g(e)),e._groupSystemNoticeHandler=new ya(g(e)),e._groupMemberHandler=new va(g(e)),e.groupMap=new Map,e._unjoinedAVChatRoomList=new Map,e._receiptDetailCompleteMap=new Map,e._onlineMemberCountMap=new Map,e._timeoutIDs=[],e.getIEmitInst().on(Bo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Ha(e){o(this,Ha),this._grpM=e,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}function qa(e){o(this,qa),this._grpM=e,this._n="GroupMemberHandler",this.groupMemberListMap=new Map,this.DEFAULT_MEMBER_INFO_FILTER=["Role","JoinTime","NameCard","ShutUpUntil","OnlineStatus"],this._grpM.getIEmitInst().on(Bo.PROFILE_UPDATED,this._onProfileUpdated,this)}function za(e){o(this,za),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this.isOnline=!1,this.updateMember(e)}function Ka(e){o(this,Ka),this._grpM=e,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this._seqSll=new ta(200),this._IDSll=new ta(100),this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}function $a(e){o(this,$a);var t=e.manager,n=e.groupID,a=e.onInit,i=e.onSuccess;e=e.onFail,this._n="Polling",this._manager=t,this._grpM=t._grpM,this._onInit=a,this._onSuccess=i,this._onFail=e,this._groupID=n,this._timeoutID=-1,this._isRunning=!1,this._proto=Gn.AV_POLLING}function Ya(e){o(this,Ya),this._grpM=e,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(Bo.CLOUD_CONFIG,this._onCloudConfig,this)}function Wa(e){o(this,Wa),this._grpM=e,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(Bo.CLOUD_CONFIG,this._onCloudConfig,this)}function Ja(e){o(this,Ja),this._grpM=e,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this.PAGING_GRP_COUNT_LIMIT=200,this._pagingStatus=Mn,this._pagingGetCostList=[],e.getIEmitInst().on(Bo.A2KEY_AND_TINYID_UPDATED,this.syncGroupList,this)}function Xa(e){o(this,Xa),this._grpM=e,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4}function Za(e){return o(this,Za),(e=Xo.call(this,e))._n="ConvModule",jo.mixin(g(e)),e._msgListHandler=new Vo(g(e)),e._msgRemindHandler=new sa(g(e)),e._convGroupHandler=new ra(g(e)),e._sll=new ta(100),e._pagingStatus=Mn,e._pagingTs=0,e._pagingStartIdx=0,e._pagingPinnedTs=0,e._pagingPinnedStartIdx=0,e._pagingConvIDMap=new Map,e._convIDFromUnreadDBMap=new Map,e._convMap=new Map,e._tmpGroupList=[],e._tmpGroupAtTipsList=[],e._peerReadTimeMap=new Map,e._completedMap=new Map,e._roamingMsgKeyAndTimeMap=new Map,e._remoteGroupReadSeqMap=new Map,e._convTotalUnreadCount=0,e._pagingGetCostList=[],e._convMapForDiff=new Map,e._partialUpdatedConvMap=new Map,e._everClearedMap=new Map,e._bPullOnInvite=!0,e._initListeners(),e}function Qa(e){o(this,Qa),this._convM=e,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=Mn}function ei(e){o(this,ei),this._convM=e,this._n="MsgRemindHandler"}function ti(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];o(this,ti),this.conversationID=e.conversationID||"",this.unreadCount=e.unreadCount||0,this.type=e.type||"",this.lastMessage=qo(e.lastMessage,t,n),e.lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=e.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=e.isPinned||!1,this.messageRemindType=e.messageRemindType,this.markList=e.markList||[],this.customData=e.customData||"",this.conversationGroupList=e.conversationGroupList||[],this.draftText=e.draftText||"",this._initProfile(e),this.subType=this.groupProfile?this.groupProfile.type:""}function ni(e){o(this,ni),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(e)}function oi(e){o(this,oi),this.MAX_LENGTH=e,this.map=new Map}function ai(e){var t=this;o(this,ai),He(e)||(this.userID=e.userID||"",this.nick=e.nick||"",this.gender=e.gender||"",this.birthday=e.birthday||0,this.location=e.location||"",this.selfSignature=e.selfSignature||"",this.allowType=e.allowType||S.ALLOW_TYPE_ALLOW_ANY,this.language=e.language||0,this.avatar=e.avatar||"",this.messageSettings=e.messageSettings||0,this.adminForbidType=e.adminForbidType||S.FORBID_TYPE_NONE,this.level=e.level||0,this.role=e.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],He(e.profileCustomField))||e.profileCustomField.forEach((function(e){t.profileCustomField.push({key:e.key,value:e.value})}))}function ii(){return null}function si(e){var t=e.get(12);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:De()}}i(vi,[{key:"_errorTolerantHandle",value:function(){Q||"undefined"!=typeof window&&this._canIUseCookies()||(this.getItem=ii,this.setItem=ii,this.removeItem=ii,this.clear=ii)}},{key:"onCheckTimer",value:function(e){e%20==0&&0!==this._storageQueue.size&&this._doFlush()}},{key:"_doFlush",value:function(){try{var e,t=T(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=f(e.value,2),o=n[0],a=n[1];this._setStorageSync(this._getKey(o),a)}}catch(i){t.e(i)}finally{t.f()}this._storageQueue.clear()}catch(i){Le.w("".concat(this._n,"._doFlush error:"),i)}}},{key:"_getPrefix",value:function(){var e=this._m.get(12);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(o){return Le.w("".concat(this._n,".getItem error:"),o),{}}}},{key:"setItem",value:function(e,t){var n;2<arguments.length&&void 0!==arguments[2]&&arguments[2]?(n=3<arguments.length&&void 0!==arguments[3]&&!arguments[3]?e:this._getKey(e),this._setStorageSync(n,t)):this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{Q?oe.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){Le.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(o){Le.w("".concat(this._n,".removeItem error:"),o)}}},{key:"getSize",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"b";try{var o={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(o,"leftSize",{enumerable:!0,get:function(){return o.limitSize-o.size}}),Q&&(o.limitSize=1024*oe.getStorageInfoSync().limitSize),e)o.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(Q)oe.getStorageInfoSync().keys.forEach((function(e){o.size+=JSON.stringify(t.getStorageSync(e)).length+t._getKey(e).length}));else if(this._canIUseCookies())for(var a in localStorage)localStorage.hasOwnProperty(a)&&(o.size+=localStorage.getItem(a).length+a.length);return this._convertUnit(o)}catch(i){Le.w("".concat(this._n," error:"),i)}}},{key:"_convertUnit",value:function(e){var t,n={},o=e.unit;for(t in n.unit=o,e)"number"==typeof e[t]&&("kb"===o.toLowerCase()?n[t]=Math.round(e[t]/1024):"mb"===o.toLowerCase()?n[t]=Math.round(e[t]/1024/1024):n[t]=e[t]);return n}},{key:"_setStorageSync",value:function(e,t){Q?Y?my.setStorageSync({key:e,data:t}):oe.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return Q?Y?my.getStorageSync({key:e}).data:oe.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){Q?Y?my.removeStorageSync({key:e}):oe.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return"undefined"!=typeof window&&navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._doFlush()}}]);var ri,ci=vi,li=(i(fi,[{key:"pushIn",value:function(e){Le.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;We(e)&&0!==e.length&&(Le.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,v(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),fi),ui=(r(mi,Nn),ri=m(mi),i(mi,[{key:"reportAtOnce",value:function(){this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.get(13),n=t.getItem(this.TAG,!1);!He(n)&&Je(n.forEach)&&(Le.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach((function(t){e._reportBody.pushIn(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),o=this.getCloudConfig("evt_rpt_sdkappid_bl"),a=this.getCloudConfig("evt_rpt_tinyid_wl");ut(e)||(this.MIN_THRESHOLD=Number(e)),ut(t)||(this.WAITING_TIME=Number(t)),ut(n)||(this.REPORT_LEVEL=n.split(",").map((function(e){return Number(e)}))),ut(o)||(this.REPORT_SDKAPPID_BLACKLIST=o.split(",").map((function(e){return Number(e)}))),ut(a)||(this.REPORT_TINYID_WHITELIST=a.split(","))}},{key:"pushIn",value:function(e){e instanceof Zn&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD)&&this._report()}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,n=(o=this.get(12)).getSDKAppID(),o=o.getTinyID();return Ut(this.REPORT_SDKAPPID_BLACKLIST,n)&&!Pt(this.REPORT_TINYID_WHITELIST,o)?[]:e.filter((function(e){return t.REPORT_LEVEL.includes(e.level)}))}},{key:"_report",value:function(){var e,n,o=this;this._reportBody.isEmpty()||(e=this._reportBody.getLogsInMemory(),0!==(n=this._filterLogs(e)).length?(n={header:si(this),event:n},this.req({P:Gn.SSO_STAT,data:t({},n)}).then((function(){o._lastReportTime=Date.now()})).catch((function(t){Le.w("".concat(o._n,"._report failed. error:"),t),o._lastReportTime=Date.now(),o._reportBody.backfill(e),o._reportBody.getLogsNumInMemory()>o.MAX_THRESHOLD&&o._flushAtOnce()}))):this._lastReportTime=Date.now())}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),o="".concat(this._n,"._flushAtOnce");He(t)?(Le.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):((n=n.concat(t)).length>this.MAX_THRESHOLD&&(n=n.slice(0,this.MAX_THRESHOLD)),Le.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1))}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),mi),di="none",pi="online",hi=(i(gi,[{key:"_startRN",value:function(){var e,t=this;te&&(e=this._m.get(18).getPlugin("chat-network-monitor"))&&(this._removeListener=e.addEventListener((function(e){var n=e.isConnected;e=e.type,t._networkType!==e&&t._onNetworkStatusChange({isConnected:void 0!==n&&n,networkType:e})})))}},{key:"start",value:function(){var e=this,t="".concat(this._n,".start");Q?(oe.getNetworkType({success:function(n){e._networkType=n.networkType||n.subtype||"",n.networkType===di?Le.w("".concat(t," no network, please check!")):Le.i("".concat(t," networkType:").concat(n.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),oe.onNetworkStatusChange(this._mpNetworkStatusCallback)):ne&&(this._networkType=pi,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:pi})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:di})}},{key:"_onNetworkStatusChange",value:function(e){var t=e.isConnected,n=(e=e.networkType,"".concat(this._n,"._onNetworkStatusChange")),o=!1,a="previous:".concat(this._networkType," current:").concat(e);t?(Le.i("".concat(n," ").concat(a)),this._networkType!==e&&(o=!0,this._networkType=e,this._m.get(21).reConnect(!0))):this._networkType!==e&&(o=!0,this._networkType=e,Le.w("".concat(n," no network, please check!")),this._m.get(21).offline()),o&&new Zn("networkChange").setMessage("isConnected:".concat(t," ").concat(a)).end()}},{key:"isOnline",value:function(){return this._networkType!==di}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),Q?null!==this._mpNetworkStatusCallback&&(oe.offNetworkStatusChange&&oe.offNetworkStatusChange(this._mpNetworkStatusCallback),this._mpNetworkStatusCallback=null):ne?(null!==this._webOnlineCallback&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),null!==this._onWebOffline&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null)):te&&this._removeListener&&(this._removeListener(),this._removeListener=null)}}]),gi);function gi(e){o(this,gi),this._m=e,this._networkType=pi,this._n="NetMonitorModule",this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null,this._removeListener=null,this._m.getIEmitInst().on(Bo.A2KEY_AND_TINYID_UPDATED,this._startRN,this)}function mi(e){o(this,mi),(e=ri.call(this,e))._n="EventStatModule",e.TAG="im-ssolog-event",e._reportBody=new li,e.MIN_THRESHOLD=20,e.MAX_THRESHOLD=100,e.WAITING_TIME=6e4,e.REPORT_LEVEL=[4,5,6],e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._lastReportTime=Date.now();var t=e.getIEmitInst();return t.on(Bo.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,g(e)),t.on(Bo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function fi(e){o(this,fi),this._n="SSOLogBody",this._report=[]}function vi(e){o(this,vi),this._m=e,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}function _i(e,t){return e(t={exports:{}},t.exports),t.exports}var yi,Ii=_i((function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,o,i,s){if("function"!=typeof o)throw new TypeError("The listener must be a function");return o=new a(o,i||e,s),i=n?n+t:t,e._events[i]?e._events[i].fn?e._events[i]=[e._events[i],o]:e._events[i].push(o):(e._events[i]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function r(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),r.prototype.eventNames=function(){var e,o,a=[];if(0===this._eventsCount)return a;for(o in e=this._events)t.call(e,o)&&a.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},r.prototype.listeners=function(e){e=n?n+e:e;var t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var o=0,a=t.length,i=new Array(a);o<a;o++)i[o]=t[o].fn;return i},r.prototype.listenerCount=function(e){return e=n?n+e:e,(e=this._events[e])?e.fn?1:e.length:0},r.prototype.emit=function(e,t,o,a,i,s){var r=n?n+e:e;if(!this._events[r])return!1;var c,l=this._events[r],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,o),!0;case 4:return l.fn.call(l.context,t,o,a),!0;case 5:return l.fn.call(l.context,t,o,a,i),!0;case 6:return l.fn.call(l.context,t,o,a,i,s),!0}for(h=1,c=new Array(u-1);h<u;h++)c[h-1]=arguments[h];l.fn.apply(l.context,c)}else for(var d,p=l.length,h=0;h<p;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),u){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,o);break;case 4:l[h].fn.call(l[h].context,t,o,a);break;default:if(!c)for(d=1,c=new Array(u-1);d<u;d++)c[d-1]=arguments[d];l[h].fn.apply(l[h].context,c)}return!0},r.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},r.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},r.prototype.removeListener=function(e,t,o,a){if(e=n?n+e:e,this._events[e])if(t){var i=this._events[e];if(i.fn)i.fn!==t||a&&!i.once||o&&i.context!==o||s(this,e);else{for(var r=0,c=[],l=i.length;r<l;r++)(i[r].fn!==t||a&&!i[r].once||o&&i[r].context!==o)&&c.push(i[r]);c.length?this._events[e]=1===c.length?c[0]:c:s(this,e)}}else s(this,e);return this},r.prototype.removeAllListeners=function(e){return e?(e=n?n+e:e,this._events[e]&&s(this,e)):(this._events=new o,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=n,e.exports=r.EventEmitter=r})),Ei=["rich.my-imcloud.com","imrich.qcloud.com"],Ci=["requestSnapshotUrl"],ki=(r(wi,Nn),yi=m(wi),i(wi,[{key:"_init",value:function(){this._fileDownloadProxy=this.getFileDownloadProxy(),this._authKey=this.getDowloadFileAuthKey();var e=this.get(18);this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin?this._initUploaderMethod():(this.COSSDK=e.getPlugin(e=Q?"cos-wx-sdk":"cos-js-sdk"),this.COSSDK?(this._getAuthorizationKey(),this.warn("CosReplacement",e)):this.warn("PluginUndetected"))}},{key:"_onCloudConfig",value:function(){var e=this,t="".concat(this._n,"._onCloudConfig"),n=this.getCloudConfig("upload_size_limit"),o=this.getCloudConfig("simple_cos"),a=this.getCloudConfig("file_dn_list");if(Le.l("".concat(t," uploadSizeLimit:").concat(n," simpleCos:").concat(o)),!ut(n))try{var i=JSON.parse(n);this.UPLOAD_SIZE_LIMIT={A:i.a?1048576*parseInt(i.a):this.UPLOAD_SIZE_LIMIT.A,F:i.f?1048576*parseInt(i.f):this.UPLOAD_SIZE_LIMIT.F,I:i.i?1048576*parseInt(i.i):this.UPLOAD_SIZE_LIMIT.I,V:i.v?1048576*parseInt(i.v):this.UPLOAD_SIZE_LIMIT.V}}catch(s){}if(ut(o)||(this.isSimpleCos="1"===o),!ut(a))try{JSON.parse(a).forEach((function(t){e._fileDNList.includes(t)||e._fileDNList.push(t)}))}catch(s){}}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new Zn("_getAuthorizationKey"),o=Math.ceil(Date.now()/1e3);this.req({P:Gn.COS_SIGN,data:{duration:this.expiredTimeLimit}}).then((function(a){a=a.data;var i=(Le.l("".concat(t," ok. data:"),a),a.expiredTime-o);n.setMessage("requestId:".concat(a.requestId," requestTime:").concat(o," expiredTime:").concat(a.expiredTime," diff:").concat(i,"s")).end(),!Q&&a.region&&(e.region=a.region),e.appid=a.appid,e.bucketName=a.bucketName,e.ciUrl=a.ciUrl,e.directory=a.directory,e.downloadUrl=a.downloadUrl,e.uploadUrl=a.uploadUrl,e.cosOptions={secretId:a.secretId,secretKey:a.secretKey,sessionToken:a.sessionToken,expiredTime:a.expiredTime},Le.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()})).catch((function(e){n.setError(e).end(),Le.w("".concat(t," failed. error:"),e)}))}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),o=Math.ceil(Date.now()/1e3),a=new Zn("_getCosPreSigUrl"),i={uploadMethod:e.uploadMethod,platform:this.getPlatform(),SDKAppID:this.getSDKAppID(),userID:e.userID,conversationType:e.conversationType,uploadConfig:[{fileID:1,fileType:e.fileType,fileName:e.fileName}]},s=Gn.SIMPLE_COS_PRE_SIG;return this.isSimpleCos||(i={fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration},s=Gn.COS_PRE_SIG),this.req({P:s,data:i}).then((function(e){t.tryCount=0,e=e.data||{};var i,s,r=(Le.l("".concat(n," ok. isSimpleCos:").concat(t.isSimpleCos," data:"),e),"");return r=t.isSimpleCos?(i=(s=e.preSig[0]).uploadUrl,s=s.fileKey,"uploadIP:".concat(e.uploadIP," uploadUrl:").concat(i," fileKey:").concat(s," cost:").concat(zt(o))):"requestId:".concat(e.requestId," expiredTime:").concat(e.expiredTime," diff:").concat(e.expiredTime-o,"s"),a.setMessage(r).end(),e})).catch((function(o){return-1===o.code&&(o.code=Un.COS_GET_SIG_FAIL),a.setError(o).end(),Le.w("".concat(n," failed. error:"),o),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,In({code:Un.COS_GET_SIG_FAIL}))}))}},{key:"_initUploaderMethod",value:function(){var e=this;this.TIMUploadPlugin?(this.timUploadPlugin=new this.TIMUploadPlugin,this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)}):this.appid&&(this.cos=Q?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=Q?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){!this.COSSDK||this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey()}},{key:"getFileDNList",value:function(){return this._fileDNList}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(!0===e._relayFlag)return Promise.resolve();var t=this.get(26);switch(e.type){case S.MSG_IMAGE:return t.addTotalCount(qn),this._uploadImage(e);case S.MSG_FILE:return t.addTotalCount(qn),this._uploadFile(e);case S.MSG_AUDIO:return t.addTotalCount(qn),this._uploadAudio(e);case S.MSG_VIDEO:return t.addTotalCount(qn),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var n=this,o=this.get(2),a=e.getElements()[0],i=o.getMessageOption(e.clientSequence);return this.doUploadImage({file:i.payload.file,to:i.to,message:e,onProgress:function(e){if(a.updatePercent(e),Je(i.onProgress))try{i.onProgress(e)}catch(t){return In({code:Un.MSG_ONPROGRESS_ERR})}}}).then((function(o){var i=o.location,s=o.fileType,r=o.fileSize,c=o.width,l=o.height,u=o.smallImageUrl,d=o.smallImageWidth,p=o.smallImageHeight,h=o.largeImageUrl,g=o.largeImageWidth,m=o.largeImageHeight,f=o.imageInfoArray;o=n.isPrivateNetWork()?i:st(i),a.updateImageFormat(s);var v,_,y={size:r,url:o,width:c,height:l};if(f&&0<f.length)for(var I=0;I<f.length;I++){var E=f[I];1===E.type?v=E:2===E.type?_=E:y=t(t({},y),E)}else _=u&&h?(v={url:u,width:d,height:p},{url:h,width:g,height:m}):(v=Lt({originUrl:o,originWidth:c,originHeight:l,min:198}),Lt({originUrl:o,originWidth:c,originHeight:l,min:720}));return a.updateImageInfoArray([t({},y),t({},_),t({},v)]),e}))}},{key:"_uploadFile",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],a=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:a.payload.file,to:a.to,message:e,onProgress:function(e){if(o.updatePercent(e),Je(a.onProgress))try{a.onProgress(e)}catch(t){return In({code:Un.MSG_ONPROGRESS_ERR})}}}).then((function(n){var a=n=n.location;return t.isPrivateNetWork()||(a=ao(a=st(n),t._fileDownloadProxy,t._authKey,t._fileDNList)),o.updateFileUrl(a),e}))}},{key:"_uploadAudio",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],a=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:a.payload.file,to:a.to,message:e,onProgress:function(e){if(o.updatePercent(e),Je(a.onProgress))try{a.onProgress(e)}catch(t){return In({code:Un.MSG_ONPROGRESS_ERR})}}}).then((function(n){return n=n.location,n=t.isPrivateNetWork()?n:st(n),o.updateAudioUrl(n),e}))}},{key:"_uploadVideo",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],a=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:a.payload.file,to:a.to,message:e,onProgress:function(e){if(o.updatePercent(e),Je(a.onProgress))try{a.onProgress(e)}catch(t){return In({code:Un.MSG_ONPROGRESS_ERR})}}}).then((function(n){var a=n.location;return n=n.snapshotInfo,a=t.isPrivateNetWork()?a:st(a),o.updateVideoUrl(a),He(n)||o.updateSnapshotInfo(n),e}))}},{key:"_checkSizeError",value:function(e){var t="";return"A"===e?t="audio":"I"===e?t="image":"V"===e?t="video":"F"===e&&(t="file"),In({code:Un["MSG_".concat(e,"_SIZE_LIMIT")],message:this.getErrMsg("UploadSizeLimit",t,"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576,"MB"))})}},{key:"doUploadImage",value:function(e){var t,n,o=this;return!e.file||this._isEmptyFileList(e.file.files)?In({code:Un.MSG_I_SELECT_F_FIRST}):!0!==(t=this._checkImageType(e.file))||!0!==(t=this._checkImageSize(e.file))?t:(n=null,this._setUploadFileType(1),this.uploadByCOS(e).then((function(t){if(n=t,o.isPrivateNetWork())return Dt(i);if(We(n.imageInfoArray)){var a=n.imageInfoArray.find((function(e){return 3===e.type}));if(a)return a}var i;return te?{width:e.file.width,height:e.file.height}:(i=st(t.location),o.COSSDK?Dt(i):Dt(i=ao(i,o._fileDownloadProxy,o._authKey,o._fileDNList)))})).then((function(e){return n.width=e.width,n.height=e.height,Promise.resolve(n)})))}},{key:"_checkImageType",value:function(e){var t="";return t=Q?e.url.slice(e.url.lastIndexOf(".")+1):te?e.type.split("/")[1]:e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),0<=Zo.indexOf(t.toLowerCase())||In({code:Un.MSG_I_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){return 0===(e=(Q||te?e:e.files[0]).size)?In({code:Un.MSG_F_IS_EMPTY}):e<this.UPLOAD_SIZE_LIMIT.I||this._checkSizeError("I")}},{key:"doUploadFile",value:function(e){return!e.file||this._isEmptyFileList(e.file.files)?In({code:Un.MSG_F_SELECT_F_FIRST}):e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.F?this._checkSizeError("F"):0===e.file.files[0].size?In({code:Un.MSG_F_IS_EMPTY}):(this._setUploadFileType(255),this.uploadByCOS(e))}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.V?this._checkSizeError("V"):0===e.file.videoFile.size?In({code:Un.MSG_F_IS_EMPTY}):-1===Qo.indexOf(e.file.videoFile.type)?In({code:Un.MSG_V_TYPES_LIMIT}):(this._setUploadFileType(2),Q||te?this.handleVideoUpload(t(t({},e),{},{file:e.file.videoFile})):ne?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise((function(n,o){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){o(new On({code:Un.MSG_V_UPLOAD_FAIL}))}))}))}))}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.A?this._checkSizeError("A"):0===e.file.size?In({code:Un.MSG_F_IS_EMPTY}):(this._setUploadFileType(3),this.uploadByCOS(e)):In({code:Un.MSG_A_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t,n,o,a,i=this;return Je(this._cosUploadMethod)?this.timUploadPlugin?this._uploadWithPreSigUrl(e):(t=new Zn("upload"),n="".concat(this._n,".uploadByCOS"),o=Date.now(),a=this._getFile(e),new Promise((function(s,r){var c=Q?i._createCosOptionsWXMiniApp(e):i._createCosOptionsWeb(e),l=i;i._cosUploadMethod(c,(function(e,c){var u,d,p=Object.create(null);c?e||We(c.files)&&c.files[0].error?(u=new On({code:Un.MSG_F_UPLOAD_FAIL}),t.setError(u).end(),Le.l("".concat(n," failed. error:"),c.files[0].error),403===c.files[0].error.statusCode&&i._getAuthorizationKey(),r(u)):(p.fileName=a.name,p.fileSize=a.size,p.fileType=a.type.slice(a.type.indexOf("/")+1).toLowerCase(),p.location=(Q?c:c.files[0].data).Location,u=Date.now()-o,c=l._formatFileSize(a.size),d=l._formatSpeed(1e3*a.size/u),c="size:".concat(c," time:").concat(u,"ms speed:").concat(d),Le.l("".concat(n," success. name:").concat(a.name," ").concat(c)),s(p),(d=i.get(26)).addCost(qn,u),d.addFileSize(qn,a.size),t.setMessage(c).end()):(p=new On({code:Un.MSG_F_UPLOAD_FAIL}),t.setError(p).end(),Le.w("".concat(n," failed. error:"),e),403===e.statusCode&&i._getAuthorizationKey(),r(p))}))}))):(this.warn("PluginUndetected"),In({code:Un.COS_UNDETECTED}))}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),o=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then((function(e){return new Promise((function(a,i){var s=new Zn("upload"),r=e.requestSnapshotUrl,c=void 0===r?void 0:r,l=h(e,Ci),u=Date.now();t._cosUploadMethod(l,(function(r,d){if(r||403===d.statusCode)s.setError(new On(r)).end(),h={HttpStatusCode:9999,CostTime:zt(u,!1),error:r,url:e.url},d.data&&d.data.uploadIP&&(h.uploadIP=d.data.uploadIP),t._uploadSSOLog(h),Le.l("".concat(n," failed, error:"),r),i(new On({code:Un.MSG_F_UPLOAD_FAIL}));else{var p=Object.create(null),h=d.data.location||"",g=(t.isPrivateNetWork()||0!==h.indexOf("https://")&&0!==h.indexOf("http://")||(h=h.split("//")[1]),p.fileName=o.name,p.fileSize=o.size,p.fileType=o.type.slice(o.type.indexOf("/")+1).toLowerCase(),p.location=h,r=zt(u,!1),h=t._formatFileSize(o.size),t._formatSpeed(1e3*o.size/r));if(h="size:".concat(h," time:").concat(r,"ms speed:").concat(g," res:").concat(JSON.stringify(d.data)),Le.l("".concat(n," ok. name:").concat(o.name," ").concat(h)),s.setMessage(h).end(),g={HttpStatusCode:d.statusCode,FileSize:o.size,CostTime:r,url:e.url},(d.data&&d.data.uploadIP&&(g.uploadIP=d.data.uploadIP),t._uploadSSOLog(g),h=t.get(26)).addCost(qn,r),h.addFileSize(qn,o.size),g=[],l.thumbUrl&&l.largeUrl&&g.push.apply(g,[t._getSmallImageInfoByUrl(l.thumbUrl,p),t._getLargeImageInfoByUrl(l.largeUrl,p)]),1===t.uploadFileType&&t.isSimpleCos&&!t.isPrivateNetWork()&&(g.push(t._getImageInfoArray(l.downloadUrl,p)),d.data.uploadIP)&&g.push(t._getDownloadIP(l.downloadUrl.split("//")[1].split("/")[0],p)),c&&g.push(t._getSnapshotInfoByUrl(c,p)),0<g.length)return Promise.all(g).then((function(){a(p)}));a(p)}}))}))}))}},{key:"_getDownloadIP",value:function(e,t){var n="".concat(this._n,"._getDownloadIP"),o=Date.now();return this.req({P:Gn.GET_IP,data:{domainName:e}}).then((function(e){var a;e.data&&e.data.ip&&(Le.l("".concat(n," ok. downloadIP:").concat(e.data.ip," cost:").concat(zt(o))),(a=t.location.split("/"))[0]=e.data.ip,t.location=a.join("/"))})).catch((function(e){}))}},{key:"_getImageInfoArray",value:function(e,t){var n=this,o="".concat(this._n,"._getImageInfoArray"),a=Date.now();return this.req({P:Gn.GET_IMAGE_INFO,data:{imageUrl:e}}).then((function(e){return e=e.data||{},Le.l("".concat(o," ok. data: ").concat(JSON.stringify(e)," cost:").concat(zt(a))),t.imageInfoArray=e.imageInfoArray,e})).catch((function(o){t.imageInfoArray=void 0,n._uploadSSOLog({HttpStatusCode:1e4,CostTime:zt(a,!1),url:e})}))}},{key:"_uploadSSOLog",value:function(e){var t,n;this.isSimpleCos&&((t=new Zn).setEventType(18),e.error&&t.setError(new On(e.error)),n="HttpStatusCode:".concat(e.HttpStatusCode,"|CosRequestId:").concat(e.CosRequestId||"","|")+"FileAlreadyExist:".concat(e.FileAlreadyExist||0,"|FileSize:").concat(e.FileSize||0,"|CostTime:").concat(e.CostTime),e.uploadIP&&(n+="|FinalIP:".concat(e.uploadIP)),t.setMessage("OK").setMoreMessage(e.url).setExtension(n).end())}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.get(12).getFileUploadProxy(),n=e;return t?e.replace(/^https:\/\/[^/]+/,t):n}},{key:"_getFile",value:function(e){return We(e.file.files)||Xe(e.file.files)?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?Ot(e/1024,1)+"KB/s":Ot(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=(n=t.name).slice(n.lastIndexOf("."));return n=this._genFileName("".concat(ot(999999)).concat(n)),{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),Body:t}],SliceSize:1048576,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Le.w("onProgress callback error:",n)}},onFileFinish:function(e,t,n){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var t=this._getFile(e),n=this._genFileName(t.name);return t=t.url,{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),FilePath:t,onProgress:function(t){if(Le.l(JSON.stringify(t)),"function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Le.w("onProgress callback error:",n)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t,n=this,o="",a="",i=0,s=this._getFile(e);return i=Q||te?(o=e.message.type===S.MSG_FILE?(t=(t=s.name).slice(t.lastIndexOf(".")),this._genFileName("".concat(ot(999999)).concat(t))):this._genFileName(s.name),a=s.url,1):(t=(t=s.name).slice(t.lastIndexOf(".")),o=this._genFileName("".concat(ot(999999)).concat(t)),a=s,0),this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:o,uploadMethod:i,duration:this.duration,userID:e.message.from,conversationType:kt(e.message.conversationID)?1:2}).then((function(t){var i=(u=n.isSimpleCos?t.preSig[0]:t).uploadUrl,s=u.downloadUrl,r=void 0===(r=u.requestSnapshotUrl)?void 0:r,c=u.thumbUrl,l=u.largeUrl,u=u.fileKey;return t=void 0===(t=t.uploadIP)?"":t,{url:n._getRawOrUploadProxyUrl(i),fileType:n.uploadFileType,fileName:o,resources:a,downloadUrl:s,requestSnapshotUrl:r,thumbUrl:c,largeUrl:l,fileKey:u,uploadIP:!n.isPrivateNetWork()&&t,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Le.w("onProgress callback error:",n),Le.e(n)}}}}))}},{key:"_genFileName",value:function(e){return"".concat(bt(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,o="_getSnapshotInfoByUrl",a=new Zn(o);return this.req({P:Gn.VIDEO_COVER,data:{platform:this.getPlatform(),coverName:this._genFileName(ot(99999)),requestSnapshotUrl:e}}).then((function(e){var i;return e=(e.data||{}).snapshotUrl,Le.l("".concat(n._n,".").concat(o," ok. snapshotUrl:").concat(e)),a.setMessage("snapshotUrl:".concat(e)).end(),He(e)?{}:Dt(i=ao(e,n._fileDownloadProxy,n._authKey,n._fileDNList)).then((function(e){t.snapshotInfo={snapshotUrl:i,snapshotWidth:e.width,snapshotHeight:e.height}}))})).catch((function(e){return Le.w("".concat(n._n,".").concat(o," failed. error:"),e),a.setCode(e.errorCode).setMessage(e.errorInfo).end(),{}}))}},{key:"_getSmallImageInfoByUrl",value:function(e,t){return Dt(ao(e,this._fileDownloadProxy,this._authKey,this._fileDNList)).then((function(n){t.smallImageUrl=e,t.smallImageWidth=n.width,t.smallImageHeight=n.height}))}},{key:"_getLargeImageInfoByUrl",value:function(e,t){return Dt(ao(e,this._fileDownloadProxy,this._authKey,this._fileDNList)).then((function(n){t.largeImageUrl=e,t.largeImageWidth=n.width,t.largeImageHeight=n.height}))}},{key:"_isEmptyFileList",value:function(e){return!(!Xe(e)||0!==e.length)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),wi),Ti=["downloadKey","pbDownloadKey","messageList"],Mi=(i(bi,[{key:"uploadMergerMessage",value:function(e,t){var n="".concat(this._n,".").concat("uploadMergerMessage"),o=(Le.d("".concat(n," message:"),e,"messageBytes:".concat(t)),e=JSON.parse(JSON.stringify(e.payload)).messageList).length,a=this._msgM.get(17).getFileDNList(),i=new Zn("uploadMergerMessage");return e.forEach((function(e){io(e.messageBody[0].type,e.messageBody,a)})),this._msgM.req({P:Gn.UPLOAD_MERGER_MSG,data:{messageList:e}}).then((function(e){Le.d("".concat(n," ok. response:"),e.data);var a={pbDownloadKey:a=(e=e.data).pbDownloadKey,downloadKey:e=e.downloadKey,messageNumber:o};return i.setMessage("".concat(o,"-").concat(t,"-").concat(e)).end(),a})).catch((function(e){throw Le.w("".concat(n," failed. error:"),e),i.setError(e).end(),e}))}},{key:"downloadMergerMessage",value:function(e){var n=this,o="".concat(this._n,".").concat("downloadMergerMessage"),a=(Le.d("".concat(o," message:"),e),e.payload.downloadKey),i=this._msgM.getFileDownloadProxy(),s=this._msgM.getDowloadFileAuthKey(),r=new Zn("downloadMergerMessage");return r.setMessage("downloadKey:".concat(a)),this._msgM.req({P:Gn.DOWNLOAD_MERGER_MSG,data:{downloadKey:a}}).then((function(a){Le.d("".concat(o," ok. response:"),a.data);var c,l,u=n._msgM.get(17).getFileDNList();return Je(e.clearElement)?((c=e.payload).downloadKey,c.pbDownloadKey,c.messageList,c=h(c,Ti),e.clearElement(),e.setElement({type:e.type,content:t({messageList:a.data.messageList},c)},i,s,u)):(l=[],a.data.messageList.forEach((function(e){He(e)||(e=new Io(e,i,s,u),l.push(e))})),e.payload.messageList=l,e.payload.downloadKey="",e.payload.pbDownloadKey=""),r.end(),e})).catch((function(e){throw Le.w("".concat(o," failed. key:").concat(a," error:"),e),r.setError(e).end(),e}))}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===S.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,n){var o=null,a=(t&&(t.offlinePushInfo&&(o=t.offlinePushInfo),!0===t.onlineUserOnly)&&(o?o.disablePush=!0:o={disablePush:!0}),[]),i=(Ye(t)&&Ye(t.messageControlInfo)&&(i=(r=t.messageControlInfo).excludedFromUnreadCount,s=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===i&&a.push("NoUnread"),!0===s&&a.push("NoLastMsg"),!0===r)&&a.push("NoMsgCheck"),""),s=(lt(e.cloudCustomData)&&0<e.cloudCustomData.length&&(i=e.cloudCustomData),n.pbDownloadKey),r=n.downloadKey,c=(n=n.messageNumber,(u=e.payload).title),l=u.abstractList,u=u.compatibleText,d=(d=this._msgM.get(6))&&d.isOnlineMessage(e,t)?0:void 0;return{P:Gn.SEND_C2C_MSG,data:{fromAccount:this._msgM.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:s,downloadKey:r,title:c,abstractList:l,compatibleText:u,messageNumber:n}}],cloudCustomData:i,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:d,offlinePushInfo:Po(o),messageControlInfo:0!==d?a:void 0,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,t,n){var o=null,a=(t&&t.offlinePushInfo&&(o=t.offlinePushInfo),[]),i=(Ye(t)&&Ye(t.messageControlInfo)&&(i=(r=t.messageControlInfo).excludedFromUnreadCount,s=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===i&&a.push("NoUnread"),!0===s&&a.push("NoLastMsg"),!0===r)&&a.push("NoMsgCheck"),""),s=(lt(e.cloudCustomData)&&0<e.cloudCustomData.length&&(i=e.cloudCustomData),n.pbDownloadKey),r=n.downloadKey,c=(n=n.messageNumber,(u=e.payload).title),l=u.abstractList,u=u.compatibleText,d=this._msgM.get(7);return t=d&&d.isOnlineMessage(e,t)?1:0,{P:Gn.SEND_GRP_MSG,data:{fromAccount:this._msgM.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:s,downloadKey:r,title:c,abstractList:l,compatibleText:u,messageNumber:n}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:i,onlineOnlyFlag:t,offlinePushInfo:Po(o),clientTime:e.clientTime,needReadReceipt:!0!==e.needReadReceipt||d.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:0==t?a:void 0,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0}}}}]),bi),Si={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MSG_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},Di=[Un.MSG_ONPROGRESS_ERR,Un.MSG_I_SELECT_F_FIRST,Un.MSG_I_TYPES_LIMIT,Un.MSG_F_IS_EMPTY,Un.MSG_I_SIZE_LIMIT,Un.MSG_F_SELECT_F_FIRST,Un.MSG_F_SIZE_LIMIT,Un.MSG_V_SIZE_LIMIT,Un.MSG_V_TYPES_LIMIT,Un.MSG_A_UPLOAD_FAIL,Un.MSG_A_SIZE_LIMIT,Un.COS_UNDETECTED];function bi(e){o(this,bi),this._n="MergerMessageHandler",this._msgM=e}function wi(e){o(this,wi),(e=yi.call(this,e))._n="UploadModule",e.TIMUploadPlugin=null,e.timUploadPlugin=null,e.COSSDK=null,e._cosUploadMethod=null,e.expiredTimeLimit=600,e.appid=0,e.bucketName="",e.ciUrl="",e.directory="",e.downloadUrl="",e.uploadUrl="",e.region="ap-shanghai",e.cos=null,e.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},e.uploadFileType="",e.duration=900,e.tryCount=0,e.UPLOAD_SIZE_LIMIT={A:20971520,F:104857600,I:20971520,V:104857600},e.isSimpleCos=!1,e._fileDownloadProxy="",e._authKey="",e._fileDNList=Ei;var t=e.getIEmitInst();return t.on(Bo.A2KEY_AND_TINYID_UPDATED,e._init,g(e)),t.on(Bo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Ni(e){var t=!1;return Object.values(Si).includes(e)&&(t=!0),120001<=e&&e<=13e4||10100<=e&&e<=10200||t}var Li,Ri,Ai,Oi,Ui,Pi,Gi=["conversationID","timePosition","timePeriod"],xi=(r(Ji,Nn),Pi=m(Ji),i(Ji,[{key:"createTextMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new ko(e));return e=lt(e.payload)?e.payload:e.payload.text,e=new Qn({text:e}),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new ko(e));if(Q){if(ze(a=e.payload.file))return void this.warn("FileUnsupportedInMP","createImageMessage");var o=a.tempFiles[0].path||a.tempFiles[0].tempFilePath,a={url:o,name:o.slice(o.lastIndexOf("/")+1),size:a.tempFiles&&a.tempFiles[0].size||1,type:o.slice(o.lastIndexOf(".")+1).toLowerCase()};e.payload.file=a}else te?(a={url:(o=e.payload.file).uri,name:o.fileName,size:o.fileSize||1,type:o.type,width:o.width,height:o.height},e.payload.file=a):ne&&(ze(e.payload.file)?(o=e.payload.file,e.payload.file={files:[o]}):Ye(e.payload.file)&&"undefined"!=typeof uni&&(a=e.payload.file.tempFiles[0],e.payload.file={files:[a]}));return o=new co({imageFormat:Re.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),a=this._getNickAndAvatarByUserID(t),n.setElement(o),n.setNickAndAvatar(a),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var t=e.payload.file,n=(Q&&(n={url:t.tempFilePath,name:t.tempFilePath.slice(t.tempFilePath.lastIndexOf("/")+1),size:t.fileSize,second:parseInt(t.duration)/1e3,type:t.tempFilePath.slice(t.tempFilePath.lastIndexOf(".")+1).toLowerCase()},e.payload.file=n),te&&(n={url:t.uri,name:t.uri.slice(t.uri.lastIndexOf("/")+1),size:t.fileSize||1,second:Math.floor(t.duration/1e3),type:t.uri.slice(t.uri.lastIndexOf(".")+1).toLowerCase()},e.payload.file=n),this.getMyUserID()),o=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new ko(e));return t=new uo({second:Math.floor(t.duration/1e3),size:t.fileSize||t.size||1,url:t.tempFilePath,uuid:this._generateUUID(e.payload.file)}),n=this._getNickAndAvatarByUserID(n),o.setElement(t),o.setNickAndAvatar(n),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0,{});if(Q){if(Y)return void this.warn("VideoUnsupportedInAlipay");if(ze(e.payload.file))return void this.warn("FileUnsupportedInMP","createVideoMessage");var o=e.payload.file;We(o.tempFiles)&&(o=o.tempFiles[0]),n.url=o.tempFilePath,n.name=o.tempFilePath.slice(o.tempFilePath.lastIndexOf("/")+1),n.size=o.size||1,n.second=o.duration||0,n.type=o.tempFilePath.slice(o.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else te?(o=e.payload.file,n.url=o.uri,n.name=o.fileName,n.size=o.fileSize||1,n.second=o.duration||0,n.type=o.type.split("/")[1]):ne&&(ze(e.payload.file)?(o=e.payload.file,e.payload.file.files=[o]):Ye(e.payload.file)&&"undefined"!=typeof uni&&(o=e.payload.file.tempFile,e.payload.file.files=[o]),o=e.payload.file,n.url=window.URL.createObjectURL(o.files[0]),n.name=o.files[0].name,n.size=o.files[0].size||1,n.second=o.files[0].duration||0,n.type=o.files[0].type.split("/")[1]);return e.payload.file.videoFile=n,o=new ko(e),n=new _o({videoFormat:n.type,videoSecond:Ot(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),t=this._getNickAndAvatarByUserID(t),o.setElement(n),o.setNickAndAvatar(t),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createCustomMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new ko(e));return e=new vo({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createFaceMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new ko(e));return e=new lo(e.payload),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createMergerMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),t=this._getNickAndAvatarByUserID(t),new ko(e));return e=new Eo(e.payload),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n.setRelayFlag(!0),n}},{key:"createForwardMessage",value:function(e){var t,n,o=e.to,a=e.conversationType,i=e.priority,s=e.payload,r=e.needReadReceipt,c=e.receiverList;return We(s._elements)?(t=this.getMyUserID(),n=this._getNickAndAvatarByUserID(t),s.type===S.MSG_GRP_TIP?In({code:Un.MSG_FORWARD_TYPE_INVALID}):(a={to:o,conversationType:a,conversationID:"".concat(a).concat(o),priority:i,isPlaceMessage:0,status:Cn,currentUser:t,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||s.cloudCustomData||"",needReadReceipt:r,receiverList:c,isSupportExtension:e.isSupportExtension||!1},(o=new ko(a)).setElement(s._elements[0]),o.setNickAndAvatar(n),o.setNameCard(this._getNameCardByGroupID(s)),o.setRelayFlag(!0),o)):In({code:Un.MSG_FORWARD_INVALID_ELEMENTS})}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(Q){if(!j&&!z&&!J)return;var n=oe.getSystemInfoSync().SDKVersion;if(j&&Nt(n,"2.5.0")<0)return void this.warn("WXChooseMessageFile");if(z&&Nt(n,"1.18.0")<0)return void this.warn("QQChooseMessageFile")}ne||J?ze(e.payload.file)?(n=e.payload.file,e.payload.file={files:[n]}):Ye(e.payload.file)&&"undefined"!=typeof uni&&(a=(n=e.payload.file).tempFiles,n=n.files,o=null,We(a)?o=a[0]:We(n)&&(o=n[0]),e.payload.file={files:[o]}):j||z?(n=t(t({},(a=e.payload.file.tempFiles)[0]),{},{url:a[0].path}),e.payload.file={files:[n]}):te&&(a=t(t({},o=e.payload.file),{},{url:o.uri}),e.payload.file={files:[a]}),n=this.getMyUserID();var o=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new ko(e)),a=new fo({uuid:this._generateUUID(e.payload.file),file:e.payload.file});return n=this._getNickAndAvatarByUserID(n),o.setElement(a),o.setNickAndAvatar(n),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createLocationMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new ko(e));return e=new yo(e.payload),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"_onNoModule",value:function(){return In({code:Un.NO_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(!1===this.get(29).filterMessage(e,t))return e.hasRiskContent=!0,this._onSendMessageFailed(e,new On({code:Un.PROFANITY_FOUND}));var o,a,i,s,r=null;if(e.conversationType===S.CONV_C2C)r=this.get(6);else{if(e.conversationType!==S.CONV_GROUP)return In({code:Un.MSG_INVALID_CONV_TYPE});r=this.get(7)}return r?(a="".concat(this._n,".sendMessageInstance"),i=this.get(11),s=r.isOnlineMessage(e,t),this.get(17).upload(e).then((function(){return n._getSendMessageSpecifiedKey(e)===jn&&n.get(26).addSuccessCount(qn),n._guardForGroup(e).then((function(){if(!e.isSendable())return In({code:Un.MSG_F_URL_IS_EMPTY});n._addSendMessageTotalCount(e),o=Date.now();var a=function(e){var t="utf-8";ne&&document&&(t=document.charset.toLowerCase());var n,o=0,a=e.length;if("utf-8"===t||"utf8"===t)for(var i=0;i<a;i++)(n=e.codePointAt(i))<=127?o+=1:n<=2047?o+=2:n<=65535?o+=3:(o+=4,i++);else if("utf-16"===t||"utf16"===t)for(var s=0;s<a;s++)(n=e.codePointAt(s))<=65535?o+=2:(o+=4,s++);else o=e.replace(/[^\x00-\xff]/g,"aa").length;return o}(JSON.stringify(e));return e.type===S.MSG_MERGER&&11264<a?n._mergerMessageHandler.uploadMergerMessage(e,a).then((function(o){return o=n._mergerMessageHandler.createMergerMessagePack(e,t,o),n.req(o)})):(i.setMessageRandom(e),r.sendMessage(e,t))})).then((function(r){var c=(r=r.data).time,l=r.sequence,u=r.readReceiptCode;return r=r.messageDropReason,Ke(u)&&0!==u&&(new Zn("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(l," readReceiptCode:").concat(u)).end(),Le.w("".concat(a," readReceiptCode:").concat(u," message:").concat(n.getErrMsg(u)))),r&&(u=new Zn("messageDropReason"),r="from:".concat(e.from," to:").concat(e.to," sequence:").concat(l," messageDropReason:").concat(r),u.setMessage(r).end(),Le.w("".concat(a," ").concat(r))),n._addSendMessageSuccessCount(e,o),n._messageOptionsMap.delete(e.clientSequence),!0===e.isResend&&(u=i.findMessage(e.ID))&&(Le.l("".concat(a," resend ok. ID:").concat(u.ID)),i.deleteLocalMessage(u)),e.status=kn,e.time=c,r=!1,e.conversationType===S.CONV_GROUP?e.sequence=l:e.conversationType===S.CONV_C2C&&(u=i.getLatestMessageSentByMe(e.conversationID))&&(c=u.nick,l=u.avatar,c===e.nick&&l===e.avatar||(r=!0)),r&&i.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),!0===s?e._onlineOnlyFlag=!0:(i.appendToMessageList(e),u=e,Ye(t)&&Ye(t.messageControlInfo)&&(!0===t.messageControlInfo.excludedFromLastMessage&&(e._isExcludedFromLastMessage=!0,u=""),!0===t.messageControlInfo.excludedFromUnreadCount)&&(e._isExcludedFromUnreadCount=!0),c=e.conversationType,Ct(e.to)&&(c=S.CONV_TOPIC,n.get(10).onMessageSent({groupID:Gt(e.to),topicID:e.to,lastMessage:u})),i.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:c,subType:e.conversationSubType,lastMessage:u}]})),e._relayFlag||"TIMImageElem"!==e.type||Rt(e.payload.imageInfoArray),_n({message:e})}))})).catch((function(t){return n._onSendMessageFailed(e,t,s)}))):this._onNoModule()}},{key:"_guardForGroup",value:function(e){if(e.conversationType!==S.CONV_GROUP)return Promise.resolve();var t=this.get(7);if(!t)return this._onNoModule();if(Et({groupID:e.to})){var n=t.getLocalGroupProfile(e.to);if(n&&n.isSupportTopic)return In({code:Un.MSG_SEND_GRP_WITH_TOPIC_FAIL})}return t.guardForAVChatRoom(e)}},{key:"_onSendMessageFailed",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o="".concat(this._n,"._onSendMessageFailed"),a=(e.status=Tn,80001!==t.code&&80004!==t.code||(e.hasRiskContent=!0),this.get(11)),i=(a.deleteMessageRandom(e),10100<=t.code&&t.code<=10200||120001<=t.code&&t.code<=13e4);return n||i||!0===a.appendToMessageList(e)&&Le.l("".concat(o," message stored, ID:").concat(e.ID)),this._addSendMessageFailCountOnUser(e,t),n=new Zn("sendMessage"),i="head.seq:".concat(t.data.headSeq," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to),ne&&("connection"in navigator&&(a=navigator.connection,i+=" downlink:".concat(a.downlink," effectiveType:").concat(a.effectiveType," rtt:").concat(a.rtt)),"memory"in window.performance)&&(a=window.performance.memory,i+=" usedJSHeapSize:".concat(a.usedJSHeapSize," totalJSHeapSize:").concat(a.totalJSHeapSize," jsHeapSizeLimit:").concat(a.jsHeapSizeLimit)),n.setMessage(i).setError(t).end(),Le.e("".concat(o," ").concat(i," error:"),t),In(new On({code:t&&t.code?t.code:Un.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([S.MSG_IMAGE,S.MSG_AUDIO,S.MSG_VIDEO,S.MSG_FILE].includes(e.type))return jn;if(e.conversationType===S.CONV_C2C)return Vn;if(e.conversationType===S.CONV_GROUP){var t=this.get(7);if(t&&(t=t.getLocalGroupProfile(e.to)))return It(e=t.type)?Hn:Fn}}},{key:"_addSendMessageTotalCount",value:function(e){(e=this._getSendMessageSpecifiedKey(e))&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n;(e=this._getSendMessageSpecifiedKey(e))&&((n=this.get(26)).addSuccessCount(e),n.addCost(e,zt(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){t=void 0===(t=t.code)?-1:t;var n,o=this.get(26);(e=this._getSendMessageSpecifiedKey(e))===jn&&(n=!1,n=!!Di.includes(t)||n)?o.addFailedCountOfUserSide(qn):Ni(t)&&e&&o.addFailedCountOfUserSide(e)}},{key:"resendMessage",value:function(e,t){return e.isResend=!0,e.status=Cn,this.sendMessageInstance(e,t)}},{key:"revokeMessage",value:function(e){var t,n,o=this,a=null;return e.conversationType===S.CONV_C2C?a=this.get(6):e.conversationType===S.CONV_GROUP&&(a=this.get(7)),a?((t=new Zn("revokeMessage")).setMessage("type:".concat(e.type," from:").concat(e.from," to:").concat(e.to)),n="".concat(this._n,".").concat("revokeMessage"),a.revokeMessage(e).then((function(a){return He(a=a.data.recallRetList)||0===a[0].retCode?(Le.i("".concat(n," ok. ID:").concat(e.ID)),e.isRevoked=!0,t.end(),o.get(11).onMessageRevoked([e]),_n({message:e})):(a=new On({code:a[0].retCode,data:{message:e}}),t.setCode(a.code).setMoreMessage(a.message).end(),In(a))})).catch((function(o){t.setError(o).end();var a=new On({code:o&&o.code?o.code:Un.MSG_REVOKE_FAIL,message:o&&o.message?o.message:void 0,data:{message:e}});return Le.w("".concat(n," failed. error:"),o),In(a)}))):this._onNoModule()}},{key:"deleteMessage",value:function(e){var t=this,n=null,o=e[0],a=o.conversationID,i="",s=[],r=[];if(o.conversationType===S.CONV_C2C)n=this.get(6),i=a.replace(S.CONV_C2C,""),e.forEach((function(e){e&&e.status===kn&&e.conversationID===a&&(e._onlineOnlyFlag||s.push("".concat(e.sequence,"_").concat(e.random,"_").concat(e.time)),r.push(e))}));else if(o.conversationType===S.CONV_GROUP)n=this.get(7),i=a.replace(S.CONV_GROUP,""),e.forEach((function(e){e&&e.status===kn&&e.conversationID===a&&(e._onlineOnlyFlag||s.push("".concat(e.sequence)),r.push(e))}));else if(o.conversationType===S.CONV_SYSTEM)return In({code:Un.CANNOT_DELETE_GRP_SYSTEM_NOTICE});if(!n)return this._onNoModule();if(0===s.length)return this._onMessageDeleted(r);30<s.length&&(s=s.slice(0,30),r=r.slice(0,30));var c=new Zn("deleteMessage"),l=(c.setMessage("to:".concat(i," count:").concat(s.length)),"".concat(this._n,".").concat("deleteMessage"));return n.deleteMessage({to:i,keyList:s}).then((function(e){return c.end(),Le.i("".concat(l," ok")),t._onMessageDeleted(r)})).catch((function(e){return c.setError(e).end(),Le.w("".concat(l," failed. error:"),e),In(e=new On({code:e&&e.code?e.code:Un.MSG_DELETE_FAIL,message:e&&e.message?e.message:void 0}))}))}},{key:"_onMessageDeleted",value:function(e){return this.get(11).onMessageDeleted(e),yn({messageList:e})}},{key:"translateText",value:function(e){var n="".concat(this._n,".").concat("translateText"),o=e.sourceTextList,a=e.sourceLanguage,i=(e=e.targetLanguage,new Zn("translateText"));return i.setMessage("sourceLanguage:".concat(a," targetLanguage:").concat(e)),this.req({P:Gn.TRANSLATE_TEXT,data:{sourceTextList:o,source:a||"auto",target:e,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then((function(e){var o=(e=e.data).error,a=e.requestID;if(e=e.translatedTextList,0===o.code)return i.end(),Le.i("".concat(n," ok. requestID:").concat(a)),_n({translatedTextList:e});throw t(t({},o),{},{requestID:a})})).catch((function(e){return i.setCode(e.code).setMoreMessage(e.requestID).end(),Le.w("".concat(n," failed. error:"),e),In({code:Un.TRANSLATE_TEXT_FAIL})}))}},{key:"convertVoiceToText",value:function(e){var n,o,a,i=e.message,s=(e=e.language,i.payload.url);return(i.from===this.getMyUserID()&&"out"===i.flow&&(s=i.payload.remoteAudioUrl),i=/\.(wav|pcm|ogg-opus|speex|silk|mp3|m4a|aac|amr)/).test(s)?(i=i.exec(s)[1]||"mp3",n="16k_zh-PY",e?"zh (cmn-Hans-CN)"===e?n="16k_zh":"en-US"===e?n="16k_en":"yue-Hant-HK"===e?n="16k_yue":"ja-JP"===e&&(n="16k_ja"):n="16k_zh-PY",e="serviceType:".concat(n," url:").concat(s),o="".concat(this._n,".").concat("convertVoiceToText"),Le.i("".concat(o," ").concat(e)),(a=new Zn("convertVoiceToText")).setMessage(e),this.req({P:Gn.VOICE_TO_TEXT,data:{url:s,language:n,SDKAppID:this.getSDKAppID(),format:i}}).then((function(e){var n=(e=e.data).error,i=e.requestID;if(e=e.result,0===n.code)return a.end(),Le.i("".concat(o," ok. requestID:").concat(i)),_n({result:e});throw t(t({},n),{},{requestID:i})})).catch((function(e){return a.setCode(e.code).setMoreMessage(e.requestID||"").end(),Le.w("".concat(o," failed. error:"),e),In({code:Un.VOICE_TO_TEXT_FAIL})}))):In({code:Un.UNSUPPORTED_VOICE_FORMAT})}},{key:"modifyRemoteMessage",value:function(e){var t=this,n=null,o=e.conversationType,a=e.to,i=this.get(7);if(!i)return this._onNoModule();if(i.isMessageFromOrToAVChatroom(a))return In({code:Un.MSG_MODIFY_DISABLED_IN_AV,data:{message:e}});if(!1===this.get(29).filterMessage(e))return e.hasRiskContent=!0,In({code:Un.PROFANITY_FOUND,data:{message:e}});o===S.CONV_C2C?n=this.get(6):o===S.CONV_GROUP&&(n=this.get(7));var s=new Zn("modifyMessage"),r=(s.setMessage("to:".concat(a)),"".concat(this._n,".modifyRemoteMessage"));return n.modifyRemoteMessage(e).then((function(n){return s.end(),Le.i("".concat(r," ok")),_n({message:n=t._onModifyRemoteMessageResp(e,n.data)})})).catch((function(n){var o;return s.setCode(n.code).setMoreMessage(n.message).end(),Le.w("".concat(r," failed. error:"),n),20027===n.code?(o=t._onModifyRemoteMessageResp(e,n.data),In({code:Un.MSG_MODIFY_CONFLICT,data:{message:o}})):In({code:n.code,message:n.message,data:{message:e}})}))}},{key:"_generateSearchdata",value:function(e){var t=e.conversationID,n=e.timePosition,o=e.timePeriod;return e=h(e,Gi),ut(t)||(kt(t)&&(e.account=t.replace(S.CONV_C2C,"")),Tt(t)&&(e.groupID=t.replace(S.CONV_GROUP,""))),Ke(o)&&0<o&&(Ke(n)&&0<n?e.startTime=n-o:e.startTime=Te()-o),e.startTime&&e.startTime<0&&(e.startTime=void 0),Ke(n)&&0<n&&(e.endTime=n),e}},{key:"searchCloudMessages",value:function(e){var t=this,n="searchCloudMessages",o="".concat(this._n,".").concat(n);if(!e)return In({code:Un.OPTIONS_IS_EMPTY,message:this.getErrMsg(Un.OPTIONS_IS_EMPTY,n)});var a,i,s,r=e.keywordList,c=e.keywordListMatchType,l=e.conversationID,u=e.cursor,d=We(e.senderUserIDList)&&0<e.senderUserIDList.length,p=We(e.messageTypeList)&&0<e.messageTypeList.length;if(r||d||p)return a=Date.now(),i=new Zn(n),s="keywordList:".concat(r," keywordListMatchType:").concat(c," ")+"convID:".concat(l," cursor:").concat(u),Le.l("".concat(o," ").concat(s)),this.req({P:Gn.MSG_CLOUD_SEARCH,data:this._generateSearchdata(e)}).then((function(n){var r=(c=n.data).code,c=c.message;if(0!==r)return c=t.getErrMsg(60020===r?"SearchCloudMessagesUnavailable":r)||c,r=new On({code:r,message:c}),i.setMessage(s).setError(r).end(),In(r);t.get(27).isSearchCloudMessagesEnabled(),r=(c=n.data).cursor,n=c.totalCount,c=c.searchResult;var l="totalCount:".concat(n," cost:").concat(zt(a));return _n({searchResultList:(Le.l("".concat(o," ok. cursor:").concat(r," ").concat(l)),i.setMessage("".concat(s," ").concat(l)).end(),l=t._handleSearchResults(c,!e.conversationID)),cursor:r,totalCount:n})})).catch((function(e){return i.setMessage(s).setError(e).end(),In(e)}));throw Le.e("[".concat(n,'] Missing required params: "keywordList".')),new Error("Params validate failed.")}},{key:"_handleSearchResults",value:function(e,t){var n=this.get(11);return We(e)&&0!==e.length?e.map((function(e){var o=e.groupID,a=e.userID,i=e.messageCount,s=(e=void 0===(e=e.messageList)?[]:e,{conversationID:a=o?"".concat(S.CONV_GROUP).concat(o):"".concat(S.CONV_C2C).concat(a),messageCount:i,messageList:[]});return t&&1<i||0<(i=e.filter((function(e){return!!e}))).length&&(e=n.onRoamingMessage(i,a,!1),o&&e.reverse(),s.messageList=e,s.messageCount=e.length),s})):[]}},{key:"_onModifyRemoteMessageResp",value:function(e,t){Le.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),t);var n=e.conversationType,o=e.from,a=e.to,i=e.random,s=e.sequence,r=(e=e.time,t.elements),c=t.messageVersion;return t=void 0===(t=t.cloudCustomData)?"":t,this.get(11).onMessageModified({conversationType:n,from:o,to:a,time:e,random:i,sequence:s,elements:r,cloudCustomData:t,messageVersion:c})}},{key:"_generateUUID",value:function(e){var t=this.get(12);return t="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(at()),(e=(e=e.name||e.value||e.url||e.tempFilePath)&&e.slice(e.lastIndexOf(".")+1))?"".concat(t,".").concat(e):t}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.get(4).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===S.CONV_GROUP){var t=this.get(7);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),Ji),Bi=(r(Wi,Nn),Ui=m(Wi),i(Wi,[{key:"onMsgExtNotify",value:function(e){var t=this,n=(e=e.dataList).messageInfo,o=e.operateType,a=e.operateResultList,i=e.tinyID,s=(e=e.globalSequence,n.clientTime),r=(n=n.random,"".concat(i,"-").concat(s,"-").concat(n)),c=[],l=[],u=(Le.l("".concat(this._n,".onMsgExtNotify messageID:").concat(r," operateType:").concat(o," globalSequence:").concat(e)),this._updateGlobalSeq(r,e),!1),d=!1;a.forEach((function(e){var n=void 0===(n=e.extensions)?[]:n,a=e.clearSequence;1===o?(u=!0,n.forEach((function(e){c.push({key:e.key,value:e.value})})),t._updateLocalExt(r,n)):2===o?(d=!0,n.forEach((function(e){l.push(e.key)})),t._updateLocalExt(r,n)):3===o&&(d=!0,t._hasLocalExt(r)&&t._getLocalExt(r).forEach((function(e,t){e.seq<=a&&!He(e.value)&&l.push(t)})),t._clearLocalExt(r,a))})),u&&this.emitOEvt(M.MESSAGE_EXTENSIONS_UPDATED,{messageID:r,extensions:c}),d&&this.emitOEvt(M.MESSAGE_EXTENSIONS_DELETED,{messageID:r,keyList:l})}},{key:"setMessageExtensions",value:function(e,t){var n,o,a,i,s,r,c,l="setMessageExtensions";return this.canIUse(P.MSG_EXT)?(n="".concat(this._n,".").concat(l),o=e.ID,a=e.conversationID,i=e.sequence,s=e.time,r=v(t),20<t.length&&(r=t.slice(0,20),Le.w("".concat(n,". the length of extensions cannot exceed 20."))),t="convID:".concat(a," messageID:").concat(o," sequence:").concat(i," time:").concat(s," count:").concat(r.length),(c=new Zn(l)).setMessage(t),Le.l("".concat(n," ").concat(t)),this._modifyMsgExts(e,r).then((function(e){var t=e.resultList,o=e.successCount;return e=e.failureCount,o="successCount:".concat(o," failCount:").concat(e),c.setMoreMessage(o).end(),Le.l("".concat(n," ok. ").concat(o)),_n({extensions:t})})).catch((function(e){return c.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))):this.noUse(l)}},{key:"getMessageExtensions",value:function(e){var t,n,o,a,i,s,r,c=this,l="getMessageExtensions";return this.canIUse(P.MSG_EXT)?(t="".concat(this._n,".").concat(l),n=e.ID,i=e.conversationID,o=e.sequence,a=e.time,i="convID:".concat(i," messageID:").concat(n," sequence:").concat(o," time:").concat(a),(s=new Zn(l)).setMessage(i),r=void Le.l("".concat(t," ").concat(i)),this.getMsgExtsMap.has(n)&&(r=this._getGlobalSeq(n)),this._getMsgExts(e,r).then((function(e){return s.end(),Le.l("".concat(t," ok. extCount:").concat(e.length)),ut(r)&&0<e.length&&c.getMsgExtsMap.set(n,1),_n({extensions:e})})).catch((function(e){return s.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this.noUse(l)}},{key:"deleteMessageExtensions",value:function(e,t){var n,o,a,i,s,r,c,l="deleteMessageExtensions";return this.canIUse(P.MSG_EXT)?(n="".concat(this._n,".").concat(l),o=[],a=3,He(t)||(a=2,t.forEach((function(e){o.push({key:e,value:"",seq:0})}))),t=e.ID,r=e.conversationID,i=e.sequence,s=e.time,r="convID:".concat(r," messageID:").concat(t," sequence:").concat(i," time:").concat(s," operateType:").concat(a),(c=new Zn(l)).setMessage(r),Le.l("".concat(n," ").concat(r)),this._modifyMsgExts(e,o,a).then((function(e){var t=e.resultList,o=e.successCount,i=(e=e.failureCount,"");return 2===a&&(i="success count:".concat(o," fail count:").concat(e)),c.setMoreMessage("".concat(i)).end(),Le.l("".concat(n," ok. ").concat(i)),_n({extensions:t})})).catch((function(e){return c.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))):this.noUse(l)}},{key:"_modifyMsgExts",value:function(e,t){var n=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,a=Ct(e.to)?S.CONV_TOPIC:e.conversationType,i=void 0,s=(3!==o&&(i=this._getReqExts(e,t)),null);switch(a){case S.CONV_C2C:s=this.get(6);break;case S.CONV_GROUP:s=this.get(7);break;case S.CONV_TOPIC:s=this.get(10);break;default:return In({code:Un.NO_MODULE})}return s.modifyMsgExts(e,i,o).then((function(t){var o=(t=t.data).extensions,a=(t=t.seq,[]),i=0,s=0,r=[];return(o=He(o)?[]:o).forEach((function(e){var t=e.errorCode,n=(e=e.extension).key,o=e.value;e=e.seq,a.push({code:t,key:n,value:o}),0===t?i++:s++,r.push({key:n,value:o,seq:e})})),n._updateGlobalSeq(e.ID,t),0<r.length&&(n._updateLocalExt(e.ID,r),r=null),{resultList:a,successCount:i,failureCount:s}})).catch((function(e){return In(e)}))}},{key:"_getReqExts",value:function(e,t){var n,o=[];return this._hasLocalExt(e.ID)?(n=this._getLocalExt(e.ID),t.forEach((function(e){var t=e.key,a=(e=e.value,0);n.has(t)&&(a=n.get(t).seq),o.push({key:t,value:e,seq:a})}))):t.forEach((function(e){var t=e.key;e=e.value,o.push({key:t,value:e,seq:0})})),o}},{key:"_getMsgExts",value:function(e,t){var n=this,o="".concat(this._n,"._getMsgExts"),a=e.ID,i=null;switch(Ct(e.to)?S.CONV_TOPIC:e.conversationType){case S.CONV_C2C:i=this.get(6);break;case S.CONV_GROUP:i=this.get(7);break;case S.CONV_TOPIC:i=this.get(10);break;default:return In({code:Un.NO_MODULE})}return i.getMessageExtensions(e,t).then((function(t){var i=(t=t.data).extensions,s=t.completeFlag,r=t.globalSequence;return t=t.clearSequence,i=He(i)?[]:i,Le.l("".concat(o," ok. completeFlag:").concat(s," globalSequence:").concat(r," clearSequence:").concat(t," count:").concat(i.length)),n._updateLocalExt(a,i),n._clearLocalExt(a,t),n._updateGlobalSeq(a,r),1!==s?(t=i.slice(-1)[0].seq+1,n._getMsgExts(e,t)):n._getLocalExtList(a)})).catch((function(e){return In(e)}))}},{key:"_hasLocalExt",value:function(e){return this.msgExtMap.has(e)}},{key:"_getLocalExt",value:function(e){return this.msgExtMap.get(e)}},{key:"_updateLocalExt",value:function(e,t){this._hasLocalExt(e)||this.msgExtMap.set(e,new Map);var n=this._getLocalExt(e);t.forEach((function(e){var t=e.key,o=e.value;e=e.seq,n.set(t,{value:void 0===o?"":o,seq:e})}))}},{key:"_clearLocalExt",value:function(e,t){var n;t<=0||!this._hasLocalExt(e)||(n=this._getLocalExt(e)).forEach((function(e,o){e.seq<=t&&n.delete(o)}))}},{key:"_getLocalExtList",value:function(e){var t=[];return this._hasLocalExt(e)&&this._getLocalExt(e).forEach((function(e,n){He(e=e.value)||t.push({key:n,value:e})})),t}},{key:"_getGlobalSeq",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSeq",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this.msgExtMap.clear(),this.globalSeqMap.clear(),this.getMsgExtsMap.clear()}}]),Wi),Vi=(r(Yi,Nn),Oi=m(Yi),i(Yi,[{key:"onReactionNotifyList",value:function(e){var n=this;(void 0===(e=(e||{}).dataList)?[]:e).forEach((function(e){var o=e.C2CMessageInfo,a=void 0===(a=e.groupMessageInfo)?{}:a,i=(e=void 0===(e=e.reactionList)?[]:e,a=(o=t(t({},void 0===o?{}:o),a)).tinyID,o.clientTime),s=(o=o.random,a="".concat(a,"-").concat(i,"-").concat(o),[]);e.forEach((function(e){ut(e.userIDList)&&(e.userIDList=[],e.count=0),s.push.apply(s,v(e.userIDList))})),Le.l("".concat(n._n,".onReactionNotifyList messageID:").concat(a," reactionList:").concat(e.length)),n._handleReactionSummary([{messageID:a,reactionList:e}],s).then((function(e){n.emitOEvt(M.MESSAGE_REACTIONS_UPDATED,t({},e[0]))}))}))}},{key:"onReactionNotify",value:function(e){var n=(e=e.dataList||{}).C2CMessageInfo,o=void 0===(o=e.groupMessageInfo)?{}:o,a=e.reactionID,i=(e=e.operateType,o=(n=t(t({},void 0===n?{}:n),o)).tinyID,n.clientTime);n=n.random,o="".concat(o,"-").concat(i,"-").concat(n),Le.l("".concat(this._n,".onReactionNotify messageID:").concat(o," reactionID:").concat(a," operateType:").concat(e)),1===e?this._addReactedByMyselfMap(o,a):this._removeReactedByMyselfMap(o,a),i="".concat(o,"-").concat(a),this._reactionInfoMap.has(i)&&((n=this._reactionInfoMap.get(i)).reactedByMyself=1===e,this.emitOEvt(M.MESSAGE_REACTIONS_UPDATED,{messageID:o,reactionList:[n]}))}},{key:"addMessageReaction",value:function(e,t){var n,o,a,i,s=this,r="addMessageReaction";return this.canIUse(P.MSG_REACTION)?(n="".concat(this._n,".").concat(r),i=e.ID,o=e.conversationID,o="convID:".concat(o," messageID:").concat(i," reactionID:").concat(t),(a=new Zn(r)).setMessage(o),Le.l("".concat(n," ").concat(o)),i=this._createReactionOperationPack(e,t,1),this._addReactedByMyselfMap(e.ID,t),this.req(i).then((function(){return a.end(),Le.l("".concat(n," ok.")),_n()})).catch((function(o){return s._removeReactedByMyselfMap(e.ID,t),a.setError(o).end(),Le.e("".concat(n," failed. error:"),o),In(o)}))):this.noUse(r)}},{key:"removeMessageReaction",value:function(e,t){var n,o,a,i,s="removeMessageReaction";return this.canIUse(P.MSG_REACTION)?(n="".concat(this._n,".").concat(s),i=e.ID,o=e.conversationID,o="convID:".concat(o," messageID:").concat(i," reactionID:").concat(t),(a=new Zn(s)).setMessage(o),Le.l("".concat(n," ").concat(o)),i=this._createReactionOperationPack(e,t,2),this._removeReactedByMyselfMap(e.ID,t),this.req(i).then((function(){return a.end(),Le.l("".concat(n," ok.")),_n()})).catch((function(e){return a.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))):this.noUse(s)}},{key:"getMessageReactions",value:function(e){var n,o,a,i,s,r,c=this,l="getMessageReactions";return this.canIUse(P.MSG_REACTION)?(n="".concat(this._n,".").concat(l),o=e.messageList,r=e.maxUserCountPerReaction,a=o[0].conversationID,a="convID:".concat(a," maxUserCountPerReaction:").concat(r," msgCount:").concat(o.length),(i=new Zn(l)).setMessage(a),Le.l("".concat(n," ").concat(a)),s=new Map,r=this._createReactionSummaryPack(t(t({},e),{},{messageIDMap:s})),this.req(r).then((function(e){e=e.data.resultList;var t=[],n=[];return(void 0===e?[]:e).forEach((function(e){var o=void 0===(o=e.messageKey)?void 0:o,a=void 0===(a=e.messageSequence)?void 0:a;e=void 0===(e=e.reactionList)?[]:e,a=ut(o)?s.get(a):s.get(o),t.push({messageID:a,reactionList:e}),e.forEach((function(e){n.push.apply(n,v(e.userIDList))}))})),c._handleReactionSummary(t,n)})).then((function(e){return i.end(),Le.l("".concat(n," ok.")),s.clear(),_n({resultList:e})})).catch((function(e){return i.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))):this.noUse(l)}},{key:"getAllUserListOfMessageReaction",value:function(e){var t,n,o,a,i,s,r,c,l=this,u="getAllUserListOfMessageReaction";return this.canIUse(P.MSG_REACTION)?(t="".concat(this._n,".").concat(u),i=e.message,n=e.reactionID,o=e.nextSeq,a=e.count,c=i.ID,i=i.conversationID,i="convID:".concat(i," messageID:").concat(c," reactionID:").concat(n," nextSeq:").concat(o," count:").concat(a),(s=new Zn(u)).setMessage(i),Le.l("".concat(t," ").concat(i)),r={userList:[],nextSeq:0,isCompleted:!1},c=this._createReactionUserListPack(e),this.req(c).then((function(e){var t=void 0===(t=(e=e.data).userIDList)?[]:t;return e=void 0===(e=e.nextSeq)?0:e,r.nextSeq=e,r.isCompleted=0===e,l.get(4).getUserNickAndAvatar(t)})).then((function(e){return r.userList=e,s.end(),Le.l("".concat(t," ok.")),_n(r)})).catch((function(e){return s.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this.noUse(u)}},{key:"_createReactionOperationPack",value:function(e,t,n){var o,a,i=void 0;return t={reactionID:t,userIDList:[this.getMyUserID()]},e.conversationType===S.CONV_C2C&&(o=this.get(6),i=1===n?Gn.ADD_C2C_MSG_REACTION:Gn.RM_C2C_MSG_REACTION,t.from=e.from,t.to=e.to,t.messageKey=o.getMessageKey(e)),e.conversationType===S.CONV_GROUP&&(o=void 0,a=e.to,Ct(e.to)&&(a=Gt(o=e.to)),i=1===n?Gn.ADD_GRP_MSG_REACTION:Gn.RM_GRP_MSG_REACTION,t.groupID=a,t.topicID=o,t.messageSequence=e.sequence),{P:i,data:t}}},{key:"_createReactionSummaryPack",value:function(e){var t,n,o,a=e.messageList,i=void 0===(i=e.maxUserCountPerReaction)?10:i,s=e.messageIDMap,r=void 0,c=void 0;return(e=a[0]).conversationType===S.CONV_C2C&&(t=this.get(6),n=a.map((function(e){var n=t.getMessageKey(e);return s.set(n,e.ID),n})),r=Gn.GET_C2C_MSG_REACTIONS,c={from:e.from,to:e.to,messageKeyList:n,count:i}),e.conversationType===S.CONV_GROUP&&(n=void 0,o=e.to,Ct(e.to)&&(o=Gt(n=e.to)),e=a.map((function(e){return s.set(e.sequence,e.ID),e.sequence})),r=Gn.GET_GRP_MSG_REACTIONS,c={groupID:o,topicID:n,messageSequenceList:e,count:i}),{P:r,data:c}}},{key:"_createReactionUserListPack",value:function(e){var t=e.message,n=e.reactionID,o=e.nextSeq,a=void 0;return n={reactionID:n,nextSeq:void 0===o?0:o,count:100<(e=void 0===(e=e.count)?100:e)?100:e},t.conversationType===S.CONV_C2C&&(o=this.get(6),a=Gn.GET_C2C_MSG_REACTION_USER_LIST,n.from=t.from,n.to=t.to,n.messageKey=o.getMessageKey(t)),t.conversationType===S.CONV_GROUP&&(e=void 0,o=t.to,Ct(t.to)&&(o=Gt(e=t.to)),a=Gn.GET_GRP_MSG_REACTION_USER_LIST,n.groupID=o,n.topicID=e,n.messageSequence=t.sequence),{P:a,data:n}}},{key:"_handleReactionSummary",value:function(e,t){var n=this;return this.get(4).getUserNickAndAvatar(t).then((function(t){var o=[];return e.forEach((function(e){var a=[];e.reactionList.forEach((function(o){var i=o.reactionID,s=o.count,r=o.userIDList,c=(o=void 0===(o=o.reactedByMyself)?void 0:o,[]);r.forEach((function(e){t.forEach((function(t){e===t.userID&&c.push(t)}))})),r={reactionID:i,totalUserCount:s,partialUserList:c,reactedByMyself:n._computeReactedByMyself({reactedByMyself:o,messageID:e.messageID,reactionID:i})},a.push(r),ut(o)&&!n._reactedByMyselfMap.has(e.messageID)&&(s="".concat(e.messageID,"-").concat(i),n._reactionInfoMap.set(s,r))})),o.push({messageID:e.messageID,reactionList:a})})),o}))}},{key:"_addReactedByMyselfMap",value:function(e,t){this._reactedByMyselfMap.has(e)||this._reactedByMyselfMap.set(e,[]),-1===(e=this._reactedByMyselfMap.get(e)).indexOf(t)&&e.push(t)}},{key:"_removeReactedByMyselfMap",value:function(e,t){this._reactedByMyselfMap.has(e)&&-1<(t=(e=this._reactedByMyselfMap.get(e)).indexOf(t))&&e.splice(t,1)}},{key:"_computeReactedByMyself",value:function(e){var t=e.reactedByMyself,n=e.messageID;return e=e.reactionID,ut(t)?!!this._reactedByMyselfMap.has(n)&&this._reactedByMyselfMap.get(n).includes(e):1===t}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._reactedByMyselfMap.clear(),this._reactionInfoMap.clear()}}]),Yi),Fi=(r($i,Nn),Ai=m($i),i($i,[{key:"sendMessage",value:function(e){var t=this,n=this._createMsg(e);if(null===n)return In({code:Un.MSG_SEND_FAIL});this._addSendMessageTotalCount(n);var o=Date.now();return this.get(11).setMessageRandom(n),this._sendComboMessage(n,e).then((function(e){var a=(e=e.data).time,i=e.sequence;return Ke(e=e.readReceiptCode)&&0!==e&&(new Zn("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(i," readReceiptCode:").concat(e)).end(),Le.w("".concat(t._n,".sendMessage readReceiptCode:").concat(e," message:").concat(t.getErrMsg(e)))),t._addSendMessageSuccessCount(n,o),e=t.get(11),n.status=kn,n.time=a,n.conversationType===S.CONV_GROUP&&(n.sequence=i),e.appendToMessageList(n),a=n,!0===n._isExcludedFromLastMessage&&(a=""),e.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:a}]}),_n({message:n})})).catch((function(e){return t._onSendMessageFailed(n,e)}))}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.get(20),o="";return e.conversationType===S.CONV_C2C&&(o="".concat(U.NAME.OPEN_IM,".").concat(Gn.SEND_C2C_MSG)),e.conversationType===S.CONV_GROUP&&(o="".concat(U.NAME.GRP,".").concat(Gn.SEND_GRP_MSG)),n.sendComboMessage({servcmd:o,data:t})}},{key:"_createMsg",value:function(e){var t="".concat(this._n,"._createMsg"),n=null;try{var o,a=this.getMyUserID(),i={};i.senderTinyID=this.getMyTinyID(),i.currentUser=a,i.from=e.From_Account||a,e.GroupId?(i.conversationID="".concat(S.CONV_GROUP).concat(e.GroupId),i.conversationType=S.CONV_GROUP,i.to=e.GroupId):e.To_Account&&(i.conversationID="".concat(S.CONV_C2C).concat(e.To_Account),i.conversationType=S.CONV_C2C,i.to=e.To_Account),i.time=e.MsgTimeStamp||0,i.random=e.Random||e.MsgRandom||0,i.priority=e.MsgPriority,lt(e.CloudCustomData)&&0<e.CloudCustomData.length&&(i.cloudCustomData=e.CloudCustomData),We(e.SendMsgControl)&&(i.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(i.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg"))&&(i.messageControlInfo.excludedFromLastMessage=1),i.conversationType===S.CONV_GROUP&&We(e.To_Account)&&0<e.To_Account.length&&(o=e.To_Account,50<e.To_Account.length&&(o=e.To_Account.slice(0,50),Le.w("".concat(t," To_Account must be less than or equal to 50."))),i.receiverList=v(o),e.To_Account=v(o)),1!==e.IsNeedReadReceipt&&1!==e.NeedReadReceipt||(i.needReadReceipt=!0),1===e.SupportMessageExtension&&(i.isSupportExtension=!0),(n=new ko(i)).status=Cn,e.MsgClientTime=n.clientTime,n.conversationType===S.CONV_C2C&&(e.MsgSeq=n.sequence);for(var s,r=e.MsgBody.length,c=0;c<r;c++)"TIMTextElem"===(s=e.MsgBody[c]).MsgType?n.setTextElement(s.MsgContent.Text):"TIMCustomElem"===s.MsgType?n.setCustomElement({data:s.MsgContent.Data||"",description:s.MsgContent.Desc||"",extension:s.MsgContent.Ext||""}):"TIMFaceElem"===s.MsgType&&n.setFaceElement({index:s.MsgContent.Index,data:s.MsgContent.Data});var l=n.getElements();n.payload=l[0].content,n.type=l[0].type}catch(u){n=null,Le.e("".concat(t," failed. error:"),u)}return n}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Tn,this.get(11).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new Zn("sendMessage"),o="head.seq:".concat(t.data.headSeq,"  type:").concat(e.type," from:").concat(e.from," to:").concat(e.to);return n.setMessage(o).setError(t).end(),Le.e("".concat(this._n,"._onSendMessageFailed ").concat(o," error:"),t),In(new On({code:t&&t.code?t.code:Un.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){return e.conversationType===S.CONV_C2C?Vn:e.conversationType===S.CONV_GROUP&&(e=this.get(7).getLocalGroupProfile(e.to))?It(e=e.type)?Hn:Fn:void 0}},{key:"_addSendMessageTotalCount",value:function(e){(e=this._getSendMessageSpecifiedKey(e))&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n;(e=this._getSendMessageSpecifiedKey(e))&&((n=this.get(26)).addSuccessCount(e),n.addCost(e,zt(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){t=void 0===(t=t.code)?-1:t;var n=this.get(26);e=this._getSendMessageSpecifiedKey(e),Ni(t)&&e&&n.addFailedCountOfUserSide(e)}}]),$i),Hi=(r(Ki,Nn),Ri=m(Ki),i(Ki,[{key:"registerPlugin",value:function(e){var t=this,n="0";Object.keys(e).forEach((function(o){t.plugins[o]=e[o],"tim-upload-plugin"===o&&"function"==typeof e[o].getVersion&&(n=e[o].getVersion())})),new Zn("registerPlugin").setMessage("".concat(Object.keys(e))).setMoreMessage("version:".concat(n)).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),Ki),ji=(r(zi,Nn),Li=m(zi),i(zi,[{key:"_init",value:function(){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var n=this,o=e.cookie,a=e.syncFlag,i=e.isOnlineSync,s="".concat(this._n,"._startSync"),r=(Le.l("".concat(s," options:"),e),new Zn("syncUnread"));r.setMessage(JSON.stringify(e)),this.req({P:Gn.SYNC_UNREAD_MSG,data:{cookie:o,syncFlag:a,isOnlineSync:i}}).then((function(e){var o=(a=e.data).cookie,a=a.syncFlag,i="$cookie:".concat(o," syncFlag:").concat(a);Le.l("".concat(s," ok. ").concat(i)),n._cookie=o,r.setMoreMessage(i).end(),He(o)||(0===a||1===a?(n._dispatch(t(t({},e.data),{},{isSyncingEnded:!1})),n._startSync({cookie:o,syncFlag:a,isOnlineSync:0})):2===a&&n._dispatch(t(t({},e.data),{},{isSyncingEnded:!0})))})).catch((function(e){r.setError(e).end(),Le.e("".concat(s," failed. error:"),e)}))}},{key:"_dispatch",value:function(e){e.eventArray&&this.get(20).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.get(6).onNewMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList,isSyncingEnded:e.isSyncingEnded})}},{key:"syncOnNeed",value:function(){Le.l("".concat(this._n,".syncOnNeed cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"syncOnReconnected",value:function(){Le.l("".concat(this._n,".syncOnReconnected cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),zi),qi={req:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag",isRelayMessage:"IsRelayMsg",reactionID:"Reaction",messageSequenceList:"MsgSeqList",messageKeyList:"MsgKeyList",cmConfigID:"CustomModerationConfigID"},res:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList",IsPlaceMsg:"isPlaceMessage",MsgCheckResult:"checkResult",Results:"resultList",Reaction:"reactionID",Reaction_Account:"userIDList",MsgReactionNotifyList:"messageReactionNotifyList",MsgReactionNotify:"messageReactionNotify",MsgReactionSummary:"reactionList",C2CMsgInfo:"C2CMessageInfo",GroupMsgInfo:"groupMessageInfo",int32_err_code:"errorCode",str_err_msg:"errorMsg",MsgDropReason:"messageDropReason",ReactedByMe:"reactedByMyself",Level:"messageRemindType",PeerReadTime:"timestamp",NoUnreadSeqList:"excludedUnreadSequenceList",NewMsg:"topicLatestMessage"},ignoreKeyWord:["C2C","ID","USP"]};function zi(e){return o(this,zi),(e=Li.call(this,e))._n="SyncUnreadMsgModule",e._cookie="",e._onlineSyncFlag=!1,e.getIEmitInst().on(Bo.A2KEY_AND_TINYID_UPDATED,e._init,g(e)),e}function Ki(e){return o(this,Ki),(e=Ri.call(this,e))._n="PluginModule",e.plugins={},e}function $i(e){return o(this,$i),(e=Ai.call(this,e))._n="ComboMsgModule",e}function Yi(e){return o(this,Yi),(e=Oi.call(this,e))._n="MsgReactionModule",e._reactedByMyselfMap=new Map,e._reactionInfoMap=new Map,e}function Wi(e){return o(this,Wi),(e=Ui.call(this,e))._n="MsgExtModule",e.msgExtMap=new Map,e.globalSeqMap=new Map,e.getMsgExtsMap=new Map,e}function Ji(e){return o(this,Ji),(e=Pi.call(this,e))._n="MessageModule",e._messageOptionsMap=new Map,e._mergerMessageHandler=new Mi(g(e)),e}function Xi(e,t){if("string"==typeof e||Array.isArray(e))return t=Object.assign({pascalCase:!1},t),0===(e=Array.isArray(e)?e.map((function(e){return e.trim()})).filter((function(e){return e.length})).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e=e=(e=e!==e.toLowerCase()?Zi(e):e).replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(function(e,t){return t.toUpperCase()})).replace(/\d+(\w|$)/g,(function(e){return e.toUpperCase()})),t.pascalCase?e.charAt(0).toUpperCase()+e.slice(1):e);throw new TypeError("Expected the input to be `string | string[]`")}var Zi=function(e){for(var t=!1,n=!1,o=!1,a=0;a<e.length;a++){var i=e[a];t&&/[a-zA-Z]/.test(i)&&i.toUpperCase()===i?(e=e.slice(0,a)+"-"+e.slice(a),o=n,n=!(t=!1),a++):n&&o&&/[a-zA-Z]/.test(i)&&i.toLowerCase()===i?(e=e.slice(0,a-1)+"-"+e.slice(a-1),o=n,t=!(n=!1)):(t=i.toLowerCase()===i&&i.toUpperCase()!==i,o=n,n=i.toUpperCase()===i&&i.toLowerCase()!==i)}return e};function Qi(e,t){var n=0;return function e(t,o){var a,i,s,r;return 100<++n?(n--,t):We(t)?(a=t.map((function(t){return $e(t)?e(t,o):t})),n--,a):$e(t)?(i=t,s=function(e,t){if(!Ze(t))return!1;if(t!==Xi(t))for(var n=0;n<qi.ignoreKeyWord.length&&!t.includes(qi.ignoreKeyWord[n]);n++);var a;return ut(o[t])?"OPPOChannelID"===(a=t)?a:a[0].toUpperCase()+Xi(a).slice(1):o[t]},r=Object.create(null),Object.keys(i).forEach((function(e){var t=s(i[e],e);t&&(r[t]=i[e])})),a=St(a=r,(function(t,n){return We(t)||$e(t)?e(t,o):t})),n--,a):void 0}(e,t)}for(var es,ts=String.fromCharCode,ns=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320)if(56320<=(e=0|e.charCodeAt(1))&&e<=57343){if(65535<(t=(t<<10)+e-56613888|0))return ts(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533;else t<=57343&&(t=65533);return t<=2047?ts(192|t>>>6,128|63&t):ts(224|t>>>12,128|t>>>6&63,128|63&t)},os=function(e){for(var t=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ns),n=0|t.length,o=new Uint8Array(n),a=0;a<n;a=a+1|0)o[a]=0|t.charCodeAt(a);return o},as=(i(Ds,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(e){this._handler.onOpen({id:this._id,res:JSON.stringify(e)})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e:e})}},{key:"_onMessage",value:function(e){e=this._canIUseBinaryFrame?this._isAppCompressedData(e.data)?this._handler.inflate(e.data):function(e){for(var t=new Uint8Array(e),n="",o=0,a=t.length;o<a;){var i=t[o],s=0,r=0;if(i<=127?(s=0,r=255&i):i<=223?(s=1,r=31&i):i<=239?(s=2,r=15&i):i<=244&&(s=3,r=7&i),0<a-o-s)for(var c=0;c<s;)r=r<<6|63&(i=t[o+c+1]),c+=1;else r=65533,s=a-o;n+=String.fromCodePoint(r),o+=s+1}return n}(e.data):e.data,this._handler.onMessage({data:e})}},{key:"_isAppCompressedData",value:function(e){return 67===(e=new Uint8Array(e))[0]&&79===e[1]&&77===e[2]&&80===e[3]}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e:e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),Y?(oe.offSocketClose(),oe.offSocketMessage(),oe.offSocketOpen(),oe.offSocketError(),oe.closeSocket()):this._socket&&(Q?(this._socket.onClose((function(){})),this._socket.onOpen((function(){})),this._socket.onMessage((function(){})),this._socket.onError((function(){}))):(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),$?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){this._workerSocket?this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?os(e.data).buffer:e.data}):Y?oe.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket&&(Q?this._socket.send({data:this._canIUseBinaryFrame?os(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket.send(this._canIUseBinaryFrame?os(e.data):e.data))}}]),Ds),is=["keyMap"],ss=["keyMap"],rs="connected",cs="connecting",ls="disconnected",us=(i(Ss,[{key:"_setWebsocketHost",value:function(){var e=this._chM.get(12);this._currentSite=O,this._chM.isOversea()&&(this._currentSite="OVERSEA"),e.isSingaporeSite()?this._currentSite="SINGAPORE":e.isKoreaSite()?this._currentSite="KOREA":e.isGermanySite()?this._currentSite="GERMANY":e.isIndiaSite()?this._currentSite="IND":e.isJapanSite()?this._currentSite="JPN":e.isUSASite()?this._currentSite="USA":e.isIndonesiaSite()&&(this._currentSite="INDONESIA"),U.HOST.setCurrent(this._currentSite)}},{key:"_initConnection",value:function(){var e=this._chM.get(12).getSDKAppID()+"",t=(ut(U.HOST.CURRENT.BACKUP)?this._url=U.HOST.CURRENT.DEFAULT:""===this._url?this._url=U.HOST.CURRENT.DEFAULT0.replace("*",e):-1<this._url.indexOf(e)?this._url=U.HOST.CURRENT.DEFAULT:this._url===U.HOST.CURRENT.DEFAULT?this._url=U.HOST.CURRENT.BACKUP:this._url===U.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?U.HOST.CURRENT.ANYCAST:U.HOST.CURRENT.DEFAULT:this._url===U.HOST.CURRENT.ANYCAST&&(U.HOST.CURRENT.ANYCAST="",this._url=U.HOST.CURRENT.DEFAULT),e=this._chM.get(12)).getProxyServer();He(t)||(this._url=t),e.isTestEnv()&&(this._url=N.TEST[this._currentSite].DEFAULT),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return ne&&U.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&(this._checkPromiseMap(),this._checkNativeAppWS())}},{key:"_checkPromiseMap",value:function(){var e=this;0!==this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var o=t.reject,a=t.timestamp,i=(t=t.headSeq,15e3);-1!==n.indexOf(Gn.LOGIN)?i=9e4:-1!==n.indexOf(Gn.PING)&&(i=3e3),Date.now()-a>=i&&(Le.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),o(new On({code:Un.NETWORK_TIMEOUT,data:{headSeq:t}})),e._chM.onRequestTimeout())}))}},{key:"_checkNativeAppWS",value:function(){J&&!this.isConnected()&&this._reConnect()}},{key:"onOpen",value:function(e){var t,n;this._readyState!==ls&&(this._onOpenTs=Date.now(),n=e.id,e=e.res,this._socketID=n,t=zt(this._startTs,!1),n="socketID:".concat(n," res:").concat(e),Le.l("".concat(this._n,"._onOpen cost:").concat(t," ms. ").concat(n)),new Zn("wsOnOpen").setMessage(t).setCostTime(t).setMoreMessage(n).end(),this._readyState=rs,this._reConnectCount=0,this._resend(),!0===this._reConnectFlag&&(this._chM.onReconnected(),this._reConnectFlag=!1),this._chM.onOpen())}},{key:"onClose",value:function(e){var t=new Zn("wsOnClose"),n=e.id,o=(e=e.e,"sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(e.code," reason:").concat(e.reason)),a=0;0!==this._onOpenTs&&(a=Date.now()-this._onOpenTs),t.setMessage(a).setCostTime(a).setMoreMessage(o).setCode(e.code).end(!0),Le.l("".concat(this._n,"._onClose ").concat(o," onlineTime:").concat(a)),n===this._socketID&&(this._readyState=ls,a<1e3?this._chM.onReconnectFailed():this._chM.onClose())}},{key:"onError",value:function(e){var t=e.id,n=(e=e.e,"sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID));new Zn("wsOnError").setMessage(e.errMsg||JSON.stringify(e,["message","code"])).setMoreMessage(n).setLevel("error").end(!0),Le.w("".concat(this._n,"._onError"),e,n),t===this._socketID&&(this._readyState=ls,this._chM.onError())}},{key:"onMessage",value:function(e){var t,n,o,a,i,s;try{t=JSON.parse(e.data)}catch(r){new Zn("jsonParseError").setMessage(e.data).end()}t&&t.head&&(e=this._getRequestIDFromHead(t.head),n=t.body,this._chM.get(30).isTRTCCommand(e)||(s=At(t.head),n=function e(t,n){var o,a,i;return We(t)?t.map((function(t){return $e(t)?e(t,n):t})):$e(t)?(o=t,a=function(e,t){return ut(n[t])?Xi(t):n[t]},i={},Object.keys(o).forEach((function(e){i[a(o[e],e)]=o[e]})),St(i,(function(t){return We(t)||$e(t)?e(t,n):t}))):void 0}(t.body,this._getResKeyMap(s))),Le.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(n)," requestID:").concat(e," has:").concat(this._promiseMap.has(e))),this._setNextPingTs(),this._promiseMap.has(e)?(o=(s=this._promiseMap.get(e)).resolve,a=s.reject,i=s.timestamp,s=s.headSeq,this._promiseMap.delete(e),this._calcRTT(i),n.errorCode&&0!==n.errorCode?(this._chM.onErrorCodeNotZero(n),a(new On({code:n.errorCode,message:n.errorInfo||"",data:e.includes(Gn.MODIFY_C2C_MSG)||e.includes(Gn.MODIFY_GRP_MSG)?{elements:n.elements,messageVersion:n.messageVersion,cloudCustomData:n.cloudCustomData,headSeq:s}:{headSeq:s}}))):o(_n(n))):this._chM.onMessage({head:t.head,body:n}))}},{key:"_calcRTT",value:function(e){e=Date.now()-e,this._chM.get(26).addRTT(e)}},{key:"_connect",value:function(){this._readyState!==cs&&this._readyState!==rs&&(this._startTs=Date.now(),this._onOpenTs=0,this._readyState=cs,this._socket=new as(this),this._socketID=this._socket.getID(),Le.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new Zn("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end())}},{key:"getURL",value:function(){this._chM.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=wt(),t=((Y||j&&"windows"===e||J)&&(this._canIUseBinaryFrame=!1),-1),n=("ios"===e?t=re||-1:"android"===e&&(t=le||-1),this._chM.get(12)),o=this._chM.getPlatform(),a=n.getSDKAppID();return n=n.getInstanceID(),a="sdkappid=".concat(a,"&instanceid=").concat(n,"&random=").concat(this._getRandom(),"&platform=").concat(o,"&host=").concat(e)+"&version=".concat(t,"&sdkversion=").concat("3.4.7"),q&&(a+="&isminigame=1"),this._chM.canIUseInflate()&&(a+="&compress=gzip"),(this._canIUseBinaryFrame?"".concat(this._url,"/binfo?"):"".concat(this._url,"/info?")).concat(a)}},{key:"_closeConnection",value:function(e){Le.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=ls)}},{key:"_resend",value:function(){var e=this;if(Le.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),0<this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var o=t.uplinkData,a=t.resolve;t=t.reject,-1!==n.indexOf(Gn.AV_POLLING)?e._promiseMap.delete(n):(e._promiseMap.set(n,{resolve:a,reject:t,timestamp:Date.now(),uplinkData:o}),e._execute(n,o))})),0<this._simpleRequestMap.size){var t,n=T(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var o=f(t.value,2),a=o[0],i=o[1];this._execute(a,i)}}catch(s){n.e(s)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this,n=(e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap,h(e,is)),o=this._getRequestIDFromHead(e.head),a=JSON.stringify(n);return new Promise((function(i,s){t._promiseMap.set(o,{resolve:i,reject:s,timestamp:Date.now(),uplinkData:a,headSeq:e.head.seq}),Le.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(o," readyState:").concat(t._readyState)),t._readyState!==rs?t._reConnect():(t._execute(o,a),t._chM.get(26).addRequestCount())}))}},{key:"simplySend",value:function(e){e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var t=h(e,ss);e=this._getRequestIDFromHead(e.head),t=JSON.stringify(t),this._readyState!==rs?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(e,t):Le.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(e,t)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:Q?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){Le.l("".concat(this._n,"._onSendFail requestID:").concat(e)),this._chM.onSendFail()}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,2415919103===this._startSequence&&(this._startSequence=ot()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResKeyMap",value:function(e){return e=this._chM.getKeyMap(e),t(t({},qi.res),e.res)}},{key:"_reConnect",value:function(){this._readyState!==rs&&this._readyState!==cs&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e="".concat(this._n,".forcedReconnect");Le.l("".concat(e," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(4001),this._initConnection()):(this._reConnectCount=0,this._chM.get(15).isOnline()?(Le.w("".concat(e," disconnected from wsserver but network is ok, continue...")),this._closeConnection(4001),this._initConnection()):this._chM.onReconnectFailed())}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=J?Date.now()+5e3:Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===rs}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"getSocketID",value:function(){return this._socketID}},{key:"inflate",value:function(e){if(this._chM.canIUseInflate())return this._chM.get(37).inflate(e)}},{key:"setIsWorkerEnabled",value:function(e){Le.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&ge}},{key:"_getRandom",value:function(){return 0===this._random&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"close",value:function(){Le.l("".concat(this._n,".close")),this._closeConnection(4e3),this._promiseMap.clear(),this._startSequence=ot(),this._readyState=ls,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),Ss),ds=function(e,t,n){return new Promise((function(o,a){var i,s,r="application/x-www-form-urlencoded;charset=UTF-8";Q?oe.request({url:t,data:n,method:e,timeout:3e3,header:{"content-type":r},success:function(e){e&&e.data&&e.data.NetCheckInfo&&Le.l("".concat("getconninfo ok in"," miniapp. ret:"),e.data),o()},fail:function(){a(new On({code:Un.NETWORK_ERROR}))}}):(i=new XMLHttpRequest,s=setTimeout((function(){i.abort(),a(new On({code:Un.NETWORK_TIMEOUT}))}),3e3),i.onreadystatechange=function(){4===i.readyState&&(clearTimeout(s),200===i.status||304===i.status?(i.responseText&&-1<i.responseText.indexOf("NetCheckInfo")&&Le.l("".concat("getconninfo ok in"," web. ret:"),JSON.parse(i.responseText)),o()):a(new On({code:Un.NETWORK_ERROR})))},i.open(e,t,!0),i.setRequestHeader("Content-type",r),n?i.send(n):i.send())}))},ps=(r(Ms,Nn),es=m(Ms),i(Ms,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(0<this._timerForNotLoggedIn&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.get(20).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.get(20).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==S.NET_STATE_CONNECTED&&e.head.servcmd.includes(Gn.SSO_STAT)?(this.reConnect(),this.isPrivateNetWork()?Promise.resolve():this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var t=U.HOST.CURRENT.STAT;return t="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),e=JSON.stringify(e.body),ds("POST",t,e)}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){Q&&!J&&this.warn("DomainNameInMP"),this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.get(20).getKeyMap(e)}},{key:"onRequestTimeout",value:function(){3e4<=Date.now()-this._lastDiagnoseTS&&this.diagnose()}},{key:"onSendFail",value:function(){this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"onReconnected",value:function(){Le.l("".concat(this._n,".onReconnected cost:").concat(zt(this._disconnectedTS,!0,!0))),this._m.restartTimer(),this.get(20).onReconnected(zt(this._disconnectedTS,!1,!1)),this._disconnectedTS=0,this._emitNetStateChangeEvent(S.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){Le.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=!1,n=(this._socketHandler&&(t=this._socketHandler.getReconnectFlag()),"forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t));Le.l("".concat(this._n,".reConnect ").concat(n)),this._fatalErrorFlag||!this._socketHandler||!0!==e&&this._previousState===S.NET_STATE_CONNECTING&&t||(this._socketHandler.forcedReconnect(),this._emitNetStateChangeEvent(S.NET_STATE_CONNECTING))}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(Le.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),e===S.NET_STATE_DISCONNECTED&&0===this._disconnectedTS&&(this._disconnectedTS=Date.now(),this.diagnose()),this._previousState=e,this.emitOEvt(M.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e,t=this;!0!==this._probing&&(this._probing=!0,e=this.get(20).getProtocolData({P:Gn.PING}),this.send(e).then((function(){t._probing=!1})).catch((function(e){t._probing=!1;var n=t.get(15).isOnline();Le.w("".concat(t._n,"._ping failed. bOnline:").concat(n," error:"),e),e&&60002===e.code?(new Zn("error").setMessage("code:".concat(e.code," message:").concat(e.message)).end(),t._fatalErrorFlag=!0,t._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)):n?t.reConnect():t._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)})))}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),-1<this._timerForNotLoggedIn&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"canIUseInflate",value:function(){return this._m.canIUseInflate()}},{key:"getSocketID",value:function(){if(this._socketHandler)return this._socketHandler.getSocketID()}},{key:"diagnose",value:function(){this.isPrivateNetWork()||(this._lastDiagnoseTS=Date.now(),this._diagnoseBySSO(),this._diagnoseByCDN())}},{key:"_diagnoseBySSO",value:function(){var e=this,t=this._socketHandler.getURL(),n=t.split("/")[2];n.startsWith("ws")&&(t=t.slice(t.indexOf("info?")+5),n="https://".concat(n,"/v3/netcheck/getconninfo?").concat(t,"&reqtime=").concat(Date.now()),ds("GET",n).catch((function(t){Le.w("".concat(e._n,"._diagnoseBySSO failed. error:"),t)})))}},{key:"_diagnoseByCDN",value:function(){var e=this,t=(t=this._socketHandler.getURL()).slice(t.indexOf("info?")+5);t="https://boce-cdn.my-imcloud.com/v3/netcheck/getconninfo?".concat(t,"&reqtime=").concat(Date.now()),ds("GET",t).catch((function(t){Le.w("".concat(e._n,"._diagnoseByCDN failed. error:"),t)}))}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._previousState=S.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3),this._disconnectedTS=0,this._lastDiagnoseTS=0}}]),Ms),hs=["a2","tinyid"],gs=["a2","tinyid"],ms=(i(Ts,[{key:"_fillMap",value:function(){this._map.clear();var e=this._sessionM.genCommonHead(),n=this._sessionM.genCosSpecifiedHead(),o=this._sessionM.genSSOReportHead();this._map.set(Gn.LOGIN,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0,customInfo:""},keyMap:{req:{deviceBrand:"InstType"},res:{InstId:"instanceID",HelloInterval:"helloInterval",RichMsgAuthKey:"authKey"}}}),this._map.set(Gn.LOGOUT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.LOGOUT)}),body:{type:0,isWebUniapp:0},keyMap:{req:{type:"wslogout_type"}}}),this._map.set(Gn.HELLO,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.HELLO)}),body:{isWebUniapp:0},keyMap:{res:{NewInstInfo:"newInstanceInfo"}}}),this._map.set(Gn.KICK_OTHER,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.STAT_SERVICE,".").concat(Gn.KICK_OTHER)}),body:{}}),this._map.set(Gn.COS_SIGN,{head:t(t({},n),{},{servcmd:"".concat(U.NAME.IM_COS_SIGN,".").concat(Gn.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{req:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},res:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}),this._map.set(Gn.COS_PRE_SIG,{head:t(t({},n),{},{servcmd:"".concat(U.NAME.CUSTOM_UPLOAD,".").concat(Gn.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{req:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},res:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}),this._map.set(Gn.SIMPLE_COS_PRE_SIG,{head:t(t({},n),{},{servcmd:"".concat(U.NAME.CUSTOM_UPLOAD,".").concat(Gn.SIMPLE_COS_PRE_SIG)}),body:{uploadMethod:0,platform:2,SDKAppID:0,userID:"",conversationType:1,uploadConfig:[{fileID:1,fileType:1,fileName:""}]},keyMap:{req:{platform:"uint32_platform",SDKAppID:"uint32_sdkappid",userID:"str_user_id",uploadMethod:"uint32_upload_method",conversationType:"uint32_scene",uploadConfig:"rpt_upload_object",fileID:"uint32_file_id",fileType:"uint32_file_type",fileName:"str_file_name"},res:{str_final_ip:"uploadIP",rpt_pre_sig:"preSig",uint32_file_id:"fileID",uint32_exist_flag:"existFlag",str_download_url:"downloadUrl",str_upload_url:"uploadUrl",str_snapshot_url:"requestSnapshotUrl",str_file_key:"fileKey"}}}),this._map.set(Gn.GET_IMAGE_INFO,{head:t(t({},n),{},{servcmd:"".concat(U.NAME.CUSTOM_UPLOAD,".").concat(Gn.GET_IMAGE_INFO)}),body:{imageUrl:""},keyMap:{req:{imageUrl:"str_image_url"},res:{rpt_msg_image_info:"imageInfoArray",uint32_image_type:"type",str_url:"url",uint32_width:"width",uint32_height:"height",str_image_format:"imageFormat"}}}),this._map.set(Gn.GET_IP,{head:t(t({},n),{},{servcmd:"".concat(U.NAME.CUSTOM_UPLOAD,".").concat(Gn.GET_IP)}),body:{domainName:""},keyMap:{req:{domainName:"str_domain"},res:{str_final_ip:"ip"}}}),this._map.set(Gn.VIDEO_COVER,{head:t(t({},n),{},{servcmd:"".concat(U.NAME.CUSTOM_UPLOAD,".").concat(Gn.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{req:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},res:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}),this._map.set(Gn.FETCH_COMMERCIAL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_CONFIG_MANAGER,".").concat(Gn.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{req:{SDKAppID:"uint32_sdkappid"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(Gn.PUSHED_COMMERCIAL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_CONFIG_MANAGER,".").concat(Gn.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(Gn.FETCH_CLOUD_CTRL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_CONFIG_MANAGER,".").concat(Gn.FETCH_CLOUD_CTRL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{req:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(Gn.PUSHED_CLOUD_CTRL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_CONFIG_MANAGER,".").concat(Gn.PUSHED_CLOUD_CTRL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(Gn.OVERLOAD_NOTIFY,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OVERLOAD_PUSH,".").concat(Gn.OVERLOAD_NOTIFY)}),body:{},keyMap:{res:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}),this._map.set(Gn.SYNC_UNREAD_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.SYNC_UNREAD_MSG)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1,needCachedMsg:1},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},res:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}),this._map.set(Gn.GET_PROFANITY_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_MSG_AUDIT_MGR,".").concat(Gn.GET_PROFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{req:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},res:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}),this._map.set(Gn.SEND_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.SEND_C2C_MSG)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID"}}}),this._map.set(Gn.SEND_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.SEND_GRP_MSG)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0},keyMap:{req:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID"},res:{MsgTime:"time",MsgSeq:"sequence"}}}),this._map.set(Gn.REVOKE_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.REVOKE_C2C_MSG)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{req:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}),this._map.set(Gn.REVOKE_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.REVOKE_GRP_MSG)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{req:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}),this._map.set(Gn.GET_C2C_ROAMING_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.GET_C2C_ROAMING_MSG)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{req:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},res:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}),this._map.set(Gn.MODIFY_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.MODIFY_C2C_MSG)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(Gn.GET_GRP_ROAMING_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_GRP_ROAMING_MSG)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{req:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},res:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",NextReqMsgSeq:"nextSequence"}}}),this._map.set(Gn.SET_C2C_MSG_READ,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.SET_C2C_MSG_READ)}),body:{C2CMsgReaded:void 0},keyMap:{req:{lastMessageTime:"LastedMsgTime"}}}),this._map.set(Gn.SET_C2C_PEER_MUTE_NOTIFICATIONS,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{req:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}),this._map.set(Gn.GET_C2C_PEER_MUTE_NOTIFICATIONS,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{toAccount:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Peer_Account"},res:{MuteNotificationsList:"muteFlagList"}}}),this._map.set(Gn.SET_GRP_MSG_READ,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.SET_GRP_MSG_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{req:{messageReadSeq:"MsgReadedSeq"}}}),this._map.set(Gn.SET_ALL_MSG_READ,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.SET_ALL_MSG_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{req:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},res:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}),this._map.set(Gn.DEL_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.DEL_C2C_MSG)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{req:{keyList:"MsgKeyList"}}}),this._map.set(Gn.DEL_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.DEL_GRP_MSG)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{req:{deleter:"Deleter_Account",keyList:"Seqs"}}}),this._map.set(Gn.TRANSLATE_TEXT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_TRANSLATE,".").concat(Gn.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{req:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},res:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(Gn.VOICE_TO_TEXT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_SPEECH,".").concat(Gn.VOICE_TO_TEXT)}),body:{url:"",SDKAppID:0,format:"",sourceType:0,language:""},keyMap:{req:{url:"BytesUrl",SDKAppID:"Uint32Sdkappid",format:"BytesVoiceFormat",sourceType:"Uint64SourceType",language:"BytesEngServiceType"},res:{BytesRequestid:"requestID",BytesResult:"result",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(Gn.MODIFY_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.MODIFY_GRP_MSG)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(Gn.GET_READ_RECEIPT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequence:"MsgSeq"}}}),this._map.set(Gn.SEND_C2C_READ_RECEIPT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{req:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}),this._map.set(Gn.SEND_READ_RECEIPT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}),this._map.set(Gn.GET_READ_RECEIPT_DETAIL,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{req:{sequence:"MsgSeq",count:"Num"},res:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}),this._map.set(Gn.MODIFY_C2C_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.MODIFY_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(Gn.GET_C2C_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.GET_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}),this._map.set(Gn.MODIFY_GRP_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.MODIFY_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(Gn.GET_GRP_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.GET_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}),this._map.set(Gn.MSG_CLOUD_SEARCH,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.MSG_SEARCH,".").concat(Gn.MSG_CLOUD_SEARCH)}),body:{keywordList:void 0,keywordListMatchType:"or",account:void 0,groupID:void 0,count:100,cursor:void 0,messageTypeList:void 0,senderUserIDList:void 0,startTime:void 0,endTime:void 0},keyMap:{req:{keywordListMatchType:"MatchType",account:"PeerAccount",groupID:"GroupID",messageTypeList:"MsgTypeList",senderUserIDList:"SendUserIDList"},res:{GroupID:"groupID",UserID:"userID",Count:"messageCount",LastMsgTime:"lastMessageTime",ConversationMsgs:"searchResult",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer",MsgSeq:"sequence",ReqMsgSeq:"sequence",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgContent:"content",ClientSeq:"clientSequence",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(Gn.ADD_C2C_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.ADD_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(Gn.RM_C2C_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.RM_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(Gn.GET_C2C_MSG_REACTIONS,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.GET_C2C_MSG_REACTIONS)}),body:{from:void 0,to:void 0,messageKeyList:void 0,count:void 0}}),this._map.set(Gn.GET_C2C_MSG_REACTION_USER_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.GET_C2C_MSG_REACTION_USER_LIST)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,count:void 0}}),this._map.set(Gn.ADD_GRP_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.ADD_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(Gn.RM_GRP_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.RM_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(Gn.GET_GRP_MSG_REACTIONS,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.GET_GRP_MSG_REACTIONS)}),body:{groupID:void 0,topicID:void 0,messageSequenceList:void 0,count:void 0},keyMap:{res:{MsgSeq:"messageSequence"}}}),this._map.set(Gn.GET_GRP_MSG_REACTION_USER_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM_MSG_EXT,".").concat(Gn.GET_GRP_MSG_REACTION_USER_LIST)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,nextSeq:void 0,count:void 0}}),this._map.set(Gn.GET_C2C_PEER_READ_TIME,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.GET_C2C_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{req:{userIDList:"To_Account"},res:{ReadTime:"peerReadTimeList"}}}),this._map.set(Gn.PAGING_GET_CONV_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.PAGING_GET_CONV_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:15,assistFlag:31},keyMap:{req:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},res:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID",C2cRemark:"friendRemark",MsgRecvOption:"messageRemindType",GroupIgnoredUnreadSeqCount:"noUnreadCount",GroupNextMsgSeq:"nextMessageSeq"}}}),this._map.set(Gn.DEL_CONV,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.DEL_CONV)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{req:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},res:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}),this._map.set(Gn.CLEAR_HISTORY_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.CLEAR_HISTORY_MSG)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{req:{toGroupID:"ToGroupid"}}}),this._map.set(Gn.PIN_CONV,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.PIN_CONV)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{req:{itemList:"RecentContactItem"}}}),this._map.set(Gn.DEL_GROUP_AT_TIPS,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.DEL_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(Gn.SET_CONV_CUSTOM_DATA,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(Gn.MARK_CONV,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(Gn.CREATE_CONV_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.CREATE_CONV_GRP)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"GroupContactItem",groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(Gn.DEL_CONV_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.DEL_CONV_GRP)}),body:{fromAccount:"",groupName:void 0},keyMap:{res:{GroupId:"convGroupID"}}}),this._map.set(Gn.RENAME_CONV_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{req:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},res:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}),this._map.set(Gn.ADD_CONV_TO_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}}}),this._map.set(Gn.DEL_CONV_FROM_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0}}),this._map.set(Gn.GET_CONV_GRP_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.GET_CONV_GRP_LIST)}),body:{fromAccount:"",startIndex:void 0},keyMap:{res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}),this._map.set(Gn.SEARCH_CONV_GRP_MARK,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.RECENT_CONTACT,".").concat(Gn.SEARCH_CONV_GRP_MARK)}),body:{fromAccount:"",contactItem:void 0},keyMap:{req:{groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList",ContactResultItem:"contactItem"}}}),this._map.set(Gn.GET_USER_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.PROFILE,".").concat(Gn.GET_USER_PROFILE)}),body:{fromAccount:"",userItem:[]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(Gn.UPDATE_MY_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.PROFILE,".").concat(Gn.UPDATE_MY_PROFILE)}),body:{fromAccount:"",profileItem:[{tag:Ae.NICK,value:""},{tag:Ae.GENDER,value:""},{tag:Ae.ALLOWTYPE,value:""},{tag:Ae.AVATAR,value:""}]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(Gn.GET_BL,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.GET_BL)}),body:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0},keyMap:{res:{CurruentSequence:"currentSequence"}}}),this._map.set(Gn.ADD_TO_BL,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.ADD_TO_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(Gn.RM_FROM_BL,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.RM_FROM_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(Gn.SET_SELF_STATUS,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.SET_SELF_STATUS)}),body:{customStatus:""}}),this._map.set(Gn.GET_USER_STATUS,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}),this._map.set(Gn.SUB_USER_STATUS,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.SUB_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(Gn.UNSUB_USER_STATUS,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.UNSUB_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(Gn.GET_FD_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.GET_FD_LIST)}),body:{fromAccount:"",startIndex:0,standardSequence:0,customSequence:0},keyMap:{res:{FriendNum:"friendCount",UserDataItem:"resultList",ValueItem:"tagValueList"}}}),this._map.set(Gn.ADD_FD,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.ADD_FD)}),body:{fromAccount:"",addFriendItem:[],type:""},keyMap:{req:{source:"AddSource",wording:"AddWording",type:"AddType"},res:{ResultItem:"resultList"}}}),this._map.set(Gn.UPDATE_FD,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.UPDATE_FD)}),body:{fromAccount:"",updateItem:void 0},keyMap:{req:{snsItem:"SnsItem"},res:{ResultItem:"resultList"}}}),this._map.set(Gn.DEL_FD,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.DEL_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"DeleteType"},res:{ResultItem:"resultList"}}}),this._map.set(Gn.GET_FD_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.GET_FD_PROFILE)}),body:{fromAccount:"",userIDList:void 0},keyMap:{res:{InfoItem:"resultList",SnsProfileItem:"tagValueList"}}}),this._map.set(Gn.CHECK_FD,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.CHECK_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"CheckType"},res:{InfoItem:"resultList"}}}),this._map.set(Gn.GET_FD_APPLICATION_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.GET_FD_APPLICATION_LIST)}),body:{fromAccount:"",applicationType:"",startTime:0,maxLimited:0,lastSequence:0},keyMap:{res:{PendencyItem:"resultList",AddSource:"source",AddTime:"time",AddWording:"wording",Image:"avatar",UnreadPendencyCount:"unreadCount",To_Account:"userID",PendencyType:"type"}}}),this._map.set(Gn.RESPOND_FD_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.RESPOND_FD_APPLICATION)}),body:{fromAccount:"",responseFriendItem:[]},keyMap:{req:{tag:"TagName",action:"ResponseAction"},res:{ResultItem:"resultList"}}}),this._map.set(Gn.DEL_FD_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.DEL_FD_APPLICATION)}),body:{fromAccount:"",type:"",userIDList:void 0},keyMap:{req:{type:"PendencyType",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(Gn.REPORT_FD_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.REPORT_FD_APPLICATION)}),body:{fromAccount:"",latestTimeStamp:""},keyMap:{req:{latestTimeStamp:"LatestPendencyTimeStamp"}}}),this._map.set(Gn.CREATE_FD_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.CREATE_FD_GRP)}),body:{fromAccount:"",groupName:void 0,userIDList:void 0},keyMap:{req:{groupName:"GroupName",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(Gn.DEL_FD_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.DEL_FD_GRP)}),body:{fromAccount:"",nameList:void 0},keyMap:{req:{nameList:"GroupName"}}}),this._map.set(Gn.GET_FD_GRP_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.GET_FD_GRP_LIST)}),body:{fromAccount:"",lastSequence:0,needFriend:"Need_Friend_Type_Yes"},keyMap:{res:{ResultItem:"resultList",GroupName:"name",FriendNumber:"friendCount",To_Account:"userIDList"}}}),this._map.set(Gn.UPDATE_FD_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FD,".").concat(Gn.UPDATE_FD_GRP)}),body:{fromAccount:"",oldName:"",newName:void 0,updateGroupItem:void 0},keyMap:{req:{oldName:"GroupOldName",newName:"GroupNewName"},res:{UpdateType:"type",ResultItem:"resultList"}}}),this._map.set(Gn.GET_GRP_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_GRP_LIST)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0,needAppDefineData:1},keyMap:{req:{memberAccount:"Member_Account"},res:{GroupIdList:"groups",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime",AppDefinedData:"groupCustomField"}}}),this._map.set(Gn.GET_GRP_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_GRP_PROFILE)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:void 0,groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{req:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(Gn.CREATE_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.CREATE_GRP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{req:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},res:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}),this._map.set(Gn.DISMISS_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.DISMISS_GRP)}),body:{groupID:void 0}}),this._map.set(Gn.UPDATE_GRP_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.UPDATE_GRP_PROFILE)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{req:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},res:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(Gn.APPLY_JOIN_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{req:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},res:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}),this._map.set(Gn.APPLY_JOIN_GRP_NOAUTH,(e.a2,e.tinyid,{head:t(t({},h(e,hs)),{},{servcmd:"".concat(U.NAME.BIG_GRP_NO_AUTH,".").concat(Gn.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{req:{applyMessage:"ApplyMsg"},res:{HugeGroupFlag:"avChatRoomFlag"}}})),this._map.set(Gn.QUIT_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.QUIT_GRP)}),body:{groupID:void 0}}),this._map.set(Gn.SEARCH_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.SEARCH_GRP)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}}}),this._map.set(Gn.CHANGE_GRP_OWNER,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.CHANGE_GRP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{req:{newOwnerID:"NewOwner_Account"}}}),this._map.set(Gn.HANDLE_GRP_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.HANDLE_GRP_APPLICATION)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(Gn.HANDLE_INVITE_JOIN_GRP,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.HANDLE_INVITE_JOIN_GRP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}),this._map.set(Gn.HANDLE_GRP_INVITATION,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.HANDLE_GRP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(Gn.GET_GRP_PENDENCY,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_GRP_PENDENCY)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{req:{handleAccount:"Handle_Account"},res:{To_Account:"userID",ApplyInviteMsg:"note"}}}),this._map.set(Gn.DEL_GRP_SYSTEM_NOTICE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.DEL_GRP_SYSTEM_NOTICE)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(Gn.AV_POLLING,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.BIG_GRP_POLLING,".").concat(Gn.AV_POLLING)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}),this._map.set(Gn.AV_NOAUTH_POLLING,(e.a2,e.tinyid,{head:t(t({},h(e,gs)),{},{servcmd:"".concat(U.NAME.BIG_GRP_POLLING_NO_AUTH,".").concat(Gn.AV_POLLING)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}})),this._map.set(Gn.GET_ONLINE_MBR_NUM,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_ONLINE_MBR_NUM)}),body:{groupID:void 0},keyMap:{res:{OnlineMemberNum:"memberCount"}}}),this._map.set(Gn.SET_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.SET_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(Gn.MODIFY_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.MODIFY_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(Gn.DEL_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.DEL_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key"}}}),this._map.set(Gn.CLEAR_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.CLEAR_GRP_ATTR)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}),this._map.set(Gn.GET_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP_ATTR,".").concat(Gn.GET_GRP_ATTR)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{req:{avChatRoomKey:"Key",groupType:"GroupType"}}}),this._map.set(Gn.GET_GRP_NOTIFY,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_GRP_NOTIFY)}),body:{notifyReqList:[]},keyMap:{req:{notifyReqList:"NotifyReqList"},res:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList",NotifyRspList:"notifyRspList"}}}),this._map.set(Gn.UPDATE_GRP_COUNTER,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.UPDATE_GRP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{req:{counterList:"GroupCounter"}}}),this._map.set(Gn.GET_GRP_COUNTER,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_GRP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{req:{keyList:"GroupCounterKeys"}}}),this._map.set(Gn.CREATE_TOPIC,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP_COMMUNITY,".").concat(Gn.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{req:{avatar:"FaceUrl"}}}),this._map.set(Gn.DEL_TOPIC,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP_COMMUNITY,".").concat(Gn.DEL_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{req:{topicIDList:"TopicIdList"},res:{DestroyResultItem:"resultList"}}}),this._map.set(Gn.UPDATE_TOPIC_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP_COMMUNITY,".").concat(Gn.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{req:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}),this._map.set(Gn.GET_TOPIC_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP_COMMUNITY,".").concat(Gn.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{req:{topicIDList:"TopicIdList"},res:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence"}}}),this._map.set(Gn.GET_GRP_MBR_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_GRP_MBR_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}),this._map.set(Gn.GET_AV_MBR_LIST,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP_AV,".").concat(Gn.GET_AV_MBR_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{req:{offset:"Timestamp",filter:"Mark"},res:{NextTimestamp:"offset"}}}),this._map.set(Gn.GET_GRP_MBR_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.GET_GRP_MBR_PROFILE)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}),this._map.set(Gn.ADD_GRP_MBR,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.ADD_GRP_MBR)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{req:{userID:"Member_Account",userIDList:"MemberList"},res:{MemberList:"members"}}}),this._map.set(Gn.DEL_GRP_MBR,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.DEL_GRP_MBR)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{req:{userIDList:"MemberToDel_Account"}}}),this._map.set(Gn.BAN_AV_MBR,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.BAN_AV_MBR)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{req:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}),this._map.set(Gn.MODIFY_GRP_MBR_INFO,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP,".").concat(Gn.MODIFY_GRP_MBR_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{req:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}),this._map.set(Gn.MARK_AV_MBR_INFO,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.GRP_AV,".").concat(Gn.MARK_AV_MBR_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{req:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},res:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}),this._map.set(Gn.SSO_STAT,{head:t(t({},o),{},{servcmd:"".concat(U.NAME.IM_OPEN_STAT,".").concat(Gn.SSO_STAT)}),body:{header:{},event:[],quality:[]},keyMap:{req:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}),this._map.set(Gn.PING,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.HEARTBEAT,".").concat(Gn.PING)}),body:{}}),this._map.set(Gn.MSG_PUSH,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_PUSH,".").concat(Gn.MSG_PUSH)}),body:{},keyMap:{res:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}),this._map.set(Gn.MULTI_MSG_PUSH,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_PUSH,".").concat(Gn.MULTI_MSG_PUSH)}),body:{},keyMap:{res:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}),this._map.set(Gn.MSG_PUSH_ACK,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OPEN_IM,".").concat(Gn.MSG_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{req:{sessionData:"SessionData"}}}),this._map.set(Gn.STATUS_FORCE_OFFLINE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{res:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}),this._map.set(Gn.DOWNLOAD_MERGER_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_LONG_MSG,".").concat(Gn.DOWNLOAD_MERGER_MSG)}),body:{downloadKey:""},keyMap:{res:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}),this._map.set(Gn.UPLOAD_MERGER_MSG,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_LONG_MSG,".").concat(Gn.UPLOAD_MERGER_MSG)}),body:{messageList:[]},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}),this._map.set(Gn.FOLLOW,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FOLLOW,".").concat(Gn.FOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"FollowItem"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(Gn.UNFOLLOW,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FOLLOW,".").concat(Gn.UNFOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(Gn.GET_FOLLOW_INFO,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FOLLOW,".").concat(Gn.GET_FOLLOW_INFO)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{FollowInfo:"followInfoList",To_Account:"userID",FollowerCount:"followersCount",FollowingCount:"followingCount",MutualFollowingCount:"mutualFollowersCount"}}}),this._map.set(Gn.GET_FOLLOW,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FOLLOW,".").concat(Gn.GET_FOLLOW)}),body:{fromAccount:"",type:1,nextCursor:"",count:500},keyMap:{req:{type:"FollowType",nextCursor:"StartCursor",count:"WantNum"},res:{FollowItem:"resultList",To_Account:"userID",ProfileItem:"profileList"}}}),this._map.set(Gn.CHECK_FOLLOW_TYPE,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.FOLLOW,".").concat(Gn.CHECK_FOLLOW_TYPE)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(Gn.SET_TOKEN,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0,notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:""},keyMap:{req:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns",notificationStatus:"NotificationStatus",deviceModel:"DeviceModel",systemVersion:"SystemVersion",pushVersion:"PushPluginVersion"}}}),this._map.set(Gn.STAT_FOREGROUND,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.STAT_FOREGROUND)}),body:{isWebUniapp:0}}),this._map.set(Gn.STAT_BACKGROUND,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_OPEN_STATUS,".").concat(Gn.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{req:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}),this._map.set(Gn.PUSH_REPORT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.OFFLINE_PUSH_REPORT,".").concat(Gn.PUSH_REPORT)}),body:{eventList:[]},keyMap:{req:{eventList:"UinappPushEvents",type:"EventType",time:"EventTime",pushId:"ClickExt"}}}),this._map.set(Gn.SET_ALL_RECEIVE_MSG_OPT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_MSG_LOGIC,".").concat(Gn.SET_ALL_RECEIVE_MSG_OPT)}),body:{startTime:0,endTime:0,isRepeated:0,messageRemindType:0},keyMap:{req:{messageRemindType:"Level"}}}),this._map.set(Gn.GET_ALL_RECEIVE_MSG_OPT,{head:t(t({},e),{},{servcmd:"".concat(U.NAME.IM_MSG_LOGIC,".").concat(Gn.GET_ALL_RECEIVE_MSG_OPT)}),body:{toAccount:void 0}})}},{key:"has",value:function(e){return this._map.has(e)}},{key:"get",value:function(e){return this._map.get(e)}},{key:"update",value:function(){this._fillMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(Le.w("".concat(this._n,".getKeyMap unknown P:").concat(e)),{})}},{key:"getProtocolData",value:function(e){var t=e.P,n=e.data;if(e=this.get(t),t=null,n){var o,a=this._simpleDeepCopy(e),i=(a=this._updateService(n,a)).body,s=Object.create(null);for(o in i)if(Object.prototype.hasOwnProperty.call(i,o)){if(s[o]=i[o],void 0===n[o])continue;s[o]=n[o]}a.body=s,t=this._getUplinkData(a)}else t=this._getUplinkData(e);return t}},{key:"_getUplinkData",value:function(e){var t=At((e=this._dataCleaner(e)).head);return t=Qi(e.body,this._getReqKeyMap(t)),e.body=t,e}},{key:"_updateService",value:function(e,t){var n,o,a=At(t.head);return this._isFromGroupRequest(t)&&(n=e.type,o=e.groupID,e=void 0===(e=e.groupIDList)?[]:e,ut(o=void 0===o?void 0:o)&&(o=e[0]||""),Et({type:n,groupID:o}))&&(t.head.servcmd="".concat(U.NAME.GRP_COMMUNITY,".").concat(a)),t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(U.NAME.GRP)||e.head.servcmd.includes(U.NAME.GRP_ATTR)}},{key:"_getReqKeyMap",value:function(e){return e=this.getKeyMap(e),t(t({},qi.req),e.req)}},{key:"_dataCleaner",value:function(e){var t,o=Array.isArray(e)?[]:Object.create(null);for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&Ze(t)&&null!==e[t]&&void 0!==e[t]&&("object"!==n(e[t])?o[t]=e[t]:o[t]=this._dataCleaner.bind(this)(e[t]));return o}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),o={},a=0,i=n.length;a<i;a++)We(e[t=n[a]])?o[t]=Array.from(e[t]):$e(e[t])?o[t]=this._simpleDeepCopy(e[t]):o[t]=e[t];return o}}]),Ts),fs=[Gn.MSG_PUSH_ACK],vs=(i(ks,[{key:"_onC2CMsgArray",value:function(e){var t=this._sessionM.get(6);e.dataList.forEach((function(e){var t;1===e.isSyncMessage&&(t=e.from,e.from=e.to,e.to=t)})),1===e.needSync&&this._sessionM.get(19).syncOnNeed(),t.onNewMessage({dataList:e.dataList,isInstantMessage:!0})}},{key:"_onC2CMsgModified",value:function(e){this._sessionM.get(6).onMsgModified(e)}},{key:"_onGroupMsgArray",value:function(e){var t=this._sessionM.get(7);t&&t.onNewMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_onGroupMsgModified",value:function(e){var t=this._sessionM.get(7);t&&t.onMsgModified(e)}},{key:"_onGroupTips",value:function(e){var t=this._sessionM.get(7);if(t){var n=e.event,o=e.dataList,a=e.isInstantMessage,i=void 0===a||a,s=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:o});break;case 5:for(var r=0;r<o.length;r++)if(We(o[r].elements.revokedInfos))t.onMsgRevoked({dataList:o});else if(We(o[r].elements.groupMessageReadNotice))t.onMsgReadNotice({dataList:o});else{if(!We(o[r].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:o,isInstantMessage:i,isSyncingEnded:s});break}t.onReadReceiptList({dataList:o})}break;case 12:this._sessionM.get(11).onNewGroupAtTips({dataList:o});break;default:Le.l("".concat(this._n,"._onGroupTips unknown event:").concat(n," dataList:"),o)}}}},{key:"_onC2CNotifyMsgArray",value:function(e){var t,n=this,o=e.dataList;We(o)&&(t=this._sessionM.get(6),o.forEach((function(e){var a,i;Ye(e)&&(e.hasOwnProperty("kickoutMsgNotify")?(a=(i=e.kickoutMsgNotify).kickType,i=void 0===(i=i.newInstanceInfo)?{}:i,1===a?n._sessionM.onMultipleAccountKickedOut(i):2===a?n._sessionM.onMultipleDeviceKickedOut(i):3===a&&n._sessionM.onRestApiKickedOut(i)):e.hasOwnProperty("c2cMessageRevokedNotify")?t&&t.onMsgRevoked({dataList:o}):e.hasOwnProperty("c2cMessageReadReceipt")?t&&t.onMsgReadReceipt({dataList:o}):e.hasOwnProperty("c2cMessageReadNotice")?t&&t.onMsgReadNotice({dataList:o}):e.hasOwnProperty("muteNotificationsSync")&&n._sessionM.get(11).onC2CMsgRemindTypeSynced({dataList:o}))})))}},{key:"_onC2CReadReceiptArray",value:function(e){this._sessionM.get(6).onReadReceiptList(e)}},{key:"_onProfileModified",value:function(e){this._sessionM.get(4).onProfileModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_onRelationChainModified",value:function(e){this._sessionM.get(4).onRelationChainModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_onRecentContact",value:function(e){var t;We(e=e.dataList)&&(t=this._sessionM.get(11))&&e.forEach((function(e){var n,o,a=e.pushType;1===a?(n=e.recentContactDeleteItem,t.onConvDeleted(n.recentContactList)):2===a?(n=e.recentContactTopItem,t.onConvPinnedStatus(n.recentContactList,!0)):3===a?(n=e.recentContactTopItem,t.onConvPinnedStatus(n.recentContactList,!1)):4===a?(n=e.recentContactMarkContact,t.onConvMarkUpdated(n.recentContactMarkContactItem)):5===a?(n=e.recentContactCreateContactGroup,t.onConvGroupCreated(n.msgContactGroupContactItem)):6===a?(n=e.recentContactDelContactGroup,t.onConvGroupDeleted(n.msgGroupItem)):7===a&&(a=(n=e.recentContactUpdateContactGroup).updateType,e=n.msgUpdateGroup,n=n.msgUpdateContact,1===a?1===(o=e.updateGroupType)?t.onConvGroupNameUpdated(e):2===o&&t.onConvInGroupUpdated(e):2===a&&t.onConvAddedToOrDeletedFromGroup(n))}))}},{key:"_onAllMsgRead",value:function(e){e=e.dataList;var t=this._sessionM.get(11);t&&t.onPushedAllMessageRead(e)}},{key:"_onUserStatusList",value:function(e){this._sessionM.get(4).onUserStatusUpdated(e)}},{key:"_onMsgExtNotify",value:function(e){this._sessionM.get(3).onMsgExtNotify(e)}},{key:"_onMsgReactionNotifyList",value:function(e){this._sessionM.get(34).onReactionNotifyList(e)}},{key:"_onMsgReactionNotify",value:function(e){this._sessionM.get(34).onReactionNotify(e)}},{key:"_onFollowNotify",value:function(e){this._sessionM.get(35).onFollowNotify(e)}},{key:"_onTopicLatestMsg",value:function(e){this._sessionM.get(10).onTopicLatestMsg(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMsgFromIMOpenPush(e)){var o,a=n.eventArray,i=n.isInstantMessage,s=n.isSyncingEnded,r=n.needSync;if(We(a))for(var c,l,u,d=0,p=a.length;d<p;d++)100!==(u=(c=a[d]).event)?24!==u?26!==u?(o=Object.keys(c).find((function(e){return-1!==t._keys.indexOf(e)})))?(l=14===u?{readAllC2CMessage:c[o],groupMessageReadInfoList:c.groupMessageReadNotice||[]}:16===u?{userID:c.userID,timestamp:c.timestamp,readReceiptList:c[o]}:c[o],this._eventHandlerMap.get(o)({event:u,dataList:l,isInstantMessage:i,isSyncingEnded:s,needSync:r})):Le.l("".concat(this._n,".onMessage unknown eventItem:"),c):this._onTopicLatestMsg(c):this._onAllRcvMsgOptNotify(c):this._onRoomCustomData(c.content)}}},{key:"_onRoomCustomData",value:function(e){this._sessionM.get(30).onRoomCustomDataReceived(e),Le.l("".concat(this._n,"._onRoomCustomData data:").concat(e))}},{key:"_onAllRcvMsgOptNotify",value:function(e){this._sessionM.get(11).onAllRcvMsgOptNotify(e)}},{key:"_filterMsgFromIMOpenPush",value:function(e){var t=e.head,n=(e=e.body,t=t.servcmd,!1);return!(n=ut(t)?n:t.includes(U.NAME.IM_CONFIG_MANAGER)||t.includes(U.NAME.OVERLOAD_PUSH)||t.includes(U.NAME.STAT_SERVICE))||(t.includes(Gn.PUSHED_CLOUD_CTRL_CONFIG)?this._sessionM.get(23).onPushedConfig(e):t.includes(Gn.PUSHED_COMMERCIAL_CONFIG)?this._sessionM.get(27).onPushedConfig(e):t.includes(Gn.OVERLOAD_NOTIFY)?this._sessionM.onPushedServerOverload(e):t.includes(Gn.KICK_OTHER)&&(n=Date.now(),this._sessionM.reLoginOnKickOther(),e=new Zn("kickOther"),n-=t=this._sessionM.get(1).getLastWsHelloTs(),e.setMessage("last wshello time:".concat(t," diff:").concat(n,"ms")).end()),!1)}}]),ks),_s=[{cmd:Gn.GET_GRP_PROFILE,interval:1,count:8},{cmd:Gn.UPDATE_GRP_PROFILE,interval:1,count:8},{cmd:Gn.GET_AV_MBR_LIST,interval:3,count:1},{cmd:Gn.GET_GRP_PENDENCY,interval:1,count:15},{cmd:Gn.GET_TOPIC_LIST,interval:1,count:10},{cmd:Gn.SET_GRP_ATTR,interval:5,count:10},{cmd:Gn.MODIFY_GRP_ATTR,interval:5,count:10},{cmd:Gn.DEL_GRP_ATTR,interval:5,count:10},{cmd:Gn.CLEAR_GRP_ATTR,interval:5,count:10},{cmd:Gn.GET_GRP_ATTR,interval:5,count:20},{cmd:Gn.UPDATE_GRP_COUNTER,interval:5,count:20},{cmd:Gn.GET_GRP_COUNTER,interval:5,count:20},{cmd:Gn.SET_ALL_MSG_READ,interval:1,count:1},{cmd:Gn.GET_USER_STATUS,interval:5,count:20},{cmd:Gn.SUB_USER_STATUS,interval:5,count:20},{cmd:Gn.UNSUB_USER_STATUS,interval:5,count:20},{cmd:Gn.MSG_CLOUD_SEARCH,interval:1,count:2},{cmd:Gn.CHECK_FOLLOW_TYPE,interval:5,count:20},{cmd:Gn.GET_GRP_ROAMING_MSG,interval:1,count:20},{cmd:Gn.GET_C2C_ROAMING_MSG,interval:1,count:20}],ys=new Map,Is=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],Es=0,Cs=Is.length;Es<Cs;Es++)ys.set(Es,Is[Es]);function ks(e){o(this,ks),this._sessionM=e,this._n="MsgDispatcher",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._onC2CMsgArray.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._onGroupMsgArray.bind(this)),this._eventHandlerMap.set("groupTips",this._onGroupTips.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._onC2CNotifyMsgArray.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._onC2CReadReceiptArray.bind(this)),this._eventHandlerMap.set("profileModify",this._onProfileModified.bind(this)),this._eventHandlerMap.set("friendListMod",this._onRelationChainModified.bind(this)),this._eventHandlerMap.set("recentContactMod",this._onRecentContact.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._onAllMsgRead.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._onC2CMsgModified.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._onGroupMsgModified.bind(this)),this._eventHandlerMap.set("userStatusList",this._onUserStatusList.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._onMsgExtNotify.bind(this)),this._eventHandlerMap.set("messageReactionNotifyList",this._onMsgReactionNotifyList.bind(this)),this._eventHandlerMap.set("messageReactionNotify",this._onMsgReactionNotify.bind(this)),this._eventHandlerMap.set("followChangeList",this._onFollowNotify.bind(this)),this._keys=v(this._eventHandlerMap.keys())}function Ts(e){o(this,Ts),this._n="PHandler",this._sessionM=e,this._map=new Map,this._fillMap()}function Ms(e){return o(this,Ms),(e=es.call(this,e))._n="ChannelModule",e._socketHandler=new us(g(e)),e._probing=!1,e._isAppShowing=!0,e._previousState=S.NET_STATE_CONNECTED,e._timerForNotLoggedIn=-1,e._timerForNotLoggedIn=setInterval(e.onCheckTimer.bind(g(e)),1e3),e._fatalErrorFlag=!1,e._disconnectedTS=0,e._lastDiagnoseTS=0,e}function Ss(e){o(this,Ss),this._chM=e,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=ls,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=ot(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._currentSite=O,this._setWebsocketHost(),this._initConnection()}function Ds(e){o(this,Ds);var t,n,a=(this._handler=e).getURL();this._socket=null,this._workerSocket=null,this._id=ot(),this._handler.getIsWorkerEnabled()?(t=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen", extensions: _socket.extensions });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"})),this._workerSocket=new Worker(t),(n=this)._workerSocket.onmessage=function(e){var t=(a=e.data).callback,o=a.e,a=a.extensions;"onOpen"===t?n._onOpen(a):"onClose"===t?n._onClose(o):"onError"===t?n._onError(o):"onMessage"===t&&n._onMessage(e.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:a})):Q?Y?(oe.connectSocket({url:a,header:{"content-type":"application/json"}}),oe.onSocketClose(this._onClose.bind(this)),oe.onSocketOpen(this._onOpen.bind(this)),oe.onSocketMessage(this._onMessage.bind(this)),oe.onSocketError(this._onError.bind(this))):(this._socket=oe.connectSocket({url:a,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):(this._socket=new WebSocket(a),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this,this._socket.extensions),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this)),this._canIUseBinaryFrame=e.canIUseBinaryFrame()}function bs(e){for(var t,n,o=e,a="",i=0,s=(o=e.length%8!=0?"0".repeat(8-e.length%8)+e:o).length;i<s;i+=8)t=parseInt(o.slice(i,i+4),2),n=parseInt(o.slice(i+4,i+8),2),a+=ys.get(t)+ys.get(n);return a}function ws(e){var t;return e<0||53<e?NaN:(t=0|1073741824*Math.random(),30<e?t+1073741824*(0|Math.random()*(1<<e-30)):t>>>30-e)}function Ns(e,t){for(var n=e.toString(16),o=t-n.length,a="0";0<o;o>>>=1,a+=a)1&o&&(n=a+n);return n}r(Yr,Nn),Fs=m(Yr),i(Yr,[{key:"_init",value:function(){this._updateCmdFreqLimitMap(_s)}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");ut(e)||(e=JSON.parse(e),this._updateCmdFreqLimitMap(e))}},{key:"_updateCmdFreqLimitMap",value:function(e){var t=this;e.forEach((function(e){t._cmdFreqLimitMap.set(e.cmd,{interval:e.interval,count:e.count})}))}},{key:"updateProtocolConfig",value:function(){this._pHandler.update()}},{key:"req",value:function(e){Le.d("".concat(this._n,".req options:"),e);var t,n,o=e.P;return this._pHandler.has(o)?(t=(e=this.getProtocolData(e)).head.servcmd,this._isFreqOverLimit(t)?In({code:n=Un.OVER_FREQUENCY_LIMIT,message:this.getErrMsg(n,this._getCmd(t))}):this._isServerOverload(t)?In({code:n=Un.OPEN_SERVICE_OVERLOAD_ERROR,message:this.getErrMsg(n,this._getCmd(t))}):(n=this.get(21),fs.includes(o)?n.simplySend(e):n.send(e))):(Le.w("".concat(this._n,".req unknown P:").concat(o)),In({code:Un.NO_PROTOCOL}))}},{key:"getKeyMap",value:function(e){return this._pHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:A,websdkversion:R,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:12775283,sdkability_ext:bs(""),cappid:e.getApplicationID()}}},{key:"genCosSpecifiedHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:A,websdkversion:R,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:12775283,sdkability_ext:bs(""),cappid:e.getApplicationID()}}},{key:"genSSOReportHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:A,websdkversion:R,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:12775283,sdkability_ext:bs(""),cappid:e.getApplicationID()}}},{key:"getProtocolData",value:function(e){return this._pHandler.getProtocolData(e)}},{key:"trans",value:function(e){var n=e.servcmd;return e=e.data,n={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:e},this.get(21).send(n)}},{key:"sendComboMessage",value:function(e){var n=e.servcmd;return e=e.data,n={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:e},this.get(21).send(n)}},{key:"onErrorCodeNotZero",value:function(e){var t,n=e.errorCode;n===Un.HELLO_ANSWER_KICKED_OUT&&(t=e.kickType,e=void 0===(e=e.newInstanceInfo)?{}:e,1===t?this.onMultipleAccountKickedOut(e):2===t?this.onMultipleDeviceKickedOut(e):3===t&&this.onRestApiKickedOut(e)),n!==Un.MSG_A2KEY_EXPIRED&&n!==Un.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.get(21).reConnect())}},{key:"onMessage",value:function(e){var t=(n=e.body).needAck,n=n.sessionData;1===(void 0===t?0:t)&&this._sendACK(n),this._msgDispatcher.onMessage(e)}},{key:"onReconnected",value:function(e){this._incrementalPullContactFlag=e<=300,this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){Le.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){Le.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e,t,n,o=this,a="".concat(this._n,"._reLogin");this.isLoggedIn()&&(e=0,(t=this.get(1).getPushModule())&&(e=t.getUniAppPlatform()),n=new Zn("reLogin"),this.req({P:Gn.LOGIN,data:{isWebUniapp:e,customInfo:this.get(12).getCustomLoginInfo()}}).then((function(e){var t=(e=e.data).instanceID,i=(e=e.customStatus,o.get(12)),s=Ko(e),r=(i.setStatusInstanceID(t),o.get(21)),c=r.getSocketID();c="socketID:".concat(c," instanceID:").concat(t," customStatus:").concat(s),n.setMessage(c).end(!0),Le.l("".concat(a," ok. ").concat(c)),i.getCustomStatus()!==s&&o.get(4).onUserStatusUpdated({dataList:[{to:o.getMyUserID(),statusType:S.USER_STATUS_ONLINE,customStatus:e}]}),r.diagnose(),o.get(11).syncConvList(o._incrementalPullContactFlag).then((function(){Le.l("".concat(a,", sync conv list ok.")),o.get(25).start()})),((t=o.get(7))&&t.updateLocalMainSequenceOnReconnected(),c=o.get(10)).resetGetTopicTime(),c.getTopicListOnReconnected(),(i=o.get(35))&&i.clearCacheOnReconnected()})))}},{key:"onMultipleAccountKickedOut",value:function(e){this.get(1).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.get(1).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.get(1).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.get(1).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.req({P:Gn.MSG_PUSH_ACK,data:{sessionData:e}})}},{key:"_isFreqOverLimit",value:function(e){var t,n,o,a;return e=e.split(".")[1],!!this._cmdFreqLimitMap.has(e)&&(!this._cmdReqInfoMap.has(e)||(t=(n=this._cmdFreqLimitMap.get(e)).count,n=n.interval,o=(a=this._cmdReqInfoMap.get(e)).startTime,a=a.requestCount,Date.now()-o>1e3*n)?(this._cmdReqInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1):(this._cmdReqInfoMap.set(e,{startTime:o,requestCount:a+=1}),t<a))}},{key:"_isServerOverload",value:function(e){var t,n;return!!this._serverOverloadInfoMap.has(e)&&(t=(n=this._serverOverloadInfoMap.get(e)).overloadTime,n=n.waitingTime,Date.now()-t<=1e3*n||(this._serverOverloadInfoMap.delete(e),!1))}},{key:"_getCmd",value:function(e){var t="";if(e.includes(".")){var n,o=e.split(".")[1];for(n in Gn)if(Gn[n]===o){t=n;break}}return t}},{key:"onPushedServerOverload",value:function(e){var t=e.overloadCommand;e=e.waitingTime,this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:e}),Le.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(e,"s cmd:").concat(this._getCmd(t)))}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._updateCmdFreqLimitMap(_s),this._cmdReqInfoMap.clear(),this._serverOverloadInfoMap.clear(),this._incrementalPullContactFlag=!0}}]);var Ls,Rs,As,Os,Us,Ps,Gs,xs,Bs,Vs,Fs,Hs=Yr,js=(r($r,Nn),Vs=m($r),i($r,[{key:"getCloudConfig",value:function(e){return ut(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"getServerConfig",value:function(e){var t={code:0,data:""};return!ut(e)&&this._cloudConfig.has(e)&&(t.data=this._cloudConfig.get(e)),Promise.resolve(t)}},{key:"_canFetch",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e,t=this,n="".concat(this._n,".fetchConfig"),o=this._canFetch();Le.l("".concat(n," canFetch:").concat(o)),o&&(e=new Zn("fetchCloudCtrlConfig"),o=this.get(12).getSDKAppID(),this._isFetching=!0,this.req({P:Gn.FETCH_CLOUD_CTRL_CONFIG,data:{SDKAppID:o,version:this._version}}).then((function(o){t._isFetching=!1;var a=(i=o.data).version,i=i.cloudControlConfig;e.setMessage("version:".concat(t._version," newVersion:").concat(a," config:").concat(i)).end(),Le.l("".concat(n," ok")),t._parse(o.data)})).catch((function(o){t._isFetching=!1,e.setError(o).end(),Le.l("".concat(n," failed. error:"),o),t._setExpiredTime(12e4)})))}},{key:"onPushedConfig",value:function(e){Le.l("".concat(this._n,".onPushedConfig config:"),e),new Zn("pushedCloudCtrlConfig").setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parse(e)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"_parse",value:function(e){var t=this,n="".concat(this._n,"._parse"),o=e.errorCode,a=e.errorMessage,i=e.cloudControlConfig,s=e.version,r=e.expiredTime;if(0===o){if(this._version!==s){var c=null;try{c=JSON.parse(i)}catch(l){this.isPrivateNetWork()||Le.e("".concat(n," failed. config:"),i)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach((function(e){t._cloudConfig.set(e,c[e])})),this._version=s,this.emitIEvt(Bo.CLOUD_CONFIG))}this._setExpiredTime(1e3*r)}else ut(o)?(Le.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTime(36e5)):(Le.e("".concat(n," errorCode:").concat(o," errorMessage:").concat(a)),this._setExpiredTime(12e4))}},{key:"_setExpiredTime",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),$r),qs=(r(Kr,Nn),Bs=m(Kr),i(Kr,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n,o,a=this,i=this._getLocalConvList().filter((function(e){return e.type===S.CONV_GROUP&&e.groupProfile.type!==S.GRP_AVCHATROOM})),s=this.get(11),r=[];i.forEach((function(i){var c=i.conversationID;i=i.lastMessage,e=c.replace(S.CONV_GROUP,""),t=s.getLocalLastMessage(c),i&&0!==i.lastSequence&&t&&(n=i.lastSequence,t=t.sequence,o=n-t,0<t)&&1<=o&&o<300?a._recoverGroupMsg({groupID:e,localLastMessageSequence:t,remoteLastMessageSequence:n}):r.push(e)})),this._getGroupNotice(r)}},{key:"_recoverC2CChat",value:function(){var e,t,n,o=this,a=this._getLocalConvList().filter((function(e){return e.type===S.CONV_C2C})),i=this.get(11),s=[Promise.resolve()];a.forEach((function(a){var r=a.conversationID;a=a.lastMessage,e=i.getLocalLastMessage(r),a&&0!==a.lastTime&&e&&(t=a.lastTime,e=e.time,n=t-e,0<e)&&1<=n&&n<=600&&s.push(o._recoverC2CMsg({conversationID:r,localLastMessageTime:e,remoteLastMessageTime:t}))})),Promise.all(s).then((function(){Le.l("".concat(o._n,"._recoverC2CChat all done")),o.get(19).syncOnReconnected()}))}},{key:"_getLocalConvList",value:function(){return this.get(11).getLocalConvList()}},{key:"_recoverGroupMsg",value:function(e){var t=this,n="".concat(this._n,".").concat("_recoverGroupMsg"),o=(Le.l("".concat(n," options:"),e),e.groupID),a=e.localLastMessageSequence,i=e.remoteLastMessageSequence,s=JSON.stringify(e),r=new Zn("_recoverGroupMsg");r.setMessage(s),this._getGroupRoamingMsg({groupID:o,sequence:a}).then((function(e){var c=(e=e.data).complete,l=e.messageList;if(!ut(l)){e=l[0].sequence;var u=l.map((function(e){return e.sequence})),d=(u="".concat(s," complete:").concat(c," sequenceList:").concat(u),Le.l("".concat(n," ").concat(u)),e!==a&&e<i&&2!==c&&t._recoverGroupMsg({groupID:o,localLastMessageSequence:e,remoteLastMessageSequence:i}),r.setMessage(u).end(),t.get(7));1<l.length&&l.sort((function(e,t){return e.sequence-t.sequence}));for(var p=!1,h=0,g=l.length;h<g;h++)if(l[h].from===S.CONV_SYSTEM){p=!0;break}if(p)for(var m=0,f=l.length;m<f;m++){var v=l[m];v.from!==S.CONV_SYSTEM?d.onNewMessage({dataList:[v],isInstantMessage:!1,updateUnreadCount:!1}):d.onNewGroupTips({event:v.event,dataList:[v]})}else d.onNewMessage({dataList:l,isInstantMessage:!1,updateUnreadCount:!1})}})).catch((function(e){r.setError(e).end(),Le.w("".concat(n," failed. error:"),e)}))}},{key:"_getGroupNotice",value:function(e){var t=e.length;if(Le.l("".concat(this._n,"._getGroupNotice length:").concat(t)),0!==t){var n=this.get(7);if(t<=10)n.getNotice(e);else{var o=Math.floor(t/10);5<=o&&(o=5);for(var a=0;a<=o;a++)n.getNotice(e.slice(10*a,10*(a+1)))}}}},{key:"_getGroupRoamingMsg",value:function(e){var t=e.groupID;return e=e.sequence,this.req({P:Gn.GET_GRP_ROAMING_MSG,data:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:e+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMsg",value:function(e){var t=this,n="".concat(this._n,".").concat("_recoverC2CMsg"),o=(Le.l("".concat(n," options:"),e),e.conversationID),a=e.localLastMessageTime,i=e.remoteLastMessageTime,s=JSON.stringify(e),r=new Zn("_recoverC2CMsg");return r.setMessage(s),this._getC2CRoamingMsg({conversationID:o,time:a}).then((function(e){var a=(e=e.data).complete;if(e=e.messageList,!ut(e)){var c=e.length;if(t.get(6).onNewMessage({dataList:e,isInstantMessage:!0}),c=e[c-1].time,e=e.map((function(e){return e.random})),e="".concat(s," complete:").concat(a," randomList:").concat(e),Le.l("".concat(n," ").concat(e)),r.setMessage(e).end(),c<i&&1!==a)return t._recoverC2CMsg({conversationID:o,localLastMessageTime:c,remoteLastMessageTime:i})}})).catch((function(e){r.setError(e).end(),Le.w("".concat(n," failed. error:"),e)}))}},{key:"_getC2CRoamingMsg",value:function(e){var t=e.conversationID;return e=e.time,this.req({P:Gn.GET_C2C_ROAMING_MSG,data:{peerAccount:t.replace(S.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:e,direction:1}})}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),Kr),zs=(i(zr,[{key:"addMessageDelay",value:function(e){0<=(e=Te()-e)&&this._e2eDelayArray.push(e)}},{key:"_calcAvg",value:function(e,t){var n;return 0===t?0:(n=0,e.forEach((function(e){n+=e})),Ot(n/t,1))}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,o=e.max;return t.filter((function(e){return n<=e&&e<o})).length}},{key:"_calcPercent",value:function(e,t){return 100<(e=Ot(e/t*100,2))?100:e}},{key:"_checkE2EDelayException",value:function(e,t){var n,o,a,i=e.filter((function(e){return t<e}));0<i.length&&(n=i.length,o=Math.min.apply(Math,v(i)),a=Math.max.apply(Math,v(i)),i=this._calcAvg(i,n),50<(e=Ot(n/e.length*100,2)))&&new Zn("messageE2EDelayException").setMessage("count:".concat(n," min:").concat(o," max:").concat(a," avg:").concat(i," percent:").concat(e)).setLevel("warning").end()}},{key:"getStatResult",value:function(){var e,t,n,o,a,i,s=this._e2eDelayArray.length;return 0===s?null:(e=v(this._e2eDelayArray),t=this._calcCountWithLimit({e2eDelayArray:e,min:0,max:1}),n=this._calcCountWithLimit({e2eDelayArray:e,min:1,max:3}),o=this._calcPercent(t,s),a=this._calcPercent(n,s),i=this._calcAvg(e,s),this._checkE2EDelayException(e,3),e.length=0,this.reset(),{totalCount:s,countLessThan1Second:t,percentOfCountLessThan1Second:o,countLessThan3Second:n,percentOfCountLessThan3Second:a,avgDelay:i})}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),zr),Ks=(i(qr,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){return 0===t?0:100<(e=Ot(e/t*100,2))?100:e}},{key:"_calcAvg",value:function(e,t){var n;return 0===t?0:(n=0,e.forEach((function(e){n+=e})),parseInt(n/t))}},{key:"_calcMax",value:function(){return Math.max.apply(Math,v(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,v(this._rttArray))}},{key:"getStatResult",value:function(){var e,t,n=this._calcTotalCount(),o=v(this._rttArray);return 0===n?null:(e=this._calcRTTCount(o),t=this._calcSuccessRateOfRequest(e,n),o=this._calcAvg(o,e),Le.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(o)),this.reset(),{totalCount:n,rttCount:e,successRateOfRequest:t,avgRTT:o})}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),qr),$s=(i(jr,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}))}},{key:"addTotalCount",value:function(e){return!(ut(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(ut(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(e){return!(ut(e)||!this._map.has(e)||(this._map.get(e).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(e,t){return!(ut(e)||!this._map.has(e)||(this._map.get(e).costArray.push(t),0))}},{key:"addFileSize",value:function(e,t){return!(ut(e)||!this._map.has(e)||(this._map.get(e).fileSizeArray.push(t),0))}},{key:"_calcSuccessRateOfBusiness",value:function(e){return ut(e)||!this._map.has(e)?-1:100<(e=Ot((e=this._map.get(e)).successCount/e.totalCount*100,2))?100:e}},{key:"_calcSuccessRateOfPlatform",value:function(e){var t;return ut(e)||!this._map.has(e)?-1:(t=this._map.get(e),100<(e=Ot(e=this._calcSuccessCountOfPlatform(e)/t.totalCount*100,2))?100:e)}},{key:"_calcTotalCount",value:function(e){return ut(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return ut(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){return ut(e)||!this._map.has(e)?-1:(e=this._map.get(e)).successCount+e.failedCountOfUserSide}},{key:"_calcAvg",value:function(e){return ut(e)||!this._map.has(e)?-1:e===qn?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t,n=this._map.get(e).costArray.length;return 0===n?0:(t=0,this._map.get(e).costArray.forEach((function(e){t+=e})),parseInt(t/n))}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach((function(e){t+=e})),this._map.get(e).fileSizeArray.forEach((function(e){n+=e})),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t,n,o,a,i,s=this._calcTotalCount(e);return 0===s?null:(t=this._calcSuccessCountOfBusiness(e),n=this._calcSuccessRateOfBusiness(e),o=this._calcSuccessCountOfPlatform(e),a=this._calcSuccessRateOfPlatform(e),i=this._calcAvg(e),this.reset(e),{totalCount:s,successCountOfBusiness:t,successRateOfBusiness:n,successCountOfPlatform:o,successRateOfPlatform:a,avgValue:i})}},{key:"reset",value:function(e){ut(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),jr),Ys=(i(Hr,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._lastMap.set(e,new Map),t._currentMap.set(e,new Map)}))}},{key:"addMessageSequence",value:function(e){var t,n,o,a=e.key,i=e.message;return!(ut(a)||!this._lastMap.has(a)||!this._currentMap.has(a)||(t=i.conversationID,i=i.sequence,t=t.replace(S.CONV_GROUP,""),0!==this._lastMap.get(a).size&&this._lastMap.get(a).has(t)&&(o=(n=this._lastMap.get(a).get(t)).length-1,i>n[0])&&i<n[o]?(n.push(i),n.sort(),this._lastMap.get(a).set(t,n)):this._addCurrentMap(e),0))}},{key:"_addCurrentMap",value:function(e){var t=e.key,n=(e=e.message).conversationID;e=e.sequence,n=n.replace(S.CONV_GROUP,""),this._currentMap.get(t).has(n)||this._currentMap.get(t).set(n,[]),this._currentMap.get(t).get(n).push(e)}},{key:"_copyData",value:function(e){if(!ut(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),o=T(this._currentMap.get(e));try{for(o.s();!(t=o.n()).done;){var a=f(t.value,2),i=a[0],s=a[1];n.set(i,s)}}catch(r){o.e(r)}finally{o.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){var t,n,o;return ut(this._currentMap.get(e))||ut(this._lastMap.get(e))?null:0===this._lastMap.get(e).size?(this._copyData(e),null):(n=t=0,this._lastMap.get(e).forEach((function(e,o){var a=(e=v(e.values())).length;e=e[a-1]-e[0]+1,t+=e,n+=a})),0===t?null:(100<(o=Ot(n/t*100,2))&&(o=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:o}))}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),Hr),Ws=(r(Fr,Nn),xs=m(Fr),i(Fr,[{key:"_onLoginSuccess",value:function(){var e=this,t=(this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems),this.get(13)),n=t.getItem(this.TAG,!1);!He(n)&&Je(n.forEach)&&(Le.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach((function(t){e._statInfoArr.push(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");ut(e)||(this.REPORT_INTERVAL=Number(e)),ut(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map((function(e){return Number(e)}))),ut(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||Le.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||Le.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||Le.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||Le.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||Le.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||Le.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var n={},o=Jn[this.get(15).getNetworkType()];switch(ut(o)&&(o=8),o={qualityType:Yn[e],timestamp:De(),networkType:o,extension:""},e){case xn:n=this._avgRTT.getStatResult();break;case Bn:n=this._avgE2EDelay.getStatResult();break;case Vn:case Fn:case Hn:case jn:case qn:n=this._rateMessageSent.getStatResult(e);break;case zn:case Kn:case $n:n=this._rateMessageReceived.getStatResult(e)}return null===n?null:t(t({},o),n)}},{key:"_report",value:function(e){var t=this,n=[],o=null,a=(ut(e)?this._qualityItems.forEach((function(e){null!==(o=t._getQualityItem(e))&&(o.reportIndex=t.reportIndex,o.wholePeriod=t.wholePeriod,n.push(o))})):null!==(o=this._getQualityItem(e))&&(o.reportIndex=this.reportIndex,o.wholePeriod=this.wholePeriod,n.push(o)),Le.d("".concat(this._n,"._report"),n),0<this._statInfoArr.length&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]),e=this.get(12)).getSDKAppID();e=e.getTinyID(),0<(n=Ut(this.REPORT_SDKAPPID_BLACKLIST,a)&&!Pt(this.REPORT_TINYID_WHITELIST,e)?[]:n).length&&this._doReport(n)}},{key:"_doReport",value:function(e){var n=this,o={header:si(this),quality:e};this.req({P:Gn.SSO_STAT,data:t({},o)}).then((function(){n.reportIndex++,n.wholePeriod=!1})).catch((function(t){Le.w("".concat(n._n,"._doReport failed. error:"),t),n._statInfoArr=n._statInfoArr.concat(e),n._flushAtOnce()}))}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._statInfoArr,o="".concat(this._n,"._flushAtOnce");He(t)?(Le.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):(10<(n=n.concat(t)).length&&(n=n.slice(0,10)),Le.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)),this._statInfoArr=[]}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),Fr),Js=i((function e(t){o(this,e),He(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.time=t.time||0,this.source=t.source||"",this.wording=t.wording||"",this.type=t.type||"")})),Xs=(i(Vr,[{key:"getLocalApplicationList",value:function(){return{friendApplicationList:v(this._map.values()),unreadCount:this._unreadCount}}},{key:"_onApplicationListUpdated",value:function(){this._snsM.emitOEvt(M.FRIEND_APPLICATION_LIST_UPDATED,{friendApplicationList:v(this._map.values()),unreadCount:this._unreadCount})}},{key:"onApplicationRead",value:function(){this._unreadCount=0,this._onApplicationListUpdated()}},{key:"onApplicationAdded",value:function(e,n){var o,a,i=this;He(e)||(o="",o=n===this._snsM.getMyUserID()?S.SNS_APPLICATION_SENT_BY_ME:S.SNS_APPLICATION_SENT_TO_ME,a=!1,e.forEach((function(e){var n="".concat(e.userID,"_").concat(o);o!==S.SNS_APPLICATION_SENT_TO_ME||i._map.has(n)||(i._unreadCount+=1),i._map.set(n,new Js(t(t({},e),{},{type:o}))),a=!0})),a&&this._onApplicationListUpdated())}},{key:"onApplicationDeleted",value:function(e){He(e)||(this._startTime=0,this._currentSeq=0,this.getApplicationList())}},{key:"getApplicationList",value:function(){var e=this,t="".concat(this._n,".").concat("getApplicationList"),n=new Zn("getApplicationList");return this._snsM.req({P:Gn.GET_FD_APPLICATION_LIST,data:{applicationType:S.SNS_APPLICATION_TYPE_BOTH,fromAccount:this._snsM.getMyUserID(),maxLimited:this._maxLimited,startTime:this._startTime,lastSequence:this._currentSeq}}).then((function(o){var a=(o=o.data).resultList,i=o.unreadCount,s=o.startTime,r=(o=o.currentSequence,e._startTime=s,e._currentSeq=o,e._unreadCount=i,We(a)?a.length:0);r="applicationCount:".concat(r," unreadCount:").concat(i," startTime:").concat(s," currentSequence:").concat(o),n.setMessage(r).end(),Le.i("".concat(t," ok. ").concat(r)),e._map.clear(),We(a)&&a.forEach((function(t){var n=t.userID,o=t.type;t=new Js(t),e._map.set("".concat(n,"_").concat(o),t)})),e._onApplicationListUpdated()})).catch((function(e){return n.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"deleteApplication",value:function(e){var t,n="".concat(this._n,".").concat("deleteApplication"),o=e.userID,a=e.type;return a&&(a===S.SNS_APPLICATION_SENT_BY_ME||a===S.SNS_APPLICATION_SENT_TO_ME)||(a=S.SNS_APPLICATION_SENT_TO_ME),this._map.has("".concat(o,"_").concat(a))?((t=new Zn("deleteApplication")).setMessage("userID:".concat(o," type:").concat(a)),this._snsM.req({P:Gn.DEL_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),userIDList:[o],type:a}}).then((function(e){var i=(r=(e=e.data.resultList)[0]).to,s=r.resultCode,r=r.resultInfo;return t.setMoreMessage("resultList:".concat(JSON.stringify(e))).end(),Le.i("".concat(n," ok. userID:").concat(o," type:").concat(a)),0===s?_n():In({userID:i,code:s,message:r})})).catch((function(e){return t.setError(e).end(),Le.w("".concat(n," failed. error:"),e),In(e)}))):In({code:Un.FRIEND_APPLICATION_NOT_EXIST})}},{key:"acceptApplication",value:function(e){var t="".concat(this._n,".").concat("acceptApplication"),n=e.userID,o=e.remark,a=e.tag,i=e.type,s=(i&&(i===S.SNS_APPLICATION_AGREE||i===S.SNS_APPLICATION_AGREE_AND_ADD)||(i=S.SNS_APPLICATION_AGREE_AND_ADD),new Zn("acceptApplication"));return s.setMessage("userID:".concat(n," type:").concat(i)),this._snsM.req({P:Gn.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,remark:o,tag:a,action:i}]}}).then((function(e){s.end();var o=(e=e.data.resultList[0]).resultCode;if(e=e.resultInfo,0!==o)return In({code:o,message:e});Le.i("".concat(t," ok. userID:").concat(n," type:").concat(i))})).catch((function(e){return s.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"refuseApplication",value:function(e){var t="".concat(this._n,".").concat("refuseApplication"),n=e.userID,o=new Zn("refuseApplication");return o.setMessage("userID:".concat(n)),this._snsM.req({P:Gn.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,action:"Response_Action_Reject"}]}}).then((function(e){o.end();var a=(e=e.data.resultList[0]).resultCode;if(e=e.resultInfo,0!==a)return In({code:a,message:e});Le.i("".concat(t," ok. userID:").concat(n))})).catch((function(e){return o.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"setApplicationRead",value:function(){var e=this,t="".concat(this._n,".").concat("setApplicationRead"),n=new Zn("setApplicationRead");return this._snsM.req({P:Gn.REPORT_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),latestTimeStamp:Ot(De()/1e3,0)}}).then((function(o){n.end(),Le.i("".concat(t," ok")),e._unreadCount=0})).catch((function(e){return n.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"reset",value:function(){this._maxLimited=100,this._currentSeq=0,this._unreadCount=0,this._map.clear()}}]),Vr),Zs=(i(Br,[{key:"validate",value:function(e){var t,n=!0,o="";if(He(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var a=e.profileCustomField.length,i=null,s=0;s<a;s++){if(i=e.profileCustomField[s],!lt(i.key)||-1===i.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!lt(i.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if("profileCustomField"===t)continue;if(He(e[t])&&!lt(e[t])&&!Ke(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":lt(e[t])||(n=!(o="nick must be a string")),500<nt(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(nt(e[t])," bytes"),n=!1);break;case"gender":it(Ue,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":Ke(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":lt(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":lt(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":it(Ge,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":Ke(e.language)||(n=!(o="language must be a number"));break;case"avatar":lt(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":it(Pe,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":Ke(e.level)||(n=!(o="level must be a number"));break;case"role":Ke(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}},{key:"update",value:function(e){var t,n="",o=[];this.friendCustomField.forEach((function(e){o.push(e.key)}));for(var a=0,i=e.length;a<i;a++)if(n=e[a].tag,t=e[a].value,-1<n.indexOf("Tag_SNS_Custom"))-1<o.indexOf(n)?this.friendCustomField.forEach((function(e){e.key===n&&(e.value=t)})):this.friendCustomField.push({key:n,value:t});else if(-1<n.indexOf("Tag_Profile_Custom")){var s=!1;this.profile.profileCustomField.forEach((function(e){e.key===n&&(e.value=t,s=!0)})),s||this.profile.profileCustomField.push({key:n,value:t})}else switch(n){case Ae.NICK:this.profile.nick=t;break;case Ae.GENDER:this.profile.gender=t;break;case Ae.BIRTHDAY:this.profile.birthday=t;break;case Ae.LOCATION:this.profile.location=t;break;case Ae.SELFSIGNATURE:this.profile.selfSignature=t;break;case Ae.ALLOWTYPE:this.profile.allowType=t;break;case Ae.LANGUAGE:this.profile.language=t;break;case Ae.AVATAR:this.profile.avatar=t;break;case Ae.MESSAGESETTINGS:this.profile.messageSettings=t;break;case Ae.ADMINFORBIDTYPE:this.profile.adminForbidType=t;break;case Ae.LEVEL:this.profile.level=t;break;case Ae.ROLE:this.profile.role=t;break;case Oe.REMARK:this.remark=t;break;case Oe.ADDTIME:this.addTime=t;break;case Oe.GROUP:this.groupList=JSON.parse(JSON.stringify(t));break;case Oe.ADDSOURCE:this.source=t;break;case Oe.ADDWORDING:break;default:Le.d("snsProfileItem unkown tag->",e[a].tag)}this.timestamp=Date.now(),o.length=0}},{key:"updateProfile",value:function(e){this.profile=JSON.parse(JSON.stringify(e)),this.timestamp=Date.now()}},{key:"addToGroupList",value:function(e){-1===this.groupList.indexOf(e)&&(this.groupList.push(e),this.count=this.groupList.length)}},{key:"removeFromGroupList",value:function(e){-1<(e=this.groupList.indexOf(e))&&(this.groupList.splice(e,1),this.count=this.groupList.length)}}]),Br),Qs=(i(xr,[{key:"getLocalFriendList",value:function(){return v(this._map.values())}},{key:"getFriendRemark",value:function(e){return this._map.has(e)?this._map.get(e).remark:""}},{key:"onFriendProfileModified",value:function(e){var t,n=this;He(e=e.dataList)||(t=this._snsM.get(11),e.forEach((function(e){var o,a=e.userID;e=e.profileList,n.isMyFriend(a)&&(Le.l("".concat(n._n,".onFriendProfileModified. friend account:").concat(a,", profileList:").concat(JSON.stringify(e))),(o=n._map.get(a)).update(e),t.modifyMessageSentByPeer({conversationID:"".concat(S.CONV_C2C).concat(a),latestNick:o.profile.nick,latestAvatar:o.profile.avatar}))})),this._onFriendListUpdated())}},{key:"onFriendAdded",value:function(e){var t=this;0!==e.length&&(Le.l("".concat(this._n,".onFriendAdded userIDList:").concat(e)),e.forEach((function(e){t._map.set(e,new Zs(e))})),this.getFriendProfile({userIDList:e}).then((function(n){e.forEach((function(e){var n=t._map.get(e);0<n.groupList.length&&t._snsM.updateWhenFriendAdded({nameList:n.groupList,userID:e})})),t._onFriendListUpdated()})))}},{key:"onFriendDeleted",value:function(e){var t=this;0!==e.length&&(Le.l("".concat(this._n,".onFriendDeleted userIDList:").concat(e)),e.forEach((function(e){var n=t._map.get(e);0<n.groupList.length&&t._snsM.updateWhenFriendDeleted({nameList:n.groupList,userID:e}),t._map.delete(e)})),this._onFriendListUpdated())}},{key:"_onFriendListUpdated",value:function(){this._snsM.emitOEvt(M.FRIEND_LIST_UPDATED),this._snsM.get(11).checkAndPatchRemark()}},{key:"getFriendProfile",value:function(e){var t,n=this,o="".concat(this._n,".").concat("getFriendProfile"),a=(e=e.userIDList,[]),i=[],s=[];return e.forEach((function(e){var t;n._map.has(e)?(t=n._map.get(e),Date.now()-t.timestamp<n._expirationTime?i.push(t):s.push(e)):a.push({userID:e,code:Un.NOT_MY_FRIEND,message:n._snsM.getErrMsg(Un.NOT_MY_FRIEND)})})),0===s.length?(Le.i("".concat(o," newUserIDList is empty")),yn({friendList:i,failureUserIDList:a})):((t=new Zn("getFriendProfile")).setMessage("userIDList:".concat(s)),Le.i("".concat(o," userIDList:").concat(s)),this._snsM.req({P:Gn.GET_FD_PROFILE,data:{fromAccount:this._snsM.getMyUserID(),userIDList:s}}).then((function(e){return t.end(),Le.i("".concat(o," ok")),e.data.resultList.forEach((function(e){var t,o=e.to,s=e.resultCode,r=e.resultInfo;e=e.tagValueList,ut(s)||0===s?(n._map.has(o)?(t=n._map.get(o)).update(e):(t=new Zs(o,e),n._map.set(o,t)),i.push(t)):a.push({userID:o,code:s,message:r})})),_n({friendList:i,failureUserIDList:a})})).catch((function(e){return t.setError(e).end(),Le.w("".concat(o," failed. error:"),e),In(e)})))}},{key:"isMyFriend",value:function(e){return this._map.has(e)}},{key:"pagingGetFriendList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendList"),n=new Zn("getFriendList"),o=Date.now();this._snsM.req({P:Gn.GET_FD_LIST,data:{fromAccount:this._snsM.getMyUserID(),startIndex:this._startIdx,standardSequence:this._standardSeq,customSequence:this._customSeq}}).then((function(a){var i=(a=a.data).friendCount,s=a.resultList,r=a.nextStartIndex,c=a.standardSequence,l=a.customSequence;a=a.completeFlag,e._startIdx=r,e._standardSeq=c,e._customSeq=l,i="friendCount:".concat(i," nextStartIndex:").concat(r," standardSequence:").concat(c," ")+"customSequence:".concat(l," completeFlag:").concat(a," cost:").concat(zt(o)),n.setMessage(i).end(),Le.i("".concat(t," ok."),i),He(s)||s.forEach((function(t){var n=t.to;t=t.tagValueList,e._map.set(n,new Zs(n,t))})),0===a?e.pagingGetFriendList():(e._snsM.emitOEvt(M.FRIEND_LIST_UPDATED),e._pagingGetFriendProfile())})).catch((function(e){return n.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"_pagingGetFriendProfile",value:function(){var e=this,t=v(this._map.keys()),n=this._snsM.get(4),o=t.length,a=o<=100?1:Math.ceil(o/100);Le.l("".concat(this._n,"._pagingGetFriendProfile friendCount:").concat(o," pageCount:").concat(a));for(var i=0;i<a;i++)n.getUserProfile({userIDList:t.slice(100*i,100*(i+1))}).then((function(t){t.data.forEach((function(t){var n=e._map.get(t.userID);n&&n.updateProfile(t)})),e._onFriendListUpdated()}))}},{key:"addFriend",value:function(e){var t,n,o,a,i,s,r,c=this,l="".concat(this._n,".").concat("addFriend");return this._map.has(e.to)?In({code:Un.ALREADY_MY_FRIEND}):e.wording&&!1===this._snsM.filterProfanity("wording",e)?In({code:Un.PROFANITY_FOUND}):(t=e.to,n=e.source,o=e.type,a=e.wording,i=e.remark,e=e.groupName,(s=o)&&(s===S.SNS_ADD_TYPE_SINGLE||s===S.SNS_ADD_TYPE_BOTH)||(s=S.SNS_ADD_TYPE_BOTH),(r=new Zn("addFriend")).setMessage("to:".concat(t," source:").concat(n," type:").concat(s)),this._snsM.req({P:Gn.ADD_FD,data:{fromAccount:this._snsM.getMyUserID(),addFriendItem:[{to:t,source:n,wording:a,remark:i,groupName:e}],type:s}}).then((function(e){e=e.data.resultList;var t=(r.setMoreMessage("resultList:".concat(JSON.stringify(e))).end(),e=e[0]).to,n=e.resultCode;return e=e.resultInfo,Le.i("".concat(l," ok. to:").concat(t," type:").concat(s," code:").concat(n)),ut(n)||0===n?_n({userID:t,code:0}):30539===n?_n({userID:t,code:n,message:c._snsM.getErrMsg(n)}):In({userID:t,code:n,message:c._snsM.getErrMsg(n)||e})})).catch((function(e){return r.setError(e).end(),Le.w("".concat(l," failed. error:"),e),In(e)})))}},{key:"deleteFriend",value:function(e){var t,n=this,o="".concat(this._n,".").concat("deleteFriend"),a=e.userIDList,i=(e=e.type,1e3<a.length&&(Le.w("".concat(o," ").concat(Ht(1e3))),a.length=1e3),[]),s=[],r=[];return a.forEach((function(e){n._map.has(e)?r.push(e):i.push({userID:e,code:Un.NOT_MY_FRIEND,message:n._snsM.getErrMsg(Un.NOT_MY_FRIEND)})})),0===r.length?yn({successUserIDList:s,failureUserIDList:i}):((a=e)&&(a===S.SNS_DELETE_TYPE_SINGLE||a===S.SNS_DELETE_TYPE_BOTH)||(a=S.SNS_DELETE_TYPE_BOTH),(t=new Zn("deleteFriend")).setMessage("userIDList:".concat(r," type:").concat(a)),this._snsM.req({P:Gn.DEL_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:r,type:a}}).then((function(e){return t.end(),Le.i("".concat(o," ok")),He(e=e.data.resultList)||e.forEach((function(e){var t=e.to,n=e.resultCode;e=e.resultInfo,ut(n)||0===n?s.push({userID:t}):i.push({userID:t,code:n,message:e})})),_n({successUserIDList:s,failureUserIDList:i})})).catch((function(e){return t.setError(e).end(),Le.w("".concat(o," error:"),e),In(e)})))}},{key:"updateFriend",value:function(e){var t,n,o,a=this,i=e.userID,s=e.remark,r=e.friendCustomField;return this._map.has(i)?(t="".concat(this._n,".").concat("updateFriend"),(n=new Zn("updateFriend")).setMessage("userID:".concat(i," remark:").concat(s," friendCustomField:").concat(r)),o=[],ut(s)||o.push({tag:Oe.REMARK,value:s}),We(r)&&0<r.length&&r.forEach((function(e){o.push({tag:e.key,value:e.value})})),this._snsM.req({P:Gn.UPDATE_FD,data:{fromAccount:this._snsM.getMyUserID(),updateItem:[{to:i,snsItem:o}]}}).then((function(e){n.end(),Le.i("".concat(t," ok"));var o=(e=e.data.resultList[0]).to,i=e.resultCode;return e=e.resultInfo,ut(i)||0===i?((o=a._map.get(o))&&(ut(s)||(o.remark=s),We(r)&&0<r.length&&vt(o.friendCustomField,r),a._onFriendListUpdated()),_n(o)):In({code:i,message:e})})).catch((function(e){return n.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)}))):In({code:Un.NOT_MY_FRIEND})}},{key:"checkFriend",value:function(e){var t="".concat(this._n,".").concat("checkFriend"),n=e.userIDList,o=e.type,a=(o&&(o===S.SNS_CHECK_TYPE_SINGLE||o===S.SNS_CHECK_TYPE_BOTH)||(o=S.SNS_CHECK_TYPE_BOTH),new Zn("checkFriend"));return a.setMessage("userIDList:".concat(n," type:").concat(o)),this._snsM.req({P:Gn.CHECK_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:n,type:o}}).then((function(e){a.end(),Le.i("".concat(t," ok. userIDList:").concat(n," type:").concat(o));var i=[],s=[];return We(e=e.data.resultList)&&e.forEach((function(e){var t=e.to,n=e.relation,o=e.resultCode;e=e.resultInfo,ut(o)||0===o?i.push({userID:t,code:0,relation:n}):s.push({userID:t,code:o,message:e})})),_n({successUserIDList:i,failureUserIDList:s})})).catch((function(e){return a.setError(e).end(),Le.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"onAddedToFriendGroup",value:function(e){var t=this,n=e.name;e=e.userIDList,Le.l("".concat(this._n,".onAddedToFriendGroup groupName:").concat(n," userIDList:").concat(e)),n&&!He(e)&&e.forEach((function(e){t._map.has(e)&&t._map.get(e).addToGroupList(n)}))}},{key:"onRemovedFromFriendGroup",value:function(e){var t=this,n=e.name;e=e.userIDList,Le.l("".concat(this._n,".onRemovedFromFriendGroup groupName:").concat(n," userIDList:").concat(e)),n&&!He(e)&&e.forEach((function(e){t._map.has(e)&&t._map.get(e).removeFromGroupList(n)}))}},{key:"reset",value:function(){this._map.clear(),this._startIdx=0,this._standardSeq=0,this._customSeq=0}}]),xr),er=(i(Gr,[{key:"addToUserIDList",value:function(e){-1===this.userIDList.indexOf(e)&&(this.userIDList.push(e),this.count=this.userIDList.length)}},{key:"removeFromUserIDList",value:function(e){-1<(e=this.userIDList.indexOf(e))&&(this.userIDList.splice(e,1),this.count=this.userIDList.length)}}]),Gr),tr=(i(Pr,[{key:"getLocalGroupList",value:function(){return v(this._map.values())}},{key:"_onGroupListUpdated",value:function(){var e=v(this._map.values());this._snsM.emitOEvt(M.FRIEND_GROUP_LIST_UPDATED,e)}},{key:"getGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getGroupList"),n=new Zn("getGroupList");return this._snsM.req({P:Gn.GET_FD_GRP_LIST,data:{fromAccount:this._snsM.getMyUserID()}}).then((function(o){n.end(),He(o=o.data.resultList)?Le.i("".concat(t," ok. count:0")):(Le.i("".concat(t," ok. count:").concat(o.length)),e._map.clear(),o.forEach((function(t){var n=new er(t);e._map.set(t.name,n)})),e._onGroupListUpdated())})).catch((function(e){return n.setError(e).end(),Le.w("".concat(t," error:"),e),In(e)}))}},{key:"createGroup",value:function(e){var t,n,o=this,a="".concat(this._n,".").concat("createGroup"),i=e.name;return e=e.userIDList,this._map.has(i)?In({code:Un.FRIEND_GRP_EXISTED}):(t="name:".concat(i," userIDList:").concat(e),(n=new Zn("createGroup")).setMessage(t),this._snsM.req({P:Gn.CREATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),groupName:[i],userIDList:We(e)?e:void 0}}).then((function(e){n.end(),Le.l("".concat(a," ok. ").concat(t)),e=e.data.resultList;var s=[],r=[];return e&&e.forEach((function(e){var t=e.to,n=e.resultCode,o=e.resultInfo;ut(n)||0===n?s.push(t):(t={userID:e.to,code:n,message:o},r.push(t))})),e=new er({name:i,userIDList:s}),o._map.set(i,e),o._snsM.onAddedToFriendGroup({name:i,userIDList:s}),o._onGroupListUpdated(),_n({friendGroup:e,failureUserIDList:r})})).catch((function(e){return n.setError(e).end(),Le.w("".concat(a," failed. error:"),e),In(e)})))}},{key:"deleteGroup",value:function(e){var t,n,o=this,a="".concat(this._n,".").concat("deleteGroup"),i=e.name;return this._map.has(i)?(t="name:".concat(i),(n=new Zn("deleteGroup")).setMessage(t),this._snsM.req({P:Gn.DEL_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),nameList:[i]}}).then((function(e){n.end(),Le.l("".concat(a," ok. ").concat(t));var s=o._map.get(i);return s&&(o._snsM.onRemovedFromFriendGroup({name:i,userIDList:s.userIDList}),o._map.delete(i),s.userIDList.length=0),o._onGroupListUpdated(),_n(s)})).catch((function(e){return n.setError(e).end(),Le.w("".concat(a," failed. error:"),e),In(e)}))):this._onGroupNotExist()}},{key:"renameGroup",value:function(e){var t,n,o=this,a="".concat(this._n,".").concat("renameGroup"),i=e.oldName,s=e.newName;return this._map.has(i)?(t="oldName:".concat(i," newName:").concat(s),(n=new Zn("renameGroup")).setMessage(t),this._snsM.req({P:Gn.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:i,newName:s}}).then((function(){var e;return n.end(),Le.l("".concat(a," ok. ").concat(t)),o._map.has(i)?((e=o._map.get(i)).name=s,o._map.delete(i),o._map.set(s,e),o._snsM.onRemovedFromFriendGroup({name:i,userIDList:e.userIDList}),o._snsM.onAddedToFriendGroup({name:s,userIDList:e.userIDList}),o._onGroupListUpdated(),_n(e)):_n()})).catch((function(e){return n.setError(e).end(),Le.w("".concat(a," failed. error:"),e),In(e)}))):this._onGroupNotExist()}},{key:"addToGroup",value:function(e){var t,n,o=this,a="".concat(this._n,".").concat("addToGroup"),i=e.name;return e=e.userIDList,this._map.has(i)?(t="name:".concat(i," userIDList:").concat(e),(n=new Zn("addToGroup")).setMessage(t),this._snsM.req({P:Gn.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:i,updateGroupItem:e.filter((function(e){return o._snsM.isMyFriend(e)})).map((function(e){return{to:e,updateType:"Update_Type_Add"}}))}}).then((function(e){return n.end(),Le.l("".concat(a," ok. ").concat(t)),o._onGroupUpdated(i,e)})).catch((function(e){return n.setError(e).end(),Le.w("".concat(a," failed. error:"),e),In(e)}))):this._onGroupNotExist()}},{key:"removeFromGroup",value:function(e){var t,n,o=this,a="".concat(this._n,".").concat("removeFromGroup"),i=e.name;return e=e.userIDList,this._map.has(i)?(t="name:".concat(i," userIDList:").concat(e),(n=new Zn("removeFromGroup")).setMessage(t),this._snsM.req({P:Gn.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:i,updateGroupItem:e.filter((function(e){return o._snsM.isMyFriend(e)})).map((function(e){return{to:e,updateType:"Update_Type_Delete"}}))}}).then((function(e){return n.end(),Le.l("".concat(a," ok. ").concat(t)),o._onGroupUpdated(i,e)})).catch((function(e){return n.setError(e).end(),Le.w("".concat(a," failed. error:"),e),In(e)}))):this._onGroupNotExist()}},{key:"_onGroupUpdated",value:function(e,t){t=t.data.resultList;var n=this._map.get(e),o=[],a=[],i=[];return We(t)&&t.forEach((function(e){var t=e.to,s=e.resultCode,r=e.resultInfo,c=e.type;0===s?"Update_Type_Add"===c?n&&(n.addToUserIDList(t),a.push(t)):"Update_Type_Delete"===c&&n&&(n.removeFromUserIDList(t),i.push(t)):o.push({to:e.to,code:s,message:r})})),Le.l("".concat(this._n,"._onGroupUpdated name:").concat(e," userIDList:").concat(n.userIDList)),0<a.length&&this._snsM.onAddedToFriendGroup({name:e,userIDList:a}),0<i.length&&this._snsM.onRemovedFromFriendGroup({name:e,userIDList:i}),_n({friendGroup:n,failureUserIDList:o})}},{key:"updateWhenFriendAdded",value:function(e){var t=this,n=e.nameList,o=e.userID;Le.l("".concat(this._n,".updateWhenFriendAdded userID:").concat(o," nameList:").concat(n)),He(n)||n.forEach((function(e){t._map.has(e)&&t._map.get(e).addToUserIDList(o)}))}},{key:"updateWhenFriendDeleted",value:function(e){var t=this,n=e.nameList,o=e.userID;Le.l("".concat(this._n,".updateWhenFriendDeleted userID:").concat(o," nameList:").concat(n)),He(n)||n.forEach((function(e){t._map.has(e)&&t._map.get(e).removeFromUserIDList(o)}))}},{key:"_onGroupNotExist",value:function(e){return In({code:Un.FRIEND_GRP_NOT_EXIST})}},{key:"reset",value:function(){this._map.clear()}}]),Pr),nr=(r(Ur,Nn),Gs=m(Ur),i(Ur,[{key:"onContextUpdated",value:function(e){this._friendHandler.pagingGetFriendList(),this._friendGroupHandler.getGroupList(),this._friendApplicationHandler.getApplicationList()}},{key:"onRelationChainModified",value:function(e){var t,n,o,a,i,s,r=this;He(e=e.dataList)||(t=[],n=[],o=[],i=!(a=[]),s="",e.forEach((function(e){var c;3!==e.pushType&&4!==e.pushType||!e.from||(s=e.from),e.friendAddAccount&&(t.push.apply(t,v(e.friendAddAccount)),a.push.apply(a,v(e.friendAddAccount))),e.friendDelAccount&&n.push.apply(n,v(e.friendDelAccount)),e.friendApplicationAdded&&o.push.apply(o,v(e.friendApplicationAdded)),e.friendApplicationDeletedUserIDList&&a.push.apply(a,v(e.friendApplicationDeletedUserIDList)),e.reportTime&&7===e.pushType&&(i=!0),e.friendUpInfo&&(c={dataList:[]},e.friendUpInfo.forEach((function(e){c.dataList.push({userID:e.friendAccount,profileList:v(e.sns)})})),r.onFriendProfileModified(c))})),i&&this._friendApplicationHandler.onApplicationRead(),this._friendApplicationHandler.onApplicationAdded(o,s),this._friendApplicationHandler.onApplicationDeleted(a),this._friendHandler.onFriendAdded(t),this._friendHandler.onFriendDeleted(n))}},{key:"isMyFriend",value:function(e){return this._friendHandler.isMyFriend(e)}},{key:"filterProfanity",value:function(e,t){var n,o=this.get(29);return!o||(n=(o=o.filterText(t[e],"sns")).isAllowedToSend,o=o.modifiedText,!0===n&&(t[e]=o,!0))}},{key:"onFriendProfileModified",value:function(e){this._friendHandler.onFriendProfileModified(e)}},{key:"getLocalFriendList",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this._friendHandler.getLocalFriendList();return e?yn(t):t}},{key:"getFriendRemark",value:function(e){return this._friendHandler.getFriendRemark(e)}},{key:"getFriendList",value:function(){return this._friendHandler.pagingGetFriendList()}},{key:"addFriend",value:function(e){return this._friendHandler.addFriend(e)}},{key:"deleteFriend",value:function(e){return this._friendHandler.deleteFriend(e)}},{key:"checkFriend",value:function(e){return this._friendHandler.checkFriend(e)}},{key:"getFriendProfile",value:function(e){return this._friendHandler.getFriendProfile(e)}},{key:"updateFriend",value:function(e){return this._friendHandler.updateFriend(e)}},{key:"onAddedToFriendGroup",value:function(e){this._friendHandler.onAddedToFriendGroup(e)}},{key:"onRemovedFromFriendGroup",value:function(e){this._friendHandler.onRemovedFromFriendGroup(e)}},{key:"getLocalFriendApplicationList",value:function(){return yn(this._friendApplicationHandler.getLocalApplicationList())}},{key:"deleteFriendApplication",value:function(e){return this._friendApplicationHandler.deleteApplication(e)}},{key:"refuseFriendApplication",value:function(e){return this._friendApplicationHandler.refuseApplication(e)}},{key:"acceptFriendApplication",value:function(e){return this._friendApplicationHandler.acceptApplication(e)}},{key:"setFriendApplicationRead",value:function(e){return this._friendApplicationHandler.setApplicationRead(e)}},{key:"getLocalFriendGroupList",value:function(){return yn(this._friendGroupHandler.getLocalGroupList())}},{key:"createFriendGroup",value:function(e){return this._friendGroupHandler.createGroup(e)}},{key:"deleteFriendGroup",value:function(e){return this._friendGroupHandler.deleteGroup(e)}},{key:"addToFriendGroup",value:function(e){return this._friendGroupHandler.addToGroup(e)}},{key:"removeFromFriendGroup",value:function(e){return this._friendGroupHandler.removeFromGroup(e)}},{key:"renameFriendGroup",value:function(e){return this._friendGroupHandler.renameGroup(e)}},{key:"updateWhenFriendAdded",value:function(e){this._friendGroupHandler.updateWhenFriendAdded(e)}},{key:"updateWhenFriendDeleted",value:function(e){this._friendGroupHandler.updateWhenFriendDeleted(e)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._friendHandler.reset(),this._friendGroupHandler.reset(),this._friendApplicationHandler.reset()}}]),Ur),or=(r(Or,Nn),Ps=m(Or),i(Or,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&ge}},{key:"startWorkerTimer",value:function(){Le.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){Le.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){var e,t;ge&&(e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"})),this._workerTimer=new Worker(e),(t=this)._workerTimer.onmessage=function(e){e.data?(t._timerID=e.data,Le.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()})}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("enable_worker");Le.l("".concat(this._n,"._onCloudConfig enableWorker:").concat(e)),ut(e)||"1"===e?!this._isWorkerEnabled&&ge&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&ge&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){Le.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),Or),ar=(i(Ar,[{key:"isValidPurchaseBits",value:function(e){return e&&"string"==typeof e&&1<=e.length&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){if(this.isValidPurchaseBits(e)){this._featureMap.clear();for(var t,n=e.length-1,o=0;0<=n;n--,o++)t=(o<32?new w(0,Math.pow(2,o)):new w(Math.pow(2,o-32),0)).toString(),"1"===e[n]?this._featureMap.set(t,!0):this._featureMap.set(t,!1)}else Le.w("".concat(this._n,".parsePurchaseBits invalid purchasebits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._featureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,o=!0,a=t.length-1,i=0;0<=a;a--,i++)if("1"===t.charAt(a)&&(n=(i<32?new w(0,Math.pow(2,i)):new w(Math.pow(2,i-32),0)).toString(),!this._featureMap.get(n))){o=!1;break}return Le.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," key:").concat(n," ret:").concat(o)),yn({enabled:o})}},{key:"isFeatureEnabledForStat",value:function(e){for(var t=parseInt(e).toString(2),n=t.length-1,o=0;0<=n;n--,o++)if("1"===t.charAt(n)){if(a=(o<32?new w(0,Math.pow(2,o)):new w(Math.pow(2,o-32),0)).toString(),!this._featureMap.get(a))break;var a,i="",s=0;a===P.PLUGIN_TRANSLATE?(i="plugin_translate",s=16):a===P.PLUGIN_VOICE_TO_TEXT?(i="plugin_voice_to_text",s=17):a===P.PLUGIN_CS?(i="plugin_cs",s=14):a===P.PLUGIN_PUSH?(i="plugin_push",s=13):a===P.PLUGIN_BOT?(i="plugin_bot",s=15):a===P.MSG_REACTION&&(i="plugin_emoji_reaction",s=18),""!==i&&(a=this._commercialConfigM.get(12).getUIPlatform(),new Zn(i).setCode(s).setUIPlatform(a).end(),Le.l("".concat(this._n,".isFeatureEnabledForStat ").concat(i," code:").concat(s," uiPlatform:").concat(a)))}}},{key:"isSearchCloudMessagesEnabled",value:function(){var e;this._isSCMReported||(e=this._commercialConfigM.get(12).getUIPlatform(),new Zn("plugin_search").setCode(6).setUIPlatform(e).end(),this._isSCMReported=!0)}},{key:"clear",value:function(){this._featureMap.clear(),this._isSCMReported=!1}}]),Ar),ir=(i(Rr,[{key:"_canFetch",value:function(){return this.get(12).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e,t,n=this,o=this._canFetch(),a="".concat(this._n,".fetchConfig");Le.l("".concat(a," canFetch:").concat(o)),o&&(e=new Zn("fetchCommercialConfig"),o=this.get(12).getSDKAppID(),t=this.get(20),this._isFetching=!0,t.req({P:Gn.FETCH_COMMERCIAL_CONFIG,data:{SDKAppID:o}}).then((function(t){e.setMessage("purchaseBits:".concat(t.data.purchaseBits)).end(),Le.l("".concat(a," ok.")),n._parseConfig(t.data),n._isFetching=!1})).catch((function(t){e.setError(t).end(),n._isFetching=!1})))}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig data:").concat(JSON.stringify(e));Le.l("".concat(t)),new Zn("pushedCommercialConfig").setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,o=e.errorMessage,a=e.purchaseBits,i=e.expiredTime;0===n?(this._purchasedFeatureHandler.parsePurchaseBits(a),this._expiredTime=Date.now()+1e3*i):ut(n)?(Le.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Le.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(o)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"isFeatureEnabledForStat",value:function(e){this._purchasedFeatureHandler.isFeatureEnabledForStat(e)}},{key:"isSearchCloudMessagesEnabled",value:function(){this._purchasedFeatureHandler.isSearchCloudMessagesEnabled()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),Rr),sr=(r(Lr,Nn),Us=m(Lr),i(Lr,[{key:"registerPlugin",value:function(e){var t,n,o,a,i,s,r,c,l,u,d,p,h;J?(this._offlinePushPlugin=e["tim-offline-push-plugin"],t=(h=e.offlinePushConfig||{}).huaweiBusinessID,n=h.xiaomiBusinessID,o=h.xiaomiAppID,a=h.xiaomiAppKey,i=h.meizuBusinessID,s=h.meizuAppID,r=h.meizuAppKey,c=h.vivoBusinessID,l=h.oppoBusinessID,u=h.oppoAppKey,d=h.oppoAppSecret,p=h.honorBusinessID,h=h.iosBusinessID,this._androidPushConfig.huaweiPushBussinessId=t,this._androidPushConfig.xiaomiPushBussinessId=n,this._androidPushConfig.xiaomiPushAppId=o,this._androidPushConfig.xiaomiPushAppKey=a,this._androidPushConfig.meizuPushBussinessId=i,this._androidPushConfig.meizuPushAppId=s,this._androidPushConfig.meizuPushAppKey=r,this._androidPushConfig.vivoPushBussinessId=c,this._androidPushConfig.oppoPushBussinessId=l,this._androidPushConfig.oppoPushAppKey=u,this._androidPushConfig.oppoPushAppSecret=d,this._androidPushConfig.honorPushBussinessId=p,new Zn("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!ut(this._offlinePushPlugin))).end(!0),Le.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=h,this._setAppShowListener()):this.warn("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");Je(this._offlinePushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID),Le.l("".concat(n," start. ").concat(e)),new Zn("_getDeviceToken").setMessage("".concat(e)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,(function(o){var a,i,s,r,c=new Zn("getDeviceTokenRes"),l=o.code,u=o.msg;0===l?(a=(r=o.data).deviceToken,i=r.deviceBrand,s=r.deviceType,r=r.bussinessId,t._deviceToken=a,t._businessID=r||t._iosBusinessID,e="deviceToken:".concat(a,", deviceBrand:").concat(i||s,", businessID:").concat(t._businessID),Le.l("".concat(n," ok. ").concat(e)),c.setMessage(e).end(!0),t._setToken()):(c.setMessage("code:".concat(l,", msg:").concat(u)).end(!0),Le.e("".concat(n," failed. error:"),o))}))):Le.e("".concat(n," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return J&&!ut(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");ut(this._offlinePushPlugin)?Le.e("".concat(t," offlinePushPlugin is undefined")):Je(this._offlinePushPlugin.setAppShowListener)?(new Zn("_setAppShowListener").end(!0),Le.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener((function(n){n=(n||{}).appShow,new Zn("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),Le.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(0===n?(e._getConvUnreadCount(),e._onBackground()):1===n&&e._onForeground())}))):Le.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!ut(this._offlinePushPlugin)&&Je(this._offlinePushPlugin.getDeviceType))return e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType,Le.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,"._setToken"),t=this.get(12),n=1,o="",a="",i=(He(this._deviceToken)&&(n=0),this.getUniAppPlatform()),s=this.getDeviceBrand(),r=(i===L.IOS||i===L.IPAD||i===L.MAC?a=this._deviceToken:i===L.ANDROID&&(o=this._deviceToken),new Zn("offlinePushSetToken"));return i="deviceToken:".concat(a||o,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(s,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(n,", platform:").concat(i),r.setMessage("".concat(i)),Le.l("".concat(e," ").concat(i)),this.req({P:Gn.SET_TOKEN,data:{tokenID:o,pushMsg:n,sdkAppID:t.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:s,deviceToken:a,isWebUniapp:this._isWebUniapp}}).then((function(t){return r.end(),Le.l("".concat(e," ok")),t})).catch((function(t){return r.setError(t).end(),Le.e("".concat(e," failed. error:"),t),In(t)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach((function(t){t.type===S.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===S.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new Zn("_onBackground");this.req({P:Gn.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(o){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),Le.l("".concat(t," ok")),o})).catch((function(e){n.setError(e).end(),Le.e("".concat(t," failed. error:"),e)}))}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new Zn("_onForeground");this.req({P:Gn.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then((function(n){return t.end(),Le.l("".concat(e," ok")),n})).catch((function(n){t.setError(n).end(),Le.e("".concat(e," failed. error:"),n)}))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?L.IOS:"android"===e?L.ANDROID:1002===t?L.IPAD:1001===t?L.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Le.l("".concat(this._n,".reset"))}}]),Lr),rr=(r(Nr,Nn),Os=m(Nr),i(Nr,[{key:"registerPlugin",value:function(e){var t,n,o;J?(t="".concat(this._n,".").concat("registerPlugin"),this._pushPlugin=e["tim-push"],this._getDeviceInfo(),n=(o=e.pushConfig||{}).androidConfig,o=o.iOSConfig,$e(n)&&(this._androidPushConfig=n[this._deviceInfo.packageName]),n=(o||{}).iOSBusinessID,this._iOSBusinessID=n,o=!ut(this._pushPlugin),new Zn("registerPlugin").setMessage(this._pluginName).setMoreMessage("isExisted:".concat(o)).end(!0),Le.l("".concat(t," ok. pushConfig:").concat(JSON.stringify(e.pushConfig))),o?(this._setAppShowListener(),this._setPushEventReportListener()):Le.e("".concat(t," ").concat(this._pluginName," is undefined"))):this.warn("TIMPushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._reportEventCacheList(),this._getDeviceToken(),this.get(27).isFeatureEnabledForStat(Math.pow(2,41))}},{key:"_reportEventCacheList",value:function(){var e=this,n="".concat(this._n,".").concat("_reportEventCacheList");Je(this._pushPlugin.getPushEventCacheList)?(new Zn("_reportEventCacheList").end(!0),this._pushPlugin.getPushEventCacheList((function(o){var a=o.code,i=o.data.eventList,s=new Zn("getPushEventCacheListRes");if(s.setCode(a),0!==a)s.setMessage("res:".concat(JSON.stringify(o))).end(!0),Le.e("".concat(n," failed. error:").concat(JSON.stringify(o)));else{a=i.length<10?"eventList:".concat(JSON.stringify(i)):"eventList.length:".concat(i.length),Le.l("".concat(n," ok. ").concat(a)),s.setMessage(a).end(!0);for(var r=t(t({},o.data),{},{eventList:[]});0<i.length;)r.eventList=i.splice(0,40),e._pushReport(r)}}))):Le.e("".concat(this._pluginName,".getPushEventCacheList is not a function"))}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");Je(this._pushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig)," iOSBusinessID:").concat(this._iOSBusinessID),Le.l("".concat(n," start. ").concat(e)),new Zn("_getDeviceToken").setMessage("".concat(e)).end(!0),this._pushPlugin.getDeviceToken(this._androidPushConfig,(function(o){var a,i,s,r=o.code,c=o.msg,l=new Zn("getDeviceTokenRes");l.setCode(r),0===r?(a=(r=o.data).deviceToken,i=r.deviceBrand,s=r.deviceType,r=r.bussinessId,t._deviceToken=a,t._businessID=r||t._iOSBusinessID,e="deviceToken:".concat(a," deviceBrand:").concat(i||s," businessID:").concat(t._businessID),Le.l("".concat(n," ok. ").concat(e)),l.setMessage(e).end(!0),t._setToken()):(l.setMessage(c).end(!0),Le.e("".concat(n," failed. error:").concat(JSON.stringify(o))))}))):Le.e("".concat(this._pluginName,".getDeviceToken is not a function"))}},{key:"_getDeviceInfo",value:function(){var e,n,o,a,i="".concat(this._n,".").concat("_getDeviceInfo");Je(this._pushPlugin.getDeviceInfo)?(a=(e=this._pushPlugin.getDeviceInfo()).code,n=e.data,(o=new Zn("_getDeviceInfo")).setCode(a),0===a?(this._deviceInfo=t(t({},this._deviceInfo),n),this._deviceInfo.pushVersion||(this._deviceInfo.pushVersion="1.0.1"),a="deviceInfo:".concat(JSON.stringify(this._deviceInfo)),Le.l("".concat(i," ok. ").concat(a)),o.setMessage(a).end(!0)):(o.setMessage("deviceInfoRes:".concat(JSON.stringify(e))).end(!0),Le.e("".concat(i," failed. error:").concat(JSON.stringify(e))))):Le.e("".concat(this._pluginName,".getDeviceInfo is not a function"))}},{key:"canIUseTIMPush",value:function(){return J&&!ut(this._pushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");Je(this._pushPlugin.setAppShowListener)?(new Zn("_setAppShowListener").end(!0),Le.l("".concat(t," start")),this._pushPlugin.setAppShowListener((function(n){n=(n||{}).appShow,new Zn("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),Le.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(0===n?(e._getConvUnreadCount(),e._onBackground()):1===n&&e._onForeground())}))):Le.e("".concat(this._pluginName,".setAppShowListener is not a function"))}},{key:"_setPushEventReportListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setPushEventReportListener");Je(this._pushPlugin.setPushEventReportListener)?(new Zn("_setPushEventReportListener").end(!0),this._pushPlugin.setPushEventReportListener((function(n){var o=n.code,a=n.data,i=a.eventList,s=new Zn("setPushEventReportListenerRes");s.setCode(o),0===o?(o="eventList:".concat(JSON.stringify(i)),Le.l("".concat(t," ok. ").concat(o)),s.setMessage(o).end(!0),e._m.isReady()&&We(i)&&0<i.length&&e._pushReport(a)):(s.setMessage("res:".concat(JSON.stringify(n))).end(!0),Le.e("".concat(t," failed. error:").concat(JSON.stringify(n))))}))):Le.e("".concat(this._pluginName,".setPushEventReportListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!ut(this._pushPlugin)&&Je(this._pushPlugin.getDeviceType))return e=(this._pushPlugin.getDeviceType()||{}).deviceType,Le.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,".").concat("_setToken"),n=this.get(12),o=1,a="",i="",s=(He(this._deviceToken)&&(o=0),this.getUniAppPlatform()),r=this.getDeviceBrand(),c=(s===L.IOS||s===L.IPAD||s===L.MAC?i=this._deviceToken:s===L.ANDROID&&(a=this._deviceToken),s=t({tokenID:a,pushMsg:o,sdkAppID:n.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:r,deviceToken:i,isWebUniapp:this._isWebUniapp},this._deviceInfo),new Zn("_setToken"));a="data:".concat(JSON.stringify(s)),c.setMessage("".concat(a)),Le.l("".concat(e," ").concat(a)),this.req({P:Gn.SET_TOKEN,data:s}).then((function(){c.end(),Le.w("".concat(e," ok"))})).catch((function(t){c.setError(t).end(),Le.e("".concat(e," failed. error:"),t),In(t)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach((function(t){t.type===S.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===S.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new Zn("_onBackground");this.req({P:Gn.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(){n.setMessage("c2cUnreadCount:".concat(e._c2cUnreadCount," groupUnreadCount:").concat(e._groupUnreadCount)).end(),Le.l("".concat(t," ok"))})).catch((function(e){n.setError(e).end(),Le.e("".concat(t," failed. error:"),e)}))}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new Zn("_onForeground");this.req({P:Gn.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then((function(){t.end(),Le.l("".concat(e," ok"))})).catch((function(n){t.setError(n).end(),Le.e("".concat(e," failed. error:"),n)}))}},{key:"_pushReport",value:function(e){var t=this,n="".concat(this._n,".").concat("_pushReport"),o=new Zn("_pushReport");this.req({P:Gn.PUSH_REPORT,data:{eventList:e.eventList}}).then((function(){o.end(),t._notifyReportSuccess(e)})).catch((function(e){o.setError(e).end(),Le.e("".concat(n," failed. error:"),e)}))}},{key:"_notifyReportSuccess",value:function(e){!ut(this._pushPlugin)&&Je(this._pushPlugin.notifyReportSuccess)&&(this._pushPlugin.notifyReportSuccess(e),Le.l("".concat(this._n,"._notifyReportSuccess ok")))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?L.IOS:"android"===e?L.ANDROID:1002===t?L.IPAD:1001===t?L.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Le.l("".concat(this._n,".reset"))}}]),Nr),cr=(r(wr,Nn),As=m(wr),i(wr,[{key:"init",value:function(){var e=this.get(18).getPlugin("tim-profanity-filter-plugin");e&&(this._plugin=new e({logger:Le,isArray:We,isMap:je,isDevMode:this.isDevMode()}),this._getLexicon())}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,t){var n=!0;if(this._plugin&&this._canIUseLexicon&&(!t||!t.messageControlInfo||!0!==t.messageControlInfo.excludedFromContentModeration)){t=e.type;var o=e.conversationType;if(t===S.MSG_TEXT||t===S.MSG_CUSTOM){var a,i="".concat(this._n,".filterMessage");if(Le.l("".concat(i)),t===S.MSG_TEXT){if(o===S.CONV_C2C?a="c2c_text_message":o===S.CONV_GROUP&&(a="group_text_message"),!this._isConfigOn(a))return n;var s=(r=this._plugin.filter(e.payload.text)).type,r=r.modifiedText;1===s?n=!1:2===s&&(e.payload.text=r)}else if(t===S.MSG_CUSTOM){if(o===S.CONV_C2C?a="c2c_custom_message":o===S.CONV_GROUP&&(a="group_custom_message"),!this._isConfigOn(a))return n;s=this._plugin.filter(e.payload.data),r=this._plugin.filter(e.payload.description),t=this._plugin.filter(e.payload.extension),1===s.type||1===r.type||1===t.type?n=!1:(2===s.type&&(e.payload.data=s.modifiedText),2===r.type&&(e.payload.description=r.modifiedText),2===t.type&&(e.payload.extension=t.modifiedText))}Le.l("".concat(i," done. isAllowedToSend:").concat(n))}}return n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),o={isAllowedToSend:!0,modifiedText:e};return this._plugin&&this._canIUseLexicon&&this._isConfigOn(t)&&(Le.l("".concat(n)),e=(t=this._plugin.filter(e)).type,t=t.modifiedText,1===e?o.isAllowedToSend=!1:2===e&&(o.modifiedText=t),Le.l("".concat(n," done. ret:"),o)),o}},{key:"_getLexicon",value:function(){var e=this,t=new Zn("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.req({P:Gn.GET_PROFANITY_LIST,data:{startIndex:this._startIndex,version:this._version}}).then((function(o){var a=(o=o.data).errorInfo,i=o.filterConfig,s=o.lexicon,r=o.strToken,c=o.completeFlag,l=o.nextStartIndex,u=o.version,d=(o=o.expiredTime,a.errorCode),p=a.errorMessage;return 0!==d?(e._isFetching=!1,Le.w("".concat(n," failed. error:"),a),void t.setCode(d).setMessage(p).end()):(e._onFilterConfig(i),e._getToken(r),1===c?(Le.l("".concat(n," done. version:").concat(u," expiredTime:").concat(o)),e._version=u,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*o,void e._plugin.onLexiconCompleted(s)):(e._startIndex=l,e._plugin.onLexiconSliced(s),void e._getLexicon()))})).catch((function(o){t.setError(o).end(),e._isFetching=!1,Le.l("".concat(n," failed. error:"),o)}))}},{key:"_onFilterConfig",value:function(e){var t=this;He(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach((function(n){t._filterConfigMap.set(n,e[n])})),Le.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return 1===this._filterConfigMap.get(e)}},{key:"_getToken",value:function(e){if(lt(e)){var t=e.length,n="";if(t%2==0)for(var o=0;o<=t-1;o+=2)n=(n+=e[o+1])+e[o];else{for(var a=0;a<t-1;a+=2)n=(n+=e[a+1])+e[a];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),wr),lr=(i(br,[{key:"_onCloudConfig",value:function(){var e=this,t=this._m.get(23).getCloudConfig("rtc_cmd");ut(t)||((t=JSON.parse(t)).forEach((function(t){e._TRTCCommandList.includes(t)||e._TRTCCommandList.push(t)})),this._setTRTCCommandMap())}},{key:"_setTRTCCommandMap",value:function(){for(var e,t=0,n=this._TRTCCommandList.length;t<n;t++)e=this._TRTCCommandList[t].split(".")[0],this._TRTCCommandMap.set(e,1)}},{key:"onRoomCustomDataReceived",value:function(e){this._m.getOEmitInst().emit(M.ROOM_CUSTOM_DATA_RECEIVED,e)}},{key:"sendTRTCCustomData",value:function(e){var t=e.serviceCommand,n=(e=e.data,"".concat(U.NAME.TUIROOM_SVR,".*"));return ut(t)||(n=t),this._isValidServiceCommand(n)?this._trans({servcmd:n,data:e}):In({code:Un.INVALID_TRTC_CMD})}},{key:"_trans",value:function(e){Le.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(e)));var t=e.servcmd;return e=e.data,this._m.get(20).trans({servcmd:t,data:lt(e)?JSON.parse(e):e})}},{key:"_isValidServiceCommand",value:function(e){return e.endsWith(".*")?this._TRTCCommandList.includes(e):(e=e.split(".")[0],this._TRTCCommandMap.has(e))}},{key:"isTRTCCommand",value:function(e){return e=e.split(".")[0],this._TRTCCommandMap.has(e)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),br),ur=(i(Dr,[{key:"_init",value:function(){var e,t=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(t){try{e=JSON.parse(t)}catch(n){this._getStorageModule().removeItem(this.TIM_ERROR_ASSISTANCE,!1),Le.w("".concat(this._n,"._init error:"),n)}e&&(this._needToUpdate(e)?this._fetch():this._fillMap(e.message))}else this._fetch()}},{key:"_needToUpdate",value:function(e){var t=e.localSavedTime;return e=e.localSavedVersion,t=t&&(new Date).getTime()-t>=this.STORAGE_EXPIRES_TIME,e=!e||"3.4.7"!==e,Le.l("".concat(this._n,"._needToUpdate isTimeout:").concat(t," isDifferentVersion:").concat(e)),t||e}},{key:"_fetch",value:function(){var e,t,n,o,a,i;this._m.get(12).isPrivateNetWork()||(e="https://web.sdk.qcloud.com/im/download/error-message/v3/0.0.6/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),o=this,Q?oe.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(e){o._fillAndSave(e.data),Le.l("".concat(n," mini program"))},fail:function(){}}):(a=new XMLHttpRequest,i=setTimeout((function(){a.abort()}),3e3),a.onreadystatechange=function(){4===a.readyState&&(clearTimeout(i),200!==a.status&&304!==a.status||(Le.l("".concat(n," browser")),o._fillAndSave(a.responseText)))},a.open("GET",e,!0),a.setRequestHeader("Content-type",t),a.send()))}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:(new Date).getTime(),localSavedVersion:"3.4.7"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.get(13)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,o=e.split(";\n"),a=o.length,i=new RegExp(/'/g),s=0;s<a;s++)if(n=o[s].indexOf(":"),t=o[s].slice(0,n),n=o[s].slice(n+1,o[s].length),!t.startsWith("//")){if(ut(n))continue;this._map.set(t,n.replace(i,""))}}},{key:"get",value:function(e){var t=e.isIntl,n=e.key,o=e.replacement1;return e=e.replacement2,t="".concat(n,t?"_en":"_cn"),!this._map.has(t)&&this._map.has(n)&&(t=n),n="",this._map.has(t)&&(n=this._map.get(t),ut(o)||(n=n.replace("$replacement1",o)),ut(e)||(n=n.replace("$replacement2",e))),n}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset"))}}]),Dr),dr=(i(Sr,[{key:"onNewMessageList",value:function(e){var t=this;e.forEach((function(e){var n=t.getPayloadData(e);n&&t._handleActionType(n,e)}))}},{key:"onMessageModified",value:function(e){var t=this;e.forEach((function(e){var n=t.getPayloadData(e);n&&t._onInvitationModified(n,e)}))}},{key:"getPayloadData",value:function(e){var t="".concat(this._n,".getPayloadData");e=e.payload.data;try{return JSON.parse(e)}catch(n){return Le.e("".concat(t," JSON parse error. signalingData:").concat(e)),null}}},{key:"_handleActionType",value:function(e,t){switch(e.actionType){case D.ACTION_TYPE_INVITE:this._onNewInvitationReceived(e,t);break;case D.ACTION_TYPE_REJECT_INVITE:this._onInviteeRejected(e);break;case D.ACTION_TYPE_ACCEPT_INVITE:this._onInviteeAccepted(e);break;case D.ACTION_TYPE_CANCEL_INVITE:this._onInvitationCancelled(e);break;case D.ACTION_TYPE_INVITE_TIMEOUT:this._onInvitationTimeout(e)}}},{key:"_genBaseEmitData",value:function(e){return{inviteID:e.inviteID,inviter:e.inviter,groupID:e.groupID,data:e.data||""}}},{key:"_onNewInvitationReceived",value:function(e,n){var o="".concat(this._n,"._onNewInvitationReceived"),a=e.inviteID,i=e.inviteeList,s=e.groupID,r=e.inviter,c=this._sigM.getMyUserID(),l=i.includes(c),u=e.timeout,d=(Ce().getTime()-1e3*n.time)/1e3;0<u&&0<d&&d<u&&(u-=d),o="".concat(o," myselfIncluded:").concat(l," groupID:").concat(s," signalObj:").concat(JSON.stringify(e)),Le.l("".concat(o," timeout:").concat(u,"s delta:").concat(d,"s")),!(s&&l||!s)||(o=this._sigM.getInviteInfo(a))&&o===e||(o||this._sigM.setInviteInfo(a,t(t({},e),{},{message:n})),this._sigM.emitEvent(D.NEW_INVITATION_RECEIVED,t(t({},this._genBaseEmitData(e)),{},{inviteeList:i})),r!==c&&this._sigM.startTimer(t(t({},e),{},{timeout:u})))}},{key:"_onInviteeRejected",value:function(e){var n="".concat(this._n,"._onInviteeRejected"),o=e.inviteID,a=e.inviter,i=e.groupID,s=this._sigM.hasInviteInfo(o);Le.l("".concat(n," inviteID:").concat(o," hasInviteID:").concat(s," inviter:").concat(a," groupID:").concat(i)),s&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(D.INVITEE_REJECTED,t(t({},this._genBaseEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInviteeAccepted",value:function(e){var n="".concat(this._n,"._onInviteeAccepted"),o=e.inviteID,a=e.inviter,i=e.groupID,s=this._sigM.hasInviteInfo(o);Le.l("".concat(n," inviteID:").concat(o," hasInviteID:").concat(s," inviter:").concat(a," groupID:").concat(i)),s&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(D.INVITEE_ACCEPTED,t(t({},this._genBaseEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInvitationCancelled",value:function(e){var t="".concat(this._n,"._onInvitationCancelled"),n=e.inviteID,o=e.inviter,a=e.groupID,i=this._sigM.hasInviteInfo(n);Le.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(i," inviter:").concat(o," groupID:").concat(a)),i&&(this._sigM.deleteInviteInfo(n),this._sigM.emitEvent(D.INVITATION_CANCELLED,this._genBaseEmitData(e)))}},{key:"_onInvitationTimeout",value:function(e){var n="".concat(this._n,"._onInvitationTimeout"),o=e.inviteID,a=e.inviter,i=e.groupID,s=e.inviteeList,r=this._sigM.hasInviteInfo(o);Le.l("".concat(n," inviteID:").concat(o," hasInviteID:").concat(r," inviter:").concat(a," groupID:").concat(i,"  data:").concat(e.data)),r&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(D.INVITATION_TIMEOUT,t(t({},this._genBaseEmitData(e)),{},{inviteeList:s,isSelfTimeout:!1})))}},{key:"_onInvitationModified",value:function(e,n){var o="".concat(this._n,"._onInvitationModified"),a=e.inviteID,i=e.data;Le.l("".concat(o," inviteID:").concat(a," data:").concat(i)),this._sigM.setInviteInfo(a,t(t({},e),{},{message:n})),this._sigM.emitEvent(D.INVITATION_MODIFIED,{inviteID:a,data:i})}}]),Sr),pr=(i(Mr,[{key:"generateInviteID",value:function(){var e,t=(t=Ns)((e=ws)(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12);return Le.l("".concat(this._n,".generateInviteID inviteID:").concat(t)),t}},{key:"createInviteInfo",value:function(e){var n=this.generateInviteID(),o=(e=this.createInviteCustomData(t(t({},e),{},{inviteID:n}))).groupID,a=e.inviteeList;return o=o||a[0],{customData:e,message:this._sigM.createSignaling(e,o),inviteID:n}}},{key:"_genBaseCustomData",value:function(e){var t=e.data,n=e.inviteID;return{businessID:1,timeout:0,data:void 0===t?"":t,inviteID:void 0===n?"":n,groupID:void 0===(e=e.groupID)?"":e}}},{key:"createInviteCustomData",value:function(e){var n=e.userID,o=void 0===(o=e.timeout)?0:o,a=void 0===(a=e.groupID)?"":a,i=this._sigM.getMyUserID();return i=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_INVITE,inviter:i,inviteeList:a?e.inviteeList:[n],timeout:o}),Le.l("".concat(this._n,".createInviteCustomData customData:"),i),i}},{key:"createCancelCustomData",value:function(e){var n,o="".concat(this._n,".createCancelCustomData"),a=e.inviteID,i=this._sigM.getMyUserID(),s=(a=this._sigM.getInviteInfo(a)).inviteeList,r=a.groupID;return(a=a.inviter)===i?n=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_CANCEL_INVITE,groupID:r,inviter:i,inviteeList:s}):Le.e("".concat(o," unmatched inviter:").concat(a," and my userID:").concat(i)),Le.l("".concat(o," customData:"),n),n}},{key:"createAcceptCustomData",value:function(e){var n,o="".concat(this._n,".createAcceptCustomData"),a=e.inviteID,i=this._sigM.getMyUserID(),s=this._sigM.getInviteInfo(a),r=s.inviter,c=s.groupID;return s.inviteeList.includes(i)?n=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_ACCEPT_INVITE,groupID:c,inviter:r,inviteeList:[i]}):Le.e("".concat(o," userID:").concat(i," not in inviteeList. inviteID:").concat(a," groupID:").concat(c)),Le.l("".concat(o," customData:"),n),n}},{key:"createRejectCustomData",value:function(e){var n,o="".concat(this._n,".createRejectCustomData"),a=e.inviteID,i=this._sigM.getMyUserID(),s=this._sigM.getInviteInfo(a),r=s.inviter,c=s.groupID;return s.inviteeList.includes(i)?n=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_REJECT_INVITE,groupID:c,inviter:r,inviteeList:[i]}):Le.e("".concat(o," userID:").concat(i," not in inviteeList. inviteID:").concat(a," groupID:").concat(c)),Le.l("".concat(o," customData:"),n),n}},{key:"createTimeoutCustomData",value:function(e){var n="".concat(this._n,".createTimeoutCustomData"),o=e.inviteeList,a=e.inviter,i=void 0!==(i=e.isInviter)&&i,s=this._sigM.getMyUserID();return e=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_INVITE_TIMEOUT,inviter:a,inviteeList:i?o:[s]}),Le.l("".concat(n," customData:"),e),e}}]),Mr),hr=(i(Tr,[{key:"setCloudConfig",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:300;this.COUNT=e,this.EXPIRED_TIME=t,Le.l("".concat(this._n,".setCloudConfig count:").concat(e,", time:").concat(t))}},{key:"getHistorySignaling",value:function(){var e=this,t=this._sigM.get(11).getLocalConvList();He(t)||(this._getC2CSignalingList(),t=this._getValidGroupConvList(t),this._getGroupSignalingList(t).then((function(t){e._handleSignalingList(t)})))}},{key:"_getC2CSignalingList",value:function(){var e=this._sigM.get(6).getMessageListFromUnreadDB();e=this._sigM.filterMessageList(e),this._getRelatedToMeMap(e)}},{key:"_getGroupSignalingList",value:function(e){var t=this;return 0===(e=this._createPromiseList(e)).length?Promise.resolve(this._sortSignaling(this._relatedToMeMap)):this._concurrentGetMessageList(e).then((function(e){var n=new Map;return e.forEach((function(e){e=e.list,e=t._getRelatedToMeMap(e),n=new Map([].concat(v(n),v(e)))})),t._sortSignaling(n)}))}},{key:"_handleSignalingList",value:function(e){He(e)||this._sigM.onNewMessageList(e)}},{key:"_getValidGroupConvList",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++){var a=(s=e[n]).type,i=s.unreadCount,s=s.lastMessage;a=a===S.CONV_GROUP,s=this._isNotExpired(s),a&&i&&s&&t.push(e[n])}return t}},{key:"_isNotExpired",value:function(e){return!(!e||!e.lastTime)&&e.lastTime>Te()-this.EXPIRED_TIME}},{key:"_createPromiseList",value:function(e){for(var t=[],n=0;n<e.length;n++){var o=(a=e[n]).conversationID,a=(a=a.unreadCount)<this.COUNT?a:this.COUNT;this._map.set(o,{msgCount:a,list:[]}),a=this._sigM.get(11).getMessageList({conversationID:o}),t.push(a)}return t}},{key:"_concurrentGetMessageList",value:function(e){var t=this,n=[];return Promise.all(e).then((function(e){for(var o=0;o<e.length;o++){var a=(i=e[o]).code,i=i.data;0===a&&0!==i.messageList.length&&(t._handleMessageList(i.messageList),a=t._relayGetMessageList(i))&&n.push(a)}return 0<n.length?t._concurrentGetMessageList(n):t._map}))}},{key:"_relayGetMessageList",value:function(e){var t,n=e.messageList,o=e.nextReqMessageID;return e=e.isCompleted,0===n.length||(n=n[0].conversationID,0===(t=this._map.get(n).msgCount))||e?null:this._sigM.get(11).getMessageList({conversationID:n,nextReqMessageID:o,count:t})}},{key:"_handleMessageList",value:function(e){var t=e.length,n=e[0].conversationID,o=(a=this._map.get(n)).msgCount,a=a.list;this._map.set(n,{msgCount:0<o-t?o-t:0,list:a.concat(this._sigM.filterMessageList(e))})}},{key:"_getRelatedToMeMap",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this._saveRelatedToMe(n)}return this._relatedToMeMap}},{key:"_saveRelatedToMe",value:function(e){var t,n=(t=this._sigM.getPayloadData(e)||{}).actionType,o=void 0===(t=t.inviteID)?"":t;switch(void 0===n?"":n){case D.ACTION_TYPE_INVITE:this._setHistoryInvite(e);break;case D.ACTION_TYPE_REJECT_INVITE:case D.ACTION_TYPE_ACCEPT_INVITE:this._updateHistoryInvite(e);break;case D.ACTION_TYPE_CANCEL_INVITE:this._delHistoryInvite(o);break;case D.ACTION_TYPE_INVITE_TIMEOUT:this._updateHistoryInvite(e)}}},{key:"_setHistoryInvite",value:function(e){var n=this._sigM.getPayloadData(e)||{},o=void 0===(o=n.inviteID)?"":o,a=void 0===(a=n.inviteeList)?[]:a,i=void 0===(i=n.timeout)?0:i,s=this._sigM.getMyUserID();a.includes(s)&&(a=Te()-e.time,0<i&&i<a&&0!==i||this._relatedToMeMap.set(o,t(t({},n),{},{messageList:[e]})))}},{key:"_delHistoryInvite",value:function(e){this._relatedToMeMap.has(e)&&this._relatedToMeMap.delete(e)}},{key:"_updateHistoryInvite",value:function(e){var t=void 0===(t=(a=this._sigM.getPayloadData(e)||{}).inviteID)?"":t,n=void 0===(a=a.inviteeList)?[]:a;if(this._relatedToMeMap.has(t)){for(var o=(a=this._relatedToMeMap.get(t)).inviteeList,a=a.messageList,i=0;i<n.length;i++){var s=n[i];o.includes(s)&&o.splice(o.indexOf(s),1)}0===o.length?this._delHistoryInvite(t):a.push(e)}else this._delHistoryInvite(t)}},{key:"_sortSignaling",value:function(e){var t=[];return e.forEach((function(e){t=[].concat(v(t),v(e.messageList))})),t.sort((function(e,t){return e.time-t.time}))}},{key:"reset",value:function(){this._map.clear(),this._relatedToMeMap.clear()}}]),Tr),gr=i((function e(t,n){o(this,e),this.businessID=t.businessID||1,this.inviteID=t.inviteID,this.groupID=t.groupID||"",this.inviter=t.inviter||"",this.inviteeList=t.inviteeList||[],this.data=t.data||"",this.actionType=t.actionType||D.ACTION_TYPE_INVITE,this.timeout=t.timeout||0})),mr=["message"],fr=["message"],vr=(r(kr,Nn),Rs=m(kr),i(kr,[{key:"onC2CUnreadHandleCompleted",value:function(){this._isC2CUnreadHandleCompleted=!0,this._isCloudConfigCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onConvSyncCompleted",value:function(){this._isConvSyncCompleted=!0,this._isC2CUnreadHandleCompleted&&this._isCloudConfigCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onCloudConfig",value:function(){this._isCloudConfigCompleted=!0;var e=this.getCloudConfig("history_s_count"),t=this.getCloudConfig("history_s_time");ut(e)||(e=Number(e)),ut(t)||(t=Number(t)),this._historySignalingHandler.setCloudConfig(e,t),this._isC2CUnreadHandleCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"_isListenerExisted",value:function(){return-1<this._m.getOEmitInst().eventNames().indexOf(D.NEW_INVITATION_RECEIVED)}},{key:"onReady",value:function(){this._isSyncCompleted=!0;var e=this._isListenerExisted();Le.l("".concat(this._n,".onReady. isListenerExisted: ").concat(e)),e&&this._historySignalingHandler.getHistorySignaling()}},{key:"onNewMessageList",value:function(e){if(0<(e=this.filterMessageList(e)).length)return this._remoteSignalingHandler.onNewMessageList(e)}},{key:"onMessageModified",value:function(e){if(0<(e=this.filterMessageList(e)).length)return this._remoteSignalingHandler.onMessageModified(e)}},{key:"hasInviteInfo",value:function(e){return this._inviteInfoMap.has(e)}},{key:"getInviteInfo",value:function(e){return this._inviteInfoMap.get(e)}},{key:"setInviteInfo",value:function(e,n){var o=n.message;n=h(n,mr),Le.l("".concat(this._n,".setInviteInfo inviteID:").concat(e," data:"),n),this._inviteInfoMap.set(e,t(t({},n),{},{message:o}))}},{key:"deleteInviteInfo",value:function(e){this.hasInviteInfo(e)&&(Le.l("".concat(this._n,".deleteInviteInfo inviteID:").concat(e,".")),this._inviteInfoMap.delete(e))}},{key:"updateInviteInfo",value:function(e){var t="".concat(this._n,".updateInviteInfo"),n=e.inviteID,o=e.inviter,a=e.inviteeList;e=e.groupID,Le.l("".concat(t," inviteID:").concat(n," inviter:").concat(o," groupID:").concat(e)),e&&this.hasInviteInfo(n)&&(o=a[0],(e=this.getInviteInfo(n).inviteeList).includes(o)&&(e.splice(e.indexOf(o),1),Le.l("".concat(t," remove ").concat(o,". localInviteeList.length:").concat(e.length))),0!==e.length)||this.deleteInviteInfo(n)}},{key:"canIUseSignaling",value:function(){return this._canIUseSignaling}},{key:"emitEvent",value:function(e,t){this.emitOEvt(e,t)}},{key:"addSignalingListener",value:function(e,t,n){this._canIUseSignaling||(this._canIUseSignaling=!0),this._m.getOEmitInst().on(e,t,n)}},{key:"removeSignalingListener",value:function(e,t,n){this._m.getOEmitInst().off(e,t,n),this._isListenerExisted()||(this._canIUseSignaling=!1)}},{key:"invite",value:function(e){var n=this,o="".concat(this._n,".").concat("invite"),a=this._localSignalingHandler.createInviteInfo(e),i=a.message,s=a.customData,r=a.inviteID;return Le.l("".concat(o," options:").concat(JSON.stringify(e)," inviteID:").concat(r)),this.sendSignaling(i,e).then((function(e){return e&&0===e.code?(n.setInviteInfo(r,t(t({},s),{},{message:i})),n.startTimer(t(t({},s),{},{inviteID:r})),t(t({},e),{},{inviteID:r})):e})).catch((function(e){return In(e)}))}},{key:"inviteSync",value:function(e,n,o){var a=this,i="".concat(this._n,".").concat("inviteSync"),s=this._localSignalingHandler.createInviteInfo(e),r=s.message,c=s.customData,l=s.inviteID;return Le.l("".concat(i," options:").concat(JSON.stringify(e)," inviteID:").concat(l)),this.sendSignaling(r,e).then((function(e){if(e&&0===e.code)return a.setInviteInfo(l,t(t({},c),{},{message:r})),a.startTimer(t(t({},c),{},{inviteID:l})),n&&n({inviteID:l}),{inviteID:l};o&&o(0===e.code,e.message||"")})).catch((function(e){return o&&o(e.code,e.message),In(e)})),l}},{key:"_handleImResponse",value:function(e,t,n){t&&0===t.code&&(this._isHandling=!1,n?this.deleteInviteInfo(e.inviteID):this.updateInviteInfo(e))}},{key:"cancel",value:function(e){var n=this,o="".concat(this._n,".").concat("cancel");if(Le.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return In({code:Un.INVALID_CANCEL_MESSAGE});this._isHandling=!0;var a,i=this._localSignalingHandler.createCancelCustomData(e);return i?(o=i.groupID,a=i.inviteeList,o=o||a[0],a=this.createSignaling(i,o),this.sendSignaling(a,e).then((function(o){return n._handleImResponse(i,o,!0),0===o.code?t(t({},o),{},{inviteID:e.inviteID}):o})).catch((function(e){return In(e)}))):(this._isHandling=!1,In({code:Un.SIGNALING_NO_PERMISSION}))}},{key:"accept",value:function(e){var n=this,o="".concat(this._n,".").concat("accept");if(Le.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return In({code:Un.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var a=this._localSignalingHandler.createAcceptCustomData(e);return a?(o=this.createSignaling(a),this.sendSignaling(o,e).then((function(o){return n._handleImResponse(a,o),0===o.code?t(t({},o),{},{inviteID:e.inviteID}):o})).catch((function(e){return In(e)}))):(this._isHandling=!1,In({code:Un.SIGNALING_NO_PERMISSION}))}},{key:"reject",value:function(e){var n=this,o="".concat(this._n,".").concat("reject");if(Le.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return In({code:Un.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var a=this._localSignalingHandler.createRejectCustomData(e);return a?(o=this.createSignaling(a),this.sendSignaling(o,e).then((function(o){return n._handleImResponse(a,o,!0),0===o.code?t(t({},o),{},{inviteID:e.inviteID}):o})).catch((function(e){return In(e)}))):(this._isHandling=!1,In({code:Un.SIGNALING_NO_PERMISSION}))}},{key:"getSignalingInfo",value:function(e){var t="".concat(this._n,".getSignalingInfo"),n=e.ID,o=e.from,a=e.to,i=this._filterSignaling(e),s=null;return i&&(e=this.getPayloadData(e),s=new gr(e)),e=i?"actionType:".concat(s.actionType):"",Le.l("".concat(t," messageID:").concat(n," from:").concat(o," to:").concat(a," ")+"".concat(e," isSignaling:").concat(i)),s}},{key:"modifyInvitation",value:function(e){var n=this,o=e.inviteID,a=e.data;if(!this.hasInviteInfo(e.inviteID)||this._isHandling)return In({code:Un.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var i=(e=this.getInviteInfo(o)).message,s=h(e,fr),r=i.payload.data;return s.data=a,i.payload.data=JSON.stringify(s),this.get(2).modifyRemoteMessage(i).then((function(e){return n.setInviteInfo(o,t(t({},s),{},{message:i})),n._isHandling=!1,e})).catch((function(e){return n._isHandling=!1,i.payload.data=r,In(e)}))}},{key:"_genMsgCtrlInfo",value:function(){var e=void 0===(e=(a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data)?"":e,t=a.onlineUserOnly,n=void 0===(n=a.inviteID)?"":n,o=a.offlinePushInfo,a=a.actionType,i={_onlineOnlyFlag:!1};return n={onlineUserOnly:(i=n&&this.getInviteInfo(n)?this.getInviteInfo(n).message:i)._onlineOnlyFlag||t||!1,offlinePushInfo:o,messageControlInfo:{excludedFromContentModeration:!0,excludedFromUnreadCount:!1,excludedFromLastMessage:!1}},a===D.ACTION_TYPE_INVITE_TIMEOUT?(i=!!e.match(/excludeTimeoutSignalingFromHistoryMessage/),n.messageControlInfo.excludedFromUnreadCount=i,n.messageControlInfo.excludedFromLastMessage=i):(t=!!e.match(/excludeFromHistoryMessage/),o=!!e.match(/excludeOriginalSignalingFromHistoryMessage/),n.messageControlInfo.excludedFromUnreadCount=t||o,n.messageControlInfo.excludedFromLastMessage=t||o),n}},{key:"sendSignaling",value:function(e,t){var n=this;return this.get(2).sendMessageInstance(e,this._genMsgCtrlInfo(t)).catch((function(e){return n._isHandling=!1,In(e)}))}},{key:"filterMessageList",value:function(e){var t=this;return e.filter((function(e){return t._filterSignaling(e)}))}},{key:"getPayloadData",value:function(e){return this._remoteSignalingHandler.getPayloadData(e)}},{key:"createSignaling",value:function(e,t){var n=e.groupID,o=e.inviter;return t={to:t||n||o,conversationType:n?S.CONV_GROUP:S.CONV_C2C,priority:S.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(e)}},o=this.get(2).createCustomMessage(t),Le.l("".concat(this._n,".createSignaling. message:"),o),o}},{key:"_filterSignaling",value:function(e){var t,n,o=!1;return e.type&&e.type===S.MSG_CUSTOM&&(t=e.cloudCustomData,e=void 0===(e=e.payload.data)?"":e,t=(void 0===t?"":t).match(/"type":"tsignaling"/),n=e.match(/inviteID/),e=e.match(/actionType/),o=t||n&&e),!!o}},{key:"startTimer",value:function(e){var t,n,o,a=this,i="".concat(this._n,".startTimer"),s=e.timeout,r=e.inviteID,c=e.inviter,l=e.groupID,u=c===this.getMyUserID();Le.l("".concat(i," timeout:").concat(s," isInviter:").concat(u," groupID:").concat(l)),s<=0||(t=u?s+5:s,n=1,o=setInterval((function(){var s=a._hasLocalInviteInfo(e,u);n<t&&s?++n:(s&&a._sendTimeoutNotice(r,u),Le.l("".concat(i," end.")),clearInterval(o))}),1e3))}},{key:"_hasLocalInviteInfo",value:function(e,t){var n,o,a=e.inviteID;return e=e.groupID,!!this.hasInviteInfo(a)&&(n="".concat(this._n,"._hasLocalInviteInfo"),o=this.getInviteInfo(a).inviteeList,Le.l("".concat(n," inviteID:").concat(a," inviteeList:").concat(o," groupID:").concat(e)),!e||(t?0<o.length:0<o.length&&o.includes(this.getMyUserID())))}},{key:"_getReceiver",value:function(e,t){var n=t.groupID,o=t.inviteeList;return t=t.inviter,e?n||o[0]:n||t}},{key:"_sendTimeoutNotice",value:function(e,n){var o=this,a=this.getInviteInfo(e),i=this._getReceiver(n,a),s=(Le.l("".concat(this._n,"._sendTimeoutNotice inviteID:").concat(e," to:").concat(i," isInviter:").concat(n)),this._localSignalingHandler.createTimeoutCustomData(t(t({},a),{},{isInviter:n}))),r=this.createSignaling(s,i);return this.sendSignaling(r,s).then((function(t){var a,i,c;t&&0===t.code&&(t=s.data,a=s.groupID,i=s.inviteeList,c=s.inviter,o.emitEvent(D.INVITATION_TIMEOUT,{data:t,groupID:a,inviteID:e,inviteeList:i,inviter:c,isSelfTimeout:!0,message:r}),n?o.deleteInviteInfo(e):o.updateInviteInfo(s))}))}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._inviteInfoMap.clear(),this._canIUseSignaling=!1,this._isHandling=!1,this._historySignalingHandler.reset(),this._isC2CUnreadHandleCompleted=!1,this._isConvSyncCompleted=!1,this._isSyncCompleted=!1,this._isCloudConfigCompleted=!1}}]),kr),_r=["followDiffList"],yr={NONE:0,FOLLOWERS:1,FOLLOWING:2,MUTUAL:3},Ir=(r(Cr,Nn),Ls=m(Cr),i(Cr,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("follow_req_count");ut(e)||(e=Number(e),this.DEFAULT_COUNT=e>this.MAX_COUNT?this.MAX_COUNT:e,this._clearFollowList())}},{key:"clearCacheOnReconnected",value:function(){this._clearFollowList(),this._followType.clear()}},{key:"onFollowNotify",value:function(e){var t=this;e=e.dataList||[],Le.l("".concat(this._n,".onFollowNotify followChangeList:").concat(e.length)),e.forEach((function(e){var n=void 0===(n=e.followDiffList)?[]:n,o=h(e,_r);n.forEach((function(e){var n=e.isAdd,a=(e=void 0===(e=e.followType)?[]:e,t._initFollowInfo());a[e].userInfoList.push(o),a[e].isAdd=1===n,t._emitEvent(a)}))}))}},{key:"_initFollowInfo",value:function(){var e={};return Object.values(yr).forEach((function(t){t!==yr.NONE&&(e[t]={userInfoList:[],isAdd:!1})})),e}},{key:"_emitEvent",value:function(e){var t=this;Object.keys(e).forEach((function(n){n=Number(n);var o=e[n];0<o.userInfoList.length&&(n===yr.FOLLOWERS&&(t._clearFollowList(yr.FOLLOWERS),t.emitOEvt(M.MY_FOLLOWERS_LIST_UPDATED,o)),n===yr.FOLLOWING&&(t._clearFollowList(yr.FOLLOWING),t.emitOEvt(M.MY_FOLLOWING_LIST_UPDATED,o)),n===yr.MUTUAL)&&(t._clearFollowList(yr.MUTUAL),t.emitOEvt(M.MUTUAL_FOLLOWERS_LIST_UPDATED,o))}))}},{key:"followUser",value:function(e){var t,n,o;return this.canIUse(P.FOLLOW)?(t="".concat(this._n,".").concat("followUser"),n="userIDList:".concat(e.length),(o=new Zn("followUser")).setMessage(n),Le.l("".concat(t," ").concat(n)),this.req({P:Gn.FOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e.map((function(e){return{userID:e}}))}}).then((function(e){return o.end(),Le.l("".concat(t," ok.")),_n(e.data.resultList)})).catch((function(e){return o.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this.noUse("followUser")}},{key:"unfollowUser",value:function(e){var t,n,o;return this.canIUse(P.FOLLOW)?(t="".concat(this._n,".").concat("unfollowUser"),n="userIDList:".concat(e.length),(o=new Zn("unfollowUser")).setMessage(n),Le.l("".concat(t," ").concat(n)),this.req({P:Gn.UNFOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e}}).then((function(e){return o.end(),Le.l("".concat(t," ok.")),_n(e.data.resultList)})).catch((function(e){return o.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this.noUse("unfollowUser")}},{key:"getMyFollowersList",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o="getMyFollowersList";if(!this.canIUse(P.FOLLOW))return this.noUse(o);var a=n||this.FIRST_PAGE_INDEX;if(this._myFollowersList.has(a)){var i=(r=this._myFollowersList.get(a)).resultList,s=r.nextCursor,r=r.lastUpdateTime;if(Date.now()-r<this.MAX_CATCH_TIME&&0<i.length)return Le.l("".concat(this._n,".").concat(o," nextCursor:").concat(n," from local.")),yn({resultList:i,nextCursor:s})}return this._getFollowList(n,yr.FOLLOWERS).then((function(i){return e._myFollowersList.set(a,t(t({},i),{},{lastUpdateTime:Date.now()})),Le.l("".concat(e._n,".").concat(o," nextCursor:").concat(n," from remote.")),_n(i)}))}},{key:"getMyFollowingList",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o="getMyFollowingList";if(!this.canIUse(P.FOLLOW))return this.noUse(o);var a=n||this.FIRST_PAGE_INDEX;if(this._myFollowingList.has(a)){var i=(r=this._myFollowingList.get(a)).resultList,s=r.nextCursor,r=r.lastUpdateTime;if(Date.now()-r<this.MAX_CATCH_TIME&&0<i.length)return Le.l("".concat(this._n,".").concat(o," nextCursor:").concat(n," from local.")),yn({resultList:i,nextCursor:s})}return this._getFollowList(n,yr.FOLLOWING).then((function(i){return e._myFollowingList.set(a,t(t({},i),{},{lastUpdateTime:Date.now()})),Le.l("".concat(e._n,".").concat(o," nextCursor:").concat(n," from remote.")),_n(i)}))}},{key:"getMutualFollowersList",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o="getMutualFollowersList";if(!this.canIUse(P.FOLLOW))return this.noUse(o);var a=n||this.FIRST_PAGE_INDEX;if(this._myMutualFollowersList.has(a)){var i=(r=this._myMutualFollowersList.get(a)).resultList,s=r.nextCursor,r=r.lastUpdateTime;if(Date.now()-r<this.MAX_CATCH_TIME&&0<i.length)return Le.l("".concat(this._n,".").concat(o," nextCursor:").concat(n," from local.")),yn({resultList:i,nextCursor:s})}return this._getFollowList(n,yr.MUTUAL).then((function(i){return e._myMutualFollowersList.set(a,t(t({},i),{},{lastUpdateTime:Date.now()})),Le.l("".concat(e._n,".").concat(o," nextCursor:").concat(n," from remote.")),_n(i)}))}},{key:"_getFollowList",value:function(e,n){var o=this,a=new Zn("_getFollowList");return a.setMessage("nextCursor:".concat(e," type:").concat(n)),this.req({P:Gn.GET_FOLLOW,data:{fromAccount:this.getMyUserID(),count:this.DEFAULT_COUNT,nextCursor:e,type:n}}).then((function(e){a.end();var n=void 0===(n=(e=e.data).resultList)?[]:n,i=(e=void 0===(e=e.nextCursor)?"":e,[]);return n.forEach((function(e){var n=e.userID,a=e.followTime;e=e.profileList,i.push(t({userID:n,followTime:a},o._handleProfileItem(void 0===e?[]:e)))})),{resultList:i,nextCursor:e}})).catch((function(e){return a.setError(e).end(),Le.e("".concat(o._n,"._getFollowList failed. error:"),e),In(e)}))}},{key:"_handleProfileItem",value:function(e){var t={};return e.forEach((function(e){switch(e.tag){case Ae.NICK:t.nick=e.value;break;case Ae.GENDER:t.gender=e.value;break;case Ae.BIRTHDAY:t.birthday=e.value;break;case Ae.LOCATION:t.location=e.value;break;case Ae.SELFSIGNATURE:t.selfSignature=e.value;break;case Ae.ALLOWTYPE:t.allowType=e.value;break;case Ae.LANGUAGE:t.language=e.value;break;case Ae.AVATAR:t.avatar=e.value;break;case Ae.MESSAGESETTINGS:t.messageSettings=e.value;break;case Ae.ADMINFORBIDTYPE:t.adminForbidType=e.value;break;case Ae.LEVEL:t.level=e.value;break;case Ae.ROLE:t.role=e.value;break;default:t[e.tag]=e.value}})),t}},{key:"getUserFollowInfo",value:function(e){var t,n,o;return this.canIUse(P.FOLLOW)?(n=!1,ut(e)&&(e=[this.getMyUserID()],n=!0),t="".concat(this._n,".").concat("getUserFollowInfo"),n="userIDList:".concat(e.length," isGetMyFollowInfo:").concat(n),(o=new Zn("getUserFollowInfo")).setMessage(n),Le.l("".concat(t," ").concat(n)),this.req({P:Gn.GET_FOLLOW_INFO,data:{fromAccount:this.getMyUserID(),userIDList:e}}).then((function(e){o.end(),Le.l("".concat(t," ok.")),e=e.data.followInfoList;var n=[];return(void 0===e?[]:e).forEach((function(e){var t=e.followersCount,o=e.followingCount;e=e.mutualFollowersCount,n.push({followersCount:t,followingCount:o,mutualFollowersCount:e})})),_n(n)})).catch((function(e){return o.setError(e).end(),Le.e("".concat(t," failed. error:"),e),In(e)}))):this.noUse("getUserFollowInfo")}},{key:"checkFollowType",value:function(e){var t=this;if(!this.canIUse(P.FOLLOW))return this.noUse("checkFollowType");100<e.length&&(e=e.slice(0,100),Le.w("".concat(n," ").concat(Ht(100))));var n="".concat(this._n,".").concat("checkFollowType"),o="userIDList length:".concat(e.length," "),a=new Zn("checkFollowType"),i=(a.setMessage(o),Le.l("".concat(n," ").concat(o)),[]),s=[];return e.forEach((function(e){var n;t._followType.has(e)?(n=t._followType.get(e),i.push({userID:e,followType:n})):s.push(e)})),Le.l("".concat(n," from local count:").concat(i.length,", from remote count:").concat(s.length,".")),0===s.length?yn(i):this.req({P:Gn.CHECK_FOLLOW_TYPE,data:{fromAccount:this.getMyUserID(),userIDList:s}}).then((function(e){return a.end(),Le.l("".concat(n," ok.")),(void 0===(e=e.data.resultList)?[]:e).forEach((function(e){var n=e.userID;e=e.followType,t._setFollowType(n,e),i.push({userID:n,followType:e})})),_n(i)})).catch((function(e){return a.setError(e).end(),Le.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"_setFollowType",value:function(e,t){this._followType.set(e,t)}},{key:"_clearFollowList",value:function(e){ut(e)?(this._myFollowersList.clear(),this._myFollowingList.clear(),this._myMutualFollowersList.clear()):e!==yr.FOLLOWERS?e!==yr.FOLLOWING?e===yr.MUTUAL&&this._myMutualFollowersList.clear():this._myFollowingList.clear():this._myFollowersList.clear()}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._clearFollowList(),this._followType.clear()}}]),Cr),Er=_i((function(e,t){var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t,o,a=Array.prototype.slice.call(arguments,1);a.length;){var i=a.shift();if(i){if("object"!==n(i))throw new TypeError(i+"must be non-object");for(var s in i)t=i,o=s,Object.prototype.hasOwnProperty.call(t,o)&&(e[s]=i[s])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,o,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+o),a);else for(var i=0;i<o;i++)e[a+i]=t[n+i]},flattenChunks:function(e){for(var t,n,o,a=0,i=0,s=e.length;i<s;i++)a+=e[i].length;for(o=new Uint8Array(a),i=t=0,s=e.length;i<s;i++)n=e[i],o.set(n,t),t+=n.length;return o}},i={arraySet:function(e,t,n,o,a){for(var i=0;i<o;i++)e[a+i]=t[n+i]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(o)}));function Cr(e){return o(this,Cr),(e=Ls.call(this,e))._n="FollowModule",e._myFollowersList=new Map,e._myFollowingList=new Map,e._myMutualFollowersList=new Map,e._followType=new Map,e.MAX_CATCH_TIME=6e5,e.FIRST_PAGE_INDEX=at(),e.DEFAULT_COUNT=500,e.MAX_COUNT=1e3,e.getIEmitInst().on(Bo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function kr(e){o(this,kr),(e=Rs.call(this,e))._n="SignalingModule",e._inviteInfoMap=new Map,e._canIUseSignaling=!1,e._isHandling=!1,e._remoteSignalingHandler=new dr(g(e)),e._localSignalingHandler=new pr(g(e)),e._historySignalingHandler=new hr(g(e)),e._isC2CUnreadHandleCompleted=!1,e._isConvSyncCompleted=!1,e._isSyncCompleted=!1,e._isCloudConfigCompleted=!1;var t=e.getIEmitInst();return t.on(Bo.C2C_UNREAD_HANDLE_COMPLETED,e.onC2CUnreadHandleCompleted,g(e)),t.on(Bo.CONV_SYNC_COMPLETED,e.onConvSyncCompleted,g(e)),t.on(Bo.CLOUD_CONFIG,e.onCloudConfig,g(e)),e}function Tr(e){o(this,Tr),this._n="HistorySignalingHandler",this._sigM=e,this.COUNT=20,this.EXPIRED_TIME=300,this._map=new Map,this._relatedToMeMap=new Map}function Mr(e){o(this,Mr),this._n="LocalSignalingHandler",this._sigM=e}function Sr(e){o(this,Sr),this._n="RemoteSignalingHandler",this._sigM=e}function Dr(e){o(this,Dr),this._m=e,this._n="ErrMsgModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}function br(e){o(this,br),this._m=e,this._n="TransCmdModule",this._TRTCCommandList=["tui_room_svr.*","callkit_records_svr.*","room_engine_srv.*","room_engine_http_srv.*","room_engine_mic.*","live_engine_srv.*","live_engine_http_srv.*","live_engine_pk.*","trtc_ai_service.*"],this._TRTCCommandMap=new Map,this._setTRTCCommandMap(),this._m.getIEmitInst().on(Bo.CLOUD_CONFIG,this._onCloudConfig,this)}function wr(e){return o(this,wr),(e=As.call(this,e))._n="ProfanityFilterModule",e._plugin=null,e._filterConfigMap=new Map,e._startIndex=0,e._version=0,e._canIUseLexicon=!1,e._isFetching=!1,e._expiredTime=0,e}function Nr(e){var t;return o(this,Nr),(t=Os.call(this,e))._m=e,t._n="TIMPushModule",t._pluginName="TIMPush",t._pushPlugin=void 0,t._androidPushConfig={},t._deviceToken="",t._businessID=0,t._iOSBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t._deviceInfo={notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:"1.0.1",packageName:""},t}function Lr(e){var t;return o(this,Lr),(t=Us.call(this,e))._m=e,t._n="OfflinePushModule",t._offlinePushPlugin=void 0,t._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},t._deviceToken="",t._businessID=0,t._iosBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t}function Rr(e){o(this,Rr),this._m=e,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new ar(this)}function Ar(e){o(this,Ar),this._commercialConfigM=e,this._n="PurchasedFeatureHandler",this._isSCMReported=!1,this._featureMap=new Map}function Or(e){return o(this,Or),(e=Ps.call(this,e))._n="WorkerTimerModule",e._isWorkerEnabled=!0,e._workerTimer=null,e._timerID=-1,e._init(),e.getIEmitInst().on(Bo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Ur(e){return o(this,Ur),(e=Gs.call(this,e))._n="SnsModule",e._friendHandler=new Qs(g(e)),e._friendApplicationHandler=new Xs(g(e)),e._friendGroupHandler=new tr(g(e)),e.getIEmitInst().on(Bo.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,g(e)),e}function Pr(e){o(this,Pr),this._snsM=e,this._n="FriendGroupHandler",this._map=new Map}function Gr(e){o(this,Gr),He(e)||(this.name=e.name||"",this.userIDList=e.userIDList||[],this.count=this.userIDList.length||0)}function xr(e){o(this,xr),this._snsM=e,this._n="FriendHandler",this._map=new Map,this._startIdx=0,this._standardSeq=0,this._customSeq=0,this._expirationTime=18e4}function Br(e,n){o(this,Br),this.userID=e,this.remark="",this.groupList=[],this.source="",this.addTime=0,this.friendCustomField=[],this.timestamp=0;var a={},i=[];if(a.userID=e,!He(n))for(var s,r="",c=0,l=n.length;c<l;c++)if(r=n[c].tag,s=n[c].value,-1<r.indexOf("Tag_SNS_Custom"))this.friendCustomField.push({key:r,value:s});else if(-1<r.indexOf("Tag_Profile_Custom"))i.push({key:r,value:s});else switch(r){case Ae.NICK:a.nick=s;break;case Ae.GENDER:a.gender=s;break;case Ae.BIRTHDAY:a.birthday=s;break;case Ae.LOCATION:a.location=s;break;case Ae.SELFSIGNATURE:a.selfSignature=s;break;case Ae.ALLOWTYPE:a.allowType=s;break;case Ae.LANGUAGE:a.language=s;break;case Ae.AVATAR:a.avatar=s;break;case Ae.MESSAGESETTINGS:a.messageSettings=s;break;case Ae.ADMINFORBIDTYPE:a.adminForbidType=s;break;case Ae.LEVEL:a.level=s;break;case Ae.ROLE:a.role=s;break;case Oe.REMARK:this.remark=s;break;case Oe.ADDTIME:this.addTime=s;break;case Oe.GROUP:this.groupList=JSON.parse(JSON.stringify(s));break;case Oe.ADDSOURCE:this.source=s;break;case Oe.ADDWORDING:break;default:Le.l("snsProfileItem unknown tag->",n[c].tag)}this.profile=new ea(t(t({},a),{},{profileCustomField:i}))}function Vr(e){o(this,Vr),this._snsM=e,this._n="FriendApplicationHandler",this._startTime=0,this._maxLimited=100,this._currentSeq=0,this._map=new Map,this._unreadCount=0}function Fr(e){o(this,Fr),(e=xs.call(this,e))._n="QualityStatModule",e.TAG="im-ssolog-quality-stat",e.reportIndex=0,e.wholePeriod=!1,e._qualityItems=[xn,Bn,Vn,Fn,Hn,jn,qn,zn,Kn,$n],e._messageSentItems=[Vn,Fn,Hn,jn,qn],e._messageReceivedItems=[zn,Kn,$n],e.REPORT_INTERVAL=120,e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._statInfoArr=[],e._avgRTT=new Ks,e._avgE2EDelay=new zs,e._rateMessageSent=new $s,e._rateMessageReceived=new Ys;var t=e.getIEmitInst();return t.on(Bo.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,g(e)),t.on(Bo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Hr(){o(this,Hr),this._lastMap=new Map,this._currentMap=new Map}function jr(){o(this,jr),this._map=new Map}function qr(){o(this,qr),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}function zr(){o(this,zr),this._n="AvgE2EDelay",this._e2eDelayArray=[]}function Kr(e){return o(this,Kr),(e=Bs.call(this,e))._n="RecoverMsgModule",e.PULL_LIMIT_COUNT=15,e}function $r(e){return o(this,$r),(e=Vs.call(this,e))._n="CloudControlModule",e._cloudConfig=new Map,e._expiredTime=0,e._version=0,e._isFetching=!1,e}function Yr(e){return o(this,Yr),(e=Fs.call(this,e))._n="SessionModule",e._platform=e.getPlatform(),e._pHandler=new ms(g(e)),e._msgDispatcher=new vs(g(e)),e._cmdFreqLimitMap=new Map,e._cmdReqInfoMap=new Map,e._serverOverloadInfoMap=new Map,e._incrementalPullContactFlag=!0,e._init(),e.getIEmitInst().on(Bo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Wr(e,t,n,o){for(var a=65535&e,i=e>>>16&65535,s=0;0!==n;){for(n-=s=2e3<n?2e3:n;i=i+(a=a+t[o++]|0)|0,--s;);a%=65521,i%=65521}return a|i<<16}function Jr(e,t,n,o){var a=Zr,i=o+n;e^=-1;for(var s=o;s<i;s++)e=e>>>8^a[255&(e^t[s])];return~e}function Xr(e,t,n,o,a,i,s,r){var c,l,u,d,p,h,g,m,f,v=r.bits,_=0,y=0,I=0,E=0,C=0,k=0,T=0,M=0,S=0,D=0,b=null,w=0,N=new Er.Buf16(16),L=new Er.Buf16(16),R=null,A=0;for(_=0;_<=15;_++)N[_]=0;for(y=0;y<o;y++)N[t[n+y]]++;for(C=v,E=15;1<=E&&0===N[E];E--);if(E<C&&(C=E),0===E)a[i++]=20971520,a[i++]=20971520,r.bits=1;else{for(I=1;I<E&&0===N[I];I++);for(C<I&&(C=I),_=M=1;_<=15;_++)if((M=(M<<1)-N[_])<0)return-1;if(0<M&&(0===e||1!==E))return-1;for(L[1]=0,_=1;_<15;_++)L[_+1]=L[_]+N[_];for(y=0;y<o;y++)0!==t[n+y]&&(s[L[t[n+y]]++]=y);if(h=0===e?(b=R=s,19):1===e?(b=Qr,w-=257,R=ec,A-=257,256):(b=tc,R=nc,-1),_=I,p=i,T=y=D=0,u=-1,d=(S=1<<(k=C))-1,1===e&&852<S||2===e&&592<S)return 1;for(;;){for(f=s[y]<h?(m=0,s[y]):s[y]>h?(m=R[A+s[y]],b[w+s[y]]):(m=96,0),c=1<<(g=_-T),I=l=1<<k;a[p+(D>>T)+(l-=c)]=g<<24|m<<16|f,0!==l;);for(c=1<<_-1;D&c;)c>>=1;if(D=0!==c?(D&c-1)+c:0,y++,0==--N[_]){if(_===E)break;_=t[n+s[y]]}if(C<_&&(D&d)!==u){for(p+=I,M=1<<(k=_-(T=0===T?C:T));k+T<E&&!((M-=N[k+T])<=0);)k++,M<<=1;if(S+=1<<k,1===e&&852<S||2===e&&592<S)return 1;a[u=D&d]=C<<24|k<<16|p-i}}0!==D&&(a[p+D]=_-T<<24|64<<16),r.bits=C}return 0}Er.assign,Er.shrinkBuf,Er.setTyped,Er.Buf8,Er.Buf16,Er.Buf32;var Zr=function(){for(var e=[],t=0;t<256;t++){for(var n=t,o=0;o<8;o++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),Qr=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ec=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],tc=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],nc=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function oc(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ac(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Er.Buf16(320),this.work=new Er.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ic(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Er.Buf32(852),t.distcode=t.distdyn=new Er.Buf32(592),t.sane=1,t.back=-1,0):-2}function sc(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ic(e)):-2}function rc(e,t){var n,o;return!e||!e.state||(o=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t))?-2:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,sc(e))}function cc(e,t){var n;return e?(n=new ac,(e.state=n).window=null,0!==(n=rc(e,t))&&(e.state=null),n):-2}var lc,uc,dc=!0;function pc(e,t,n,o){var a;return null===(e=e.state).window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new Er.Buf8(e.wsize)),o>=e.wsize?(Er.arraySet(e.window,t,n-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):((a=e.wsize-e.wnext)>o&&(a=o),Er.arraySet(e.window,t,n-o,a,e.wnext),(o-=a)?(Er.arraySet(e.window,t,n-o,o,0),e.wnext=o,e.whave=e.wsize):(e.wnext+=a,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=a))),0}var hc={inflateReset:sc,inflateReset2:rc,inflateResetKeep:ic,inflateInit:function(e){return cc(e,15)},inflateInit2:cc,inflate:function(e,t){var n,o,a,i,s,r,c,l,u,d,p,h,g,m,f,v,_,y,I,E,C,k,T,M,S=0,D=new Er.Buf8(4),b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),s=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,o=e.input,r=e.avail_in,l=n.hold,u=n.bits,d=r,p=c,k=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap)n.mode=13;else{for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(2&n.wrap&&35615===l)D[n.check=0]=255&l,D[1]=l>>>8&255,n.check=Jr(n.check,D,2,0),u=l=0,n.mode=2;else if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31)e.msg="incorrect header check",n.mode=30;else if(8!=(15&l))e.msg="unknown compression method",n.mode=30;else{if(u-=4,C=8+(15&(l>>>=4)),0===n.wbits)n.wbits=C;else if(C>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<C,e.adler=n.check=1,n.mode=512&l?10:12,u=l=0}}break;case 2:for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(n.flags=l,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&(D[0]=255&l,D[1]=l>>>8&255,n.check=Jr(n.check,D,2,0)),u=l=0,n.mode=3;case 3:for(;u<32;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.head&&(n.head.time=l),512&n.flags&&(D[0]=255&l,D[1]=l>>>8&255,D[2]=l>>>16&255,D[3]=l>>>24&255,n.check=Jr(n.check,D,4,0)),u=l=0,n.mode=4;case 4:for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&(D[0]=255&l,D[1]=l>>>8&255,n.check=Jr(n.check,D,2,0)),u=l=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&(D[0]=255&l,D[1]=l>>>8&255,n.check=Jr(n.check,D,2,0)),u=l=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((h=(h=n.length)>r?r:h)&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Er.arraySet(n.head.extra,o,i,h,C)),512&n.flags&&(n.check=Jr(n.check,o,h,i)),r-=h,i+=h,n.length-=h),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===r)break e;for(h=0;C=o[i+h++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C)),C&&h<r;);if(512&n.flags&&(n.check=Jr(n.check,o,h,i)),r-=h,i+=h,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===r)break e;for(h=0;C=o[i+h++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C)),C&&h<r;);if(512&n.flags&&(n.check=Jr(n.check,o,h,i)),r-=h,i+=h,C)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}u=l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;u<32;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}e.adler=n.check=oc(l),u=l=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=r,n.hold=l,n.bits=u,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last)l>>>=7&u,u-=7&u,n.mode=27;else{for(;u<3;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}switch(n.last=1&l,--u,3&(l>>>=1)){case 0:n.mode=14;break;case 1:w=N=void 0;var w,N=n;if(dc){for(lc=new Er.Buf32(512),uc=new Er.Buf32(32),w=0;w<144;)N.lens[w++]=8;for(;w<256;)N.lens[w++]=9;for(;w<280;)N.lens[w++]=7;for(;w<288;)N.lens[w++]=8;for(Xr(1,N.lens,0,288,lc,0,N.work,{bits:9}),w=0;w<32;)N.lens[w++]=5;Xr(2,N.lens,0,32,uc,0,N.work,{bits:5}),dc=!1}if(N.lencode=lc,N.lenbits=9,N.distcode=uc,N.distbits=5,n.mode=20,6!==t)break;l>>>=2,u-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}l>>>=2,u-=2}break;case 14:for(l>>>=7&u,u-=7&u;u<32;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&l,u=l=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(h=n.length){if(0===(h=c<(h=r<h?r:h)?c:h))break e;Er.arraySet(a,o,i,h,s),r-=h,i+=h,c-=h,s+=h,n.length-=h}else n.mode=12;break;case 17:for(;u<14;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(n.nlen=257+(31&l),l>>>=5,u-=5,n.ndist=1+(31&l),l>>>=5,u-=5,n.ncode=4+(15&l),l>>>=4,u-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.lens[b[n.have++]]=7&l,l>>>=3,u-=3}for(;n.have<19;)n.lens[b[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},k=Xr(0,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,k){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;v=(S=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,_=65535&S,!((f=S>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(_<16)l>>>=f,u-=f,n.lens[n.have++]=_;else{if(16===_){for(M=f+2;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(l>>>=f,u-=f,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}C=n.lens[n.have-1],h=3+(3&l),l>>>=2,u-=2}else if(17===_){for(M=f+3;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}C=0,h=3+(7&(l>>>=f)),l>>>=3,u=u-f-3}else{for(M=f+7;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}C=0,h=11+(127&(l>>>=f)),l>>>=7,u=u-f-7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;h--;)n.lens[n.have++]=C}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,T={bits:n.lenbits},k=Xr(1,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,k){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},k=Xr(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,k){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=r&&258<=c){e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=r,n.hold=l,n.bits=u,q=F=P=U=O=A=R=L=oe=ne=te=ee=Q=Z=X=J=W=Y=$=K=z=j=H=V=B=void 0;var L,R,A,O,U,P,G=e,x=p,B=G.state,V=G.next_in,F=G.input,H=V+(G.avail_in-5),j=G.next_out,q=G.output,z=j-(x-G.avail_out),K=j+(G.avail_out-257),$=B.dmax,Y=B.wsize,W=B.whave,J=B.wnext,X=B.window,Z=B.hold,Q=B.bits,ee=B.lencode,te=B.distcode,ne=(1<<B.lenbits)-1,oe=(1<<B.distbits)-1;t:do{for(Q<15&&(Z+=F[V++]<<Q,Q+=8,Z+=F[V++]<<Q,Q+=8),L=ee[Z&ne];;){if(Z>>>=R=L>>>24,Q-=R,0==(R=L>>>16&255))q[j++]=65535&L;else{if(!(16&R)){if(!(64&R)){L=ee[(65535&L)+(Z&(1<<R)-1)];continue}if(32&R){B.mode=12;break t}G.msg="invalid literal/length code",B.mode=30;break t}for(A=65535&L,(R&=15)&&(Q<R&&(Z+=F[V++]<<Q,Q+=8),A+=Z&(1<<R)-1,Z>>>=R,Q-=R),Q<15&&(Z+=F[V++]<<Q,Q+=8,Z+=F[V++]<<Q,Q+=8),L=te[Z&oe];;){if(Z>>>=R=L>>>24,Q-=R,!(16&(R=L>>>16&255))){if(!(64&R)){L=te[(65535&L)+(Z&(1<<R)-1)];continue}G.msg="invalid distance code",B.mode=30;break t}if(O=65535&L,Q<(R&=15)&&(Z+=F[V++]<<Q,(Q+=8)<R)&&(Z+=F[V++]<<Q,Q+=8),(O+=Z&(1<<R)-1)>$){G.msg="invalid distance too far back",B.mode=30;break t}if(Z>>>=R,Q-=R,O>(R=j-z)){if((R=O-R)>W&&B.sane){G.msg="invalid distance too far back",B.mode=30;break t}if(P=X,(U=0)===J){if(U+=Y-R,R<A){for(A-=R;q[j++]=X[U++],--R;);U=j-O,P=q}}else if(J<R){if(U+=Y+J-R,(R-=J)<A){for(A-=R;q[j++]=X[U++],--R;);if(U=0,J<A){for(A-=R=J;q[j++]=X[U++],--R;);U=j-O,P=q}}}else if(U+=J-R,R<A){for(A-=R;q[j++]=X[U++],--R;);U=j-O,P=q}for(;2<A;)q[j++]=P[U++],q[j++]=P[U++],q[j++]=P[U++],A-=3;A&&(q[j++]=P[U++],1<A)&&(q[j++]=P[U++])}else{for(U=j-O;q[j++]=q[U++],q[j++]=q[U++],q[j++]=q[U++],2<(A-=3););A&&(q[j++]=q[U++],1<A)&&(q[j++]=q[U++])}break}}break}}while(V<H&&j<K);V-=A=Q>>3,Z&=(1<<(Q-=A<<3))-1,G.next_in=V,G.next_out=j,G.avail_in=V<H?H-V+5:5-(V-H),G.avail_out=j<K?K-j+257:257-(j-K),B.hold=Z,B.bits=Q,s=e.next_out,a=e.output,c=e.avail_out,i=e.next_in,o=e.input,r=e.avail_in,l=n.hold,u=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;v=(S=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,_=65535&S,!((f=S>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(v&&!(240&v)){for(y=f,I=v,E=_;v=(S=n.lencode[E+((l&(1<<y+I)-1)>>y)])>>>16&255,_=65535&S,!(y+(f=S>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}l>>>=y,u-=y,n.back+=y}if(l>>>=f,u-=f,n.back+=f,n.length=_,0===v){n.mode=26;break}if(32&v){n.back=-1,n.mode=12;break}if(64&v){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&v,n.mode=22;case 22:if(n.extra){for(M=n.extra;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;v=(S=n.distcode[l&(1<<n.distbits)-1])>>>16&255,_=65535&S,!((f=S>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(!(240&v)){for(y=f,I=v,E=_;v=(S=n.distcode[E+((l&(1<<y+I)-1)>>y)])>>>16&255,_=65535&S,!(y+(f=S>>>24)<=u);){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}l>>>=y,u-=y,n.back+=y}if(l>>>=f,u-=f,n.back+=f,64&v){e.msg="invalid distance code",n.mode=30;break}n.offset=_,n.extra=15&v,n.mode=24;case 24:if(n.extra){for(M=n.extra;u<M;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===c)break e;if(n.offset>(h=p-c)){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}g=h>n.wnext?(h-=n.wnext,n.wsize-h):n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=a,g=s-n.offset,h=n.length;for(c-=h=c<h?c:h,n.length-=h;a[s++]=m[g++],--h;);0===n.length&&(n.mode=21);break;case 26:if(0===c)break e;a[s++]=n.length,c--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===r)break e;r--,l|=o[i++]<<u,u+=8}if(p-=c,e.total_out+=p,n.total+=p,p&&(e.adler=n.check=(n.flags?Jr:Wr)(n.check,a,p,s-p)),p=c,(n.flags?l:oc(l))!==n.check){e.msg="incorrect data check",n.mode=30;break}u=l=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===r)break e;r--,l+=o[i++]<<u,u+=8}if(l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}u=l=0}n.mode=29;case 29:k=1;break e;case 30:k=-3;break e;case 31:return-4;default:return-2}return e.next_out=s,e.avail_out=c,e.next_in=i,e.avail_in=r,n.hold=l,n.bits=u,(n.wsize||p!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&pc(e,e.output,e.next_out,p-e.avail_out),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,n.total+=p,n.wrap&&p&&(e.adler=n.check=(n.flags?Jr:Wr)(n.check,a,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==d&&0===p||4===t)&&0===k?-5:k},inflateEnd:function(e){var t;return e&&e.state?((t=e.state).window&&(t.window=null),e.state=null,0):-2},inflateGetHeader:function(e,t){return e&&e.state&&2&(e=e.state).wrap?((e.head=t).done=!1,0):-2},inflateSetDictionary:function(e,t){var n,o=t.length;return!e||!e.state||0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&Wr(1,t,o,0)!==n.check?-3:pc(e,t,o,o)?(n.mode=31,-4):(n.havedict=1,0)},inflateInfo:"pako inflate (from Nodeca project)"},gc=!0,mc=!0;try{String.fromCharCode.apply(null,[0])}catch(Gc){gc=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Gc){mc=!1}for(var fc=new Er.Buf8(256),vc=0;vc<256;vc++)fc[vc]=252<=vc?6:248<=vc?5:240<=vc?4:224<=vc?3:192<=vc?2:1;function _c(e,t){for(var n,o,a=t||e.length,i=new Array(2*a),s=0,r=0;r<a;)if((n=e[r++])<128)i[s++]=n;else if(4<(o=fc[n]))i[s++]=65533,r+=o-1;else{for(n&=2===o?31:3===o?15:7;1<o&&r<a;)n=n<<6|63&e[r++],o--;1<o?i[s++]=65533:n<65536?i[s++]=n:(n-=65536,i[s++]=55296|n>>10&1023,i[s++]=56320|1023&n)}var c=i,l=s;if(l<65534&&(c.subarray&&mc||!c.subarray&&gc))return String.fromCharCode.apply(null,Er.shrinkBuf(c,l));for(var u="",d=0;d<l;d++)u+=String.fromCharCode(c[d]);return u}function yc(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Ic(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}fc[254]=fc[254]=1;var Ec={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Cc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},kc=Object.prototype.toString;function Tc(e){if(!(this instanceof Tc))return new Tc(e);this.options=Er.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;if(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits)&&(t.windowBits=-15),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new yc,this.strm.avail_out=0,(e=hc.inflateInit2(this.strm,t.windowBits))!==Ec.Z_OK)throw new Error(Cc[e]);if(this.header=new Ic,hc.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=function(e){for(var t,n,o,a,i=e.length,s=0,r=0;r<i;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<i&&56320==(64512&(o=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(o-56320),r++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Er.Buf8(s),r=a=0;a<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<i&&56320==(64512&(o=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(o-56320),r++),n<128?t[a++]=n:(n<2048?t[a++]=192|n>>>6:(n<65536?t[a++]=224|n>>>12:(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63),t[a++]=128|n>>>6&63),t[a++]=128|63&n);return t}(t.dictionary):"[object ArrayBuffer]"===kc.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw)&&(e=hc.inflateSetDictionary(this.strm,t.dictionary))!==Ec.Z_OK)throw new Error(Cc[e])}function Mc(e,t){if((t=new Tc(t)).push(e,!0),t.err)throw t.msg||Cc[t.err];return t.result}Tc.prototype.push=function(e,t){var n,o,a,i,s,r=this.strm,c=this.options.chunkSize,l=this.options.dictionary,u=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?Ec.Z_FINISH:Ec.Z_NO_FLUSH,"string"==typeof e?r.input=function(e){for(var t=new Er.Buf8(e.length),n=0,o=t.length;n<o;n++)t[n]=e.charCodeAt(n);return t}(e):"[object ArrayBuffer]"===kc.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new Er.Buf8(c),r.next_out=0,r.avail_out=c),(n=(n=hc.inflate(r,Ec.Z_NO_FLUSH))===Ec.Z_NEED_DICT&&l?hc.inflateSetDictionary(this.strm,l):n)===Ec.Z_BUF_ERROR&&!0===u&&(n=Ec.Z_OK,u=!1),n!==Ec.Z_STREAM_END&&n!==Ec.Z_OK)return this.onEnd(n),!(this.ended=!0);!r.next_out||0!==r.avail_out&&n!==Ec.Z_STREAM_END&&(0!==r.avail_in||o!==Ec.Z_FINISH&&o!==Ec.Z_SYNC_FLUSH)||("string"===this.options.to?(a=function(e,t){for(var n=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=n&&128==(192&e[n]);)n--;return!(n<0||0===n)&&n+fc[e[n]]>t?n:t}(r.output,r.next_out),i=r.next_out-a,s=_c(r.output,a),r.next_out=i,r.avail_out=c-i,i&&Er.arraySet(r.output,r.output,a,i,0),this.onData(s)):this.onData(Er.shrinkBuf(r.output,r.next_out))),0===r.avail_in&&0===r.avail_out&&(u=!0)}while((0<r.avail_in||0===r.avail_out)&&n!==Ec.Z_STREAM_END);return(o=n===Ec.Z_STREAM_END?Ec.Z_FINISH:o)===Ec.Z_FINISH?(n=hc.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Ec.Z_OK):o!==Ec.Z_SYNC_FLUSH||(this.onEnd(Ec.Z_OK),!(r.avail_out=0))},Tc.prototype.onData=function(e){this.chunks.push(e)},Tc.prototype.onEnd=function(e){e===Ec.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Er.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},X={};var Sc=((0,Er.assign)(X,{Inflate:Tc,inflate:Mc,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Mc(e,t)},ungzip:Mc},Ec),X),Dc=(i(Uc,[{key:"inflate",value:function(e){e=new Uint8Array(e).slice(4);var t,n=Date.now();try{t=Sc.inflate(e,{to:"string"}),this._bLogForInflateOK||(this._bLogForInflateOK=!0,new Zn("inflateOK").end())}catch(a){return this._bLogForInflateError?void 0:(this._bLogForInflateError=!0,void new Zn("inflateError").setMessage(a).end())}e=e.length+4;var o=t.length;return Le.d("inflate ok. zipped:".concat(e," unzipped:").concat(o)+" compression ratio:".concat(Math.round(100*(o-e)/o),"% cost:").concat(Date.now()-n)),t}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._bLogForInflateOK=!1,this._bLogForInflateError=!1}}]),Uc),bc=(i(Oc,[{key:"_startTimer",value:function(){var e=this._map.get(24),t=e.isWorkerEnabled();Le.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),Le.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._map.get(24),t=e.isWorkerEnabled();Le.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){Le.l("".concat(this._n,"._stopMainThreadTimer")),0<this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){Le.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._map.get(21);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){Le.l("".concat(this._n,"._startMainThreadSocket"));var e=this._map.get(21);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){Le.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){Le.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=T(this._map);try{for(t.s();!(e=t.n()).done;){var n=f(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(o){t.e(o)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._map.get(1)],this._readyList.forEach((function(t){t.ready((function(){return e._onModuleReady()}))}))}},{key:"_onModuleReady",value:function(){var e,t,n=!0;this._readyList.forEach((function(e){e.isReady()||(n=!1)})),n&&!this._isReady&&(this._isReady=!0,this._oEmitter.emit(M.SDK_READY),e=Date.now()-this._startLoginTs,Le.w("SDK is ready. cost ".concat(e," ms")),this._startLoginTs=Date.now(),t=this._ssoLogForReady.getStartTs()+Se,this._ssoLogForReady.setMessage(e).start(t).end())}},{key:"login",value:function(){0===this._startLoginTs&&(ke(),this._startLoginTs=Date.now(),this._startTimer(),this._map.get(15).start(),this._ssoLogForReady=new Zn("sdkReady"),this._reason=Un.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOEmitInst",value:function(){return null===this._oEmitter&&(this._oEmitter=new Ii,e=this._oEmitter,Pn=e,this._oEmitter._emit=this._oEmitter.emit,this._oEmitter.emit=function(e,t){var n,o,a=this;this._canIUseSignaling()&&(e===M.MESSAGE_RECEIVED&&this.get(33).onNewMessageList(t),e===M.MESSAGE_MODIFIED)&&this.get(33).onMessageModified(t),e===M.CONVERSATION_LIST_UPDATED||e===M.FRIEND_LIST_UPDATED||e===M.GROUP_LIST_UPDATED||e===M.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?!1!==this._eventThrottling?this._eventThrottleMap.has(e)?(n=Date.now())-(o=this._eventThrottleMap.get(e)).last<=1e3?(o.timeoutID&&clearTimeout(o.timeoutID),o.timeoutID=setTimeout((function(){o.last=Date.now(),a._oEmitter._emit.apply(a._oEmitter,[e,{name:e,data:a._getEventData(e)}])}),1e3)):(o.last=n,this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:this._getEventData(e)}])):(this._eventThrottleMap.set(e,{last:Date.now(),timeoutID:-1}),this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:this._getEventData(e)}])):this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:this._getEventData(e)}]):this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:t}])}.bind(this)),this._oEmitter;var e}},{key:"_canIUseSignaling",value:function(){var e=this.get(33);return!!e&&e.canIUseSignaling()}},{key:"_getEventData",value:function(e){return e===M.CONVERSATION_LIST_UPDATED?this._map.get(12).isPartialUpdatedConvs()?this._map.get(11).getPartialUpdatedConvs():this._map.get(11).getLocalConvList():e===M.FRIEND_LIST_UPDATED?this._map.get(8).getLocalFriendList(!1):e===M.GROUP_LIST_UPDATED?this._map.get(7).getLocalGroupList():e===M.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._map.get(11).getTotalUnreadCount():e===M.CONVERSATION_ID_LIST_UPDATED?this._map.get(11).getUpdatedConvIDList():void 0}},{key:"getIEmitInst",value:function(){return null===this._iEmitter&&(this._iEmitter=new Ii,this._iEmitter._emit=this._iEmitter.emit,this._iEmitter.emit=function(e,t){e=Ye(t)&&t.data?[e,{name:e,data:t.data}]:[e,{name:e,data:t}],this._iEmitter._emit.apply(this._iEmitter,e)}.bind(this)),this._iEmitter}},{key:"hasModule",value:function(e){return this._map.has(e)}},{key:"get",value:function(e){return this._map.get(e)}},{key:"canIUseModule",value:function(e){return!this._map.get(12).isUsingChatCore()||this._optionalModuleMap.has(e)}},{key:"canIUseInflate",value:function(){return!!this._map.get(37)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.get(12).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrMsg",value:function(e,t,n){return this._map.get(32).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"warn",value:function(e,t,n){(e=this.getErrMsg(e,t,n))&&Le.w(e)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);Le.w("Oops! ".concat(t)),new Zn("error").setMessage(t).setLevel("error").end(),this.getOEmitInst().emit(M.ERROR,e)}},{key:"restartTimer",value:function(){Le.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer();var e=this.get(7);e&&e.restartPolling()}},{key:"getTimerID",value:function(){var e=this._map.get(24);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"getPollingTimerID",value:function(e){return this._map.get(7).getPollingTimerID(e)}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),ke();var e,t=T(this._map);try{for(t.s();!(e=t.n()).done;){var n=f(e.value,2)[1];n.reset&&n.reset()}}catch(s){t.e(s)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._oEmitter.emit(M.SDK_NOT_READY);var o,a=T(this._eventThrottleMap);try{for(a.s();!(o=a.n()).done;){var i=f(o.value,2)[1];i.timeoutID&&clearTimeout(i.timeoutID)}}catch(s){a.e(s)}finally{a.f()}this._eventThrottleMap.clear()}}]),Oc),wc=(i(Ac,[{key:"defense",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var o=null;return this._funcMap.get(e).has(t)?o=this._funcMap.get(e).get(t):(o=this._pack(e,t,n),this._funcMap.get(e).set(t,o)),o}},{key:"defenseOnce",value:function(e,t){return"function"!=typeof t?null:this._pack(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.warn("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var o=this;return function(){try{t.apply(n,Array.from(arguments))}catch(s){var a=Object.values(M).indexOf(e),i="CallbackError";-1!==a&&(a=Object.keys(M)[a],o._m.warn(i,a,s)),o._reportCount<5&&(new Zn(i).setMessage("eventName:".concat(e)).setMoreMessage(s.message).end(),o._reportCount+=1)}}}},{key:"destroy",value:function(){this._funcMap.clear()}},{key:"reset",value:function(){Le.l("".concat(this._n,".reset")),this._reportCount=0}}]),Ac),Nc=(i(Rc,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._get(1).login(e)}},{key:"logout",value:function(){var e=this;return this._get(1).logout().then((function(t){return e._safetyCallbackFactory.reset(),e._m.reset(),t}))}},{key:"getLoginUser",value:function(){return this._get(1).getLoginUser()}},{key:"getServerTime",value:function(){return De()}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrMsg",value:function(e,t,n){return this._m.getErrMsg(e,t,n)}},{key:"_get",value:function(e){return this._m.get(e)}},{key:"destroy",value:function(){var e=this,t=this._get(12),n=t.getSDKAppID();return Le.w("destroy ".concat(n," ").concat(t.getInstanceID())),this.logout().finally((function(){e._safetyCallbackFactory.destroy(),e._m.stopTimer(),e._get(24).terminate(),e._get(21).dealloc(),e._m.getOEmitInst().emit(M.SDK_DESTROY,{SDKAppID:n})}))}},{key:"on",value:function(e,t,n){Le.d("on","eventName:".concat(e)),this._m.getOEmitInst().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){Le.d("once","eventName:".concat(e)),this._m.getOEmitInst().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,o){Le.d("off","eventName:".concat(e));var a=this._safetyCallbackFactory.find(e,t);null!==a&&(this._m.getOEmitInst().off(e,a,n,o),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){(ut(e["tim-push"])?ut(e["tim-offline-push-plugin"])?this._get(18):this._get(28):this._get(36)).registerPlugin(e)}},{key:"setLogLevel",value:function(e){var t;e<=0&&((t=this.getErrMsg("TIM_ASCII_ART"))&&I("log","at node_modules/@tencentcloud/chat/index.js:1",t),(t=this.getErrMsg("API_REFER"))&&(Ft()?I("log","at node_modules/@tencentcloud/chat/index.js:1","%c ".concat("IM SDK API ->"," %c"),"background:#ff9d00; padding:1px; border-radius:3px; color: #fff","background:transparent",t):I("log","at node_modules/@tencentcloud/chat/index.js:1","IM SDK API ->",t)),(t=this.getErrMsg("DOCS_GUIDE"))&&I("log","at node_modules/@tencentcloud/chat/index.js:1",t),t=this.getErrMsg("IOS_WEBVIEW_WARNING"),ve)&&t&&I("warn","at node_modules/@tencentcloud/chat/index.js:1",t),Le.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._get(2).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._get(2).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._get(2).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._get(2).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._get(2).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._get(2).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._get(2).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._get(2).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==S.MSG_MERGER?In({code:Un.MSG_MERGER_TYPE_INVALID}):He(e.payload.downloadKey)?In({code:Un.MSG_MERGER_KEY_INVALID}):this._get(2).downloadMergerMessage(e).catch((function(e){return In({code:Un.MSG_MERGER_DOWNLOAD_FAIL})}))}},{key:"createForwardMessage",value:function(e){return this._get(2).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof ko?this._get(2).sendMessageInstance(e,t):In({code:Un.MSG_INSTANCE_REQUIRED})}},{key:"searchCloudMessages",value:function(e){return this._get(2).searchCloudMessages(e)}},{key:"callExperimentalAPI",value:function(e,t){return"sendComboMessage"===e?this._get(31).sendMessage(t):"handleGroupInvitation"===e?this._get(7).handleGroupInvitation(t):"isCommercialAbilityEnabled"===e?this._get(27).isFeatureEnabled(t):"isFeatureEnabledForStat"===e?this._get(27).isFeatureEnabledForStat(t):"isIntl"===e?this.isIntl():"sendTRTCCustomData"===e||"sendRoomCustomData"===e?this._get(30).sendTRTCCustomData(t):"getTimerID"===e?this._m.getTimerID():"getPollingTimerID"===e?this._m.getPollingTimerID(t):"setApplicationID"===e?(this._get(12).setApplicationID(t),void this._get(20).updateProtocolConfig()):"getServerConfig"===e?this._get(23).getServerConfig(t):"canIUseModule"===e?this._m.canIUseModule(t):"startMessageLongPolling"===e?this._get(7).startMessageLongPolling(t):"stopMessageLongPolling"===e?this._get(7).stopMessageLongPolling(t):"disableMessagePullOnInvite"===e?this._get(11).disableMsgPullOnInvite(t):"clearLocalMessage"===e?this._get(11).clearMemMsg(t,!1):"setCustomLoginInfo"===e?this._get(12).setCustomLoginInfo(t):In({code:Un.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._get(2).revokeMessage(e)}},{key:"resendMessage",value:function(e,t){return e instanceof ko?this._get(2).resendMessage(e,t):In({code:Un.MSG_INSTANCE_REQUIRED})}},{key:"deleteMessage",value:function(e){return this._get(2).deleteMessage(e)}},{key:"translateText",value:function(e){return this._get(2).translateText(e)}},{key:"convertVoiceToText",value:function(e){return this._get(2).convertVoiceToText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._get(3).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._get(3).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._get(3).deleteMessageExtensions(e,t)}},{key:"addMessageReaction",value:function(e,t){return this._get(34).addMessageReaction(e,t)}},{key:"removeMessageReaction",value:function(e,t){return this._get(34).removeMessageReaction(e,t)}},{key:"getMessageReactions",value:function(e){return this._get(34).getMessageReactions(e)}},{key:"getAllUserListOfMessageReaction",value:function(e){return this._get(34).getAllUserListOfMessageReaction(e)}},{key:"modifyMessage",value:function(e){return this._get(2).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._get(11).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._get(11).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._get(11).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._get(11).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){var t=this._get(7);return t?t.getReadReceiptDetail(e):In({code:Un.NO_MODULE})}},{key:"findMessage",value:function(e){return this._get(11).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._get(11).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._get(11).getConvList(e)}},{key:"getConversationProfile",value:function(e){return this._get(11).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._get(11).deleteConversation(e)}},{key:"setConversationDraft",value:function(e){return this._get(11).setConvDraft(e)}},{key:"clearHistoryMessage",value:function(e){return this._get(11).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._get(11).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._get(11).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._get(11).setMessageRemindType(e)}},{key:"setAllReceiveMessageOpt",value:function(e){return this._get(11).setAllRcvMsgOpt(e)}},{key:"getAllReceiveMessageOpt",value:function(){return this._get(11).getAllRcvMsgOpt()}},{key:"getTotalUnreadMessageCount",value:function(){return this._get(11).getTotalUnreadCount()}},{key:"setConversationCustomData",value:function(e){return this._get(11).setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._get(11).markConv(e)}},{key:"getConversationGroupList",value:function(){return this._get(11).getConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._get(11).createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._get(11).deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._get(11).renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._get(11).addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._get(11).deleteConvsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._get(4).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._get(4).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._get(4).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._get(4).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._get(4).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._get(4).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._get(4).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._get(4).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._get(4).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._get(4).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._get(8);return e?e.getLocalFriendList():In({code:Un.NO_MODULE})}},{key:"addFriend",value:function(e){var t=this._get(8);return t?t.addFriend(e):In({code:Un.NO_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._get(8);return t?t.deleteFriend(e):In({code:Un.NO_MODULE})}},{key:"checkFriend",value:function(e){var t=this._get(8);return t?t.checkFriend(e):In({code:Un.NO_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._get(8);return t?t.getFriendProfile(e):In({code:Un.NO_MODULE})}},{key:"updateFriend",value:function(e){var t=this._get(8);return t?t.updateFriend(e):In({code:Un.NO_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._get(8);return e?e.getLocalFriendApplicationList():In({code:Un.NO_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._get(8);return t?t.acceptFriendApplication(e):In({code:Un.NO_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._get(8);return t?t.refuseFriendApplication(e):In({code:Un.NO_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._get(8);return t?t.deleteFriendApplication(e):In({code:Un.NO_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._get(8);return e?e.setFriendApplicationRead():In({code:Un.NO_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._get(8);return e?e.getLocalFriendGroupList():In({code:Un.NO_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._get(8);return t?t.createFriendGroup(e):In({code:Un.NO_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._get(8);return t?t.deleteFriendGroup(e):In({code:Un.NO_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._get(8);return t?t.addToFriendGroup(e):In({code:Un.NO_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._get(8);return t?t.removeFromFriendGroup(e):In({code:Un.NO_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._get(8);return t?t.renameFriendGroup(e):In({code:Un.NO_MODULE})}},{key:"followUser",value:function(e){var t=this._get(35);return t?t.followUser(e):In({code:Un.NO_MODULE})}},{key:"unfollowUser",value:function(e){var t=this._get(35);return t?t.unfollowUser(e):In({code:Un.NO_MODULE})}},{key:"getMyFollowersList",value:function(e){var t=this._get(35);return t?t.getMyFollowersList(e):In({code:Un.NO_MODULE})}},{key:"getMyFollowingList",value:function(e){var t=this._get(35);return t?t.getMyFollowingList(e):In({code:Un.NO_MODULE})}},{key:"getMutualFollowersList",value:function(e){var t=this._get(35);return t?t.getMutualFollowersList(e):In({code:Un.NO_MODULE})}},{key:"getUserFollowInfo",value:function(e){var t=this._get(35);return t?t.getUserFollowInfo(e):In({code:Un.NO_MODULE})}},{key:"checkFollowType",value:function(e){var t=this._get(35);return t?t.checkFollowType(e):In({code:Un.NO_MODULE})}},{key:"getGroupList",value:function(){var e=this._get(7);return e?e.getGroupList():In({code:Un.NO_MODULE})}},{key:"getGroupProfile",value:function(e){var t=this._get(7);return t?t.getGroupProfile(e):In({code:Un.NO_MODULE})}},{key:"createGroup",value:function(e){var t=this._get(7);return t?t.createGroup(e):In({code:Un.NO_MODULE})}},{key:"dismissGroup",value:function(e){var t=this._get(7);return t?t.dismissGroup(e):In({code:Un.NO_MODULE})}},{key:"updateGroupProfile",value:function(e){var t=this._get(7);return t?t.updateGroupProfile(e):In({code:Un.NO_MODULE})}},{key:"joinGroup",value:function(e){var t=this._get(7);return t?t.joinGroup(e):In({code:Un.NO_MODULE})}},{key:"quitGroup",value:function(e){var t=this._get(7);return t?t.quitGroup(e):In({code:Un.NO_MODULE})}},{key:"searchGroupByID",value:function(e){var t=this._get(7);return t?t.searchGroupByID(e):In({code:Un.NO_MODULE})}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._get(7);return t?t.getGroupOnlineMemberCount(e):In({code:Un.NO_MODULE})}},{key:"changeGroupOwner",value:function(e){var t=this._get(7);return t?t.changeGroupOwner(e):In({code:Un.NO_MODULE})}},{key:"getGroupApplicationList",value:function(){var e=this._get(7);return e?e.getGroupApplicationList():In({code:Un.NO_MODULE})}},{key:"handleGroupApplication",value:function(e){var t=this._get(7);return t?t.handleGroupApplication(e):In({code:Un.NO_MODULE})}},{key:"initGroupAttributes",value:function(e){var t=this._get(7);return t?t.initGroupAttributes(e):In({code:Un.NO_MODULE})}},{key:"setGroupAttributes",value:function(e){var t=this._get(7);return t?t.setGroupAttributes(e):In({code:Un.NO_MODULE})}},{key:"deleteGroupAttributes",value:function(e){var t=this._get(7);return t?t.deleteGroupAttributes(e):In({code:Un.NO_MODULE})}},{key:"getGroupAttributes",value:function(e){var t=this._get(7);return t?t.getGroupAttributes(e):In({code:Un.NO_MODULE})}},{key:"setGroupCounters",value:function(e){var t=this._get(7);return t?t.setGroupCounters(e):In({code:Un.NO_MODULE})}},{key:"increaseGroupCounter",value:function(e){var t=this._get(7);return t?t.increaseGroupCounter(e):In({code:Un.NO_MODULE})}},{key:"decreaseGroupCounter",value:function(e){var t=this._get(7);return t?t.decreaseGroupCounter(e):In({code:Un.NO_MODULE})}},{key:"getGroupCounters",value:function(e){var t=this._get(7);return t?t.getGroupCounters(e):In({code:Un.NO_MODULE})}},{key:"getGroupMemberList",value:function(e){var t=this._get(7);return t?t.getGroupMemberList(e):In({code:Un.NO_MODULE})}},{key:"getGroupMemberProfile",value:function(e){var t=this._get(7);return t?t.getGroupMemberProfile(e):In({code:Un.NO_MODULE})}},{key:"addGroupMember",value:function(e){var t=this._get(7);return t?t.addGroupMember(e):In({code:Un.NO_MODULE})}},{key:"deleteGroupMember",value:function(e){var t=this._get(7);return t?t.deleteGroupMember(e):In({code:Un.NO_MODULE})}},{key:"setGroupMemberMuteTime",value:function(e){var t=this._get(7);return t?t.setGroupMemberMuteTime(e):In({code:Un.NO_MODULE})}},{key:"setGroupMemberRole",value:function(e){var t=this._get(7);return t?t.setGroupMemberRole(e):In({code:Un.NO_MODULE})}},{key:"setGroupMemberNameCard",value:function(e){var t=this._get(7);return t?t.setGroupMemberNameCard(e):In({code:Un.NO_MODULE})}},{key:"setGroupMemberCustomField",value:function(e){var t=this._get(7);return t?t.setGroupMemberCustomField(e):In({code:Un.NO_MODULE})}},{key:"markGroupMemberList",value:function(e){var t=this._get(7);return t?t.markGroupMemberList(e):In({code:Un.NO_MODULE})}},{key:"getJoinedCommunityList",value:function(){return this._get(10).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._get(10).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._get(10).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._get(10).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._get(10).getTopicList(e)}},{key:"addSignalingListener",value:function(e,t,n){var o=this._get(33);o&&o.addSignalingListener(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"removeSignalingListener",value:function(e,t,n){var o,a=this._safetyCallbackFactory.find(e,t);null!==a&&(o=this._get(33))&&(o.removeSignalingListener(e,a,n),this._safetyCallbackFactory.delete(e,t))}},{key:"invite",value:function(e){var t=this._get(33);return t?t.invite(e):In({code:Un.NO_MODULE})}},{key:"inviteSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"inviteInGroup",value:function(e){var t=this._get(33);return t?t.invite(e):In({code:Un.NO_MODULE})}},{key:"inviteInGroupSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"cancel",value:function(e){var t=this._get(33);return t?t.cancel(e):In({code:Un.NO_MODULE})}},{key:"accept",value:function(e){var t=this._get(33);return t?t.accept(e):In({code:Un.NO_MODULE})}},{key:"reject",value:function(e){var t=this._get(33);return t?t.reject(e):In({code:Un.NO_MODULE})}},{key:"getSignalingInfo",value:function(e){var t=this._get(33);return t?t.getSignalingInfo(e):null}},{key:"modifyInvitation",value:function(e){var t=this._get(33);return t?t.modifyInvitation(e):In({code:Un.NO_MODULE})}}]),Rc),Lc={login:1,logout:1,getLoginUser:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1,isReady:1,addSignalingListener:1,removeSignalingListener:1,callExperimentalAPI:1};function Rc(e){o(this,Rc),e={SDKAppID:e.SDKAppID,unlimitedAVChatRoom:e.unlimitedAVChatRoom||!1,scene:e.scene||"",oversea:e.oversea||!1,instanceID:bt(),devMode:e.devMode||!1,testEnv:e.testEnv||!1,proxyServer:e.proxyServer||void 0,fileUploadProxy:e.fileUploadProxy||void 0,fileDownloadProxy:e.fileDownloadProxy||e.fileUploadProxy||void 0,eventThrottling:!1!==e.eventThrottling,partialUpdatedConversations:!0===e.partialUpdatedConversations,modules:e.modules||void 0},this._m=new bc(e),this._safetyCallbackFactory=new wc(this._m)}function Ac(e){o(this,Ac),this._funcMap=new Map,this._m=e,this._n="SafetyCallback",this._reportCount=0}function Oc(e){var t=this;o(this,Oc);var n,a=new Zn("sdkConstruct"),i=(this._n="ModuleManager",this._isReady=!1,this._reason=Un.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._map=new Map,this._optionalModuleMap=new Map,this._iEmitter=null,this._oEmitter=null,this._checkCount=0,this._checkTimer=-1,this._map.set(12,new Na(this,e)),this._map.set(37,new Dc(this)),this._map.set(15,new hi(this)),this._map.set(27,new ir(this)),this._map.set(23,new js(this)),this._map.set(24,new or(this)),this._map.set(26,new Ws(this)),this._map.set(21,new ps(this)),this._map.set(20,new Hs(this)),this._map.set(1,new Ra(this)),this._map.set(2,new xi(this)),this._map.set(3,new Bi(this)),this._map.set(34,new Vi(this)),this._map.set(31,new Fi(this)),this._map.set(4,new wa(this)),this._map.set(6,new xo(this)),this._map.set(11,new ca(this)),this._map.set(7,new Ea(this)),this._map.set(10,new Ta(this)),this._map.set(13,new ci(this)),this._map.set(32,new ur(this)),this._map.set(14,new ui(this)),this._map.set(17,new ki(this)),this._map.set(18,new Hi(this)),this._map.set(19,new ji(this)),this._map.set(25,new qs(this)),this._map.set(8,new nr(this)),this._map.set(28,new sr(this)),this._map.set(36,new rr(this)),this._map.set(29,new cr(this)),this._map.set(30,new lr(this)),this._map.set(33,new vr(this)),this._map.set(35,new Ir(this)),this._eventThrottleMap=new Map,this._eventThrottling=e.eventThrottling,this._map.get(12).isPartialUpdatedConvs()&&(this._eventThrottling=!1),Ye(e.modules)?(Object.keys(e.modules).forEach((function(o){n=e.modules[o],"group-module"===o?t._map.set(7,new n(t)):"relationship-module"===o?t._map.set(8,new n(t)):"signaling-module"===o?t._map.set(33,new n(t)):"follow-module"===o&&t._map.set(35,new n(t)),t._optionalModuleMap.set(o,1)})),this._map.get(12).setUsingChatCore(!0)):this._map.has(7)||this._map.get(12).setUsingChatCore(!0),e.instanceID),s=e.SDKAppID,r=this._map.get(12).isIntl(),c=this._map.get(12).isUsingChatCore();i="instanceID:".concat(i," SDKAppID:").concat(s," isIntl:").concat(r," isUsingChatCore:").concat(c," host:").concat(wt())+" isIOSWebView:".concat(ve," platform:").concat(ie," canIUseInflate:").concat(this.canIUseInflate())+" workerAvailable:".concat(ge," eventThrottling:").concat(this._eventThrottling," UserAgent:").concat(ae),Zn.bindEventStatModule(this._map.get(14)),Zn.bindNetMonitorModule(this._map.get(15)),a.setMessage("".concat(i," ").concat(function(){var e="";if(Q)try{var t=oe.getSystemInfoSync(),n=t.model,o=t.version,a=t.system,i=t.platform,s=t.SDKVersion;e="model:".concat(n," version:").concat(o," system:").concat(a," platform:").concat(i," SDKVersion:").concat(s)}catch(r){e=""}return e}())).end(),Le.i("SDK ".concat(i)),On.prototype._getErrMsg=this.getErrMsg.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}function Uc(e){o(this,Uc),this._m=e,this._n="InflateModule",this._bLogForInflateOK=!1,this._bLogForInflateError=!1}var Pc={};return(W={}).create=function(e){var n,o,a,i="TencentCloudChat.create",s=0;if(Ke(a=e.SDKAppID))s=a;else if(s=parseInt(a),isNaN(a))return Le.e("".concat(i," failed. Failed to parse the SDKAppID, please check the arguments")),null;return s&&Pc[s]?Pc[s]:(Le.l("".concat(i)),(a=new Nc(t(t({},e),{},{SDKAppID:s}))).on(M.SDK_DESTROY,(function(e){Pc[e.data.SDKAppID]=null,delete Pc[e.data.SDKAppID]})),n=a,o=Object.create(null),Object.keys(An).forEach((function(e){var t;n[e]&&(t=new b,o[e]=function(){var o=Array.from(arguments);return t.use((function(t,o){s=e;var a,i,s=!(!(a=n).isReady()&&1!==Lc[s])||(i={code:i=a.getNotReadyReason(),message:"".concat(a.getErrMsg(i)," | ").concat(s," | ").concat(a.getErrMsg(Un.SDK_IS_NOT_READY))},a.onError(i),i);return!0===s?o():In(s)})).use((function(t,n){if(!0===function(e,t,n){if(void 0===t)return!0;var o=!0;if(Ye(t))Object.keys(t).forEach((function(a){var i=1===e.length?e[0][a]:void 0;o=!!$t(i,t[a],n,a)&&o}));else if(We(t))for(var a=0;a<t.length;a++)o=!!$t(e[a],t[a],n,t[a].name)&&o;if(o)return o;throw new Error("Params validate failed.")}(t,Rn[e],e))return n()})).use((function(t,o){return n[e].apply(n,t)})),t.run(o)})})),e=o,Pc[s]=e,Rn.hookGetAPITips(a.getErrMsg.bind(a)),Le.l("".concat(i," ok")),e)},W.TYPES=S,W.EVENT=M,W.TSignaling=D,W.VERSION="3.4.7",Le.l("TencentCloudChat.VERSION:".concat(W.VERSION)),W}();const Ka=qa(za.exports);var $a={exports:{}};!function(e){e.exports=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){s(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=void 0!==ja?ja:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},l="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),u="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),d="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),p="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),h="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),g="undefined"!=typeof uni&&"undefined"==typeof window&&!0,m=g&&"ios"===uni.getDeviceInfo().platform.toLocaleLowerCase(),f=(g&&uni.getDeviceInfo().platform.toLocaleLowerCase(),l||u||d||p||h||g),v=void 0!==c&&(void 0!==c.nativeModuleProxy||void 0!==c.ReactNative),_=u?qq:d?tt:p?swan:h?my:l?wx:g?uni:{},y=function(e){if("object"!==n(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var o=t;null!==Object.getPrototypeOf(o);)o=Object.getPrototypeOf(o);return t===o};function E(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(y(e)){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}return!1}var C=function(){function e(){o(this,e),this._n="WebRequest"}return i(e,[{key:"request",value:function(e,n){var o=this,a="".concat(this._n,".request"),i=e.downloadUrl||"",s=(e.method||"PUT").toUpperCase(),r=e.url;if(I("log","at node_modules/tim-upload-plugin/index.js:1","%c tim-upload-plugin %c","background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent","".concat(a," URL:").concat(r)),e.qs){var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"=";return E(e)?"":y(e)?Object.keys(e).map((function(o){var a=encodeURIComponent(o)+n;return Array.isArray(e[o])?e[o].map((function(e){return a+encodeURIComponent(e)})).join(t):a+encodeURIComponent(e[o])})).filter(Boolean).join(t):void 0}(e.qs);c&&(r+="".concat(-1===r.indexOf("?")?"?":"&").concat(c))}var l=new XMLHttpRequest;l.open(s,r,!0),l.responseType=e.dataType||"text";var u=e.headers||{};if(e.uploadByIP&&(u=t(t({},u),{},{host:e.uploadIP})),!E(u))for(var d in u)u.hasOwnProperty(d)&&"content-length"!==d.toLowerCase()&&"user-agent"!==d.toLowerCase()&&"origin"!==d.toLowerCase()&&"host"!==d.toLowerCase()&&l.setRequestHeader(d,u[d]);return l.onload=function(){if(200===l.status)n(null,o._xhrRes(l,o._xhrBody(l,i,e.uploadByIP&&e.uploadIP),u));else{if(e.uploadIP&&-1===e.url.indexOf(e.uploadIP))return e.url=(a=e.url,s=e.uploadIP,a.replace(/^http(s)?:\/\/(.*?)\//,"https://".concat(s,"/"))),e.uploadByIP=!0,o.request(e,n);var t={code:l.status,message:JSON.stringify(l.responseText)};n(t,o._xhrRes(l,o._xhrBody(l,i,e.uploadByIP&&e.uploadIP),u))}var a,s},l.onerror=function(t){var a=o._xhrBody(l,i,e.uploadByIP&&e.uploadIP),s={code:l.status,message:JSON.stringify(l.responseText)};a||l.statusText||0!==l.status||(t.message="CORS blocked or network error"),n(s,o._xhrRes(l,a)),s=null},e.onProgress&&l.upload&&(l.upload.onprogress=function(t){var n=t.total,o=t.loaded,a=Math.floor(100*o/n);e.onProgress({total:n,loaded:o,percent:(a>=100?100:a)/100})}),l.send(e.resources),l}},{key:"_xhrRes",value:function(e,t){var n={};return e.getAllResponseHeaders().trim().split("\n").forEach((function(e){if(e){var t=e.indexOf(":"),o=e.substr(0,t).trim().toLowerCase(),a=e.substr(t+1).trim();n[o]=a}})),{statusCode:e.status,statusMessage:e.statusText,headers:n,data:t}}},{key:"_xhrBody",value:function(e,t,n){return 200===e.status&&t?{location:t,uploadIP:n}:{response:e.responseText,uploadIP:n}}}]),e}(),k=["unknown","image","video","audio","log"],T=["name"],M=function(){function e(){o(this,e)}return i(e,[{key:"request",value:function(e,n){var o=this,a=e.resources,i=void 0===a?"":a,s=e.headers,c=void 0===s?{}:s,l=e.url,u=e.downloadUrl,d=void 0===u?"":u,p=l,g=null,f=d.match(/^(https?:\/\/[^/]+\/)([^/]*\/?)(.*)$/),v=decodeURIComponent(f[3]),y=v.indexOf("?")>-1?v.split("?")[0]:v,I={key:e.fileKey?e.fileKey:y,success_action_status:200,"Content-Type":""},E={};if(m){var C=l.split("?sign=");if(C.length>1){var M=C[1];p="".concat(C[0],"?sign=").concat(encodeURIComponent("".concat(M))),E.sign=decodeURIComponent(M),E.signature=decodeURIComponent(M)}}var S={url:p,header:c,name:"file",filePath:i,formData:t(t({},I),E),timeout:e.timeout||3e5};if(h){var D=S;D.name,S=t(t({},r(D,T)),{},{fileName:"file",fileType:k[e.fileType]})}return(g=_.uploadFile(t(t({},S),{},{success:function(e){o._handleResponse({response:e,downloadUrl:d,callback:n})},fail:function(e){o._handleResponse({response:e,downloadUrl:d,callback:n})}}))).onProgressUpdate&&g.onProgressUpdate((function(t){e.onProgress&&e.onProgress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percent:Math.floor(t.progress)/100})})),g}},{key:"_handleResponse",value:function(e){var n=e.downloadUrl,o=e.response,a=e.callback,i=o.header,s={};if(i)for(var r in i)i.hasOwnProperty(r)&&(s[r.toLowerCase()]=i[r]);var c=+o.statusCode;200===c?a(null,{statusCode:c,headers:s,data:t(t({},o.data),{},{location:n})}):a({code:c,message:JSON.stringify(o.data)},{statusCode:c,headers:s,data:void 0})}}]),e}(),S=function(){function e(){o(this,e)}return i(e,[{key:"request",value:function(e,t){var n=this,o=e.resources,a=void 0===o?"":o,i=e.fileKey,s=void 0===i?"":i,r=e.url,c=e.downloadUrl,l=void 0===c?"":c,u=new FormData;u.append("key",s),u.append("success_action_status",200),u.append("file",{uri:a,type:"application/octet-stream",name:"uploaded_file"}),fetch(r,{method:"POST",headers:{"Content-Type":"multipart/form-data"},body:u}).then((function(e){n._handleResponse({response:e,downloadUrl:l,callback:t})})).catch((function(e){n._handleResponse({response:e,downloadUrl:l,callback:t})}))}},{key:"_handleResponse",value:function(e){var t=e.downloadUrl,n=e.response,o=e.callback,a=n.headers,i=n.status,s=a&&a.map||{};200===i?o(null,{statusCode:200,headers:s,data:{location:t}}):o({code:i,message:JSON.stringify(n)},{statusCode:i,headers:s,data:void 0})}}]),e}();return function(){function e(){o(this,e),this.retry=1,this.tryCount=0,this.systemClockOffset=0,this.httpRequest=f?new M:v?new S:new C,I("log","at node_modules/tim-upload-plugin/index.js:1","TIMUploadPlugin.VERSION: ".concat("1.4.1"))}return i(e,[{key:"uploadFile",value:function(e,t){var n=this;return this.httpRequest.request(e,(function(o,a){o&&n.tryCount<n.retry&&n.allowRetry(o)?(n.tryCount++,n.uploadFile(e,t)):(n.tryCount=0,t(o,a))}))}},{key:"allowRetry",value:function(e){var t=!1,n=!1;if(e){var o=e.headers&&(e.headers.date||e.headers.Date)||e.error&&e.error.ServerTime;try{var a=e.error&&e.error.Code,i=e.error&&e.error.Message;("RequestTimeTooSkewed"===a||"AccessDenied"===a&&"Request has expired"===i)&&(n=!0)}catch(c){}if(n&&o){var s=Date.now(),r=Date.parse(o);Math.abs(s+this.systemClockOffset-r)>=3e4&&(this.systemClockOffset=r-s,t=!0)}else 5===Math.floor(e.statusCode/100)&&(t=!0)}return t}}],[{key:"getVersion",value:function(){return"1.4.1"}}]),e}()}()}($a);const Ya=qa($a.exports);var Wa=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,62,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,63,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];const Ja={getRandomValues(e){if(!(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8ClampedArray))throw new Error("Expected an integer array");if(e.byteLength>65536)throw new Error("Can only request a maximum of 65536 bytes");return function(e,t){for(var n,o=e.length,a="="===e[o-2]?2:"="===e[o-1]?1:0,i=0,s=o-a&4294967292,r=0;r<s;r+=4)n=Wa[e.charCodeAt(r)]<<18|Wa[e.charCodeAt(r+1)]<<12|Wa[e.charCodeAt(r+2)]<<6|Wa[e.charCodeAt(r+3)],t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=255&n;1===a&&(n=Wa[e.charCodeAt(r)]<<10|Wa[e.charCodeAt(r+1)]<<4|Wa[e.charCodeAt(r+2)]>>2,t[i++]=n>>8&255,t[i++]=255&n),2===a&&(n=Wa[e.charCodeAt(r)]<<2|Wa[e.charCodeAt(r+1)]>>4,t[i++]=255&n)}(y("DCloud-Crypto").getRandomValues(e.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e}};var Xa={exports:{}};!function(e){e.exports=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(a=void 0,"symbol"==typeof(a=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o.key,"string"))?a:String(a)),o)}var a}function n(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,a,i,s,r=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(r.push(o.value),r.length!==t);c=!0);}catch(u){l=!0,a=u}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw a}}return r}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){c=!0,s=e},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw s}}}}var c,l,u=function(){for(var e=" \t\r\n~!@#$%^&*()_+-=【】、{}|;':\"，。、《》？αβγδεζηθικλμνξοπρστυφχψωΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩ。，、；：？！…—·ˉ¨‘’“”々～‖∶＂＇｀｜〃〔〕〈〉《》「」『』．〖〗【】（）［］｛｝ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫ⒈⒉⒊⒋⒌⒍⒎⒏⒐⒑⒒⒓⒔⒕⒖⒗⒘⒙⒚⒛㈠㈡㈢㈣㈤㈥㈦㈧㈨㈩①②③④⑤⑥⑦⑧⑨⑩⑴⑵⑶⑷⑸⑹⑺⑻⑼⑽⑾⑿⒀⒁⒂⒃⒄⒅⒆⒇≈≡≠＝≤≥＜＞≮≯∷±＋－×÷／∫∮∝∞∧∨∑∏∪∩∈∵∴⊥∥∠⌒⊙≌∽√§№☆★○●◎◇◆□℃‰€■△▲※→←↑↓〓¤°＃＆＠＼︿＿￣―♂♀┌┍┎┐┑┒┓─┄┈├┝┞┟┠┡┢┣│┆┊┬┭┮┯┰┱┲┳┼┽┾┿╀╁╂╃└┕┖┗┘┙┚┛━┅┉┤┥┦┧┨┩┪┫┃┇┋┴┵┶┷┸┹┺┻╋╊╉╈╇╆╅╄",t=new Map,n=0,o=e.length;n<o;n++)t.set(e.charCodeAt(0),!0);return t}(),d=function(){function t(n){e(this,t);var o,i=n.input,s=n.isArray,r=n.isMap;this._trieTree={},s(i)?o=i:r(i)&&(o=a(i.keys()),this._map=i);for(var c=0,l=o.length;c<l;c++)if(o[c]){for(var u=this._trieTree,d=o[c],p=0,h=d.length;p<h;p++)u[d[p]]||(u[d[p]]={}),u=u[d[p]];u.isEnd=!0}}return n(t,[{key:"filter",value:function(e){var t=e.text,n=e.replacingEnabled;if(0===Object.keys(this._trieTree).length)return{isMatched:!1,modifiedText:t};for(var o=this._trieTree,a=t.toLowerCase(),i="",s=!1,r=a.length,c=0;c<r;c++)if(!0!==u.get(a.charCodeAt(c))){for(var l=0,d="",p=!1,h=c;h<r;h++){if(!o[a[h]]){o=this._trieTree;break}if(d+=a[h],o[a[h]].isEnd){p=!0,l=h-c,o=this._trieTree;break}o=o[a[h]]}if(l>1&&(c+=l),p){if(s=!0,!n)break;var g=this._map.get(d)||"*";i=t.replace(new RegExp(d,"gi"),g)}}return{isMatched:s,modifiedText:i}}},{key:"reset",value:function(){this._trieTree={},this._map=null}}]),t}(),p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==ja?ja:"undefined"!=typeof self?self:{},h={},g=(c=function(e,t){var n,o,a,i,s,r,c,l,u,d,g,m,f;e.exports=(r=r||function(e){var t;if("undefined"!=typeof window&&Ja&&(t=Ja),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==p&&p.crypto&&(t=p.crypto),!t)try{t=h}catch(f){}var n=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(f){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(f){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),a={},i=a.lib={},s=i.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},r=i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes,a=e.sigBytes;if(this.clamp(),o%4)for(var i=0;i<a;i++){var s=n[i>>>2]>>>24-i%4*8&255;t[o+i>>>2]|=s<<24-(o+i)%4*8}else for(i=0;i<a;i+=4)t[o+i>>>2]=n[i>>>2];return this.sigBytes+=a,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],o=0;o<e;o+=4)t.push(n());return new r.init(t,e)}}),c=a.enc={},l=c.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],a=0;a<n;a++){var i=t[a>>>2]>>>24-a%4*8&255;o.push((i>>>4).toString(16)),o.push((15&i).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new r.init(n,t/2)}},u=c.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],a=0;a<n;a++){var i=t[a>>>2]>>>24-a%4*8&255;o.push(String.fromCharCode(i))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new r.init(n,t)}},d=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},g=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,o=this._data,a=o.words,i=o.sigBytes,s=this.blockSize,c=i/(4*s),l=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*s,u=e.min(4*l,i);if(l){for(var d=0;d<l;d+=s)this._doProcessBlock(a,d);n=a.splice(0,l),o.sigBytes-=u}return new r.init(n,u)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(i.Hasher=g.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}}),a.algo={});return a}(Math),s=(i=r).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,o=this._map;e.clamp();for(var a=[],i=0;i<n;i+=3)for(var s=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,r=0;r<4&&i+.75*r<n;r++)a.push(o.charAt(s>>>6*(3-r)&63));var c=o.charAt(64);if(c)for(;a.length%4;)a.push(c);return a.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var a=0;a<n.length;a++)o[n.charCodeAt(a)]=a}var i=n.charAt(64);if(i){var r=e.indexOf(i);-1!==r&&(t=r)}return function(e,t,n){for(var o=[],a=0,i=0;i<t;i++)if(i%4){var r=n[e.charCodeAt(i-1)]<<i%4*2|n[e.charCodeAt(i)]>>>6-i%4*2;o[a>>>2]|=r<<24-a%4*8,a++}return s.create(o,a)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){var t=r,n=t.lib,o=n.WordArray,a=n.Hasher,i=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=i.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,a=e[o];e[o]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var i=this._hash.words,r=e[t+0],c=e[t+1],h=e[t+2],g=e[t+3],m=e[t+4],f=e[t+5],v=e[t+6],_=e[t+7],y=e[t+8],I=e[t+9],E=e[t+10],C=e[t+11],k=e[t+12],T=e[t+13],M=e[t+14],S=e[t+15],D=i[0],b=i[1],w=i[2],N=i[3];D=l(D,b,w,N,r,7,s[0]),N=l(N,D,b,w,c,12,s[1]),w=l(w,N,D,b,h,17,s[2]),b=l(b,w,N,D,g,22,s[3]),D=l(D,b,w,N,m,7,s[4]),N=l(N,D,b,w,f,12,s[5]),w=l(w,N,D,b,v,17,s[6]),b=l(b,w,N,D,_,22,s[7]),D=l(D,b,w,N,y,7,s[8]),N=l(N,D,b,w,I,12,s[9]),w=l(w,N,D,b,E,17,s[10]),b=l(b,w,N,D,C,22,s[11]),D=l(D,b,w,N,k,7,s[12]),N=l(N,D,b,w,T,12,s[13]),w=l(w,N,D,b,M,17,s[14]),D=u(D,b=l(b,w,N,D,S,22,s[15]),w,N,c,5,s[16]),N=u(N,D,b,w,v,9,s[17]),w=u(w,N,D,b,C,14,s[18]),b=u(b,w,N,D,r,20,s[19]),D=u(D,b,w,N,f,5,s[20]),N=u(N,D,b,w,E,9,s[21]),w=u(w,N,D,b,S,14,s[22]),b=u(b,w,N,D,m,20,s[23]),D=u(D,b,w,N,I,5,s[24]),N=u(N,D,b,w,M,9,s[25]),w=u(w,N,D,b,g,14,s[26]),b=u(b,w,N,D,y,20,s[27]),D=u(D,b,w,N,T,5,s[28]),N=u(N,D,b,w,h,9,s[29]),w=u(w,N,D,b,_,14,s[30]),D=d(D,b=u(b,w,N,D,k,20,s[31]),w,N,f,4,s[32]),N=d(N,D,b,w,y,11,s[33]),w=d(w,N,D,b,C,16,s[34]),b=d(b,w,N,D,M,23,s[35]),D=d(D,b,w,N,c,4,s[36]),N=d(N,D,b,w,m,11,s[37]),w=d(w,N,D,b,_,16,s[38]),b=d(b,w,N,D,E,23,s[39]),D=d(D,b,w,N,T,4,s[40]),N=d(N,D,b,w,r,11,s[41]),w=d(w,N,D,b,g,16,s[42]),b=d(b,w,N,D,v,23,s[43]),D=d(D,b,w,N,I,4,s[44]),N=d(N,D,b,w,k,11,s[45]),w=d(w,N,D,b,S,16,s[46]),D=p(D,b=d(b,w,N,D,h,23,s[47]),w,N,r,6,s[48]),N=p(N,D,b,w,_,10,s[49]),w=p(w,N,D,b,M,15,s[50]),b=p(b,w,N,D,f,21,s[51]),D=p(D,b,w,N,k,6,s[52]),N=p(N,D,b,w,g,10,s[53]),w=p(w,N,D,b,E,15,s[54]),b=p(b,w,N,D,c,21,s[55]),D=p(D,b,w,N,y,6,s[56]),N=p(N,D,b,w,S,10,s[57]),w=p(w,N,D,b,v,15,s[58]),b=p(b,w,N,D,T,21,s[59]),D=p(D,b,w,N,m,6,s[60]),N=p(N,D,b,w,C,10,s[61]),w=p(w,N,D,b,h,15,s[62]),b=p(b,w,N,D,I,21,s[63]),i[0]=i[0]+D|0,i[1]=i[1]+b|0,i[2]=i[2]+w|0,i[3]=i[3]+N|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,a=8*t.sigBytes;n[a>>>5]|=128<<24-a%32;var i=e.floor(o/4294967296),s=o;n[15+(a+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(a+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(n.length+1),this._process();for(var r=this._hash,c=r.words,l=0;l<4;l++){var u=c[l];c[l]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return r},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,n,o,a,i,s){var r=e+(t&n|~t&o)+a+s;return(r<<i|r>>>32-i)+t}function u(e,t,n,o,a,i,s){var r=e+(t&o|n&~o)+a+s;return(r<<i|r>>>32-i)+t}function d(e,t,n,o,a,i,s){var r=e+(t^n^o)+a+s;return(r<<i|r>>>32-i)+t}function p(e,t,n,o,a,i,s){var r=e+(n^(t|~o))+a+s;return(r<<i|r>>>32-i)+t}t.MD5=a._createHelper(c),t.HmacMD5=a._createHmacHelper(c)}(Math),l=(c=r).lib,u=l.WordArray,d=l.Hasher,g=c.algo,m=[],f=g.SHA1=d.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],a=n[1],i=n[2],s=n[3],r=n[4],c=0;c<80;c++){if(c<16)m[c]=0|e[t+c];else{var l=m[c-3]^m[c-8]^m[c-14]^m[c-16];m[c]=l<<1|l>>>31}var u=(o<<5|o>>>27)+r+m[c];u+=c<20?1518500249+(a&i|~a&s):c<40?1859775393+(a^i^s):c<60?(a&i|a&s|i&s)-1894007588:(a^i^s)-899497514,r=s,s=i,i=a<<30|a>>>2,a=o,o=u}n[0]=n[0]+o|0,n[1]=n[1]+a|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+r|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(o+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=d.clone.call(this);return e._hash=this._hash.clone(),e}}),c.SHA1=d._createHelper(f),c.HmacSHA1=d._createHmacHelper(f),function(e){var t=r,n=t.lib,o=n.WordArray,a=n.Hasher,i=t.algo,s=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),o=2;o<=n;o++)if(!(t%o))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var o=2,a=0;a<64;)t(o)&&(a<8&&(s[a]=n(e.pow(o,.5))),c[a]=n(e.pow(o,1/3)),a++),o++}();var l=[],u=i.SHA256=a.extend({_doReset:function(){this._hash=new o.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],a=n[1],i=n[2],s=n[3],r=n[4],u=n[5],d=n[6],p=n[7],h=0;h<64;h++){if(h<16)l[h]=0|e[t+h];else{var g=l[h-15],m=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,f=l[h-2],v=(f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10;l[h]=m+l[h-7]+v+l[h-16]}var _=o&a^o&i^a&i,y=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),I=p+((r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25))+(r&u^~r&d)+c[h]+l[h];p=d,d=u,u=r,r=s+I|0,s=i,i=a,a=o,o=I+(y+_)|0}n[0]=n[0]+o|0,n[1]=n[1]+a|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+r|0,n[5]=n[5]+u|0,n[6]=n[6]+d|0,n[7]=n[7]+p|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,a=8*t.sigBytes;return n[a>>>5]|=128<<24-a%32,n[14+(a+64>>>9<<4)]=e.floor(o/4294967296),n[15+(a+64>>>9<<4)]=o,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=a._createHelper(u),t.HmacSHA256=a._createHmacHelper(u)}(Math),function(){var e=r,t=e.lib.WordArray,n=e.enc;function o(e){return e<<8&4278255360|e>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],a=0;a<n;a+=2){var i=t[a>>>2]>>>16-a%4*8&65535;o.push(String.fromCharCode(i))}return o.join("")},parse:function(e){for(var n=e.length,o=[],a=0;a<n;a++)o[a>>>1]|=e.charCodeAt(a)<<16-a%2*16;return t.create(o,2*n)}},n.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,a=[],i=0;i<n;i+=2){var s=o(t[i>>>2]>>>16-i%4*8&65535);a.push(String.fromCharCode(s))}return a.join("")},parse:function(e){for(var n=e.length,a=[],i=0;i<n;i++)a[i>>>1]|=o(e.charCodeAt(i)<<16-i%2*16);return t.create(a,2*n)}}}(),function(){if("function"==typeof ArrayBuffer){var e=r.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,o=[],a=0;a<n;a++)o[a>>>2]|=e[a]<<24-a%4*8;t.call(this,o,n)}else t.apply(this,arguments)}).prototype=e}}(),
/** @preserve
              (c) 2012 by C��dric Mesnil. All rights reserved.
               Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
                   - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
                  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
               THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
              */
function(){var e=r,t=e.lib,n=t.WordArray,o=t.Hasher,a=e.algo,i=n.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),s=n.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),c=n.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),l=n.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),u=n.create([0,1518500249,1859775393,2400959708,2840853838]),d=n.create([1352829926,1548603684,1836072691,2053994217,0]),p=a.RIPEMD160=o.extend({_doReset:function(){this._hash=n.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,a=e[o];e[o]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var r,p,y,I,E,C,k,T,M,S,D,b=this._hash.words,w=u.words,N=d.words,L=i.words,R=s.words,A=c.words,O=l.words;for(C=r=b[0],k=p=b[1],T=y=b[2],M=I=b[3],S=E=b[4],n=0;n<80;n+=1)D=r+e[t+L[n]]|0,D+=n<16?h(p,y,I)+w[0]:n<32?g(p,y,I)+w[1]:n<48?m(p,y,I)+w[2]:n<64?f(p,y,I)+w[3]:v(p,y,I)+w[4],D=(D=_(D|=0,A[n]))+E|0,r=E,E=I,I=_(y,10),y=p,p=D,D=C+e[t+R[n]]|0,D+=n<16?v(k,T,M)+N[0]:n<32?f(k,T,M)+N[1]:n<48?m(k,T,M)+N[2]:n<64?g(k,T,M)+N[3]:h(k,T,M)+N[4],D=(D=_(D|=0,O[n]))+S|0,C=S,S=M,M=_(T,10),T=k,k=D;D=b[1]+y+M|0,b[1]=b[2]+I+S|0,b[2]=b[3]+E+C|0,b[3]=b[4]+r+k|0,b[4]=b[0]+p+T|0,b[0]=D},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var a=this._hash,i=a.words,s=0;s<5;s++){var r=i[s];i[s]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}return a},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,n){return e^t^n}function g(e,t,n){return e&t|~e&n}function m(e,t,n){return(e|~t)^n}function f(e,t,n){return e&n|t&~n}function v(e,t,n){return e^(t|~n)}function _(e,t){return e<<t|e>>>32-t}e.RIPEMD160=o._createHelper(p),e.HmacRIPEMD160=o._createHmacHelper(p)}(),function(){var e=r,t=e.lib.Base,n=e.enc.Utf8;e.algo.HMAC=t.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var o=e.blockSize,a=4*o;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),s=this._iKey=t.clone(),r=i.words,c=s.words,l=0;l<o;l++)r[l]^=1549556828,c[l]^=909522486;i.sigBytes=s.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}(),function(){var e=r,t=e.lib,n=t.Base,o=t.WordArray,a=e.algo,i=a.SHA1,s=a.HMAC,c=a.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:i,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,a=s.create(n.hasher,e),i=o.create(),r=o.create([1]),c=i.words,l=r.words,u=n.keySize,d=n.iterations;c.length<u;){var p=a.update(t).finalize(r);a.reset();for(var h=p.words,g=h.length,m=p,f=1;f<d;f++){m=a.finalize(m),a.reset();for(var v=m.words,_=0;_<g;_++)h[_]^=v[_]}i.concat(p),l[0]++}return i.sigBytes=4*u,i}});e.PBKDF2=function(e,t,n){return c.create(n).compute(e,t)}}(),function(){var e=r,t=e.lib,n=t.Base,o=t.WordArray,a=e.algo,i=a.MD5,s=a.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:i,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,a=this.cfg,i=a.hasher.create(),s=o.create(),r=s.words,c=a.keySize,l=a.iterations;r.length<c;){n&&i.update(n),n=i.update(e).finalize(t),i.reset();for(var u=1;u<l;u++)n=i.finalize(n),i.reset();s.concat(n)}return s.sigBytes=4*c,s}});e.EvpKDF=function(e,t,n){return s.create(n).compute(e,t)}}(),function(){var e=r,t=e.lib.WordArray,n=e.algo,o=n.SHA256,a=n.SHA224=o.extend({_doReset:function(){this._hash=new t.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=o._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=o._createHelper(a),e.HmacSHA224=o._createHmacHelper(a)}(),function(){var e=r,t=e.lib,n=t.Base,o=t.WordArray,a=e.x64={};a.Word=n.extend({init:function(e,t){this.high=e,this.low=t}}),a.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],a=0;a<t;a++){var i=e[a];n.push(i.high),n.push(i.low)}return o.create(n,this.sigBytes)},clone:function(){for(var e=n.clone.call(this),t=e.words=this.words.slice(0),o=t.length,a=0;a<o;a++)t[a]=t[a].clone();return e}})}(),function(e){var t=r,n=t.lib,o=n.WordArray,a=n.Hasher,i=t.x64.Word,s=t.algo,c=[],l=[],u=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var o=(2*e+3*t)%5;e=t%5,t=o}for(e=0;e<5;e++)for(t=0;t<5;t++)l[e+5*t]=t+(2*e+3*t)%5*5;for(var a=1,s=0;s<24;s++){for(var r=0,d=0,p=0;p<7;p++){if(1&a){var h=(1<<p)-1;h<32?d^=1<<h:r^=1<<h-32}128&a?a=a<<1^113:a<<=1}u[s]=i.create(r,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=i.create()}();var p=s.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new i.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,o=this.blockSize/2,a=0;a<o;a++){var i=e[t+2*a],s=e[t+2*a+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),(b=n[a]).high^=s,b.low^=i}for(var r=0;r<24;r++){for(var p=0;p<5;p++){for(var h=0,g=0,m=0;m<5;m++)h^=(b=n[p+5*m]).high,g^=b.low;var f=d[p];f.high=h,f.low=g}for(p=0;p<5;p++){var v=d[(p+4)%5],_=d[(p+1)%5],y=_.high,I=_.low;for(h=v.high^(y<<1|I>>>31),g=v.low^(I<<1|y>>>31),m=0;m<5;m++)(b=n[p+5*m]).high^=h,b.low^=g}for(var E=1;E<25;E++){var C=(b=n[E]).high,k=b.low,T=c[E];T<32?(h=C<<T|k>>>32-T,g=k<<T|C>>>32-T):(h=k<<T-32|C>>>64-T,g=C<<T-32|k>>>64-T);var M=d[l[E]];M.high=h,M.low=g}var S=d[0],D=n[0];for(S.high=D.high,S.low=D.low,p=0;p<5;p++)for(m=0;m<5;m++){var b=n[E=p+5*m],w=d[E],N=d[(p+1)%5+5*m],L=d[(p+2)%5+5*m];b.high=w.high^~N.high&L.high,b.low=w.low^~N.low&L.low}b=n[0];var R=u[r];b.high^=R.high,b.low^=R.low}},_doFinalize:function(){var t=this._data,n=t.words,a=(this._nDataBytes,8*t.sigBytes),i=32*this.blockSize;n[a>>>5]|=1<<24-a%32,n[(e.ceil((a+1)/i)*i>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var s=this._state,r=this.cfg.outputLength/8,c=r/8,l=[],u=0;u<c;u++){var d=s[u],p=d.high,h=d.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),l.push(h),l.push(p)}return new o.init(l,r)},clone:function(){for(var e=a.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=a._createHelper(p),t.HmacSHA3=a._createHmacHelper(p)}(Math),function(){var e=r,t=e.lib.Hasher,n=e.x64,o=n.Word,a=n.WordArray,i=e.algo;function s(){return o.create.apply(o,arguments)}var c=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],l=[];!function(){for(var e=0;e<80;e++)l[e]=s()}();var u=i.SHA512=t.extend({_doReset:function(){this._hash=new a.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],a=n[1],i=n[2],s=n[3],r=n[4],u=n[5],d=n[6],p=n[7],h=o.high,g=o.low,m=a.high,f=a.low,v=i.high,_=i.low,y=s.high,I=s.low,E=r.high,C=r.low,k=u.high,T=u.low,M=d.high,S=d.low,D=p.high,b=p.low,w=h,N=g,L=m,R=f,A=v,O=_,U=y,P=I,G=E,x=C,B=k,V=T,F=M,H=S,j=D,q=b,z=0;z<80;z++){var K,$,Y=l[z];if(z<16)$=Y.high=0|e[t+2*z],K=Y.low=0|e[t+2*z+1];else{var W=l[z-15],J=W.high,X=W.low,Z=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=l[z-2],te=ee.high,ne=ee.low,oe=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,ae=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ie=l[z-7],se=ie.high,re=ie.low,ce=l[z-16],le=ce.high,ue=ce.low;$=($=($=Z+se+((K=Q+re)>>>0<Q>>>0?1:0))+oe+((K+=ae)>>>0<ae>>>0?1:0))+le+((K+=ue)>>>0<ue>>>0?1:0),Y.high=$,Y.low=K}var de,pe=G&B^~G&F,he=x&V^~x&H,ge=w&L^w&A^L&A,me=N&R^N&O^R&O,fe=(w>>>28|N<<4)^(w<<30|N>>>2)^(w<<25|N>>>7),ve=(N>>>28|w<<4)^(N<<30|w>>>2)^(N<<25|w>>>7),_e=(G>>>14|x<<18)^(G>>>18|x<<14)^(G<<23|x>>>9),ye=(x>>>14|G<<18)^(x>>>18|G<<14)^(x<<23|G>>>9),Ie=c[z],Ee=Ie.high,Ce=Ie.low,ke=j+_e+((de=q+ye)>>>0<q>>>0?1:0),Te=ve+me;j=F,q=H,F=B,H=V,B=G,V=x,G=U+(ke=(ke=(ke=ke+pe+((de+=he)>>>0<he>>>0?1:0))+Ee+((de+=Ce)>>>0<Ce>>>0?1:0))+$+((de+=K)>>>0<K>>>0?1:0))+((x=P+de|0)>>>0<P>>>0?1:0)|0,U=A,P=O,A=L,O=R,L=w,R=N,w=ke+(fe+ge+(Te>>>0<ve>>>0?1:0))+((N=de+Te|0)>>>0<de>>>0?1:0)|0}g=o.low=g+N,o.high=h+w+(g>>>0<N>>>0?1:0),f=a.low=f+R,a.high=m+L+(f>>>0<R>>>0?1:0),_=i.low=_+O,i.high=v+A+(_>>>0<O>>>0?1:0),I=s.low=I+P,s.high=y+U+(I>>>0<P>>>0?1:0),C=r.low=C+x,r.high=E+G+(C>>>0<x>>>0?1:0),T=u.low=T+V,u.high=k+B+(T>>>0<V>>>0?1:0),S=d.low=S+H,d.high=M+F+(S>>>0<H>>>0?1:0),b=p.low=b+q,p.high=D+j+(b>>>0<q>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[30+(o+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(o+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(u),e.HmacSHA512=t._createHmacHelper(u)}(),function(){var e=r,t=e.x64,n=t.Word,o=t.WordArray,a=e.algo,i=a.SHA512,s=a.SHA384=i.extend({_doReset:function(){this._hash=new o.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=i._createHelper(s),e.HmacSHA384=i._createHmacHelper(s)}(),r.lib.Cipher||function(){var e=r,t=e.lib,n=t.Base,o=t.WordArray,a=t.BufferedBlockAlgorithm,i=e.enc,s=(i.Utf8,i.Base64),c=e.algo.EvpKDF,l=t.Cipher=a.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?_:f}return function(t){return{encrypt:function(n,o,a){return e(o).encrypt(t,n,o,a)},decrypt:function(n,o,a){return e(o).decrypt(t,n,o,a)}}}}()}),u=(t.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),e.mode={}),d=t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=u.CBC=function(){var e=d.extend();function t(e,t,n){var o,a=this._iv;a?(o=a,this._iv=void 0):o=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=o[i]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,a=o.blockSize;t.call(this,e,n,a),o.encryptBlock(e,n),this._prevBlock=e.slice(n,n+a)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,a=o.blockSize,i=e.slice(n,n+a);o.decryptBlock(e,n),t.call(this,e,n,a),this._prevBlock=i}}),e}(),h=(e.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,a=n-e.sigBytes%n,i=a<<24|a<<16|a<<8|a,s=[],r=0;r<a;r+=4)s.push(i);var c=o.create(s,a);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},g=(t.BlockCipher=l.extend({cfg:l.cfg.extend({mode:p,padding:h}),reset:function(){var e;l.reset.call(this);var t=this.cfg,n=t.iv,o=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=o.createEncryptor:(e=o.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(o,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),m=(e.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?o.create([1398893684,1701076831]).concat(n).concat(t):t).toString(s)},parse:function(e){var t,n=s.parse(e),a=n.words;return 1398893684==a[0]&&1701076831==a[1]&&(t=o.create(a.slice(2,4)),a.splice(0,4),n.sigBytes-=16),g.create({ciphertext:n,salt:t})}},f=t.SerializableCipher=n.extend({cfg:n.extend({format:m}),encrypt:function(e,t,n,o){o=this.cfg.extend(o);var a=e.createEncryptor(n,o),i=a.finalize(t),s=a.cfg;return g.create({ciphertext:i,key:n,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,t,n,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),e.createDecryptor(n,o).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(e.kdf={}).OpenSSL={execute:function(e,t,n,a){a||(a=o.random(8));var i=c.create({keySize:t+n}).compute(e,a),s=o.create(i.words.slice(t),4*n);return i.sigBytes=4*t,g.create({key:i,iv:s,salt:a})}},_=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:v}),encrypt:function(e,t,n,o){var a=(o=this.cfg.extend(o)).kdf.execute(n,e.keySize,e.ivSize);o.iv=a.iv;var i=f.encrypt.call(this,e,t,a.key,o);return i.mixIn(a),i},decrypt:function(e,t,n,o){o=this.cfg.extend(o),t=this._parse(t,o.format);var a=o.kdf.execute(n,e.keySize,e.ivSize,t.salt);return o.iv=a.iv,f.decrypt.call(this,e,t,a.key,o)}})}(),r.mode.CFB=function(){var e=r.lib.BlockCipherMode.extend();function t(e,t,n,o){var a,i=this._iv;i?(a=i.slice(0),this._iv=void 0):a=this._prevBlock,o.encryptBlock(a,0);for(var s=0;s<n;s++)e[t+s]^=a[s]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,a=o.blockSize;t.call(this,e,n,a,o),this._prevBlock=e.slice(n,n+a)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,a=o.blockSize,i=e.slice(n,n+a);t.call(this,e,n,a,o),this._prevBlock=i}}),e}(),r.mode.ECB=((a=r.lib.BlockCipherMode.extend()).Encryptor=a.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),a.Decryptor=a.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),a),r.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,o=4*t,a=o-n%o,i=n+a-1;e.clamp(),e.words[i>>>2]|=a<<24-i%4*8,e.sigBytes+=a},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Iso10126={pad:function(e,t){var n=4*t,o=n-e.sigBytes%n;e.concat(r.lib.WordArray.random(o-1)).concat(r.lib.WordArray.create([o<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Iso97971={pad:function(e,t){e.concat(r.lib.WordArray.create([2147483648],1)),r.pad.ZeroPadding.pad(e,t)},unpad:function(e){r.pad.ZeroPadding.unpad(e),e.sigBytes--}},r.mode.OFB=(o=(n=r.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,a=this._iv,i=this._keystream;a&&(i=this._keystream=a.slice(0),this._iv=void 0),n.encryptBlock(i,0);for(var s=0;s<o;s++)e[t+s]^=i[s]}}),n.Decryptor=o,n),r.pad.NoPadding={pad:function(){},unpad:function(){}},function(){var e=r,t=e.lib.CipherParams,n=e.enc.Hex;e.format.Hex={stringify:function(e){return e.ciphertext.toString(n)},parse:function(e){var o=n.parse(e);return t.create({ciphertext:o})}}}(),function(){var e=r,t=e.lib.BlockCipher,n=e.algo,o=[],a=[],i=[],s=[],c=[],l=[],u=[],d=[],p=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,r=0;for(t=0;t<256;t++){var g=r^r<<1^r<<2^r<<3^r<<4;g=g>>>8^255&g^99,o[n]=g,a[g]=n;var m=e[n],f=e[m],v=e[f],_=257*e[g]^16843008*g;i[n]=_<<24|_>>>8,s[n]=_<<16|_>>>16,c[n]=_<<8|_>>>24,l[n]=_,_=16843009*v^65537*f^257*m^16843008*n,u[g]=_<<24|_>>>8,d[g]=_<<16|_>>>16,p[g]=_<<8|_>>>24,h[g]=_,n?(n=m^e[e[e[v^m]]],r^=e[e[r]]):n=r=1}}();var g=[0,1,2,4,8,16,32,64,128,27,54],m=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,a=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],s=0;s<a;s++)s<n?i[s]=t[s]:(l=i[s-1],s%n?n>6&&s%n==4&&(l=o[l>>>24]<<24|o[l>>>16&255]<<16|o[l>>>8&255]<<8|o[255&l]):(l=o[(l=l<<8|l>>>24)>>>24]<<24|o[l>>>16&255]<<16|o[l>>>8&255]<<8|o[255&l],l^=g[s/n|0]<<24),i[s]=i[s-n]^l);for(var r=this._invKeySchedule=[],c=0;c<a;c++){if(s=a-c,c%4)var l=i[s];else l=i[s-4];r[c]=c<4||s<=4?l:u[o[l>>>24]]^d[o[l>>>16&255]]^p[o[l>>>8&255]]^h[o[255&l]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,i,s,c,l,o)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,d,p,h,a),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,o,a,i,s,r){for(var c=this._nRounds,l=e[t]^n[0],u=e[t+1]^n[1],d=e[t+2]^n[2],p=e[t+3]^n[3],h=4,g=1;g<c;g++){var m=o[l>>>24]^a[u>>>16&255]^i[d>>>8&255]^s[255&p]^n[h++],f=o[u>>>24]^a[d>>>16&255]^i[p>>>8&255]^s[255&l]^n[h++],v=o[d>>>24]^a[p>>>16&255]^i[l>>>8&255]^s[255&u]^n[h++],_=o[p>>>24]^a[l>>>16&255]^i[u>>>8&255]^s[255&d]^n[h++];l=m,u=f,d=v,p=_}m=(r[l>>>24]<<24|r[u>>>16&255]<<16|r[d>>>8&255]<<8|r[255&p])^n[h++],f=(r[u>>>24]<<24|r[d>>>16&255]<<16|r[p>>>8&255]<<8|r[255&l])^n[h++],v=(r[d>>>24]<<24|r[p>>>16&255]<<16|r[l>>>8&255]<<8|r[255&u])^n[h++],_=(r[p>>>24]<<24|r[l>>>16&255]<<16|r[u>>>8&255]<<8|r[255&d])^n[h++],e[t]=m,e[t+1]=f,e[t+2]=v,e[t+3]=_},keySize:8});e.AES=t._createHelper(m)}(),function(){var e=r,t=e.lib,n=t.WordArray,o=t.BlockCipher,a=e.algo,i=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],u=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=a.DES=o.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var o=i[n]-1;t[n]=e[o>>>5]>>>31-o%32&1}for(var a=this._subKeys=[],r=0;r<16;r++){var l=a[r]=[],u=c[r];for(n=0;n<24;n++)l[n/6|0]|=t[(s[n]-1+u)%28]<<31-n%6,l[4+(n/6|0)]|=t[28+(s[n+24]-1+u)%28]<<31-n%6;for(l[0]=l[0]<<1|l[0]>>>31,n=1;n<7;n++)l[n]=l[n]>>>4*(n-1)+3;l[7]=l[7]<<5|l[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=a[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),p.call(this,1,1431655765);for(var o=0;o<16;o++){for(var a=n[o],i=this._lBlock,s=this._rBlock,r=0,c=0;c<8;c++)r|=l[c][((s^a[c])&u[c])>>>0];this._lBlock=s,this._rBlock=i^r}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,p.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function h(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=o._createHelper(d);var g=a.TripleDES=o.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),o=e.length<4?e.slice(0,2):e.slice(2,4),a=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=d.createEncryptor(n.create(t)),this._des2=d.createEncryptor(n.create(o)),this._des3=d.createEncryptor(n.create(a))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=o._createHelper(g)}(),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,o=n.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,o=this._S=[],a=0;a<256;a++)o[a]=a;a=0;for(var i=0;a<256;a++){var s=a%n,r=t[s>>>2]>>>24-s%4*8&255;i=(i+o[a]+r)%256;var c=o[a];o[a]=o[i],o[i]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=a.call(this)},keySize:8,ivSize:0});function a(){for(var e=this._S,t=this._i,n=this._j,o=0,a=0;a<4;a++){n=(n+e[t=(t+1)%256])%256;var i=e[t];e[t]=e[n],e[n]=i,o|=e[(e[t]+e[n])%256]<<24-8*a}return this._i=t,this._j=n,o}e.RC4=t._createHelper(o);var i=n.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)a.call(this)}});e.RC4Drop=t._createHelper(i)}(),
/** @preserve
               * Counter block mode compatible with  Dr Brian Gladman fileenc.c
               * derived from CryptoJS.mode.CTR
               * Jan Hruby jhruby.web@gmail.com
               */
r.mode.CTRGladman=function(){var e=r.lib.BlockCipherMode.extend();function t(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,n=e>>8&255,o=255&e;255===t?(t=0,255===n?(n=0,255===o?o=0:++o):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=o}return e}var n=e.Encryptor=e.extend({processBlock:function(e,n){var o,a=this._cipher,i=a.blockSize,s=this._iv,r=this._counter;s&&(r=this._counter=s.slice(0),this._iv=void 0),0===((o=r)[0]=t(o[0]))&&(o[1]=t(o[1]));var c=r.slice(0);a.encryptBlock(c,0);for(var l=0;l<i;l++)e[n+l]^=c[l]}});return e.Decryptor=n,e}(),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,o=[],a=[],i=[],s=n.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var o=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)a[n]^=o[n+4&7];if(t){var i=t.words,s=i[0],r=i[1],l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),u=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=l>>>16|4294901760&u,p=u<<16|65535&l;for(a[0]^=l,a[1]^=d,a[2]^=u,a[3]^=p,a[4]^=l,a[5]^=d,a[6]^=u,a[7]^=p,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var a=0;a<4;a++)o[a]=16711935&(o[a]<<8|o[a]>>>24)|4278255360&(o[a]<<24|o[a]>>>8),e[t+a]^=o[a]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)a[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<a[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<a[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<a[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<a[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<a[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<a[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<a[6]>>>0?1:0)|0,this._b=t[7]>>>0<a[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],s=65535&o,r=o>>>16,c=((s*s>>>17)+s*r>>>15)+r*r,l=((4294901760&o)*o|0)+((65535&o)*o|0);i[n]=c^l}e[0]=i[0]+(i[7]<<16|i[7]>>>16)+(i[6]<<16|i[6]>>>16)|0,e[1]=i[1]+(i[0]<<8|i[0]>>>24)+i[7]|0,e[2]=i[2]+(i[1]<<16|i[1]>>>16)+(i[0]<<16|i[0]>>>16)|0,e[3]=i[3]+(i[2]<<8|i[2]>>>24)+i[1]|0,e[4]=i[4]+(i[3]<<16|i[3]>>>16)+(i[2]<<16|i[2]>>>16)|0,e[5]=i[5]+(i[4]<<8|i[4]>>>24)+i[3]|0,e[6]=i[6]+(i[5]<<16|i[5]>>>16)+(i[4]<<16|i[4]>>>16)|0,e[7]=i[7]+(i[6]<<8|i[6]>>>24)+i[5]|0}e.Rabbit=t._createHelper(s)}(),r.mode.CTR=function(){var e=r.lib.BlockCipherMode.extend(),t=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,a=this._iv,i=this._counter;a&&(i=this._counter=a.slice(0),this._iv=void 0);var s=i.slice(0);n.encryptBlock(s,0),i[o-1]=i[o-1]+1|0;for(var r=0;r<o;r++)e[t+r]^=s[r]}});return e.Decryptor=t,e}(),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,o=[],a=[],i=[],s=n.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var a=0;a<4;a++)c.call(this);for(a=0;a<8;a++)o[a]^=n[a+4&7];if(t){var i=t.words,s=i[0],r=i[1],l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),u=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=l>>>16|4294901760&u,p=u<<16|65535&l;for(o[0]^=l,o[1]^=d,o[2]^=u,o[3]^=p,o[4]^=l,o[5]^=d,o[6]^=u,o[7]^=p,a=0;a<4;a++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var a=0;a<4;a++)o[a]=16711935&(o[a]<<8|o[a]>>>24)|4278255360&(o[a]<<24|o[a]>>>8),e[t+a]^=o[a]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)a[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<a[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<a[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<a[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<a[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<a[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<a[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<a[6]>>>0?1:0)|0,this._b=t[7]>>>0<a[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],s=65535&o,r=o>>>16,c=((s*s>>>17)+s*r>>>15)+r*r,l=((4294901760&o)*o|0)+((65535&o)*o|0);i[n]=c^l}e[0]=i[0]+(i[7]<<16|i[7]>>>16)+(i[6]<<16|i[6]>>>16)|0,e[1]=i[1]+(i[0]<<8|i[0]>>>24)+i[7]|0,e[2]=i[2]+(i[1]<<16|i[1]>>>16)+(i[0]<<16|i[0]>>>16)|0,e[3]=i[3]+(i[2]<<8|i[2]>>>24)+i[1]|0,e[4]=i[4]+(i[3]<<16|i[3]>>>16)+(i[2]<<16|i[2]>>>16)|0,e[5]=i[5]+(i[4]<<8|i[4]>>>24)+i[3]|0,e[6]=i[6]+(i[5]<<16|i[5]>>>16)+(i[4]<<16|i[4]>>>16)|0,e[7]=i[7]+(i[6]<<8|i[6]>>>24)+i[5]|0}e.RabbitLegacy=t._createHelper(s)}(),r.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){var t=e.words,n=e.sigBytes-1;for(n=e.sigBytes-1;n>=0;n--)if(t[n>>>2]>>>24-n%4*8&255){e.sigBytes=n+1;break}}},r)},c(l={exports:{}},l.exports),l.exports);return function(){function t(n){e(this,t);var o=n.isArray,a=n.isMap,i=n.isDevMode;this._isArray=o,this._isMap=a,this._isDevMode=i,this._interceptProfanityList=[],this._interceptFilter=null,this._interceptRegExpList=[],this._replacingProfanityMap=new Map,this._replacingFilter=null,this._replacingRegExpMap=new Map,this._key="",this._iv="",this._decryptOptions=void 0,this._n="TIMProfanityFilterPlugin",!0===i&&I("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n,".VERSION:").concat("1.1.0"))}return n(t,[{key:"onToken",value:function(e){this._key=g.enc.Utf8.parse(e.slice(0,32)),this._iv=this._key,this._decryptOptions={iv:this._iv,mode:g.mode.CBC,padding:g.pad.Pkcs7}}},{key:"onLexiconSliced",value:function(e){if(this._isArray(e)&&0!==e.length){var t,n,o,a=r(e);try{for(a.s();!(o=a.n()).done;){var i=o.value,s=i.filterType,c=i.profanityType,l=i.profanity,u=i.replacement;t=this._getDecryptedString(l),n=this._getDecryptedString(u),1===s?1===c?this._interceptProfanityList.push(t):2===c&&this._interceptRegExpList.push(t):2===s&&(1===c?this._replacingProfanityMap.set(t,n):2===c&&this._replacingRegExpMap.set(t,n))}}catch(d){a.e(d)}finally{a.f()}}}},{key:"_getDecryptedString",value:function(e){var t=g.AES.decrypt(e,this._key,this._decryptOptions);return g.enc.Utf8.stringify(t).toLowerCase()}},{key:"onLexiconCompleted",value:function(e){this.onLexiconSliced(e),this._interceptFilter=new d({input:this._interceptProfanityList,isArray:this._isArray,isMap:this._isMap}),this._replacingFilter=new d({input:this._replacingProfanityMap,isArray:this._isArray,isMap:this._isMap}),!0===this._isDevMode&&(I("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n," _interceptProfanityList ->"),this._interceptProfanityList),I("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n," _interceptRegExpList ->"),this._interceptRegExpList),I("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n," _replacingProfanityMap ->"),this._replacingProfanityMap),I("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n," _replacingRegExpMap ->"),this._replacingRegExpMap))}},{key:"filter",value:function(e){var t={type:0,modifiedText:e};if("string"!=typeof e)return!0===this._isDevMode&&I("warn","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n,".filter invalid params, string required!")),t;if(!0===this._interceptFilter.filter({text:e,replacingEnabled:!1}).isMatched)return t.type=1,t;for(var n=!1,a=0,i=this._interceptRegExpList.length;a<i;a++)if(new RegExp(this._interceptRegExpList[a],"gi").test(e.toLowerCase())){n=!0;break}if(n)return t.type=1,t;var s=this._replacingFilter.filter({text:e,replacingEnabled:!0});!0===s.isMatched&&(t.type=2,t.modifiedText=s.modifiedText);var c,l=t.modifiedText,u=null,d=r(this._replacingRegExpMap);try{for(d.s();!(c=d.n()).done;){var p=o(c.value,2),h=p[0],g=p[1];u=new RegExp(h,"gi"),l=l.replace(u,g)}}catch(m){d.e(m)}finally{d.f()}return l!==e&&(t.type=2,t.modifiedText=l),t}},{key:"reset",value:function(){this._isArray=null,this._isMap=null,this._interceptProfanityList.length=0,this._interceptRegExpList.length=0,this._replacingProfanityMap.clear(),this._replacingRegExpMap.clear(),this._key="",this._iv="",this._decryptOptions={},this._interceptFilter&&this._interceptFilter.reset(),this._replacingFilter&&this._replacingFilter.reset()}}]),t}()}()}(Xa);const Za=qa(Xa.exports);function Qa(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n}function ei(e,t,n,o){return new(n||(n=Promise))((function(a,i){function s(e){try{c(o.next(e))}catch(t){i(t)}}function r(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}c((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;let ti=class e{constructor(t){return e.instance||(e.instance=this,this.engine=t,this.events={},this.bindIMEvents()),e.instance}addEvent(e,t){this.events[e]||(this.events[e]=new Map),this.events[e].set(t,1)}removeEvents(){Object.keys(this.events).forEach((e=>{this.events[e].clear()})),this.events={}}dispatch(e,t){if(this.events[e])for(const n of this.events[e].keys())n.call(this,t)}bindIMEvents(){this.engine.chat.on(this.engine.EVENT.SDK_READY,this.onSDKReady,this),this.engine.chat.on(this.engine.EVENT.SDK_NOT_READY,this.onSDKNotReady,this),this.engine.chat.on(this.engine.EVENT.KICKED_OUT,this.onKickedOut,this),this.engine.chat.on(this.engine.EVENT.NET_STATE_CHANGE,this.onNetStateChange,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_MODIFIED,this.onMessageModified,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_REVOKED,this.onMessageRevoked,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_READ_BY_PEER,this.onMessageReadByPeer,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,this.onMessageReadReceiptReceived,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_REACTIONS_UPDATED,this.onMessageReactionsUpdated,this),this.engine.chat.on(this.engine.EVENT.CONVERSATION_LIST_UPDATED,this.onConversationListUpdated,this),this.engine.chat.on(this.engine.EVENT.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED,this.onTotalMessageCountUpdated,this),this.engine.chat.on(this.engine.EVENT.PROFILE_UPDATED,this.onProfileUpdated,this),this.engine.chat.on(this.engine.EVENT.BLACKLIST_UPDATED,this.onBlacklistUpdated,this),this.engine.chat.on(this.engine.EVENT.USER_STATUS_UPDATED,this.onUserStatusUpdated,this),this.engine.chat.on(this.engine.EVENT.GROUP_LIST_UPDATED,this.onGroupListUpdated,this),this.engine.chat.on(this.engine.EVENT.GROUP_ATTRIBUTES_UPDATED,this.onGroupAttributesUpdated,this),this.engine.chat.on(this.engine.EVENT.GROUP_COUNTER_UPDATED,this.onGroupCounterUpdated,this),this.engine.chat.on(this.engine.EVENT.FRIEND_LIST_UPDATED,this.onFriendListUpdated,this),this.engine.chat.on(this.engine.EVENT.FRIEND_APPLICATION_LIST_UPDATED,this.onFriendApplicationListUpdated,this)}unbindIMEvents(){this.engine.chat.off(this.engine.EVENT.SDK_READY,this.onSDKReady,this),this.engine.chat.off(this.engine.EVENT.SDK_NOT_READY,this.onSDKNotReady,this),this.engine.chat.off(this.engine.EVENT.KICKED_OUT,this.onKickedOut,this),this.engine.chat.off(this.engine.EVENT.NET_STATE_CHANGE,this.onNetStateChange,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_MODIFIED,this.onMessageModified,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_REVOKED,this.onMessageRevoked,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_READ_BY_PEER,this.onMessageReadByPeer,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,this.onMessageReadReceiptReceived,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_REACTIONS_UPDATED,this.onMessageReactionsUpdated,this),this.engine.chat.off(this.engine.EVENT.CONVERSATION_LIST_UPDATED,this.onConversationListUpdated,this),this.engine.chat.off(this.engine.EVENT.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED,this.onTotalMessageCountUpdated,this),this.engine.chat.off(this.engine.EVENT.PROFILE_UPDATED,this.onProfileUpdated,this),this.engine.chat.off(this.engine.EVENT.BLACKLIST_UPDATED,this.onBlacklistUpdated,this),this.engine.chat.off(this.engine.EVENT.USER_STATUS_UPDATED,this.onUserStatusUpdated,this),this.engine.chat.off(this.engine.EVENT.GROUP_LIST_UPDATED,this.onGroupListUpdated,this),this.engine.chat.off(this.engine.EVENT.GROUP_ATTRIBUTES_UPDATED,this.onGroupAttributesUpdated,this),this.engine.chat.off(this.engine.EVENT.GROUP_COUNTER_UPDATED,this.onGroupCounterUpdated,this),this.engine.chat.off(this.engine.EVENT.FRIEND_LIST_UPDATED,this.onFriendListUpdated,this),this.engine.chat.off(this.engine.EVENT.FRIEND_APPLICATION_LIST_UPDATED,this.onFriendApplicationListUpdated,this)}onSDKReady(e){this.dispatch(this.engine.EVENT.SDK_READY,e.data)}onSDKNotReady(e){this.dispatch(this.engine.EVENT.SDK_NOT_READY,e.data)}onKickedOut(e){this.dispatch(this.engine.EVENT.KICKED_OUT,e.data)}onNetStateChange(e){this.dispatch(this.engine.EVENT.NET_STATE_CHANGE,e.data)}onReceiveMessage(e){this.dispatch(this.engine.EVENT.MESSAGE_RECEIVED,e.data)}onMessageModified(e){this.dispatch(this.engine.EVENT.MESSAGE_MODIFIED,e.data)}onMessageRevoked(e){this.dispatch(this.engine.EVENT.MESSAGE_REVOKED,e.data)}onMessageReadByPeer(e){this.dispatch(this.engine.EVENT.MESSAGE_READ_BY_PEER,e.data)}onMessageReadReceiptReceived(e){this.dispatch(this.engine.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,e.data)}onMessageReactionsUpdated(e){this.dispatch(this.engine.EVENT.MESSAGE_REACTIONS_UPDATED,e.data)}onConversationListUpdated(e){this.dispatch(this.engine.EVENT.CONVERSATION_LIST_UPDATED,e.data)}onTotalMessageCountUpdated(e){this.dispatch(this.engine.EVENT.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED,e.data)}onProfileUpdated(e){this.dispatch(this.engine.EVENT.PROFILE_UPDATED,e.data)}onBlacklistUpdated(e){this.dispatch(this.engine.EVENT.BLACKLIST_UPDATED,e.data)}onUserStatusUpdated(e){this.dispatch(this.engine.EVENT.USER_STATUS_UPDATED,e.data)}onGroupListUpdated(e){this.dispatch(this.engine.EVENT.GROUP_LIST_UPDATED,e.data)}onGroupAttributesUpdated(e){this.dispatch(this.engine.EVENT.GROUP_ATTRIBUTES_UPDATED,e.data)}onGroupCounterUpdated(e){this.dispatch(this.engine.EVENT.GROUP_COUNTER_UPDATED,e.data)}onFriendListUpdated(e){this.dispatch(this.engine.EVENT.FRIEND_LIST_UPDATED,e.data)}onFriendApplicationListUpdated(e){this.dispatch(this.engine.EVENT.FRIEND_APPLICATION_LIST_UPDATED,e.data)}};var ni,oi,ai,ii,si,ri,ci,li,ui;!function(e){e.TUIStore="TUIStore",e.TUITranslate="TUITranslate",e.TUIConversation="TUIConversation",e.TUIChat="TUIChat",e.TUIGroup="TUIGroup",e.TUIUser="TUIUser",e.TUIFriend="TUIFriend"}(ni||(ni={})),function(e){e.APP="application",e.CONV="conversation",e.CHAT="chat",e.GRP="group",e.USER="user",e.FRIEND="friend",e.SEARCH="search",e.CUSTOM="custom"}(oi||(oi={})),function(e){e[e.UNSUB_USER=-1]="UNSUB_USER"}(ai||(ai={})),function(e){e.BUSINESS_ID="user_typing_status",e[e.STATUS_START=1]="STATUS_START",e[e.STATUS_END=0]="STATUS_END",e[e.VERSION=1]="VERSION",e[e.ACTION_START_ID=14]="ACTION_START_ID",e[e.ACTION_END_ID=0]="ACTION_END_ID",e.ACTION_START="EIMAMSG_InputStatus_Ing",e.ACTION_END="EIMAMSG_InputStatus_End",e[e.NEED_TYPING=1]="NEED_TYPING"}(ii||(ii={})),function(e){e.ADD="add",e.REMOVE="remove"}(si||(si={})),function(e){e[e.MSG_MODIFY_CONFLICT=2480]="MSG_MODIFY_CONFLICT",e[e.MSG_MODIFY_DISABLED_IN_AVCHATROOM=2481]="MSG_MODIFY_DISABLED_IN_AVCHATROOM",e[e.MODIFY_MESSAGE_NOT_EXIST=20026]="MODIFY_MESSAGE_NOT_EXIST"}(ri||(ri={})),function(e){e[e.NOT_INIT=-1e5]="NOT_INIT",e[e.INVALID_CONV_ID=-100001]="INVALID_CONV_ID",e[e.CONV_ID_SAME=-100002]="CONV_ID_SAME",e[e.CONV_NOT_EXIST=-100003]="CONV_NOT_EXIST",e[e.GET_MSG_LIST_ERROR=-100004]="GET_MSG_LIST_ERROR",e[e.MISMATCH_TYPE_AND_PAYLOAD=-100005]="MISMATCH_TYPE_AND_PAYLOAD"}(ci||(ci={})),function(e){e.MSG_MODIFY_CONFLICT="MODIFY_MESSAGE_ERROR,修改消息发生冲突, data.message 是最新的消息",e.MSG_MODIFY_DISABLED_IN_AVCHATROOM="MODIFY_MESSAGE_ERROR,不支持修改直播群消息.",e.MODIFY_MESSAGE_NOT_EXIST="MODIFY_MESSAGE_ERROR,消息不存在."}(li||(li={})),function(e){e.NOT_INIT="TUIChatEngine 初始化未完成，请确认 TUIChatEngine.login 接口调用是否正常。",e.INVALID_CONV_ID="会话 ID 无效",e.CONV_ID_SAME="您切换的是同一个会话 ID",e.CONV_NOT_EXIST="会话不存在",e.GET_MSG_LIST_ERROR="Chat SDK is not ready.",e.MISMATCH_TYPE_AND_PAYLOAD="type 与 payload 不匹配."}(ui||(ui={}));const di=function(e){return void 0===e},pi=function(e){return e.startsWith("_")},hi=function(e){return/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/.test(e)},gi=function(e){return e&&function(e){if("string"==typeof e)try{return!!JSON.parse(e)}catch(t){return!1}return!1}(e)?JSON.parse(e):e},mi=function(e){let t="";return t=e>=1048576?`${(e/1048576).toFixed(2)} Mb`:e>=1024?`${(e/1024).toFixed(2)} Kb`:`${e.toFixed(2)}B`,t},fi={"[TUIEmoji_Expect]":"emoji_0@2x.png","[TUIEmoji_Blink]":"emoji_1@2x.png","[TUIEmoji_Guffaw]":"emoji_2@2x.png","[TUIEmoji_KindSmile]":"emoji_3@2x.png","[TUIEmoji_Haha]":"emoji_4@2x.png","[TUIEmoji_Cheerful]":"emoji_5@2x.png","[TUIEmoji_Smile]":"emoji_6@2x.png","[TUIEmoji_Sorrow]":"emoji_7@2x.png","[TUIEmoji_Speechless]":"emoji_8@2x.png","[TUIEmoji_Amazed]":"emoji_9@2x.png","[TUIEmoji_Complacent]":"emoji_10@2x.png","[TUIEmoji_Lustful]":"emoji_11@2x.png","[TUIEmoji_Stareyes]":"emoji_12@2x.png","[TUIEmoji_Giggle]":"emoji_13@2x.png","[TUIEmoji_Daemon]":"emoji_14@2x.png","[TUIEmoji_Rage]":"emoji_15@2x.png","[TUIEmoji_Yawn]":"emoji_16@2x.png","[TUIEmoji_TearsLaugh]":"emoji_17@2x.png","[TUIEmoji_Silly]":"emoji_18@2x.png","[TUIEmoji_Wail]":"emoji_19@2x.png","[TUIEmoji_Kiss]":"emoji_20@2x.png","[TUIEmoji_Trapped]":"emoji_21@2x.png","[TUIEmoji_Fear]":"emoji_22@2x.png","[TUIEmoji_BareTeeth]":"emoji_23@2x.png","[TUIEmoji_FlareUp]":"emoji_24@2x.png","[TUIEmoji_Tact]":"emoji_25@2x.png","[TUIEmoji_Shit]":"emoji_26@2x.png","[TUIEmoji_ShutUp]":"emoji_27@2x.png","[TUIEmoji_Sigh]":"emoji_28@2x.png","[TUIEmoji_Hehe]":"emoji_29@2x.png","[TUIEmoji_Silent]":"emoji_30@2x.png","[TUIEmoji_Skull]":"emoji_31@2x.png","[TUIEmoji_Mask]":"emoji_32@2x.png","[TUIEmoji_Beer]":"emoji_33@2x.png","[TUIEmoji_Cake]":"emoji_34@2x.png","[TUIEmoji_RedPacket]":"emoji_35@2x.png","[TUIEmoji_Bombs]":"emoji_36@2x.png","[TUIEmoji_Ai]":"emoji_37@2x.png","[TUIEmoji_Celebrate]":"emoji_38@2x.png","[TUIEmoji_Bless]":"emoji_39@2x.png","[TUIEmoji_Flower]":"emoji_40@2x.png","[TUIEmoji_Watermelon]":"emoji_41@2x.png","[TUIEmoji_Cow]":"emoji_42@2x.png","[TUIEmoji_Fool]":"emoji_43@2x.png","[TUIEmoji_Surprised]":"emoji_44@2x.png","[TUIEmoji_Askance]":"emoji_45@2x.png","[TUIEmoji_Monster]":"emoji_46@2x.png","[TUIEmoji_Pig]":"emoji_47@2x.png","[TUIEmoji_Coffee]":"emoji_48@2x.png","[TUIEmoji_Ok]":"emoji_49@2x.png","[TUIEmoji_Heart]":"emoji_50@2x.png","[TUIEmoji_Sun]":"emoji_51@2x.png","[TUIEmoji_Moon]":"emoji_52@2x.png","[TUIEmoji_Star]":"emoji_53@2x.png","[TUIEmoji_Rich]":"emoji_54@2x.png","[TUIEmoji_Fortune]":"emoji_55@2x.png","[TUIEmoji_857]":"emoji_56@2x.png","[TUIEmoji_666]":"emoji_57@2x.png","[TUIEmoji_Prohibit]":"emoji_58@2x.png","[TUIEmoji_Convinced]":"emoji_59@2x.png","[TUIEmoji_Knife]":"emoji_60@2x.png","[TUIEmoji_Like]":"emoji_61@2x.png"},vi={"[TUIEmoji_Smile]":"[微笑]","[TUIEmoji_Expect]":"[期待]","[TUIEmoji_Blink]":"[眨眼]","[TUIEmoji_Guffaw]":"[大笑]","[TUIEmoji_KindSmile]":"[姨母笑]","[TUIEmoji_Haha]":"[哈哈哈]","[TUIEmoji_Cheerful]":"[愉快]","[TUIEmoji_Speechless]":"[无语]","[TUIEmoji_Amazed]":"[惊讶]","[TUIEmoji_Sorrow]":"[悲伤]","[TUIEmoji_Complacent]":"[得意]","[TUIEmoji_Silly]":"[傻了]","[TUIEmoji_Lustful]":"[色]","[TUIEmoji_Giggle]":"[憨笑]","[TUIEmoji_Kiss]":"[亲亲]","[TUIEmoji_Wail]":"[大哭]","[TUIEmoji_TearsLaugh]":"[哭笑]","[TUIEmoji_Trapped]":"[困]","[TUIEmoji_Mask]":"[口罩]","[TUIEmoji_Fear]":"[恐惧]","[TUIEmoji_BareTeeth]":"[龇牙]","[TUIEmoji_FlareUp]":"[发怒]","[TUIEmoji_Yawn]":"[打哈欠]","[TUIEmoji_Tact]":"[机智]","[TUIEmoji_Stareyes]":"[星星眼]","[TUIEmoji_ShutUp]":"[闭嘴]","[TUIEmoji_Sigh]":"[叹气]","[TUIEmoji_Hehe]":"[呵呵]","[TUIEmoji_Silent]":"[收声]","[TUIEmoji_Surprised]":"[惊喜]","[TUIEmoji_Askance]":"[白眼]","[TUIEmoji_Ok]":"[OK]","[TUIEmoji_Shit]":"[便便]","[TUIEmoji_Monster]":"[怪兽]","[TUIEmoji_Daemon]":"[恶魔]","[TUIEmoji_Rage]":"[恶魔怒]","[TUIEmoji_Fool]":"[衰]","[TUIEmoji_Pig]":"[猪]","[TUIEmoji_Cow]":"[牛]","[TUIEmoji_Ai]":"[AI]","[TUIEmoji_Skull]":"[骷髅]","[TUIEmoji_Bombs]":"[炸弹]","[TUIEmoji_Coffee]":"[咖啡]","[TUIEmoji_Cake]":"[蛋糕]","[TUIEmoji_Beer]":"[啤酒]","[TUIEmoji_Flower]":"[花]","[TUIEmoji_Watermelon]":"[瓜]","[TUIEmoji_Rich]":"[壕]","[TUIEmoji_Heart]":"[爱心]","[TUIEmoji_Moon]":"[月亮]","[TUIEmoji_Sun]":"[太阳]","[TUIEmoji_Star]":"[星星]","[TUIEmoji_RedPacket]":"[红包]","[TUIEmoji_Celebrate]":"[庆祝]","[TUIEmoji_Bless]":"[福]","[TUIEmoji_Fortune]":"[发]","[TUIEmoji_Convinced]":"[服]","[TUIEmoji_Prohibit]":"[禁]","[TUIEmoji_666]":"[666]","[TUIEmoji_857]":"[857]","[TUIEmoji_Knife]":"[刀]","[TUIEmoji_Like]":"[赞]"},_i={enabledMessageReadReceipt:Math.pow(2,5),enabledEmojiPlugin:Math.pow(2,48),enabledOnlineStatus:Math.pow(2,7),enabledCustomerServicePlugin:Math.pow(2,40),enabledTranslationPlugin:Math.pow(2,38),enabledVoiceToText:Math.pow(2,39)},yi=["messageList","conversationList","newMessageList"],Ii=["translateTextInfo","voiceToTextInfo"],Ei="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),Ci="undefined"!=typeof uni&&"undefined"==typeof window,ki=Ei||Ci,Ti="undefined"!=typeof uni,Mi=("undefined"!=typeof uni||"undefined"!=typeof window)&&!ki,Si=Ei?wx:Ti?uni:window,Di=Mi&&window&&window.navigator&&window.navigator.userAgent||"",bi=/Android/i.test(Di),wi=/(?:Windows Phone)/.test(Di),Ni=/(?:SymbianOS)/.test(Di),Li=/iPad/i.test(Di)||/iPhone/i.test(Di)||/iPod/i.test(Di),Ri=bi||wi||Ni||Li,Ai=Mi&&!Ri;class Oi{constructor(){this.global=Si,this.isOfficial=!1}static getInstance(){return Oi.instance||(Oi.instance=new Oi),Oi.instance}initOfficial(e){this.isOfficial=e}getPlatform(){let e="";return Ai?e="pc":Ri?e="h5":Ei?e="wechat":Ci&&!Ei&&(e="app"),e}}class Ui{constructor(){this.EVENT=Ka.EVENT,this.TYPES=Ka.TYPES,this.loginStatusPromise=new Map,this.userID="",this.isInited=!1}static getInstance(){return Ui.instance||(Ui.instance=new Ui),Ui.instance}mount(e,t){this[e]=t}login(e){const{chat:t,SDKAppID:n,userID:o}=e,a=1400187352===n||1400188366===n;return this.createChat(e),this.userID=o,Oi.getInstance().initOfficial(a),this.TUIStore.update(oi.APP,"isOfficial",a),this.TUIStore.update(oi.APP,"SDKVersion",Ka.VERSION),this.eventCenter=new ti(this),this.eventCenter.removeEvents(),this.initStore(),this.initService(),t&&t.isReady()?(I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.login ok, from TUICore."),this.TUIUser.getUserProfile(),this.checkCommercialAbility(),Promise.resolve({})):(this.registerPlugin(e),this.eventCenter.addEvent(this.EVENT.SDK_READY,(()=>{this.onSDKReady()})),this.eventCenter.addEvent(this.EVENT.SDK_NOT_READY,(()=>{this.onSDKNotReady()})),this.loginChat(e))}logout(){return this.userID="",this.isInited=!1,this.chat.logout()}isReady(){var e;return(null===(e=this.chat)||void 0===e?void 0:e.isReady())||!1}setLogLevel(e){if(this.chat)return this.chat.setLogLevel(e);I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine 初始化未完成，请确认 TUIChatEngine.login 接口调用是否正常。")}destroy(){return this.eventCenter.unbindIMEvents(),this.isInited=!1,this.chat.destroy()}getMyUserID(){return this.userID}initStore(){this.TUIStore.reset(oi.CHAT),this.TUIStore.reset(oi.CONV),this.TUIStore.reset(oi.GRP),this.TUIStore.reset(oi.USER),this.TUIStore.reset(oi.SEARCH),I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.initStore ok.")}initService(){this.TUIChat.init(),this.TUIConversation.init(),this.TUIUser.init(),this.initOptionalServices(),this.isInited=!0,I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.initService ok.")}initOptionalServices(){const e=Ka.VERSION.split(".");e[0]>3||3===e[0]&&e[1]>=3&&e[2]>0?(!0===this.chat.callExperimentalAPI("canIUseModule",["group-module"])&&this.TUIGroup.init(),!0===this.chat.callExperimentalAPI("canIUseModule",["relationship-module"])&&this.TUIFriend.init()):(this.TUIGroup.init(),this.TUIFriend.init())}createChat(e){const{chat:t}=e,n=Qa(e,["chat"]);di(t)?this.chat=Ka.create(Object.assign(Object.assign({},n),{scene:"chat-uikit-engine"})):this.chat=t}loginChat(e){const{userID:t,userSig:n}=e;return new Promise(((e,o)=>{this.chat.login({userID:t,userSig:n}).then((t=>{I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.loginChat ok."),this.checkCommercialAbility(),t.data.repeatLogin&&this.chat.isReady()&&e(t),this.loginStatusPromise.set("login",{resolve:e,reject:o,imResponse:t})})).catch((e=>{o(e)}))}))}registerPlugin(e){const{useUploadPlugin:t=!1,useProfanityFilterPlugin:n=!1,TIMPush:o,pushConfig:a,TUIOfflinePush:i,offlinePushConfig:s}=e;!0===t&&this.chat.registerPlugin({"tim-upload-plugin":Ya}),!0===n&&this.chat.registerPlugin({"tim-profanity-filter-plugin":Za}),!Ci||Ei||di(o)||di(a)||this.chat.registerPlugin({"tim-push":o,pushConfig:a}),!Ci||Ei||di(i)||di(s)||this.chat.registerPlugin({"tim-offline-push-plugin":i,offlinePushConfig:s})}onSDKReady(){if(this.loginStatusPromise.has("login")){const e=this.loginStatusPromise.get("login");e.resolve(e.imResponse),this.TUIUser.getUserProfile()}this.loginStatusPromise.delete("login")}onSDKNotReady(){this.loginStatusPromise.has("login")&&this.loginStatusPromise.get("login").reject(new Error("sdk not ready")),this.loginStatusPromise.delete("login")}checkCommercialAbility(){Object.keys(_i).forEach((e=>{const t=_i[e];this.chat.callExperimentalAPI("isCommercialAbilityEnabled",t).then((t=>{const{enabled:n=!1}=t.data;this.TUIStore.update(oi.APP,e,n)}))}))}}class Pi{constructor(){this.defaultStore={enabledMessageReadReceipt:!1,enabledEmojiPlugin:!1,enabledOnlineStatus:!1,enabledCustomerServicePlugin:!1,enabledTranslationPlugin:!1,enabledVoiceToText:!1,enableTyping:!0,enableConversationDraft:!0,isOfficial:!1,SDKVersion:"3.0.0",tasks:{sendMessage:!1,revokeMessage:!1,modifyNickName:!1,groupChat:!1,muteGroup:!1,dismissGroup:!1,call:!1,searchCloudMessage:!1,customerService:!1,translateTextMessage:!1}},this.store={enabledEmojiPlugin:!1,enabledMessageReadReceipt:!1,enabledOnlineStatus:!1,enabledCustomerServicePlugin:!1,enabledTranslationPlugin:!1,enabledVoiceToText:!1,enableTyping:!0,enableConversationDraft:!0,isOfficial:!1,SDKVersion:"3.0.0",tasks:{sendMessage:!1,revokeMessage:!1,modifyNickName:!1,groupChat:!1,muteGroup:!1,dismissGroup:!1,call:!1,searchCloudMessage:!1,customerService:!1,translateTextMessage:!1}}}update(e,t){this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}}class Gi{constructor(){this.defaultStore={userProfile:{},displayOnlineStatus:!1,displayMessageReadReceipt:!0,userStatusList:new Map,kickedOut:"",netStateChange:"",userBlacklist:[],targetLanguage:"zh"},this.store={userProfile:{},displayOnlineStatus:!1,displayMessageReadReceipt:!0,userStatusList:new Map,kickedOut:"",netStateChange:"",userBlacklist:[],targetLanguage:"zh"}}update(e,t){"userStatusList"===e?this.updateUserStatusList(t):this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}updateUserStatusList(e){0!==e.length?e.forEach((e=>{const{userID:t,statusType:n=0,customStatus:o=""}=e;n===ai.UNSUB_USER?this.store.userStatusList.delete(t):this.store.userStatusList.set(t,{statusType:n,customStatus:o})})):this.store.userStatusList.clear()}}class xi{getEngine(){return Ui.getInstance()}}const Bi=function(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(function(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n}(e)){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}return!1},Vi=["[图片]","[语音]","[视频]","[文件]","[位置]","[地理位置]","[动画表情]","[自定义消息]","[群提示消息]","[聊天记录]"];class Fi extends xi{constructor(e){super(),this.initProxy(e),this.isMuted=this.messageRemindType===this.getEngine().TYPES.MSG_REMIND_ACPT_NOT_NOTE||this.messageRemindType===this.getEngine().TYPES.MSG_REMIND_DISCARD,this.operationType=0,this._conversation=e}initProxy(e){Object.keys(e).forEach((t=>{pi(t)||(this[t]=e[t])}))}updateProperties(e){Object.keys(e).forEach((t=>{pi(t)||(this[t]=e[t])}))}updateOperationType(e){this.operationType=e}getConversation(){return this._conversation}deleteConversation(){return this.getEngine().TUIConversation.deleteConversation(this.conversationID)}pinConversation(){return this.getEngine().TUIConversation.pinConversation({conversationID:this.conversationID,isPinned:!this.isPinned})}muteConversation(){const e=this.getEngine(),t={messageRemindType:!0===this.isMuted?e.TYPES.MSG_REMIND_ACPT_AND_NOTE:e.TYPES.MSG_REMIND_ACPT_NOT_NOTE};if(this.type===e.TYPES.CONV_C2C){const n=this.conversationID.replace(e.TYPES.CONV_C2C,"");t.userIDList=[n]}else if(this.type===e.TYPES.CONV_GROUP){const n=this.conversationID.replace(e.TYPES.CONV_GROUP,"");t.groupID=n}return e.TUIConversation.muteConversation(t)}getAvatar(){var e,t,n,o,a,i;const s=this.getEngine();let r="";switch(this.type){case s.TYPES.CONV_C2C:r=hi(null===(e=this.userProfile)||void 0===e?void 0:e.avatar)?null===(t=this.userProfile)||void 0===t?void 0:t.avatar:"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png";break;case s.TYPES.CONV_GROUP:r=hi(null===(n=this.groupProfile)||void 0===n?void 0:n.avatar)?null===(o=this.groupProfile)||void 0===o?void 0:o.avatar:"https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg";break;case s.TYPES.CONV_SYSTEM:r=hi(null===(a=this.groupProfile)||void 0===a?void 0:a.avatar)?null===(i=this.groupProfile)||void 0===i?void 0:i.avatar:"https://web.sdk.qcloud.com/component/TUIKit/assets/group_avatar.png"}return r}getShowName(){var e,t,n,o;const a=this.getEngine();let i="";switch(this.type){case a.TYPES.CONV_C2C:i=this.remark||(null===(e=this.userProfile)||void 0===e?void 0:e.nick)||(null===(t=this.userProfile)||void 0===t?void 0:t.userID)||"";break;case a.TYPES.CONV_GROUP:i=(null===(n=this.groupProfile)||void 0===n?void 0:n.name)||(null===(o=this.groupProfile)||void 0===o?void 0:o.groupID)||"";break;case a.TYPES.CONV_SYSTEM:i=a.TUITranslate.t("系统通知")}return i}getGroupAtInfo(){const e=this.getEngine(),t=e.TUITranslate.t.bind(e.TUITranslate),n=[`[${t("TUIConversation.有人@我")}]`,`[${t("TUIConversation.@所有人")}]`,`[${t("TUIConversation.@所有人")}][${t("TUIConversation.有人@我")}]`];let o="";for(let a=0;a<this.groupAtInfoList.length;a++)this.groupAtInfoList[a].atTypeArray[0]&&this.unreadCount>0&&(o=n[this.groupAtInfoList[a].atTypeArray[0]-1]);return o}getLastMessage(e){return"time"===e?this.getLastMessageTime():"text"===e?this.getLastMessageText():(I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`ConversationModel.getLastMessage key:${e} is invalid.`),null)}getLastMessageTime(){var e;const t=this.getEngine();let n="";return(null===(e=this.lastMessage)||void 0===e?void 0:e.lastTime)>0&&(n=function(e,t){const n=36e5,o=24*n,a=7*o,i=(new Date).getTime()-e;let s="";if(i<0)return s;const r=i/6e4,c=i/n,l=i/o,u=i/a;if(u>=1&&u<=4)s=` ${parseInt(`${u}`,10)} ${t("time.周")}${t("time.前")}`;else if(l>=1&&l<=6)s=` ${parseInt(`${l}`,10)} ${t("time.天")}${t("time.前")}`;else if(c>=1&&c<=23)s=` ${parseInt(`${c}`,10)} ${t("time.小时")}${t("time.前")}`;else if(r>=1&&r<=59)s=` ${parseInt(`${r}`,10)} ${t("time.分钟")}${t("time.前")}`;else if(i>=0&&i<=6e4)s=`${t("time.刚刚")}`;else{const t=new Date;t.setTime(e),s=`${t.getFullYear()}-${t.getMonth()+1<10?`0${t.getMonth()+1}`:t.getMonth()+1}-${t.getDate()<10?`0${t.getDate()}`:t.getDate()}`}return s}(1e3*this.lastMessage.lastTime,t.TUITranslate.t.bind(t.TUITranslate))),n}getLastMessageText(){var e;if(this.draftText)return gi(this.draftText).abstract;const t=this.getEngine(),n=t.TUITranslate.t.bind(t.TUITranslate);if(4===this.operationType)return n("TUIConversation.您已被群管理员移出群聊");if(5===this.operationType)return n("TUIConversation.该群聊已被解散");if(8===this.operationType)return n("TUIConversation.您已退出该群聊");const o=this._conversation,a=this.lastMessage;let i="",s="";const r=o.unreadCount>0&&o.messageRemindType===t.TYPES.MSG_REMIND_ACPT_NOT_NOTE?`[${o.unreadCount>99?"99+":o.unreadCount}${n("TUIConversation.条")}]`:"";if(o.type===t.TYPES.CONV_GROUP)if(a.fromAccount===t.getMyUserID())i=n("TUIConversation.我");else{const e=a.fromAccount;i=t.TUIFriend.getFriendRemark([e])[e]||a.nameCard||a.nick||e}if(a.type===t.TYPES.MSG_TEXT)s=this.decodeTextMessage(a.payload.text);else if(a.type===t.TYPES.MSG_CUSTOM){const o=gi(null===(e=null==a?void 0:a.payload)||void 0===e?void 0:e.data);if(1===(null==o?void 0:o.businessID))return s=t.TUIChat.messageHandler.handleCallKitSignaling(a),s;s=Vi.includes(a.messageForShow)?n(`TUIChat.${a.messageForShow}`):a.messageForShow}else s=Vi.includes(a.messageForShow)?n(`TUIChat.${a.messageForShow}`):a.messageForShow;return a.isRevoked&&(s=n("TUIChat.撤回了一条消息")),o.type===t.TYPES.CONV_GROUP&&a.type===t.TYPES.MSG_GRP_TIP?s:`${r}${i?`${i}:`:""}${s}`}decodeTextMessage(e){if(Bi(e))return e;const t=/(\[.+?\])/g;let n=e;if(t.test(e)){const o=this.getEngine(),a=o.TUITranslate.t.bind(o.TUITranslate);n=e.replace(t,(e=>{const t=a(`Emoji.${e}`);return Ei||!t||t.startsWith("Emoji.")?vi[e]||e:t}))}return n}}class Hi{constructor(){this.defaultStore={currentConversationID:"",totalUnreadCount:0,conversationList:[],currentConversation:null,operationTypeMap:new Map},this.store={currentConversationID:"",totalUnreadCount:0,conversationList:[],currentConversation:null,operationTypeMap:new Map}}update(e,t){switch(e){case"conversationList":this.updateConversationList(t);break;case"operationTypeMap":this.updateOperationTypeMap(t);break;default:this.store[e]=t}}getData(e){return this.store[e]}getModel(e){return this.store.conversationList.find((t=>t.conversationID===e))}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}updateConversationList(e){const t=[];e.forEach((e=>{let n=e;e instanceof Fi?n.updateProperties(e):n=new Fi(e);const o=this.getOperationType(e);n.updateOperationType(o),t.push(n)})),this.store.conversationList=t}updateOperationTypeMap(e){const{conversationID:t,operationType:n=0}=e;this.store.operationTypeMap.set(t,n)}getOperationType(e){const{conversationID:t}=e;return this.store.operationTypeMap.get(t)||0}}class ji extends xi{constructor(e){super(),this.messageHandlers={[this.getEngine().TYPES.MSG_TEXT]:e=>this.getEngine().TUIChat.messageHandler.handleTextMessage(e),[this.getEngine().TYPES.MSG_FACE]:e=>this.getEngine().TUIChat.messageHandler.handleFaceMessage(e),[this.getEngine().TYPES.MSG_LOCATION]:e=>this.getEngine().TUIChat.messageHandler.handleLocationMessage(e),[this.getEngine().TYPES.MSG_IMAGE]:e=>this.getEngine().TUIChat.messageHandler.handleImageMessage(e),[this.getEngine().TYPES.MSG_AUDIO]:e=>this.getEngine().TUIChat.messageHandler.handleAudioMessage(e),[this.getEngine().TYPES.MSG_VIDEO]:e=>this.getEngine().TUIChat.messageHandler.handleVideoMessage(e),[this.getEngine().TYPES.MSG_FILE]:e=>this.getEngine().TUIChat.messageHandler.handleFileMessage(e),[this.getEngine().TYPES.MSG_CUSTOM]:e=>this.getEngine().TUIChat.messageHandler.handleCustomMessage(e),[this.getEngine().TYPES.MSG_MERGER]:e=>this.getEngine().TUIChat.messageHandler.handleMergeMessage(e),[this.getEngine().TYPES.MSG_GRP_TIP]:e=>this.getEngine().TUIChat.messageHandler.handleGroupTipsMessage(e)},this._message=e,this._signalingInfo=void 0,this.progress=0,this.reactionList=[],this.initProperties(e)}initProperties(e){Object.keys(e).forEach((t=>{pi(t)||(this[t]=e[t])}))}updateProperties(e){this._message=e,Object.keys(e).forEach((t=>{pi(t)||(this[t]=e[t])}))}getMessage(){return this._message}modifyMessage(e){return e.type&&this._message.type!==e.type&&!e.payload?Promise.reject({code:ci.MISMATCH_TYPE_AND_PAYLOAD,message:ui.MISMATCH_TYPE_AND_PAYLOAD}):(this._message.type=e.type||this._message.type,this._message.payload=e.payload||this._message.payload,this._message.cloudCustomData=e.cloudCustomData||this._message.cloudCustomData,this.getEngine().TUIChat.modifyMessage(this._message))}revokeMessage(){return this.getEngine().TUIChat.revokeMessage(this._message)}resendMessage(){return this.getEngine().TUIChat.resendMessage(this._message)}deleteMessage(){return this.getEngine().TUIChat.deleteMessage([this._message])}quoteMessage(){return this.getEngine().TUIChat.quoteMessage(this._message)}replyMessage(){return this.getEngine().TUIChat.replyMessage(this._message)}setMessageExtensions(e){return this.getEngine().TUIChat.setMessageExtensions(this._message,e)}getMessageExtensions(){return this.getEngine().TUIChat.getMessageExtensions(this._message)}deleteMessageExtensions(e){return this.getEngine().TUIChat.deleteMessageExtensions(this._message,e)}getSignalingInfo(){return this.type!==this.getEngine().TYPES.MSG_CUSTOM?null:di(this._signalingInfo)?(this._signalingInfo=this.getEngine().chat.getSignalingInfo(this._message),this._signalingInfo):this._signalingInfo}getMessageContent(){const e=this.messageHandlers[this.type];if(di(e))return{};if(this.type===this.getEngine().TYPES.MSG_GRP_TIP)return e(this._message);const t=this.getEngine().TUIFriend.getFriendRemark([this.from]);return Object.assign(Object.assign({},e(this._message)),{showName:t[this.from]||this.nameCard||this.nick||this.from})}sendForwardMessage(e){return this.getEngine().TUIChat.sendForwardMessage(e,[this._message])}}class qi{constructor(){this.defaultStore={messageList:[],isCompleted:!1,nextReqMessageID:"",quoteMessage:{},newMessageList:[],typingStatus:!1,messageSource:void 0,translateTextInfo:void 0,voiceToTextInfo:void 0,userInfo:{}},this.store={messageList:[],isCompleted:!1,nextReqMessageID:"",quoteMessage:{},newMessageList:[],typingStatus:!1,messageSource:void 0,translateTextInfo:void 0,voiceToTextInfo:void 0,userInfo:{}}}update(e,t){switch(e){case"messageList":this.updateMessageList(t);break;case"translateTextInfo":this.updateTranslateTextInfo(t);break;case"voiceToTextInfo":this.updateVoiceToTextInfo(t);break;default:this.store[e]=t}}getData(e){return this.store[e]}getModel(e){return this.store.messageList.find((t=>t.ID===e))}reset(e=[]){const t=e.filter((e=>!Ii.includes(e)));this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),null==t?void 0:t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}updateMessageList(e){const t=[];e.forEach((e=>{let n=e;e instanceof ji||(n=this.getModel(e.ID),n?n.updateProperties(e):n=new ji(e)),t.push(n)})),this.store.messageList=t}updateTranslateTextInfo(e){this.updateBykey("translateTextInfo",e)}updateVoiceToTextInfo(e){this.updateBykey("voiceToTextInfo",e)}updateBykey(e,t){const{conversationID:n,messageID:o,visible:a=!1}=t;this.store[e]||(this.store[e]=new Map),this.store[e].has(n)||this.store[e].set(n,[]);const i=this.store[e].get(n)||[];let s=!0;for(let r=0;r<i.length;r++)if(i[r].messageID===o){i[r].visible=a,s=!1;break}s&&i.push({messageID:o,visible:a}),this.store[e].set(n,i)}}class zi{constructor(e){this.groupAttributes={},this.groupCounters={},this.initProxy(e)}initProxy(e){Object.keys(e).forEach((t=>{pi(t)||(this[t]=e[t])}))}}class Ki{constructor(){this.defaultStore={currentGroupID:"",currentGroup:{},currentGroupAttributes:{},currentGroupCounters:{},currentGroupMemberList:[],groupList:[],groupSystemNoticeList:[]},this.store={currentGroupID:"",currentGroup:void 0,currentGroupAttributes:{},currentGroupCounters:{},currentGroupMemberList:[],groupList:[],groupSystemNoticeList:[]}}update(e,t){switch(e){case"groupList":this.updateGroupList(t);break;case"currentGroup":this.store.currentGroup=t instanceof zi?t:new zi(t);break;default:this.store[e]=t}}getData(e){if("groupSystemNoticeList"===e){const e=[...this.store.groupSystemNoticeList];return this.store.groupSystemNoticeList.length=0,e}return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}updateGroupList(e){this.store.groupList=e.map((e=>e instanceof zi?e:new zi(e)))}}class $i{constructor(){this.store={}}update(e,t){this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){0===e.length&&(this.store={}),this.store=Object.assign(Object.assign({},this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:void 0})),{}))}}class Yi{constructor(){this.defaultStore={friendList:[],friendApplicationList:[],friendApplicationUnreadCount:0},this.store={friendList:[],friendApplicationList:[],friendApplicationUnreadCount:0}}update(e,t){this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}}class Wi{constructor(){this.defaultStore={currentSearchInputValue:{value:"",searchType:"global"},currentSearchMessageType:{value:{key:"",label:"",value:""},searchType:"global"},currentSearchMessageTime:{value:{key:"",label:"",value:{timePosition:0,timePeriod:0}},searchType:"global"},currentSearchingStatus:{isSearching:!1,searchType:"global"},isShowInConversationSearch:!1},this.store={currentSearchInputValue:{value:"",searchType:"global"},currentSearchMessageType:{value:{key:"",label:"",value:""},searchType:"global"},currentSearchMessageTime:{value:{key:"",label:"",value:{timePosition:0,timePeriod:0}},searchType:"global"},currentSearchingStatus:{isSearching:!1,searchType:"global"},isShowInConversationSearch:!1}}update(e,t){this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),null==e?void 0:e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}}class Ji{constructor(){this.storeMap={[oi.APP]:new Pi,[oi.USER]:new Gi,[oi.CONV]:new Hi,[oi.CHAT]:new qi,[oi.GRP]:new Ki,[oi.FRIEND]:new Yi,[oi.SEARCH]:new Wi},this.task={}}static getInstance(){return Ji.instance||(Ji.instance=new Ji),Ji.instance}watch(e,t){this.task[e]||(this.task[e]={});const n=this.task[e];Object.keys(t).forEach((o=>{const a=t[o];n[o]||(n[o]=new Map),n[o].set(a,1),this.notifyOnWatch(e,o,a)}))}unwatch(e,t){if(!this.task[e])return;const n=this.task[e];Object.keys(t).forEach((e=>{var o;null===(o=n[e])||void 0===o||o.delete(t[e])}))}update(e,t,n){var o;e!==oi.CUSTOM||this.storeMap[e]||(this.storeMap[e]=new $i),null===(o=this.storeMap[e])||void 0===o||o.update(t,n),this.notify(e,t)}getData(e,t){var n;return e!==oi.CUSTOM||this.storeMap[e]||(this.storeMap[e]=new $i),null===(n=this.storeMap[e])||void 0===n?void 0:n.getData(t)}getConversationModel(e){var t;return null===(t=this.storeMap[oi.CONV])||void 0===t?void 0:t.getModel(e)}getMessageModel(e){var t;return null===(t=this.storeMap[oi.CHAT])||void 0===t?void 0:t.getModel(e)}reset(e,t=[],n=!1){if(e in this.storeMap){const o=this.storeMap[e];0===t.length&&(t=Object.keys(null==o?void 0:o.store)),o.reset(t),n&&t.forEach((t=>{this.notify(e,t)}))}}notifyOnWatch(e,t,n){const o=this.getData(e,t);yi.indexOf(t)>-1&&0===o.length||n&&n.call(this,o)}notify(e,t){if(!this.task[e])return;const n=this.task[e];if(n[t]){const o=n[t],a=this.getData(e,t);for(const[e]of o.entries())e.call(this,a)}}}function Xi(e){return(Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qi(e){var t=function(e){if("object"!=Xi(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Xi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Xi(t)?t:t+""}function es(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Qi(o.key),o)}}function ts(e,t,n){return t&&es(e.prototype,t),n&&es(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ns(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function os(e,t){return(os=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function as(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&os(e,t)}function is(e,t){if(t&&("object"==Xi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ns(e)}function ss(e){return(ss=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rs(e,t,n){return(t=Qi(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function ls(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function us(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ls(Object(n),!0).forEach((function(t){rs(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ls(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ds={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},ps=new(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Zi(this,e),this.init(t,n)}return ts(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||ds,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,o){return o&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,us(us({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}},{key:"clone",value:function(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new e(this.logger,t)}}]),e}()),hs=function(){function e(){Zi(this,e),this.observers={}}return ts(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,n)})),this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(n))}))}}]),e}();function gs(){var e,t,n=new Promise((function(n,o){e=n,t=o}));return n.resolve=e,n.reject=t,n}function ms(e){return null==e?"":""+e}function fs(e,t,n){function o(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function a(){return!e||"string"==typeof e}for(var i="string"!=typeof t?[].concat(t):t.split(".");i.length>1;){if(a())return{};var s=o(i.shift());!e[s]&&n&&(e[s]=new n),e=Object.prototype.hasOwnProperty.call(e,s)?e[s]:{}}return a()?{}:{obj:e,k:o(i.shift())}}function vs(e,t,n){var o=fs(e,t,Object);o.obj[o.k]=n}function _s(e,t){var n=fs(e,t),o=n.obj,a=n.k;if(o)return o[a]}function ys(e,t,n){for(var o in t)"__proto__"!==o&&"constructor"!==o&&(o in e?"string"==typeof e[o]||e[o]instanceof String||"string"==typeof t[o]||t[o]instanceof String?n&&(e[o]=t[o]):ys(e[o],t[o],n):e[o]=t[o]);return e}function Is(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var Es={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function Cs(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return Es[e]})):e}var ks="undefined"!=typeof window&&window.navigator&&void 0===window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,Ts=[" ",",","?","!",";"];function Ms(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var o=t.split(n),a=e,i=0;i<o.length;++i){if(!a)return;if("string"==typeof a[o[i]]&&i+1<o.length)return;if(void 0===a[o[i]]){for(var s=2,r=o.slice(i,i+s).join(n),c=a[r];void 0===c&&o.length>i+s;)s++,c=a[r=o.slice(i,i+s).join(n)];if(void 0===c)return;if(null===c)return null;if(t.endsWith(r)){if("string"==typeof c)return c;if(r&&"string"==typeof c[r])return c[r]}var l=o.slice(i+s).join(n);return l?Ms(c,l,n):void 0}a=a[o[i]]}return a}}function Ss(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ds(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ss(Object(n),!0).forEach((function(t){rs(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ss(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bs=function(){as(t,hs);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ss(e);if(t){var a=ss(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return is(this,n)}}(t);function t(n){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return Zi(this,t),o=e.call(this),ks&&hs.call(ns(o)),o.data=n||{},o.options=a,void 0===o.options.keySeparator&&(o.options.keySeparator="."),void 0===o.options.ignoreJSONStructure&&(o.options.ignoreJSONStructure=!0),o}return ts(t,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=void 0!==o.keySeparator?o.keySeparator:this.options.keySeparator,i=void 0!==o.ignoreJSONStructure?o.ignoreJSONStructure:this.options.ignoreJSONStructure,s=[e,t];n&&"string"!=typeof n&&(s=s.concat(n)),n&&"string"==typeof n&&(s=s.concat(a?n.split(a):n)),e.indexOf(".")>-1&&(s=e.split("."));var r=_s(this.data,s);return r||!i||"string"!=typeof n?r:Ms(this.data&&this.data[e]&&this.data[e][t],n,a)}},{key:"addResource",value:function(e,t,n,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},i=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator,s=[e,t];n&&(s=s.concat(i?n.split(i):n)),e.indexOf(".")>-1&&(o=t,t=(s=e.split("."))[1]),this.addNamespaces(t),vs(this.data,s,o),a.silent||this.emit("added",e,t,n,o)}},{key:"addResources",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var a in n)"string"!=typeof n[a]&&"[object Array]"!==Object.prototype.toString.apply(n[a])||this.addResource(e,t,a,n[a],{silent:!0});o.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},s=[e,t];e.indexOf(".")>-1&&(o=n,n=t,t=(s=e.split("."))[1]),this.addNamespaces(t);var r=_s(this.data,s)||{};o?ys(r,n,a):r=Ds(Ds({},r),n),vs(this.data,s,r),i.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?Ds(Ds({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((function(e){return t[e]&&Object.keys(t[e]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),t}(),ws={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,o,a){var i=this;return e.forEach((function(e){i.processors[e]&&(t=i.processors[e].process(t,n,o,a))})),t}};function Ns(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ls(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ns(Object(n),!0).forEach((function(t){rs(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ns(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rs={},As=function(){as(t,hs);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ss(e);if(t){var a=ss(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return is(this,n)}}(t);function t(n){var o,a,i,s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Zi(this,t),o=e.call(this),ks&&hs.call(ns(o)),a=["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],i=n,s=ns(o),a.forEach((function(e){i[e]&&(s[e]=i[e])})),o.options=r,void 0===o.options.keySeparator&&(o.options.keySeparator="."),o.logger=ps.create("translator"),o}return ts(t,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var o=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,a=t.ns||this.options.defaultNS||[],i=n&&e.indexOf(n)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||function(e,t,n){t=t||"",n=n||"";var o=Ts.filter((function(e){return t.indexOf(e)<0&&n.indexOf(e)<0}));if(0===o.length)return!0;var a=new RegExp("(".concat(o.map((function(e){return"?"===e?"\\?":e})).join("|"),")")),i=!a.test(e);if(!i){var s=e.indexOf(n);s>0&&!a.test(e.substring(0,s))&&(i=!0)}return i}(e,n,o));if(i&&!s){var r=e.match(this.interpolator.nestingRegexp);if(r&&r.length>0)return{key:e,namespaces:a};var c=e.split(n);(n!==o||n===o&&this.options.ns.indexOf(c[0])>-1)&&(a=c.shift()),e=c.join(o)}return"string"==typeof a&&(a=[a]),{key:e,namespaces:a}}},{key:"translate",value:function(e,n,o){var a=this;if("object"!==Xi(n)&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),"object"===Xi(n)&&(n=Ls({},n)),n||(n={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var i=void 0!==n.returnDetails?n.returnDetails:this.options.returnDetails,s=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,r=this.extractFromKey(e[e.length-1],n),c=r.key,l=r.namespaces,u=l[l.length-1],d=n.lng||this.language,p=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d&&"cimode"===d.toLowerCase()){if(p){var h=n.nsSeparator||this.options.nsSeparator;return i?{res:"".concat(u).concat(h).concat(c),usedKey:c,exactUsedKey:c,usedLng:d,usedNS:u}:"".concat(u).concat(h).concat(c)}return i?{res:c,usedKey:c,exactUsedKey:c,usedLng:d,usedNS:u}:c}var g=this.resolve(e,n),m=g&&g.res,f=g&&g.usedKey||c,v=g&&g.exactUsedKey||c,_=Object.prototype.toString.apply(m),y=void 0!==n.joinArrays?n.joinArrays:this.options.joinArrays,I=!this.i18nFormat||this.i18nFormat.handleAsObject;if(I&&m&&"string"!=typeof m&&"boolean"!=typeof m&&"number"!=typeof m&&["[object Number]","[object Function]","[object RegExp]"].indexOf(_)<0&&("string"!=typeof y||"[object Array]"!==_)){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var E=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,m,Ls(Ls({},n),{},{ns:l})):"key '".concat(c," (").concat(this.language,")' returned an object instead of string.");return i?(g.res=E,g):E}if(s){var C="[object Array]"===_,k=C?[]:{},T=C?v:f;for(var M in m)if(Object.prototype.hasOwnProperty.call(m,M)){var S="".concat(T).concat(s).concat(M);k[M]=this.translate(S,Ls(Ls({},n),{joinArrays:!1,ns:l})),k[M]===S&&(k[M]=m[M])}m=k}}else if(I&&"string"==typeof y&&"[object Array]"===_)(m=m.join(y))&&(m=this.extendTranslation(m,e,n,o));else{var D=!1,b=!1,w=void 0!==n.count&&"string"!=typeof n.count,N=t.hasDefaultValue(n),L=w?this.pluralResolver.getSuffix(d,n.count,n):"",R=n["defaultValue".concat(L)]||n.defaultValue;!this.isValidLookup(m)&&N&&(D=!0,m=R),this.isValidLookup(m)||(b=!0,m=c);var A=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&b?void 0:m,O=N&&R!==m&&this.options.updateMissing;if(b||D||O){if(this.logger.log(O?"updateKey":"missingKey",d,u,c,O?R:m),s){var U=this.resolve(c,Ls(Ls({},n),{},{keySeparator:!1}));U&&U.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var P=[],G=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if("fallback"===this.options.saveMissingTo&&G&&G[0])for(var x=0;x<G.length;x++)P.push(G[x]);else"all"===this.options.saveMissingTo?P=this.languageUtils.toResolveHierarchy(n.lng||this.language):P.push(n.lng||this.language);var B=function(e,t,o){var i=N&&o!==m?o:A;a.options.missingKeyHandler?a.options.missingKeyHandler(e,u,t,i,O,n):a.backendConnector&&a.backendConnector.saveMissing&&a.backendConnector.saveMissing(e,u,t,i,O,n),a.emit("missingKey",e,u,t,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&w?P.forEach((function(e){a.pluralResolver.getSuffixes(e,n).forEach((function(t){B([e],c+t,n["defaultValue".concat(t)]||R)}))})):B(P,c,R))}m=this.extendTranslation(m,e,n,g,o),b&&m===c&&this.options.appendNamespaceToMissingKey&&(m="".concat(u,":").concat(c)),(b||D)&&this.options.parseMissingKeyHandler&&(m="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(u,":").concat(c):c,D?m:void 0):this.options.parseMissingKeyHandler(m))}return i?(g.res=m,g):m}},{key:"extendTranslation",value:function(e,t,n,o,a){var i=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,Ls(Ls({},this.options.interpolation.defaultVariables),n),o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(Ls(Ls({},n),{interpolation:Ls(Ls({},this.options.interpolation),n.interpolation)}));var s,r="string"==typeof e&&(n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(r){var c=e.match(this.interpolator.nestingRegexp);s=c&&c.length}var l=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(l=Ls(Ls({},this.options.interpolation.defaultVariables),l)),e=this.interpolator.interpolate(e,l,n.lng||this.language,n),r){var u=e.match(this.interpolator.nestingRegexp);s<(u&&u.length)&&(n.nest=!1)}!n.lng&&"v1"!==this.options.compatibilityAPI&&o&&o.res&&(n.lng=o.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,o=new Array(e),s=0;s<e;s++)o[s]=arguments[s];return a&&a[0]===o[0]&&!n.context?(i.logger.warn("It seems you are nesting recursively key: ".concat(o[0]," in key: ").concat(t[0])),null):i.translate.apply(i,o.concat([t]))}),n)),n.interpolation&&this.interpolator.reset()}var d=n.postProcess||this.options.postProcess,p="string"==typeof d?[d]:d;return null!=e&&p&&p.length&&!1!==n.applyPostProcessor&&(e=ws.handle(p,e,t,this.options&&this.options.postProcessPassResolved?Ls({i18nResolved:o},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,o,a,i,s=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!s.isValidLookup(t)){var c=s.extractFromKey(e,r),l=c.key;n=l;var u=c.namespaces;s.options.fallbackNS&&(u=u.concat(s.options.fallbackNS));var d=void 0!==r.count&&"string"!=typeof r.count,p=d&&!r.ordinal&&0===r.count&&s.pluralResolver.shouldUseIntlApi(),h=void 0!==r.context&&("string"==typeof r.context||"number"==typeof r.context)&&""!==r.context,g=r.lngs?r.lngs:s.languageUtils.toResolveHierarchy(r.lng||s.language,r.fallbackLng);u.forEach((function(e){s.isValidLookup(t)||(i=e,!Rs["".concat(g[0],"-").concat(e)]&&s.utils&&s.utils.hasLoadedNamespace&&!s.utils.hasLoadedNamespace(i)&&(Rs["".concat(g[0],"-").concat(e)]=!0,s.logger.warn('key "'.concat(n,'" for languages "').concat(g.join(", "),'" won\'t get resolved as namespace "').concat(i,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),g.forEach((function(n){if(!s.isValidLookup(t)){a=n;var i,c=[l];if(s.i18nFormat&&s.i18nFormat.addLookupKeys)s.i18nFormat.addLookupKeys(c,l,n,e,r);else{var u;d&&(u=s.pluralResolver.getSuffix(n,r.count,r));var g="".concat(s.options.pluralSeparator,"zero");if(d&&(c.push(l+u),p&&c.push(l+g)),h){var m="".concat(l).concat(s.options.contextSeparator).concat(r.context);c.push(m),d&&(c.push(m+u),p&&c.push(m+g))}}for(;i=c.pop();)s.isValidLookup(t)||(o=i,t=s.getResource(n,e,i,r))}})))}))}})),{res:t,usedKey:n,exactUsedKey:o,usedLng:a,usedNS:i}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,o):this.resourceStore.getResource(e,t,n,o)}}],[{key:"hasDefaultValue",value:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}]),t}();function Os(e){return e.charAt(0).toUpperCase()+e.slice(1)}var Us=function(){function e(t){Zi(this,e),this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=ps.create("languageUtils")}return ts(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=Os(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=Os(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=Os(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach((function(e){if(!t){var o=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(o)||(t=o)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var o=n.getLanguagePartFromCode(e);if(n.isSupportedCode(o))return t=o;t=n.options.supportedLngs.find((function(e){return e===o?e:e.indexOf("-")<0&&o.indexOf("-")<0?void 0:0===e.indexOf(o)?e:void 0}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,o=this.getFallbackCodes(t||this.options.fallbackLng||[],e),a=[],i=function(e){e&&(n.isSupportedCode(e)?a.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(e))):"string"==typeof e&&i(this.formatLanguageCode(e)),o.forEach((function(e){a.indexOf(e)<0&&i(n.formatLanguageCode(e))})),a}}]),e}(),Ps=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Gs={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},xs=["v1","v2","v3"],Bs={zero:0,one:1,two:2,few:3,many:4,other:5},Vs=function(){function e(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Zi(this,e),this.languageUtils=t,this.options=o,this.logger=ps.create("pluralResolver"),this.options.compatibilityJSON&&"v4"!==this.options.compatibilityJSON||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(n={},Ps.forEach((function(e){e.lngs.forEach((function(t){n[t]={numbers:e.nr,plurals:Gs[e.fc]}}))})),n)}return ts(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(e,{type:t.ordinal?"ordinal":"cardinal"})}catch(n){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map((function(e){return"".concat(t).concat(e)}))}},{key:"getSuffixes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.getRule(e,n);return o?this.shouldUseIntlApi()?o.resolvedOptions().pluralCategories.sort((function(e,t){return Bs[e]-Bs[t]})).map((function(e){return"".concat(t.options.prepend).concat(e)})):o.numbers.map((function(o){return t.getSuffix(e,o,n)})):[]}},{key:"getSuffix",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this.getRule(e,n);return o?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(o.select(t)):this.getSuffixRetroCompatible(o,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var n=this,o=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),a=e.numbers[o];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===a?a="plural":1===a&&(a=""));var i=function(){return n.options.prepend&&a.toString()?n.options.prepend+a.toString():a.toString()};return"v1"===this.options.compatibilityJSON?1===a?"":"number"==typeof a?"_plural_".concat(a.toString()):i():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?i():this.options.prepend&&o.toString()?this.options.prepend+o.toString():o.toString()}},{key:"shouldUseIntlApi",value:function(){return!xs.includes(this.options.compatibilityJSON)}}]),e}();function Fs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Hs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fs(Object(n),!0).forEach((function(t){rs(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function js(e,t,n){var o,a,i,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=(o=t,void 0!==(i=_s(e,a=n))?i:_s(o,a));return!c&&r&&"string"==typeof n&&void 0===(c=Ms(e,n,s))&&(c=Ms(t,n,s)),c}var qs=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Zi(this,e),this.logger=ps.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return ts(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:Cs,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?Is(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?Is(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?Is(t.nestingPrefix):t.nestingPrefixEscaped||Is("$t("),this.nestingSuffix=t.nestingSuffix?Is(t.nestingSuffix):t.nestingSuffixEscaped||Is(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,o){var a,i,s,r=this,c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function l(e){return e.replace(/\$/g,"$$$$")}var u=function(e){if(e.indexOf(r.formatSeparator)<0){var a=js(t,c,e,r.options.keySeparator,r.options.ignoreJSONStructure);return r.alwaysFormat?r.format(a,void 0,n,Hs(Hs(Hs({},o),t),{},{interpolationkey:e})):a}var i=e.split(r.formatSeparator),s=i.shift().trim(),l=i.join(r.formatSeparator).trim();return r.format(js(t,c,s,r.options.keySeparator,r.options.ignoreJSONStructure),l,n,Hs(Hs(Hs({},o),t),{},{interpolationkey:s}))};this.resetRegExp();var d=o&&o.missingInterpolationHandler||this.options.missingInterpolationHandler,p=o&&o.interpolation&&void 0!==o.interpolation.skipOnVariables?o.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return l(e)}},{regex:this.regexp,safeValue:function(e){return r.escapeValue?l(r.escape(e)):l(e)}}].forEach((function(t){for(s=0;a=t.regex.exec(e);){var n=a[1].trim();if(void 0===(i=u(n)))if("function"==typeof d){var c=d(e,a,o);i="string"==typeof c?c:""}else if(o&&Object.prototype.hasOwnProperty.call(o,n))i="";else{if(p){i=a[0];continue}r.logger.warn("missed to pass in variable ".concat(n," for interpolating ").concat(e)),i=""}else"string"==typeof i||r.useRawValueToEscape||(i=ms(i));var l=t.safeValue(i);if(e=e.replace(a[0],l),p?(t.regex.lastIndex+=i.length,t.regex.lastIndex-=a[0].length):t.regex.lastIndex=0,++s>=r.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var n,o,a,i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function r(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var o=e.split(new RegExp("".concat(n,"[ ]*{"))),i="{".concat(o[1]);e=o[0];var s=(i=this.interpolate(i,a)).match(/'/g),r=i.match(/"/g);(s&&s.length%2==0&&!r||r.length%2!=0)&&(i=i.replace(/'/g,'"'));try{a=JSON.parse(i),t&&(a=Hs(Hs({},t),a))}catch(c){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),c),"".concat(e).concat(n).concat(i)}return delete a.defaultValue,e}for(;n=this.nestingRegexp.exec(e);){var c=[];(a=(a=Hs({},s)).replace&&"string"!=typeof a.replace?a.replace:a).applyPostProcessor=!1,delete a.defaultValue;var l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){var u=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=u.shift(),c=u,l=!0}if((o=t(r.call(this,n[1].trim(),a),a))&&n[0]===e&&"string"!=typeof o)return o;"string"!=typeof o&&(o=ms(o)),o||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),o=""),l&&(o=c.reduce((function(e,t){return i.format(e,t,s.lng,Hs(Hs({},s),{},{interpolationkey:n[1].trim()}))}),o.trim())),e=e.replace(n[0],o),this.regexp.lastIndex=0}return e}}]),e}();function zs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ks(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zs(Object(n),!0).forEach((function(t){rs(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $s(e){var t={};return function(n,o,a){var i=o+JSON.stringify(a),s=t[i];return s||(s=e(o,a),t[i]=s),s(n)}}var Ys=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Zi(this,e),this.logger=ps.create("formatter"),this.options=t,this.formats={number:$s((function(e,t){var n=new Intl.NumberFormat(e,Ks({},t));return function(e){return n.format(e)}})),currency:$s((function(e,t){var n=new Intl.NumberFormat(e,Ks(Ks({},t),{},{style:"currency"}));return function(e){return n.format(e)}})),datetime:$s((function(e,t){var n=new Intl.DateTimeFormat(e,Ks({},t));return function(e){return n.format(e)}})),relativetime:$s((function(e,t){var n=new Intl.RelativeTimeFormat(e,Ks({},t));return function(e){return n.format(e,t.range||"day")}})),list:$s((function(e,t){var n=new Intl.ListFormat(e,Ks({},t));return function(e){return n.format(e)}}))},this.init(t)}return ts(e,[{key:"init",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"addCached",value:function(e,t){this.formats[e.toLowerCase().trim()]=$s(t)}},{key:"format",value:function(e,t,n){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return t.split(this.formatSeparator).reduce((function(e,t){var i=function(e){var t=e.toLowerCase().trim(),n={};if(e.indexOf("(")>-1){var o=e.split("(");t=o[0].toLowerCase().trim();var a=o[1].substring(0,o[1].length-1);"currency"===t&&a.indexOf(":")<0?n.currency||(n.currency=a.trim()):"relativetime"===t&&a.indexOf(":")<0?n.range||(n.range=a.trim()):a.split(";").forEach((function(e){if(e){var t=function(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return cs(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cs(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split(":")),o=t[0],a=t.slice(1).join(":").trim().replace(/^'+|'+$/g,"");n[o.trim()]||(n[o.trim()]=a),"false"===a&&(n[o.trim()]=!1),"true"===a&&(n[o.trim()]=!0),isNaN(a)||(n[o.trim()]=parseInt(a,10))}}))}return{formatName:t,formatOptions:n}}(t),s=i.formatName,r=i.formatOptions;if(o.formats[s]){var c=e;try{var l=a&&a.formatParams&&a.formatParams[a.interpolationkey]||{},u=l.locale||l.lng||a.locale||a.lng||n;c=o.formats[s](e,u,Ks(Ks(Ks({},r),a),l))}catch(d){o.logger.warn(d)}return c}return o.logger.warn("there was no format function for ".concat(s)),e}),e)}}]),e}();function Ws(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Js(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ws(Object(n),!0).forEach((function(t){rs(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ws(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xs=function(){as(t,hs);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ss(e);if(t){var a=ss(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return is(this,n)}}(t);function t(n,o,a){var i,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Zi(this,t),i=e.call(this),ks&&hs.call(ns(i)),i.backend=n,i.store=o,i.services=a,i.languageUtils=a.languageUtils,i.options=s,i.logger=ps.create("backendConnector"),i.waitingReads=[],i.maxParallelReads=s.maxParallelReads||10,i.readingCalls=0,i.maxRetries=s.maxRetries>=0?s.maxRetries:5,i.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,i.state={},i.queue=[],i.backend&&i.backend.init&&i.backend.init(a,s.backend,s),i}return ts(t,[{key:"queueLoad",value:function(e,t,n,o){var a=this,i={},s={},r={},c={};return e.forEach((function(e){var o=!0;t.forEach((function(t){var r="".concat(e,"|").concat(t);!n.reload&&a.store.hasResourceBundle(e,t)?a.state[r]=2:a.state[r]<0||(1===a.state[r]?void 0===s[r]&&(s[r]=!0):(a.state[r]=1,o=!1,void 0===s[r]&&(s[r]=!0),void 0===i[r]&&(i[r]=!0),void 0===c[t]&&(c[t]=!0)))})),o||(r[e]=!0)})),(Object.keys(i).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:o}),{toLoad:Object.keys(i),pending:Object.keys(s),toLoadLanguages:Object.keys(r),toLoadNamespaces:Object.keys(c)}}},{key:"loaded",value:function(e,t,n){var o=e.split("|"),a=o[0],i=o[1];t&&this.emit("failedLoading",a,i,t),n&&this.store.addResourceBundle(a,i,n),this.state[e]=t?-1:2;var s={};this.queue.forEach((function(n){var o,r,c,l,u,d,p;o=n.loaded,r=i,(l=(c=fs(o,[a],Object)).obj)[u=c.k]=l[u]||[],l[u].push(r),p=e,void 0!==(d=n).pending[p]&&(delete d.pending[p],d.pendingCount--),t&&n.errors.push(t),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach((function(e){s[e]||(s[e]={});var t=n.loaded[e];t.length&&t.forEach((function(t){void 0===s[e][t]&&(s[e][t]=!0)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,n){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,s=arguments.length>5?arguments[5]:void 0;if(!e.length)return s(null,{});if(this.readingCalls>=this.maxParallelReads)this.waitingReads.push({lng:e,ns:t,fcName:n,tried:a,wait:i,callback:s});else{this.readingCalls++;var r=function(r,c){if(o.readingCalls--,o.waitingReads.length>0){var l=o.waitingReads.shift();o.read(l.lng,l.ns,l.fcName,l.tried,l.wait,l.callback)}r&&c&&a<o.maxRetries?setTimeout((function(){o.read.call(o,e,t,n,a+1,2*i,s)}),i):s(r,c)},c=this.backend[n].bind(this.backend);if(2!==c.length)return c(e,t,r);try{var l=c(e,t);l&&"function"==typeof l.then?l.then((function(e){return r(null,e)})).catch(r):r(null,l)}catch(u){r(u)}}}},{key:"prepareLoading",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var i=this.queueLoad(e,t,o,a);if(!i.toLoad.length)return i.pending.length||a(),null;i.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=e.split("|"),a=o[0],i=o[1];this.read(a,i,"read",void 0,void 0,(function(o,s){o&&t.logger.warn("".concat(n,"loading namespace ").concat(i," for language ").concat(a," failed"),o),!o&&s&&t.logger.log("".concat(n,"loaded namespace ").concat(i," for language ").concat(a),s),t.loaded(e,o,s)}))}},{key:"saveMissing",value:function(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(null!=n&&""!==n){if(this.backend&&this.backend.create){var r=Js(Js({},i),{},{isUpdate:a}),c=this.backend.create.bind(this.backend);if(c.length<6)try{var l;(l=5===c.length?c(e,t,n,o,r):c(e,t,n,o))&&"function"==typeof l.then?l.then((function(e){return s(null,e)})).catch(s):s(null,l)}catch(u){s(u)}else c(e,t,n,o,s,r)}e&&e[0]&&this.store.addResource(e[0],t,n,o)}}}]),t}();function Zs(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===Xi(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===Xi(e[2])||"object"===Xi(e[3])){var n=e[3]||e[2];Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,n,o){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function Qs(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function er(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function tr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?er(Object(n),!0).forEach((function(t){rs(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):er(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nr(){}var or=function(){as(t,hs);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=ss(e);if(t){var a=ss(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return is(this,n)}}(t);function t(){var n,o,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(Zi(this,t),n=e.call(this),ks&&hs.call(ns(n)),n.options=Qs(a),n.services={},n.logger=ps,n.modules={external:[]},o=ns(n),Object.getOwnPropertyNames(Object.getPrototypeOf(o)).forEach((function(e){"function"==typeof o[e]&&(o[e]=o[e].bind(o))})),i&&!n.isInitialized&&!a.isClone){if(!n.options.initImmediate)return n.init(a,i),is(n,ns(n));setTimeout((function(){n.init(a,i)}),0)}return n}return ts(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;"function"==typeof t&&(n=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));var o=Zs();function a(e){return e?"function"==typeof e?new e:e:null}if(this.options=tr(tr(tr({},o),this.options),Qs(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=tr(tr({},o.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){var i;this.modules.logger?ps.init(a(this.modules.logger),this.options):ps.init(null,this.options),this.modules.formatter?i=this.modules.formatter:"undefined"!=typeof Intl&&(i=Ys);var s=new Us(this.options);this.store=new bs(this.options.resources,this.options);var r=this.services;r.logger=ps,r.resourceStore=this.store,r.languageUtils=s,r.pluralResolver=new Vs(s,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!i||this.options.interpolation.format&&this.options.interpolation.format!==o.interpolation.format||(r.formatter=a(i),r.formatter.init(r,this.options),this.options.interpolation.format=r.formatter.format.bind(r.formatter)),r.interpolator=new qs(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new Xs(a(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",(function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];e.emit.apply(e,[t].concat(o))})),this.modules.languageDetector&&(r.languageDetector=a(this.modules.languageDetector),r.languageDetector.init&&r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=a(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new As(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];e.emit.apply(e,[t].concat(o))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.format=this.options.interpolation.format,n||(n=nr),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.length>0&&"dev"!==c[0]&&(this.options.lng=c[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}})),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments),e}}));var l=gs(),u=function(){var t=function(t,o){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),l.resolve(o),n(t,o)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),l}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nr,o="string"==typeof e?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(o&&"cimode"===o.toLowerCase())return n();var a=[],i=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){a.indexOf(e)<0&&a.push(e)}))};o?i(o):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return i(e)})),this.options.preload&&this.options.preload.forEach((function(e){return i(e)})),this.services.backendConnector.load(a,this.options.ns,(function(e){e||t.resolvedLanguage||!t.language||t.setResolvedLanguage(t.language),n(e)}))}else n(null)}},{key:"reloadResources",value:function(e,t,n){var o=gs();return e||(e=this.languages),t||(t=this.options.ns),n||(n=nr),this.services.backendConnector.reload(e,t,(function(e){o.resolve(),n(e)})),o}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&ws.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var n=this.languages[t];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}},{key:"changeLanguage",value:function(e,t){var n=this;this.isLanguageChangingTo=e;var o=gs();this.emit("languageChanging",e);var a=function(e){n.language=e,n.languages=n.services.languageUtils.toResolveHierarchy(e),n.resolvedLanguage=void 0,n.setResolvedLanguage(e)},i=function(i){e||i||!n.services.languageDetector||(i=[]);var s="string"==typeof i?i:n.services.languageUtils.getBestMatchFromCodes(i);s&&(n.language||a(s),n.translator.language||n.translator.changeLanguage(s),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage&&n.services.languageDetector.cacheUserLanguage(s)),n.loadResources(s,(function(e){var i,r;i=e,(r=s)?(a(r),n.translator.changeLanguage(r),n.isLanguageChangingTo=void 0,n.emit("languageChanged",r),n.logger.log("languageChanged",r)):n.isLanguageChangingTo=void 0,o.resolve((function(){return n.t.apply(n,arguments)})),t&&t(i,(function(){return n.t.apply(n,arguments)}))}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(i):this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),o}},{key:"getFixedT",value:function(e,t,n){var o=this,a=function e(t,a){var i;if("object"!==Xi(a)){for(var s=arguments.length,r=new Array(s>2?s-2:0),c=2;c<s;c++)r[c-2]=arguments[c];i=o.options.overloadTranslationOptionHandler([t,a].concat(r))}else i=tr({},a);i.lng=i.lng||e.lng,i.lngs=i.lngs||e.lngs,i.ns=i.ns||e.ns,i.keyPrefix=i.keyPrefix||n||e.keyPrefix;var l,u=o.options.keySeparator||".";return l=i.keyPrefix&&Array.isArray(t)?t.map((function(e){return"".concat(i.keyPrefix).concat(u).concat(e)})):i.keyPrefix?"".concat(i.keyPrefix).concat(u).concat(t):t,o.t(l,i)};return"string"==typeof e?a.lng=e:a.lngs=e,a.ns=t,a.keyPrefix=n,a}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var o=n.lng||this.resolvedLanguage||this.languages[0],a=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===o.toLowerCase())return!0;var s=function(e,n){var o=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===o||2===o};if(n.precheck){var r=n.precheck(this,s);if(void 0!==r)return r}return!(!this.hasResourceBundle(o,e)&&this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages)&&(!s(o,e)||a&&!s(i,e)))}},{key:"loadNamespaces",value:function(e,t){var n=this,o=gs();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){o.resolve(),t&&t(e)})),o):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=gs();"string"==typeof e&&(e=[e]);var o=this.options.preload||[],a=e.filter((function(e){return o.indexOf(e)<0}));return a.length?(this.options.preload=o.concat(a),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";var t=this.services&&this.services.languageUtils||new Us(Zs());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nr,a=tr(tr(tr({},this.options),n),{isClone:!0}),i=new t(a);return void 0===n.debug&&void 0===n.prefix||(i.logger=i.logger.clone(n)),["store","services","language"].forEach((function(t){i[t]=e[t]})),i.services=tr({},this.services),i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i.translator=new As(i.services,i.options),i.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];i.emit.apply(i,[e].concat(n))})),i.init(a,o),i.translator.options=i.options,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),t}();rs(or,"createInstance",(function(){return new or(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}));var ar=or.createInstance();ar.createInstance=or.createInstance,ar.createInstance,ar.dir,ar.init,ar.loadResources,ar.reloadResources,ar.use,ar.changeLanguage,ar.getFixedT,ar.t,ar.exists,ar.setDefaultNamespace,ar.hasLoadedNamespace,ar.loadNamespaces,ar.loadLanguages;class ir extends xi{constructor(){super(),this.languages=null,this.keyMap={}}static getInstance(){return ir.instance||(ir.instance=new ir),ir.instance}provideLanguages(e){var t;Ei||(this.languages=e,(null===(t=e["zh-CN"])||void 0===t?void 0:t.Chat)&&this.setKeyMap(e["zh-CN"]),I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUITranslateService.provideLanguages ok."))}useI18n(e){if(Ei)return;if(!this.languages)return void I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUITranslateService.useI18next not have messages.");const t={};for(const[n,o]of Object.entries(this.languages))t["zh_cn"===n?"zh":n]={translation:o};ar.init({compatibilityJSON:"v3",lng:e||"zh",fallbackLng:"zh",detection:{order:["querystring","navigator"],caches:["localStorage","cookie"]},resources:t})}changeLanguage(e){return ar.changeLanguage(e)}t(e){if(!this.languages){let t=e;return!di(e)&&e.indexOf(".")>-1&&(t=e.split(".").pop()||""),t}const t=this.keyMap[e];return t?ar.t(t):ar.t(e)}setKeyMap(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const o=t?`${t}.${n}`:n;if(e[n]&&"object"==typeof e[n]&&!Array.isArray(e[n])&&null!==e[n])this.setKeyMap(e[n],o);else{let o=t?`${t}.${e[n]}`:e[n];o=this.replaceKey(o),this.keyMap[o]=`${t}.${n}`}}}replaceKey(e){return e.startsWith("Chat")?e.replace("Chat","TUIChat"):e.startsWith("Conversation")?e.replace("Conversation","TUIConversation"):e.startsWith("Message")?e.replace("Message","message.tip"):e}}class sr extends xi{constructor(){super(),this.serv="TUIConversationService"}static getInstance(){return sr.instance||(sr.instance=new sr),sr.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.CONVERSATION_LIST_UPDATED,this.onConversationListUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED,this.onTotalUnreadCountUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_RECEIVED,this.onMessageReceived.bind(this)),this.getConversationInitData()}onConversationListUpdated(e){const t=this.filterSystemConversation(e);this.getEngine().TUIStore.update(oi.CONV,"conversationList",t),this.updateCurrentConversation()}onTotalUnreadCountUpdated(e){this.getEngine().TUIStore.update(oi.CONV,"totalUnreadCount",e)}onMessageReceived(e){const t=this.getEngine(),n=this.getEngine().TUIStore.getData(oi.CONV,"conversationList");let o=!1;for(let a=0;a<e.length;a++){if(e[a].type!==t.TYPES.MSG_GRP_SYS_NOTICE)continue;const{operationType:i}=e[a].payload,s=`GROUP${e[a].to}`,r=4===i||5===i||8===i,c=2===i||6===i||7===i;if(r||c)for(let e=0;e<n.length;e++)if(n[e].type!==t.TYPES.CONV_C2C&&n[e].conversationID===s){if(r){this.getEngine().TUIStore.update(oi.CONV,"operationTypeMap",{conversationID:s,operationType:i}),o=!0;break}if(c&&n[e].operationType>0){this.getEngine().TUIStore.update(oi.CONV,"operationTypeMap",{conversationID:s,operationType:0}),o=!0;break}}}if(o){this.getEngine().TUIStore.update(oi.CONV,"conversationList",n);const e=this.getEngine().TUIStore.getData(oi.CONV,"currentConversationID")||"",t=this.findConversation(e);t&&this.getEngine().TUIStore.update(oi.CONV,"currentConversation",t)}}getConversationInitData(){const e=this.getEngine();e.chat.isReady()&&e.chat.getConversationList().then((t=>{const{conversationList:n,isSyncCompleted:o}=t.data;if(I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${this.serv}.init, getConversationList count:${n.length} isSyncCompleted:${o}`),n.length>0){this.onConversationListUpdated(n);const t=e.chat.getTotalUnreadMessageCount();this.onTotalUnreadCountUpdated(t)}}))}switchConversation(e){return ei(this,void 0,void 0,(function*(){const t=`${this.serv}.switchConversation`,n=this.getEngine();if(!e)return n.TUIStore.reset(oi.CHAT,["messageList","isCompleted","nextReqMessageID"]),n.TUIStore.update(oi.CONV,"currentConversationID",""),n.TUIStore.update(oi.CONV,"currentConversation",null),I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${t} conversationID is empty, conversationID:${e}`),Promise.resolve({});if(!e.startsWith(n.TYPES.CONV_C2C)&&!e.startsWith(n.TYPES.CONV_GROUP))return I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${t} conversationID is invalid, conversationID:${e}`),Promise.reject({code:ci.INVALID_CONV_ID,message:ui.INVALID_CONV_ID});const o=n.TUIStore.getData(oi.CONV,"currentConversationID");if(o&&o===e)return this.setMessageRead(o),I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${t} please check conversationID, conversationID:${e}`),Promise.resolve({code:ci.CONV_ID_SAME,message:ui.CONV_ID_SAME});const a=yield this.getConversationModel(e);return di(a)?(I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${t} target conversation is not exist, conversationID:${e}`),Promise.reject({code:ci.CONV_NOT_EXIST,message:ui.CONV_NOT_EXIST})):(o&&this.setMessageRead(o),e&&this.setMessageRead(e),n.TUIStore.reset(oi.CHAT,["messageList","isCompleted","nextReqMessageID"]),n.TUIStore.update(oi.CONV,"currentConversationID",e),n.TUIStore.update(oi.CONV,"currentConversation",a),Promise.resolve(a))}))}getConversationModel(e){return ei(this,void 0,void 0,(function*(){let t=this.findConversation(e);if(di(t))try{const n=yield this.getConversationProfile(e);n.data&&n.data.conversation&&(t=new Fi(n.data.conversation))}catch(n){t=void 0}return t}))}findConversation(e){let t;const n=this.getEngine().TUIStore.getData(oi.CONV,"conversationList");for(let o=0;o<n.length;o++)if(n[o].conversationID===e){t=n[o];break}return t}updateCurrentConversation(){const e=this.getEngine(),t=e.TUIStore.getData(oi.CONV,"currentConversationID"),n=this.findConversation(t);n&&e.TUIStore.update(oi.CONV,"currentConversation",n)}getConversationList(){return this.getEngine().chat.getConversationList()}getConversationProfile(e){return this.getEngine().chat.getConversationProfile(e)}deleteConversation(e){return this.getEngine().chat.deleteConversation(e).then((t=>{const n=this.getEngine().TUIStore.getData(oi.CONV,"currentConversationID");return I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${this.serv}.deleteConversation conversationID:${e} currentConversationID:${n}`),e===n&&(this.getEngine().TUIStore.update(oi.CONV,"currentConversationID",""),this.getEngine().TUIStore.update(oi.CONV,"currentConversation",null)),t}))}pinConversation(e){return this.getEngine().chat.pinConversation(e)}muteConversation(e){return this.getEngine().chat.setMessageRemindType(e)}clearHistoryMessage(e){return this.getEngine().chat.clearHistoryMessage(e).then((e=>(this.getEngine().TUIStore.update(oi.CHAT,"messageList",[]),this.getEngine().TUIStore.update(oi.CHAT,"nextReqMessageID",""),this.getEngine().TUIStore.update(oi.CHAT,"isCompleted",!0),e)))}setMessageRead(e){return this.getEngine().chat.setMessageRead({conversationID:e})}setConversationDraft(e){const{conversationID:t,draftInfo:n}=e;let o="";return n&&(o=JSON.stringify(n)),this.getEngine().chat.setConversationDraft({conversationID:t,draftText:o}).then((e=>{const{conversation:t}=e.data;this.updateConversation(t)}))}updateConversation(e){let t=!1;const n=this.getEngine().TUIStore.getData(oi.CONV,"conversationList");for(let o=0;o<n.length;o++)if(n[o].conversationID===e.conversationID){n[o]=e,t=!0;break}t&&this.getEngine().TUIStore.update(oi.CONV,"conversationList",n)}filterSystemConversation(e){return e.filter((e=>e.type!==this.getEngine().TYPES.CONV_SYSTEM))}}class rr{constructor(e){this.TUIUserService=e}getEngine(){return this.TUIUserService.getEngine()}init(){this.getEngine().eventCenter.addEvent(this.getEngine().EVENT.PROFILE_UPDATED,this.onProfileUpdated.bind(this)),this.getEngine().eventCenter.addEvent(this.getEngine().EVENT.BLACKLIST_UPDATED,this.onBlacklistUpdated.bind(this)),this.getUserProfileInitData()}onProfileUpdated(e){const t=this.getEngine(),n=t.TUIStore.getData(oi.USER,"userProfile");e.forEach((e=>{e.userID===n.userID&&t.TUIStore.update(oi.USER,"userProfile",e)}))}onBlacklistUpdated(e){const t=this.getEngine();this.getBlacklistProfile(e).then((e=>{t.TUIStore.update(oi.USER,"userBlacklist",e)}))}getUserProfileInitData(){const e=this.getEngine();e.chat.isReady()&&e.chat.getBlacklist().then((e=>{const t=e.data||[];I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`TUIUserProfileHandler.init, getBlacklist count:${t.length}`),t.length>0&&this.onBlacklistUpdated(t)}))}getBlacklistProfile(e){const t=[];let n=0;for(;n<e.length;)t.push(e.slice(n,n+=100));const o=[];t.forEach((e=>{o.push(this.TUIUserService.getUserProfile({userIDList:e}))}));const a=[];return Promise.all(o).then((e=>(e.forEach((e=>{const t=e.data.map((e=>{const{userID:t,nick:n,avatar:o}=e;return{userID:t,nick:n,avatar:o}}));a.push(...t)})),a)))}getUserProfile(e){const t=this.getEngine();return di(e)?t.chat.getMyProfile().then((e=>(t.TUIStore.update(oi.USER,"userProfile",e.data),e))).catch((e=>Promise.reject(e))):t.chat.getUserProfile(e)}updateMyProfile(e){return this.getEngine().chat.updateMyProfile(e)}addToBlacklist(e){return this.getEngine().chat.addToBlacklist(e)}removeFromBlacklist(e){return this.getEngine().chat.removeFromBlacklist(e)}}function cr(e,t,n=!0){var o,a;o=n?ur(e):e,a=t,ki?Si.setStorageSync(o,a):dr()&&localStorage.setItem(o,JSON.stringify(a))}function lr(e,t=!0){try{return function(e){if(ki)return Si.getStorageSync(e);if(dr()){const t=localStorage.getItem(e);if("undefined"!==t)return JSON.parse(t)}}(t?ur(e):e)}catch(n){return void I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","Storage.getStorageItem error:",n)}}function ur(e){return`chat_engine_${e}`}function dr(){return navigator&&navigator.cookieEnabled&&localStorage}class pr{constructor(e){this.TUIUserService=e}getEngine(){return this.TUIUserService.getEngine()}init(){const e=this.getEngine(),t=lr("displayOnlineStatus")||!1;e.TUIStore.update(oi.USER,"displayOnlineStatus",t),e.eventCenter.addEvent(e.EVENT.USER_STATUS_UPDATED,this.onUserStatusUpdated.bind(this)),this.onConversationListUpdated()}onConversationListUpdated(){const e=this.getEngine();e.TUIStore.watch(oi.CONV,{conversationList:()=>{const t=e.TUIStore.getData(oi.APP,"enabledOnlineStatus"),n=e.TUIStore.getData(oi.USER,"displayOnlineStatus");t&&n&&this.startToSubscribe()}})}onUserStatusUpdated(e){this.getEngine().TUIStore.update(oi.USER,"userStatusList",e)}switchUserStatus(e){const t=this.getEngine(),{displayOnlineStatus:n=!1}=e;t.TUIStore.update(oi.USER,"displayOnlineStatus",n),cr("displayOnlineStatus",n);const o=t.TUIStore.getData(oi.APP,"enabledOnlineStatus");o?!0===n?this.startToSubscribe():this.unsubscribeUserStatus():I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`UserStatusHandler.switchUserStatus enabledOnlineStatus:${o} displayOnlineStatus:${n}`)}getUserStatus(e){const t=this.getEngine();return t.chat.getUserStatus(e).then((e=>{const{successUserList:n}=e.data;return n.length>0&&t.TUIStore.update(oi.USER,"userStatusList",n),e})).catch((e=>Promise.reject(e)))}subscribeUserStatus(e){var t;const n=(null===(t=null==e?void 0:e.userIDList)||void 0===t?void 0:t.length)||0;return 0===n?(I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`UserStatusHandler.subscribeUserStatus userID count:${n}`),Promise.resolve()):this.getEngine().chat.subscribeUserStatus(e)}unsubscribeUserStatus(e){const t=this.getEngine(),{userIDList:n=[]}=e||{};return t.chat.unsubscribeUserStatus({userIDList:n}).then((e=>{const{failureUserList:o}=e.data,a=[];return n.forEach((e=>{o.includes(e)||a.push({userID:e,statusType:ai.UNSUB_USER})})),t.TUIStore.update(oi.USER,"userStatusList",a),e})).catch((e=>Promise.reject(e)))}startToSubscribe(){const e=this.getEngine(),t=e.TUIStore.getData(oi.CONV,"conversationList"),n=e.TUIStore.getData(oi.USER,"userStatusList"),o=[];t.forEach((t=>{if(t.type===e.TYPES.CONV_C2C){const a=t.conversationID.replace(e.TYPES.CONV_C2C,"");n.has(a)||o.push(a)}})),0!==o.length&&e.chat.isReady()&&(this.subscribeUserStatus({userIDList:o}),this.getUserStatus({userIDList:o}))}}class hr extends xi{constructor(){super(),this.userProfileHandler=new rr(this),this.userStatusHandler=new pr(this)}static getInstance(){return hr.instance||(hr.instance=new hr),hr.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.KICKED_OUT,this.onKickedOut.bind(this)),e.eventCenter.addEvent(e.EVENT.NET_STATE_CHANGE,this.onNetStateChange.bind(this)),this.userProfileHandler.init(),this.userStatusHandler.init(),this.initMessageReadReceipt()}onKickedOut(e){this.getEngine().TUIStore.update(oi.USER,"kickedOut",e.type)}onNetStateChange(e){this.getEngine().TUIStore.update(oi.USER,"netStateChange",e.state)}initMessageReadReceipt(){const e=lr("displayMessageReadReceipt")||!0;this.getEngine().TUIStore.update(oi.USER,"displayMessageReadReceipt",e)}switchUserStatus(e){return this.userStatusHandler.switchUserStatus(e)}switchMessageReadStatus(e){this.getEngine().TUIStore.update(oi.USER,"displayMessageReadReceipt",e),cr("displayMessageReadReceipt",e)}getUserProfile(e){return this.userProfileHandler.getUserProfile(e)}updateMyProfile(e){return this.userProfileHandler.updateMyProfile(e)}addToBlacklist(e){return this.userProfileHandler.addToBlacklist(e)}removeFromBlacklist(e){return this.userProfileHandler.removeFromBlacklist(e)}getUserStatus(e){return this.userStatusHandler.getUserStatus(e)}subscribeUserStatus(e){return this.userStatusHandler.subscribeUserStatus(e)}unsubscribeUserStatus(e){return this.userStatusHandler.unsubscribeUserStatus(e)}}class gr{constructor(e){this.TUIChatService=e,this.userShowNameMap=new Map,this.requestedUserMap=new Map}getEngine(){return this.TUIChatService.getEngine()}t(e){return this.getEngine().TUITranslate.t(e)}handleTextMessage(e){return{text:this.decodeText(e.payload)}}handleFaceMessage(e){const t={name:"",url:"",type:""};return e.payload.data.indexOf("@custom")>-1?(t.name=e.payload.data,t.type="custom",t):(t.name=e.payload.data.indexOf("@2x")<0?`${e.payload.data}@2x`:e.payload.data,t.url=`https://web.sdk.qcloud.com/im/assets/face-elem/${t.name}.png`,t)}handleLocationMessage(e){const t={lon:"",lat:"",href:"",url:"",description:""};return t.lon=e.payload.longitude.toFixed(6),t.lat=e.payload.latitude.toFixed(6),t.href=`https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&pointx=${t.lon}&pointy=${t.lat}&name=${e.payload.description}`,t.url=`https://apis.map.qq.com/ws/staticmap/v2/?center=${t.lat},${t.lon}&zoom=10&size=300*150&maptype=roadmap&markers=size:large|color:0xFFCCFF|label:k|${t.lat},${t.lon}&key=UBNBZ-PTP3P-TE7DB-LHRTI-Y4YLE-VWBBD`,t.description=e.payload.description,t}handleImageMessage(e){return{url:e.payload.imageInfoArray[0].url,width:e.payload.imageInfoArray[0].width,height:e.payload.imageInfoArray[0].height}}handleAudioMessage(e){return{url:e.payload.url,second:e.payload.second}}handleVideoMessage(e){return{url:e.payload.videoUrl,snapshotUrl:e.payload.snapshotUrl,snapshotWidth:e.payload.snapshotWidth,snapshotHeight:e.payload.snapshotHeight}}handleFileMessage(e){return{url:e.payload.fileUrl,name:e.payload.fileName,size:mi(e.payload.fileSize)}}handleCustomMessage(e){var t;const n=this.handleCreateGroupCustomMessage(e);return{custom:this.handleCallKitSignaling(e)||n||(null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.extension)||`${this.t("TUIChat.[自定义消息]")}`,businessID:n?"group_create":""}}handleMergeMessage(e){return Object.assign({},e.payload)}handleGroupTipsMessage(e){var t,n,o,a,i,s;const r=this.getEngine(),c={text:""};let l=(null==e?void 0:e.nick)||(null===(n=null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.userIDList)||void 0===n?void 0:n.join(","));switch((null===(a=null===(o=null==e?void 0:e.payload)||void 0===o?void 0:o.memberList)||void 0===a?void 0:a.length)>0&&(l="",null===(s=null===(i=null==e?void 0:e.payload)||void 0===i?void 0:i.memberList)||void 0===s||s.map((e=>{const t=(null==e?void 0:e.nick)||(null==e?void 0:e.userID);l+=`${this.substringByLength(t)},`})),l=null==l?void 0:l.slice(0,-1)),e.payload.operationType){case r.TYPES.GRP_TIP_MBR_JOIN:c.text=`${l} ${this.t("message.tip.加入群组")}`;break;case r.TYPES.GRP_TIP_MBR_QUIT:c.text=`${this.t("message.tip.群成员")}：${l} ${this.t("message.tip.退出群组")}`;break;case r.TYPES.GRP_TIP_MBR_KICKED_OUT:c.text=`${this.t("message.tip.群成员")}：${l} ${this.t("message.tip.被")}${this.t("message.tip.踢出群组")}`;break;case r.TYPES.GRP_TIP_MBR_SET_ADMIN:c.text=`${this.t("message.tip.群成员")}：${l} ${this.t("message.tip.成为管理员")}`;break;case r.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:c.text=`${this.t("message.tip.群成员")}：${l} ${this.t("message.tip.被撤销管理员")}`;break;case r.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:c.text=this.handleGroupProfileUpdated(e);break;case r.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:for(const t of e.payload.memberList)t.muteTime>0?c.text=`${this.t("message.tip.群成员")}：${l} ${this.t("message.tip.被禁言")}`:c.text=`${this.t("message.tip.群成员")}：${l} ${this.t("message.tip.被取消禁言")}`;break;default:c.text=`[${this.t("message.tip.群提示消息")}]`}return c}handleGroupSystemMessage(e){const t=e.payload.groupProfile.name||e.payload.groupProfile.groupID,n={text:""};switch(e.payload.operationType){case 1:n.text=`${e.payload.operatorID} ${this.t("message.tip.申请加入群组")}：${t}`;break;case 2:n.text=`${this.t("message.tip.成功加入群组")}：${t}`;break;case 3:n.text=`${this.t("message.tip.申请加入群组")}：${t} ${this.t("message.tip.被拒绝")}`;break;case 4:n.text=`${this.t("message.tip.你被管理员")}${e.payload.operatorID} ${this.t("message.tip.踢出群组")}：${t}`;break;case 5:n.text=`${this.t("message.tip.群")}：${t} ${this.t("message.tip.被")} ${e.payload.operatorID} ${this.t("message.tip.解散")}`;break;case 6:n.text=`${e.payload.operatorID} ${this.t("message.tip.创建群")}：${t}`;break;case 7:case 12:n.text=`${e.payload.operatorID} ${this.t("message.tip.邀请你加群")}：${t}`;break;case 8:n.text=`${this.t("message.tip.你退出群组")}：${t}`;break;case 9:n.text=`${this.t("message.tip.你被")}${e.payload.operatorID} ${this.t("message.tip.设置为群")}：${t} ${this.t("message.tip.的管理员")}`;break;case 10:n.text=`${this.t("message.tip.你被")}${e.payload.operatorID} ${this.t("message.tip.撤销群")}：${t} ${this.t("message.tip.的管理员身份")}`;break;case 13:n.text=`${e.payload.operatorID} ${this.t("message.tip.同意加群")}：${t}`;break;case 14:n.text=`${e.payload.operatorID} ${this.t("message.tip.拒接加群")}：${t}`;break;case 255:n.text=`${this.t("message.tip.自定义群系统通知")}: ${e.payload.userDefinedField}`;break;default:n.text="未解析的群系统通知"}return n}handleCallKitSignaling(e){var t,n,o,a,i,s,r,c,l,u;const d=gi(e.payload.data);if(1!==(null==d?void 0:d.businessID))return"";const p=gi(null==d?void 0:d.data),h=e.fromAccount||e.from,g=this.getEngine().TUIFriend.getFriendRemark([h]),m=this.getEngine().getMyUserID();let f=g[h]||e.nameCard||e.nick||h;switch(f=this.substringByLength(f),null==d?void 0:d.actionType){case 1:return"audioCall"!==(null===(t=null==p?void 0:p.data)||void 0===t?void 0:t.cmd)&&"videoCall"!==(null===(n=null==p?void 0:p.data)||void 0===n?void 0:n.cmd)||!(null==d?void 0:d.groupID)?"hangup"===(null===(o=null==p?void 0:p.data)||void 0===o?void 0:o.cmd)?(null==d?void 0:d.groupID)?`${this.t("message.custom.通话结束")}`:`${this.t("message.custom.通话时长")}：${function(e){const t=e;let n,o,a,i="";return t>=3600?(n=parseInt(""+t/3600,10)<10?`0${parseInt(""+t/3600,10)}`:parseInt(""+t/3600,10),o=parseInt(""+t%60/60,10)<10?`0${parseInt(""+t%60/60,10)}`:parseInt(""+t%60/60,10),a=t%3600<10?"0"+t%3600:t%3600,a>60&&(o=parseInt(""+a/60,10)<10?`0${parseInt(""+a/60,10)}`:parseInt(""+a/60,10),a=a%60<10?"0"+a%60:a%60),i=`${n}:${o}:${a}`):t>=60&&t<3600?(o=parseInt(""+t/60,10)<10?`0${parseInt(""+t/60,10)}`:parseInt(""+t/60,10),a=t%60<10?"0"+t%60:t%60,i=`00:${o}:${a}`):t<60&&(a=t<10?`0${t}`:t,i=`00:00:${a}`),i}(null==p?void 0:p.call_end)}`:"switchToAudio"===(null===(a=null==p?void 0:p.data)||void 0===a?void 0:a.cmd)?`${this.t("message.custom.切换语音通话")}`:"switchToVideo"===(null===(i=null==p?void 0:p.data)||void 0===i?void 0:i.cmd)?`${this.t("message.custom.切换视频通话")}`:`${this.t("message.custom.发起通话")}`:`${f} ${this.t("message.custom.发起通话")}`;case 2:return(null==d?void 0:d.groupID)?`${f} ${this.t("message.custom.取消通话")}`:this.isOldUIKit("message.custom.已取消")?this.t("message.custom.取消通话"):(null==d?void 0:d.inviter)===m?this.t("message.custom.已取消"):this.t("message.custom.对方已取消");case 3:return"switchToAudio"===(null===(s=null==p?void 0:p.data)||void 0===s?void 0:s.cmd)?`${this.t("message.custom.切换语音通话")}`:"switchToVideo"===(null===(r=null==p?void 0:p.data)||void 0===r?void 0:r.cmd)?`${this.t("message.custom.切换视频通话")}`:(null==d?void 0:d.groupID)?`${f} ${this.t("message.custom.已接听")}`:this.t("message.custom.已接听");case 4:return(null==d?void 0:d.groupID)?`${f} ${this.t("message.custom.拒绝通话")}`:this.isOldUIKit("message.custom.已拒绝")?this.t("message.custom.拒绝通话"):"line_busy"===(null==p?void 0:p.line_busy)||"lineBusy"===(null==p?void 0:p.data.message)?(null==d?void 0:d.inviter)===m?this.t("message.custom.对方忙线中"):this.t("message.custom.忙线未接听"):(null==d?void 0:d.inviter)===m?this.t("message.custom.对方已拒绝"):this.t("message.custom.已拒绝");case 5:if("switchToAudio"===(null===(c=null==p?void 0:p.data)||void 0===c?void 0:c.cmd))return`${this.t("message.custom.切换语音通话")}`;if("switchToVideo"===(null===(l=null==p?void 0:p.data)||void 0===l?void 0:l.cmd))return`${this.t("message.custom.切换视频通话")}`;if(null==d?void 0:d.groupID){if(h===(null==d?void 0:d.inviter)){this.handleCallkitTimeoutSignaling(d.inviteeList);let e="";return null===(u=d.inviteeList)||void 0===u||u.forEach((t=>{const n=this.userShowNameMap.get(t)||t;e+=`${this.substringByLength(n)}、`})),e=e.substring(0,e.lastIndexOf("、")),`${e} ${this.t("message.custom.无应答")}`}return`${f} ${this.t("message.custom.无应答")}`}return this.isOldUIKit("message.custom.对方无应答")?this.t("message.custom.无应答"):(null==d?void 0:d.inviter)===m?this.t("message.custom.对方无应答"):this.t("message.custom.超时无应答");default:return""}}handleCreateGroupCustomMessage(e){let t;const n=gi(e.payload.data);return"group_create"===(null==n?void 0:n.businessID)&&(t=`${n.opUser} ${n.content}`),t}decodeText(e){const t=[];let n=e.text,o=-1,a=-1;for(;""!==n;)switch(o=n.indexOf("["),a=n.indexOf("]"),o){case 0:if(-1===a)t.push({name:"text",text:n}),n="";else{const e=n.slice(0,a+1);e.indexOf("@custom")>-1?(t.push({name:"img",src:"",type:"custom",emojiKey:e}),n=n.substring(a+1)):fi[e]?(t.push({name:"img",src:"https://web.sdk.qcloud.com/im/assets/emoji-plugin/"+fi[e],emojiKey:e}),n=n.substring(a+1)):(t.push({name:"text",text:"["}),n=n.slice(1))}break;case-1:t.push({name:"text",text:n}),n="";break;default:t.push({name:"text",text:n.slice(0,o)}),n=n.substring(o)}return t}handleGroupProfileUpdated(e){const{nick:t,payload:n}=e,{newGroupProfile:o,memberList:a,operatorID:i}=n;let s="";const r=t||i,c=Object.keys(o)[0];switch(c){case"muteAllMembers":s=o[c]?`${this.t("message.tip.管理员")} ${r} ${this.t("message.tip.开启全员禁言")}`:`${this.t("message.tip.管理员")} ${r} ${this.t("message.tip.取消全员禁言")}`;break;case"ownerID":s=`${a[0].nick||a[0].userID} ${this.t("message.tip.成为新的群主")}`;break;case"groupName":s=`${r} ${this.t("message.tip.修改群名为")} ${o[c]}`;break;case"notification":s=this.isOldUIKit("message.tip.把群公告修改为")?`${r} ${this.t("message.tip.发布新公告")}`:`${r} ${this.t("message.tip.把群公告修改为")} "${o[c]}"`}return s}handleCallkitTimeoutSignaling(e=[]){if(0===e.length)return;const t=this.getEngine().TUIFriend.getFriendRemark(e),n=[];e.forEach((e=>{const o=t[e];o?this.userShowNameMap.set(e,o):this.requestedUserMap.has(e)||(n.push(e),this.requestedUserMap.set(e,1))})),n.length>0&&this.getEngine().TUIUser.getUserProfile({userIDList:n}).then((e=>{(e.data||[]).forEach((e=>{const{userID:t,nick:n}=e,o=n||t;this.userShowNameMap.set(t,o)}))})).catch((e=>{}))}substringByLength(e,t=12){return e.length>t?`${e.slice(0,t)}...`:e}isOldUIKit(e){var t;const n=e.lastIndexOf("."),o=e.slice(0,n+1);return null===(t=this.t(e))||void 0===t?void 0:t.startsWith(o)}}class mr{constructor(e){this.TUIChatService=e,this.typingTo="",this.timer=null}getEngine(){return this.TUIChatService.getEngine()}clearTypingStatus(){this.getEngine().TUIStore.getData(oi.CHAT,"typingStatus")&&this.getEngine().TUIStore.update(oi.CHAT,"typingStatus",!1),this.timer&&clearTimeout(this.timer),this.timer=null}handleLastMessage(e){const t=this.getEngine(),n=t.TUIStore.getData(oi.CHAT,"typingStatus");if(e.type===this.getEngine().TYPES.MSG_CUSTOM&&"in"===e.flow){const o=gi(e.payload.data);if(o.businessID===ii.BUSINESS_ID){const{typingStatus:e,userAction:a}=o;if(e===ii.STATUS_START||a===ii.ACTION_START_ID)return n?(this.timer&&clearTimeout(this.timer),this.timer=null):t.TUIStore.update(oi.CHAT,"typingStatus",!0),this.timer=setTimeout((()=>{this.clearTypingStatus()}),3e4),t.TUIStore.getData(oi.CHAT,"typingStatus");e!==ii.STATUS_END&&a!==ii.ACTION_END_ID||this.clearTypingStatus()}}}filterTypingMessage(e=[]){return 0===e.length?[]:(this.getEngine().TUIStore.getData(oi.APP,"enableTyping")&&this.handleLastMessage(e[e.length-1]),e.filter((e=>e.type!==this.getEngine().TYPES.MSG_CUSTOM||gi(e.payload.data).businessID!==ii.BUSINESS_ID)))}createTypingMessage(e=ii.STATUS_END,t=""){const{BUSINESS_ID:n,STATUS_START:o,VERSION:a,ACTION_START_ID:i,ACTION_END_ID:s,ACTION_START:r,ACTION_END:c,NEED_TYPING:l}=ii;return{to:t,conversationType:this.getEngine().TYPES.CONV_C2C,payload:{data:JSON.stringify({businessID:n,typingStatus:e,version:a,userAction:e===o?i:s,actionParam:e===o?r:c}),description:"",extension:""},cloudCustomData:JSON.stringify({messageFeature:{needTyping:l,version:a}})}}sendTyping(e=!1,t=""){if(e){this.typingTo=t;const e=this.createTypingMessage(ii.STATUS_START,t);this.getEngine().TUIChat.sendCustomMessage(e,{onlineUserOnly:!0})}else this.sendTypingEnd()}sendTypingEnd(){if(this.typingTo){const e=this.createTypingMessage(ii.STATUS_END,this.typingTo);this.getEngine().TUIChat.sendCustomMessage(e,{onlineUserOnly:!0})}this.typingTo=""}}class fr{constructor(e){this.TUIChatService=e}getEngine(){return this.TUIChatService.getEngine()}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,this.onMessageReadReceiptReceived.bind(this))}onMessageReadReceiptReceived(e){const t=this.getEngine(),n=t.TUIStore.getData(oi.CONV,"currentConversationID"),o=[];e.forEach((e=>{const{messageID:a}=e,i=t.chat.findMessage(a);i&&n===i.conversationID&&o.push(i)})),o.length>0&&t.TUIChat.updateMessageList(o,"edit")}sendMessageReadReceipt(e){const t=[];return e.forEach((e=>{const n=e.getMessage();t.push(n)})),this.getEngine().chat.sendMessageReadReceipt(t)}getGroupMessageReadMemberList(e){const t=e.message.getMessage(),n=Object.assign(Object.assign({},e),{message:t});return this.getEngine().chat.getGroupMessageReadMemberList(n)}getMessageReadReceiptList(e){const t=this.getEngine(),n=t.TUIStore.getData(oi.APP,"enabledMessageReadReceipt"),o=t.TUIStore.getData(oi.USER,"displayMessageReadReceipt");!n||!o||0===e.length||e[0].conversationType!==t.TYPES.CONV_GROUP||t.chat.getMessageReadReceiptList(e).then((e=>{const{messageList:t}=e.data;this.TUIChatService.updateMessageList(t,"edit")})).catch((e=>{I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`ReadReceiptHandler.getMessageReadReceiptList error:${e.message}`)}))}}class vr extends xi{constructor(){super(),this.serv="TUIChatService",this.messageHandler=new gr(this),this.typingHandler=new mr(this),this.readReceiptHandler=new fr(this),this.isSwitching=!0,this.delayGetHoppingFunction=void 0,this.hoppingConfigMap=new Map}static getInstance(){return vr.instance||(vr.instance=new vr),vr.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.MESSAGE_RECEIVED,this.onMessageReceived.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_MODIFIED,this.onMessageModified.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_REVOKED,this.onMessageRevoked.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_READ_BY_PEER,this.onMessageReadByPeer.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_REACTIONS_UPDATED,this.onMessageReactionsUpdated.bind(this)),this.onCurrentConversationIDUpdated(),this.onMessageSource(),this.readReceiptHandler.init()}onMessageReceived(e){this.updateMessageList(e,"push"),this.getEngine().TUIStore.update(oi.CHAT,"newMessageList",e)}onMessageModified(e){this.updateMessageList(e,"edit")}onMessageRevoked(e){this.updateMessageList(e,"edit")}onMessageReadByPeer(e){this.updateMessageList(e,"edit")}onMessageReactionsUpdated(e){this.updateMessageReactionList([e])}onCurrentConversationIDUpdated(){const e=this.getEngine();e.TUIStore.watch(oi.CONV,{currentConversationID:t=>{this.isSwitching=!0,this.delayGetHoppingFunction=void 0,this.hoppingConfigMap.clear(),e.TUIStore.reset(oi.CHAT),this.typingHandler.clearTypingStatus(),this.typingHandler.sendTypingEnd(),Bi(t)||this.getMessageList().finally((()=>{this.isSwitching=!1,this.delayGetHoppingFunction&&this.delayGetHoppingFunction()}))}})}onMessageSource(){const e=this.getEngine();e.TUIStore.watch(oi.CHAT,{messageSource:t=>{const n=this.getStoreData(oi.CONV,"currentConversationID");if(!n||t&&t.conversationID!==n)return;if(di(t))return this.hoppingConfigMap.clear(),e.TUIStore.update(oi.CHAT,"messageList",[]),e.TUIStore.update(oi.CHAT,"nextReqMessageID",""),e.TUIStore.update(oi.CHAT,"isCompleted",!1),void this.getMessageList();const o=this.getStoreData(oi.CHAT,"messageList");o&&o.find((e=>t&&e.ID===t.ID))||(this.isSwitching?this.delayGetHoppingFunction=this.getMessageListHoppingForDown:this.getMessageListHoppingForDown())}})}getMessageListHoppingForDown(){const e=this.getStoreData(oi.CHAT,"messageList"),{conversationID:t,sequence:n,time:o,ID:a}=this.getStoreData(oi.CHAT,"messageSource");if(e&&e.find((e=>a&&e.ID===a)))return;const i=this.getEngine();i.TUIStore.update(oi.CHAT,"messageList",[]),i.TUIStore.update(oi.CHAT,"nextReqMessageID",""),i.TUIStore.update(oi.CHAT,"isCompleted",!1),this.getMessageListHopping({conversationID:t,sequence:n,time:o,direction:1})}getStoreData(e,t){return this.getEngine().TUIStore.getData(e,t)}sendMessage(e,t){this.updateMessageList([e],"send");const n=this.getEngine().chat.sendMessage(e,t);return this.getResponse(n)}getResponse(e,t=!0,n=!0){return e.then((e=>{const n=e.data.messageList?e.data.messageList:[e.data.message];return t&&this.updateMessageList(n,"edit"),e})).catch((e=>{var t;return n&&(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.message)&&this.updateMessageList([e.data.message],"edit"),Promise.reject(e)}))}updateMessageList(e,t=""){if(this.getStoreData(oi.CHAT,"messageSource")&&"unshift"!==t&&"edit"!==t)return;const n=this.getStoreData(oi.CHAT,"messageList"),o=this.updateTargetMessageList(e,n,t);this.getEngine().TUIStore.update(oi.CHAT,"messageList",o)}updateTargetMessageList(e,t,n=""){const o=this.getStoreData(oi.CONV,"currentConversationID");let a=e.filter((e=>e.conversationID===o));if(a=this.handleC2CCallSignaling(a),!n||0===a.length)return t;const i=t||[];let s=[];if("send"===n||"push"===n){const e=this.getStoreData(oi.CHAT,"userInfo");Object.keys(e).length>0&&this.updateLocalMessage(a,e)}switch(n){case"edit":for(const e of t){const t=a.find((t=>t.ID===e.ID));s.push(t||e)}break;case"resend":s=i.filter((e=>e.ID!==a[0].ID)).concat(a);break;case"send":s=i.concat(this.typingHandler.filterTypingMessage(a));break;case"push":s=i.concat(this.typingHandler.filterTypingMessage(a)),this.getEngine().chat.setMessageRead({conversationID:o});break;case"unshift":s=a.filter((e=>0===i.length||!i.find((t=>t.ID===e.ID)))),s.push(...i)}return s}enterTypingState(){this.getStoreData(oi.APP,"enableTyping")&&this.sendTyping(!0)}leaveTypingState(){this.getStoreData(oi.APP,"enableTyping")&&this.sendTyping(!1)}sendTyping(e){const t=this.getEngine(),n=this.getStoreData(oi.CONV,"currentConversationID");if(!n.startsWith(t.TYPES.CONV_C2C))return;const o=n.replace(t.TYPES.CONV_C2C,"");if(e){const e=this.getStoreData(oi.CHAT,"messageList").filter((e=>"in"===e.flow));if(0===e.length)return;const t=1e3*e[e.length-1].time;if((new Date).getTime()-t>3e4)return}this.typingHandler.sendTyping(e,o)}quoteMessage(e){return this.getEngine().TUIStore.update(oi.CHAT,"quoteMessage",{message:e,type:"quote"}),e}replyMessage(e){return this.getEngine().TUIStore.update(oi.CHAT,"quoteMessage",{message:e,type:"reply"}),e}getCurrentConvInfo(){const{conversationID:e="",type:t}=this.getStoreData(oi.CONV,"currentConversation")||{};return{to:e.replace(t,""),conversationType:t}}t(e){return this.getEngine().TUITranslate.t(e)||e}getMessageAbstractAndType(e){var t,n;const o=this.getEngine(),a={abstract:"",type:0};switch(e.type){case o.TYPES.MSG_TEXT:a.abstract=null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.text,a.type=1;break;case o.TYPES.MSG_CUSTOM:a.abstract="[自定义消息]",a.type=2;break;case o.TYPES.MSG_IMAGE:a.abstract="[图片]",a.type=3;break;case o.TYPES.MSG_AUDIO:a.abstract="[语音]",a.type=4;break;case o.TYPES.MSG_VIDEO:a.abstract="[视频]",a.type=5;break;case o.TYPES.MSG_FILE:a.abstract="[文件]",a.type=6;break;case o.TYPES.MSG_LOCATION:a.type=7;break;case o.TYPES.MSG_FACE:a.abstract="[表情]",a.type=8;break;case o.TYPES.MSG_GRP_TIP:a.type=9;break;case o.TYPES.MSG_MERGER:a.abstract=null===(n=null==e?void 0:e.payload)||void 0===n?void 0:n.title,a.type=10}return a}genMessageReply(e,t){if("reply"!==t&&"quote"!==t)return{};const{abstract:n,type:o}=this.getMessageAbstractAndType(e),a={messageAbstract:n,messageSender:e.nick||e.from,messageID:e.ID},i=Object.assign(Object.assign({},a),{messageType:o,messageTime:null==e?void 0:e.time,messageSequence:null==e?void 0:e.sequence,version:1});if("reply"===t&&(i.messageRootID=e.ID,e.cloudCustomData)){const t=gi(e.cloudCustomData);t.messageReply&&t.messageReply.messageRootID&&(i.messageRootID=t.messageReply.messageRootID)}return{messageReply:i,messageReplyRoot:a}}getMessageInfo(e,t,n){const{messageReply:o,messageReplyRoot:a}=this.genMessageReply(t,n),i=e.cloudCustomData?gi(e.cloudCustomData):{};let s;if(i.messageReply?i.messageReply=Object.assign(Object.assign({},o),i.messageReply):i.messageReply=o,"reply"===n){const{messageRootID:e}=o;s=this.getEngine().chat.findMessage(e);const t=(null==s?void 0:s.cloudCustomData)?gi(s.cloudCustomData):{};t.messageReplies||(t.messageReplies={}),r=t.messageReplies.replies,("function"==typeof Array.isArray?Array.isArray(r):"array"===Object.prototype.toString.call(r).match(/^\[object (.*)\]$/)[1].toLowerCase())||(t.messageReplies.replies=[]),t.messageReplies.replies.push(a),s.cloudCustomData=JSON.stringify(t)}var r;return{cloudCustomData:JSON.stringify(i),rootMessage:s}}sendTextMessage(e,t){const n=this.getEngine(),{message:o,type:a}=this.getStoreData(oi.CHAT,"quoteMessage");let i={cloudCustomData:e.cloudCustomData||"",rootMessage:void 0};o&&(i=this.getMessageInfo(e,o,a));const s=n.chat.createTextMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{cloudCustomData:i.cloudCustomData}));return this.sendMessage(s,t).then((e=>(i.rootMessage&&this.modifyMessage(i.rootMessage),n.TUIStore.reset(oi.CHAT,["quoteMessage"],!0),e)))}sendTextAtMessage(e,t){const n=this.getEngine(),{message:o,type:a}=this.getStoreData(oi.CHAT,"quoteMessage");let i={cloudCustomData:e.cloudCustomData||"",rootMessage:void 0};o&&(i=this.getMessageInfo(e,o,a));const s=n.chat.createTextAtMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{cloudCustomData:i.cloudCustomData}));return this.sendMessage(s,t).then((e=>(i.rootMessage&&this.modifyMessage(i.rootMessage),n.TUIStore.reset(oi.CHAT,["quoteMessage"],!0),e)))}sendImageMessage(e,t){const n=this.getEngine().chat.createImageMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{onProgress:e=>{this.onProgress(n.ID,e)}}));return this.sendMessage(n,t)}sendAudioMessage(e,t){const n=this.getEngine().chat.createAudioMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{onProgress:e=>{this.onProgress(n.ID,e)}}));return this.sendMessage(n,t)}sendVideoMessage(e,t){const n=this.getEngine().chat.createVideoMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{onProgress:e=>{this.onProgress(n.ID,e)}}));return this.sendMessage(n,t)}sendCustomMessage(e,t){const n=this.getEngine().chat.createCustomMessage(Object.assign(Object.assign({},this.getCurrentConvInfo()),e));return this.sendMessage(n,t)}sendFaceMessage(e,t){const n=this.getEngine().chat.createFaceMessage(Object.assign(Object.assign({},this.getCurrentConvInfo()),e));return this.sendMessage(n,t)}sendFileMessage(e,t){const n=this.getEngine().chat.createFileMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{onProgress:e=>{this.onProgress(n.ID,e)}}));return this.sendMessage(n,t)}sendLocationMessage(e,t){const n=this.getEngine().chat.createLocationMessage(Object.assign(Object.assign({},this.getCurrentConvInfo()),e));return this.sendMessage(n,t)}onProgress(e,t){const n=this.getEngine().TUIStore.getMessageModel(e);n&&(t-n.progress>=.1||1===t)&&(n.progress=t,this.updateMessageList([n],"edit"))}setAbstractList(e){const t=this.getEngine(),n=e.nick||e.from;let o="";switch(e.type){case t.TYPES.MSG_TEXT:o=e.payload.text||"",o.length>20&&(o=o.slice(0,20));break;case t.TYPES.MSG_MERGER:o=`${this.t("TUIChat.[聊天记录]")}`;break;case t.TYPES.MSG_IMAGE:o=`${this.t("TUIChat.[图片]")}`;break;case t.TYPES.MSG_AUDIO:o=`${this.t("TUIChat.[音频]")}`;break;case t.TYPES.MSG_VIDEO:o=`${this.t("TUIChat.[视频]")}`;break;case t.TYPES.MSG_CUSTOM:o=`${this.t("TUIChat.[自定义消息]")}`;break;case t.TYPES.MSG_FILE:o=`${this.t("TUIChat.[文件]")}`;break;case t.TYPES.MSG_FACE:o=`${this.t("TUIChat.[动画表情]")}`}return`${n}: ${o}`}genMergerForwardPayload(e,t){const{abstractList:n=[],compatibleText:o="",title:a}=t;return 0===n.length&&e.forEach((e=>{n.push(this.setAbstractList(e))})),{messageList:e,title:a,abstractList:n,compatibleText:o||this.t("TUIChat.请升级IMSDK到v2.10.1或更高版本查看此消息")}}genSendMergerForwardMessage(e){const{conversationList:t,messageList:n,params:o,mergeInfo:a,sendMessageOptions:i}=e,s=[];for(let r=0;r<t.length;r++){const{conversationID:e,type:c}=t[r],l=Object.assign({to:e.replace(`${c}`,""),conversationType:c,payload:this.genMergerForwardPayload(n,a)},o),u=this.getEngine().chat.createMergerMessage(l);s.push(this.sendMessage(u,i))}return s}genTitle(e,t){const{nick:n,from:o,to:a}=e;return`${n||o} ${this.t("TUIChat.和")} ${t||a} ${this.t("TUIChat.的聊天记录")}`}genMergeInfo(e){var t;return ei(this,void 0,void 0,(function*(){const{messageList:n,mergeInfo:o}=e;if(o.title)return o;if(n[0].conversationType===this.getEngine().TYPES.CONV_GROUP)return o.title=this.t("TUIChat.群聊的聊天记录"),o;try{const{data:e=[]}=yield this.getEngine().TUIUser.getUserProfile({userIDList:[n[0].to]});o.title=this.genTitle(n[0],null===(t=e[0])||void 0===t?void 0:t.nick)}catch(a){o.title=this.genTitle(n[0])}return o}))}sendMergerForwardMessage(e){return ei(this,void 0,void 0,(function*(){return e.mergeInfo=yield this.genMergeInfo(e),Promise.all(this.genSendMergerForwardMessage(e))}))}getOriginMessageList(e){return e.map((e=>e instanceof ji?e.getMessage():e))}sendForwardMessage(e,t,n){t=this.getOriginMessageList(t);const o=n||{},{needMerge:a=!1,params:i={},mergeInfo:s={}}=o,r=Qa(o,["needMerge","params","mergeInfo"]);if(a)return this.sendMergerForwardMessage({conversationList:e,messageList:t,params:i,mergeInfo:s,sendMessageOptions:r});const c=[];for(let l=0;l<e.length;l++){const{conversationID:n,type:o}=e[l],a=Object.assign({to:n.replace(`${o}`,""),conversationType:o},i),s=r[n]||r;for(let e=0;e<t.length;e++){Reflect.set(a,"payload",t[e]);const n=this.getEngine().chat.createForwardMessage(a);c.push(this.sendMessage(n,s))}}return Promise.all(c)}revokeMessage(e){const t=this.getEngine().chat.revokeMessage(e);return this.getResponse(t,!0,!1)}resendMessage(e){e.status="unSend",this.updateMessageList([e],"resend");const t=this.getEngine().chat.resendMessage(e);return this.getResponse(t,!0,!0)}deleteMessage(e){const t=this.getEngine().chat.deleteMessage(e);return this.getResponse(t,!0,!1)}setMessageExtensions(e,t){return this.getEngine().chat.setMessageExtensions(e,t)}getMessageExtensions(e){return this.getEngine().chat.getMessageExtensions(e)}deleteMessageExtensions(e,t){return this.getEngine().chat.deleteMessageExtensions(e,t)}modifyMessage(e){const t=this.getEngine().chat.modifyMessage(e);return this.getResponse(t,!0,!1).catch((e=>{const{code:t=0,data:n={}}=e.code;throw t===ri.MSG_MODIFY_CONFLICT?I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${li.MSG_MODIFY_CONFLICT} data.message: ${null==n?void 0:n.message}`):t===ri.MSG_MODIFY_DISABLED_IN_AVCHATROOM?I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",li.MSG_MODIFY_DISABLED_IN_AVCHATROOM):t===ri.MODIFY_MESSAGE_NOT_EXIST&&I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",li.MODIFY_MESSAGE_NOT_EXIST),e}))}getMessageList(e={conversationID:this.getStoreData(oi.CONV,"currentConversationID"),nextReqMessageID:this.getStoreData(oi.CHAT,"nextReqMessageID")}){const t=this.getEngine();if(!t.chat.isReady())return Promise.reject({code:ci.GET_MSG_LIST_ERROR,message:ui.GET_MSG_LIST_ERROR});if(this.getStoreData(oi.CHAT,"isCompleted"))return Promise.resolve({data:{messageList:[],nextReqMessageID:"",isCompleted:!0}});const n=this.getStoreData(oi.CHAT,"messageSource"),o=this.hoppingConfigMap.get("nextMessageSeq"),a=this.hoppingConfigMap.get("nextMessageTime"),i=o||a;return n&&n.conversationID===e.conversationID&&i?this.getMessageListHopping():t.chat.getMessageList(e).then((e=>{var n;const{messageList:o,nextReqMessageID:a,isCompleted:i}=e.data,s=this.getStoreData(oi.CHAT,"userInfo");Object.keys(s).length>0&&this.updateLocalMessage(o,s),this.updateMessageList(o,"unshift"),t.TUIStore.update(oi.CHAT,"nextReqMessageID",a),t.TUIStore.update(oi.CHAT,"isCompleted",i);const r=null===(n=o[0])||void 0===n?void 0:n.conversationID,{operationType:c=0}=this.getEngine().TUIStore.getConversationModel(r)||{};return 0===c&&(this.getMessageReactions({messageList:o}),this.readReceiptHandler.getMessageReadReceiptList(o)),e})).catch((e=>Promise.reject(e)))}getMessageListHopping(e){var t;void 0===e&&(e={conversationID:null===(t=this.getStoreData(oi.CHAT,"messageSource"))||void 0===t?void 0:t.conversationID,sequence:this.hoppingConfigMap.get("nextMessageSeq"),time:this.hoppingConfigMap.get("nextMessageTime")});const n=this.getEngine();return n.chat.getMessageListHopping(e).then((t=>{const{messageList:o,nextMessageSeq:a,nextMessageTime:i,isCompleted:s}=t.data,r=1===e.direction?e.sequence:a,c=1===e.direction?e.time:i;return this.updateMessageList(o,"unshift"),this.delayGetHoppingFunction=void 0,this.hoppingConfigMap.set("nextMessageSeq",r),this.hoppingConfigMap.set("nextMessageTime",c),n.TUIStore.update(oi.CHAT,"isCompleted",s),t})).catch((e=>Promise.reject(e)))}sendMessageReadReceipt(e){return this.readReceiptHandler.sendMessageReadReceipt(e)}getGroupMessageReadMemberList(e){return this.readReceiptHandler.getGroupMessageReadMemberList(e).then((e=>{const{isCompleted:t,cursor:n,messageID:o,unreadUserIDList:a,readUserIDList:i}=e.data,s={code:0,data:{cursor:n,isCompleted:t,messageID:o,unreadUserInfoList:[],readUserInfoList:[]}},r=[...a,...i];return 0===r.length?s:this.getEngine().TUIUser.getUserProfile({userIDList:r}).then((e=>(a.length>0?e.data.forEach((e=>{const{userID:t,nick:n="",avatar:o=""}=e;s.data.unreadUserInfoList.push({userID:t,nick:n,avatar:o})})):e.data.forEach((e=>{const{userID:t,nick:n="",avatar:o=""}=e;s.data.readUserInfoList.push({userID:t,nick:n,avatar:o})})),s)))}))}downloadMergedMessages(e){return this.getEngine().chat.downloadMergerMessage(e)}setTranslationLanguage(e){this.getEngine().TUIStore.update(oi.USER,"targetLanguage",e)}translateText(e){const t=this.getStoreData(oi.USER,"targetLanguage"),n=Object.assign({targetLanguage:t,sourceLanguage:"auto"},e);return this.getEngine().chat.translateText(n)}searchCloudMessages(e){const t=this.getStoreData(oi.CONV,"conversationList");return this.getEngine().chat.searchCloudMessages(e).then((e=>{const{searchResultList:n}=e.data;return e.data.searchResultList=n.map((e=>{const{messageList:n,conversationID:o}=e,a=Qa(e,["messageList","conversationID"]),i=n.map((e=>new ji(e))),s=t.find((e=>e.conversationID===o));return Object.assign(Object.assign({},a),{messageList:i.sort(((e,t)=>t.time-e.time)),conversation:s})})),e}))}addMessageReaction(e,t){return this.getEngine().chat.addMessageReaction(e.getMessage(),t)}removeMessageReaction(e,t){return this.getEngine().chat.removeMessageReaction(e.getMessage(),t)}getMessageReactions(e){const{messageList:t=[]}=e,n=this.getStoreData(oi.APP,"enabledEmojiPlugin");I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`TUIChatService.getMessageReactions enabledEmojiPlugin:${n} messageList length:${t.length}`),n&&t.length>0&&this.getEngine().chat.getMessageReactions(e).then((e=>{const t=e.data.resultList||e.data;this.updateMessageReactionList(t)})).catch((e=>{}))}getAllUserListOfMessageReaction(e){var t;return this.getEngine().chat.getAllUserListOfMessageReaction(Object.assign(Object.assign({},e),{message:null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.getMessage()}))}updateMessageReactionList(e){const t=[];e.forEach((e=>{const{messageID:n,reactionList:o}=e,a=this.getEngine().TUIStore.getMessageModel(n);if(a){const e=[];for(let t=0;t<o.length;t++){let n=!0;for(let e=0;e<a.reactionList.length;e++)if(o[t].reactionID===a.reactionList[e].reactionID){a.reactionList[e]=o[t],n=!1;break}n&&e.push(o[t])}a.reactionList.push(...e),e.length=0,t.push(a)}})),t.length>0&&this.updateMessageList(t,"edit")}convertVoiceToText(e){const{message:t,language:n="zh"}=e,o=t.getMessage();return this.getEngine().chat.convertVoiceToText({message:o,language:n})}updateMessageInfo(e){const t=this.getStoreData(oi.CHAT,"userInfo");this.getEngine().TUIStore.update(oi.CHAT,"userInfo",Object.assign(t,e));const n=this.getStoreData(oi.CHAT,"messageList");n.length>0&&this.updateLocalMessage(n,e)&&this.getEngine().TUIStore.update(oi.CHAT,"messageList",n)}updateLocalMessage(e,t){let n=!1;return e.forEach((e=>{if(t[e.from]){const{nick:o,nameCard:a,avatar:i}=t[e.from];o&&(e.nick=o,n=!0),a&&(e.nameCard=a,n=!0),i&&(e.avatar=i,n=!0)}})),n}handleC2CCallSignaling(e){const t=this.getEngine(),n=t.getMyUserID();return e.filter((e=>{var o,a,i,s,r;const{conversationType:c,type:l,payload:u}=e;let d=!0;if(c===t.TYPES.CONV_C2C&&l===t.TYPES.MSG_CUSTOM&&t.chat.getSignalingInfo(e)){const t=gi(u.data);if(1===(null==t?void 0:t.businessID)){const c=gi(t.data);if(d=!(e._isExcludedFromUnreadCount&&e._isExcludedFromLastMessage),d&&!0!==(null===(o=null==c?void 0:c.data)||void 0===o?void 0:o.consumed)){let o=null===(a=null==c?void 0:c.data)||void 0===a?void 0:a.inviter;"line_busy"!==(null==c?void 0:c.line_busy)&&"lineBusy"!==(null===(i=null==c?void 0:c.data)||void 0===i?void 0:i.message)||(o=t.inviter);const{from:l,to:u}=e;if(o!==n&&e.from===n){const t=this.getStoreData(oi.CONV,"currentConversation");e.from=u,e.to=l,e.flow="in",e.avatar=(null===(s=null==t?void 0:t.userProfile)||void 0===s?void 0:s.avatar)||""}if(o===n&&e.from!==n){const t=this.getStoreData(oi.USER,"userProfile");e.from=u,e.to=l,e.flow="out",e.avatar=null==t?void 0:t.avatar}I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${this.serv}.handleC2CCallSignaling myUserID:${n} callSignaling.inviter:${t.inviter} customData.data.inviter:${null===(r=null==c?void 0:c.data)||void 0===r?void 0:r.inviter}`)}}}return d}))}}class _r extends xi{constructor(){super(),this.groupMap=new Map}static getInstance(){return _r.instance||(_r.instance=new _r),_r.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.GROUP_LIST_UPDATED,this.onGroupListUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.GROUP_ATTRIBUTES_UPDATED,this.onGroupAttributesUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.GROUP_COUNTER_UPDATED,this.onGroupCounterUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_RECEIVED,this.onMessageReceived.bind(this)),this.getGroupInitData()}onGroupListUpdated(e){const t=this.getEngine();t.TUIStore.update(oi.GRP,"groupList",e);const n=t.TUIStore.getData(oi.GRP,"currentGroupID");e.forEach((e=>{e.groupID===n&&t.TUIStore.update(oi.GRP,"currentGroup",e)}))}onGroupAttributesUpdated(e){const t=this.getEngine(),n=t.TUIStore.getData(oi.GRP,"currentGroupID");let o=t.TUIStore.getData(oi.GRP,"groupList");const{groupID:a,groupAttributes:i}=e;n===a&&t.TUIStore.update(oi.GRP,"currentGroupAttributes",i),o=o.map((e=>(e.groupID===a&&(e.groupAttributes=i),e))),t.TUIStore.update(oi.GRP,"groupList",o)}onGroupCounterUpdated(e){const t=this.getEngine(),n=t.TUIStore.getData(oi.GRP,"currentGroupID"),o=t.TUIStore.getData(oi.GRP,"currentGroupCounters")||{};let a=t.TUIStore.getData(oi.GRP,"groupList");const{groupID:i,key:s,value:r}=e;n===i&&(o[s]=r,t.TUIStore.update(oi.GRP,"currentGroupCounters",o)),a=a.map((e=>(e.groupID===i&&(e.groupCounters=Object.assign(Object.assign({},e.groupCounters),{[s]:r})),e))),t.TUIStore.update(oi.GRP,"groupList",a)}onMessageReceived(e){const t=this.getEngine(),n=[];e.forEach((e=>{if(e.type===t.TYPES.MSG_GRP_TIP){const{payload:n}=e,{operationType:o,userIDList:a}=n,i=t.TUIStore.getData(oi.GRP,"currentGroupID");switch(o){case t.TYPES.GRP_TIP_MBR_JOIN:this.addMemberList(a);break;case t.TYPES.GRP_TIP_MBR_QUIT:case t.TYPES.GRP_TIP_MBR_KICKED_OUT:this.removeMemberList(a);break;case t.TYPES.GRP_TIP_MBR_SET_ADMIN:case t.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:this.updateGroupMember(a);break;case t.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:this.getGroupProfile({groupID:i});break;case t.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:case t.TYPES.GRP_TIP_BAN_AVCHATROOM_MEMBER:case t.TYPES.GRP_TIP_UNBAN_AVCHATROOM_MEMBER:this.updateGroupMember(a)}}e.type===t.TYPES.MSG_GRP_SYS_NOTICE&&n.push(e)})),n.length>0&&t.TUIStore.update(oi.GRP,"groupSystemNoticeList",n)}getGroupInitData(){const e=this.getEngine();e.chat.isReady()&&e.chat.getGroupList().then((e=>{const{groupList:t=[]}=e.data;I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`TUIGroupService.init, getGroupList count:${t.length}`),t.length>0&&this.onGroupListUpdated(t)}))}updateGroupMember(e){return ei(this,void 0,void 0,(function*(){const t=this.getEngine().TUIStore.getData(oi.GRP,"currentGroupID");if(t){const n=yield this.getGroupMemberProfile({groupID:t,userIDList:e}),{memberList:o}=n.data;this.updateMemberList(o)}}))}resetCurrentStore(){this.getEngine().TUIStore.reset(oi.GRP,["currentGroupID","currentGroup","currentGroupAttributes","currentGroupCounters","currentGroupMemberList"],!0)}switchGroup(e){return ei(this,void 0,void 0,(function*(){const t=this.getEngine(),n=t.TUIStore.getConversationModel(`GROUP${e}`);if((null==n?void 0:n.operationType)>0){const e=t.TUIStore.getData(oi.GRP,"currentGroup");return Promise.resolve(e)}const o=t.TUIStore.getData(oi.GRP,"currentGroupID");if(!e)return this.resetCurrentStore(),Promise.resolve({});if(o===e){const e=t.TUIStore.getData(oi.GRP,"currentGroup");return Promise.resolve(e)}this.resetCurrentStore(),t.TUIStore.update(oi.GRP,"currentGroupID",e);try{yield this.getGroupInfo(e)}catch(s){Promise.reject(s)}const a=setTimeout((()=>{this.groupMap.delete(e),clearTimeout(a)}),5e3),i=t.TUIStore.getData(oi.GRP,"currentGroup");return Promise.resolve(i)}))}getGroupInfo(e){return ei(this,void 0,void 0,(function*(){const t=this.getEngine(),n=this.groupMap.get(e);if(n)return this.updateMemberList((null==n?void 0:n.memberList)||[]),t.TUIStore.update(oi.GRP,"currentGroup",n.group),t.TUIStore.update(oi.GRP,"currentGroupAttributes",n.groupAttributes||{}),void t.TUIStore.update(oi.GRP,"currentGroupCounters",n.counters||{});const o={group:{},memberList:[],groupAttributes:void 0,counters:void 0},{data:{group:a}}=yield this.getGroupProfile({groupID:e});o.group=a;const{data:{memberList:i}}=yield this.getGroupMemberList({groupID:e});o.memberList=i;const s=yield this.getGroupAttributes({groupID:e,keyList:[]}),{groupAttributes:r}=s.data;o.groupAttributes=r,t.TUIStore.update(oi.GRP,"currentGroupAttributes",r);try{const n=yield this.getGroupCounters({groupID:e,keyList:[]}),{counters:a}=n.data;o.counters=a,t.TUIStore.update(oi.GRP,"currentGroupCounters",a)}catch(c){I("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",null==c?void 0:c.message)}this.groupMap.set(e,o)}))}getGroupProfile(e){const t=this.getEngine();return t.chat.getGroupProfile(e).then((n=>ei(this,void 0,void 0,(function*(){if(t.TUIStore.getData(oi.GRP,"currentGroupID")===e.groupID){const{group:e}=n.data;t.TUIStore.update(oi.GRP,"currentGroup",e)}return n}))))}updateGroupProfile(e){return this.getEngine().chat.updateGroupProfile(e)}createGroup(e){return this.getEngine().chat.createGroup(e)}dismissGroup(e){return this.getEngine().chat.dismissGroup(e)}searchGroupByID(e){const t=this.getEngine();return t.chat.searchGroupByID(e).then((e=>{const{group:n}=e.data,o=t.TUIStore.getData(oi.GRP,"groupList");return e.data.group.isJoinedGroup=o.some((e=>e.groupID===n.groupID)),e}))}joinGroup(e){return this.getEngine().chat.joinGroup(e)}quitGroup(e){return this.getEngine().chat.quitGroup(e)}getGroupApplicationList(){return this.getEngine().chat.getGroupApplicationList()}handleGroupApplication(e){return this.getEngine().chat.handleGroupApplication(e)}getGroupOnlineMemberCount(e){return this.getEngine().chat.getGroupOnlineMemberCount(e)}changeGroupOwner(e){return this.getEngine().chat.changeGroupOwner(e)}initGroupAttributes(e){return this.getEngine().chat.initGroupAttributes(e)}setGroupAttributes(e){return this.getEngine().chat.setGroupAttributes(e)}deleteGroupAttributes(e){return this.getEngine().chat.deleteGroupAttributes(e)}getGroupAttributes(e){return this.getEngine().chat.getGroupAttributes(e)}setGroupCounters(e){return this.getEngine().chat.setGroupCounters(e)}increaseGroupCounter(e){return this.getEngine().chat.increaseGroupCounter(e)}decreaseGroupCounter(e){return this.getEngine().chat.decreaseGroupCounter(e)}getGroupCounters(e){return this.getEngine().chat.getGroupCounters(e)}updateMemberList(e){const t=this.getEngine(),n=[...(t.TUIStore.getData(oi.GRP,"currentGroupMemberList")||[]).filter((t=>!e.find((e=>e.userID===t.userID)))),...e];t.TUIStore.update(oi.GRP,"currentGroupMemberList",n)}addMemberList(e){return ei(this,void 0,void 0,(function*(){const t=this.getEngine().TUIStore.getData(oi.GRP,"currentGroupID");if(t)try{const n=yield this.getGroupMemberProfile({groupID:t,userIDList:e}),{memberList:o}=n.data;this.updateMemberList(o)}catch(n){const t=e.map((e=>({userID:e,avatar:"",nick:"",role:"",joinTime:0,nameCard:"",muteUntil:0,memberCustomField:[]})));this.updateMemberList(t)}}))}removeMemberList(e){const t=this.getEngine(),n=t.TUIStore.getData(oi.GRP,"currentGroupMemberList").filter((t=>-1===e.indexOf(t.userID)));t.TUIStore.update(oi.GRP,"currentGroupMemberList",n)}getGroupMemberList(e){const t=this.getEngine();return t.chat.getGroupMemberList(e).then((n=>{if(t.TUIStore.getData(oi.GRP,"currentGroupID")===e.groupID){const{memberList:e}=n.data;this.updateMemberList(e)}return n}))}getGroupMemberProfile(e){return this.getEngine().chat.getGroupMemberProfile(e)}addGroupMember(e){const t=this.getEngine();return t.chat.addGroupMember(e).then((n=>ei(this,void 0,void 0,(function*(){if(t.TUIStore.getData(oi.GRP,"currentGroupID")===e.groupID){const{successUserIDList:e,group:o}=n.data;t.TUIStore.update(oi.GRP,"currentGroup",o),this.addMemberList(e)}return n}))))}deleteGroupMember(e){const t=this.getEngine();return t.chat.deleteGroupMember(e).then((n=>{if(t.TUIStore.getData(oi.GRP,"currentGroupID")===e.groupID){const{userIDList:e,group:o}=n.data;this.removeMemberList(e),t.TUIStore.update(oi.GRP,"currentGroup",o)}return n}))}setGroupMemberMuteTime(e){return this.getEngine().chat.setGroupMemberMuteTime(e)}setGroupMemberRole(e){return this.getEngine().chat.setGroupMemberRole(e)}setGroupMemberNameCard(e){return this.getEngine().chat.setGroupMemberNameCard(e)}setGroupMemberCustomField(e){return this.getEngine().chat.setGroupMemberCustomField(e)}markGroupMemberList(e){return this.getEngine().chat.markGroupMemberList(e)}}class yr extends xi{constructor(){super()}static getInstance(){return yr.instance||(yr.instance=new yr),yr.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.FRIEND_LIST_UPDATED,this.onFriendListUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.FRIEND_APPLICATION_LIST_UPDATED,this.onFriendApplicationListUpdated.bind(this)),this.getFriendInitData()}onFriendListUpdated(e){this.getEngine().TUIStore.update(oi.FRIEND,"friendList",e)}onFriendApplicationListUpdated(e){const{friendApplicationList:t,unreadCount:n=0}=e,o=this.getEngine();o.TUIStore.update(oi.FRIEND,"friendApplicationList",t),o.TUIStore.update(oi.FRIEND,"friendApplicationUnreadCount",n)}getFriendInitData(){const e=this.getEngine();e.chat.isReady()&&(e.chat.getFriendList().then((e=>{const t=e.data||[];I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`TUIFriendService.init, getFriendList count:${t.length}`),t.length>0&&this.onFriendListUpdated(t)})),e.chat.getFriendApplicationList().then((e=>{this.onFriendApplicationListUpdated(e.data)})))}getFriendList(){return this.getEngine().chat.getFriendList()}getFriendRemark(e){const t=this.getEngine().TUIStore.getData(oi.FRIEND,"friendList"),n={};return e.forEach((e=>{for(let o=0;o<t.length;o++)t[o].userID!==e||(n[e]=t[o].remark)})),n}addFriend(e){return this.getEngine().chat.addFriend(e)}deleteFriend(e){return this.getEngine().chat.deleteFriend(e)}checkFriend(e){return this.getEngine().chat.checkFriend(e)}getFriendProfile(e){return this.getEngine().chat.getFriendProfile(e)}updateFriend(e){return this.getEngine().chat.updateFriend(e)}acceptFriendApplication(e){return this.getEngine().chat.acceptFriendApplication(e)}refuseFriendApplication(e){return this.getEngine().chat.refuseFriendApplication({userID:e})}deleteFriendApplication(e){return this.getEngine().chat.deleteFriendApplication(e)}setFriendApplicationRead(){return this.getEngine().chat.setFriendApplicationRead()}}class Ir{constructor(){this.cache=[],this.middlewares=[],this.options=null}use(e){return"function"!=typeof e&&I("error","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","middleware must be a function"),this.cache.push(e),this}next(){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}run(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}function Er(e,t,n){const o=Object.create(null);Object.keys(n).forEach((n=>{if(!t[n])return;o[n]=t[n];const a=new Ir;t[n]=function(){const i=Array.from(arguments);return a.use((function(t,o){return e.isInited?o():Promise.reject({code:ci.NOT_INIT,message:`${n} | ${ui.NOT_INIT}`})})).use((function(e,a){return o[n].apply(t,e)})),a.run(i)}}))}I("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.VERSION:2.3.2");const Cr=Ui.getInstance();Oi.getInstance();const kr=Ji.getInstance(),Tr=ir.getInstance(),Mr=sr.getInstance(),Sr=hr.getInstance(),Dr=vr.getInstance(),br=_r.getInstance(),wr=yr.getInstance();Cr.mount(ni.TUIStore,kr),Cr.mount(ni.TUITranslate,Tr),Cr.mount(ni.TUIConversation,Mr),Cr.mount(ni.TUIUser,Sr),Cr.mount(ni.TUIChat,Dr),Cr.mount(ni.TUIGroup,br),Cr.mount(ni.TUIFriend,wr),Er(Cr,Cr,{logout:1,destroy:1}),Er(Cr,Mr,{deleteConversation:1,pinConversation:1,muteConversation:1,switchConversation:1,getConversationProfile:1,clearHistoryMessage:1}),Er(Cr,Dr,{modifyMessage:1,revokeMessage:1,resendMessage:1,deleteMessage:1,quoteMessage:1,replyMessage:1,setMessageExtensions:1,deleteMessageExtensions:1,getMessageExtensions:1,sendTextMessage:1,sendTextAtMessage:1,sendImageMessage:1,sendAudioMessage:1,sendVideoMessage:1,sendFileMessage:1,sendCustomMessage:1,sendFaceMessage:1,sendLocationMessage:1,sendForwardMessage:1,enterTypingState:1,leaveTypingState:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageList:1,downloadMergedMessages:1,setTranslationLanguage:1,translateText:1,searchCloudMessages:1,addMessageReaction:1,removeMessageReaction:1,getMessageReactions:1,getAllUserListOfMessageReaction:1}),Er(Cr,br,{switchGroup:1,getGroupProfile:1,updateGroupProfile:1,createGroup:1,dismissGroup:1,searchGroupByID:1,joinGroup:1,quitGroup:1,getGroupApplicationList:1,handleGroupApplication:1,getGroupOnlineMemberCount:1,changeGroupOwner:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getGroupMemberList:1,getGroupMemberProfile:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberNameCard:1,setGroupMemberCustomField:1,markGroupMemberList:1}),Er(Cr,Sr,{switchUserStatus:1,switchMessageReadStatus:1,getUserProfile:1,updateMyProfile:1,addToBlacklist:1,removeFromBlacklist:1}),Er(Cr,wr,{getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,getFriendProfile:1,updateFriend:1,acceptFriendApplication:1,refuseFriendApplication:1,deleteFriendApplication:1,setFriendApplicationRead:1});let Nr=class{constructor(){this.serviceMap=new Map}registerService(e,t){this.serviceMap.has(e)||(I("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIServiceManager.registerService serviceName:${e}`),this.serviceMap.set(e,t))}unregisterService(e){this.serviceMap.has(e)&&(I("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIServiceManager.unregisterService serviceName:${e}`),this.serviceMap.delete(e))}getService(e){return this.serviceMap.get(e)}callService(e){const{serviceName:t,method:n,params:o,callback:a}=e,i=this.getService(t);if(I("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIServiceManager.callService serviceName:${t}, service:`,i),i)return i.onCall(n,o,a)}},Lr=class{constructor(){this.extensionMap=new Map}registerExtension(e,t){if(I("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIExtensionManager.registerExtension extensionID:${e}`),!this.extensionMap.has(e)){const t=[];this.extensionMap.set(e,t)}const n=this.extensionMap.get(e);-1===n.indexOf(t)&&n.push(t)}unregisterExtension(e,t){if(I("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIExtensionManager.unregisterExtension extensionID:${e}`),this.extensionMap.has(e)){const n=this.extensionMap.get(e),o=n.indexOf(t);o>-1&&n.splice(o,1)}}getExtensionList(e,t){I("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIExtensionManager.getExtensionList extensionID:${e} ${t?`params:${JSON.stringify(t)}`:""}`);let n=[],o=[];if(this.extensionMap.has(e)){n=this.extensionMap.get(e);for(let a=0;a<n.length;a++){const i=n[a].onGetExtension(e,t);o=o.concat(i)}}return o}};const Rr=["vue2","vue3","rn"],Ar={TUILogin:{EVENT:{LOGIN_STATE_CHANGED:"loginStateChanged"},EVENT_SUB_KEY:{USER_LOGIN_SUCCESS:"userLoginSuccess",USER_LOGOUT_SUCCESS:"userLogoutSuccess",USER_KICKED_OFFLINE:"userKickedOffline",USER_SIG_EXPIRED:"userSigExpired"}},TUIConversation:{SERVICE:{NAME:"TUIConversationService",METHOD:{CREATE_CONVERSATION:"createConversation",HIDE_CONVERSATION_HEADER:"hideConversationHeader"}},EXTENSION:{CONV_POP_MENU:{EXT_ID:"conversationPopMenu"},CONV_GROUP:{EXT_ID:"conversationGroup"}}},TUIChat:{SERVICE:{NAME:"TUIChatService",METHOD:{UPDATE_MESSAGE_LIST:"updateMessageList",CLOSE_MESSAGE_POP_MENU:"closeMessagePopMenu",SEND_CUSTOM_MESSAGE:"sendCustomMessage",SEND_TEXT_MESSAGE:"sendTextMessage",SET_CHAT_TYPE:"setChatType",UPDATE_MESSAGE_INFO:"updateMessageInfo"}},EXTENSION:{INPUT_MORE:{EXT_ID:"inputToolBarMore"},MSG_POP_MENU:{EXT_ID:"messagePopMenu"},CHAT_HEADER:{EXT_ID:"chatHeader"}},TYPE:{C2C:"C2C",GROUP:"GROUP",CUSTOMER_SERVICE:"customerService",ROOM:"room"},EVENT:{CHAT_STATE_CHANGED:"chatStateChanged",CHAT_TYPE_CHANGED:"chatTypeChanged"},EVENT_SUB_KEY:{CHAT_OPENED:"chatOpened",CHANGE_SUCCESS:"changeSuccess"},FEATURE:{DownloadFile:"DownloadFile",CopyMessage:"CopyMessage",DeleteMessage:"DeleteMessage",RevokeMessage:"RevokeMessage",QuoteMessage:"QuoteMessage",ForwardMessage:"ForwardMessage",TranslateMessage:"TranslateMessage",VoiceToText:"VoiceToText",MultiSelection:"MultiSelection",EmojiReaction:"EmojiReaction",InputEmoji:"InputEmoji",InputStickers:"InputStickers",InputImage:"InputImage",InputVoice:"InputVoice",InputVideo:"InputVideo",InputFile:"InputFile",InputEvaluation:"InputEvaluation",InputQuickReplies:"InputQuickReplies",InputMention:"InputMention",MessageSearch:"MessageSearch",ReadStatus:"ReadStatus"}},TUIGroup:{SERVICE:{NAME:"TUIGroupService",METHOD:{CREATE_GROUP:"createGroup",OPEN_GROUP_MANAGEMENT:"openGroupManagement",SELECT_GROUP_MEMBER:"selectGroupMember"}}},TUIContact:{SERVICE:{NAME:"TUIContactService",METHOD:{SELECT_FRIEND:"selectFriend"}},EXTENSION:{CONTACT_LIST:{EXT_ID:"contactList"}}},TUISearch:{SERVICE:{NAME:"TUISearchService",METHOD:{SEARCH_GROUP:"searchGroup",SEARCH_USER:"searchUser",SEARCH_FRIEND:"searchFriend",SEARCH_GROUP_MEMBER:"searchGroupMember"}},EXTENSION:{SEARCH_MORE:{EXT_ID:"searchMore"}}},TUICalling:{SERVICE:{NAME:"TUICallingService",METHOD:{START_CALL:"startCall"}}},TUIRoom:{SERVICE:{NAME:"TUIRoomService"}},TUIEmojiPlugin:{SERVICE:{NAME:"TUIEmojiPluginService",METHOD:{CLOSE_EMOJI_DETAIL:"closeEmojiDetail"}}},TUITranslate:{EVENT:{LANGUAGE_CHANGED:"languageChanged"},EVENT_SUB_KEY:{CHANGE_SUCCESS:"changeSuccess"}},TUITranslatePlugin:{SERVICE:{NAME:"TUITranslatePluginService"}},TUIVoiceToTextPlugin:{SERVICE:{NAME:"TUIVoiceToTextPluginService"}},TUICustomerServicePlugin:{SERVICE:{NAME:"TUICustomerServicePlugin",METHOD:{ACTIVE_CONVERSATION:"activeConversation",FILTER_MESSAGE:"filterMessage"}},EXTENSION:{}},TUIPushPlugin:{SERVICE:{NAME:"TUIPushPluginService"}},TUIChatbotPlugin:{SERVICE:{NAME:"TUIChatbotPluginService"}},TUITheme:{EVENT:{THEME_CHANGED:"themeChanged"},EVENT_SUB_KEY:{CHANGE_SUCCESS:"changeSuccess"}}},Or="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),Ur="undefined"!=typeof uni&&"undefined"==typeof window,Pr="undefined"!=typeof uni,Gr=("undefined"!=typeof uni||"undefined"!=typeof window)&&!(Or||Ur);Or?wx:Pr?uni:window;const xr=Gr&&window&&window.navigator&&window.navigator.userAgent||"",Br=/Android/i.test(xr),Vr=/(?:Windows Phone)/.test(xr),Fr=/(?:SymbianOS)/.test(xr),Hr=/iPad/i.test(xr)||/iPhone/i.test(xr)||/iPod/i.test(xr),jr=Br||Vr||Fr||Hr,qr=Gr&&!jr,zr=Ur&&!Or,Kr={[Ar.TUITranslatePlugin.SERVICE.NAME]:Math.pow(2,38),[Ar.TUIVoiceToTextPlugin.SERVICE.NAME]:Math.pow(2,39),[Ar.TUICustomerServicePlugin.SERVICE.NAME]:Math.pow(2,40),[Ar.TUIPushPlugin.SERVICE.NAME]:Math.pow(2,41),[Ar.TUIChatbotPlugin.SERVICE.NAME]:Math.pow(2,42),[Ar.TUIEmojiPlugin.SERVICE.NAME]:Math.pow(2,48)};class $r{constructor(e){this.loginStatusPromise=new Map,this.SDKAppID=0,this.userID="",this.userSig="",this.TUICore=e,this.isOnChatEvent=!1}static getInstance(e){return!$r.instance&&e&&($r.instance=new $r(e)),$r.instance}login(e){const{SDKAppID:t,userID:n,userSig:o,framework:a}=e;return this.chat=Ka.create(Object.assign(Object.assign({},e),{scene:this.getStatScene(a)})),this.EVENT=Ka.EVENT,this.TYPES=Ka.TYPES,this.SDKAppID=t,this.userID=n,this.userSig=o,this.offChatEvent(),this.onChatEvent(),this.registerPlugin(e),this.loginChat(e)}logout(){return this.chat.logout().then((e=>(this.userID="",this.userSig="",this.TUICore.notifyEvent(Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED,Ar.TUILogin.EVENT_SUB_KEY.USER_LOGOUT_SUCCESS),Promise.resolve(e))))}destroy(){return this.chat.destroy().then((e=>(this.userID="",this.userSig="",this.TUICore.notifyEvent(Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED,Ar.TUILogin.EVENT_SUB_KEY.USER_LOGOUT_SUCCESS),Promise.resolve(e))))}setLogLevel(e){return this.chat.setLogLevel(e)}getContext(){return{chat:this.chat,SDKAppID:this.SDKAppID,userID:this.userID,userSig:this.userSig}}reportPlugin(){var e;for(const t in Kr)this.TUICore.getService(t)&&(null===(e=this.chat.callExperimentalAPI("isFeatureEnabledForStat",Kr[t]))||void 0===e||e.catch((e=>{})))}loginChat(e){const{userID:t,userSig:n}=e;return new Promise(((e,o)=>{this.chat.login({userID:t,userSig:n}).then((t=>{t.data.repeatLogin&&this.chat.isReady()&&e(t),this.reportPlugin(),this.loginStatusPromise.set("login",{resolve:e,reject:o,imResponse:t})})).catch((e=>{o(e)}))}))}onChatEvent(){this.chat.on(this.EVENT.SDK_READY,this.onSDKReady,this),this.chat.on(this.EVENT.SDK_NOT_READY,this.onSDKNotReady,this),this.chat.on(this.EVENT.KICKED_OUT,this.onUserKicked,this),this.isOnChatEvent=!0}offChatEvent(){this.isOnChatEvent&&(this.chat.off(this.EVENT.SDK_READY,this.onSDKReady,this),this.chat.off(this.EVENT.SDK_NOT_READY,this.onSDKNotReady,this),this.chat.off(this.EVENT.KICKED_OUT,this.onUserKicked,this),this.isOnChatEvent=!1)}onSDKReady(){if(this.loginStatusPromise.has("login")){this.TUICore.notifyEvent(Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED,Ar.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS);const e=setTimeout((()=>{const t=this.loginStatusPromise.get("login");t.resolve(t.imResponse),clearTimeout(e),this.loginStatusPromise.delete("login")}),500)}}onSDKNotReady(){this.loginStatusPromise.has("login")&&this.loginStatusPromise.get("login").reject(new Error("sdk not ready")),this.loginStatusPromise.delete("login")}onUserKicked(e){e.data.type!==this.TYPES.KICKED_OUT_USERSIG_EXPIRED?this.TUICore.notifyEvent(Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED,Ar.TUILogin.EVENT_SUB_KEY.USER_KICKED_OFFLINE):this.TUICore.notifyEvent(Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED,Ar.TUILogin.EVENT_SUB_KEY.USER_SIG_EXPIRED)}registerPlugin(e){const{useUploadPlugin:t=!1,useProfanityFilterPlugin:n=!1,TUIOfflinePush:o,offlinePushConfig:a,TIMPush:i,pushConfig:s}=e;!0===t&&this.chat.registerPlugin({"tim-upload-plugin":Ya}),!0===n&&this.chat.registerPlugin({"tim-profanity-filter-plugin":Za}),zr&&i&&s&&this.chat.registerPlugin({"tim-push":i,pushConfig:s}),zr&&o&&a&&this.chat.registerPlugin({"tim-offline-push-plugin":o,offlinePushConfig:a})}getStatScene(e){let t;return e&&Rr.indexOf(e)>-1&&(t=this.genStatScene(e)),t}genStatScene(e){if("rn"===e)return"k-rn";let t="";return Pr?(qr&&(t=`k-${e}-pc-uni`),jr&&(t=`k-${e}-h5-uni`),zr&&(t=`k-${e}-app-uni`),Or&&(t=`k-${e}-mp-uni`),t):(qr&&(t=`k-${e}-pc`),jr&&(t=`k-${e}-h5`),t)}}class Yr{constructor(){this.eventMap=new Map}registerEvent(e,t,n){const o=this.getKey(e,t);if(I("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIEventManager.registerEvent eventName:${e} subKey:${t}`),!this.eventMap.has(o)){const e=[];this.eventMap.set(o,e)}const a=this.eventMap.get(o);-1===a.indexOf(n)&&(a.push(n),this.renotify(e,t,n))}unregisterEvent(e,t,n){I("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIEventManager.unregisterEvent eventName:${e} subKey:${t}`);const o=this.getKey(e,t);if(this.eventMap.has(o)){const e=this.eventMap.get(o),t=e.indexOf(n);t>-1&&e.splice(t,1)}}notifyEvent(e,t,n){const o=this.getKey(e,t),a=n?`params:${JSON.stringify(n)}`:"";I("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIEventManager.notifyEvent eventName:${e} subKey:${t} ${a}`),this.eventMap.has(o)&&this.eventMap.get(o).forEach((o=>{o.onNotifyEvent(e,t,n)}))}getKey(e,t){let n=e;return t&&(n=`${e}-${n}`),n}renotify(e,t,n){if(e===Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED&&t===Ar.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS){const{chat:e}=$r.getInstance().getContext();e&&e.isReady()&&(n.onNotifyEvent(Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED,Ar.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS),I("log","at node_modules/@tencentcloud/tui-core/index.js:1","TUIEventManager.renotify success."))}}}I("log","at node_modules/@tencentcloud/tui-core/index.js:1","TUICore.VERSION:2.3.2");const Wr=class e{constructor(){this.serviceManager=new Nr,this.extensionManager=new Lr,this.eventManager=new Yr}static getInstance(){return e.instance||(I("log","at node_modules/@tencentcloud/tui-core/index.js:1","TUICore.getInstance ok."),e.instance=new e),e.instance}registerService(e,t){return this.serviceManager.registerService(e,t)}unregisterService(e){return this.serviceManager.unregisterService(e)}getService(e){return this.serviceManager.getService(e)}callService(e){return this.serviceManager.callService(e)}registerExtension(e,t){return this.extensionManager.registerExtension(e,t)}unregisterExtension(e,t){return this.extensionManager.unregisterExtension(e,t)}getExtensionList(e,t){return this.extensionManager.getExtensionList(e,t)}registerEvent(e,t,n){return this.eventManager.registerEvent(e,t,n)}unregisterEvent(e,t,n){return this.eventManager.unregisterEvent(e,t,n)}notifyEvent(e,t,n){return this.eventManager.notifyEvent(e,t,n)}}.getInstance(),Jr=$r.getInstance(Wr),Xr=e=>Jr.login(e).then((t=>(null==uni||uni.switchTab({url:"/TUIKit/components/TUIConversation/index",success:()=>{null==uni||uni.$emit("uikitLogin",t)}}),Sr.switchUserStatus({displayOnlineStatus:!0}),null==uni||uni.setStorage({key:"userInfo",data:JSON.stringify({...e,TIMPush:void 0,pushConfig:{}})}),t))),Zr=e=>{const{isLoginChat:t=!1,conversationID:n=""}=e||{},o="/TUIKit/components/TUIChat/index",a=kr.getData(oi.CONV,"currentConversationID");t&&n&&(a?a!==n&&uni.navigateBack({delta:1,success:()=>{Mr.switchConversation(n),null==uni||uni.navigateTo({url:o})}}):(Mr.switchConversation(n),null==uni||uni.navigateTo({url:o})))},Qr=e.defineComponent({__name:"login",setup(t){e.ref(!1),e.ref("");const n=e.ref();M((async()=>{if(n.value=getApp().globalData.top,uni.getStorageSync("token")&&uni.getStorageSync("isLoggedIn")){const t=uni.getStorageSync("user_id");if(t){const n=Ha({SDKAppID:uni.$chat_SDKAppID,secretKey:uni.$chat_secretKey,userID:String(t)}),o={SDKAppID:uni.$chat_SDKAppID,userID:String(t),userSig:n.userSig,TIMPush:uni.$TIMPush,pushConfig:{androidConfig:uni.$TIMPushConfigs,iOSConfig:{iOSBusinessID:""}}};try{await i(o),uni.switchTab({url:"/pages/pagesall/home"})}catch(e){uni.showToast({title:"自动登录失败，请重试",icon:"error",duration:2e3})}}}else uni.navigateTo({url:"/pages/login/login"})}));const o=async()=>{if(!c.value)return void uni.showToast({title:"请勾选同意协议",icon:"error",duration:2e3});if(!s.value)return void uni.showToast({title:"请输入账号",icon:"error",duration:2e3});if(!r.value)return void uni.showToast({title:"请输入密码",icon:"error",duration:2e3});const e=se(),t=await(async e=>{if(!e)throw new Error("adminlist不能为空");return await W("/user/login",e)})({mobile:s.value,password:r.value});if(I("log","at pages/login/login.vue:126",t),1===t.code){uni.showToast({title:t.msg,icon:"success"});const{token:n}=t.data.userinfo;e.setUserinfo(t.data.userinfo),e.setToken(n),uni.setStorageSync("token",n),uni.switchTab({url:"/pages/pagesall/home"})}else uni.showToast({title:t.msg,icon:"error",duration:2e3});const{user_id:n}=t.data.userinfo;I("log","at pages/login/login.vue:152",n),uni.setStorageSync("user_id",n),a()},a=()=>{const e=Ha({SDKAppID:uni.$chat_SDKAppID,secretKey:uni.$chat_secretKey,userID:String(uni.getStorageSync("user_id"))}),t={SDKAppID:uni.$chat_SDKAppID,userID:String(String(uni.getStorageSync("user_id"))),userSig:e.userSig,TIMPush:uni.$TIMPush,pushConfig:{androidConfig:uni.$TIMPushConfigs,iOSConfig:{iOSBusinessID:""}}};i(t)},i=e=>Xr(e).then((()=>{uni.setStorageSync("isLoggedIn",!0),uni.setStorageSync("loginInfo",JSON.stringify(e))})).catch((e=>{throw uni.showToast({title:Tr.t("Login.登录失败"),icon:"none"}),e})),s=e.ref(""),r=e.ref(""),c=e.ref(!1);se();const l=async()=>{await uni.navigateTo({url:"/pages/login/ratpass"})},u=()=>{uni.navigateTo({url:"/pages/login/register"})},d=e=>{c.value=e.detail.value.length>0},p=e=>{s.value=e.detail.value},h=e=>{r.value=e.detail.value};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(n.value+5)+"px;")},null,4),e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"textlogin"},[e.createElementVNode("text",null,"登录/注册")]),e.createElementVNode("input",{type:"text",placeholder:"账号",class:"input",onInput:p},null,32),e.createElementVNode("input",{type:"password",placeholder:"密码",class:"input",onInput:h},null,32),e.createElementVNode("button",{class:"login-button",onClick:o},"登录"),e.createElementVNode("view",{class:"links"},[e.createElementVNode("text",{class:"link",onClick:l},"找回密码"),e.createElementVNode("text",{class:"link",onClick:u},"注册")])]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("checkbox-group",{onChange:d,style:{display:"flex","align-items":"center"}},[e.createElementVNode("label",{class:"radio"},[e.createElementVNode("checkbox",{value:"true",activeBorderColor:"#000",activeBackgroundColor:"#fff",iconColor:"#000",style:{transform:"scale(0.5)"}})]),e.createElementVNode("text",null,[e.createTextVNode(" 点击登录，即表示同意 "),e.createElementVNode("text",{onClick:a[0]||(a[0]=e=>t.handlePolicyClick("privacyPolicy")),style:{color:"blue","text-decoration":"underline"}},"《隐私政策》"),e.createTextVNode(" 和 "),e.createElementVNode("text",{onClick:a[1]||(a[1]=e=>t.handlePolicyClick("userAgreement")),style:{color:"blue","text-decoration":"underline"}},"《用户协议》")])],32)])]))}}),ec=L({__name:"ratpass",setup(t){const n=e.ref();M((()=>{n.value=getApp().globalData.top}));const o=e.ref(""),a=e.ref(""),i=e.ref(""),s=e.ref(""),r=e.ref(!1),c=e.ref(60);let l=null;const u=(e,t)=>{"account"===e&&(o.value=t.detail.value),"password1"===e&&(a.value=t.detail.value),"password2"===e&&(i.value=t.detail.value),"code"===e&&(s.value=t.detail.value)},d=async()=>{if(!/^[1][3-9][0-9]{9}$/.test(o.value))return showToast("手机号格式不正确");uni.showLoading({title:"发送中..."});try{const e=await J({mobile:o.value,event:"changemobile"});I("log","at pages/login/ratpass.vue:67",e),1===e.code?(r.value=!0,p(),uni.showToast({title:e.msg||"验证码发送成功",icon:"success",duration:2e3})):uni.showToast({title:e.msg||"发送验证码失败，请重试",icon:"none",duration:2e3})}catch(e){uni.showToast({title:"发送验证码失败，请重试",icon:"none",duration:2e3}),I("error","at pages/login/ratpass.vue:90","发送验证码错误:",e)}finally{uni.hideLoading()}},p=()=>{c.value=60,clearInterval(l),l=setInterval((()=>{c.value--,c.value<=0&&(clearInterval(l),r.value=!1)}),1e3)},h=async()=>{if(!(o.value&&a.value&&i.value&&s.value))return g("请完整填写信息");if(a.value!==i.value)return g("两次密码输入不一致");try{200===(await X({mobile:o.value,newpassword:i.value,captcha:s.value})).statusCode&&(uni.showToast({title:"密码重置成功",icon:"success",duration:2e3}),uni.redirectTo({url:"/pages/login/login"}))}catch(e){g("网络异常，请稍后再试"),I("error","at pages/login/ratpass.vue:146","重置密码错误:",e)}},g=e=>{uni.showToast({title:e,icon:"error",duration:2e3})};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(n.value+5)+"px;")},null,4),e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"textlogin"},[e.createElementVNode("text",null,"找回密码")]),e.createElementVNode("input",{type:"text",placeholder:"请输入手机号",class:"input",onInput:o[0]||(o[0]=e=>u("account",e))},null,32),e.createElementVNode("input",{type:"password",placeholder:"请确认密码",class:"input",onInput:o[1]||(o[1]=e=>u("password1",e))},null,32),e.createElementVNode("input",{type:"password",placeholder:"请在此确认密码",class:"input",onInput:o[2]||(o[2]=e=>u("password2",e))},null,32),e.createElementVNode("view",{class:"button1"},[e.createElementVNode("input",{type:"text",placeholder:"请输入验证码",class:"input button2",onInput:o[3]||(o[3]=e=>u("code",e))},null,32),e.createElementVNode("view",{onClick:e.withModifiers(d,["stop"]),disabled:r.value,class:e.normalizeClass({"code-button":!0,"disabled-button":r.value})},e.toDisplayString(r.value?`${c.value}秒`:"获取验证码"),11,["disabled"])]),e.createElementVNode("button",{class:"login-button",onClick:h},"完成")]),e.createElementVNode("view",{class:"footer"})]))}},[["__scopeId","data-v-765587ca"]]),tc={};function nc(e){return/^[\+-]?(\d+\.?\d*|\.\d+|\d\.\d+e\+\d+)$/.test(e)}function oc(e){switch(typeof e){case"undefined":return!0;case"string":if(0==e.replace(/(^[ \t\n\r]*)|([ \t\n\r]*$)/g,"").length)return!0;break;case"boolean":if(!e)return!0;break;case"number":if(0===e||isNaN(e))return!0;break;case"object":if(null===e||0===e.length)return!0;for(const t in e)return!1;return!0}return!1}function ac(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function ic(e){return"[object Object]"===Object.prototype.toString.call(e)}function sc(e){return"function"==typeof e}const rc=Object.freeze(Object.defineProperty({__proto__:null,amount:function(e){return/^[1-9]\d*(,\d{3})*(\.\d{1,2})?$|^0\.\d{1,2}$/.test(e)},array:ac,carNo:function(e){const t=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}(([0-9]{5}[DF]$)|([DF][A-HJ-NP-Z0-9][0-9]{4}$))/,n=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-HJ-NP-Z0-9]{4}[A-HJ-NP-Z0-9挂学警港澳]{1}$/;return 7===e.length?n.test(e):8===e.length&&t.test(e)},chinese:function(e){return/^[\u4e00-\u9fa5]+$/gi.test(e)},code:function(e,t=6){return new RegExp(`^\\d{${t}}$`).test(e)},contains:function(e,t){return e.indexOf(t)>=0},date:function(e){return!!e&&(nc(e)&&(e=+e),!/Invalid|NaN/.test(new Date(e).toString()))},dateISO:function(e){return/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(e)},digits:function(e){return/^\d+$/.test(e)},email:function(e){return/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(e)},empty:oc,enOrNum:function(e){return/^[0-9a-zA-Z]*$/g.test(e)},func:sc,idCard:function(e){return/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(e)},image:function(e){const t=e.split("?")[0];return/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i.test(t)},jsonString:function(e){if("string"==typeof e)try{const t=JSON.parse(e);return!("object"!=typeof t||!t)}catch(rn){return!1}return!1},landline:function(e){return/^\d{3,4}-\d{7,8}(-\d{3,4})?$/.test(e)},letter:function(e){return/^[a-zA-Z]*$/.test(e)},mobile:function(e){return/^1([3589]\d|4[5-9]|6[1-2,4-7]|7[0-8])\d{8}$/.test(e)},number:nc,object:ic,promise:function(e){return ic(e)&&sc(e.then)&&sc(e.catch)},range:function(e,t){return e>=t[0]&&e<=t[1]},rangeLength:function(e,t){return e.length>=t[0]&&e.length<=t[1]},regExp:function(e){return e&&"[object RegExp]"===Object.prototype.toString.call(e)},string:function(e){return"string"==typeof e},url:function(e){return/^((https|http|ftp|rtsp|mms):\/\/)(([0-9a-zA-Z_!~*'().&=+$%-]+: )?[0-9a-zA-Z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-zA-Z_!~*'()-]+.)*([0-9a-zA-Z][0-9a-zA-Z-]{0,61})?[0-9a-zA-Z].[a-zA-Z]{2,6})(:[0-9]{1,4})?((\/?)|(\/[0-9a-zA-Z_!~*'().;?:@&=+$,%#-]+)+\/?)$/.test(e)},video:function(e){return/\.(mp4|mpg|mpeg|dat|asf|avi|rm|rmvb|mov|wmv|flv|mkv|m3u8)/i.test(e)}},Symbol.toStringTag,{value:"Module"}));function cc(e,t=15){return+parseFloat(Number(e).toPrecision(t))}function lc(e){const t=e.toString().split(/[eE]/),n=(t[0].split(".")[1]||"").length-+(t[1]||0);return n>0?n:0}function uc(e){if(-1===e.toString().indexOf("e"))return Number(e.toString().replace(".",""));const t=lc(e);return t>0?cc(Number(e)*Math.pow(10,t)):Number(e)}function dc(e){(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)&&I("warn","at uni_modules/uv-ui-tools/libs/function/digit.js:45",`${e} 超出了精度限制，结果可能不正确`)}function pc(e,t){const[n,o,...a]=e;let i=t(n,o);return a.forEach((e=>{i=t(i,e)})),i}function hc(...e){if(e.length>2)return pc(e,hc);const[t,n]=e,o=uc(t),a=uc(n),i=lc(t)+lc(n),s=o*a;return dc(s),s/Math.pow(10,i)}function gc(...e){if(e.length>2)return pc(e,gc);const[t,n]=e,o=uc(t),a=uc(n);return dc(o),dc(a),hc(o/a,cc(Math.pow(10,lc(n)-lc(t))))}function mc(e=void 0){let t=this.$parent;for(;t;){if(!t.$options||t.$options.name===e)return t;t=t.$parent}return!1}function fc(e,t=new WeakMap){if(null===e||"object"!=typeof e)return e;if(t.has(e))return t.get(e);let n;if(e instanceof Date)n=new Date(e.getTime());else if(e instanceof RegExp)n=new RegExp(e);else if(e instanceof Map)n=new Map(Array.from(e,(([e,n])=>[e,fc(n,t)])));else if(e instanceof Set)n=new Set(Array.from(e,(e=>fc(e,t))));else if(Array.isArray(e))n=e.map((e=>fc(e,t)));else if("[object Object]"===Object.prototype.toString.call(e)){n=Object.create(Object.getPrototypeOf(e)),t.set(e,n);for(const[o,a]of Object.entries(e))n[o]=fc(a,t)}else n=Object.assign({},e);return t.set(e,n),n}function vc(e={},t={}){if("object"!=typeof(e=fc(e))||null===e||"object"!=typeof t||null===t)return e;const n=Array.isArray(e)?e.slice():Object.assign({},e);for(const o in t){if(!t.hasOwnProperty(o))continue;const e=t[o],a=n[o];e instanceof Date?n[o]=new Date(e):e instanceof RegExp?n[o]=new RegExp(e):e instanceof Map?n[o]=new Map(e):e instanceof Set?n[o]=new Set(e):n[o]="object"==typeof e&&null!==e?vc(a,e):e}return n}function _c(e=null,t="yyyy-mm-dd"){let n;n=e?/^\d{10}$/.test(null==e?void 0:e.toString().trim())?new Date(1e3*e):"string"==typeof e&&/^\d+$/.test(e.trim())?new Date(Number(e)):"string"==typeof e&&e.includes("-")&&!e.includes("T")?new Date(e.replace(/-/g,"/")):new Date(e):new Date;const o={y:n.getFullYear().toString(),m:(n.getMonth()+1).toString().padStart(2,"0"),d:n.getDate().toString().padStart(2,"0"),h:n.getHours().toString().padStart(2,"0"),M:n.getMinutes().toString().padStart(2,"0"),s:n.getSeconds().toString().padStart(2,"0")};for(const a in o){const[e]=new RegExp(`${a}+`).exec(t)||[];if(e){const n="y"===a&&2===e.length?2:0;t=t.replace(e,o[a].slice(n))}}return t}function yc(e,t="both"){return e=String(e),"both"==t?e.replace(/^\s+|\s+$/g,""):"left"==t?e.replace(/^\s*/,""):"right"==t?e.replace(/(\s*$)/g,""):"all"==t?e.replace(/\s+/g,""):e}function Ic(e={},t=!0,n="brackets"){const o=t?"?":"",a=[];-1==["indices","brackets","repeat","comma"].indexOf(n)&&(n="brackets");for(const i in e){const t=e[i];if(!(["",void 0,null].indexOf(t)>=0))if(t.constructor===Array)switch(n){case"indices":for(let n=0;n<t.length;n++)a.push(`${i}[${n}]=${t[n]}`);break;case"brackets":default:t.forEach((e=>{a.push(`${i}[]=${e}`)}));break;case"repeat":t.forEach((e=>{a.push(`${i}=${e}`)}));break;case"comma":let e="";t.forEach((t=>{e+=(e?",":"")+t})),a.push(`${i}=${e}`)}else a.push(`${i}=${t}`)}return a.length?o+a.join("&"):""}function Ec(){var e;const t=getCurrentPages(),n=null==(e=t[t.length-1])?void 0:e.route;return`/${n||""}`}String.prototype.padStart||(String.prototype.padStart=function(e,t=" "){if("[object String]"!==Object.prototype.toString.call(t))throw new TypeError("fillString must be String");const n=this;if(n.length>=e)return String(n);const o=e-n.length;let a=Math.ceil(o/t.length);for(;a>>=1;)t+=t,1===a&&(t+=t);return t.slice(0,o)+n});const Cc=Object.freeze(Object.defineProperty({__proto__:null,$parent:mc,addStyle:function(e,t="object"){if(oc(e)||"object"==typeof e&&"object"===t||"string"===t&&"string"==typeof e)return e;if("object"===t){const t=(e=yc(e)).split(";"),n={};for(let e=0;e<t.length;e++)if(t[e]){const o=t[e].split(":");n[yc(o[0])]=yc(o[1])}return n}let n="";for(const o in e){n+=`${o.replace(/([A-Z])/g,"-$1").toLowerCase()}:${e[o]};`}return yc(n)},addUnit:function(e="auto",t=((e=>{return null==(e=null==(t=null==uni?void 0:uni.$uv)?void 0:t.config)?void 0:e.unit;var t})()?(e=>{return null==(e=null==(t=null==uni?void 0:uni.$uv)?void 0:t.config)?void 0:e.unit;var t})():"px")){return nc(e=String(e))?`${e}${t}`:e},deepClone:fc,deepMerge:vc,error:function(e){},formValidate:function(e,t){const n=mc.call(e,"uv-form-item"),o=mc.call(e,"uv-form");n&&o&&o.validateField(n.prop,(()=>{}),t)},getDuration:function(e,t=!0){const n=parseInt(e);return t?/s$/.test(e)?e:e>30?`${e}ms`:`${e}s`:/ms$/.test(e)?n:/s$/.test(e)?n>30?n:1e3*n:n},getHistoryPage:function(e=0){const t=getCurrentPages();return t[t.length-1+e]},getProperty:function(e,t){if(e){if("string"!=typeof t||""===t)return"";if(-1!==t.indexOf(".")){const n=t.split(".");let o=e[n[0]]||{};for(let e=1;e<n.length;e++)o&&(o=o[n[e]]);return o}return e[t]}},getPx:function(e,t=!1){return nc(e)?t?`${e}px`:Number(e):/(rpx|upx)$/.test(e)?t?`${uni.upx2px(parseInt(e))}px`:Number(uni.upx2px(parseInt(e))):t?`${parseInt(e)}px`:parseInt(e)},guid:function(e=32,t=!0,n=null){const o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(n=n||o.length,e)for(let i=0;i<e;i++)a[i]=o[0|Math.random()*n];else{let e;a[8]=a[13]=a[18]=a[23]="-",a[14]="4";for(let t=0;t<36;t++)a[t]||(e=0|16*Math.random(),a[t]=o[19==t?3&e|8:e])}return t?(a.shift(),`u${a.join("")}`):a.join("")},os:function(){return uni.getSystemInfoSync().platform.toLowerCase()},padZero:function(e){return`00${e}`.slice(-2)},page:Ec,pages:function(){return getCurrentPages()},priceFormat:function(e,t=0,n=".",o=","){e=`${e}`.replace(/[^0-9+-Ee.]/g,"");const a=isFinite(+e)?+e:0,i=isFinite(+t)?Math.abs(t):0,s=void 0===o?",":o,r=void 0===n?".":n;let c="";c=(i?function(e,t){const n=Math.pow(10,t);let o=gc(Math.round(Math.abs(hc(e,n))),n);return e<0&&0!==o&&(o=hc(o,-1)),o}(a,i)+"":`${Math.round(a)}`).split(".");const l=/(-?\d+)(\d{3})/;for(;l.test(c[0]);)c[0]=c[0].replace(l,`$1${s}$2`);return(c[1]||"").length<i&&(c[1]=c[1]||"",c[1]+=new Array(i-c[1].length+1).join("0")),c.join(r)},queryParams:Ic,random:function(e,t){if(e>=0&&t>0&&t>=e){const n=t-e+1;return Math.floor(Math.random()*n+e)}return 0},randomArray:function(e=[]){return e.sort((()=>Math.random()-.5))},range:function(e=0,t=0,n=0){return Math.max(e,Math.min(t,Number(n)))},setConfig:function({props:e={},config:t={},color:n={},zIndex:o={}}){const{deepMerge:a}=uni.$uv;uni.$uv.config=a(uni.$uv.config,t),uni.$uv.props=a(uni.$uv.props,e),uni.$uv.color=a(uni.$uv.color,n),uni.$uv.zIndex=a(uni.$uv.zIndex,o)},setProperty:function(e,t,n){if(!e)return;const o=function(e,t,n){if(1!==t.length)for(;t.length>1;){const a=t[0];e[a]&&"object"==typeof e[a]||(e[a]={}),t.shift(),o(e[a],t,n)}else e[t[0]]=n};if("string"!=typeof t||""===t);else if(-1!==t.indexOf(".")){const a=t.split(".");o(e,a,n)}else e[t]=n},sleep:function(e=30){return new Promise((t=>{setTimeout((()=>{t()}),e)}))},sys:function(){return uni.getSystemInfoSync()},timeFormat:_c,timeFrom:function(e=null,t="yyyy-mm-dd"){null==e&&(e=Number(new Date)),10==(e=parseInt(e)).toString().length&&(e*=1e3);let n=(new Date).getTime()-e;n=parseInt(n/1e3);let o="";switch(!0){case n<300:o="刚刚";break;case n>=300&&n<3600:o=`${parseInt(n/60)}分钟前`;break;case n>=3600&&n<86400:o=`${parseInt(n/3600)}小时前`;break;case n>=86400&&n<2592e3:o=`${parseInt(n/86400)}天前`;break;default:o=!1===t?n>=2592e3&&n<31536e3?`${parseInt(n/2592e3)}个月前`:`${parseInt(n/31536e3)}年前`:_c(e,t)}return o},toast:function(e,t=2e3){uni.showToast({title:String(e),icon:"none",duration:t})},trim:yc,type2icon:function(e="success",t=!1){-1==["primary","info","error","warning","success"].indexOf(e)&&(e="success");let n="";switch(e){case"primary":case"info":n="info-circle";break;case"error":n="close-circle";break;case"warning":n="error-circle";break;default:n="checkmark-circle"}return t&&(n+="-fill"),n}},Symbol.toStringTag,{value:"Module"}));const kc=(new class{constructor(){this.config={type:"navigateTo",url:"",delta:1,params:{},animationType:"pop-in",animationDuration:300,intercept:!1,events:{}},this.route=this.route.bind(this)}addRootPath(e){return"/"===e[0]?e:`/${e}`}mixinParam(e,t){e=e&&this.addRootPath(e);let n="";return/.*\/.*\?.*=.*/.test(e)?(n=Ic(t,!1),e+`&${n}`):(n=Ic(t),e+n)}async route(e={},t={}){let n={};if("string"==typeof e?(n.url=this.mixinParam(e,t),n.type="navigateTo"):(n=vc(this.config,e),n.url=this.mixinParam(e.url,e.params)),n.url!==Ec())if(t.intercept&&(n.intercept=t.intercept),n.params=t,n=vc(this.config,n),"function"==typeof n.intercept){await new Promise(((e,t)=>{n.intercept(n,e)}))&&this.openPage(n)}else this.openPage(n)}openPage(e){const{url:t,type:n,delta:o,animationType:a,animationDuration:i,events:s}=e;"navigateTo"!=e.type&&"to"!=e.type||uni.navigateTo({url:t,animationType:a,animationDuration:i,events:s}),"redirectTo"!=e.type&&"redirect"!=e.type||uni.redirectTo({url:t}),"switchTab"!=e.type&&"tab"!=e.type||uni.switchTab({url:t}),"reLaunch"!=e.type&&"launch"!=e.type||uni.reLaunch({url:t}),"navigateBack"!=e.type&&"back"!=e.type||uni.navigateBack({delta:o})}}).route;let Tc,Mc=null;function Sc(e,t=500,n=!1){if(null!==Mc&&clearTimeout(Mc),n){const n=!Mc;Mc=setTimeout((()=>{Mc=null}),t),n&&"function"==typeof e&&e()}else Mc=setTimeout((()=>{"function"==typeof e&&e()}),t)}function Dc(e,t=500,n=!0){n?Tc||(Tc=!0,"function"==typeof e&&e(),setTimeout((()=>{Tc=!1}),t)):Tc||(Tc=!0,setTimeout((()=>{Tc=!1,"function"==typeof e&&e()}),t))}const bc={props:{customStyle:{type:[Object,String],default:()=>({})},customClass:{type:String,default:""},url:{type:String,default:""},linkType:{type:String,default:"navigateTo"}},data:()=>({}),onLoad(){this.$uv.getRect=this.$uvGetRect},created(){this.$uv.getRect=this.$uvGetRect},computed:{$uv(){var e,t;return{...Cc,test:rc,route:kc,debounce:Sc,throttle:Dc,unit:null==(t=null==(e=null==uni?void 0:uni.$uv)?void 0:e.config)?void 0:t.unit}},bem:()=>function(e,t,n){const o=`uv-${e}--`,a={};return t&&t.map((e=>{a[o+this[e]]=!0})),n&&n.map((e=>{this[e]?a[o+e]=this[e]:delete a[o+e]})),Object.keys(a)}},methods:{openPage(e="url"){const t=this[e];t&&uni[this.linkType]({url:t})},$uvGetRect(e,t){return new Promise((n=>{uni.createSelectorQuery().in(this)[t?"selectAll":"select"](e).boundingClientRect((e=>{t&&Array.isArray(e)&&e.length&&n(e),!t&&e&&n(e)})).exec()}))},getParentData(e=""){this.parent||(this.parent={}),this.parent=this.$uv.$parent.call(this,e),this.parent.children&&-1===this.parent.children.indexOf(this)&&this.parent.children.push(this),this.parent&&this.parentData&&Object.keys(this.parentData).map((e=>{this.parentData[e]=this.parent[e]}))},preventEvent(e){e&&"function"==typeof e.stopPropagation&&e.stopPropagation()},noop(e){this.preventEvent(e)}},onReachBottom(){uni.$emit("uvOnReachBottom")},beforeDestroy(){if(this.parent&&ac(this.parent.children)){const e=this.parent.children;e.map(((t,n)=>{t===this&&e.splice(n,1)}))}},unmounted(){if(this.parent&&ac(this.parent.children)){const e=this.parent.children;e.map(((t,n)=>{t===this&&e.splice(n,1)}))}}};const wc=L({name:"uv-toolbar",emits:["confirm","cancel"],mixins:[tc,bc,{props:{show:{type:Boolean,default:!0},showBorder:{type:Boolean,default:!1},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确认"},cancelColor:{type:String,default:"#909193"},confirmColor:{type:String,default:"#3c9cff"},title:{type:String,default:""},...null==(n=null==(t=uni.$uv)?void 0:t.props)?void 0:n.toolbar}}],methods:{cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm")}}},[["render",function(t,n,o,a,i,s){return t.show?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["uv-toolbar",{"uv-border-bottom":t.showBorder}]),onTouchmove:n[2]||(n[2]=e.withModifiers(((...e)=>t.noop&&t.noop(...e)),["stop","prevent"]))},[e.createElementVNode("view",{class:"uv-toolbar__cancel__wrapper","hover-class":"uv-hover-class"},[e.createElementVNode("text",{class:"uv-toolbar__wrapper__cancel",onClick:n[0]||(n[0]=(...e)=>s.cancel&&s.cancel(...e)),style:e.normalizeStyle({color:t.cancelColor})},e.toDisplayString(t.cancelText),5)]),t.title?(e.openBlock(),e.createElementBlock("text",{key:0,class:"uv-toolbar__title uv-line-1"},e.toDisplayString(t.title),1)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"uv-toolbar__confirm__wrapper","hover-class":"uv-hover-class"},[e.createElementVNode("text",{class:"uv-toolbar__wrapper__confirm",onClick:n[1]||(n[1]=(...e)=>s.confirm&&s.confirm(...e)),style:e.normalizeStyle({color:t.confirmColor})},e.toDisplayString(t.confirmText),5)])],34)):e.createCommentVNode("",!0)}],["__scopeId","data-v-2f73cab8"]]);function Nc(e,t=!0){if((e=String(e).toLowerCase())&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){let t="#";for(let n=1;n<4;n+=1)t+=e.slice(n,n+1).concat(e.slice(n,n+1));e=t}const n=[];for(let t=1;t<7;t+=2)n.push(parseInt(`0x${e.slice(t,t+2)}`));return t?`rgb(${n[0]},${n[1]},${n[2]})`:n}if(/^(rgb|RGB)/.test(e)){return e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(",").map((e=>Number(e)))}return e}function Lc(e){const t=e;if(/^(rgb|RGB)/.test(t)){const e=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(",");let n="#";for(let t=0;t<e.length;t++){let o=Number(e[t]).toString(16);o=1==String(o).length?`0${o}`:o,"0"===o&&(o+=o),n+=o}return 7!==n.length&&(n=t),n}if(!/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t))return t;{const e=t.replace(/#/,"").split("");if(6===e.length)return t;if(3===e.length){let t="#";for(let n=0;n<e.length;n+=1)t+=e[n]+e[n];return t}}}const Rc=L({name:"uv-loading-icon",mixins:[tc,bc,{props:{show:{type:Boolean,default:!0},color:{type:String,default:"#909193"},textColor:{type:String,default:"#909193"},vertical:{type:Boolean,default:!1},mode:{type:String,default:"spinner"},size:{type:[String,Number],default:24},textSize:{type:[String,Number],default:15},textStyle:{type:Object,default:()=>({})},text:{type:[String,Number],default:""},timingFunction:{type:String,default:"linear"},duration:{type:[String,Number],default:1200},inactiveColor:{type:String,default:""},...null==(a=null==(o=uni.$uv)?void 0:o.props)?void 0:a.loadingIcon}}],data:()=>({array12:Array.from({length:12}),aniAngel:360,webviewHide:!1,loading:!1}),computed:{otherBorderColor(){const e=function(e="rgb(0, 0, 0)",t="rgb(255, 255, 255)",n=10){const o=Nc(e,!1),a=o[0],i=o[1],s=o[2],r=Nc(t,!1),c=(r[0]-a)/n,l=(r[1]-i)/n,u=(r[2]-s)/n,d=[];for(let p=0;p<n;p++){let o=Lc(`rgb(${Math.round(c*p+a)},${Math.round(l*p+i)},${Math.round(u*p+s)})`);0===p&&(o=Lc(e)),p===n-1&&(o=Lc(t)),d.push(o)}return d}(this.color,"#ffffff",100)[80];return"circle"===this.mode?this.inactiveColor?this.inactiveColor:e:"transparent"}},watch:{show(e){}},mounted(){this.init()},methods:{init(){setTimeout((()=>{this.show&&this.addEventListenerToWebview()}),20)},addEventListenerToWebview(){const e=getCurrentPages(),t=e[e.length-1].$getAppWebview();t.addEventListener("hide",(()=>{this.webviewHide=!0})),t.addEventListener("show",(()=>{this.webviewHide=!1}))}}},[["render",function(t,n,o,a,i,s){return t.show?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["uv-loading-icon",[t.vertical&&"uv-loading-icon--vertical"]]),style:e.normalizeStyle([t.$uv.addStyle(t.customStyle)])},[i.webviewHide?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["uv-loading-icon__spinner",[`uv-loading-icon__spinner--${t.mode}`]]),ref:"ani",style:e.normalizeStyle({color:t.color,width:t.$uv.addUnit(t.size),height:t.$uv.addUnit(t.size),borderTopColor:t.color,borderBottomColor:s.otherBorderColor,borderLeftColor:s.otherBorderColor,borderRightColor:s.otherBorderColor,"animation-duration":`${t.duration}ms`,"animation-timing-function":"semicircle"===t.mode||"circle"===t.mode?t.timingFunction:""})},["spinner"===t.mode?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(i.array12,((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,class:"uv-loading-icon__dot"})))),128)):e.createCommentVNode("",!0)],6)),t.text?(e.openBlock(),e.createElementBlock("text",{key:1,class:"uv-loading-icon__text",style:e.normalizeStyle([{fontSize:t.$uv.addUnit(t.textSize),color:t.textColor},t.$uv.addStyle(t.textStyle)])},e.toDisplayString(t.text),5)):e.createCommentVNode("",!0)],6)):e.createCommentVNode("",!0)}],["__scopeId","data-v-3eb40c0b"]]);class Ac{constructor(e,t){this.options=e,this.animation=uni.createAnimation({...e}),this.currentStepAnimates={},this.next=0,this.$=t}_nvuePushAnimates(e,t){let n=this.currentStepAnimates[this.next],o={};if(o=n||{styles:{},config:{}},Oc.includes(e)){o.styles.transform||(o.styles.transform="");let n="";"rotate"===e&&(n="deg"),o.styles.transform+=`${e}(${t+n}) `}else o.styles[e]=`${t}`;this.currentStepAnimates[this.next]=o}_animateRun(e={},t={}){let n=this.$.$refs.ani.ref;if(n)return new Promise(((o,a)=>{nvueAnimation.transition(n,{styles:e,...t},(e=>{o()}))}))}_nvueNextAnimate(e,t=0,n){let o=e[t];if(o){let{styles:a,config:i}=o;this._animateRun(a,i).then((()=>{t+=1,this._nvueNextAnimate(e,t,n)}))}else this.currentStepAnimates={},"function"==typeof n&&n(),this.isEnd=!0}step(e={}){return this.animation.step(e),this}run(e){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof e&&e()}),this.$.durationTime)}}const Oc=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function Uc(e,t){if(t)return clearTimeout(t.timer),new Ac(e,t)}Oc.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((e=>{Ac.prototype[e]=function(...t){return this.animation[e](...t),this}}));const Pc=L({name:"uv-transition",mixins:[tc,bc],emits:["click","change"],props:{show:{type:Boolean,default:!1},mode:{type:[Array,String,null],default:()=>"fade"},duration:{type:[String,Number],default:300},timingFunction:{type:String,default:"ease-out"},customClass:{type:String,default:""},cellChild:{type:Boolean,default:!1}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(e){e?this.open():this.isShow&&this.close()},immediate:!0}},computed:{transformStyles(){const e={transform:this.transform,opacity:this.opacity,...this.$uv.addStyle(this.customStyle),"transition-duration":this.duration/1e3+"s"};return this.$uv.addStyle(e,"string")}},created(){this.config={duration:this.duration,timingFunction:this.timingFunction,transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(e={}){e.duration&&(this.durationTime=e.duration),this.animation=Uc(Object.assign(this.config,e),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(e,t={}){if(this.animation){for(let t in e)try{"object"==typeof e[t]?this.animation[t](...e[t]):this.animation[t](e[t])}catch(rn){I("error","at uni_modules/uv-transition/components/uv-transition/uv-transition.vue:166",`方法 ${t} 不存在`)}return this.animation.step(t),this}},run(e){this.animation&&this.animation.run(e)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:e,transform:t}=this.styleInit(!1);void 0!==e&&(this.opacity=e),this.transform=t,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=Uc(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})}),20)}))},close(e){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:e,transform:t}=this.styleInit(!1);this.opacity=e||1,this.transform=t,this.$emit("change",{detail:this.isShow})}))},styleInit(e){let t={transform:""},n=(e,n)=>{"fade"===n?t.opacity=this.animationType(e)[n]:t.transform+=this.animationType(e)[n]+" "};return"string"==typeof this.mode?n(e,this.mode):this.mode.forEach((t=>{n(e,t)})),t},tranfromInit(e){let t=(e,t)=>{let n=null;"fade"===t?n=e?0:1:(n=e?"-100%":"0","zoom-in"===t&&(n=e?.8:1),"zoom-out"===t&&(n=e?1.2:1),"slide-right"===t&&(n=e?"100%":"0"),"slide-bottom"===t&&(n=e?"100%":"0")),this.animation[this.animationMode()[t]](n)};return"string"==typeof this.mode?t(e,this.mode):this.mode.forEach((n=>{t(e,n)})),this.animation},animationType:e=>({fade:e?1:0,"slide-top":`translateY(${e?"0":"-100%"})`,"slide-right":`translateX(${e?"0":"100%"})`,"slide-bottom":`translateY(${e?"0":"100%"})`,"slide-left":`translateX(${e?"0":"-100%"})`,"zoom-in":`scaleX(${e?1:.8}) scaleY(${e?1:.8})`,"zoom-out":`scaleX(${e?1:1.2}) scaleY(${e?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:e=>e.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,n,o,a,i,s){return i.isShow?(e.openBlock(),e.createElementBlock("view",{key:0,ref:"ani",animation:i.animationData,class:e.normalizeClass(o.customClass),style:e.normalizeStyle(s.transformStyles),onClick:n[0]||(n[0]=(...e)=>s.onClick&&s.onClick(...e))},[e.renderSlot(t.$slots,"default")],14,["animation"])):e.createCommentVNode("",!0)}]]);const Gc=L({name:"uv-overlay",emits:["click"],mixins:[tc,bc,{props:{show:{type:Boolean,default:!1},zIndex:{type:[String,Number],default:10070},duration:{type:[String,Number],default:300},opacity:{type:[String,Number],default:.5},...null==(s=null==(i=uni.$uv)?void 0:i.props)?void 0:s.overlay}}],watch:{show(e){}},computed:{overlayStyle(){const e={position:"fixed",top:0,left:0,right:0,zIndex:this.zIndex,bottom:0,"background-color":`rgba(0, 0, 0, ${this.opacity})`};return this.$uv.deepMerge(e,this.$uv.addStyle(this.customStyle))}},methods:{clickHandler(){this.$emit("click")},clear(){}}},[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uv-transition"),Pc);return e.openBlock(),e.createBlock(r,{show:t.show,mode:"fade","custom-class":"uv-overlay",duration:t.duration,"custom-style":s.overlayStyle,onClick:s.clickHandler,onTouchmove:e.withModifiers(s.clear,["stop","prevent"])},{default:e.withCtx((()=>[e.renderSlot(t.$slots,"default",{},void 0,!0)])),_:3},8,["show","duration","custom-style","onClick","onTouchmove"])}],["__scopeId","data-v-65481522"]]);const xc=L({name:"uv-status-bar",mixins:[tc,bc,{props:{bgColor:{type:String,default:"transparent"}}}],data:()=>({}),computed:{style(){const e={};return e.height=this.$uv.addUnit(this.$uv.sys().statusBarHeight,"px"),this.bgColor&&(this.bgColor.indexOf("gradient")>-1?e.backgroundImage=this.bgColor:e.background=this.bgColor),this.$uv.deepMerge(e,this.$uv.addStyle(this.customStyle))}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{style:e.normalizeStyle([s.style]),class:"uv-status-bar"},[e.renderSlot(t.$slots,"default",{},void 0,!0)],4)}],["__scopeId","data-v-c48287dc"]]);const Bc=L({name:"uv-safe-bottom",mixins:[tc,bc],data:()=>({safeAreaBottomHeight:0,isNvue:!1}),computed:{style(){return this.$uv.deepMerge({},this.$uv.addStyle(this.customStyle))}},mounted(){}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uv-safe-bottom",[!i.isNvue&&"uv-safe-area-inset-bottom"]]),style:e.normalizeStyle([s.style])},null,6)}],["__scopeId","data-v-71c4b1ce"]]),Vc={"uvicon-level":"e68f","uvicon-checkbox-mark":"e659","uvicon-folder":"e694","uvicon-movie":"e67c","uvicon-star-fill":"e61e","uvicon-star":"e618","uvicon-phone-fill":"e6ac","uvicon-phone":"e6ba","uvicon-apple-fill":"e635","uvicon-backspace":"e64d","uvicon-attach":"e640","uvicon-empty-data":"e671","uvicon-empty-address":"e68a","uvicon-empty-favor":"e662","uvicon-empty-car":"e657","uvicon-empty-order":"e66b","uvicon-empty-list":"e672","uvicon-empty-search":"e677","uvicon-empty-permission":"e67d","uvicon-empty-news":"e67e","uvicon-empty-history":"e685","uvicon-empty-coupon":"e69b","uvicon-empty-page":"e60e","uvicon-empty-wifi-off":"e6cc","uvicon-reload":"e627","uvicon-order":"e695","uvicon-server-man":"e601","uvicon-search":"e632","uvicon-more-dot-fill":"e66f","uvicon-scan":"e631","uvicon-map":"e665","uvicon-map-fill":"e6a8","uvicon-tags":"e621","uvicon-tags-fill":"e613","uvicon-eye":"e664","uvicon-eye-fill":"e697","uvicon-eye-off":"e69c","uvicon-eye-off-outline":"e688","uvicon-mic":"e66d","uvicon-mic-off":"e691","uvicon-calendar":"e65c","uvicon-trash":"e623","uvicon-trash-fill":"e6ce","uvicon-play-left":"e6bf","uvicon-play-right":"e6b3","uvicon-minus":"e614","uvicon-plus":"e625","uvicon-info-circle":"e69f","uvicon-info-circle-fill":"e6a7","uvicon-question-circle":"e622","uvicon-question-circle-fill":"e6bc","uvicon-close":"e65a","uvicon-checkmark":"e64a","uvicon-checkmark-circle":"e643","uvicon-checkmark-circle-fill":"e668","uvicon-setting":"e602","uvicon-setting-fill":"e6d0","uvicon-heart":"e6a2","uvicon-heart-fill":"e68b","uvicon-camera":"e642","uvicon-camera-fill":"e650","uvicon-more-circle":"e69e","uvicon-more-circle-fill":"e684","uvicon-chat":"e656","uvicon-chat-fill":"e63f","uvicon-bag":"e647","uvicon-error-circle":"e66e","uvicon-error-circle-fill":"e655","uvicon-close-circle":"e64e","uvicon-close-circle-fill":"e666","uvicon-share":"e629","uvicon-share-fill":"e6bb","uvicon-share-square":"e6c4","uvicon-shopping-cart":"e6cb","uvicon-shopping-cart-fill":"e630","uvicon-bell":"e651","uvicon-bell-fill":"e604","uvicon-list":"e690","uvicon-list-dot":"e6a9","uvicon-zhifubao-circle-fill":"e617","uvicon-weixin-circle-fill":"e6cd","uvicon-weixin-fill":"e620","uvicon-qq-fill":"e608","uvicon-qq-circle-fill":"e6b9","uvicon-moments-circel-fill":"e6c2","uvicon-moments":"e6a0","uvicon-car":"e64f","uvicon-car-fill":"e648","uvicon-warning-fill":"e6c7","uvicon-warning":"e6c1","uvicon-clock-fill":"e64b","uvicon-clock":"e66c","uvicon-edit-pen":"e65d","uvicon-edit-pen-fill":"e679","uvicon-email":"e673","uvicon-email-fill":"e683","uvicon-minus-circle":"e6a5","uvicon-plus-circle":"e603","uvicon-plus-circle-fill":"e611","uvicon-file-text":"e687","uvicon-file-text-fill":"e67f","uvicon-pushpin":"e6d1","uvicon-pushpin-fill":"e6b6","uvicon-grid":"e68c","uvicon-grid-fill":"e698","uvicon-play-circle":"e6af","uvicon-play-circle-fill":"e62a","uvicon-pause-circle-fill":"e60c","uvicon-pause":"e61c","uvicon-pause-circle":"e696","uvicon-gift-fill":"e6b0","uvicon-gift":"e680","uvicon-kefu-ermai":"e660","uvicon-server-fill":"e610","uvicon-coupon-fill":"e64c","uvicon-coupon":"e65f","uvicon-integral":"e693","uvicon-integral-fill":"e6b1","uvicon-home-fill":"e68e","uvicon-home":"e67b","uvicon-account":"e63a","uvicon-account-fill":"e653","uvicon-thumb-down-fill":"e628","uvicon-thumb-down":"e60a","uvicon-thumb-up":"e612","uvicon-thumb-up-fill":"e62c","uvicon-lock-fill":"e6a6","uvicon-lock-open":"e68d","uvicon-lock-opened-fill":"e6a1","uvicon-lock":"e69d","uvicon-red-packet":"e6c3","uvicon-photo-fill":"e6b4","uvicon-photo":"e60d","uvicon-volume-off-fill":"e6c8","uvicon-volume-off":"e6bd","uvicon-volume-fill":"e624","uvicon-volume":"e605","uvicon-download":"e670","uvicon-arrow-up-fill":"e636","uvicon-arrow-down-fill":"e638","uvicon-play-left-fill":"e6ae","uvicon-play-right-fill":"e6ad","uvicon-arrow-downward":"e634","uvicon-arrow-leftward":"e63b","uvicon-arrow-rightward":"e644","uvicon-arrow-upward":"e641","uvicon-arrow-down":"e63e","uvicon-arrow-right":"e63c","uvicon-arrow-left":"e646","uvicon-arrow-up":"e633","uvicon-skip-back-left":"e6c5","uvicon-skip-forward-right":"e61f","uvicon-arrow-left-double":"e637","uvicon-man":"e675","uvicon-woman":"e626","uvicon-en":"e6b8","uvicon-twitte":"e607","uvicon-twitter-circle-fill":"e6cf"},Fc={name:"uv-icon",emits:["click"],mixins:[tc,bc,{props:{name:{type:String,default:""},color:{type:String,default:"#606266"},size:{type:[String,Number],default:"16px"},bold:{type:Boolean,default:!1},index:{type:[String,Number],default:null},hoverClass:{type:String,default:""},customPrefix:{type:String,default:"uvicon"},label:{type:[String,Number],default:""},labelPos:{type:String,default:"right"},labelSize:{type:[String,Number],default:"15px"},labelColor:{type:String,default:"#606266"},space:{type:[String,Number],default:"3px"},imgMode:{type:String,default:"aspectFit"},width:{type:[String,Number],default:""},height:{type:[String,Number],default:""},top:{type:[String,Number],default:0},stop:{type:Boolean,default:!1},...null==(c=null==(r=uni.$uv)?void 0:r.props)?void 0:c.icon}}],data:()=>({colorType:["primary","success","info","error","warning"]}),computed:{uClasses(){let e=[];return e.push(this.customPrefix),e.push(this.customPrefix+"-"+this.name),this.color&&this.colorType.includes(this.color)&&e.push("uv-icon__icon--"+this.color),e},iconStyle(){let e={};return e={fontSize:this.$uv.addUnit(this.size),lineHeight:this.$uv.addUnit(this.size),fontWeight:this.bold?"bold":"normal",top:this.$uv.addUnit(this.top)},this.color&&!this.colorType.includes(this.color)&&(e.color=this.color),e},isImg(){const e=this.name.indexOf("data:")>-1&&this.name.indexOf("base64")>-1;return-1!==this.name.indexOf("/")||e},imgStyle(){let e={};return e.width=this.width?this.$uv.addUnit(this.width):this.$uv.addUnit(this.size),e.height=this.height?this.$uv.addUnit(this.height):this.$uv.addUnit(this.size),e},icon(){const e=Vc["uvicon-"+this.name];return e?unescape(`%u${e}`):["uvicon"].indexOf(this.customPrefix)>-1?this.name:""}},methods:{clickHandler(e){this.$emit("click",this.index),this.stop&&this.preventEvent(e)}}};const Hc=L(Fc,[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uv-icon",["uv-icon--"+t.labelPos]]),onClick:n[0]||(n[0]=(...e)=>s.clickHandler&&s.clickHandler(...e))},[s.isImg?(e.openBlock(),e.createElementBlock("image",{key:0,class:"uv-icon__img",src:t.name,mode:t.imgMode,style:e.normalizeStyle([s.imgStyle,t.$uv.addStyle(t.customStyle)])},null,12,["src","mode"])):(e.openBlock(),e.createElementBlock("text",{key:1,class:e.normalizeClass(["uv-icon__icon",s.uClasses]),style:e.normalizeStyle([s.iconStyle,t.$uv.addStyle(t.customStyle)]),"hover-class":t.hoverClass},e.toDisplayString(s.icon),15,["hover-class"])),""!==t.label?(e.openBlock(),e.createElementBlock("text",{key:2,class:"uv-icon__label",style:e.normalizeStyle({color:t.labelColor,fontSize:t.$uv.addUnit(t.labelSize),marginLeft:"right"==t.labelPos?t.$uv.addUnit(t.space):0,marginTop:"bottom"==t.labelPos?t.$uv.addUnit(t.space):0,marginRight:"left"==t.labelPos?t.$uv.addUnit(t.space):0,marginBottom:"top"==t.labelPos?t.$uv.addUnit(t.space):0})},e.toDisplayString(t.label),5)):e.createCommentVNode("",!0)],2)}],["__scopeId","data-v-eab170a5"]]),jc={name:"uv-popup",components:{},mixins:[tc,bc],emits:["change","maskClick"],props:{mode:{type:String,default:"center"},duration:{type:[String,Number],default:300},zIndex:{type:[String,Number],default:10075},bgColor:{type:String,default:"#ffffff"},safeArea:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0},overlayOpacity:{type:[Number,String],default:.4},overlayStyle:{type:[Object,String],default:""},safeAreaInsetBottom:{type:Boolean,default:!0},safeAreaInsetTop:{type:Boolean,default:!1},closeable:{type:Boolean,default:!1},closeIconPos:{type:String,default:"top-right"},zoom:{type:Boolean,default:!0},round:{type:[Number,String],default:0},...null==(u=null==(l=uni.$uv)?void 0:l.props)?void 0:u.popup},watch:{type:{handler:function(e){this.config[e]&&this[this.config[e]](!0)},immediate:!0},isDesktop:{handler:function(e){this.config[e]&&this[this.config[this.mode]](!0)},immediate:!0},showPopup(e){}},data(){return{ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},transitionStyle:{position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupClass:this.isDesktop?"fixforpc-top":"top",direction:""}},computed:{isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.bgColor||"none"===this.bgColor||this.$uv.getPx(this.round)>0?"transparent":this.bgColor},contentStyle(){const e={};if(this.bgColor&&(e.backgroundColor=this.bg),this.round){const t=this.$uv.addUnit(this.round),n=this.direction?this.direction:this.mode;e.backgroundColor=this.bgColor,"top"===n?(e.borderBottomLeftRadius=t,e.borderBottomRightRadius=t):"bottom"===n?(e.borderTopLeftRadius=t,e.borderTopRightRadius=t):"center"===n&&(e.borderRadius=t)}return this.$uv.deepMerge(e,this.$uv.addStyle(this.customStyle))}},unmounted(){this.setH5Visible()},created(){this.messageChild=null,this.clearPropagation=!1},methods:{setH5Visible(){},closeMask(){this.maskShow=!1},clear(e){e.stopPropagation(),this.clearPropagation=!0},open(e){if(this.showPopup)return;if(e&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(e)?this.direction=e:e=this.mode,!this.config[e])return this.$uv.error(`缺少类型：${e}`);this[this.config[e]](),this.$emit("change",{show:!0,type:e})},close(e){this.showTrans=!1,this.$emit("change",{show:!1,type:this.mode}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.closeOnClickOverlay&&this.close())},top(e){this.popupClass=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transitionStyle={position:"fixed",zIndex:this.zIndex,left:0,right:0,backgroundColor:this.bg},e||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.messageChild&&"message"===this.mode&&this.messageChild.timerClose()})))},bottom(e){this.popupClass="bottom",this.ani=["slide-bottom"],this.transitionStyle={position:"fixed",zIndex:this.zIndex,left:0,right:0,bottom:0,backgroundColor:this.bg},e||(this.showPopup=!0,this.showTrans=!0)},center(e){this.popupClass="center",this.ani=this.zoom?["zoom-in","fade"]:["fade"],this.transitionStyle={position:"fixed",zIndex:this.zIndex,display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center"},e||(this.showPopup=!0,this.showTrans=!0)},left(e){this.popupClass="left",this.ani=["slide-left"],this.transitionStyle={position:"fixed",zIndex:this.zIndex,left:0,bottom:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)},right(e){this.popupClass="right",this.ani=["slide-right"],this.transitionStyle={position:"fixed",zIndex:this.zIndex,bottom:0,right:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)}}};const qc=L(jc,[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uv-overlay"),Gc),c=E(e.resolveDynamicComponent("uv-status-bar"),xc),l=E(e.resolveDynamicComponent("uv-safe-bottom"),Bc),u=E(e.resolveDynamicComponent("uv-icon"),Hc),d=E(e.resolveDynamicComponent("uv-transition"),Pc);return i.showPopup?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["uv-popup",[i.popupClass,s.isDesktop?"fixforpc-z-index":""]]),style:e.normalizeStyle([{zIndex:o.zIndex}])},[e.createElementVNode("view",{onTouchstart:n[2]||(n[2]=(...e)=>s.touchstart&&s.touchstart(...e))},[i.maskShow&&o.overlay?(e.openBlock(),e.createBlock(r,{key:"1",show:i.showTrans,duration:o.duration,"custom-style":o.overlayStyle,opacity:o.overlayOpacity,zIndex:o.zIndex,onClick:s.onTap},null,8,["show","duration","custom-style","opacity","zIndex","onClick"])):e.createCommentVNode("",!0),e.createVNode(d,{key:"2",mode:i.ani,name:"content","custom-style":i.transitionStyle,duration:o.duration,show:i.showTrans,onClick:s.onTap},{default:e.withCtx((()=>[e.createElementVNode("view",{class:e.normalizeClass(["uv-popup__content",[i.popupClass]]),style:e.normalizeStyle([s.contentStyle]),onClick:n[1]||(n[1]=(...e)=>s.clear&&s.clear(...e))},[o.safeAreaInsetTop?(e.openBlock(),e.createBlock(c,{key:0})):e.createCommentVNode("",!0),e.renderSlot(t.$slots,"default",{},void 0,!0),o.safeAreaInsetBottom?(e.openBlock(),e.createBlock(l,{key:1})):e.createCommentVNode("",!0),o.closeable?(e.openBlock(),e.createElementBlock("view",{key:2,onClick:n[0]||(n[0]=e.withModifiers(((...e)=>s.close&&s.close(...e)),["stop"])),class:e.normalizeClass(["uv-popup__content__close",["uv-popup__content__close--"+o.closeIconPos]]),"hover-class":"uv-popup__content__close--hover","hover-stay-time":"150"},[e.createVNode(u,{name:"close",color:"#909399",size:"18",bold:""})],2)):e.createCommentVNode("",!0)],6)])),_:3},8,["mode","custom-style","duration","show","onClick"])],32)],6)):e.createCommentVNode("",!0)}],["__scopeId","data-v-504e2131"]]),zc={name:"uv-picker",emits:["confirm","cancel","close","change"],mixins:[tc,bc,{props:{showToolbar:{type:Boolean,default:!0},title:{type:String,default:""},round:{type:[String,Number],default:0},columns:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},itemHeight:{type:[String,Number],default:44},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确定"},cancelColor:{type:String,default:"#909193"},confirmColor:{type:String,default:"#3c9cff"},color:{type:String,default:""},activeColor:{type:String,default:""},visibleItemCount:{type:[String,Number],default:5},keyName:{type:String,default:"text"},closeOnClickOverlay:{type:Boolean,default:!0},closeOnClickConfirm:{type:Boolean,default:!0},defaultIndex:{type:Array,default:()=>[]},immediateChange:{type:Boolean,default:!0},...null==(p=null==(d=uni.$uv)?void 0:d.props)?void 0:p.picker}}],computed:{textStyle(){return(e,t)=>{const n={display:"block"};return this.color&&(n.color=this.color),this.activeColor&&t===this.innerIndex[e]&&(n.color=this.activeColor),n}}},data:()=>({lastIndex:[],innerIndex:[],innerColumns:[],columnIndex:0}),watch:{defaultIndex:{immediate:!0,handler(e){this.setIndexs(e,!0)}},columns:{deep:!0,immediate:!0,handler(e){this.setColumns(e)}}},methods:{open(){this.$refs.pickerPopup.open()},close(){this.$refs.pickerPopup.close()},popupChange(e){e.show||this.$emit("close")},getItemText(e){return this.$uv.test.object(e)?e[this.keyName]:e},cancel(){this.$emit("cancel"),this.close()},confirm(){this.$emit("confirm",this.$uv.deepClone({indexs:this.innerIndex,value:this.innerColumns.map(((e,t)=>e[this.innerIndex[t]])),values:this.innerColumns})),this.closeOnClickConfirm&&this.close()},changeHandler(e){const{value:t}=e.detail;let n=0,o=0;for(let i=0;i<t.length;i++){let e=t[i];if(e!==(this.lastIndex[i]||0)){o=i,n=e;break}}this.columnIndex=o;const a=this.innerColumns;this.setLastIndex(t),this.setIndexs(t),this.$emit("change",{value:this.innerColumns.map(((e,n)=>e[t[n]])),index:n,indexs:t,values:a,columnIndex:o})},setIndexs(e,t){this.innerIndex=this.$uv.deepClone(e),t&&this.setLastIndex(e)},setLastIndex(e){this.lastIndex=this.$uv.deepClone(e)},setColumnValues(e,t){this.innerColumns.splice(e,1,t);let n=this.$uv.deepClone(this.innerIndex);for(let o=0;o<this.innerColumns.length;o++)o>this.columnIndex&&(n[o]=0);this.setIndexs(n)},getColumnValues(e){return(async()=>{await this.$uv.sleep()})(),this.innerColumns[e]},setColumns(e){this.innerColumns=this.$uv.deepClone(e),0===this.innerIndex.length&&(this.innerIndex=new Array(e.length).fill(0))},getIndexs(){return this.innerIndex},getValues(){return(async()=>{await this.$uv.sleep()})(),this.innerColumns.map(((e,t)=>e[this.innerIndex[t]]))}}};const Kc=L(zc,[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uv-toolbar"),wc),c=E(e.resolveDynamicComponent("uv-loading-icon"),Rc),l=E(e.resolveDynamicComponent("uv-popup"),qc);return e.openBlock(),e.createBlock(l,{ref:"pickerPopup",mode:"bottom",round:t.round,"close-on-click-overlay":t.closeOnClickOverlay,onChange:s.popupChange},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"uv-picker"},[t.showToolbar?(e.openBlock(),e.createBlock(r,{key:0,cancelColor:t.cancelColor,confirmColor:t.confirmColor,cancelText:t.cancelText,confirmText:t.confirmText,title:t.title,onCancel:s.cancel,onConfirm:s.confirm},null,8,["cancelColor","confirmColor","cancelText","confirmText","title","onCancel","onConfirm"])):e.createCommentVNode("",!0),e.createElementVNode("picker-view",{class:"uv-picker__view",indicatorStyle:`height: ${t.$uv.addUnit(t.itemHeight)}`,value:i.innerIndex,immediateChange:t.immediateChange,style:e.normalizeStyle({height:`${t.$uv.addUnit(t.visibleItemCount*t.itemHeight)}`}),onChange:n[0]||(n[0]=(...e)=>s.changeHandler&&s.changeHandler(...e))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.innerColumns,((n,o)=>(e.openBlock(),e.createElementBlock("picker-view-column",{key:o,class:"uv-picker__view__column"},[t.$uv.test.array(n)?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(n,((n,a)=>(e.openBlock(),e.createElementBlock("text",{class:"uv-picker__view__column__item uv-line-1",key:a,style:e.normalizeStyle([{height:t.$uv.addUnit(t.itemHeight),lineHeight:t.$uv.addUnit(t.itemHeight),fontWeight:a===i.innerIndex[o]?"bold":"normal"},s.textStyle(o,a)])},e.toDisplayString(s.getItemText(n)),5)))),128)):e.createCommentVNode("",!0)])))),128))],44,["indicatorStyle","value","immediateChange"]),t.loading?(e.openBlock(),e.createElementBlock("view",{key:1,class:"uv-picker--loading"},[e.createVNode(c,{mode:"circle"})])):e.createCommentVNode("",!0)])])),_:1},8,["round","close-on-click-overlay","onChange"])}],["__scopeId","data-v-e71dff16"]]),$c={props:{value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},show:{type:Boolean,default:!1},showToolbar:{type:Boolean,default:!0},title:{type:String,default:""},mode:{type:String,default:"datetime"},maxDate:{type:Number,default:new Date((new Date).getFullYear()+10,0,1).getTime()},minDate:{type:Number,default:new Date((new Date).getFullYear()-10,0,1).getTime()},minHour:{type:Number,default:0},maxHour:{type:Number,default:23},minMinute:{type:Number,default:0},maxMinute:{type:Number,default:59},filter:{type:[Function,null],default:null},formatter:{type:[Function,null],default:null},loading:{type:Boolean,default:!1},itemHeight:{type:[String,Number],default:44},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确认"},cancelColor:{type:String,default:"#909193"},confirmColor:{type:String,default:"#3c9cff"},visibleItemCount:{type:[String,Number],default:5},closeOnClickOverlay:{type:Boolean,default:!0},closeOnClickConfirm:{type:Boolean,default:!0},clearDate:{type:Boolean,default:!1},round:{type:[String,Number],default:0},...null==(g=null==(h=uni.$uv)?void 0:h.props)?void 0:g.datetimePicker}};var Yc,Wc,Jc=Object.getOwnPropertyNames,Xc=(Yc={uvuidayjs(e,t){!function(n,o){"object"==typeof e&&void 0!==t?t.exports=o():"function"==typeof define&&define.amd?define(o):(n="undefined"!=typeof globalThis?globalThis:n||self).dayjs=o()}(e,(function(){var e=6e4,t=36e5,n="millisecond",o="second",a="minute",i="hour",s="day",r="week",c="month",l="quarter",u="year",d="date",p="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},f=function(e,t,n){var o=String(e);return!o||o.length>=t?e:""+Array(t+1-o.length).join(n)+e},v={s:f,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),o=Math.floor(n/60),a=n%60;return(t<=0?"+":"-")+f(o,2,"0")+":"+f(a,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var o=12*(n.year()-t.year())+(n.month()-t.month()),a=t.clone().add(o,c),i=n-a<0,s=t.clone().add(o+(i?-1:1),c);return+(-(o+(n-a)/(i?a-s:s-a))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:u,w:r,d:s,D:d,h:i,m:a,s:o,ms:n,Q:l}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},_="en",y={};y[_]=m;var I=function(e){return e instanceof T},E=function e(t,n,o){var a;if(!t)return _;if("string"==typeof t){var i=t.toLowerCase();y[i]&&(a=i),n&&(y[i]=n,a=i);var s=t.split("-");if(!a&&s.length>1)return e(s[0])}else{var r=t.name;y[r]=t,a=r}return!o&&a&&(_=a),a||!o&&_},C=function(e,t){if(I(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new T(n)},k=v;k.l=E,k.i=I,k.w=function(e,t){return C(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var T=function(){function m(e){this.$L=E(e.locale,null,!0),this.parse(e)}var f=m.prototype;return f.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(k.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var o=t.match(h);if(o){var a=o[2]-1||0,i=(o[7]||"0").substring(0,3);return n?new Date(Date.UTC(o[1],a,o[3]||1,o[4]||0,o[5]||0,o[6]||0,i)):new Date(o[1],a,o[3]||1,o[4]||0,o[5]||0,o[6]||0,i)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},f.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},f.$utils=function(){return k},f.isValid=function(){return!(this.$d.toString()===p)},f.isSame=function(e,t){var n=C(e);return this.startOf(t)<=n&&n<=this.endOf(t)},f.isAfter=function(e,t){return C(e)<this.startOf(t)},f.isBefore=function(e,t){return this.endOf(t)<C(e)},f.$g=function(e,t,n){return k.u(e)?this[t]:this.set(n,e)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(e,t){var n=this,l=!!k.u(t)||t,p=k.p(e),h=function(e,t){var o=k.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return l?o:o.endOf(s)},g=function(e,t){return k.w(n.toDate()[e].apply(n.toDate("s"),(l?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},m=this.$W,f=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(p){case u:return l?h(1,0):h(31,11);case c:return l?h(1,f):h(0,f+1);case r:var y=this.$locale().weekStart||0,I=(m<y?m+7:m)-y;return h(l?v-I:v+(6-I),f);case s:case d:return g(_+"Hours",0);case i:return g(_+"Minutes",1);case a:return g(_+"Seconds",2);case o:return g(_+"Milliseconds",3);default:return this.clone()}},f.endOf=function(e){return this.startOf(e,!1)},f.$set=function(e,t){var r,l=k.p(e),p="set"+(this.$u?"UTC":""),h=(r={},r[s]=p+"Date",r[d]=p+"Date",r[c]=p+"Month",r[u]=p+"FullYear",r[i]=p+"Hours",r[a]=p+"Minutes",r[o]=p+"Seconds",r[n]=p+"Milliseconds",r)[l],g=l===s?this.$D+(t-this.$W):t;if(l===c||l===u){var m=this.clone().set(d,1);m.$d[h](g),m.init(),this.$d=m.set(d,Math.min(this.$D,m.daysInMonth())).$d}else h&&this.$d[h](g);return this.init(),this},f.set=function(e,t){return this.clone().$set(e,t)},f.get=function(e){return this[k.p(e)]()},f.add=function(n,l){var d,p=this;n=Number(n);var h=k.p(l),g=function(e){var t=C(p);return k.w(t.date(t.date()+Math.round(e*n)),p)};if(h===c)return this.set(c,this.$M+n);if(h===u)return this.set(u,this.$y+n);if(h===s)return g(1);if(h===r)return g(7);var m=(d={},d[a]=e,d[i]=t,d[o]=1e3,d)[h]||1,f=this.$d.getTime()+n*m;return k.w(f,this)},f.subtract=function(e,t){return this.add(-1*e,t)},f.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||p;var o=e||"YYYY-MM-DDTHH:mm:ssZ",a=k.z(this),i=this.$H,s=this.$m,r=this.$M,c=n.weekdays,l=n.months,u=function(e,n,a,i){return e&&(e[n]||e(t,o))||a[n].slice(0,i)},d=function(e){return k.s(i%12||12,e,"0")},h=n.meridiem||function(e,t,n){var o=e<12?"AM":"PM";return n?o.toLowerCase():o},m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:r+1,MM:k.s(r+1,2,"0"),MMM:u(n.monthsShort,r,l,3),MMMM:u(l,r),D:this.$D,DD:k.s(this.$D,2,"0"),d:String(this.$W),dd:u(n.weekdaysMin,this.$W,c,2),ddd:u(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(i),HH:k.s(i,2,"0"),h:d(1),hh:d(2),a:h(i,s,!0),A:h(i,s,!1),m:String(s),mm:k.s(s,2,"0"),s:String(this.$s),ss:k.s(this.$s,2,"0"),SSS:k.s(this.$ms,3,"0"),Z:a};return o.replace(g,(function(e,t){return t||m[e]||a.replace(":","")}))},f.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},f.diff=function(n,d,p){var h,g=k.p(d),m=C(n),f=(m.utcOffset()-this.utcOffset())*e,v=this-m,_=k.m(this,m);return _=(h={},h[u]=_/12,h[c]=_,h[l]=_/3,h[r]=(v-f)/6048e5,h[s]=(v-f)/864e5,h[i]=v/t,h[a]=v/e,h[o]=v/1e3,h)[g]||v,p?_:k.a(_)},f.daysInMonth=function(){return this.endOf(c).$D},f.$locale=function(){return y[this.$L]},f.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),o=E(e,t,!0);return o&&(n.$L=o),n},f.clone=function(){return k.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},m}(),M=T.prototype;return C.prototype=M,[["$ms",n],["$s",o],["$m",a],["$H",i],["$W",s],["$M",c],["$y",u],["$D",d]].forEach((function(e){M[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),C.extend=function(e,t){return e.$i||(e(t,T,C),e.$i=!0),C},C.locale=E,C.isDayjs=I,C.unix=function(e){return C(1e3*e)},C.en=y[_],C.Ls=y,C.p={},C}))}},function(){return Wc||(0,Yc[Jc(Yc)[0]])((Wc={exports:{}}).exports,Wc),Wc.exports});const Zc=Xc();const Qc={name:"uv-datetime-picker",emits:["close","cancel","confirm","input","change","update:modelValue"],mixins:[tc,bc,$c],data:()=>({columns:[],innerDefaultIndex:[],innerFormatter:(e,t)=>t}),watch:{propsChange(){this.$uv.sleep(100).then((e=>{this.init()}))}},computed:{propsChange(){const e=this.value||this.modelValue;return[this.mode,this.maxDate,this.minDate,this.minHour,this.maxHour,this.minMinute,this.maxMinute,this.filter,e]}},mounted(){this.init()},methods:{init(){this.getValue(),this.updateColumnValue(this.innerValue)},getValue(){const e=this.value||this.modelValue;this.innerValue=this.correctValue(e)},setFormatter(e){this.innerFormatter=e},open(){this.$refs.picker.open(),setTimeout((()=>{this.getValue(),this.updateColumnValue(this.innerValue)}),10)},close(){this.$emit("close")},cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm",{value:this.innerValue,mode:this.mode}),this.clearDate||(this.$emit("input",this.innerValue),this.$emit("update:modelValue",this.innerValue))},intercept(e,t){let n=e.match(/\d+/g);return n.length>1?(this.$uv.error("请勿在过滤或格式化函数时添加数字"),0):t&&4==n[0].length?n[0]:n[0].length>2?(this.$uv.error("请勿在过滤或格式化函数时添加数字"),0):n[0]},change(e){const{indexs:t,values:n}=e;let o="";if("time"===this.mode)o=`${this.intercept(n[0][t[0]])}:${this.intercept(n[1][t[1]])}`;else if("year"===this.mode){const e=parseInt(this.intercept(n[0][t[0]],"year"));o=Number(new Date(e,0))}else{const e=parseInt(this.intercept(n[0][t[0]],"year")),a=parseInt(this.intercept(n[1][t[1]]));let i=parseInt(n[2]?this.intercept(n[2][t[2]]):1),s=0,r=0;const c=Zc(`${e}-${a}`).daysInMonth();"year-month"===this.mode&&(i=1),i=Math.min(c,i),"datetime"===this.mode&&(s=parseInt(this.intercept(n[3][t[3]])),r=parseInt(this.intercept(n[4][t[4]]))),o=Number(new Date(e,a-1,i,s,r))}o=this.correctValue(o),this.innerValue=o,this.updateColumnValue(o),this.$emit("change",{value:o,mode:this.mode})},updateColumnValue(e){this.innerValue=e,this.updateColumns(),this.updateIndexs(e)},updateIndexs(e){let t=[];const n=this.formatter||this.innerFormatter;if("time"===this.mode){const o=e.split(":");t=[n("hour",o[0]),n("minute",o[1])]}else t=[n("year",`${Zc(e).year()}`),n("month",this.$uv.padZero(Zc(e).month()+1))],"date"===this.mode&&t.push(n("day",this.$uv.padZero(Zc(e).date()))),"datetime"===this.mode&&t.push(n("day",this.$uv.padZero(Zc(e).date())),n("hour",this.$uv.padZero(Zc(e).hour())),n("minute",this.$uv.padZero(Zc(e).minute())));const o=this.columns.map(((e,n)=>Math.max(0,e.findIndex((e=>e===t[n])))));this.$nextTick((()=>{this.$uv.sleep(100).then((e=>{this.$refs.picker.setIndexs(o,!0)}))}))},updateColumns(){const e=this.formatter||this.innerFormatter,t=this.getOriginColumns().map((t=>t.values.map((n=>e(t.type,n)))));this.columns=t},getOriginColumns(){return this.getRanges().map((({type:e,range:t})=>{let n=function(e,t){let n=-1;const o=Array(e<0?0:e);for(;++n<e;)o[n]=t(n);return o}(t[1]-t[0]+1,(n=>{let o=t[0]+n;return o="year"===e?`${o}`:this.$uv.padZero(o),o}));return this.filter&&(n=this.filter(e,n)),{type:e,values:n}}))},generateArray:(e,t)=>Array.from(new Array(t+1).keys()).slice(e),correctValue(e){const t="time"!==this.mode;if(t&&!this.$uv.test.date(e)?e=this.minDate:t||e||(e=`${this.$uv.padZero(this.minHour)}:${this.$uv.padZero(this.minMinute)}`),t)return e=Zc(e).isBefore(Zc(this.minDate))?this.minDate:e,e=Zc(e).isAfter(Zc(this.maxDate))?this.maxDate:e;{if(-1===String(e).indexOf(":"))return this.$uv.error("时间错误，请传递如12:24的格式");let[t,n]=e.split(":");return t=this.$uv.padZero(this.$uv.range(this.minHour,this.maxHour,Number(t))),n=this.$uv.padZero(this.$uv.range(this.minMinute,this.maxMinute,Number(n))),`${t}:${n}`}},getRanges(){if("time"===this.mode)return[{type:"hour",range:[this.minHour,this.maxHour]},{type:"minute",range:[this.minMinute,this.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:n,maxHour:o,maxMinute:a}=this.getBoundary("max",this.innerValue),{minYear:i,minDate:s,minMonth:r,minHour:c,minMinute:l}=this.getBoundary("min",this.innerValue),u=[{type:"year",range:[i,e]},{type:"month",range:[r,n]},{type:"day",range:[s,t]},{type:"hour",range:[c,o]},{type:"minute",range:[l,a]}];return"date"===this.mode&&u.splice(3,2),"year-month"===this.mode&&u.splice(2,3),"year"===this.mode&&u.splice(1,4),u},getBoundary(e,t){const n=new Date(t),o=new Date(this[`${e}Date`]),a=Zc(o).year();let i=1,s=1,r=0,c=0;return"max"===e&&(i=12,s=Zc(n).daysInMonth(),r=23,c=59),Zc(n).year()===a&&(i=Zc(o).month()+1,Zc(n).month()+1===i&&(s=Zc(o).date(),Zc(n).date()===s&&(r=Zc(o).hour(),Zc(n).hour()===r&&(c=Zc(o).minute())))),{[`${e}Year`]:a,[`${e}Month`]:i,[`${e}Date`]:s,[`${e}Hour`]:r,[`${e}Minute`]:c}}}};const el=L(Qc,[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uv-picker"),Kc);return e.openBlock(),e.createBlock(r,{ref:"picker",closeOnClickOverlay:t.closeOnClickOverlay,closeOnClickConfirm:t.closeOnClickConfirm,columns:i.columns,title:t.title,itemHeight:t.itemHeight,showToolbar:t.showToolbar,visibleItemCount:t.visibleItemCount,defaultIndex:i.innerDefaultIndex,cancelText:t.cancelText,confirmText:t.confirmText,cancelColor:t.cancelColor,confirmColor:t.confirmColor,round:t.round,onClose:s.close,onCancel:s.cancel,onConfirm:s.confirm,onChange:s.change},null,8,["closeOnClickOverlay","closeOnClickConfirm","columns","title","itemHeight","showToolbar","visibleItemCount","defaultIndex","cancelText","confirmText","cancelColor","confirmColor","round","onClose","onCancel","onConfirm","onChange"])}]]),tl={__name:"register",setup(t){const n=e.ref();M((()=>{n.value=getApp().globalData.top}));const o=e.ref(""),a=e.ref(""),i=e.ref(""),s=e.ref(""),r=e.ref(""),c=e.ref(""),l=e.ref("年/月/日"),u=e.ref("选择校区"),d=e.ref(0),p=e.ref([]),h=e.ref([]),g=e.ref([0,0,0]),m=e.ref("请选择班级"),f=e.ref(null),v=e.ref(!1),_=e.ref(!1),y=e.ref(null),C=e.ref(""),k=e.ref(""),T=e.ref(!0),S=e.ref(!1),D=e.ref(60);let b=null;const w=se(),N=(e,t)=>{switch(e){case"name":o.value=t.detail.value;break;case"old":a.value=t.detail.value;break;case"refe":i.value=t.detail.value;break;case"iphone":s.value=t.detail.value;break;case"captcha":r.value=t.detail.value;case"password":c.value=t.detail.value}},L=async()=>{try{const t=await(e={school_id:C.value},Y("/user/classly",e));I("log","at pages/login/register.vue:146",t),t&&t.items&&(h.value=t.items,w.setClassData(t.items))}catch(t){I("error","at pages/login/register.vue:152","获取班级数据失败",t)}var e},R=async()=>{try{const e=await Y("/user/school");e&&(p.value=e.items,w.setCampusData(e.items))}catch(e){I("error","at pages/login/register.vue:164","获取校区数据失败",e)}},A=()=>{y.value.open()},O=async()=>{const e={gender:v.value?1:0,username:o.value,age:a.value,birthday:l.value,school_id:C.value,classly_id:k.value,referee:i.value,mobile:s.value,password:c.value,captcha:r.value};try{let n=await(t=e,W("/user/register",t));I("log","at pages/login/register.vue:189",n),1===n.code?(uni.showToast({title:n.msg,icon:"success",duration:2e3}),uni.navigateTo({url:"/pages/login/login"})):uni.showToast({title:n.msg,icon:"error",duration:2e3})}catch(n){}var t},U=e=>{d.value=e.detail.value,d.value>=0&&d.value<p.value.length?(u.value=p.value[d.value].title,C.value=p.value[d.value].id,I("log","at pages/login/register.vue:219","选择的校区 ID:",C.value),T.value=!1,L()):I("warn","at pages/login/register.vue:225","选择的索引超出范围:",d.value)},P=e=>{"男"===e?(v.value=!0,_.value=!1):(v.value=!1,_.value=!0)},G=e=>{g.value=e.detail.value,isNaN(g.value)||0===g.value.length?(m.value=h.value[0].title,k.value=h.value[0].id):(m.value=h.value[g.value].title,k.value=h.value[g.value].id)},x=e=>{const t=new Date(e.value),n=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;l.value=n,f.value=t.toISOString()},B=async()=>{if(!/^[1][3-9][0-9]{9}$/.test(s.value))return showToast("手机号格式不正确");try{const e=await J({mobile:s.value,event:"register"});I("log","at pages/login/register.vue:276",e),1===e.code?(S.value=!0,V(),uni.showToast({title:e.msg||"验证码发送成功",icon:"success",duration:2e3})):uni.showToast({title:e.msg||"发送验证码失败，请重试",icon:"none",duration:2e3})}catch(e){uni.showToast({title:"发送验证码失败，请重试",icon:"none",duration:2e3}),I("error","at pages/login/register.vue:299","发送验证码错误:",e)}finally{uni.hideLoading()}},V=()=>{D.value=60,clearInterval(b),b=setInterval((()=>{D.value--,D.value<=0&&(clearInterval(b),S.value=!1)}),1e3)};return e.onMounted((async()=>{await R()})),(t,o)=>{const a=E(e.resolveDynamicComponent("uv-datetime-picker"),el);return e.openBlock(),e.createElementBlock("view",null,[e.createVNode(a,{ref_key:"datetimePicker",ref:y,modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value=e),mode:"date",minDate:946695809e3,onConfirm:x},null,8,["modelValue"]),e.createElementVNode("view",{style:{height:"500rpx"}}),e.createElementVNode("view",{style:e.normalizeStyle("height:"+(n.value+5)+"px;")},null,4),e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"textTitle"},[e.createElementVNode("view",{class:"title1"}," 欢迎来到泽曦书画 "),e.createElementVNode("view",{class:"title2"}," 请选择性别年龄，校区班级推荐人 ")]),e.createElementVNode("view",{style:{"margin-top":"24rpx"},class:"textlogin"},[e.createElementVNode("view",{class:"img1",onClick:o[1]||(o[1]=e=>P("男"))},[v.value?(e.openBlock(),e.createElementBlock("image",{key:0,src:"/static/img/boy1.png",alt:""})):(e.openBlock(),e.createElementBlock("image",{key:1,src:"/static/img/boy.png",alt:""})),e.createElementVNode("view",{class:"imgtext1"}," 男 ")]),e.createElementVNode("view",{class:"img2",onClick:o[2]||(o[2]=e=>P("女"))},[_.value?(e.openBlock(),e.createElementBlock("image",{key:0,src:"/static/img/girl1.png",alt:""})):(e.openBlock(),e.createElementBlock("image",{key:1,src:"/static/img/girl.png",alt:""})),e.createElementVNode("view",{class:"imgtext1"}," 女 ")])]),e.createElementVNode("view",{class:"title"},"姓名"),e.createElementVNode("input",{type:"text",placeholder:"输入姓名",class:"input",onInput:o[3]||(o[3]=e=>N("name",e))},null,32),e.createElementVNode("view",{class:"title"},"年龄"),e.createElementVNode("input",{type:"number",placeholder:"例如:12",class:"input",onInput:o[4]||(o[4]=e=>N("old",e))},null,32),e.createElementVNode("view",{class:"title"},"出生年月日"),e.createElementVNode("view",{class:"image-text_1 flex-row justify-between input",onClick:A},[e.createElementVNode("text",null,e.toDisplayString(l.value),1)]),e.createElementVNode("view",{class:"title"},"校区"),e.createElementVNode("view",{class:"input"},[e.createElementVNode("picker",{onChange:U,value:d.value,range:p.value.map((e=>e.title)),"range-key":"gift"},[e.createElementVNode("view",{class:"uni-input"},e.toDisplayString(u.value),1)],40,["value","range"])]),e.createElementVNode("view",{class:"title"},"班级"),e.createElementVNode("view",{class:"input"},[e.createElementVNode("picker",{mode:"selector",onChange:G,value:g.value,range:h.value.map((e=>e.title)),disabled:T.value},[e.createElementVNode("view",{class:"uni-input"},e.toDisplayString(m.value),1)],40,["value","range","disabled"])]),e.createElementVNode("view",{class:"title"},"推荐人"),e.createElementVNode("input",{type:"text",placeholder:"输入推荐人",class:"input",onInput:o[5]||(o[5]=e=>N("refe",e))},null,32),e.createElementVNode("view",{class:"title"},"手机号"),e.createElementVNode("input",{type:"text",placeholder:"输入手机号",class:"input",autocomplete:"off",onInput:o[6]||(o[6]=e=>N("iphone",e))},null,32),e.createElementVNode("view",{style:{position:"relative"}},[e.createElementVNode("view",{class:"title"},"验证码"),e.createElementVNode("input",{type:"text",placeholder:"验证码",class:"input",autocomplete:"off",onInput:o[7]||(o[7]=e=>N("captcha",e))},null,32),e.createElementVNode("view",{style:{position:"absolute",right:"0",bottom:"4px"},onClick:e.withModifiers(B,["stop"]),disabled:S.value,class:e.normalizeClass({"code-button":!0,"disabled-button":S.value})},e.toDisplayString(S.value?`${D.value}秒`:"获取验证码"),11,["disabled"])]),e.createElementVNode("view",{class:"title"},"密码"),e.createElementVNode("input",{type:"password",placeholder:"输入密码",class:"input",autocomplete:"off",onInput:o[8]||(o[8]=e=>N("password",e))},null,32),e.createElementVNode("button",{class:"login-button",onClick:O},"完成")]),e.createElementVNode("view",{class:"footer"})])])}}},nl="/static/img/saoma.png",ol="/static/img/sousuo.png",al="/static/img/noAct.png",il="/static/img/noMes.png",sl=["{","}"];const rl=/^(?:\d)+/,cl=/^(?:\w)+/;const ll="zh-Hans",ul="zh-Hant",dl="en",pl=Object.prototype.hasOwnProperty,hl=(e,t)=>pl.call(e,t),gl=new class{constructor(){this._caches=Object.create(null)}interpolate(e,t,n=sl){if(!t)return[e];let o=this._caches[e];return o||(o=function(e,[t,n]){const o=[];let a=0,i="";for(;a<e.length;){let s=e[a++];if(s===t){i&&o.push({type:"text",value:i}),i="";let t="";for(s=e[a++];void 0!==s&&s!==n;)t+=s,s=e[a++];const r=s===n,c=rl.test(t)?"list":r&&cl.test(t)?"named":"unknown";o.push({value:t,type:c})}else i+=s}return i&&o.push({type:"text",value:i}),o}(e,n),this._caches[e]=o),function(e,t){const n=[];let o=0;const a=Array.isArray(t)?"list":(i=t,null!==i&&"object"==typeof i?"named":"unknown");var i;if("unknown"===a)return n;for(;o<e.length;){const i=e[o];switch(i.type){case"text":n.push(i.value);break;case"list":n.push(t[parseInt(i.value,10)]);break;case"named":"named"===a&&n.push(t[i.value])}o++}return n}(o,t)}};function ml(e,t){if(!e)return;if(e=e.trim().replace(/_/g,"-"),t&&t[e])return e;if("chinese"===(e=e.toLowerCase()))return ll;if(0===e.indexOf("zh"))return e.indexOf("-hans")>-1?ll:e.indexOf("-hant")>-1?ul:(n=e,["-tw","-hk","-mo","-cht"].find((e=>-1!==n.indexOf(e)))?ul:ll);var n;let o=[dl,"fr","es"];t&&Object.keys(t).length>0&&(o=Object.keys(t));const a=function(e,t){return t.find((t=>0===e.indexOf(t)))}(e,o);return a||void 0}class fl{constructor({locale:e,fallbackLocale:t,messages:n,watcher:o,formater:a}){this.locale=dl,this.fallbackLocale=dl,this.message={},this.messages={},this.watchers=[],t&&(this.fallbackLocale=t),this.formater=a||gl,this.messages=n||{},this.setLocale(e||dl),o&&this.watchLocale(o)}setLocale(e){const t=this.locale;this.locale=ml(e,this.messages)||this.fallbackLocale,this.messages[this.locale]||(this.messages[this.locale]={}),this.message=this.messages[this.locale],t!==this.locale&&this.watchers.forEach((e=>{e(this.locale,t)}))}getLocale(){return this.locale}watchLocale(e){const t=this.watchers.push(e)-1;return()=>{this.watchers.splice(t,1)}}add(e,t,n=!0){const o=this.messages[e];o?n?Object.assign(o,t):Object.keys(t).forEach((e=>{hl(o,e)||(o[e]=t[e])})):this.messages[e]=t}f(e,t,n){return this.formater.interpolate(e,t,n).join("")}t(e,t,n){let o=this.message;return"string"==typeof t?(t=ml(t,this.messages))&&(o=this.messages[t]):n=t,hl(o,e)?this.formater.interpolate(o[e],n).join(""):(console.warn(`Cannot translate the value of keypath ${e}. Use the value of keypath as default.`),e)}}function vl(e,t={},n,o){if("string"!=typeof e){const n=[t,e];e=n[0],t=n[1]}"string"!=typeof e&&(e="undefined"!=typeof uni&&uni.getLocale?uni.getLocale():"undefined"!=typeof global&&global.getLocale?global.getLocale():dl),"string"!=typeof n&&(n="undefined"!=typeof __uniConfig&&__uniConfig.fallbackLocale||dl);const a=new fl({locale:e,fallbackLocale:n,messages:t,watcher:o});let i=(e,t)=>{if("function"!=typeof getApp)i=function(e,t){return a.t(e,t)};else{let e=!1;i=function(t,n){const o=getApp().$vm;return o&&(o.$locale,e||(e=!0,function(e,t){e.$watchLocale?e.$watchLocale((e=>{t.setLocale(e)})):e.$watch((()=>e.$locale),(e=>{t.setLocale(e)}))}(o,a))),a.t(t,n)}}return i(e,t)};return{i18n:a,f:(e,t,n)=>a.f(e,t,n),t:(e,t)=>i(e,t),add:(e,t,n=!0)=>a.add(e,t,n),watch:e=>a.watchLocale(e),getLocale:()=>a.getLocale(),setLocale:e=>a.setLocale(e)}}const _l={en:{"uni-countdown.day":"day","uni-countdown.h":"h","uni-countdown.m":"m","uni-countdown.s":"s"},"zh-Hans":{"uni-countdown.day":"天","uni-countdown.h":"时","uni-countdown.m":"分","uni-countdown.s":"秒"},"zh-Hant":{"uni-countdown.day":"天","uni-countdown.h":"時","uni-countdown.m":"分","uni-countdown.s":"秒"}},{t:yl}=vl(_l);const Il=L({name:"UniCountdown",emits:["timeup"],props:{showDay:{type:Boolean,default:!0},showHour:{type:Boolean,default:!0},showMinute:{type:Boolean,default:!0},showColon:{type:Boolean,default:!0},start:{type:Boolean,default:!0},backgroundColor:{type:String,default:""},color:{type:String,default:"#333"},fontSize:{type:Number,default:14},splitorColor:{type:String,default:"#333"},day:{type:Number,default:0},hour:{type:Number,default:0},minute:{type:Number,default:0},second:{type:Number,default:0},timestamp:{type:Number,default:0},filterShow:{type:Object,default:{}}},data:()=>({timer:null,syncFlag:!1,d:"00",h:"00",i:"00",s:"00",leftTime:0,seconds:0}),computed:{dayText:()=>yl("uni-countdown.day"),hourText:e=>yl("uni-countdown.h"),minuteText:e=>yl("uni-countdown.m"),secondText:e=>yl("uni-countdown.s"),timeStyle(){const{color:e,backgroundColor:t,fontSize:n}=this;return{color:e,backgroundColor:t,fontSize:`${n}px`,width:22*n/14+"px",lineHeight:20*n/14+"px",borderRadius:3*n/14+"px"}},splitorStyle(){const{splitorColor:e,fontSize:t,backgroundColor:n}=this;return{color:e,fontSize:12*t/14+"px",margin:n?4*t/14+"px":""}}},watch:{day(e){this.changeFlag()},hour(e){this.changeFlag()},minute(e){this.changeFlag()},second(e){this.changeFlag()},start:{immediate:!0,handler(e,t){if(e)this.startData();else{if(!t)return;clearInterval(this.timer)}}}},created:function(e){this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.countDown()},unmounted(){clearInterval(this.timer)},methods:{toSeconds:(e,t,n,o,a)=>e?e-parseInt((new Date).getTime()/1e3,10):60*t*60*24+60*n*60+60*o+a,timeUp(){clearInterval(this.timer),this.$emit("timeup")},countDown(){let e=this.seconds,[t,n,o,a]=[0,0,0,0];e>0?(t=Math.floor(e/86400),n=Math.floor(e/3600)-24*t,o=Math.floor(e/60)-24*t*60-60*n,a=Math.floor(e)-24*t*60*60-60*n*60-60*o):this.timeUp(),this.d=String(t).padStart(this.validFilterShow(this.filterShow.d),"0"),this.h=String(n).padStart(this.validFilterShow(this.filterShow.h),"0"),this.i=String(o).padStart(this.validFilterShow(this.filterShow.m),"0"),this.s=String(a).padStart(this.validFilterShow(this.filterShow.s),"0")},validFilterShow:e=>e&&e>0?e:2,startData(){if(this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.seconds<=0)return this.seconds=this.toSeconds(0,0,0,0,0),void this.countDown();clearInterval(this.timer),this.countDown(),this.timer=setInterval((()=>{this.seconds--,this.seconds<0?this.timeUp():this.countDown()}),1e3)},update(){this.startData()},changeFlag(){this.syncFlag||(this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.startData(),this.syncFlag=!0)}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"uni-countdown"},[o.showDay?(e.openBlock(),e.createElementBlock("text",{key:0,style:e.normalizeStyle([s.timeStyle]),class:"uni-countdown__number"},e.toDisplayString(i.d),5)):e.createCommentVNode("",!0),o.showDay?(e.openBlock(),e.createElementBlock("text",{key:1,style:e.normalizeStyle([s.splitorStyle]),class:"uni-countdown__splitor"},e.toDisplayString(s.dayText),5)):e.createCommentVNode("",!0),o.showHour?(e.openBlock(),e.createElementBlock("text",{key:2,style:e.normalizeStyle([s.timeStyle]),class:"uni-countdown__number"},e.toDisplayString(i.h),5)):e.createCommentVNode("",!0),o.showHour?(e.openBlock(),e.createElementBlock("text",{key:3,style:e.normalizeStyle([s.splitorStyle]),class:"uni-countdown__splitor"},e.toDisplayString(o.showColon?":":s.hourText),5)):e.createCommentVNode("",!0),o.showMinute?(e.openBlock(),e.createElementBlock("text",{key:4,style:e.normalizeStyle([s.timeStyle]),class:"uni-countdown__number"},e.toDisplayString(i.i),5)):e.createCommentVNode("",!0),o.showMinute?(e.openBlock(),e.createElementBlock("text",{key:5,style:e.normalizeStyle([s.splitorStyle]),class:"uni-countdown__splitor"},e.toDisplayString(o.showColon?":":s.minuteText),5)):e.createCommentVNode("",!0),e.createElementVNode("text",{style:e.normalizeStyle([s.timeStyle]),class:"uni-countdown__number"},e.toDisplayString(i.s),5),o.showColon?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:6,style:e.normalizeStyle([s.splitorStyle]),class:"uni-countdown__splitor"},e.toDisplayString(s.secondText),5))])}],["__scopeId","data-v-753d5db2"]]),El={en:{"uni-countdown.day":"day","uni-countdown.h":"h","uni-countdown.m":"m","uni-countdown.s":"s"},"zh-Hans":{"uni-countdown.day":"天","uni-countdown.h":"时","uni-countdown.m":"分","uni-countdown.s":"秒"},"zh-Hant":{"uni-countdown.day":"天","uni-countdown.h":"時","uni-countdown.m":"分","uni-countdown.s":"秒"}},{t:Cl}=vl(El),kl={name:"UniCountdown",emits:["timeup"],props:{showDay:{type:Boolean,default:!0},showHour:{type:Boolean,default:!0},showMinute:{type:Boolean,default:!0},showColon:{type:Boolean,default:!0},start:{type:Boolean,default:!0},backgroundColor:{type:String,default:""},color:{type:String,default:"#333"},fontSize:{type:Number,default:14},splitorColor:{type:String,default:"#333"},day:{type:Number,default:0},hour:{type:Number,default:0},minute:{type:Number,default:0},second:{type:Number,default:0},timestamp:{type:Number,default:0}},data:()=>({timer:null,syncFlag:!1,d:"00",h:"00",i:"00",s:"00",leftTime:0,seconds:0}),computed:{dayText:()=>Cl("uni-countdown.day"),hourText:e=>Cl("uni-countdown.h"),minuteText:e=>Cl("uni-countdown.m"),secondText:e=>Cl("uni-countdown.s"),timeStyle(){const{color:e,backgroundColor:t,fontSize:n}=this;return{color:e,backgroundColor:t,fontSize:`${n}px`,width:22*n/14+"px",lineHeight:20*n/14+"px",borderRadius:3*n/14+"px"}},splitorStyle(){const{splitorColor:e,fontSize:t,backgroundColor:n}=this;return{color:e,fontSize:12*t/14+"px",margin:n?4*t/14+"px":""}}},watch:{day(e){this.changeFlag()},hour(e){this.changeFlag()},minute(e){this.changeFlag()},second(e){this.changeFlag()},start:{immediate:!0,handler(e,t){if(e)this.startData();else{if(!t)return;clearInterval(this.timer)}}}},created:function(e){this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.countDown()},unmounted(){clearInterval(this.timer)},methods:{toSeconds:(e,t,n,o,a)=>e?e-parseInt((new Date).getTime()/1e3,10):60*t*60*24+60*n*60+60*o+a,timeUp(){clearInterval(this.timer),this.$emit("timeup")},countDown(){let e=this.seconds,[t,n,o,a]=[0,0,0,0];e>0?(t=Math.floor(e/86400),n=Math.floor(e/3600)-24*t,o=Math.floor(e/60)-24*t*60-60*n,a=Math.floor(e)-24*t*60*60-60*n*60-60*o):this.timeUp(),t<10&&(t="0"+t),n<10&&(n="0"+n),o<10&&(o="0"+o),a<10&&(a="0"+a),this.d=t,this.h=n,this.i=o,this.s=a},startData(){if(this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.seconds<=0)return this.seconds=this.toSeconds(0,0,0,0,0),void this.countDown();clearInterval(this.timer),this.countDown(),this.timer=setInterval((()=>{this.seconds--,this.seconds<0?this.timeUp():this.countDown()}),1e3)},update(){this.startData()},changeFlag(){this.syncFlag||(this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.startData(),this.syncFlag=!0)}}};const Tl="/static/img/fir.png";const Ml=L({components:{UniCountdown:L(kl,[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"uni-countdown"},[o.showDay?(e.openBlock(),e.createElementBlock("text",{key:0,style:e.normalizeStyle([s.timeStyle]),class:"uni-countdown__number"},e.toDisplayString(i.d),5)):e.createCommentVNode("",!0),o.showDay?(e.openBlock(),e.createElementBlock("text",{key:1,style:e.normalizeStyle([s.splitorStyle]),class:"uni-countdown__splitor"},e.toDisplayString(s.dayText),5)):e.createCommentVNode("",!0),o.showHour?(e.openBlock(),e.createElementBlock("text",{key:2,style:e.normalizeStyle([s.timeStyle]),class:"uni-countdown__number"},e.toDisplayString(i.h),5)):e.createCommentVNode("",!0),o.showHour?(e.openBlock(),e.createElementBlock("text",{key:3,style:e.normalizeStyle([s.splitorStyle]),class:"uni-countdown__splitor"},e.toDisplayString(o.showColon?":":s.hourText),5)):e.createCommentVNode("",!0),o.showMinute?(e.openBlock(),e.createElementBlock("text",{key:4,style:e.normalizeStyle([s.timeStyle]),class:"uni-countdown__number"},e.toDisplayString(i.i),5)):e.createCommentVNode("",!0),o.showMinute?(e.openBlock(),e.createElementBlock("text",{key:5,style:e.normalizeStyle([s.splitorStyle]),class:"uni-countdown__splitor"},e.toDisplayString(o.showColon?":":s.minuteText),5)):e.createCommentVNode("",!0),e.createElementVNode("text",{style:e.normalizeStyle([s.timeStyle]),class:"uni-countdown__number"},e.toDisplayString(i.s),5),o.showColon?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:6,style:e.normalizeStyle([s.splitorStyle]),class:"uni-countdown__splitor"},e.toDisplayString(s.secondText),5))])}],["__scopeId","data-v-f433744e"]])},data:()=>({testHour:0,testMinute:0,testSecond:0,start:!1}),props:{online:Number,techerimg:String,biaoti:String,laoshi:String,star:String,end:String,hearimg:String,teachername:String,hours:Number,minutes:Number,seconds:Number,pers:Number,money:String,imgs:Array,signedUp:Number},computed:{signupText(){return this.signedUp?"已报名":"立即报名"}},mounted(){this.updateCountdown()},watch:{hours:"updateCountdown",minutes:"updateCountdown",seconds:"updateCountdown"},methods:{printTime(){I("log","at components/ActivityItem/ActivityItem.vue:122","Hours:",typeof this.hours),I("log","at components/ActivityItem/ActivityItem.vue:123","Minutes:",typeof this.minutes),I("log","at components/ActivityItem/ActivityItem.vue:124","Seconds:",typeof this.seconds)},updateCountdown(){this.testHour=this.hours,this.testMinute=this.minutes,this.testSecond=this.seconds,this.start=!0},handleSignup(){this.$emit("signup",this)}}},[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uni-countdown"),Il);return e.openBlock(),e.createElementBlock("view",{class:"courseRegistrationCard"},[e.createElementVNode("view",{class:"courseRegistrationCard_bg",style:e.normalizeStyle({backgroundColor:0===o.hours&&0===o.minutes&&0===o.seconds?"gray":""})},null,4),e.createElementVNode("view",{class:"courseRegistrationCard_status",style:e.normalizeStyle({top:0===o.hours&&0===o.minutes&&0===o.seconds?"-6rpx":0,right:0===o.hours&&0===o.minutes&&0===o.seconds?"-12rpx":0})},e.toDisplayString(0===o.hours&&0===o.minutes&&0===o.seconds?"已结束":1===o.online?"线上":"线下"),5),e.createElementVNode("view",{class:"techerImg"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng13a2fb02e015caf1325ed0ae70a60ac4263056e78d6de603517f5fae96ceca41",alt:""})]),e.createElementVNode("view",{class:"courseInformation"},[e.createElementVNode("view",{class:"courseTitle"},e.toDisplayString(o.biaoti),1),e.createElementVNode("view",{class:"courseTeacher"},e.toDisplayString(o.laoshi),1),e.createElementVNode("view",{class:"courseTime"},"开课时间: "+e.toDisplayString(o.star)+" - "+e.toDisplayString(o.end),1),e.createElementVNode("view",{class:"lecturerInfo"},[e.createElementVNode("img",{src:o.hearimg,alt:""},null,8,["src"]),e.createElementVNode("view",{class:"lecturer_name"},[e.createElementVNode("text",null,e.toDisplayString(o.teachername),1),e.createElementVNode("text",{style:{"font-size":"20rpx","margin-top":"10rpx"}},"授课")]),e.createElementVNode("view",{class:"remainingTime"},[e.createElementVNode("text",{style:{"font-size":"24rpx"}},"距结束还剩:"),e.createVNode(r,{"show-day":!1,hour:i.testHour,minute:i.testMinute,second:i.testSecond,color:"#FFFFFF","background-color":"#007AFF"},null,8,["hour","minute","second"])])]),e.createElementVNode("view",{class:"endbaoming"},[e.createElementVNode("view",{class:"peopers"},[e.createElementVNode("image",{style:{width:"24rpx",height:"32rpx"},src:Tl,mode:"aspectFit"}),e.createElementVNode("view",{class:"peotext",style:{"font-size":"20rpx"}},e.toDisplayString(o.pers)+"人报名",1),e.createElementVNode("view",{class:"imgbox"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.imgs,((t,n)=>(e.openBlock(),e.createElementBlock("image",{src:t.avatar?t.avatar:"",key:n,style:e.normalizeStyle({position:"absolute",right:`calc(20rpx * ${n})`,zIndex:10-n,width:"30rpx",height:"30rpx",borderRadius:"50%"})},null,12,["src"])))),128))])]),e.createElementVNode("view",{class:"perbtn"},[e.createElementVNode("view",{class:"permoney"},e.toDisplayString(o.money??1?"免费":"￥"+(o.money??0)),1),e.createElementVNode("view",{style:e.normalizeStyle(o.signedUp?{backgroundColor:"#999999"}:{background:"#ff9e02"}),class:"gobtn",onClick:n[0]||(n[0]=(...e)=>s.handleSignup&&s.handleSignup(...e))},e.toDisplayString(s.signupText),5)])])])])}],["__scopeId","data-v-b8e9f624"]]),Sl=L({__name:"home",setup(t){const n=se();n.token;const o=e.computed((()=>n.images)),a=e.computed((()=>n.listdataIndex)),i=e.computed((()=>n.userinfo)),s=e.computed((()=>n.infoList)),r=e.ref({}),c=e.ref(null);e.ref(0),e.ref(0),e.ref(0);const l={page:1,limit:7,isindex:1},u=async()=>{try{const e=await Promise.all([Z(l),Q(),ee(),ne()]),t=e[0].items.map((e=>({...e,timerId:null,hours:0,minutes:0,seconds:0})));n.setListdataIndex(t),n.setImages(e[1].items);const o=e[2].items.map((e=>({...e,titleimg:e.titleimg||"../../static/img/jinghao.png",image_input:e.image_input||"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng9124bf95026b34308d6bd993d7c3774578aa0f9fdf293cc08d4cb043bc1ba5a8",ressImg:e.ressImg||"@/static/img/add.png",jiantouimg:e.jiantouimg||"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng6deab9d71966dbbdc8297bb42543232fd5ab80e8f1b6e7650f9a66310b4f656e"})));n.setInfoList(o),r.value=e[3].data}catch(e){I("error","at pages/pagesall/home.vue:230","获取数据时发生错误:",e)}};w((()=>{u(),m(),uni.stopPullDownRefresh()})),k((()=>{u(),m()}));const d=e.ref();M((()=>{d.value=getApp().globalData.top})),e.onUnmounted((()=>{}));const p=()=>{uni.switchTab({url:"/pages/pagesall/oper"})},h=()=>{const e=(new Date).getTime(),t=Math.floor(e/1e3);a.value.forEach((e=>{if(isNaN(e.end_time))e.hours=e.minutes=e.seconds=0;else{const n=e.end_time-t;n>0?(e.hours=Math.floor(n/3600),e.minutes=Math.floor(n%3600/60),e.seconds=n%60,e.timerId||(e.timerId=setInterval((()=>{h()}),1e3))):(e.hours=e.minutes=e.seconds=0,g(e))}})),n.setListdataIndex(a.value)},g=e=>{e.timerId&&(clearInterval(e.timerId),e.timerId=null,I("log","at pages/pagesall/home.vue:328",`活动 ${e.id} 的定时器已清除，时间到达。`))},m=()=>{h(),c.value=setInterval(h,1e3)},f=()=>{uni.scanCode({success:e=>{I("log","at pages/pagesall/home.vue:340","条码类型："+e.scanType),I("log","at pages/pagesall/home.vue:341","条码内容："+e.result)},fail:e=>{I("error","at pages/pagesall/home.vue:344","扫码失败",e),uni.showToast({title:"扫码失败",icon:"error",duration:2e3})}})},v=()=>{uni.navigateTo({url:"/pages/pagesall/home/search"})},_=()=>{uni.navigateTo({url:"/pages/pagesall/home/message"})},y=()=>{uni.navigateTo({url:"/pages/pagesall/home/informationDetails"})};return(t,c)=>(e.openBlock(),e.createElementBlock("view",{class:"homePage"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(d.value+5)+"px;")},null,4),e.createElementVNode("view",{class:"titleHome"},[e.createElementVNode("view",{class:"nameId"},[e.createElementVNode("view",{class:"head"},[e.createElementVNode("img",{style:{width:"32px",height:"32px","border-radius":"50%"},src:i.value.avatar},null,8,["src"])]),e.createElementVNode("view",{class:"name"},[e.createElementVNode("text",{class:"textname"},e.toDisplayString(i.value.nickname),1),e.createElementVNode("text",{class:"textid"},"ID:"+e.toDisplayString(i.value.id),1)]),e.createElementVNode("view",{class:"classID"},e.toDisplayString(i.value.classly_name),1)]),e.createElementVNode("view",{class:"buttonImg"},[e.createElementVNode("view",{class:"btnimg1",onClick:f},[e.createElementVNode("image",{style:{width:"36rpx",height:"36rpx"},src:nl,alt:""})]),e.createElementVNode("view",{class:"btnimg2",onClick:v},[e.createElementVNode("image",{style:{width:"36rpx",height:"36rpx"},src:ol,alt:""})]),e.createElementVNode("view",{class:"btnimg3",onClick:_},[e.createElementVNode("image",{style:{width:"36rpx",height:"36rpx"},src:"/static/img/xiaoxi.png",alt:""})])])]),e.createElementVNode("view",{class:"posit"},[e.createElementVNode("img",{src:"/static/img/add.png",alt:""}),e.createElementVNode("text",{class:"postext"},e.toDisplayString(i.value.school_name),1)]),e.createElementVNode("swiper",{class:"swiper-container","indicator-dots":"",autoplay:"",interval:"3000",circular:"","indicator-color":"#ddd","indicator-active-color":"#333"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,o)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:o,onClick:()=>(e=>{I("log","at pages/pagesall/home.vue:379","当前点击的轮播图下标:",e),n.setSelectedSwiperIndex(e),uni.navigateTo({url:"/pages/pagesall/home/game"})})(o+1)},[e.createElementVNode("image",{src:t.thumb,class:"swiper-image"},null,8,["src"])],8,["onClick"])))),128))]),e.createElementVNode("view",{class:"showbox"},[e.createElementVNode("view",{class:"showimg"},[e.createElementVNode("img",{src:r.value.logo,alt:"",class:"showimg1"},null,8,["src"])]),e.createElementVNode("view",{class:"showtext"},[e.createElementVNode("text",{class:"text-content"},e.toDisplayString(r.value.remark),1)])]),e.createElementVNode("view",{class:"works"},[e.createElementVNode("text",{class:"worktext"},"优秀作品"),e.createElementVNode("view",{class:"worksImgs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value.nice,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"worksimgbox",key:n},[e.createElementVNode("image",{style:{width:"198rpx",height:"122rpx","margin-top":"12rpx"},src:t.sub_image,mode:"aspectFill"},null,8,["src"])])))),128))])]),e.createElementVNode("view",{class:"students"},[e.createElementVNode("text",{class:"stutext"},"学员风采"),e.createElementVNode("view",{class:"stusImgs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value.stud,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"stuimgbox",key:n},[e.createElementVNode("image",{style:{width:"108rpx",height:"108rpx","border-radius":"32px","margin-top":"-4px","margin-left":"-2px"},src:t.avatar,mode:"aspectFill"},null,8,["src"])])))),128))])]),e.createElementVNode("view",{class:"actiClass"},[e.createElementVNode("view",{class:"actText"},[e.createElementVNode("text",null,"活动课"),e.createElementVNode("text",{style:{"font-size":"24rpx",color:"#666666"},onClick:p},"更多")]),a.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,style:{height:"500rpx",overflow:"hidden"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,((t,n)=>{var o,a;return e.openBlock(),e.createBlock(e.unref(Ml),{key:n,online:t.is_online,techerimg:t.avatar,biaoti:t.title,laoshi:t.description,star:t.s_time,end:t.e_time,hearimg:t.teacher_avatar,teachername:t.teacher_name,hours:t.hours,minutes:t.minutes,seconds:t.seconds,pers:(null==(o=t.signup_member)?void 0:o.total)||0,money:t.price,imgs:(null==(a=t.signup_member)?void 0:a.items)||[],signedUp:t.hadSignup,onSignup:()=>(e=>{const t=encodeURIComponent(JSON.stringify(l));uni.navigateTo({url:`/pages/pagesall/home/signUp?id=${e}&params=${t}`})})(t.id)},null,8,["online","techerimg","biaoti","laoshi","star","end","hearimg","teachername","hours","minutes","seconds","pers","money","imgs","signedUp","onSignup"])})),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))]),e.createElementVNode("view",{class:"infobox"},[e.createElementVNode("view",{class:"infoText"},[e.createElementVNode("text",null,"资讯"),e.createElementVNode("text",{style:{"font-size":"24rpx",color:"#666666"},onClick:y},"更多")]),s.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,style:{overflow:"hidden",height:"300rpx"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"infolistbox",key:n,onClick:e=>(e=>{uni.navigateTo({url:`/pages/pagesall/home/informationDetailsmess?id=${e.id}`})})(t)},[e.createElementVNode("view",{class:"infostr"},[e.createElementVNode("view",{class:"huatibox"},[e.createElementVNode("img",{src:t.titleimg,alt:""},null,8,["src"]),e.createElementVNode("text",{style:{"font-size":"32rpx","font-weight":"500",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},e.toDisplayString(t.title),1)]),e.createElementVNode("view",{class:"paddbox"},[e.createElementVNode("view",{class:"titleText"},e.toDisplayString(t.description),1),e.createElementVNode("view",{class:"huatibox"},[e.createElementVNode("img",{src:t.image_input,alt:""},null,8,["src"]),e.createElementVNode("text",{style:{"font-weight":"400","font-size":"24rpx",color:"#666666","margin-left":"6px"}},e.toDisplayString(t.addtime||"2022-01-01"),1)]),e.createElementVNode("view",{class:"huatibox"},[e.createElementVNode("img",{src:t.ressImg,alt:""},null,8,["src"]),e.createElementVNode("text",{style:{"font-weight":"400","font-size":"24rpx","margin-left":"6px"}},e.toDisplayString(t.school_name||"http://www.baidu.com"),1)])])]),e.createElementVNode("view",{class:"infoImg"},[e.createElementVNode("view",{class:"proNum",style:e.normalizeStyle({opacity:0===t.views?0:1})},[e.createElementVNode("text",{style:{"font-weight":"400","font-size":"24rpx",color:"#666666"}},e.toDisplayString(t.views)+"人已观看 ",1),e.createElementVNode("img",{src:t.jiantouimg,alt:"",style:{width:"8rpx",height:"16rpx"}},null,8,["src"])],4),e.createElementVNode("view",{class:"proImg"},[e.createElementVNode("img",{src:t.thumb,alt:""},null,8,["src"])])])],8,["onClick"])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:il,mode:"aspectFit"})]))])]))}},[["__scopeId","data-v-7218945a"]]);const Dl=L({components:{}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"timeline"},[e.renderSlot(t.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-e525413b"]]);const bl=L({props:{leftTime:{default:""},color:{default:""},leftlist1:{default:""},leftlist2:{default:""},leftlist3:{default:""}},data:()=>({})},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"timelineItem"},[e.createElementVNode("view",{class:"timeItem"},[e.createElementVNode("view",{class:"line"},[e.createElementVNode("view",{class:"out",style:e.normalizeStyle({background:""==o.color?"":o.color})},[e.createElementVNode("view",{class:"inner",style:e.normalizeStyle({background:""==o.color?"":o.color})},null,4)],4)]),e.createElementVNode("view",{class:"leftTime",style:{"font-weight":"500","font-size":"28rpx",color:"#000000"}},[e.createTextVNode(e.toDisplayString(o.leftTime)+" ",1),""!==o.leftlist1?(e.openBlock(),e.createElementBlock("view",{key:0,class:"leftlist1"},e.toDisplayString(o.leftlist1),1)):e.createCommentVNode("",!0),""!==o.leftlist2?(e.openBlock(),e.createElementBlock("view",{key:1,class:"leftlist2"},e.toDisplayString(o.leftlist2),1)):e.createCommentVNode("",!0),""!==o.leftlist3?(e.openBlock(),e.createElementBlock("view",{key:2,class:"leftlist3"},e.toDisplayString(o.leftlist3),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"rightContent",style:{"text-align":"right","font-weight":"400","font-size":"24rpx",color:"#333333"}},[e.renderSlot(t.$slots,"default",{},void 0,!0)])])])}],["__scopeId","data-v-5cd92b84"]]),wl={__name:"course",setup(t){const n=e.ref();M((()=>{n.value=getApp().globalData.top})),b((()=>{i()})),w((()=>{i(),uni.stopPullDownRefresh()}));const o=e.ref([]),a=e.ref([]);e.ref({scrollTop:0}),e.onMounted((()=>{i()}));const i=async()=>{try{const[t,n]=await Promise.all([te(),Y("/user/lessonrecent",e)]);o.value=t.items,a.value=n.items.map((e=>({...e,color:0===e.status?"#5791F2":"#666666"})))}catch(t){I("error","at pages/pagesall/course.vue:120","获取课程失败:",t)}var e};function s(){uni.navigateTo({url:"/pages/pagesall/course/go_learn"})}return(t,i)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"code_titlebox"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(n.value+5)+"px;")},null,4),e.createElementVNode("view",{class:"code_title"}," 课程 ")]),e.createElementVNode("view",{class:"game_time"},[e.createElementVNode("text",{style:{"font-weight":"500","font-size":"36rpx",color:"#000000"}},"活动时间安排")]),o.value.length>0?(e.openBlock(),e.createBlock(Dl,{key:0},{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"line_list",key:n},[e.createVNode(bl,{class:"list_box_cour",leftTime:t.title,color:"#5791F2"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tips",style:{height:"134rpx","font-weight":"500","font-size":"28rpx",color:"#000000","margin-left":"20rpx"}}," 主讲："+e.toDisplayString(t.teacher_name),1),e.createElementVNode("view",{class:"class_room"},[e.createElementVNode("view",{style:{"font-weight":"400","font-size":"24rpx",color:"#000000"}},"教室:"+e.toDisplayString(t.classroom),1),e.createElementVNode("view",{style:{"font-weight":"400","font-size":"24rpx",color:"#333333"}},"时间:"+e.toDisplayString(t.s_time)+"-"+e.toDisplayString(t.e_time),1)])])),_:2},1032,["leftTime"])])))),128))])),_:1})):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})])),e.createElementVNode("view",{class:"game_time"},[e.createElementVNode("text",{style:{"font-weight":"500","font-size":"36rpx",color:"#000000"}},"近期课程")]),a.value.length>0?(e.openBlock(),e.createBlock(Dl,{key:2},{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"line_list",key:n},[e.createVNode(bl,{class:"list_box_cour",leftTime:t.title,color:t.color,style:{"font-weight":"600","font-size":"28rpx",color:"#000000"}},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tips",style:{height:"154rpx","font-weight":"500","font-size":"28rpx",color:"#000000"}}," 主讲："+e.toDisplayString(t.teacher_name),1),e.createElementVNode("view",{class:"class_room"},[e.createElementVNode("view",{style:{"font-weight":"400",color:"#000000"}},"教室:"+e.toDisplayString(t.classroom),1),e.createElementVNode("view",{style:{"font-weight":"400","font-size":"24rpx",color:"#333333"}},"时间:"+e.toDisplayString(t.s_time)+"-"+e.toDisplayString(t.e_time),1)]),e.createElementVNode("view",{class:"list_btn",style:e.normalizeStyle([{color:"white"},{backgroundColor:0===t.status?"#5791F2":"#666666"}]),onClick:s},e.toDisplayString(0===t.status?"写作业":"作业已完成"),5)])),_:2},1032,["leftTime","color"])])))),128))])),_:1})):(e.openBlock(),e.createElementBlock("view",{key:3,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})])),e.createElementVNode("view",{class:"infobox"})],64))}},Nl="/static/img/satr.png";const Ll=L({data:()=>({canvasNode:null,evaluationDesc:"",statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{chooseImage(){uni.navigateTo({url:"/pages/pagesall/aiDete/aiResult",success:()=>{I("log","at pages/pagesall/aiDete.vue:552","成功跳转到目标页面")},fail:e=>{I("error","at pages/pagesall/aiDete.vue:555","跳转失败",e)}})}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{style:{position:"relative"}},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"ai—_box",style:{position:"absolute","z-index":"1000"}},[e.createElementVNode("view",{class:"ai_img"}),e.createElementVNode("view",{class:"ai_title"}),e.createElementVNode("view",{class:"photo_box"},[e.createElementVNode("view",{class:"left_top"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng8841afb2ed9b814c547bbb1d87bb42508771ef6fea67f1f4b54dae3061027a9c",alt:""})]),e.createElementVNode("view",{class:"right_top"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPnge94653dbe7f9bbbbe93f73e44c1dc68ccd17c869bf40e27cee8834315c37bd77",alt:""})]),e.createElementVNode("view",{class:"right_bottom"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngb3b3f03ebc6279ecc80d4ea63aa70fe3cf9aea5a8a49c7a1abe68f3e7fda82ac",alt:""})]),e.createElementVNode("view",{class:"left_bottom"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngff2bda36ded4b2b18a74c5ae9c8f5cc1c354864c822489c9660cfd7d2d26bc3e",alt:""})]),e.createElementVNode("view",{class:"photo_box2",onClick:n[0]||(n[0]=(...e)=>s.chooseImage&&s.chooseImage(...e))},[e.createElementVNode("view",{class:"photo_box3"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng3ed3fe30d1cf29e35208039bd47fd79c2b4a0a89c3f20565393574a04704475a",alt:""}),e.createElementVNode("view",{class:"photo_text"}," 拍照测评 ")])])]),e.createElementVNode("view",{class:"note1"},[e.createElementVNode("image",{style:{width:"28rpx",height:"28rpx"},src:Nl,mode:"widthFix"}),e.createElementVNode("view",{class:"note1_text notes"}," 仅支持正版彩色专用纸 ")]),e.createElementVNode("view",{class:"note2"},[e.createElementVNode("image",{style:{width:"28rpx",height:"28rpx"},src:Nl,mode:"widthFix"}),e.createElementVNode("view",{class:"note2_text notes"}," 测评标准为楷体GB2312 ")]),e.createElementVNode("view",{class:"note3"},[e.createElementVNode("image",{style:{width:"28rpx",height:"28rpx"},src:"/static/img/jinggao.png",mode:"widthFix"}),e.createElementVNode("view",{class:"note3_text notes"}," 使用说明 ")]),e.createElementVNode("div",{class:"content",ref:"aiBox"},[e.createElementVNode("div",null,[e.createElementVNode("canvas",{ref:"myCanvas","canvas-id":"myCanvas",id:"myCanvas",style:e.normalizeStyle({width:"100vw",height:t.canvasHeight+"px"}),onClick:n[1]||(n[1]=(...e)=>t.handleCanvasClick&&t.handleCanvasClick(...e))},null,4)])],512)])])}],["__scopeId","data-v-7bc336e9"]]);const Rl=L({name:"UniSegmentedControl",emits:["clickItem"],props:{current:{type:Number,default:0},values:{type:Array,default:()=>[]},activeColor:{type:String,default:"#FFf"},inActiveColor:{type:String,default:"transparent"},styleType:{type:String,default:"button"}},data:()=>({currentIndex:0}),watch:{current(e){e!==this.currentIndex&&(this.currentIndex=e)}},computed:{},created(){this.currentIndex=this.current},methods:{_onClick(e){this.currentIndex!==e&&(this.currentIndex=e,this.$emit("clickItem",{currentIndex:e}))}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass([["text"===o.styleType?"segmented-control--text":"segmented-control--button"],"segmented-control"]),style:e.normalizeStyle({borderColor:"text"===o.styleType?"":o.activeColor})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.values,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass([["text"===o.styleType?"":"segmented-control__item--button",0===n&&"button"===o.styleType?"segmented-control__item--button--first":"",n===o.values.length-1&&"button"===o.styleType?"segmented-control__item--button--last":""],"segmented-control__item"]),key:n,style:e.normalizeStyle({backgroundColor:n===i.currentIndex&&"button"===o.styleType?o.activeColor:"button"===o.styleType?o.inActiveColor:"transparent",borderColor:n===i.currentIndex&&"text"===o.styleType||"button"===o.styleType?o.activeColor:o.inActiveColor}),onClick:e=>s._onClick(n)},[e.createElementVNode("view",null,[e.createElementVNode("text",{style:e.normalizeStyle({color:n===i.currentIndex?"text"===o.styleType?o.activeColor:"#FF9E02":(o.styleType,"#000")}),class:e.normalizeClass(["segmented-control__text","text"===o.styleType&&n===i.currentIndex?"segmented-control__item--text":""])},e.toDisplayString(t),7)])],14,["onClick"])))),128))],6)}],["__scopeId","data-v-b11d77a4"]]),Al={components:{ActivityItem:Ml},data:()=>({statusBarHeight:"",items:["线上活动","线下活动"],current:0,colorIndex:0,listdata:[],listdata1:[],listdata2:[],listdata3:[],intervalId:null,oper_area:"湛江市",timer:null,currentPage:1,isLoading:!1}),onPullDownRefresh(){this.fetchActivityData(),uni.stopPullDownRefresh()},onReachBottom(){if(this.isLoading)return;this.currentPage++;const e=this.listdata1.length,t=this.listdata2.length,n=this.listdata3.length,o=this.listdata.length;this.fetchActivityData().then((()=>{const a=this.listdata1.length,i=this.listdata2.length,s=this.listdata3.length,r=this.listdata.length;a===e&&i===t&&s===n&&r===o?(this.isLoading=!0,uni.showToast({title:"没有更多数据",icon:"none",duration:2e3})):this.isLoading=!1})).catch((()=>{this.isLoading=!1}))},onLoad(){this.statusBarHeight=getApp().globalData.top,this.isLoading=!1},onShow(){this.fetchActivityData(),this.isLoading=!1},onUnload(){},mounted(){this.updateCountdown()},methods:{async fetchActivityData(){try{const e={limit:7,page:this.currentPage,end_activity:1,is_online:0===this.current?1:0},t={limit:7,page:this.currentPage,is_online:0===this.current?1:0},n=await Z(e),o=await Z(t);if(n.items&&0===n.items.length&&o.items&&0===o.items.length)return!0;if(I("log","at pages/pagesall/oper.vue:218",n),0===this.current.value){const e=new Set(this.listdata1.map((e=>e.id)));let t=n.items.filter((t=>!e.has(t.id))).map((e=>({...e,hours:0,minutes:0,seconds:0})));this.listdata1=[...this.listdata1,...t];const a=new Set(this.listdata2.map((e=>e.id)));let i=o.items.filter((e=>!a.has(e.id))).map((e=>({...e,hours:0,minutes:0,seconds:0})));this.listdata2=[...this.listdata2,...i]}else{const e=new Set(this.listdata.map((e=>e.id)));let t=n.items.filter((t=>!e.has(t.id))).map((e=>({...e,hours:0,minutes:0,seconds:0})));this.listdata=[...this.listdata,...t];const a=new Set(this.listdata3.map((e=>e.id)));let i=o.items.filter((e=>!a.has(e.id))).map((e=>({...e,hours:0,minutes:0,seconds:0})));this.listdata3=[...this.listdata3,...i]}I("log","at pages/pagesall/oper.vue:273",this.listdata),I("log","at pages/pagesall/oper.vue:274",this.listdata1)}catch(e){I("error","at pages/pagesall/oper.vue:276","获取活动数据失败:",e)}},onClickItem(e){this.current!==e.currentIndex&&(this.current=e.currentIndex,this.currentPage=1,this.isLoading=!1,this.fetchActivityData())},styleChange(e){this.styleType!==e.detail.value&&(this.styleType=e.detail.value)},colorChange(e){this.styleType!==e.detail.value&&(I("log","at pages/pagesall/oper.vue:295",e.detail.value),this.activeColor=e.detail.value)},handleSignup(e){const t=7,n=1,o=1;uni.navigateTo({url:`/pages/pagesall/home/signUp?id=${e}&limit=${t}&page=${n}&end_activity=${o}`})},handleSignup1(e){const t=7,n=1,o=1;uni.navigateTo({url:`/pages/pagesall/home/signUp?id=${e}&limit=${t}&page=${n}&end_activity=${o}`})},handleSignupXSline(e){const t=7,n=1,o=1,a=1;uni.navigateTo({url:`/pages/pagesall/home/signUp?id=${e}&limit=${t}&page=${n}&end_activity=${o}&is_online=${a}`})},handleSignupOnline(e){const t=7,n=1,o=1,a=0;uni.navigateTo({url:`/pages/pagesall/home/signUp?id=${e}&limit=${t}&page=${n}&end_activity=${o}&is_online=${a}`})},formatTime:e=>e.toString().padStart(2,"0"),updateCountdown(){const e=(new Date).getTime(),t=Math.floor(e/1e3);this.listdata.forEach((e=>{if(isNaN(e.end_time))e.hours=e.minutes=e.seconds=0;else{const n=e.end_time-t;I("log","at pages/pagesall/oper.vue:366",n),n>0?(e.hours=Math.floor(n/3600),e.minutes=Math.floor(n%3600/60),e.seconds=n%60,this.intervalId=setInterval(this.updateCountdown,1e3)):(e.hours=e.minutes=e.seconds=0,clearInterval(this.intervalId),this.intervalId=null)}}))},btnsignup(e){},selectCity(){uni.showToast({title:"暂不开放其他城市",icon:"none",duration:2e3})},updateSelectedCity(e){this.oper_area=e}}};const Ol=L(Al,[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uni-segmented-control"),Rl),c=e.resolveComponent("activity-item"),l=e.resolveComponent("uni-section");return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"oper_Title"}," 活动 "),e.createElementVNode("view",{class:"oper_area",onClick:n[0]||(n[0]=(...e)=>s.selectCity&&s.selectCity(...e))},[e.createElementVNode("view",{class:"area_img"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng8115b2c160eee2c4a0b2d28b5170401ecd79f5c361abd0bc4f8a82f0af559654",alt:""}),e.createElementVNode("view",{class:"area_text"},e.toDisplayString(i.oper_area),1),e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngf4e9bc406788b9232143810336e08dc7652f21137fb2a98411b6742d7f4dffb2",alt:""})]),e.createElementVNode("input",{type:"text",class:"area_input",placeholder:"请输入要查找的城市"})]),e.createElementVNode("view",null,[e.createVNode(l,{title:"实心标签",type:"line"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"uni-padding-wrap uni-common-mt"},[e.createVNode(r,{current:i.current,values:i.items,"active-color":t.activeColor,onClickItem:s.onClickItem},null,8,["current","values","active-color","onClickItem"]),0===i.current?(e.openBlock(),e.createElementBlock("view",{key:0,class:"line_oper"})):e.createCommentVNode("",!0),1===i.current?(e.openBlock(),e.createElementBlock("view",{key:1,class:"line_oper1"})):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"oper_title_text"}," 正在进行 "),e.createElementVNode("view",{class:"content"},[0===i.current?(e.openBlock(),e.createElementBlock("view",{key:0},[i.listdata2.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,style:{display:"grid","justify-items":"center"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.listdata2,((t,n)=>{var o,a;return e.openBlock(),e.createBlock(c,{key:n,online:t.is_online,techerimg:t.avatar,biaoti:t.title,laoshi:t.description,star:t.s_time,end:t.e_time,hearimg:t.teacher_avatar,teachername:t.teacher_name,hours:Number(t.hours),minutes:Number(t.minutes),seconds:Number(t.seconds),pers:(null==(o=t.signup_member)?void 0:o.total)||0,money:t.price,imgs:(null==(a=t.signup_member)?void 0:a.items)||[],signedUp:t.hadSignup,onSignup:()=>s.handleSignupXSline(t.id)},null,8,["online","techerimg","biaoti","laoshi","star","end","hearimg","teachername","hours","minutes","seconds","pers","money","imgs","signedUp","onSignup"])})),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})])),e.createElementVNode("view",{class:"oper_title_text1"}," 往期回顾 "),i.listdata.length>0?(e.openBlock(),e.createElementBlock("view",{key:2,style:{display:"grid","justify-items":"center"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.listdata,((t,n)=>{var o,a;return e.openBlock(),e.createBlock(c,{key:n,online:t.is_online,techerimg:t.avatar,biaoti:t.title,laoshi:t.description,star:t.s_time,end:t.e_time,hearimg:t.teacher_avatar,teachername:t.teacher_name,hours:Number(t.hours),minutes:Number(t.minutes),seconds:Number(t.seconds),pers:(null==(o=t.signup_member)?void 0:o.total)||0,money:t.price,imgs:(null==(a=t.signup_member)?void 0:a.items)||[],signedUp:t.hadSignup,onSignup:()=>s.handleSignup1(t.id)},null,8,["online","techerimg","biaoti","laoshi","star","end","hearimg","teachername","hours","minutes","seconds","pers","money","imgs","signedUp","onSignup"])})),128))])):(e.openBlock(),e.createElementBlock("view",{key:3,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx",width:"730rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))])):e.createCommentVNode("",!0),1===i.current?(e.openBlock(),e.createElementBlock("view",{key:1},[i.listdata3.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,style:{display:"grid","justify-items":"center"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.listdata3,((t,n)=>{var o,a;return e.openBlock(),e.createBlock(c,{key:n,online:t.is_online,techerimg:t.avatar,biaoti:t.title,laoshi:t.description,star:t.s_time,end:t.e_time,hearimg:t.teacher_avatar,teachername:t.teacher_name,hours:Number(t.hours),minutes:Number(t.minutes),seconds:Number(t.seconds),pers:(null==(o=t.signup_member)?void 0:o.total)||0,money:t.price,imgs:(null==(a=t.signup_member)?void 0:a.items)||[],signedUp:t.hadSignup,onSignup:()=>s.handleSignupOnline(t.id)},null,8,["online","techerimg","biaoti","laoshi","star","end","hearimg","teachername","hours","minutes","seconds","pers","money","imgs","signedUp","onSignup"])})),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})])),e.createElementVNode("view",{class:"oper_title_text1"}," 往期回顾 "),e.createElementVNode("view",null,[i.listdata1.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,style:{display:"grid","justify-items":"center"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.listdata1,((t,n)=>{var o,a;return e.openBlock(),e.createBlock(c,{key:n,online:t.is_online,techerimg:t.avatar,biaoti:t.title,laoshi:t.description,star:t.s_time,end:t.e_time,hearimg:t.teacher_avatar,teachername:t.teacher_name,hours:Number(t.hours),minutes:Number(t.minutes),seconds:Number(t.seconds),pers:(null==(o=t.signup_member)?void 0:o.total)||0,money:t.price,imgs:(null==(a=t.signup_member)?void 0:a.items)||[],signedUp:t.hadSignup,onSignup:()=>s.handleSignup(t.id)},null,8,["online","techerimg","biaoti","laoshi","star","end","hearimg","teachername","hours","minutes","seconds","pers","money","imgs","signedUp","onSignup"])})),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx",width:"730rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))])])):e.createCommentVNode("",!0)])])),_:1})])])}]]);const Ul=L({components:{ActivityItem:Ml},data:()=>({statusBarHeight:"",features:[{title:"我的作业",icon:"../../static/img/hw.png"},{title:"班级群",icon:"../../static/img/gro.png"},{title:"我的老师",icon:"../../static/img/tea.png"},{title:"历史测评",icon:"../../static/img/lAi.png"}],homework:[{title:"书法练习第一课",image:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/4f12d9b5c7ee4468ae4a232563300604_mergeImage.png",from:"来自刘老师",status:"未完成"},{title:"书法练习第二课",image:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/4f12d9b5c7ee4468ae4a232563300604_mergeImage.png",status:"未完成",from:"来自刘老师"}],participatingActivitiess:[]}),computed:{listdata:()=>se().listdata,userInfo:()=>se().userinfo},onShow(){this.pa()},onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{goTask(e){uni.navigateTo({url:`/pages/pagesall/course/go_learn?id=${e}`})},async pa(){let e={page:1,limit:7},t={page:1,limit:5};try{let n=await Z(e);this.homework=await ae(t);let o=n.items.filter((e=>1===e.hadSignup)).map((e=>({...e,timerId:null,hours:0,minutes:0,seconds:0})));o.length>0?(this.participatingActivitiess=o,this.updateCountdown()):I("log","at pages/pagesall/mypage.vue:188","未找到已经报名的活动")}catch(n){I("error","at pages/pagesall/mypage.vue:191","获取活动详情失败:",n)}},setInfo(){uni.navigateTo({url:"/pages/pagesall/mypage/PersonalData"})},handleSignup(e){uni.navigateTo({url:`/pages/pagesall/home/signUp?id=${e}`})},updateCountdown(){const e=(new Date).getTime(),t=Math.floor(e/1e3);this.participatingActivitiess.forEach((e=>{if(isNaN(e.end_time))e.hours=e.minutes=e.seconds=0;else{const n=e.end_time-t;n>0?(e.hours=Math.floor(n/3600),e.minutes=Math.floor(n%3600/60),e.seconds=n%60):e.hours=e.minutes=e.seconds=0}}))},goSet(){uni.navigateTo({url:"/pages/pagesall/mypage/Set"})},toggle(e){I("log","at pages/pagesall/mypage.vue:235",e),"我的作业"===e?uni.navigateTo({url:"/pages/pagesall/mypage/myHomework"}):"班级课程"===e?uni.navigateTo({url:"/pages/pagesall/mypage/myCourses"}):"班级群"===e?uni.navigateTo({url:"/pages/pagesall/mypage/classGroup"}):"我的老师"===e?uni.navigateTo({url:"/pages/pagesall/mypage/teachermsg"}):"历史测评"===e&&uni.navigateTo({url:"/pages/pagesall/mypage/historyAssessment"})},myInfo(){uni.navigateTo({url:"/pages/pagesall/mypage/individualmsg"})}}},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("activity-item");return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("view",{class:"titleHome"},[e.createElementVNode("view",{class:"nameId"},[e.createElementVNode("view",{class:"head",onClick:n[0]||(n[0]=(...e)=>s.setInfo&&s.setInfo(...e))},[e.createElementVNode("img",{style:{width:"88rpx",height:"88rpx","border-radius":"50%"},src:s.userInfo.avatar},null,8,["src"])]),e.createElementVNode("view",{class:"name",onClick:n[1]||(n[1]=(...e)=>s.myInfo&&s.myInfo(...e))},[e.createElementVNode("text",{class:"textname"},e.toDisplayString(s.userInfo.nickname),1),e.createElementVNode("text",{class:"textid"},"ID:"+e.toDisplayString(s.userInfo.id),1),e.createElementVNode("view",{class:"posit"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng5b0a65fd47f768b4c8f59ba6e2c415f9fe8dd593587d9ad6bbcd9f647066dc01",alt:""}),e.createElementVNode("text",{class:"postext"},e.toDisplayString(s.userInfo.school_name),1)])]),e.createElementVNode("view",{class:"classID"},e.toDisplayString(s.userInfo.classly_name),1)])]),e.createElementVNode("view",{class:"icon",onClick:n[2]||(n[2]=(...e)=>s.goSet&&s.goSet(...e))},[e.createElementVNode("image",{class:"icon_2",referrerpolicy:"no-referrer",src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng934ba38bd39e53f863bede7e013d900beae25399907156b67da9b28d156a6777"})])]),e.createElementVNode("view",{class:"features"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.features,(t=>(e.openBlock(),e.createElementBlock("view",{class:"feature",key:t.title,onClick:e=>s.toggle(t.title)},[e.createElementVNode("image",{src:t.icon,class:"feature-icon"},null,8,["src"]),e.createElementVNode("text",null,e.toDisplayString(t.title),1)],8,["onClick"])))),128))]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("text",{class:"section-title"},"今日作业"),e.createElementVNode("view",{style:{"margin-top":"20rpx","justify-content":"flex-start"},class:"homework-list homeworkScroll"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.homework,(t=>(e.openBlock(),e.createElementBlock("view",{class:"homework",key:t.title,onClick:e=>s.goTask(t.id)},[e.createElementVNode("image",{class:"task-image",src:t.image},null,8,["src"]),e.createElementVNode("view",{class:"task-details"},[e.createElementVNode("text",{class:"task-title"},e.toDisplayString(t.title),1),e.createElementVNode("view",{class:"task-status"},[e.createElementVNode("text",null,e.toDisplayString(t.from),1),e.createElementVNode("view",{class:"status_img"},[e.createElementVNode("image",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng2da006757aba600979e398ec0c09e7190d6db896432216ec206836dc25bb68e4",mode:"aspectFill"}),e.createElementVNode("text",null,e.toDisplayString(t.status),1)])])])],8,["onClick"])))),128))])]),e.createElementVNode("view",{style:{"margin-top":"48rpx"}},[e.createElementVNode("text",{style:{"font-weight":"bold","font-size":"36rpx",color:"#000000","line-height":"42rpx"},class:"section-title"},"我参加的活动")]),e.createElementVNode("view",{class:"section"},[i.participatingActivitiess.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.participatingActivitiess,((t,n)=>{var o,a;return e.openBlock(),e.createBlock(r,{key:n,online:t.is_online,techerimg:t.avatar,biaoti:t.title,laoshi:t.description,star:t.s_time,end:t.e_time,hearimg:t.teacher_avatar,teachername:t.teacher_name,hours:t.hours,minutes:t.minutes,seconds:t.seconds,pers:(null==(o=t.signup_member)?void 0:o.total)||0,money:t.price,imgs:(null==(a=t.signup_member)?void 0:a.items)||[],signedUp:t.hadSignup,onSignup:()=>s.handleSignup(t.id)},null,8,["online","techerimg","biaoti","laoshi","star","end","hearimg","teachername","hours","minutes","seconds","pers","money","imgs","signedUp","onSignup"])})),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))])])}],["__scopeId","data-v-bb7a323c"]]);const Pl=L({data:()=>({intervalId:null,activityId:null,options:null,testHour:1,testMinute:0,testSecond:0,start:!1,timeupSecond:10,statusBarHeight:"",matchedDetails:null}),computed:{images:()=>se().images,listdata:()=>se().listdata},mounted(){this.details()},onLoad(e){this.statusBarHeight=getApp().globalData.top,this.activityId=e.id,this.options=e},onUnload(){},methods:{async details(){try{const e=(await Z(this.options)).items.find((e=>e.id===Number(this.activityId)));e?(this.matchedDetails=e,this.updateCountdown()):I("log","at pages/pagesall/home/signUp.vue:165","未找到对应的活动详情")}catch(e){I("error","at pages/pagesall/home/signUp.vue:168","获取活动详情失败:",e)}},timeup(){uni.showToast({title:"时间到"}),this.timeupSecond=29},formatTime:e=>e.toString().padStart(2,"0"),updateCountdown(){const e=(new Date).getTime(),t=Math.floor(e/1e3);if(this.matchedDetails&&!isNaN(this.matchedDetails.end_time)){const e=this.matchedDetails.end_time-t;e>0?(this.testHour=Math.floor(e/3600),this.testMinute=Math.floor(e%3600/60),this.testSecond=e%60):this.testHour=this.testMinute=this.testSecond=0}else this.testHour=this.testMinute=this.testSecond=0},async btnsignup(){const e=se(),{user_id:t}=e.userinfo;var n;if(t)if(this.activityId)if(0!==this.testHour||0!==this.testMinute||0!==this.testSecond)try{const e=await(n={user_id:t,activity_id:Number(this.activityId)},W("/activity/signup",n));if(1===e.code){uni.showToast({title:e.msg||"报名成功",icon:"success",duration:2e3}),this.matchedDetails?this.matchedDetails.hadSignup=!0:I("log","at pages/pagesall/home/signUp.vue:250","matchedDetails 尚未加载");await Z(this.options)}else uni.showToast({title:e.msg||"报名失败，请重试",icon:"error",duration:2e3})}catch(o){I("error","at pages/pagesall/home/signUp.vue:264","报名失败:",o)}else uni.showToast({title:"活动已结束",icon:"none"});else uni.showToast({title:"活动 ID 不存在",icon:"none"});else uni.showToast({title:"用户未登录，请先登录",icon:"none"})}}},[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uni-countdown"),Il);return e.openBlock(),e.createElementBlock("view",{style:{"overflow-x":"hidden"}},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"homePage"},[s.images.length?(e.openBlock(),e.createElementBlock("swiper",{key:0,class:"swiper-container","indicator-dots":"true",autoplay:"true",interval:"3000",circular:"true","indicator-color":"#ddd","indicator-active-color":"#333"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.images,((t,n)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:n},[e.createElementVNode("image",{src:t.thumb,class:"swiper-image"},null,8,["src"])])))),128))])):e.createCommentVNode("",!0),i.matchedDetails?(e.openBlock(),e.createElementBlock("view",{key:1,class:"actiClass"},[e.createElementVNode("view",{class:"actitme"},[e.createElementVNode("view",{class:"techerImg",style:{width:"192rpx",height:"176rpx","border-radius":"8rpx"}},[e.createElementVNode("img",{style:{width:"100%",height:"100%"},src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng13a2fb02e015caf1325ed0ae70a60ac4263056e78d6de603517f5fae96ceca41",alt:""})]),e.createElementVNode("view",{class:"listindex"},[e.createElementVNode("view",{class:"actitmeText1"},e.toDisplayString(i.matchedDetails.title),1),e.createElementVNode("view",{class:"actitmeText2"},"计划人数："+e.toDisplayString(i.matchedDetails.planum||20)+"人",1),e.createElementVNode("view",{class:"actImg"},[e.createElementVNode("img",{src:i.matchedDetails.teacher_avatar,alt:""},null,8,["src"]),e.createElementVNode("view",{class:"actTeacher"},[e.createElementVNode("text",null,e.toDisplayString(i.matchedDetails.teacher_name),1),e.createElementVNode("text",{style:{"font-size":"20rpx","margin-top":"10rpx"}},"授课")]),e.createElementVNode("view",{class:"acttime"},[e.createElementVNode("text",{style:{"font-size":"24rpx"}},"距结束还剩:"),e.createVNode(r,{"show-day":!1,hour:i.testHour,minute:i.testMinute,second:i.testSecond,color:"#FFFFFF","background-color":"#007AFF"},null,8,["hour","minute","second"])])]),e.createElementVNode("view",{class:"endbaoming"},[e.createElementVNode("view",{class:"peopers"},[e.createElementVNode("image",{style:{width:"24rpx",height:"32rpx"},src:Tl,mode:"aspectFit"}),e.createElementVNode("view",{class:"peotext",style:{"font-size":"20rpx"}},e.toDisplayString(i.matchedDetails.signup_member.total)+"人报名",1),e.createElementVNode("view",{class:"imgbox"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.matchedDetails.signup_member.items,((t,n)=>(e.openBlock(),e.createElementBlock("image",{src:t.avatar?t.avatar:"",key:n,style:e.normalizeStyle({position:"absolute",right:`calc(20rpx * ${n})`,zIndex:10-n,width:"30rpx",height:"30rpx",borderRadius:"50%"})},null,12,["src"])))),128))])]),e.createElementVNode("view",{class:"perbtn"},[e.createElementVNode("view",{class:"permoney"},e.toDisplayString(i.matchedDetails.price<=0?"免费":"￥"+t.item.price),1),e.createElementVNode("view",{class:"gobtn",onClick:n[0]||(n[0]=(...e)=>s.btnsignup&&s.btnsignup(...e)),style:e.normalizeStyle(i.matchedDetails.hadSignup?{backgroundColor:"#999999"}:{background:"#ff9e02"})},e.toDisplayString(i.matchedDetails.hadSignup?"已报名":"立即报名"),5)])])])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"eventDetails"},[e.createElementVNode("view",{class:"detaTitle"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng771a065a39e551cb80b0755732dcaf20cc3ae52e9d4ee72c3e9f6c9d414f07cb",alt:""}),e.createElementVNode("text",{class:"detaText"},"活动详情")]),i.matchedDetails?(e.openBlock(),e.createElementBlock("div",{key:0,class:"detaxiangqing",innerHTML:i.matchedDetails.content},null,8,["innerHTML"])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))])])])}]]),Gl="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),xl="undefined"!=typeof uni&&"undefined"==typeof window,Bl="undefined"!=typeof uni,Vl=("undefined"!=typeof uni||"undefined"!=typeof window)&&!(Gl||xl),Fl=Gl?wx:Bl?uni:"undefined"!=typeof window?window:{},Hl=Vl&&window&&window.navigator&&window.navigator.userAgent||"",jl=/Android/i.test(Hl),ql=/(?:Windows Phone)/.test(Hl),zl=/(?:SymbianOS)/.test(Hl),Kl=Vl&&("ontouchstart"in window||navigator.maxTouchPoints>0)&&!!Vl&&(!!/Tablet|Pad/i.test(Hl)||(window.matchMedia("(orientation: portrait)").matches?window.innerWidth>=768&&window.innerHeight>=1024:window.innerWidth>=1024&&window.innerHeight>=768)),$l=/iPhone/i.test(Hl)||/iPod/i.test(Hl),Yl=Gl,Wl=jl||ql||zl||$l||Kl,Jl=Vl&&!Wl,Xl=xl&&!Gl;function Zl(){let e="";return Jl?e="pc":Wl?e="h5":Yl?e="wechat":Xl&&(e="app"),e}const Ql=new Map;function eu(e,t){if(!e)return Promise.reject(new Error(`getBoundingClientRect get error selector ${typeof e}.`));if(window||document){const t="object"==typeof e?e:document.querySelector(e);if(!t)return Promise.reject(new Error(`getBoundingClientRect can't find ${e} dom.`));const n=t.getBoundingClientRect();return Promise.resolve({id:t.id,top:n.top,left:n.left,right:n.right,bottom:n.bottom,width:n.width,height:n.height,x:n.x,y:n.y})}if(Bl){if(!t)return Promise.reject(new Error("getBoundingClientRect need instanceName in params."));const n=uni.createSelectorQuery().in(Ql.get(t));return new Promise(((t,o)=>{n.select(e).boundingClientRect((e=>{e&&t(e)})).exec(),setTimeout((()=>o(new Error(`getBoundingClientRect ${e} timeout.`))),500)}))}return Promise.reject(new Error("getBoundingClientRect occur error"))}function tu(e,t){if(!e)return Promise.reject(new Error(`getScrollInfo get error selector ${typeof e}.`));if(!Bl&&window){const t="object"==typeof e?e:document.querySelector(e);return t?Promise.resolve({id:t.id,scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,scrollWidth:t.scrollWidth,scrollHeight:t.scrollHeight}):Promise.reject(new Error(`getScrollInfo can't find ${e} dom.`))}if(Bl){if(!t)return Promise.reject(new Error("getScrollInfo need instanceName in params."));const n=uni.createSelectorQuery().in(Ql.get(t));return new Promise(((t,o)=>{n.select(e).scrollOffset((e=>{e&&t(e)})).exec(),setTimeout((()=>o(new Error(`getScrollInfo ${e} timeout.`))),500)}))}return Promise.reject(new Error("getScrollInfo occur error"))}class nu{constructor(){if(nu.instance)return nu.instance;nu.instance=this,this.eventCallback=null,this.listener=null,this.button=0,this.init()}init(){Vl&&(this.eventCallback=e=>{this.listener&&this.listener(e)},document.addEventListener("mousedown",this.eventCallback))}listen(e){if(Vl){const{domRefs:t,ignoreDomRefs:n,handler:o,button:a=0}=e;this.button=a,this.listener=e=>{const a=Array.isArray(n)?n:[n];for(const t of a)if(t&&t.contains(e.target))return;const i=Array.isArray(t)?t:[t];for(const t of i)if(t&&t.contains(e.target)&&this.button===e.button)return;o(e),this.remove()}}}remove(){this.listener=null,this.button=-1}}function ou(e){const{element:t,onLongPress:n,options:o={}}=e;if(!t||!n)throw new Error("addLongPressEventListener missing arguments");const{duration:a=800,eventDelegation:i}=o;let s;function r(){clearTimeout(s),l()}function c(){clearTimeout(s),l()}function l(){t.removeEventListener("pointerup",r),t.removeEventListener("pointermove",c)}t.addEventListener("pointerdown",(e=>{const o=e.target,l=(null==i?void 0:i.subSelector)?o.closest(i.subSelector)||void 0:o,u=e.currentTarget;s=setTimeout((()=>n(e,l,u)),a),t.addEventListener("pointerup",r),t.addEventListener("pointermove",c)}))}I("log","at node_modules/@tencentcloud/universal-api/index.js:1","UniversalAPI.VERSION:2.3.2");const au=new nu,iu="pc"===Zl(),su="h5"===Zl(),ru="wechat"===Zl(),cu="app"===Zl(),lu="undefined"!=typeof uni,uu=su||ru||cu,du=e.defineComponent({__name:"Icon",props:{file:{default:""},size:{},width:{default:"20px"},height:{default:"20px"},hotAreaSize:{}},emits:["onClick"],setup(t,{emit:n}){const o=n,a=t,i=e.computed((()=>{if(a.hotAreaSize)return isNaN(Number(a.hotAreaSize))?String(a.hotAreaSize):`${a.hotAreaSize}px`})),s=e.computed((()=>a.size?a.size:a.width)),r=e.computed((()=>a.size?a.size:a.height)),c=e=>{o("onClick",e)};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["common-icon-container",!e.unref(iu)&&"common-icon-container-mobile"]),style:e.normalizeStyle({padding:i.value}),onClick:c},[e.unref(cu)?(e.openBlock(),e.createElementBlock("image",{key:0,class:"common-icon",src:a.file,style:e.normalizeStyle({width:s.value,height:r.value})},null,12,["src"])):(e.openBlock(),e.createElementBlock("img",{key:1,class:"common-icon",src:a.file,style:e.normalizeStyle({width:s.value,height:r.value})},null,12,["src"]))],6))}}),pu=L(du,[["__scopeId","data-v-50a4e595"]]),hu="/assets/search.dabca596.svg",gu="/assets/input-close.3bf506b7.svg",mu=L(e.defineComponent({__name:"index",props:{placeholder:{type:String,default:()=>Tr.t("TUISearch.搜索")},searchType:{type:String,default:"global",validator:e=>["global","conversation"].includes(e)}},setup(t){const n=t,o=e.ref(""),a=e.ref(""),i=e.ref(!1);function s(e){(null==e?void 0:e.searchType)===(null==n?void 0:n.searchType)&&(a.value=null==e?void 0:e.value,o.value=null==e?void 0:e.value)}function r(e){(null==e?void 0:e.searchType)===(null==n?void 0:n.searchType)&&(i.value=null==e?void 0:e.isSearching)}e.onMounted((()=>{kr.watch(oi.SEARCH,{currentSearchInputValue:s,currentSearchingStatus:r})})),e.onUnmounted((()=>{kr.unwatch(oi.SEARCH,{currentSearchInputValue:s,currentSearchingStatus:r})}));const c=()=>{o.value!==a.value&&kr.update(oi.SEARCH,"currentSearchInputValue",{value:o.value,searchType:n.searchType})},l=()=>{i.value=!1,kr.update(oi.SEARCH,"currentSearchingStatus",{isSearching:!1,searchType:n.searchType}),kr.update(oi.SEARCH,"currentSearchInputValue",{value:"",searchType:n.searchType})},u=()=>{kr.update(oi.SEARCH,"currentSearchingStatus",{isSearching:!0,searchType:n.searchType})},d=()=>{var e;null==(e=null==Fl?void 0:Fl.hideKeyboard)||e.call(Fl)};return(t,a)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["tui-search-input-container",!e.unref(iu)&&"tui-search-input-container-h5","global"===n.searchType?"tui-search-input-container-global":"tui-search-input-container-conversation"])},[e.createElementVNode("div",{class:e.normalizeClass(["tui-search-input",!e.unref(iu)&&"tui-search-input-h5"])},[e.createElementVNode("div",{class:"tui-search-input-left"},[e.createVNode(pu,{class:"icon",file:e.unref(hu),width:"14px",height:"14px"},null,8,["file"])]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),class:"tui-search-input-main",type:"text",placeholder:n.placeholder,focus:!1,enterkeyhint:"search",onBlur:d,onKeyup:e.withKeys(c,["enter"]),onConfirm:c,onClick:e.withModifiers(u,["stop","prevent"])},null,40,["placeholder"]),[[e.vModelText,o.value]]),i.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-search-input-right",onClick:l},[e.createVNode(pu,{class:"icon",file:e.unref(gu),width:"14px",height:"14px"},null,8,["file"])])):e.createCommentVNode("",!0)],2),!e.unref(iu)&&i.value&&"global"===n.searchType?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-search-input-cancel",!e.unref(iu)&&"tui-search-input-h5-cancel"]),onClick:l},e.toDisplayString(e.unref(Tr).t("TUISearch.取消")),3)):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-36d36cb4"]]),fu={allMessage:{key:"allMessage",label:"全部",value:[Cr.TYPES.MSG_TEXT,Cr.TYPES.MSG_FILE,Cr.TYPES.MSG_IMAGE,Cr.TYPES.MSG_VIDEO,Cr.TYPES.MSG_AUDIO,Cr.TYPES.MSG_LOCATION,Cr.TYPES.MSG_CUSTOM,Cr.TYPES.MSG_MERGER]},textMessage:{key:"textMessage",label:"文本",value:[Cr.TYPES.MSG_TEXT]},fileMessage:{key:"fileMessage",label:"文件",value:[Cr.TYPES.MSG_FILE]},imageMessage:{key:"imageMessage",label:"图片/视频",value:[Cr.TYPES.MSG_IMAGE,Cr.TYPES.MSG_VIDEO]},otherMessage:{key:"otherMessage",label:"其他",value:[Cr.TYPES.MSG_AUDIO,Cr.TYPES.MSG_LOCATION,Cr.TYPES.MSG_CUSTOM,Cr.TYPES.MSG_MERGER]}};Object.keys(fu).filter((e=>"all"!==e));const vu={global:fu.allMessage,conversation:fu.textMessage},_u=["allMessage","textMessage","fileMessage","otherMessage"],yu=Object.keys(fu).filter((e=>null==_u?void 0:_u.includes(e))).reduce(((e,t)=>(e[t]=fu[t],e)),{}),Iu=["textMessage","fileMessage","imageMessage","otherMessage"],Eu=Object.keys(fu).filter((e=>null==Iu?void 0:Iu.includes(e))).reduce(((e,t)=>(e[t]=fu[t],e)),{}),Cu=86400,ku={all:{key:"all",label:"全部",value:{timePosition:0,timePeriod:0}},oneDay:{key:"today",label:"今天",value:{timePosition:0,timePeriod:Cu}},threeDay:{key:"threeDays",label:"近三天",value:{timePosition:0,timePeriod:259200}},sevenDay:{key:"sevenDays",label:"近七天",value:{timePosition:0,timePeriod:604800}}},Tu=ku.all;var Mu={exports:{}};!function(e){e.exports=function(){var e=1e3,t=6e4,n=36e5,o="millisecond",a="second",i="minute",s="hour",r="day",c="week",l="month",u="quarter",d="year",p="date",h="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},v=function(e,t,n){var o=String(e);return!o||o.length>=t?e:""+Array(t+1-o.length).join(n)+e},_={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),o=Math.floor(n/60),a=n%60;return(t<=0?"+":"-")+v(o,2,"0")+":"+v(a,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var o=12*(n.year()-t.year())+(n.month()-t.month()),a=t.clone().add(o,l),i=n-a<0,s=t.clone().add(o+(i?-1:1),l);return+(-(o+(n-a)/(i?a-s:s-a))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:d,w:c,d:r,D:p,h:s,m:i,s:a,ms:o,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",I={};I[y]=f;var E="$isDayjsObject",C=function(e){return e instanceof S||!(!e||!e[E])},k=function e(t,n,o){var a;if(!t)return y;if("string"==typeof t){var i=t.toLowerCase();I[i]&&(a=i),n&&(I[i]=n,a=i);var s=t.split("-");if(!a&&s.length>1)return e(s[0])}else{var r=t.name;I[r]=t,a=r}return!o&&a&&(y=a),a||!o&&y},T=function(e,t){if(C(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new S(n)},M=_;M.l=k,M.i=C,M.w=function(e,t){return T(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var S=function(){function f(e){this.$L=k(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[E]=!0}var v=f.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(M.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var o=t.match(g);if(o){var a=o[2]-1||0,i=(o[7]||"0").substring(0,3);return n?new Date(Date.UTC(o[1],a,o[3]||1,o[4]||0,o[5]||0,o[6]||0,i)):new Date(o[1],a,o[3]||1,o[4]||0,o[5]||0,o[6]||0,i)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return M},v.isValid=function(){return!(this.$d.toString()===h)},v.isSame=function(e,t){var n=T(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return T(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<T(e)},v.$g=function(e,t,n){return M.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,o=!!M.u(t)||t,u=M.p(e),h=function(e,t){var a=M.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return o?a:a.endOf(r)},g=function(e,t){return M.w(n.toDate()[e].apply(n.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},m=this.$W,f=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(u){case d:return o?h(1,0):h(31,11);case l:return o?h(1,f):h(0,f+1);case c:var y=this.$locale().weekStart||0,I=(m<y?m+7:m)-y;return h(o?v-I:v+(6-I),f);case r:case p:return g(_+"Hours",0);case s:return g(_+"Minutes",1);case i:return g(_+"Seconds",2);case a:return g(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,c=M.p(e),u="set"+(this.$u?"UTC":""),h=(n={},n[r]=u+"Date",n[p]=u+"Date",n[l]=u+"Month",n[d]=u+"FullYear",n[s]=u+"Hours",n[i]=u+"Minutes",n[a]=u+"Seconds",n[o]=u+"Milliseconds",n)[c],g=c===r?this.$D+(t-this.$W):t;if(c===l||c===d){var m=this.clone().set(p,1);m.$d[h](g),m.init(),this.$d=m.set(p,Math.min(this.$D,m.daysInMonth())).$d}else h&&this.$d[h](g);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[M.p(e)]()},v.add=function(o,u){var p,h=this;o=Number(o);var g=M.p(u),m=function(e){var t=T(h);return M.w(t.date(t.date()+Math.round(e*o)),h)};if(g===l)return this.set(l,this.$M+o);if(g===d)return this.set(d,this.$y+o);if(g===r)return m(1);if(g===c)return m(7);var f=(p={},p[i]=t,p[s]=n,p[a]=e,p)[g]||1,v=this.$d.getTime()+o*f;return M.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var o=e||"YYYY-MM-DDTHH:mm:ssZ",a=M.z(this),i=this.$H,s=this.$m,r=this.$M,c=n.weekdays,l=n.months,u=n.meridiem,d=function(e,n,a,i){return e&&(e[n]||e(t,o))||a[n].slice(0,i)},p=function(e){return M.s(i%12||12,e,"0")},g=u||function(e,t,n){var o=e<12?"AM":"PM";return n?o.toLowerCase():o};return o.replace(m,(function(e,o){return o||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return M.s(t.$y,4,"0");case"M":return r+1;case"MM":return M.s(r+1,2,"0");case"MMM":return d(n.monthsShort,r,l,3);case"MMMM":return d(l,r);case"D":return t.$D;case"DD":return M.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return d(n.weekdaysMin,t.$W,c,2);case"ddd":return d(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(i);case"HH":return M.s(i,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return g(i,s,!0);case"A":return g(i,s,!1);case"m":return String(s);case"mm":return M.s(s,2,"0");case"s":return String(t.$s);case"ss":return M.s(t.$s,2,"0");case"SSS":return M.s(t.$ms,3,"0");case"Z":return a}return null}(e)||a.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(o,p,h){var g,m=this,f=M.p(p),v=T(o),_=(v.utcOffset()-this.utcOffset())*t,y=this-v,I=function(){return M.m(m,v)};switch(f){case d:g=I()/12;break;case l:g=I();break;case u:g=I()/3;break;case c:g=(y-_)/6048e5;break;case r:g=(y-_)/864e5;break;case s:g=y/n;break;case i:g=y/t;break;case a:g=y/e;break;default:g=y}return h?g:M.a(g)},v.daysInMonth=function(){return this.endOf(l).$D},v.$locale=function(){return I[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),o=k(e,t,!0);return o&&(n.$L=o),n},v.clone=function(){return M.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},f}(),D=S.prototype;return T.prototype=D,[["$ms",o],["$s",a],["$m",i],["$H",s],["$W",r],["$M",l],["$y",d],["$D",p]].forEach((function(e){D[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),T.extend=function(e,t){return e.$i||(e(t,S,T),e.$i=!0),T},T.locale=k,T.isDayjs=C,T.unix=function(e){return T(1e3*e)},T.en=I[y],T.Ls=I,T.p={},T}()}(Mu);var Su=Mu.exports;const Du=qa(Su);var bu={exports:{}};!function(e){e.exports=function(e,t,n){var o=t.prototype,a=function(e){return e&&(e.indexOf?e:e.s)},i=function(e,t,n,o,i){var s=e.name?e:e.$locale(),r=a(s[t]),c=a(s[n]),l=r||c.map((function(e){return e.slice(0,o)}));if(!i)return l;var u=s.weekStart;return l.map((function(e,t){return l[(t+(u||0))%7]}))},s=function(){return n.Ls[n.locale()]},r=function(e,t){return e.formats[t]||e.formats[t.toUpperCase()].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(e,t,n){return t||n.slice(1)}))},c=function(){var e=this;return{months:function(t){return t?t.format("MMMM"):i(e,"months")},monthsShort:function(t){return t?t.format("MMM"):i(e,"monthsShort","months",3)},firstDayOfWeek:function(){return e.$locale().weekStart||0},weekdays:function(t){return t?t.format("dddd"):i(e,"weekdays")},weekdaysMin:function(t){return t?t.format("dd"):i(e,"weekdaysMin","weekdays",2)},weekdaysShort:function(t){return t?t.format("ddd"):i(e,"weekdaysShort","weekdays",3)},longDateFormat:function(t){return r(e.$locale(),t)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};o.localeData=function(){return c.bind(this)()},n.localeData=function(){var e=s();return{firstDayOfWeek:function(){return e.weekStart||0},weekdays:function(){return n.weekdays()},weekdaysShort:function(){return n.weekdaysShort()},weekdaysMin:function(){return n.weekdaysMin()},months:function(){return n.months()},monthsShort:function(){return n.monthsShort()},longDateFormat:function(t){return r(e,t)},meridiem:e.meridiem,ordinal:e.ordinal}},n.months=function(){return i(s(),"months")},n.monthsShort=function(){return i(s(),"monthsShort","months",3)},n.weekdays=function(e){return i(s(),"weekdays",null,null,e)},n.weekdaysShort=function(e){return i(s(),"weekdaysShort","weekdays",3,e)},n.weekdaysMin=function(e){return i(s(),"weekdaysMin","weekdays",2,e)}}}(bu);const wu=qa(bu.exports);var Nu={exports:{}};!function(e){e.exports=function(e,t){t.prototype.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)}}}(Nu);const Lu=qa(Nu.exports);var Ru={exports:{}};!function(e){e.exports=function(e,t){t.prototype.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)}}}(Ru);const Au=qa(Ru.exports);!function(e){e.exports=function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e),o={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(e,t){return"W"===t?e+"周":e+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(e,t){var n=100*e+t;return n<600?"凌晨":n<900?"早上":n<1100?"上午":n<1300?"中午":n<1800?"下午":"晚上"}};return n.default.locale(o,null,!0),o}(Su)}({exports:{}});const Ou=L(e.defineComponent({__name:"date-table",props:{type:{type:String,default:"range"},currentPanelDate:{type:Su.Dayjs,default:()=>Du()},date:{type:Su.Dayjs,default:null},startDate:{type:Su.Dayjs,default:null},endDate:{type:Su.Dayjs,default:null}},emits:["pick"],setup(t,{emit:n}){const o=t,a=n,i=e.getCurrentInstance(),s=e.ref([[],[],[],[],[],[]]),r=e.ref(Du(o.currentPanelDate||null)),c=e.ref(Du(o.date||null)),l=e.ref(Du(o.startDate||null)),u=e.ref(Du(o.endDate||null)),d=e.computed((()=>Du.weekdaysShort())),p=e.computed((()=>d.value.map((e=>e.substring(1))))),h=e.computed((()=>{var e;const t=null==(e=r.value)?void 0:e.startOf("month");return null==t?void 0:t.subtract((null==t?void 0:t.day())||7,"day")})),g=e.computed((()=>{var e,t,n,a,i;const d=s.value,g=p.value.length,m=null==(e=r.value)?void 0:e.startOf("month"),f=(null==m?void 0:m.day())||7,v=null==m?void 0:m.daysInMonth();let _=1;for(let r=0;r<s.value.length;r++)for(let e=0;e<g;e++){const s=null==(t=h.value)?void 0:t.add(_,"day"),p=null==s?void 0:s.date(),g="single"===o.type&&(null==s?void 0:s.format("YYYY-MM-DD"))===(null==(n=c.value)?void 0:n.format("YYYY-MM-DD")),m="range"===o.type&&(null==s?void 0:s.format("YYYY-MM-DD"))===(null==(a=l.value)?void 0:a.format("YYYY-MM-DD")),y="range"===o.type&&(null==s?void 0:s.format("YYYY-MM-DD"))===(null==(i=u.value)?void 0:i.format("YYYY-MM-DD")),I=(null==s?void 0:s.isSameOrBefore(u.value,"day"))&&(null==s?void 0:s.isSameOrAfter(l.value,"day"));let E="normal";_<f?E="prev-month":_-f>=v&&(E="next-month"),d[r][e]={type:E,date:s,text:p,isSelected:g||m||y,isSelectedStart:m,isSelectedEnd:y,isInRange:I},_++}return d}));return e.watch((()=>[o.currentPanelDate,o.date,o.startDate,o.endDate]),(()=>{r.value=Du(o.currentPanelDate||null),c.value=Du(o.date||null),l.value=Du(o.startDate||null),u.value=Du(o.endDate||null),e.nextTick((()=>{var e;null==(e=null==i?void 0:i.proxy)||e.$forceUpdate()}))}),{deep:!0,immediate:!0}),(t,n)=>(e.openBlock(),e.createElementBlock("table",{class:e.normalizeClass(["tui-date-table",!e.unref(iu)&&"tui-date-table-h5"]),cellspacing:"0",cellpadding:"0",role:"grid"},[e.createElementVNode("tbody",{class:"tui-date-table-body"},[e.createElementVNode("tr",{class:"tui-date-table-body-weeks"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,(t=>(e.openBlock(),e.createElementBlock("th",{key:t,class:"tui-date-table-body-weeks-item","aria-label":t+"",scope:"col"},e.toDisplayString(e.unref(Tr).t(`time.${t}`)),9,["aria-label"])))),128))]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value,((t,n)=>(e.openBlock(),e.createElementBlock("tr",{key:n,class:"tui-date-table-body-days"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t,((t,n)=>(e.openBlock(),e.createElementBlock("td",{key:n,class:e.normalizeClass(["tui-date-table-body-days-item",t.type])},[e.createElementVNode("div",{class:e.normalizeClass(["tui-date-table-body-days-item-cell",t.isSelected&&"selected",t.isSelectedStart&&"selected-start",t.isSelectedEnd&&"selected-end",t.isInRange&&"range"]),onClick:e=>{var n;"normal"===(null==(n=t)?void 0:n.type)&&a("pick",n)}},[e.createElementVNode("span",{class:"tui-date-table-body-days-item-cell-text"},e.toDisplayString(t.text),1)],10,["onClick"])],2)))),128))])))),128))])],2))}}),[["__scopeId","data-v-c7ab6869"]]),Uu=L(e.defineComponent({__name:"date-picker-panel",props:{type:{type:String,default:"range"},date:{type:Su.Dayjs,default:()=>Du()},startDate:{type:Su.Dayjs,default:null},endDate:{type:Su.Dayjs,default:null},rangeType:{type:String,default:""},currentOtherPanelValue:{type:Su.Dayjs,default:null}},emits:["pick","change"],setup(t,{emit:n}){const o=t,a=n,i=e=>e?["tui-date-picker-panel-"+e,!iu&&"tui-date-picker-panel-h5-"+e]:["tui-date-picker-panel",!iu&&"tui-date-picker-panel-h5"],s=e.ref(),r=e.computed((()=>{var e;return null==(e=s.value)?void 0:e.get("year")})),c=e.computed((()=>{var e;return null==(e=s.value)?void 0:e.format("MMMM")})),l=e.computed((()=>{var e,t,n;const a=(null==(e=o.currentOtherPanelValue)?void 0:e.year())-1,i=null==(t=o.currentOtherPanelValue)?void 0:t.year(a);return"right"===o.rangeType||(null==(n=s.value)?void 0:n.isBefore(i,"year"))})),u=e.computed((()=>{var e,t,n;const a=(null==(e=o.currentOtherPanelValue)?void 0:e.month())-1,i=null==(t=o.currentOtherPanelValue)?void 0:t.month(a);return"right"===o.rangeType||(null==(n=s.value)?void 0:n.isBefore(i,"month"))})),d=e.computed((()=>{var e,t,n;const a=(null==(e=o.currentOtherPanelValue)?void 0:e.year())+1,i=null==(t=o.currentOtherPanelValue)?void 0:t.year(a);return"left"===o.rangeType||(null==(n=s.value)?void 0:n.isAfter(i,"year"))})),p=e.computed((()=>{var e,t,n;const a=(null==(e=o.currentOtherPanelValue)?void 0:e.month())+1,i=null==(t=o.currentOtherPanelValue)?void 0:t.month(a);return"left"===o.rangeType||(null==(n=s.value)?void 0:n.isAfter(i,"month"))}));function h(e){a("pick",e)}function g(e,t){s.value=Du(s.value.toDate()).add(t,e),a("change",s.value)}return e.onBeforeMount((()=>{switch(o.type){case"single":s.value=(o.date&&(null==(e=Du(o.date))?void 0:e.isValid())?{date:null==o?void 0:o.date}:{date:Du()}).date,a("change",s.value);break;case"range":s.value=(()=>{var e;switch(o.rangeType){case"left":return o.startDate&&Du.isDayjs(o.startDate)?{date:null==o?void 0:o.startDate}:{date:Du()};case"right":if(o.endDate&&Du.isDayjs(o.endDate)&&(null==(e=null==o?void 0:o.endDate)?void 0:e.isAfter(o.startDate,"month")))return{date:null==o?void 0:o.endDate};{const e=(o.startDate||Du()).month();return{date:(o.startDate||Du()).month(e+1)}}default:return{date:Du()}}})().date,a("change",s.value)}var e})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass([i("")]),onMouseup:n[4]||(n[4]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("div",{class:e.normalizeClass([i("body")])},[e.createElementVNode("div",{class:e.normalizeClass([i("body-header")])},[e.createElementVNode("div",{class:e.normalizeClass([i("body-header-prev")])},[d.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([i("icon")]),onClick:n[0]||(n[0]=e=>g("year",-1))},[e.createVNode(pu,{file:e.unref("/assets/d-left-arrow.d3dcfc22.svg"),width:"12px",height:"12px"},null,8,["file"])],2)):e.createCommentVNode("",!0),p.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass([i("icon")]),onClick:n[1]||(n[1]=e=>g("month",-1))},[e.createVNode(pu,{file:e.unref("/assets/left-arrow.dce2f352.svg"),width:"10px",height:"10px"},null,8,["file"])],2)):e.createCommentVNode("",!0)],2),e.createElementVNode("div",{class:e.normalizeClass([i("body-header-label")])},[e.createElementVNode("div",{class:e.normalizeClass([i("body-header-label-item")])},e.toDisplayString(r.value),3),e.createElementVNode("div",{class:e.normalizeClass([i("body-header-label-item")])},e.toDisplayString(e.unref(Tr).t(`time.${c.value}`)),3)],2),e.createElementVNode("div",{class:e.normalizeClass([i("body-header-next")])},[u.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([i("icon")]),onClick:n[2]||(n[2]=e=>g("month",1))},[e.createVNode(pu,{file:e.unref("/assets/right-arrow.0091db6c.svg"),width:"10px",height:"10px"},null,8,["file"])],2)):e.createCommentVNode("",!0),l.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass([i("icon")]),onClick:n[3]||(n[3]=e=>g("year",1))},[e.createVNode(pu,{file:e.unref("/assets/d-right-arrow.2202133f.svg"),width:"12px",height:"12px"},null,8,["file"])],2)):e.createCommentVNode("",!0)],2)],2),e.createElementVNode("div",{class:e.normalizeClass([i("body-content")])},[e.createVNode(Ou,{type:o.type,date:o.date,startDate:o.startDate,endDate:o.endDate,currentPanelDate:s.value,onPick:h},null,8,["type","date","startDate","endDate","currentPanelDate"])],2)],2)],34))}}),[["__scopeId","data-v-beb02290"]]),Pu=L(e.defineComponent({__name:"index",props:{type:{type:String,default:"range"},rangeTableType:{type:String,default:"one"},startPlaceholder:{type:String,default:()=>Tr.t("开始时间")},endPlaceholder:{type:String,default:()=>Tr.t("开始时间")},popupPosition:{type:String,default:"bottom"},defaultSingleDate:{type:Su.Dayjs,default:null,required:!1}},emits:["pick","change"],setup(t,{emit:n}){Du.extend(wu),Du.extend(Lu),Du.extend(Au),Du.locale("zh-cn");const o=n,a=t,i=e.ref(!1),s=e.ref("single"===a.type?null==a?void 0:a.defaultSingleDate:null),r=e.ref("single"===a.type?null==a?void 0:a.defaultSingleDate:null),c=e.ref("single"===a.type?null==a?void 0:a.defaultSingleDate:null),l=e.computed((()=>{var e;return null==(e=null==r?void 0:r.value)?void 0:e.format("YYYY/MM/DD")})),u=e.computed((()=>{var e;return null==(e=null==c?void 0:c.value)?void 0:e.format("YYYY/MM/DD")})),d=a.startPlaceholder,p=a.endPlaceholder,h=e.ref(),g=e.ref(),m=e=>{i.value=e},f=e=>{const t=[];return e.forEach((e=>{e?(t.push("tui-date-picker-"+e),!iu&&t.push("tui-date-picker-h5-"+e)):(t.push("tui-date-picker"),!iu&&t.push("tui-date-picker-h5"))})),t},v=e=>{var t,n,i;switch(a.type){case"single":r.value=e.date,c.value=e.date,s.value=e.date,o("change",e),o("pick",s.value),setTimeout((()=>{m(!1)}),300);break;case"range":(null==r?void 0:r.value)?(null==c?void 0:c.value)?(r.value=e.date,c.value=null):((null==(t=null==r?void 0:r.value)?void 0:t.isSameOrBefore(e.date,"day"))?c.value=e.date:(c.value=r.value,r.value=e.date),o("pick",{startDate:null==(n=null==r?void 0:r.value)?void 0:n.startOf("date"),endDate:null==(i=null==c?void 0:c.value)?void 0:i.endOf("date")}),setTimeout((()=>{m(!1)}),200)):r.value=e.date,o("change",{startDate:r.value,endDate:c.value,leftCurrentPanel:h.value,rightCurrentPanel:h.value})}},_=e=>{h.value=e,o("change",{startDate:r.value,endDate:c.value,leftCurrentPanel:h.value,rightCurrentPanel:h.value})},y=e=>{g.value=e,o("change",{startDate:r.value,endDate:c.value,leftCurrentPanel:h.value,rightCurrentPanel:h.value})};return(n,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass([f([""])])},[e.createElementVNode("div",{class:e.normalizeClass([f(["input"]),i.value&&f(["input-active"])]),onClick:o[2]||(o[2]=e=>m(!i.value))},[e.renderSlot(n.$slots,"start-icon",{},void 0,!0),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>l.value=e),placeholder:e.unref(d),class:e.normalizeClass([f(["input-start"])]),style:{"pointer-events":"none"},type:"text",readonly:!0,disabled:e.unref(lu),autocomplete:"false"},null,10,["placeholder","disabled"]),[[e.vModelText,l.value]]),"single"!==t.type?(e.openBlock(),e.createElementBlock("span",{key:0},"-")):e.createCommentVNode("",!0),"single"!==t.type?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:1,"onUpdate:modelValue":o[1]||(o[1]=e=>u.value=e),placeholder:e.unref(p),class:e.normalizeClass([f(["input-end"])]),style:{"pointer-events":"none"},type:"text",readonly:!0,disabled:e.unref(lu),autocomplete:"false"},null,10,["placeholder","disabled"])),[[e.vModelText,u.value]]):e.createCommentVNode("",!0),e.renderSlot(n.$slots,"end-icon",{},void 0,!0)],2),i.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([f(["dialog"])])},[e.createElementVNode("div",{class:e.normalizeClass([f(["dialog-container","dialog-container-"+t.rangeTableType,"dialog-container-"+t.popupPosition])])},[e.createVNode(Uu,{type:a.type,rangeType:"left",date:s.value,startDate:r.value,endDate:c.value,currentOtherPanelValue:g.value,onPick:v,onChange:_},null,8,["type","date","startDate","endDate","currentOtherPanelValue"]),"range"===a.type&&e.unref(iu)&&"two"===t.rangeTableType?(e.openBlock(),e.createBlock(Uu,{key:0,type:a.type,rangeType:"right",date:s.value,startDate:r.value,endDate:c.value,currentOtherPanelValue:h.value,onPick:v,onChange:y},null,8,["type","date","startDate","endDate","currentOtherPanelValue"])):e.createCommentVNode("",!0)],2)],2)):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-eae6bd41"]]),Gu="/assets/down-icon.fbb4047c.svg",xu="/assets/close-dark.f3809f45.svg",Bu=L(e.defineComponent({__name:"index",props:{popupPosition:{type:String,default:"bottom"},searchType:{type:String,default:"global",validator:e=>["global","conversation"].includes(e)}},emits:["searchConfigChange","closeInConversationSearch"],setup(t,{emit:n}){const o=t,a=n,i=e.computed((()=>"conversation"===(null==o?void 0:o.searchType)?Eu:yu)),s=e.ref(vu[null==o?void 0:o.searchType]),r=e.ref(Tu),c=e.computed((()=>"contact"!==s.value.key&&"group"!==s.value.key)),l=e.computed((()=>iu&&"global"===o.searchType&&!lu?"two":"one")),u=e.ref(!1);function d(e){(null==e?void 0:e.searchType)===(null==o?void 0:o.searchType)&&(s.value=(null==e?void 0:e.value)||vu[null==o?void 0:o.searchType])}function p(e){(null==e?void 0:e.searchType)===(null==o?void 0:o.searchType)&&(r.value=(null==e?void 0:e.value)||Tu)}e.onMounted((()=>{kr.watch(oi.SEARCH,{currentSearchMessageType:d,currentSearchMessageTime:p})})),e.onUnmounted((()=>{kr.unwatch(oi.SEARCH,{currentSearchMessageType:d,currentSearchMessageTime:p})}));const h=()=>{var e;"all"!==(null==(e=r.value)?void 0:e.key)?kr.update(oi.SEARCH,"currentSearchMessageTime",{value:Tu,searchType:o.searchType}):u.value=!0},g=e=>{var t,n,a;if("all"===(null==(t=r.value)?void 0:t.key)){const{startDate:t,endDate:i}=e,s=Number(((null==(n=null==i?void 0:i.toDate())?void 0:n.getTime())/1e3).toFixed(0)),c=s-Number(((null==(a=null==t?void 0:t.toDate())?void 0:a.getTime())/1e3).toFixed(0)),l={key:r.value.key,label:r.value.label,value:{timePosition:s,timePeriod:c}};kr.update(oi.SEARCH,"currentSearchMessageTime",{value:l,searchType:o.searchType})}},m=()=>{var e;u.value=!1,"all"===(null==(e=r.value)?void 0:e.key)&&kr.update(oi.SEARCH,"currentSearchMessageTime",{value:Tu,searchType:o.searchType})},f=()=>{a("closeInConversationSearch")};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["tui-search-container",!e.unref(iu)&&"tui-search-container-h5",e.unref(iu)&&`container-${o.popupPosition}`,`container-${o.searchType}`])},[e.createElementVNode("div",{class:e.normalizeClass([e.unref(iu)&&`tui-search-container-${o.popupPosition}`,!e.unref(iu)&&"tui-search-container-h5-main"])},["conversation"!==o.searchType||e.unref(lu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-search-header"},[e.createElementVNode("div",{class:"tui-search-header-title"},e.toDisplayString(e.unref(Tr).t("TUISearch.搜索会话内容")),1),e.createElementVNode("div",{class:"tui-search-header-close",onClick:f},[e.createVNode(pu,{file:e.unref(xu),width:"14px",height:"14px"},null,8,["file"])])])),e.createElementVNode("div",{class:"tui-search-tabs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n,class:e.normalizeClass(["tui-search-tabs-item",s.value.key===t.key&&"tui-search-tabs-item-selected"]),onClick:e=>{return n=t,void kr.update(oi.SEARCH,"currentSearchMessageType",{value:n,searchType:o.searchType});var n}},e.toDisplayString(e.unref(Tr).t(`TUISearch.${t.label}`)),11,["onClick"])))),128))]),e.renderSlot(t.$slots,"input",{},void 0,!0),c.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:"tui-search-time"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(ku),((t,a)=>(e.openBlock(),e.createElementBlock("div",{key:a,class:e.normalizeClass(["tui-search-time-item",r.value.key===t.key&&"tui-search-time-item-selected"]),onClick:e=>{return n=t,void(u.value&&"all"===n.key?u.value=!1:(u.value=!1,kr.update(oi.SEARCH,"currentSearchMessageTime",{value:n,searchType:o.searchType})));var n}},["all"===t.key?(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-search-time-item-picker"},[u.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-search-time-item-all",onClick:e.withModifiers(h,["stop"])},[e.createTextVNode(e.toDisplayString(e.unref(Tr).t("TUISearch.选择时间")+":  "+e.unref(Tr).t("TUISearch.全部"))+" ",1),e.createVNode(pu,{file:e.unref(Gu),width:"14px",height:"14px"},null,8,["file"])])),e.createElementVNode("div",{onClick:n[0]||(n[0]=e.withModifiers((()=>{}),["stop"]))},[u.value?(e.openBlock(),e.createBlock(Pu,{key:0,type:"range",rangeTableType:l.value,onPick:g},null,8,["rangeTableType"])):e.createCommentVNode("",!0)]),u.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:"tui-search-time-item-close",onClick:m},[e.createVNode(pu,{class:"icon",file:e.unref(gu),width:"14px",height:"14px"},null,8,["file"])])):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("div",{key:1},e.toDisplayString(e.unref(Tr).t(`TUISearch.${t.label}`)),1))],10,["onClick"])))),128))])):e.createCommentVNode("",!0),e.renderSlot(t.$slots,"result",{},void 0,!0)],2)],2))}}),[["__scopeId","data-v-912734a8"]]),Vu={"[TUIEmoji_Smile]":"[微笑]","[TUIEmoji_Expect]":"[期待]","[TUIEmoji_Blink]":"[眨眼]","[TUIEmoji_Guffaw]":"[大笑]","[TUIEmoji_KindSmile]":"[姨母笑]","[TUIEmoji_Haha]":"[哈哈哈]","[TUIEmoji_Cheerful]":"[愉快]","[TUIEmoji_Speechless]":"[无语]","[TUIEmoji_Amazed]":"[惊讶]","[TUIEmoji_Sorrow]":"[悲伤]","[TUIEmoji_Complacent]":"[得意]","[TUIEmoji_Silly]":"[傻了]","[TUIEmoji_Lustful]":"[色]","[TUIEmoji_Giggle]":"[憨笑]","[TUIEmoji_Kiss]":"[亲亲]","[TUIEmoji_Wail]":"[大哭]","[TUIEmoji_TearsLaugh]":"[哭笑]","[TUIEmoji_Trapped]":"[困]","[TUIEmoji_Mask]":"[口罩]","[TUIEmoji_Fear]":"[恐惧]","[TUIEmoji_BareTeeth]":"[龇牙]","[TUIEmoji_FlareUp]":"[发怒]","[TUIEmoji_Yawn]":"[打哈欠]","[TUIEmoji_Tact]":"[机智]","[TUIEmoji_Stareyes]":"[星星眼]","[TUIEmoji_ShutUp]":"[闭嘴]","[TUIEmoji_Sigh]":"[叹气]","[TUIEmoji_Hehe]":"[呵呵]","[TUIEmoji_Silent]":"[收声]","[TUIEmoji_Surprised]":"[惊喜]","[TUIEmoji_Askance]":"[白眼]","[TUIEmoji_Ok]":"[OK]","[TUIEmoji_Shit]":"[便便]","[TUIEmoji_Monster]":"[怪兽]","[TUIEmoji_Daemon]":"[恶魔]","[TUIEmoji_Rage]":"[恶魔怒]","[TUIEmoji_Fool]":"[衰]","[TUIEmoji_Pig]":"[猪]","[TUIEmoji_Cow]":"[牛]","[TUIEmoji_Ai]":"[AI]","[TUIEmoji_Skull]":"[骷髅]","[TUIEmoji_Bombs]":"[炸弹]","[TUIEmoji_Coffee]":"[咖啡]","[TUIEmoji_Cake]":"[蛋糕]","[TUIEmoji_Beer]":"[啤酒]","[TUIEmoji_Flower]":"[花]","[TUIEmoji_Watermelon]":"[瓜]","[TUIEmoji_Rich]":"[壕]","[TUIEmoji_Heart]":"[爱心]","[TUIEmoji_Moon]":"[月亮]","[TUIEmoji_Sun]":"[太阳]","[TUIEmoji_Star]":"[星星]","[TUIEmoji_RedPacket]":"[红包]","[TUIEmoji_Celebrate]":"[庆祝]","[TUIEmoji_Bless]":"[福]","[TUIEmoji_Fortune]":"[发]","[TUIEmoji_Convinced]":"[服]","[TUIEmoji_Prohibit]":"[禁]","[TUIEmoji_666]":"[666]","[TUIEmoji_857]":"[857]","[TUIEmoji_Knife]":"[刀]","[TUIEmoji_Like]":"[赞]"},Fu={"[TUIEmoji_Smile]":"[Smile]","[TUIEmoji_Expect]":"[Expect]","[TUIEmoji_Blink]":"[Blink]","[TUIEmoji_Guffaw]":"[Guffaw]","[TUIEmoji_KindSmile]":"[KindSmile]","[TUIEmoji_Haha]":"[Haha]","[TUIEmoji_Cheerful]":"[Cheerful]","[TUIEmoji_Speechless]":"[Speechless]","[TUIEmoji_Amazed]":"[Amazed]","[TUIEmoji_Sorrow]":"[Sorrow]","[TUIEmoji_Complacent]":"[Complacent]","[TUIEmoji_Silly]":"[Silly]","[TUIEmoji_Lustful]":"[Lustful]","[TUIEmoji_Giggle]":"[Giggle]","[TUIEmoji_Kiss]":"[Kiss]","[TUIEmoji_Wail]":"[Wail]","[TUIEmoji_TearsLaugh]":"[TearsLaugh]","[TUIEmoji_Trapped]":"[Trapped]","[TUIEmoji_Mask]":"[Mask]","[TUIEmoji_Fear]":"[Fear]","[TUIEmoji_BareTeeth]":"[BareTeeth]","[TUIEmoji_FlareUp]":"[FlareUp]","[TUIEmoji_Yawn]":"[Yawn]","[TUIEmoji_Tact]":"[Tact]","[TUIEmoji_Stareyes]":"[StarEyes]","[TUIEmoji_ShutUp]":"[ShutUp]","[TUIEmoji_Sigh]":"[Sigh]","[TUIEmoji_Hehe]":"[Hehe]","[TUIEmoji_Silent]":"[Silent]","[TUIEmoji_Surprised]":"[Surprised]","[TUIEmoji_Askance]":"[Askance]]","[TUIEmoji_Ok]":"[OK]","[TUIEmoji_Shit]":"[Shit]","[TUIEmoji_Monster]":"[Monster]","[TUIEmoji_Daemon]":"[Daemon]","[TUIEmoji_Rage]":"[Rage]","[TUIEmoji_Fool]":"[Fool]","[TUIEmoji_Pig]":"[Pig]","[TUIEmoji_Cow]":"[Cow]","[TUIEmoji_Ai]":"[AI]","[TUIEmoji_Skull]":"[Skull]","[TUIEmoji_Bombs]":"[Bombs]","[TUIEmoji_Coffee]":"[Coffee]","[TUIEmoji_Cake]":"[Cake]","[TUIEmoji_Beer]":"[Beer]","[TUIEmoji_Flower]":"[Flower]","[TUIEmoji_Watermelon]":"[Watermelon]","[TUIEmoji_Rich]":"[Rich]","[TUIEmoji_Heart]":"[Heart]","[TUIEmoji_Moon]":"[Moon]","[TUIEmoji_Sun]":"[Sun]","[TUIEmoji_Star]":"[Star]","[TUIEmoji_RedPacket]":"[RedPacket]","[TUIEmoji_Celebrate]":"[Celebrate]","[TUIEmoji_Bless]":"[Bless]","[TUIEmoji_Fortune]":"[Fortune]","[TUIEmoji_Convinced]":"[Convinced]","[TUIEmoji_Prohibit]":"[Prohibit]","[TUIEmoji_666]":"[666]","[TUIEmoji_857]":"[857]","[TUIEmoji_Knife]":"[Knife]","[TUIEmoji_Like]":"[Like]"},Hu={DELETE:"delete",ISPINNED:"ispinned",DISPINNED:"dispinned",MUTE:"mute",NOTMUTE:"notmute"},ju="isC2C",qu="isGroup",zu={SERVICE:"consultion",EVALUATE:"evaluation",LINK:"text_link",CALL:1,ORDER:"order"},Ku={BASIC:"basic",BIG:"big",CUSTOM:"CUSTOM"},$u={LEFT:"left",TOP:"top"},Yu={INPUT:"input",TEXTAREA:"textarea",SWITCH:"switch"},Wu={SUBMIT:"submit",CANCEL:"cancel"},Ju="https://web.sdk.qcloud.com/im/assets/face-elem/",Xu=[{emojiGroupID:1,type:Ku.BIG,url:Ju,list:["yz00","yz01","yz02","yz03","yz04","yz05","yz06","yz07","yz08","yz09","yz10","yz11","yz12","yz13","yz14","yz15","yz16","yz17"]},{emojiGroupID:2,type:Ku.BIG,url:Ju,list:["ys00","ys01","ys02","ys03","ys04","ys05","ys06","ys07","ys08","ys09","ys10","ys11","ys12","ys13","ys14","ys15"]},{emojiGroupID:3,type:Ku.BIG,url:Ju,list:["gcs00","gcs01","gcs02","gcs03","gcs04","gcs05","gcs06","gcs07","gcs08","gcs09","gcs10","gcs11","gcs12","gcs13","gcs14","gcs15","gcs16"]}],Zu={...Object.fromEntries(null==(m=Object.entries(Vu))?void 0:m.map((([e,t])=>[t,e]))),...Object.fromEntries(null==(f=Object.entries(Fu))?void 0:f.map((([e,t])=>[t,e])))},Qu="https://web.sdk.qcloud.com/im/assets/emoji-plugin/",ed={"[TUIEmoji_Expect]":"emoji_0@2x.png","[TUIEmoji_Blink]":"emoji_1@2x.png","[TUIEmoji_Guffaw]":"emoji_2@2x.png","[TUIEmoji_KindSmile]":"emoji_3@2x.png","[TUIEmoji_Haha]":"emoji_4@2x.png","[TUIEmoji_Cheerful]":"emoji_5@2x.png","[TUIEmoji_Smile]":"emoji_6@2x.png","[TUIEmoji_Sorrow]":"emoji_7@2x.png","[TUIEmoji_Speechless]":"emoji_8@2x.png","[TUIEmoji_Amazed]":"emoji_9@2x.png","[TUIEmoji_Complacent]":"emoji_10@2x.png","[TUIEmoji_Lustful]":"emoji_11@2x.png","[TUIEmoji_Stareyes]":"emoji_12@2x.png","[TUIEmoji_Giggle]":"emoji_13@2x.png","[TUIEmoji_Daemon]":"emoji_14@2x.png","[TUIEmoji_Rage]":"emoji_15@2x.png","[TUIEmoji_Yawn]":"emoji_16@2x.png","[TUIEmoji_TearsLaugh]":"emoji_17@2x.png","[TUIEmoji_Silly]":"emoji_18@2x.png","[TUIEmoji_Wail]":"emoji_19@2x.png","[TUIEmoji_Kiss]":"emoji_20@2x.png","[TUIEmoji_Trapped]":"emoji_21@2x.png","[TUIEmoji_Fear]":"emoji_22@2x.png","[TUIEmoji_BareTeeth]":"emoji_23@2x.png","[TUIEmoji_FlareUp]":"emoji_24@2x.png","[TUIEmoji_Tact]":"emoji_25@2x.png","[TUIEmoji_Shit]":"emoji_26@2x.png","[TUIEmoji_ShutUp]":"emoji_27@2x.png","[TUIEmoji_Sigh]":"emoji_28@2x.png","[TUIEmoji_Hehe]":"emoji_29@2x.png","[TUIEmoji_Silent]":"emoji_30@2x.png","[TUIEmoji_Skull]":"emoji_31@2x.png","[TUIEmoji_Mask]":"emoji_32@2x.png","[TUIEmoji_Beer]":"emoji_33@2x.png","[TUIEmoji_Cake]":"emoji_34@2x.png","[TUIEmoji_RedPacket]":"emoji_35@2x.png","[TUIEmoji_Bombs]":"emoji_36@2x.png","[TUIEmoji_Ai]":"emoji_37@2x.png","[TUIEmoji_Celebrate]":"emoji_38@2x.png","[TUIEmoji_Bless]":"emoji_39@2x.png","[TUIEmoji_Flower]":"emoji_40@2x.png","[TUIEmoji_Watermelon]":"emoji_41@2x.png","[TUIEmoji_Cow]":"emoji_42@2x.png","[TUIEmoji_Fool]":"emoji_43@2x.png","[TUIEmoji_Surprised]":"emoji_44@2x.png","[TUIEmoji_Askance]":"emoji_45@2x.png","[TUIEmoji_Monster]":"emoji_46@2x.png","[TUIEmoji_Pig]":"emoji_47@2x.png","[TUIEmoji_Coffee]":"emoji_48@2x.png","[TUIEmoji_Ok]":"emoji_49@2x.png","[TUIEmoji_Heart]":"emoji_50@2x.png","[TUIEmoji_Sun]":"emoji_51@2x.png","[TUIEmoji_Moon]":"emoji_52@2x.png","[TUIEmoji_Star]":"emoji_53@2x.png","[TUIEmoji_Rich]":"emoji_54@2x.png","[TUIEmoji_Fortune]":"emoji_55@2x.png","[TUIEmoji_857]":"emoji_56@2x.png","[TUIEmoji_666]":"emoji_57@2x.png","[TUIEmoji_Prohibit]":"emoji_58@2x.png","[TUIEmoji_Convinced]":"emoji_59@2x.png","[TUIEmoji_Knife]":"emoji_60@2x.png","[TUIEmoji_Like]":"emoji_61@2x.png"},td=[{emojiGroupID:0,type:Ku.BASIC,url:Qu,list:Object.keys(ed)},...Xu],nd=e=>ru?Vu[e]:Tr.t(`Emoji.${e}`),od=e=>{if(!e)return"";const t=/(\[.+?\])/g;let n=e;return t.test(e)&&(n=e.replace(t,(e=>ed[e]?nd(e):e))),n},ad=e=>{const t=/\[([^\]]+)\]/g,n=[];let o,a=0;for(;null!==(o=t.exec(e));){const i=o.index,s=t.lastIndex,r=o[0];i>a&&n.push({type:"text",content:e.substring(a,i)});const c=Qu+ed[r];c?n.push({type:"image",content:c,emojiKey:r}):n.push({type:"text",content:r}),a=s,t.lastIndex=a}return a<e.length&&n.push({type:"text",content:e.substring(a)}),n},id=L(e.defineComponent({__name:"message-abstract-text",props:{content:{default:()=>[]},highlightType:{default:"font"},displayType:{default:"info"}},setup(t){const n=t,o=e.ref(n.content);return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-abstract-text",`message-abstract-text-${t.highlightType}`,`message-abstract-text-${t.displayType}`])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n,class:e.normalizeClass([t&&t.isHighlight?"highlight":"normal"])},e.toDisplayString(e.unref(od)(t.text)),3)))),128))],2))}}),[["__scopeId","data-v-cd55a381"]]),sd=L(e.defineComponent({__name:"message-abstract-file",props:{contentText:{default:()=>[]},messageContent:{default:()=>({})},displayType:{default:"bubble"}},setup(t){const n=t,o=e.ref(n.contentText),a=e.computed((()=>{var e;const t=null==(e=null==n?void 0:n.messageContent)?void 0:e.url,o=null==t?void 0:t.lastIndexOf("."),a=null==t?void 0:t.substring(o+1);return s(a)})),i=e.computed((()=>{var e;return null==(e=null==n?void 0:n.messageContent)?void 0:e.size})),s=e=>{const t="https://web.sdk.qcloud.com/component/TUIKit/assets/file-",n=["image","pdf","text","ppt","presentation","sheet","zip","word","video","unknown"];let o="",a="";return null==n||n.forEach((n=>{(null==e?void 0:e.includes(n))&&(o=t+n+".svg",a=n)})),{iconSrc:o||t+"unknown.svg",iconType:a||"unknown"}};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-abstract-file",`message-abstract-file-${t.displayType}`])},[e.createElementVNode("div",{class:e.normalizeClass(["message-abstract-file-left"])},[e.createElementVNode("img",{class:e.normalizeClass(["message-abstract-file-left-icon"]),src:a.value.iconSrc},null,8,["src"])]),e.createElementVNode("div",{class:e.normalizeClass(["message-abstract-file-main"])},[e.createElementVNode("div",{class:e.normalizeClass(["message-abstract-file-main-name"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n,class:e.normalizeClass([t&&t.isHighlight?"highlight":"normal"])},e.toDisplayString(t.text),3)))),128))]),e.createElementVNode("div",{class:e.normalizeClass(["message-abstract-file-main-size"])},e.toDisplayString(i.value),1)])],2))}}),[["__scopeId","data-v-4438ed6b"]]),rd=e=>"function"==typeof e,cd=e=>/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/.test(e),ld=e=>e&&(e=>{if("string"==typeof e)try{return!!JSON.parse(e)}catch(t){return!1}return!1})(e)?JSON.parse(e):e,ud="/assets/star-light.d9a7aedf.png",dd=L(e.defineComponent({__name:"message-abstract-custom",props:{contentText:{default:()=>[]},message:{default:()=>({})},messageContent:{default:()=>({})}},setup(t){var n,o;const a=t,i=e.ref(null==(n=null==a?void 0:a.message)?void 0:n.payload),s=e.computed((()=>{var e,t;return(null==(e=null==i?void 0:i.value)?void 0:e.data)?ld(i.value.data):null==(t=null==i?void 0:i.value)?void 0:t.data})),r=e.computed((()=>{var e;return null==(e=null==s?void 0:s.value)?void 0:e.businessID})),c=e.ref(null==a?void 0:a.contentText),l=e.ref((null==(o=null==a?void 0:a.messageContent)?void 0:o.custom)||"[自定义消息]");return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-abstract-custom"]),onClickCapture:n[0]||(n[0]=e.withModifiers((()=>{}),["stop"]))},[r.value===e.unref(zu).SERVICE?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["service"])},[e.createElementVNode("h1",{class:e.normalizeClass(["service-header"])},[e.createElementVNode("label",{class:e.normalizeClass(["service-header-title"])},e.toDisplayString(s.value.title),1),s.value.hyperlinks_text?(e.openBlock(),e.createElementBlock("a",{key:0,class:e.normalizeClass(["service-header-link","link"]),href:s.value.hyperlinks_text.value,target:"view_window"},e.toDisplayString(s.value.hyperlinks_text.key),9,["href"])):e.createCommentVNode("",!0)]),s.value.item&&s.value.item.length>0?(e.openBlock(),e.createElementBlock("ul",{key:0,class:e.normalizeClass(["service-list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value.item,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:e.normalizeClass(["service-list-item"])},[e.unref(cd)(t.value)?(e.openBlock(),e.createElementBlock("a",{key:0,class:e.normalizeClass(["service-list-item-link","link"]),href:t.value,target:"view_window"},e.toDisplayString(t.key),9,["href"])):(e.openBlock(),e.createElementBlock("p",{key:1,class:e.normalizeClass(["service-list-item-key"])},e.toDisplayString(t.key),1))])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["service-description","description"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n,class:e.normalizeClass([t&&t.isHighlight?"highlight":"normal"])},e.toDisplayString(t.text),3)))),128))])])):r.value===e.unref(zu).EVALUATE?(e.openBlock(),e.createElementBlock("div",{key:1,class:"evaluate"},[e.createElementVNode("div",{class:e.normalizeClass(["evaluate-description","description"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n,class:e.normalizeClass([t&&t.isHighlight?"highlight":"normal"])},e.toDisplayString(t.text),3)))),128))]),s.value.score?(e.openBlock(),e.createElementBlock("ul",{key:0,class:"evaluate-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Math.max(s.value.score,0),((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"evaluate-list-item"},[e.createVNode(pu,{file:e.unref(ud),class:"file-icon"},null,8,["file"])])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("article",null,e.toDisplayString(s.value.comment),1)])):r.value===e.unref(zu).ORDER?(e.openBlock(),e.createElementBlock("div",{key:2,class:"order"},[e.createElementVNode("img",{class:"order-image",src:s.value.imageUrl,alt:""},null,8,["src"]),e.createElementVNode("main",{class:"order-main"},[e.createElementVNode("h1",{class:"order-main-title"},e.toDisplayString(s.value.title),1),e.createElementVNode("div",{class:e.normalizeClass(["order-main-description","description"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n,class:e.normalizeClass([t&&t.isHighlight?"highlight":"normal"])},e.toDisplayString(t.text),3)))),128))]),e.createElementVNode("span",{class:"order-main-price"},e.toDisplayString(s.value.price),1)])])):r.value===e.unref(zu).LINK?(e.openBlock(),e.createElementBlock("div",{key:3,class:"text-link"},[e.createElementVNode("div",{class:e.normalizeClass(["text-link-description","description"])},[e.createElementVNode("p",null,e.toDisplayString(s.value.text),1)]),e.createElementVNode("a",{class:e.normalizeClass(["link"]),href:s.value.link,target:"view_window"},e.toDisplayString(e.unref(Tr).t("message.custom.查看详情>>")),9,["href"])])):(e.openBlock(),e.createElementBlock("span",{key:4},e.toDisplayString(l.value),1))],32))}}),[["__scopeId","data-v-a95da931"]]),pd=L(e.defineComponent({__name:"message-abstract-image",props:{messageContent:{default:()=>({})}},setup(t){const n=t,o=e.computed((()=>n.messageContent.url||""));return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-abstract-image-container"])},[e.createElementVNode("img",{class:e.normalizeClass(["message-abstract-image"]),src:o.value},null,8,["src"])]))}}),[["__scopeId","data-v-76fbd75c"]]),hd="/assets/video-play.58b451c9.png",gd=L(e.defineComponent({__name:"message-abstract-video",props:{messageContent:{default:()=>({})}},setup(t){const n=t,o=e.computed((()=>n.messageContent.snapshotUrl||n.messageContent.url));return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-abstract-video"])},[e.createElementVNode("div",{class:"message-abstract-video-box"},[e.createElementVNode("img",{src:o.value,class:e.normalizeClass(["video-snapshot"])},null,8,["src"]),e.createVNode(pu,{file:e.unref(hd),class:"video-play"},null,8,["file"])])]))}}),[["__scopeId","data-v-9fb71d8f"]]),md="success",fd="warning",vd="error",_d="normal",yd=e=>{Fl.showToast({title:e.message||"Toast",duration:e.duration||1500,icon:Id(e.type)})},Id=e=>{if(!e)return"none";switch(e){case vd:case fd:return"none";case md:return"success";default:return"none"}},Ed={[Cr.TYPES.MSG_TEXT]:"[文本]",[Cr.TYPES.MSG_IMAGE]:"[图片]",[Cr.TYPES.MSG_AUDIO]:"[语音]",[Cr.TYPES.MSG_VIDEO]:"[视频]",[Cr.TYPES.MSG_FILE]:"[文件]",[Cr.TYPES.MSG_CUSTOM]:"[自定义消息]",[Cr.TYPES.MSG_SYSTEM]:"[系统消息]",[Cr.TYPES.MSG_MERGER]:"[合并消息]",[Cr.TYPES.MSG_LOCATION]:"[位置消息]"},Cd=e=>{const t=(null==e?void 0:e.conversationID)||((null==e?void 0:e.groupID)?`GROUP${null==e?void 0:e.groupID}`:`C2C${null==e?void 0:e.userID}`);Mr.switchConversation(t).then((()=>{kr.update(oi.SEARCH,"currentSearchingStatus",{isSearching:!1,searchType:"global"}),kr.update(oi.SEARCH,"currentSearchInputValue",{value:"",searchType:"global"}),lu&&(null==Fl||Fl.navigateTo({url:"/TUIKit/components/TUIChat/index"}))})).catch((e=>{I("warn","at TUIKit/components/TUISearch/utils.ts:112","switch conversation failed:",null==e?void 0:e.message),yd({message:Tr.t("TUISearch.进入会话失败"),type:vd,duration:1e3})}))},kd=(e,t)=>{var n;if(!e||!t||!t.length)return[{text:e||"",isHighlight:!1}];const o=[];for(let c=0;c<t.length;c++){const a=null==(n=t[c])?void 0:n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(a,"gi");let s;for(;null!==(s=i.exec(e));){const e=s.index,t=s.index+s[0].length-1;o.push([e,t])}}const a=[o[0]];if(o.length>1){o.sort(((e,t)=>e[0]-t[0]));for(let e=1;e<o.length;e++){const t=o[e],n=a[a.length-1];t[0]-1<=n[1]?n[1]=Math.max(n[1],t[1]):a.push(t)}}if(!a[0])return[{text:e,isHighlight:!1}];const i=[];let s=0;for(let c=0;c<a.length;c++){const t=e.substring(s,a[c][0]);t&&i.push({text:t,isHighlight:!1});const n=e.substring(a[c][0],a[c][1]+1);n&&i.push({text:n,isHighlight:!0}),s=a[c][1]+1}const r=e.substring(s);return r&&i.push({text:r,isHighlight:!1}),i},Td=e=>{const t=new Date(1e3*e);return`${t.getFullYear()}-${("0"+(t.getMonth()+1)).slice(-2)}-${("0"+t.getDate()).slice(-2)}`},Md=L(e.defineComponent({__name:"index",props:{listItem:{default:()=>({})},listItemContent:{default:()=>({})},type:{default:"allMessage"},displayType:{default:"info"},keywordList:{default:()=>[]}},emits:["showResultDetail","navigateToChatPosition"],setup(t,{emit:n}){const o=t,a=n,i=e.ref(Cr.TYPES),s=e.ref(""),r=e.ref(""),c=e.ref([]),l=e.ref(""),u=e.ref(!1);e.watchEffect((()=>{var e,t;s.value=(e=>{var t,n,o,a;return e?e.ID?e.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png":e.groupID?e.avatar||`https://web.sdk.qcloud.com/im/assets/images/${null==e?void 0:e.type}.svg`:e.userID?e.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png":(null==(t=null==e?void 0:e.conversation)?void 0:t.conversationID)?"function"==typeof e.conversation.getAvatar?null==(n=e.conversation)?void 0:n.getAvatar():null==(a=null==(o=kr.getConversationModel(e.conversation.conversationID))?void 0:o.getAvatar)?void 0:a.call(o):"":""})(o.listItem),r.value=((e,t)=>{var n,o,a;return e?e.ID?null==t?void 0:t.showName:e.groupID?e.name||e.groupID:e.userID?e.remark||e.nick||e.userID||"":(null==(n=e.conversation)?void 0:n.conversationID)?"function"==typeof e.conversation.getShowName?e.conversation.getShowName():(null==(a=null==(o=kr.getConversationModel(e.conversation.conversationID))?void 0:o.getShowName)?void 0:a.call(o))||e.conversation.conversationID:"":""})(o.listItem,null==o?void 0:o.listItemContent),c.value=((e,t,n,o=!0)=>{var a,i,s,r;if(null==e?void 0:e.groupID)return[{text:"groupID: ",isHighlight:!1},{text:e.groupID,isHighlight:!0}];if(null==e?void 0:e.userID)return[{text:"userID: ",isHighlight:!1},{text:e.userID,isHighlight:!0}];if((null==e?void 0:e.conversation)||(null==e?void 0:e.flow)){if(1===(null==e?void 0:e.messageCount)||(null==e?void 0:e.flow)){const t=(null==e?void 0:e.flow)?e:null==e?void 0:e.messageList[0],r=(null==(a=null==t?void 0:t.payload)?void 0:a.text)||(null==(i=null==t?void 0:t.payload)?void 0:i.fileName)||(null==(s=null==t?void 0:t.payload)?void 0:s.description),c=[];return(null==t?void 0:t.type)&&o&&t.type!==Cr.TYPES.MSG_TEXT&&c.push({text:Tr.t(`TUISearch.${Ed[t.type]}`),isHighlight:!1}),c.push(...kd(r,n)),c}return[{text:`${null==e?void 0:e.messageCount}${Tr.t("TUISearch.条相关")}${Tr.t(`TUISearch.${"allMessage"===t?"结果":null==(r=fu[t])?void 0:r.label}`)}`,isHighlight:!1}]}return[]})(o.listItem,o.type,o.keywordList,"info"===(null==o?void 0:o.displayType)),l.value=(null==(e=o.listItem)?void 0:e.time)?(e=>{const t=(new Date).setHours(0,0,0,0),n=new Date((new Date).getFullYear(),0,1,0,0,0,0).getTime(),o=new Date(e),a=864e5,i=t-o.getTime();function s(e){return e<10?"0"+e:e.toString()}if(i<=0)return`${s(o.getHours())}:${s(o.getMinutes())}`;if(i<=a)return`${Tr.t("time.昨天")} ${s(o.getHours())}:${s(o.getMinutes())}`;if(i<=5184e5){const e=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][o.getDay()];return`${Tr.t("time."+e)} ${s(o.getHours())}:${s(o.getMinutes())}`}return o.getTime()>=n?`${o.getMonth()+1}/${o.getDate()} ${s(o.getHours())}:${s(o.getMinutes())}`:`${o.getFullYear()}/${o.getMonth()+1}/${o.getDate()} ${s(o.getHours())}:${s(o.getMinutes())}`})(1e3*(null==(t=o.listItem)?void 0:t.time)):""}));const d=()=>{var e;"contact"===o.type||"group"===o.type?Cd(o.listItem):"info"!==o.displayType||(null==(e=o.listItem)?void 0:e.ID)?h():a("showResultDetail",!0,o.type,o.listItem)},p=e=>{u.value=e},h=()=>{a("navigateToChatPosition",o.listItem)};return(t,n)=>{return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["search-result-list-item",!e.unref(iu)&&"search-result-list-item-h5","search-result-list-item-"+t.displayType,u.value&&"hover-"+t.displayType]),onClick:d,onMouseenter:n[0]||(n[0]=e=>p(!0)),onMouseleave:n[1]||(n[1]=e=>p(!1))},["info"===t.displayType||"bubble"===t.displayType?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass([t.displayType])},[e.createElementVNode("div",{class:e.normalizeClass(t.displayType+"-left")},[e.createElementVNode("img",{class:e.normalizeClass(t.displayType+"-left-avatar"),src:s.value||"",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,10,["src"])],2),e.createElementVNode("div",{class:e.normalizeClass([t.displayType+"-main"])},[e.createElementVNode("div",{class:e.normalizeClass([t.displayType+"-main-name"])},e.toDisplayString(r.value),3),e.createElementVNode("div",{class:e.normalizeClass([t.displayType+"-main-content"])},["info"===t.displayType||t.listItem.type===i.value.MSG_TEXT?(e.openBlock(),e.createBlock(id,{key:0,content:c.value,highlightType:"info"===t.displayType?"font":"background",displayType:t.displayType},null,8,["content","highlightType","displayType"])):t.listItem.type===i.value.MSG_FILE?(e.openBlock(),e.createBlock(sd,{key:1,contentText:c.value,messageContent:t.listItemContent,displayType:t.displayType},null,8,["contentText","messageContent","displayType"])):t.listItem.type===i.value.MSG_IMAGE?(e.openBlock(),e.createElementBlock("div",{key:2})):t.listItem.type===i.value.MSG_VIDEO?(e.openBlock(),e.createElementBlock("div",{key:3})):t.listItem.type===i.value.MSG_CUSTOM?(e.openBlock(),e.createBlock(dd,{key:4,contentText:c.value,message:t.listItem,messageContent:t.listItemContent},null,8,["contentText","message","messageContent"])):(e.openBlock(),e.createElementBlock("div",{key:5},e.toDisplayString((o=t.listItem,(null==o?void 0:o.type)?Tr.t(`TUISearch.${Ed[o.type]}`):Tr.t("TUISearch.[合并消息]"))),1))],2)],2),e.createElementVNode("div",{class:e.normalizeClass(t.displayType+"-right")},[e.createElementVNode("div",{class:e.normalizeClass(t.displayType+"-right-time")},e.toDisplayString(l.value),3),"bubble"===t.displayType&&u.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(t.displayType+"-right-to"),onClick:e.withModifiers(h,["stop"])},e.toDisplayString(e.unref(Tr).t("TUISearch.定位到聊天位置")),3)):e.createCommentVNode("",!0)],2)],2)):"file"===t.displayType?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass([t.displayType])},[e.createElementVNode("div",{class:e.normalizeClass([t.displayType+"-header"])},[e.createElementVNode("img",{class:e.normalizeClass(t.displayType+"-header-avatar"),src:s.value,onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,10,["src"]),e.createElementVNode("div",{class:e.normalizeClass([t.displayType+"-header-name"])},e.toDisplayString(r.value),3),u.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(t.displayType+"-header-to"),onClick:e.withModifiers(h,["stop"])},e.toDisplayString(e.unref(Tr).t("TUISearch.定位到聊天位置")),3)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(t.displayType+"-header-time")},e.toDisplayString(l.value),3)],2),e.createElementVNode("div",{class:e.normalizeClass([t.displayType+"-main-content"])},[e.createVNode(sd,{contentText:c.value,messageContent:t.listItemContent,displayType:"bubble"},null,8,["contentText","messageContent"])],2)],2)):"image"===t.displayType?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass([t.displayType])},[e.createElementVNode("div",{class:"image-container",onClick:e.withModifiers(h,["stop"])},[t.listItem.type===i.value.MSG_IMAGE?(e.openBlock(),e.createBlock(pd,{key:0,messageContent:t.listItemContent},null,8,["messageContent"])):t.listItem.type===i.value.MSG_VIDEO?(e.openBlock(),e.createBlock(gd,{key:1,messageContent:t.listItemContent},null,8,["messageContent"])):e.createCommentVNode("",!0),u.value?(e.openBlock(),e.createElementBlock("div",{key:2,class:"image-container-hover"},[e.createElementVNode("div",{class:"image-container-hover-text"},e.toDisplayString(e.unref(Tr).t("TUISearch.定位到聊天位置")),1)])):e.createCommentVNode("",!0)])],2)):e.createCommentVNode("",!0)],34);var o}}}),[["__scopeId","data-v-2bd3d3b0"]]),Sd=L(e.defineComponent({__name:"index",setup:t=>(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["search-result-default",!e.unref(iu)&&"search-result-default-h5"])},[e.createElementVNode("div",{class:"search-result-default-main"},[e.createVNode(pu,{file:e.unref("/assets/search-default.0969a8df.svg"),width:"88px",height:"75px"},null,8,["file"]),e.createElementVNode("div",{class:"default-text"},e.toDisplayString(e.unref(Tr).t("TUISearch.暂无搜索结果")),1)])],2))}),[["__scopeId","data-v-f1387971"]]),Dd=L(e.defineComponent({__name:"index",props:{width:{type:String,default:"30px"},height:{type:String,default:"30px"},color:{type:String,default:"#D9D9D9"}},setup(t){const n=t;return(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:"tui-loading",style:e.normalizeStyle({width:n.width,height:n.height,border:`2px solid ${n.color}`,borderTopColor:"transparent"})},null,4))}}),[["__scopeId","data-v-45136175"]]),bd=L(e.defineComponent({__name:"index",setup:t=>(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["search-result-loading",!e.unref(iu)&&"search-result-loading-h5"])},[e.createVNode(Dd,{width:"40px",height:"40px"})],2))}),[["__scopeId","data-v-97e875b1"]]),wd="/assets/right-icon.a24fdba0.svg";function Nd(e){const t=kr.getData(oi.APP,"tasks");e in t&&!t[e]&&(t[e]=!0,kr.update(oi.APP,"tasks",t))}const Ld=L(e.defineComponent({__name:"index",props:{searchType:{type:String,default:"global",validator:e=>["global","conversation"].includes(e)}},setup(t){var n,o;const a=t,i=e.ref([]),s=e.ref(null==(n=vu[a.searchType])?void 0:n.value),r=e.ref(0),c=e.ref(0),l=e.ref("and"),u=e.ref(null==(o=vu[a.searchType])?void 0:o.key),d=e.ref({}),p=e.ref([]),h=e.ref(0),g=e.ref(""),m=e.ref(),f=e.ref([]),v=e.ref(),_=e.ref([]),y=e.ref(!1),I=e.ref(!1),E=e.ref(!1),C=e.computed((()=>{var e,t,n;return!I.value&&("global"===a.searchType?!(!(null==(e=null==i?void 0:i.value)?void 0:e.length)||(null==(t=null==Object?void 0:Object.keys(d.value))?void 0:t.length)):!(null==(n=null==f?void 0:f.value)?void 0:n.length))}));function k(e){"conversation"===a.searchType&&(g.value=e)}function T(e){(null==e?void 0:e.searchType)===(null==a?void 0:a.searchType)&&(i.value=(null==e?void 0:e.value)?e.value.trim().split(/\s+/):[])}function M(e){var t,n,o,i;(null==e?void 0:e.searchType)===(null==a?void 0:a.searchType)&&(u.value=(null==(t=null==e?void 0:e.value)?void 0:t.key)||(null==(n=vu[a.searchType])?void 0:n.key),s.value=(null==(o=null==e?void 0:e.value)?void 0:o.value)||(null==(i=vu[a.searchType])?void 0:i.value))}function S(e){var t,n,o,i;(null==e?void 0:e.searchType)===(null==a?void 0:a.searchType)&&(r.value=null==(n=null==(t=null==e?void 0:e.value)?void 0:t.value)?void 0:n.timePosition,c.value=null==(i=null==(o=null==e?void 0:e.value)?void 0:o.value)?void 0:i.timePeriod)}e.onMounted((()=>{kr.watch(oi.CONV,{currentConversationID:k}),kr.watch(oi.SEARCH,{currentSearchInputValue:T,currentSearchMessageType:M,currentSearchMessageTime:S})})),e.onUnmounted((()=>{kr.unwatch(oi.CONV,{currentConversationID:k}),kr.unwatch(oi.SEARCH,{currentSearchInputValue:T,currentSearchMessageType:M,currentSearchMessageTime:S})}));const D=e=>{var t,n;(n={keywordList:(null==(t=null==i?void 0:i.value)?void 0:t.length)?i.value:void 0,messageTypeList:"string"==typeof s.value?[s.value]:s.value,timePosition:r.value,timePeriod:c.value,conversationID:(null==e?void 0:e.conversationID)||void 0,cursor:(null==e?void 0:e.cursor)||void 0,keywordListMatchType:l.value},Dr.searchCloudMessages(n).then((e=>e)).catch((e=>(yd({message:Tr.t("TUISearch.消息云端搜索失败：")+(null==e?void 0:e.message),type:vd,duration:3e3}),null)))).then((t=>{var n,o,i,s,r,c,l,g,y,C;if(Nd("searchCloudMessage"),null==e?void 0:e.conversationID)m.value=null==t?void 0:t.data,(null==e?void 0:e.cursor)?f.value=[...f.value,...null==(l=null==(c=null==t?void 0:t.data)?void 0:c.searchResultList[0])?void 0:l.messageList]:f.value=null==(y=null==(g=null==t?void 0:t.data)?void 0:g.searchResultList[0])?void 0:y.messageList,v.value=null==(C=null==t?void 0:t.data)?void 0:C.totalCount,"conversation"!==(null==a?void 0:a.searchType)||"fileMessage"!==u.value&&"imageMessage"!==u.value?_.value=[]:_.value=O(f.value);else{(null==e?void 0:e.cursor)?p.value=[...p.value,...t.data.searchResultList]:p.value=null==(n=null==t?void 0:t.data)?void 0:n.searchResultList,h.value=null==(o=null==t?void 0:t.data)?void 0:o.totalCount;const a="all"===u.value?"allMessage":u.value;(null==(i=null==p?void 0:p.value)?void 0:i.length)&&"contact"!==u.value&&"group"!==u.value?d.value=Object.assign({},d.value,{[a]:{key:a,label:fu[a].label,list:"all"===u.value?null==(s=null==p?void 0:p.value)?void 0:s.slice(0,3):null==p?void 0:p.value,cursor:(null==(r=null==t?void 0:t.data)?void 0:r.cursor)||null}}):null==d||delete d.value[a]}I.value=!1,E.value=!1}))},b=((e,t)=>{let n=null;return(...o)=>{null!==n&&(clearTimeout(n),n=null),n=setTimeout((()=>e(...o)),t)}})(D,500),w=()=>{d.value={},m.value={},f.value=[],_.value=[]};e.watch((()=>[i.value,u.value,r.value,c.value]),((e,t)=>{var n,o,s;if(e!==t)if((null==(n=null==i?void 0:i.value)?void 0:n.length)||"global"!==(null==a?void 0:a.searchType))if(I.value=!0,"conversation"===a.searchType)w(),D({conversationID:g.value});else{if(t&&"all"===t[1]&&e&&"allMessage"===e[1])return(null==(o=null==d?void 0:d.value.allMessage)?void 0:o.list)&&(d.value.allMessage.list=null==p?void 0:p.value),null==(s=null==Object?void 0:Object.keys(null==d?void 0:d.value))||s.forEach((e=>{"allMessage"!==e&&(null==d||delete d.value[e])})),void(I.value=!1);y.value=!1,w(),b()}else w()}),{immediate:!0});const N=()=>{var e;D({cursor:null==(e=null==m?void 0:m.value)?void 0:e.cursor,conversationID:null==g?void 0:g.value})},L=(e,t,n)=>{var o;y.value=e,t&&kr.update(oi.SEARCH,"currentSearchMessageType",{value:fu[t],searchType:a.searchType}),g.value=(null==(o=null==n?void 0:n.conversation)?void 0:o.conversationID)||"",v.value=null==n?void 0:n.messageCount,n&&(E.value=!0,b({conversationID:g.value}))},R=e=>{var t;return g.value===(null==(t=null==e?void 0:e.conversation)?void 0:t.conversationID)?["list-item","list-item-selected"]:["list-item"]},A=()=>"conversation"===a.searchType&&"fileMessage"===u.value?"file":"conversation"===a.searchType&&"imageMessage"===u.value?"image":iu?"bubble":"info",O=e=>{var t,n,o,a;const i=[];if(!(null==e?void 0:e.length))return i;if(1===(null==e?void 0:e.length))return i.push({date:Td(null==(t=e[0])?void 0:t.time),list:e}),i;let s="",r="";for(let c=0;c<(null==e?void 0:e.length);c++)r=Td(null==(n=e[c])?void 0:n.time),s!==r?i.push({date:r,list:[e[c]]}):null==(a=null==(o=i[(null==i?void 0:i.length)-1])?void 0:o.list)||a.push(e[c]),s=r;return i},U=e=>{"global"===a.searchType?(kr.update(oi.SEARCH,"currentSearchingStatus",{isSearching:!1,searchType:a.searchType}),Mr.switchConversation(null==e?void 0:e.conversationID).then((()=>{kr.update(oi.CHAT,"messageSource",e),lu&&(null==Fl||Fl.navigateTo({url:"/TUIKit/components/TUIChat/index"}))}))):"conversation"===a.searchType&&(kr.update(oi.SEARCH,"isShowInConversationSearch",!1),kr.update(oi.CHAT,"messageSource",e),lu&&(null==Fl||Fl.navigateBack()))},P=e=>`${u}-${e}`;return(t,n)=>I.value?(e.openBlock(),e.createBlock(bd,{key:0,class:e.normalizeClass(["search-result-loading",!e.unref(iu)&&"search-result-loading-h5"])},null,8,["class"])):C.value?(e.openBlock(),e.createBlock(Sd,{key:1,class:e.normalizeClass(["search-result-default",!e.unref(iu)&&"search-result-default-h5"])},null,8,["class"])):(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["tui-search-result",!e.unref(iu)&&"tui-search-result-h5",e.unref(iu)&&y.value&&"tui-search-result-with-border"])},["conversation"===a.searchType||!e.unref(iu)&&y.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-search-result-main"},[e.createElementVNode("div",{class:"tui-search-result-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(t=>(e.openBlock(),e.createElementBlock("div",{key:t.key,class:"tui-search-result-list-item"},["global"===a.searchType?(e.openBlock(),e.createElementBlock("div",{key:0,class:"header"},e.toDisplayString(e.unref(Tr).t(`TUISearch.${t.label}`)),1)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.list,(n=>(e.openBlock(),e.createElementBlock("div",{key:n.conversation.conversationID,class:e.normalizeClass([R(n)])},["contact"===t.key||"group"===t.key||n.conversation?(e.openBlock(),e.createBlock(Md,{key:0,listItem:n,type:t.key,displayType:"info",keywordList:i.value,onShowResultDetail:L,onNavigateToChatPosition:U},null,8,["listItem","type","keywordList"])):e.createCommentVNode("",!0)],2)))),128))]),"all"===u.value||t.cursor?(e.openBlock(),e.createElementBlock("div",{key:1,class:"more",onClick:e=>(e=>{"all"===u.value?kr.update(oi.SEARCH,"currentSearchMessageType",{value:fu[e.key],searchType:a.searchType}):D({cursor:(null==e?void 0:e.cursor)||void 0})})(t)},[e.createVNode(pu,{class:"more-icon",file:e.unref(hu),width:"12px",height:"12px"},null,8,["file"]),e.createElementVNode("div",{class:"more-text"},[e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t("TUISearch.查看更多")),1),e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t(`TUISearch.${t.label}`)),1)])],8,["onClick"])):e.createCommentVNode("",!0)])))),128))])])),y.value||"conversation"===a.searchType?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["tui-search-result-detail","conversation"===a.searchType&&"tui-search-result-in-conversation"])},[E.value?(e.openBlock(),e.createBlock(bd,{key:0,class:e.normalizeClass(["search-result-loading",!e.unref(iu)&&"search-result-loading-h5"])},null,8,["class"])):e.createCommentVNode("",!0),!E.value&&y.value&&"conversation"!==a.searchType?(e.openBlock(),e.createElementBlock("div",{key:1,class:"tui-search-message-header"},[e.createElementVNode("div",{class:"header-content"},[e.createElementVNode("div",{class:"header-content-count normal"},[e.createElementVNode("span",null,e.toDisplayString(v.value),1),e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t("TUISearch.条与")),1)]),e.createElementVNode("div",{class:"header-content-keyword"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n},[e.createElementVNode("span",{class:"normal"},'"'),e.createElementVNode("span",{class:"highlight"},e.toDisplayString(t),1),e.createElementVNode("span",{class:"normal"},'"')])))),128))]),e.createElementVNode("div",{class:"header-content-type normal"},[e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t("TUISearch.相关的")),1),e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t(`TUISearch.${"allMessage"===u.value?"结果":e.unref(fu)[u.value].label}`)),1)])]),e.createElementVNode("div",{class:"header-enter",onClick:n[0]||(n[0]=t=>e.unref(Cd)({conversationID:g.value}))},[e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t("TUISearch.进入聊天")),1),e.createVNode(pu,{class:"enter-icon",file:e.unref(wd),width:"14px",height:"14px"},null,8,["file"])])])):e.createCommentVNode("",!0),!E.value&&f.value&&f.value[0]?(e.openBlock(),e.createElementBlock("div",{key:2,class:"tui-search-message-list"},["global"===a.searchType||"imageMessage"!==u.value&&"fileMessage"!==u.value?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(f.value,(t=>(e.openBlock(),e.createElementBlock("div",{key:P(t.ID),class:e.normalizeClass(["list-item"])},[e.createVNode(Md,{listItem:t,listItemContent:t.getMessageContent(),type:u.value,displayType:A(),keywordList:i.value,onShowResultDetail:L,onNavigateToChatPosition:U},null,8,["listItem","listItemContent","type","displayType","keywordList"])])))),128)):(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(_.value,(t=>(e.openBlock(),e.createElementBlock("div",{key:P(t.date),class:e.normalizeClass(["list-group","fileMessage"===u.value?"list-group-file":"list-group-image"])},[e.createElementVNode("div",{class:e.normalizeClass(["list-group-date"])},e.toDisplayString(t.date),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.list,(t=>(e.openBlock(),e.createElementBlock("div",{key:P(t.ID),class:e.normalizeClass(["list-group-item"])},[e.createVNode(Md,{listItem:t,listItemContent:t.getMessageContent(),type:u.value,displayType:A(),keywordList:i.value,onShowResultDetail:L,onNavigateToChatPosition:U},null,8,["listItem","listItemContent","type","displayType","keywordList"])])))),128))],2)))),128)),m.value&&m.value.cursor?(e.openBlock(),e.createElementBlock("div",{key:2,class:"more",onClick:N},[e.createVNode(pu,{class:"more-icon",file:e.unref(hu),width:"12px",height:"12px"},null,8,["file"]),e.createElementVNode("div",{class:"more-text"},e.toDisplayString(e.unref(Tr).t("TUISearch.查看更多历史记录")),1)])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-7f473cd2"]]),Rd=L(e.defineComponent({__name:"index",props:{searchType:{type:String,default:"global",validator:e=>["global","conversation"].includes(e)}},setup(t){const n=t,o=e.ref(),a=e.ref(!1),i=()=>{a.value=!a.value,!lu&&a.value&&au.listen({domRefs:o.value,handler:r})},s=e.ref([]),r=()=>{a.value=!1};return e.onMounted((()=>{s.value=[...Wr.getExtensionList(Ar.TUISearch.EXTENSION.SEARCH_MORE.EXT_ID)],Wr.callService({serviceName:Ar.TUIConversation.SERVICE.NAME,method:Ar.TUIConversation.SERVICE.METHOD.HIDE_CONVERSATION_HEADER,params:{}})})),e.watch((()=>a.value),(()=>{a.value&&kr.update(oi.SEARCH,"currentSearchingStatus",{isSearching:!1,searchType:n.searchType})})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"searchMoreRef",ref:o,class:e.normalizeClass(["tui-search-more",!e.unref(iu)&&"tui-search-more-h5"])},[e.createElementVNode("div",{class:"more",onClick:n[0]||(n[0]=e=>i())},[e.createVNode(pu,{class:"more-icon",file:e.unref("/assets/search-more.7ecab7ad.svg"),width:e.unref(iu)?"28px":"34px",height:e.unref(iu)?"28px":"34px"},null,8,["file","width","height"])]),a.value?(e.openBlock(),e.createElementBlock("ul",{key:0,class:"tui-search-more-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"list-item",onClick:e=>(e=>{var t;const{listener:n={onClicked:()=>{}}}=e;null==(t=null==n?void 0:n.onClicked)||t.call(n,e),i()})(t)},[t.icon?(e.openBlock(),e.createBlock(pu,{key:0,class:"list-item-icon",file:t.icon},null,8,["file"])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"list-item-title"},e.toDisplayString(t.text),1)],8,["onClick"])))),128))])):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-0f841af5"]]),Ad=L(e.defineComponent({__name:"index",props:{searchType:{default:()=>lu?"conversation":"global"}},setup(t){const n=t,o=e.ref(),a=e.ref(""),i=e.ref(!1),s=e.ref(lu),r=e.computed((()=>!iu&&("global"===n.searchType&&i.value||"conversation"===n.searchType&&s.value))),c=e=>{kr.update(oi.SEARCH,"currentSearchInputValue",{value:"",searchType:e}),kr.update(oi.SEARCH,"currentSearchMessageType",{value:vu[e],searchType:e}),kr.update(oi.SEARCH,"currentSearchMessageTime",{value:Tu,searchType:e})};function l(e){lu||a.value===e||h(),a.value=e}function u(e){var t,a;(null==e?void 0:e.searchType)===n.searchType&&(i.value=null==e?void 0:e.isSearching,"global"===(null==e?void 0:e.searchType)&&o.value&&iu&&e.isSearching&&au.listen({domRefs:o.value,handler:p}),"global"===(null==e?void 0:e.searchType)&&lu&&(e.isSearching?null==(t=null==Fl?void 0:Fl.hideTabBar())||t.catch((()=>{})):null==(a=null==Fl?void 0:Fl.showTabBar())||a.catch((()=>{}))))}function d(e){s.value=!!e,s.value&&c(n.searchType)}function p(){kr.update(oi.SEARCH,"currentSearchingStatus",{isSearching:!1,searchType:n.searchType})}function h(){kr.update(oi.SEARCH,"isShowInConversationSearch",!1)}return e.onMounted((()=>{["global","conversation"].forEach((e=>{c(e)})),kr.watch(oi.CONV,{currentConversationID:l}),kr.watch(oi.SEARCH,{currentSearchingStatus:u,isShowInConversationSearch:d})})),e.onUnmounted((()=>{kr.unwatch(oi.CONV,{currentConversationID:l}),kr.unwatch(oi.SEARCH,{currentSearchingStatus:u,isShowInConversationSearch:d})})),(t,n)=>"global"===t.searchType||("conversation"===t.searchType||!t.searchType&&e.unref(lu))&&s.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-search",!e.unref(iu)&&"tui-search-h5",`tui-search-main-${t.searchType?t.searchType:"conversation"}`,r.value&&"tui-search-h5-full-screen"])},["global"===t.searchType?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"globalSearchRef",ref:o,class:e.normalizeClass(["tui-search-global",!e.unref(iu)&&"tui-search-h5-global"])},[e.createElementVNode("div",{class:e.normalizeClass(["tui-search-global-header",!e.unref(iu)&&"tui-search-h5-global-header"])},[e.createVNode(mu,{class:"search-input",searchType:t.searchType},null,8,["searchType"]),e.unref(iu)||!i.value?(e.openBlock(),e.createBlock(Rd,{key:0,class:"search-more",searchType:t.searchType},null,8,["searchType"])):e.createCommentVNode("",!0)],2),i.value?(e.openBlock(),e.createBlock(Bu,{key:0,class:"search-container",popupPosition:"bottom",searchType:t.searchType},{result:e.withCtx((()=>[e.createVNode(Ld,{class:"search-result",searchType:t.searchType},null,8,["searchType"])])),_:1},8,["searchType"])):e.createCommentVNode("",!0)],2)):"conversation"===t.searchType&&s.value||e.unref(lu)?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["tui-search-conversation",!e.unref(iu)&&"tui-search-h5-conversation"])},[e.createVNode(Bu,{class:"search-container",popupPosition:"aside",searchType:t.searchType?t.searchType:"conversation",onCloseInConversationSearch:h},{input:e.withCtx((()=>[e.createVNode(mu,{searchType:t.searchType?t.searchType:"conversation"},null,8,["searchType"])])),result:e.withCtx((()=>[e.createVNode(Ld,{class:"search-result",searchType:t.searchType?t.searchType:"conversation"},null,8,["searchType"])])),_:1},8,["searchType"])],2)):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-4cfa9ec9"]]),Od="/static/img/noTea.png",Ud=e.defineComponent({__name:"index",props:{url:{default:"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png"},size:{default:"36px"},borderRadius:{default:"5px"},useSkeletonAnimation:{type:Boolean,default:!1}},emits:["onLoad","onError"],setup(t,{emit:n}){const o=e.ref("https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png"),a=n,i=t,{size:s,url:r,borderRadius:c,useSkeletonAnimation:l}=e.toRefs(i);let u=0;const d=e.ref(!1),p=e.ref(!1);function h(e){d.value=!0,a("onLoad",e)}function g(e){u+=1,u>3||(lu?p.value=!0:e.currentTarget.src=o.value,a("onError",e))}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"avatar-container",style:e.normalizeStyle({width:"44px",height:"44px",borderRadius:e.unref(c)})},[e.unref(lu)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[p.value?(e.openBlock(),e.createElementBlock("image",{key:1,class:"avatar-image",src:o.value,onLoad:h,onError:g},null,40,["src"])):(e.openBlock(),e.createElementBlock("image",{key:0,class:"avatar-image",src:e.unref(r)||o.value,onLoad:h,onError:g},null,40,["src"]))],64)):(e.openBlock(),e.createElementBlock("img",{key:1,class:"avatar-image",src:e.unref(r)||o.value,onLoad:h,onError:g},null,40,["src"])),e.unref(l)&&!d.value?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass({placeholder:!0,hidden:d.value,"skeleton-animation":e.unref(l)})},null,2)):e.createCommentVNode("",!0)],4))}}),Pd=L(Ud,[["__scopeId","data-v-0cee7b38"]]),Gd=L(e.defineComponent({__name:"index",props:{visible:{type:Boolean,default:!0},zIndex:{default:9999},useMask:{type:Boolean,default:!0},maskColor:{default:"rgba(0, 0, 0, 0.6)"},isFullScreen:{type:Boolean,default:!0},width:{default:"auto"},height:{default:"auto"}},emits:["onOverlayClick"],setup(t,{expose:n,emit:o}){const a=o,i=t,s=e.ref(),r=e.ref(i.visible);function c(){a("onOverlayClick")}return e.watch((()=>i.visible),(e=>{e?r.value=!0:setTimeout((()=>{r.value=!1}),150)}),{immediate:!0}),n({overlayDomRef:s}),(t,n)=>r.value?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"overlayDomRef",ref:s,class:"overlay-container",style:e.normalizeStyle({position:i.isFullScreen?"fixed":"absolute",zIndex:i.zIndex})},[i.useMask?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"overlay-mask":!0,"fade-in":i.visible}),style:e.normalizeStyle({backgroundColor:i.maskColor}),onClick:c,onTouchstart:e.withModifiers(c,["prevent","stop"])},null,38)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass({"overlay-content":!0,"full-screen":i.isFullScreen})},[e.renderSlot(t.$slots,"default",{},void 0,!0)],2)],4)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-84e83a22"]]),xd=L(e.defineComponent({__name:"index",props:{show:{type:Boolean,default:!1},isHeaderShow:{type:Boolean,default:!0},isFooterShow:{type:Boolean,default:!0},background:{type:Boolean,default:!0},title:{type:String,default:""},center:{type:Boolean,default:!1}},emits:["update:show","submit"],setup(t,{emit:n}){const o="outside",a="inside",i=t,s=e.ref(!1),r=e.ref(!0),c=e.ref(!0),l=e.ref(!0),u=e.ref("");e.watchEffect((()=>{s.value=i.show,u.value=i.title,r.value=i.isHeaderShow,c.value=i.isFooterShow,l.value=i.background}));const d=n,p=e=>{e===o&&h()},h=()=>{s.value=!s.value,d("update:show",s.value)},g=()=>{d("submit"),h()};return(n,i)=>s.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["dialog",[e.unref(iu)?"":"dialog-h5",t.center?"center":""]]),onClick:i[1]||(i[1]=e.withModifiers((e=>p(o)),["stop","prevent"]))},[e.createElementVNode("main",{class:e.normalizeClass(["dialog-main",[l.value?"":"dialog-main-back"]]),onClick:i[0]||(i[0]=e.withModifiers((e=>p(a)),["stop","prevent"]))},[r.value?(e.openBlock(),e.createElementBlock("header",{key:0,class:"dialog-main-header"},[e.createElementVNode("h1",{class:"dialog-main-title"},e.toDisplayString(u.value),1),e.createElementVNode("i",{class:"icon icon-close",onClick:h})])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["dialog-main-content",[e.unref(lu)&&e.unref(su)?"dialog-main-content-uniapp":""]])},[e.renderSlot(n.$slots,"default",{},void 0,!0)],2),c.value?(e.openBlock(),e.createElementBlock("footer",{key:1,class:"dialog-main-footer"},[e.createElementVNode("button",{class:"btn btn-cancel",onClick:h},e.toDisplayString(e.unref(Tr).t("component.取消")),1),e.createElementVNode("button",{class:"btn btn-default",onClick:g},e.toDisplayString(e.unref(Tr).t("component.确定")),1)])):e.createCommentVNode("",!0)],2)],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-69c18b36"]]),Bd=L(e.defineComponent({__name:"index",props:{actionsMenuPosition:{},selectedConversation:{},selectedConversationDomRect:{}},emits:["closeConversationActionMenu"],setup(t,{emit:n}){var o,a;const i=n,s=t,r=(null==(o=e.getCurrentInstance())?void 0:o.proxy)||e.getCurrentInstance(),c=e.ref(),l=e.ref(!0),u=e.ref(!1),d=kr.getConversationModel((null==(a=s.selectedConversation)?void 0:a.conversationID)||""),p=e.ref(s.actionsMenuPosition);e.onMounted((()=>{e.nextTick((()=>{var e;if(lu)(null==Fl?void 0:Fl.createSelectorQuery().in(r)).select("#conversation-actions-menu").boundingClientRect((e=>{var t;e&&(e.bottom>(null==(t=null==Fl?void 0:Fl.getWindowInfo)?void 0:t.call(Fl).windowHeight)&&(p.value={...s.actionsMenuPosition,top:s.actionsMenuPosition.top-(s.actionsMenuPosition.conversationHeight||0)-e.height}),p.value.left+e.width+5>Fl.getWindowInfo().windowWidth&&(p.value.left=Fl.getWindowInfo().windowWidth-e.width-5)),l.value=!1})).exec();else{const t=null==(e=c.value)?void 0:e.getBoundingClientRect();iu&&void 0!==s.actionsMenuPosition.left&&(p.value.left=s.actionsMenuPosition.left),t&&t.bottom>window.innerHeight&&(p.value.top=s.actionsMenuPosition.top-(s.actionsMenuPosition.conversationHeight||0)-t.height),l.value=!1}}))}));const h=e.computed((()=>{var e,t;return(null==(e=s.selectedConversation)?void 0:e.type)===Cr.TYPES.CONV_C2C?"TUIConversation.删除后，将清空该聊天的消息记录":(null==(t=s.selectedConversation)?void 0:t.type)===Cr.TYPES.CONV_GROUP?"TUIConversation.删除后，将清空该群聊的消息记录":""}));const g=e=>{const{name:t}=e,n=d;if(t&&n&&n.conversationID){switch(t){case Hu.DELETE:null==n||n.deleteConversation();break;case Hu.ISPINNED:case Hu.DISPINNED:null==n||n.pinConversation();break;case Hu.MUTE:case Hu.NOTMUTE:null==n||n.muteConversation()}i("closeConversationActionMenu")}},m=e=>{e||i("closeConversationActionMenu"),u.value=e};return(t,n)=>(e.openBlock(),e.createBlock(Gd,{maskColor:"transparent",onOnOverlayClick:n[6]||(n[6]=()=>i("closeConversationActionMenu"))},{default:e.withCtx((()=>[e.createElementVNode("div",{id:"conversation-actions-menu",ref_key:"actionsMenuDomRef",ref:c,class:e.normalizeClass([e.unref(iu)&&"actions-menu-pc","actions-menu",!l.value&&"cancel-hidden"]),style:e.normalizeStyle({top:`${p.value.top}px`,left:`${p.value.left}px`})},[e.createElementVNode("div",{class:e.normalizeClass(["actions-menu-item"]),onClick:n[0]||(n[0]=e.withModifiers((e=>{u.value=!0}),["stop"]))},e.toDisplayString(e.unref(Tr).t("TUIConversation.删除会话")),1),s.selectedConversation&&s.selectedConversation.isPinned?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["actions-menu-item"]),onClick:n[1]||(n[1]=e.withModifiers((t=>g({name:e.unref(Hu).ISPINNED})),["stop"]))},e.toDisplayString(e.unref(Tr).t("TUIConversation.置顶会话")),1)),s.selectedConversation&&s.selectedConversation.isPinned?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["actions-menu-item"]),onClick:n[2]||(n[2]=e.withModifiers((t=>g({name:e.unref(Hu).DISPINNED})),["stop"]))},e.toDisplayString(e.unref(Tr).t("TUIConversation.取消置顶")),1)):e.createCommentVNode("",!0),s.selectedConversation&&s.selectedConversation.isMuted?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["actions-menu-item"]),onClick:n[3]||(n[3]=e.withModifiers((t=>g({name:e.unref(Hu).MUTE})),["stop"]))},e.toDisplayString(e.unref(Tr).t("TUIConversation.消息免打扰")),1)),s.selectedConversation&&s.selectedConversation.isMuted?(e.openBlock(),e.createElementBlock("div",{key:3,class:e.normalizeClass(["actions-menu-item"]),onClick:n[4]||(n[4]=e.withModifiers((t=>g({name:e.unref(Hu).NOTMUTE})),["stop"]))},e.toDisplayString(e.unref(Tr).t("TUIConversation.取消免打扰")),1)):e.createCommentVNode("",!0)],6),e.createVNode(xd,{show:u.value,center:!0,isHeaderShow:e.unref(iu),onSubmit:n[5]||(n[5]=t=>g({name:e.unref(Hu).DELETE})),"onUpdate:show":m},{default:e.withCtx((()=>[e.createElementVNode("p",{class:"delDialog-title"},e.toDisplayString(e.unref(Tr).t(h.value)),1)])),_:1},8,["show","isHeaderShow"])])),_:1}))}}),[["__scopeId","data-v-e0168493"]]),Vd="/assets/mute.94c8513a.svg",Fd=L(e.defineComponent({__name:"index",props:{marker:{}},emits:["handleSwitchConversation","getPassingRef"],setup(t,{expose:n,emit:o}){const a=t;e.watch((()=>a.marker),(e=>{I("log","at TUIKit/components/TUIConversation/conversation-list/index.vue:104","Received marker:",e)}),{immediate:!0});const i=o,s=e.ref(),r=e.ref(),c=e.ref(),l=e.ref(!1),u=e.ref([]),d=e.ref(),p=e.ref(),h=e.ref({top:0,left:void 0,conversationHeight:void 0}),g=e.ref(!1),m=e.ref();let f=null;e.onMounted((()=>{kr.watch(oi.CONV,{currentConversationID:T,conversationList:k,currentConversation:C}),kr.watch(oi.USER,{displayOnlineStatus:M,userStatusList:S}),lu||!$l||iu||function(){if(!p.value)return;ou({element:p.value,onLongPress:(e,t)=>{const n=Array.from(p.value.children).indexOf(t);_(e,u.value[n],n)},options:{eventDelegation:{subSelector:".tui-conversation-content"}}})}()})),e.onUnmounted((()=>{kr.unwatch(oi.CONV,{currentConversationID:T,conversationList:k,currentConversation:C}),kr.unwatch(oi.USER,{displayOnlineStatus:M,userStatusList:S})}));const v=e=>g.value&&e.type===Cr.TYPES.CONV_C2C,_=(e,t,n,o)=>{o&&(e.preventDefault(),lu)||(s.value=t,f=Date.now(),E(e,n))},y=()=>{f&&Date.now()-f>300&&(s.value=void 0,l.value=!1)},E=(e,t)=>{var n;if(lu){void 0===d.value&&i("getPassingRef",d);(null==Fl?void 0:Fl.createSelectorQuery().in(d.value)).select(`#convlistitem-${t}`).boundingClientRect((t=>{t&&(h.value={top:t.bottom+(su?44:0),left:e.touches[0].pageX,conversationHeight:t.height},l.value=!0)})).exec()}else{const t=(null==(n=e.currentTarget||e.target)?void 0:n.getBoundingClientRect())||{};t&&(h.value={top:t.bottom,left:iu?e.clientX:void 0,conversationHeight:t.height}),l.value=!0}};function C(e){s.value=e}function k(e){I("log","at TUIKit/components/TUIConversation/conversation-list/index.vue:264","++++++++++++++++++++++++",e),u.value=[],e.forEach((e=>{"GROUP"!==e.type&&u.value.push(e)}))}function T(e){r.value=e}function M(e){g.value=e}function S(e){0!==e.size&&(m.value=[...e.entries()].reduce(((e,[t,n])=>(e[t]=n,e)),{}))}return n({closeChildren:y}),(t,n)=>(e.openBlock(),e.createElementBlock("div",null,[u.value.length>0?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"conversationListInnerDomRef",ref:p,class:"tui-conversation-list"},[l.value?(e.openBlock(),e.createBlock(Bd,{key:0,selectedConversation:s.value,actionsMenuPosition:h.value,selectedConversationDomRect:c.value,onCloseConversationActionMenu:y},null,8,["selectedConversation","actionsMenuPosition","selectedConversationDomRect"])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,((t,n)=>(e.openBlock(),e.createElementBlock("div",{id:`convlistitem-${n}`,key:n,class:e.normalizeClass(["tui-conversation-content",e.unref(uu)&&"tui-conversation-content-h5 disable-select"])},[e.createElementVNode("div",{style:{padding:"12px 0!important"},class:e.normalizeClass([e.unref(iu)&&"isPC","tui-conversation-item",r.value===t.conversationID&&"tui-conversation-item-selected",t.isPinned&&"tui-conversation-item-pinned"]),onClick:e=>{return n=t.conversationID,i("handleSwitchConversation",n),void Mr.switchConversation(n);var n},onLongpress:e=>_(e,t,n),onContextmenu:e=>_(e,t,n,!0)},[e.createElementVNode("aside",{class:"left"},[e.createVNode(Pd,{useSkeletonAnimation:"",url:t.getAvatar(),size:"30px"},null,8,["url"]),m.value&&v(t)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["online-status",Object.keys(m.value).length>0&&Object.keys(m.value).includes(t.userProfile.userID)&&1===m.value[t.userProfile.userID].statusType?"online-status-online":"online-status-offline"])},null,2)):e.createCommentVNode("",!0),t.unreadCount>0&&!t.isMuted?(e.openBlock(),e.createElementBlock("span",{key:1,class:"num"},e.toDisplayString(t.unreadCount>99?"99+":t.unreadCount),1)):e.createCommentVNode("",!0),t.unreadCount>0&&t.isMuted?(e.openBlock(),e.createElementBlock("span",{key:2,class:"num-notify"})):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:"content"},[e.createElementVNode("div",{style:{"margin-left":"10px"},class:"content-header"},[e.createElementVNode("label",{class:"content-header-label"},[e.createElementVNode("p",{class:"name"},e.toDisplayString(t.getShowName()),1)]),e.createElementVNode("div",{class:"middle-box"},[t.draftText&&t.conversationID!==r.value?(e.openBlock(),e.createElementBlock("span",{key:0,class:"middle-box-draft"},e.toDisplayString(e.unref(Tr).t("TUIChat.[草稿]")),1)):"GROUP"===t.type&&t.groupAtInfoList&&t.groupAtInfoList.length>0?(e.openBlock(),e.createElementBlock("span",{key:1,class:"middle-box-at"},e.toDisplayString(t.getGroupAtInfo()),1)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"middle-box-content"},e.toDisplayString(t.getLastMessage("text")),1)])]),e.createElementVNode("div",{class:"content-footer"},[e.createElementVNode("span",{class:"time"},e.toDisplayString(t.getLastMessage("time")),1),t.isMuted?(e.openBlock(),e.createBlock(pu,{key:0,file:e.unref(Vd)},null,8,["file"])):e.createCommentVNode("",!0)])])],42,["onClick","onLongpress","onContextmenu"])],10,["id"])))),128))],512)):(e.openBlock(),e.createElementBlock("div",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"100vh"}},[e.createElementVNode("image",{style:{"margin-top":"-600rpx"},src:Od,mode:"aspectFit"})]))]))}}),[["__scopeId","data-v-64da3b19"]]),Hd="/assets/start-group.6d6b5fbb.svg",qd="/assets/icon-c2c.d80299ab.svg";class zd{static getInstance(){return zd.instance||(zd.instance=new zd),zd.instance}getMenu(){const e=this.generateMenuList();return!iu&&e.length>0?[{text:Tr.t("TUIConversation.发起会话"),data:{name:"all",children:e}}]:e}generateMenuList(){return[{icon:qd,text:Tr.t("TUIConversation.发起单聊"),data:{name:ju},listener:{onClicked:this.createConversation.bind(this)}},{icon:Hd,text:Tr.t("TUIConversation.发起群聊"),data:{name:qu},listener:{onClicked:this.createConversation.bind(this)}}]}createConversation(e){Wr.callService({serviceName:Ar.TUIConversation.SERVICE.NAME,method:Ar.TUIConversation.SERVICE.METHOD.CREATE_CONVERSATION,params:e})}}const Kd=L(e.defineComponent({__name:"index",setup(t,{expose:n}){const o=e.ref([]),a=e.ref(),i=e.computed((()=>zd.getInstance().getMenu()));e.onMounted((()=>{o.value=[]}));const s=e=>{const{data:{children:t},listener:n={onClicked:()=>{}}}=e;t?o.value=o.value.length>0?[]:t:(n.onClicked(e),r())},r=()=>{o.value=[]};return n({closeChildren:r}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref:a.value,class:"tui-conversation-header"},[i.value.length>0?(e.openBlock(),e.createElementBlock("ul",{key:0,class:"list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"list-item"},[e.createElementVNode("main",{class:"tui-conversation-header-item",onClick:e.withModifiers((e=>s(t)),["stop"])},[t.icon&&!t.data.children?(e.openBlock(),e.createBlock(pu,{key:0,class:"tui-conversation-header-item-icon",file:t.icon},null,8,["file"])):(e.openBlock(),e.createElementBlock("i",{key:1,class:"plus"})),e.createElementVNode("h1",{class:"tui-conversation-header-item-title"},e.toDisplayString(t.text),1)],8,["onClick"])])))),128))])):e.createCommentVNode("",!0),o.value.length>0?(e.openBlock(),e.createElementBlock("ul",{key:1,class:"tui-conversation-header-children list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"list-item"},[e.createElementVNode("main",{class:"tui-conversation-header-item",onClick:e=>s(t)},[t.icon?(e.openBlock(),e.createBlock(pu,{key:0,class:"tui-conversation-header-item-icon",file:t.icon},null,8,["file"])):e.createCommentVNode("",!0),e.createElementVNode("h1",{class:"tui-conversation-header-item-title"},e.toDisplayString(t.text),1)],8,["onClick"])])))),128))])):e.createCommentVNode("",!0)],512))}}),[["__scopeId","data-v-dec3e06b"]]),$d=L(e.defineComponent({__name:"index",setup(t){const n=e.ref(!1);return kr.watch(oi.USER,{netStateChange:e=>{n.value=e===Cr.TYPES.NET_STATE_DISCONNECTED}}),(t,o)=>n.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"network"},[e.createElementVNode("i",{class:"icon icon-error"},"!"),e.createElementVNode("p",{class:"network-content"},e.toDisplayString(e.unref(Tr).t("TUIConversation.网络异常，请您检查网络设置")),1)])):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-8f9cbd06"]]),Yd=e.defineComponent({__name:"index",props:{marker:{}},emits:["handleSwitchConversation","updateConversationListLengthTeachers"],setup(t,{emit:n}){const o=n,a=e.ref(0),i=e.ref(),s=e.ref(),r=e.ref(0),c=e.ref(0),l=e.ref(!0);e.ref(0),kr.watch(oi.CONV,{totalUnreadCount:e=>{a.value=e}}),kr.watch(oi.CUSTOM,{isShowConversationHeader:e=>{l.value=!1!==e}});const u=()=>{var e,t;const n=(null==(t=null==(e=s.value)?void 0:e.items)?void 0:t.length)||0;I("log","at TUIKit/components/TUIConversation/index.vue:56","++++",n),o("updateConversationListLengthTeachers",n)};e.onMounted((()=>{u()})),e.watch(s,(()=>{u()}));const d=e=>{null==Fl||Fl.navigateTo({url:"/TUIKit/components/TUIChat/index"}),o("handleSwitchConversation",e)},p=()=>{var e,t;null==(e=null==i?void 0:i.value)||e.closeChildren(),null==(t=null==s?void 0:s.value)||t.closeChildren()},h=()=>{p()};T(p);const g=e=>{r.value=e.changedTouches[0].clientX,c.value=e.changedTouches[0].clientY},m=e=>{const t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY;let o="";t-r.value>50&&Math.abs(n-c.value)<50?o="right":t-r.value<-50&&Math.abs(n-c.value)<50&&(o="left"),n-c.value>50&&Math.abs(t-r.value)<50?o="down":n-c.value<-50&&Math.abs(t-r.value)<50&&(o="up"),"down"!==o&&"up"!==o||p()},f=e=>{e.value=s.value};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"tui-conversation",onClick:h,onTouchstart:g,onTouchend:m},[e.createVNode(Ad,{style:{display:"none"},searchType:"global"}),l.value?(e.openBlock(),e.createBlock(Kd,{key:0,ref_key:"headerRef",ref:i},null,512)):e.createCommentVNode("",!0),e.createVNode($d),e.createVNode(Fd,{ref_key:"conversationListDomRef",ref:s,class:"tui-conversation-list",onHandleSwitchConversation:d,onGetPassingRef:f},null,512)],32))}}),Wd=L(Yd,[["__scopeId","data-v-6f3b6c4d"]]),Jd=L(e.defineComponent({__name:"index1",props:{marker:{}},emits:["handleSwitchConversation","getPassingRef"],setup(t,{expose:n,emit:o}){const a=t;e.watch((()=>a.marker),(e=>{I("log","at TUIKit/components/TUIConversation/conversation-list/index1.vue:104","Received marker:",e)}),{immediate:!0});const i=o,s=e.ref(),r=e.ref(),c=e.ref(),l=e.ref(!1),u=e.ref([]),d=e.ref(),p=e.ref(),h=e.ref({top:0,left:void 0,conversationHeight:void 0}),g=e.ref(!1),m=e.ref();let f=null;e.onMounted((()=>{kr.watch(oi.CONV,{currentConversationID:T,conversationList:k,currentConversation:C}),kr.watch(oi.USER,{displayOnlineStatus:M,userStatusList:S}),lu||!$l||iu||function(){if(!p.value)return;ou({element:p.value,onLongPress:(e,t)=>{const n=Array.from(p.value.children).indexOf(t);_(e,u.value[n],n)},options:{eventDelegation:{subSelector:".tui-conversation-content"}}})}()})),e.onUnmounted((()=>{kr.unwatch(oi.CONV,{currentConversationID:T,conversationList:k,currentConversation:C}),kr.unwatch(oi.USER,{displayOnlineStatus:M,userStatusList:S})}));const v=e=>g.value&&e.type===Cr.TYPES.CONV_C2C,_=(e,t,n,o)=>{o&&(e.preventDefault(),lu)||(s.value=t,f=Date.now(),E(e,n))},y=()=>{f&&Date.now()-f>300&&(s.value=void 0,l.value=!1)},E=(e,t)=>{var n;if(lu){void 0===d.value&&i("getPassingRef",d);(null==Fl?void 0:Fl.createSelectorQuery().in(d.value)).select(`#convlistitem-${t}`).boundingClientRect((t=>{t&&(h.value={top:t.bottom+(su?44:0),left:e.touches[0].pageX,conversationHeight:t.height},l.value=!0)})).exec()}else{const t=(null==(n=e.currentTarget||e.target)?void 0:n.getBoundingClientRect())||{};t&&(h.value={top:t.bottom,left:iu?e.clientX:void 0,conversationHeight:t.height}),l.value=!0}};function C(e){s.value=e}function k(e){I("log","at TUIKit/components/TUIConversation/conversation-list/index1.vue:264","++++++++++++++++++++++++",e),u.value=[],e.forEach((e=>{"GROUP"===e.type&&u.value.push(e)}))}function T(e){r.value=e}function M(e){g.value=e}function S(e){0!==e.size&&(m.value=[...e.entries()].reduce(((e,[t,n])=>(e[t]=n,e)),{}))}return n({closeChildren:y}),(t,n)=>(e.openBlock(),e.createElementBlock("div",null,[u.value.length>0?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"conversationListInnerDomRef",ref:p,class:"tui-conversation-list"},[l.value?(e.openBlock(),e.createBlock(Bd,{key:0,selectedConversation:s.value,actionsMenuPosition:h.value,selectedConversationDomRect:c.value,onCloseConversationActionMenu:y},null,8,["selectedConversation","actionsMenuPosition","selectedConversationDomRect"])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,((t,n)=>(e.openBlock(),e.createElementBlock("div",{id:`convlistitem-${n}`,key:n,class:e.normalizeClass(["tui-conversation-content",e.unref(uu)&&"tui-conversation-content-h5 disable-select"])},[e.createElementVNode("div",{style:{padding:"12px 0!important"},class:e.normalizeClass([e.unref(iu)&&"isPC","tui-conversation-item",r.value===t.conversationID&&"tui-conversation-item-selected",t.isPinned&&"tui-conversation-item-pinned"]),onClick:e=>{return n=t.conversationID,i("handleSwitchConversation",n),void Mr.switchConversation(n);var n},onLongpress:e=>_(e,t,n),onContextmenu:e=>_(e,t,n,!0)},[e.createElementVNode("aside",{class:"left"},[e.createVNode(Pd,{useSkeletonAnimation:"",url:t.getAvatar(),size:"30px"},null,8,["url"]),m.value&&v(t)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["online-status",Object.keys(m.value).length>0&&Object.keys(m.value).includes(t.userProfile.userID)&&1===m.value[t.userProfile.userID].statusType?"online-status-online":"online-status-offline"])},null,2)):e.createCommentVNode("",!0),t.unreadCount>0&&!t.isMuted?(e.openBlock(),e.createElementBlock("span",{key:1,class:"num"},e.toDisplayString(t.unreadCount>99?"99+":t.unreadCount),1)):e.createCommentVNode("",!0),t.unreadCount>0&&t.isMuted?(e.openBlock(),e.createElementBlock("span",{key:2,class:"num-notify"})):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:"content"},[e.createElementVNode("div",{style:{"margin-left":"10px"},class:"content-header"},[e.createElementVNode("label",{class:"content-header-label"},[e.createElementVNode("p",{class:"name"},e.toDisplayString(t.getShowName()),1)]),e.createElementVNode("div",{class:"middle-box"},[t.draftText&&t.conversationID!==r.value?(e.openBlock(),e.createElementBlock("span",{key:0,class:"middle-box-draft"},e.toDisplayString(e.unref(Tr).t("TUIChat.[草稿]")),1)):"GROUP"===t.type&&t.groupAtInfoList&&t.groupAtInfoList.length>0?(e.openBlock(),e.createElementBlock("span",{key:1,class:"middle-box-at"},e.toDisplayString(t.getGroupAtInfo()),1)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"middle-box-content"},e.toDisplayString(t.getLastMessage("text")),1)])]),e.createElementVNode("div",{class:"content-footer"},[e.createElementVNode("span",{class:"time"},e.toDisplayString(t.getLastMessage("time")),1),t.isMuted?(e.openBlock(),e.createBlock(pu,{key:0,file:e.unref(Vd)},null,8,["file"])):e.createCommentVNode("",!0)])])],42,["onClick","onLongpress","onContextmenu"])],10,["id"])))),128))],512)):(e.openBlock(),e.createElementBlock("div",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"100vh"}},[e.createElementVNode("image",{style:{"margin-top":"-600rpx"},src:Od,mode:"aspectFit"})]))]))}}),[["__scopeId","data-v-5d7ffac1"]]),Xd=e.defineComponent({__name:"index1",emits:["handleSwitchConversation","updateConversationListLength"],setup(t,{emit:n}){const o=n,a=e.ref(0),i=e.ref(),s=e.ref(),r=e.ref(0),c=e.ref(0),l=e.ref(!0);e.ref(0),kr.watch(oi.CONV,{totalUnreadCount:e=>{a.value=e}}),kr.watch(oi.CUSTOM,{isShowConversationHeader:e=>{l.value=!1!==e}});const u=()=>{var e,t;const n=(null==(t=null==(e=s.value)?void 0:e.items)?void 0:t.length)||0;I("log","at TUIKit/components/TUIConversation/index1.vue:53","++++",n),o("updateConversationListLength",n)};e.onMounted((()=>{u()})),e.watch(s,(()=>{u()}));const d=e=>{null==Fl||Fl.navigateTo({url:"/TUIKit/components/TUIChat/index"}),o("handleSwitchConversation",e)},p=()=>{var e,t;I("log","at TUIKit/components/TUIConversation/index1.vue:70","closeChildren"),null==(e=null==i?void 0:i.value)||e.closeChildren(),null==(t=null==s?void 0:s.value)||t.closeChildren()},h=()=>{p()};T(p);const g=e=>{r.value=e.changedTouches[0].clientX,c.value=e.changedTouches[0].clientY},m=e=>{const t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY;let o="";t-r.value>50&&Math.abs(n-c.value)<50?o="right":t-r.value<-50&&Math.abs(n-c.value)<50&&(o="left"),n-c.value>50&&Math.abs(t-r.value)<50?o="down":n-c.value<-50&&Math.abs(t-r.value)<50&&(o="up"),"down"!==o&&"up"!==o||p()},f=e=>{e.value=s.value,I("log","at TUIKit/components/TUIConversation/index1.vue:121","-+-+-+-+-+-",e.value),I("log","at TUIKit/components/TUIConversation/index1.vue:122","-+-+-+-+-+-",s.value)};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"tui-conversation",onClick:h,onTouchstart:g,onTouchend:m},[e.createVNode(Ad,{style:{display:"none"},searchType:"global"}),l.value?(e.openBlock(),e.createBlock(Kd,{key:0,ref_key:"headerRef",ref:i},null,512)):e.createCommentVNode("",!0),e.createVNode($d),e.createVNode(Jd,{ref_key:"conversationListDomRef",ref:s,class:"tui-conversation-list",onHandleSwitchConversation:d,onGetPassingRef:f},null,512)],32))}}),Zd=L(Xd,[["__scopeId","data-v-eb527a91"]]),Qd=L({__name:"message",setup(t){const n=e.ref();M((()=>{n.value=getApp().globalData.top})),e.ref([{avatar:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngc16f5b5f9c443120840c9f3ff8028109651b9e21de9ee0d18951c54acb7132e8",title:"书法一班群聊",subtitle:"刘易阳王老师你号啊",time:"6-15",color:"#5791F2"},{avatar:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngc16f5b5f9c443120840c9f3ff8028109651b9e21de9ee0d18951c54acb7132e8",title:"书法二班群聊",subtitle:"刘易阳王老师你号啊",time:"6-15",color:"#5791F2"}]),e.ref([{avatar:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng3c05227c15cc3e583fbe8af777d512ad3c5dd22f9540376effbda59a5f162710",title:"公告消息",subtitle:"书法比赛将在2024年7月15号开始...",time:"6-15",size:"88rpx"}]);const o=e=>{try{uni.navigateTo({url:e})}catch(t){I("error","at pages/pagesall/home/message.vue:109","导航失败:",t),uni.showToast({title:"导航失败，请重试",icon:"none"})}},a=()=>{uni.switchTab({url:"/pages/pagesall/home"})},i=()=>{uni.scanCode({success:e=>{I("log","at pages/pagesall/home/message.vue:121","条码类型：",e.scanType),I("log","at pages/pagesall/home/message.vue:122","条码内容：",e.result)},fail:e=>{I("error","at pages/pagesall/home/message.vue:125","扫码失败:",e),uni.showToast({title:"扫码失败，请重试",icon:"none"})}})},s=()=>o("/pages/message/mycode"),r=()=>o("/pages/message/search"),c=()=>o("/pages/pagesall/home/adverMess");return(t,o)=>(e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(n.value+5)+"px;")},null,4),e.createElementVNode("view",{class:"mess_Title"},[e.createElementVNode("view",{class:"messImg",onClick:a},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"title_text"}," 消息 "),e.createElementVNode("view",{class:"title_img"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng321758fb81a047a63eed79ffbd8a9de39b6d95d0adc9749329922655c760bb3a",alt:"",onClick:s}),e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng5e1b57899cb5b9cd47a8d4e301f4f736efd47c45ca7713a43d00721e94370714",alt:"",onClick:i}),e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng60de4c6690251e592eeb3edf5e89b8b74e18a9d17717d9949db1edcb3fcd23bd",alt:"",onClick:r})])]),e.createElementVNode("view",{class:"messbox",onClick:c},[e.createElementVNode("view",{class:"messbox2"},[e.createElementVNode("view",{class:"messbox_img"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngd6279aab531ef9632e4b587c47bd1b290e34249129eb3b24c940e727cb528bd0",alt:""})]),e.createElementVNode("view",{class:"messinter"},[e.createElementVNode("view",{class:"inter_text1"}," 公告消息 "),e.createElementVNode("view",{class:"inter_text2"}," 书法比赛将在2024年7月15号开始… ")])]),e.createElementVNode("text",{class:"inter_text3"},"6-15")]),e.createElementVNode("view",{class:"group_group",style:{height:"130rpx"}},[e.createVNode(Zd)])]),e.createElementVNode("view",{style:{width:"100%",height:"16rpx",background:"#eeeeee"}}),e.createElementVNode("view",{class:"container"},[e.createVNode(Wd)])]))}},[["__scopeId","data-v-e246a3b0"]]),ep="/assets/selected.0a1e59e6.svg",tp="/assets/back.e9626a2e.svg",np=e.defineComponent({__name:"index",props:{list:{type:Array,default:()=>[]},selectedList:{type:Array,default:()=>[]},isSearch:{type:Boolean,default:!0},isRadio:{type:Boolean,default:!1},isCustomItem:{type:Boolean,default:!1},title:{type:String,default:""},type:{type:String,default:""},resultShow:{type:Boolean,default:!0},total:{type:Number,default:0},isHiddenBackIcon:{type:Boolean,default:!1}},emits:["search","submit","cancel","getMore"],setup(t,{emit:n}){const o=t,a=e.ref([]),i=e.ref(0),s=e.ref([]),r=e.ref(!0),c=e.ref(!1),l=e.ref(""),u=e.ref("");e.watchEffect((()=>{if(o.isCustomItem)for(let e=0;e<o.list.length;e++)o.list[e].conversationID.indexOf("@TIM#SYSTEM")>-1&&o.list.splice(e,1),a.value=o.list;else a.value=o.list;i.value=o.total?o.total:o.list.length,s.value=o.selectedList&&o.selectedList.length>0?o.selectedList:s.value,r.value=o.isSearch,c.value=o.isCustomItem,l.value=o.title}));const d=n,p=e.computed((()=>a.value.filter((e=>!e.isDisabled)))),h=e=>{u.value=e.target.value||e.detail.value,d("search",u.value)},g=e=>{if(e.isDisabled)return;let t=s.value;const n=t.indexOf(e);if(n>-1)return s.value.splice(n,1);o.isRadio&&(t=[]),t.push(e),s.value=t},m=()=>{s.value.length===p.value.length?s.value=[]:s.value=[...p.value]},f=()=>{d("submit",s.value),u.value=""},v=()=>{d("cancel"),u.value=""},_=()=>{d("getMore")};return(n,d)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["transfer",[e.unref(iu)?"":"transfer-h5",e.unref(ru)?"transfer-h5-wechat":""]])},[e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("header",{key:0,class:"transfer-header transfer-h5-header"},[o.isHiddenBackIcon?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,onClick:v},[e.createVNode(pu,{class:"icon",file:e.unref(tp),width:"18px",height:"18px"},null,8,["file"])])),e.createElementVNode("span",{class:"title"},e.toDisplayString(l.value),1),e.createElementVNode("span",{class:"space"})])),e.createElementVNode("main",{class:"main"},[e.createElementVNode("div",{class:"left"},[e.createElementVNode("header",{class:"transfer-header"},[e.unref(iu)&&r.value?(e.openBlock(),e.createElementBlock("input",{key:0,type:"text",value:u.value,placeholder:e.unref(Tr).t("component.请输入userID"),enterkeyhint:"search",class:e.normalizeClass([e.unref(lu)?"left-uniapp-input":""]),onKeyup:e.withKeys(h,["enter"])},null,42,["value","placeholder"])):e.createCommentVNode("",!0),!e.unref(iu)&&r.value?(e.openBlock(),e.createElementBlock("input",{key:1,type:"text",placeholder:e.unref(Tr).t("component.请输入userID"),enterkeyhint:"search",value:u.value,class:e.normalizeClass([e.unref(lu)?"left-uniapp-input":""]),onBlur:h,onConfirm:h},null,42,["placeholder","value"])):e.createCommentVNode("",!0)]),e.createElementVNode("main",{class:"transfer-left-main"},[e.createElementVNode("ul",{class:"transfer-list"},[p.value.length>1&&!t.isRadio?(e.openBlock(),e.createElementBlock("li",{key:0,class:"transfer-list-item",onClick:m},[s.value.length===p.value.length?(e.openBlock(),e.createBlock(pu,{key:0,file:e.unref(ep),width:"18px",height:"18px"},null,8,["file"])):(e.openBlock(),e.createElementBlock("i",{key:1,class:"icon-unselected"})),e.createElementVNode("span",{class:"select-all"},e.toDisplayString(e.unref(Tr).t("component.全选")),1)])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,(t=>(e.openBlock(),e.createElementBlock("li",{key:t.userID,class:"transfer-list-item",onClick:e=>g(t)},[s.value.indexOf(t)>-1?(e.openBlock(),e.createBlock(pu,{key:0,file:e.unref(ep),class:e.normalizeClass([t.isDisabled&&"disabled"]),width:"18px",height:"18px"},null,8,["file","class"])):(e.openBlock(),e.createElementBlock("i",{key:1,class:e.normalizeClass([t.isDisabled&&"disabled","icon-unselected"])},null,2)),c.value?e.renderSlot(n.$slots,"left",{key:3,data:t},void 0,!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[e.createElementVNode("img",{class:"avatar",src:t.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"]),e.createElementVNode("span",{class:"name"},e.toDisplayString(t.nick||t.userID),1),t.isDisabled?(e.openBlock(),e.createElementBlock("span",{key:0},"（"+e.toDisplayString(e.unref(Tr).t("component.已在群中"))+"）",1)):e.createCommentVNode("",!0)],64))],8,["onClick"])))),128)),i.value>a.value.length?(e.openBlock(),e.createElementBlock("li",{key:1,class:"transfer-list-item more",onClick:_},e.toDisplayString(e.unref(Tr).t("component.查看更多")),1)):e.createCommentVNode("",!0)])])]),e.createElementVNode("div",{class:"right"},[e.unref(iu)?(e.openBlock(),e.createElementBlock("header",{key:0,class:"transfer-header"},e.toDisplayString(l.value),1)):e.createCommentVNode("",!0),t.resultShow?(e.openBlock(),e.createElementBlock("ul",{key:1,class:"transfer-list"},[s.value.length>0&&e.unref(iu)?(e.openBlock(),e.createElementBlock("p",{key:0,class:"transfer-text"},e.toDisplayString(e.unref(Tr).t("component.已选中"))+e.toDisplayString(s.value.length)+e.toDisplayString(e.unref(Tr).t("component.人")),1)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,o)=>(e.openBlock(),e.createElementBlock("li",{key:o,class:"transfer-list-item space-between"},[e.createElementVNode("aside",{class:"transfer-list-item-content"},[c.value?e.renderSlot(n.$slots,"right",{key:1,data:t},void 0,!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("img",{class:"avatar",src:t.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"]),e.unref(iu)?(e.openBlock(),e.createElementBlock("span",{key:0,class:"name"},e.toDisplayString(t.nick||t.userID),1)):e.createCommentVNode("",!0)],64))]),e.unref(iu)?(e.openBlock(),e.createElementBlock("span",{key:0,onClick:e=>g(t)},[e.createVNode(pu,{file:e.unref("/assets/cancel.aba36dc1.svg"),width:"18px",height:"18px"},null,8,["file"])],8,["onClick"])):e.createCommentVNode("",!0)])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("footer",{class:"transfer-right-footer"},[e.createElementVNode("button",{class:"btn btn-cancel",onClick:v},e.toDisplayString(e.unref(Tr).t("component.取消")),1),s.value.length>0?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn",onClick:f},e.toDisplayString(e.unref(Tr).t("component.完成")),1)):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-no",onClick:f},e.toDisplayString(e.unref(Tr).t("component.完成")),1))])])])],2))}}),op=L(np,[["__scopeId","data-v-f48be569"]]),ap=e.defineComponent({__name:"index",props:{isRadio:{type:Boolean,default:!1},isNeedSearch:{type:Boolean,default:!1},title:{type:String,default:""},userList:{type:Array,default:()=>[]},total:{type:Number,default:0}},emits:["complete","search","getMore"],setup(t,{emit:n}){const o=n,a=t,i=()=>{o("complete",[])},s=e=>{o("complete",e)},r=e=>{o("search",e)},c=()=>{o("getMore")};return(t,n)=>(e.openBlock(),e.createBlock(xd,{show:!0,isH5:!e.unref(iu),isHeaderShow:!1,isFooterShow:!1,background:!1,"onUpdate:show":i},{default:e.withCtx((()=>[e.createVNode(op,{isSearch:a.isNeedSearch,title:a.title,list:a.userList,isH5:!e.unref(iu),isRadio:a.isRadio,total:a.total,onGetMore:c,onSearch:r,onSubmit:s,onCancel:i},null,8,["isSearch","title","list","isH5","isRadio","total"])])),_:1},8,["isH5"]))}});class ip{constructor(){Wr.registerService(Ar.TUIContact.SERVICE.NAME,this),this.onCallParamsMap=new Map,this.onCallCallbackMap=new Map,this.constants=Ar}static getInstance(){return ip.instance||(ip.instance=new ip),ip.instance}getOnCallParams(e){return this.onCallParamsMap.get(e)}getOnCallCallback(e){return this.onCallCallbackMap.get(e)}async onCall(e,t,n){this.onCallParamsMap.set(e,t),this.onCallCallbackMap.set(e,n),e===Ar.TUIContact.SERVICE.METHOD.SELECT_FRIEND&&(kr.update(oi.CUSTOM,"isShowSelectFriendComponent",!0),lu&&(null==Fl||Fl.reLaunch({url:"/TUIKit/components/TUIContact/index"})))}}const sp=e.defineComponent({__name:"index",setup(t){const n=ip.getInstance(),o=n.constants,a=e.ref(!1),i=e.ref([]),s=e.ref([]),r=e.ref(null),c=e.ref({isRadio:!1,isNeedSearch:!1,title:""});e.watchEffect((()=>{const e=n.getOnCallParams(o.TUIContact.SERVICE.METHOD.SELECT_FRIEND);var t;c.value.title=e.title,c.value.isRadio=e.isRadio,c.value.isNeedSearch=e.isNeedSearch,e.isNeedSearch&&(t=e.isNeedSearch,r.value=Wr.getService(o.TUISearch.SERVICE.NAME),r.value?a.value=t:I("warn","at TUIKit/components/TUIContact/select-friend/index.vue:35","请添加 TUISearch 组件")),wr.getFriendList().then((e=>{i.value=e.data.map((e=>e.profile)),s.value=i.value})).catch((e=>{I("warn","at TUIKit/components/TUIContact/select-friend/index.vue:51","getFriendList error:",e)}))}));const l=e=>{kr.update(oi.CUSTOM,"isShowSelectFriendComponent",!1);const t=n.getOnCallCallback(o.TUIContact.SERVICE.METHOD.SELECT_FRIEND);t&&t(e)},u=()=>{yd({message:Tr.t("TUIGroup.该用户不存在"),type:vd}),s.value=[...i.value]},d=async e=>{if(!e)return s.value=i.value;try{const t=await r.value.searchUser(e);if(!t.data[0])return u();s.value=t.data;const n=i.value.filter((e=>e.userID===t.data[0].userID));i.value=n.length?i.value:[...i.value,...s.value]}catch(t){return u()}};return(t,n)=>(e.openBlock(),e.createBlock(ap,{isRadio:c.value.isRadio,isNeedSearch:c.value.isNeedSearch,title:c.value.title,userList:s.value,onSearch:d,onComplete:l},null,8,["isRadio","isNeedSearch","title","userList"]))}}),rp="Expected a function";function cp(e,t,n){let o=!0,a=!0;if("function"!=typeof e)throw new TypeError(rp);return n&&up(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),lp(e,t,{leading:o,maxWait:t,trailing:a})}function lp(e,t,n){let o,a,i,s,r,c,l=0,u=!1,d=!1,p=!0;if("function"!=typeof e)throw new TypeError(rp);function h(t){const n=o,i=a;return o=a=void 0,l=t,s=e.apply(i,n),s}function g(e){const n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=i}function m(){const e=Date.now();if(g(e))return f(e);r=setTimeout(m,function(e){const n=e-l,o=t-(e-c);return d?Math.min(o,i-n):o}(e))}function f(e){return r=void 0,p&&o?h(e):(o=a=void 0,s)}function v(){const e=Date.now(),n=g(e);if(o=arguments,a=this,c=e,n){if(void 0===r)return function(e){return l=e,r=setTimeout(m,t),u?h(e):s}(c);if(d)return clearTimeout(r),r=setTimeout(m,t),h(c)}return void 0===r&&(r=setTimeout(m,t)),s}return t=t||0,n&&up(n)&&(u=!!n.leading,d="maxWait"in n,i=d?Math.max(n.maxWait||0,t):i,p="trailing"in n?!!n.trailing:p),v.cancel=function(){void 0!==r&&clearTimeout(r),l=0,o=c=a=r=void 0},v.flush=function(){return void 0===r?s:f(Date.now())},v}function up(e){const t=typeof e;return null!=e&&("object"==t||"function"==t)}const dp=L(e.defineComponent({__name:"index",setup(t){const n=Tr.t("TUIContact.输入ID"),o=e.ref(!0),a=e.ref(""),i=e.ref({user:{label:"联系人",list:[]},group:{label:"群聊",list:[]}}),s=lp((function(e){o.value=e}),200),r=async()=>{a.value&&(Wr.callService({serviceName:Ar.TUISearch.SERVICE.NAME,method:Ar.TUISearch.SERVICE.METHOD.SEARCH_USER,params:{userID:a.value}}).then((e=>{i.value.user.list=e.data})).catch((e=>{i.value.user.list=[],I("warn","at TUIKit/components/TUIContact/contact-search/index.vue:83","search user error",e)})),Wr.callService({serviceName:Ar.TUISearch.SERVICE.NAME,method:Ar.TUISearch.SERVICE.METHOD.SEARCH_GROUP,params:{groupID:a.value}}).then((e=>{i.value.group.list=[e.data.group]})).catch((e=>{i.value.group.list=[],I("warn","at TUIKit/components/TUIContact/contact-search/index.vue:97","search group error",e)})))};return e.watch((()=>i.value),(()=>{kr.update(oi.CUSTOM,"currentContactSearchResult",i.value)}),{deep:!0,immediate:!0}),e.watch((()=>o.value),(()=>{kr.update(oi.CUSTOM,"currentContactSearchingStatus",o.value),o.value&&(a.value="",i.value.user.list=[],i.value.group.list=[])}),{deep:!0,immediate:!0}),Fl.updateContactSearch=r,Fl.closeSearching=()=>{o.value=!1},(t,i)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["tui-contact-search",!e.unref(iu)&&"tui-contact-search-h5"])},[o.value&&e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-contact-search-header",!e.unref(iu)&&"tui-contact-search-h5-header",o.value&&"tui-contact-searching-h5-header"]),onClick:i[0]||(i[0]=t=>e.unref(s)(!0))},[e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-search-header-title",!e.unref(iu)&&"tui-contact-search-h5-header-title"])},e.toDisplayString(e.unref(Tr).t("TUIContact.添加好友/群聊")),3)],2)),o.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["tui-contact-search-main",!e.unref(iu)&&"tui-contact-search-h5-main"])},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":i[1]||(i[1]=e=>a.value=e),class:"tui-contact-search-main-input",type:"text",placeholder:e.unref(n),enterkeyhint:"search",onKeyup:e.withKeys(r,["enter"]),onBlur:r,onConfirm:r},null,40,["placeholder"]),[[e.vModelText,a.value]])],2)):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-32be8dc3"]]),pp=e=>{var t;return(null==e?void 0:e.avatar)||(null==(t=null==e?void 0:e.profile)?void 0:t.avatar)||(null==e?void 0:e.groupID)&&"https://web.sdk.qcloud.com/im/assets/images/Public.svg"||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png"},hp=e=>{var t;return(null==e?void 0:e.remark)||(null==e?void 0:e.name)||(null==(t=null==e?void 0:e.profile)?void 0:t.nick)||(null==e?void 0:e.nick)||(null==e?void 0:e.groupID)||(null==e?void 0:e.userID)||""},gp=e=>{var t;return(null==e?void 0:e.name)||(null==(t=null==e?void 0:e.profile)?void 0:t.nick)||(null==e?void 0:e.nick)||(null==e?void 0:e.groupID)||(null==e?void 0:e.userID)||""},mp=e=>{var t,n;return(null==e?void 0:e.type)===(null==(t=null==Cr?void 0:Cr.TYPES)?void 0:t.SNS_APPLICATION_SENT_TO_ME)||(null==e?void 0:e.type)===(null==(n=null==Cr?void 0:Cr.TYPES)?void 0:n.SNS_APPLICATION_SENT_BY_ME)},fp=e=>{const t=(null==e?void 0:e.groupID)?`GROUP${null==e?void 0:e.groupID}`:`C2C${null==e?void 0:e.userID}`;Mr.switchConversation(t).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:200","switch conversation failed:",e),yd({message:Tr.t("TUIContact.进入会话失败"),type:vd})}))},vp=e=>{wr.acceptFriendApplication({userID:e,type:Cr.TYPES.SNS_APPLICATION_AGREE_AND_ADD}).then((()=>{yd({message:Tr.t("TUIContact.添加好友成功"),type:md})})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:222","accept friend application failed:",e),yd({message:Tr.t("TUIContact.同意好友申请失败"),type:vd})}))},_p=(e,t)=>{br.joinGroup({groupID:e,applyMessage:t}).then((e=>{var t;switch(null==(t=null==e?void 0:e.data)?void 0:t.status){case Cr.TYPES.JOIN_STATUS_WAIT_APPROVAL:yd({message:Tr.t("TUIContact.等待管理员同意"),type:md});break;case Cr.TYPES.JOIN_STATUS_SUCCESS:yd({message:Tr.t("TUIContact.加群成功"),type:md});break;case Cr.TYPES.JOIN_STATUS_ALREADY_IN_GROUP:yd({message:Tr.t("TUIContact.您已是群成员"),type:md})}})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:316","join group failed:",e),yd({message:"申请入群失败",type:vd})}))},yp=L(e.defineComponent({__name:"index",props:{item:{default:()=>({})},displayOnlineStatus:{type:Boolean,default:!1}},setup(t){const n=t,o=e.inject("userOnlineStatusMap"),a=e.ref(!1),i={[Cr.TYPES.GRP_WORK]:"Work",[Cr.TYPES.GRP_AVCHATROOM]:"AVChatRoom",[Cr.TYPES.GRP_PUBLIC]:"Public",[Cr.TYPES.GRP_MEETING]:"Meeting",[Cr.TYPES.GRP_COMMUNITY]:"Community"},s=e.computed((()=>{var e,t,o,a,i,s,r;let c="";return(null==(e=n.item)?void 0:e.type)===(null==(t=null==Cr?void 0:Cr.TYPES)?void 0:t.SNS_APPLICATION_SENT_TO_ME)||(null==(o=n.item)?void 0:o.type)===(null==(a=null==Cr?void 0:Cr.TYPES)?void 0:a.SNS_APPLICATION_SENT_BY_ME)?c=(null==(i=n.item)?void 0:i.wording)||"":(null==(s=n.item)?void 0:s.groupID)&&(c=`ID:${null==(r=n.item)?void 0:r.groupID}`),c})),r=e.computed((()=>{var e,t;let o="";return(null==(e=n.item)?void 0:e.groupID)&&(o=i[null==(t=n.item)?void 0:t.type]),o})),c=e.computed((()=>{var e,t,o,a;return(null==(e=n.item)?void 0:e.type)===(null==(t=null==Cr?void 0:Cr.TYPES)?void 0:t.SNS_APPLICATION_SENT_BY_ME)?{style:"text",label:"等待验证"}:(null==(o=n.item)?void 0:o.type)===(null==(a=null==Cr?void 0:Cr.TYPES)?void 0:a.SNS_APPLICATION_SENT_TO_ME)&&{style:"button",label:"同意",onClick:()=>{var e;vp(null==(e=n.item)?void 0:e.userID)}}}));return e.watch((()=>null==o?void 0:o.value),(()=>{var e,t,i;a.value=!!(n.displayOnlineStatus&&(null==o?void 0:o.value)&&(null==(e=n.item)?void 0:e.userID)&&(null==(i=null==(t=o.value)?void 0:t[n.item.userID])?void 0:i.statusType)===Cr.TYPES.USER_STATUS_ONLINE)}),{immediate:!0,deep:!0}),(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["tui-contact-list-card",!e.unref(iu)&&"tui-contact-list-card-h5"])},[e.createElementVNode("div",{class:"tui-contact-list-card-left"},[e.createVNode(Pd,{class:"tui-contact-list-card-left-avatar",useSkeletonAnimation:"",url:e.unref(pp)(n.item)},null,8,["url"]),n.displayOnlineStatus&&n.item?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"online-status":!0,"online-status-online":a.value,"online-status-offline":!a.value})},null,2)):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:"tui-contact-list-card-main"},[e.createElementVNode("div",{class:"tui-contact-list-card-main-name"},e.toDisplayString(e.unref(hp)(n.item)),1),s.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-contact-list-card-main-other"},e.toDisplayString(s.value),1)):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:"tui-contact-list-card-right"},[r.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-contact-list-card-right-group-type"},e.toDisplayString(r.value),1)):e.createCommentVNode("",!0),c.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:"tui-contact-list-card-right-application"},["text"===c.value.style?(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-contact-list-card-right-application-text"},e.toDisplayString(e.unref(Tr).t(`TUIContact.${c.value.label}`)),1)):"button"===c.value.style?(e.openBlock(),e.createElementBlock("button",{key:1,class:"tui-contact-list-card-right-application-button",onClick:o[0]||(o[0]=e.withModifiers(((...e)=>c.value.onClick&&c.value.onClick(...e)),["stop"]))},e.toDisplayString(e.unref(Tr).t(`TUIContact.${c.value.label}`)),1)):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)])],2))}}),[["__scopeId","data-v-c32ee769"]]);function Ip(e,t=new WeakMap){if("object"!=typeof e||null==e)return e;if(t.has(e))return t.get(e);const n=Object.create(Object.getPrototypeOf(e));return Object.keys(e).forEach((o=>{const a=e[o];"object"!=typeof a||null===a?n[o]=a:Array.isArray(a)?n[o]=[...a]:a instanceof Set?n[o]=new Set([...a]):a instanceof Map?n[o]=new Map([...a]):(t.set(e,e),n[o]=Ip(a,t))})),n}const Ep=e=>{var t;return e.type===Cr.TYPES.MSG_CUSTOM&&"group_create"===(null==(t=null==e?void 0:e.getMessageContent())?void 0:t.businessID)};function Cp(){return kr.getData(oi.USER,"displayMessageReadReceipt")&&kr.getData(oi.APP,"enabledMessageReadReceipt")}function kp(e){return Object.assign({},e)}function Tp(e){const t=(new Date).setHours(0,0,0,0),n=new Date((new Date).getFullYear(),0,1,0,0,0,0).getTime(),o=new Date(e),a=864e5,i=t-o.getTime();function s(e){return e<10?"0"+e:e.toString()}if(i<=0)return`${s(o.getHours())}:${s(o.getMinutes())}`;if(i<=a)return`${Tr.t("time.昨天")} ${s(o.getHours())}:${s(o.getMinutes())}`;if(i<=5184e5){const e=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][o.getDay()];return`${Tr.t("time."+e)} ${s(o.getHours())}:${s(o.getMinutes())}`}return o.getTime()>=n?`${o.getMonth()+1}/${o.getDate()} ${s(o.getHours())}:${s(o.getMinutes())}`:`${o.getFullYear()}/${o.getMonth()+1}/${o.getDate()} ${s(o.getHours())}:${s(o.getMinutes())}`}const Mp=L(e.defineComponent({__name:"index",setup(t){const n=e.ref(""),o=e.ref({}),a=e.ref({friendApplicationList:{key:"friendApplicationList",title:"新的联系人",list:[],unreadCount:0},blackList:{key:"blackList",title:"黑名单",list:[]},groupList:{key:"groupList",title:"我的群聊",list:[]},friendList:{key:"friendList",title:"我的好友",list:[]}}),i=e.ref(!1),s=e.ref(),r=e.ref(!1),c=e.ref(),l=e.computed((()=>{var e,t,n,o;return!(null==(t=null==(e=null==s?void 0:s.value)?void 0:e.user)?void 0:t.list[0])&&!(null==(o=null==(n=null==s?void 0:s.value)?void 0:n.group)?void 0:o.list[0])}));function u(e){var t,n,s,r,c,l,u,d;if(o.value=e,i.value){let e;(null==(t=o.value)?void 0:t.userID)?e=null==(r=null==(s=null==(n=a.value)?void 0:n.friendList)?void 0:s.list)?void 0:r.find((e=>{var t;return(null==e?void 0:e.userID)===(null==(t=o.value)?void 0:t.userID)})):(null==(c=o.value)?void 0:c.groupID)&&(e=null==(d=null==(u=null==(l=a.value)?void 0:l.groupList)?void 0:u.list)?void 0:d.find((e=>{var t;return(null==e?void 0:e.groupID)===(null==(t=o.value)?void 0:t.groupID)}))),e&&(o.value=e)}kr.update(oi.CUSTOM,"currentContactInfo",o.value)}function d(e){r.value=e}function p(e){(null==e?void 0:e.size)>0&&(c.value=Object.fromEntries(null==e?void 0:e.entries()))}function h(e){if(!e)return;const t=Ar.TUIContact.EXTENSION.CONTACT_LIST.EXT_ID,n=Wr.getExtensionList(t).find((e=>{const{name:t,accountList:n=[]}=e.data||{};return"customer"===t&&n.length>0}));if(n){const{data:e,text:t}=n,{accountList:o}=e||{};Sr.getUserProfile({userIDList:o}).then((e=>{if(e.data.length>0){const n={title:t,list:e.data.map(((e,t)=>({...e,renderKey:I("customerList",e,t),infoKeyList:[],btnKeyList:["enterC2CConversation"]}))),key:"customerList"};a.value={...a.value,customerList:n}}})).catch((()=>{}))}}function g(e){y("groupList",e)}function m(e){y("blackList",e)}function f(e){a.value.friendApplicationList.unreadCount=e}function v(e){y("friendList",e)}function _(e){y("friendApplicationList",e)}function y(e,t){a.value[e].list=t,a.value[e].list.map(((t,n)=>t.renderKey=I(e,t,n))),function(e,t){var a,s;if(!(null==(a=o.value)?void 0:a.userID)&&!(null==(s=o.value)?void 0:s.groupID))return;(t===n.value||i.value)&&(o.value=(null==e?void 0:e.find((e=>{var t,n;return(null==e?void 0:e.groupID)&&(null==e?void 0:e.groupID)===(null==(t=o.value)?void 0:t.groupID)||(null==e?void 0:e.userID)&&(null==e?void 0:e.userID)===(null==(n=o.value)?void 0:n.userID)})))||{},kr.update(oi.CUSTOM,"currentContactInfo",o.value))}(a.value[e].list,e)}function I(e,t,n){return`${e}-${t.userID||t.groupID||"index"+n}`}function E(e){s.value=e}function C(e){i.value=e,kr.update(oi.CUSTOM,"currentContactInfo",{}),kr.update(oi.CUSTOM,"currentContactListKey","")}function k(e){o.value=e}function T(e){n.value=e}return e.onMounted((()=>{kr.watch(oi.APP,{enabledCustomerServicePlugin:h}),kr.watch(oi.GRP,{groupList:g}),kr.watch(oi.USER,{userBlacklist:m,displayOnlineStatus:d,userStatusList:p}),kr.watch(oi.FRIEND,{friendList:v,friendApplicationList:_,friendApplicationUnreadCount:f}),kr.watch(oi.CUSTOM,{currentContactSearchingStatus:C,currentContactSearchResult:E,currentContactListKey:T,currentContactInfo:k})})),e.onUnmounted((()=>{kr.unwatch(oi.APP,{enabledCustomerServicePlugin:h}),kr.unwatch(oi.GRP,{groupList:g}),kr.unwatch(oi.USER,{userBlacklist:m,displayOnlineStatus:d,userStatusList:p}),kr.unwatch(oi.FRIEND,{friendList:v,friendApplicationList:_,friendApplicationUnreadCount:f}),kr.unwatch(oi.CUSTOM,{currentContactSearchingStatus:C,currentContactSearchResult:E,currentContactListKey:T,currentContactInfo:k})})),e.provide("userOnlineStatusMap",c),(t,c)=>i.value?(e.openBlock(),e.createElementBlock("ul",{key:1,class:"tui-contact-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"tui-contact-list-item"},[t.list[0]?(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-contact-search-list"},[e.createElementVNode("div",{class:"tui-contact-search-list-title"},e.toDisplayString(e.unref(Tr).t(`TUIContact.${t.label}`)),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.list,((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n,class:e.normalizeClass(["tui-contact-search-list-item",["selected"]]),onClick:e=>u(t)},[e.createVNode(yp,{item:t,displayOnlineStatus:!1},null,8,["item"])],8,["onClick"])))),128))])):e.createCommentVNode("",!0)])))),128)),l.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-contact-search-list-default"},e.toDisplayString(e.unref(Tr).t("TUIContact.无搜索结果")),1)):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("ul",{key:0,class:e.normalizeClass(["tui-contact-list",!e.unref(iu)&&"tui-contact-list-h5"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,((t,a)=>(e.openBlock(),e.createElementBlock("li",{key:a,class:"tui-contact-list-item"},[e.createElementVNode("header",{class:"tui-contact-list-item-header",onClick:e=>function(e){n.value===e?(n.value="",o.value={},kr.update(oi.CUSTOM,"currentContactListKey",""),kr.update(oi.CUSTOM,"currentContactInfo",{})):(n.value=e,kr.update(oi.CUSTOM,"currentContactListKey",e),"friendApplicationList"===e&&wr.setFriendApplicationRead())}(a)},[e.createElementVNode("div",{class:"tui-contact-list-item-header-left"},[e.createVNode(pu,{file:n.value===a?e.unref(Gu):e.unref(wd),width:"16px",height:"16px"},null,8,["file"]),e.createElementVNode("div",null,e.toDisplayString(e.unref(Tr).t(`TUIContact.${t.title}`)),1)]),e.createElementVNode("div",{class:"tui-contact-list-item-header-right"},[t.unreadCount?(e.openBlock(),e.createElementBlock("span",{key:0,class:"tui-contact-list-item-header-right-unread"},e.toDisplayString(t.unreadCount),1)):e.createCommentVNode("",!0)])],8,["onClick"]),e.createElementVNode("ul",{class:e.normalizeClass(["tui-contact-list-item-main",n.value===a?"":"hidden"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.list,(t=>(e.openBlock(),e.createElementBlock("li",{key:t.renderKey,class:e.normalizeClass(["tui-contact-list-item-main-item",["selected"]]),onClick:e=>u(t)},[(e.openBlock(),e.createBlock(yp,{key:t.renderKey,item:e.unref(Ip)(t),displayOnlineStatus:r.value&&"friendList"===a},null,8,["item","displayOnlineStatus"]))],8,["onClick"])))),128))],2)])))),128))],2))}}),[["__scopeId","data-v-d09cf2e0"]]),Sp={setRemark:{key:"setRemark",label:"备注名",data:"",labelPosition:$u.LEFT,editable:!0,editType:Yu.INPUT,editing:!1,editSubmitHandler:e=>{var t,n,o,a,i,s;if(null==e?void 0:e.isBothFriend){const s=null==(t=null==e?void 0:e.item)?void 0:t.data;((e,t)=>{var n;(null==(n=null==t?void 0:t.replace(/[^\u0000-\u00ff]/g,"aa"))?void 0:n.length)>96?yd({message:Tr.t("TUIContact.修改备注失败: 备注长度不得超过 96 字节"),type:vd}):wr.updateFriend({userID:e,remark:t}).then((()=>{yd({message:Tr.t("TUIContact.修改备注成功"),type:md})})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:138","update friend remark failed:",e),yd({message:Tr.t("TUIContact.修改备注失败"),type:vd})}))})(null==(n=null==e?void 0:e.contactInfoData)?void 0:n.userID,s),(null==(o=null==e?void 0:e.item)?void 0:o.editing)&&(e.item.editing=!1),(null==(a=null==e?void 0:e.item)?void 0:a.data)&&(e.item.data=null==(i=null==e?void 0:e.contactInfoData)?void 0:i.remark)}else(null==(s=null==e?void 0:e.item)?void 0:s.editing)&&(e.item.editing=!1)}},blackList:{key:"blackList",label:"加入黑名单",data:!1,labelPosition:$u.LEFT,editable:!0,editType:Yu.SWITCH,editing:!0,editSubmitHandler:e=>{var t,n,o,a;(null==e?void 0:e.isInBlackList)?(o=null==(t=null==e?void 0:e.contactInfoData)?void 0:t.userID,Sr.removeFromBlacklist({userIDList:[o]}).then((()=>{a&&a()})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:353","remove from blacklist failed:",e),yd({message:Tr.t("TUIContact.移除黑名单失败"),type:vd})}))):(((e,t)=>{Sr.addToBlacklist({userIDList:[e]}).then((()=>{t&&t()})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:333","add to blacklist failed:",e),yd({message:Tr.t("TUIContact.加入黑名单失败"),type:vd})}))})(null==(n=null==e?void 0:e.contactInfoData)?void 0:n.userID),kr.update(oi.CUSTOM,"currentContactListKey","blackList"))}},setWords:{key:"setWords",label:"请填写验证信息",data:"",labelPosition:$u.TOP,editable:!0,editType:Yu.TEXTAREA,editing:!0},displayWords:{key:"displayWords",label:"验证信息",data:"",labelPosition:$u.LEFT,editable:!1}},Dp={dismissGroup:{key:"dismissGroup",label:"解散群聊",type:Wu.CANCEL,onClick:e=>{var t,n;n=null==(t=null==e?void 0:e.contactInfoData)?void 0:t.groupID,br.dismissGroup(n).then((()=>{yd({message:Tr.t("TUIContact.解散群聊成功"),type:md}),(null==Fl?void 0:Fl.updateContactSearch)&&(null==Fl||Fl.updateContactSearch())})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:259","dismiss group failed:",e),yd({message:Tr.t("TUIContact.解散群聊失败"),type:vd})}))}},quitGroup:{key:"quitGroup",label:"退出群聊",type:Wu.CANCEL,onClick:e=>{var t,n;n=null==(t=null==e?void 0:e.contactInfoData)?void 0:t.groupID,br.quitGroup(n).then((()=>{yd({message:Tr.t("TUIContact.退出群组成功"),type:md})})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:277","quit group failed:",e),yd({message:Tr.t("TUIContact.退出群组失败"),type:vd})}))}},joinGroup:{key:"joinGroup",label:"发送申请",type:Wu.SUBMIT,onClick:e=>{var t,n;_p(null==(t=null==e?void 0:e.contactInfoData)?void 0:t.groupID,null==(n=null==e?void 0:e.contactInfoMoreList[0])?void 0:n.data)}},joinAVChatGroup:{key:"joinAVChatGroup",label:"加入直播群",type:Wu.SUBMIT,onClick:e=>{var t;_p(null==(t=null==e?void 0:e.contactInfoData)?void 0:t.groupID)}},enterGroupConversation:{key:"enterGroupConversation",label:"进入群聊",type:Wu.SUBMIT,onClick:e=>{fp(null==e?void 0:e.contactInfoData)}},addFriend:{key:"addFriend",label:"发送申请",type:Wu.SUBMIT,onClick:e=>{var t,n,o,a;a={to:null==(t=null==e?void 0:e.contactInfoData)?void 0:t.userID,source:"AddSource_Type_Web",remark:null==(n=null==e?void 0:e.contactInfoMoreList[1])?void 0:n.data,wording:null==(o=null==e?void 0:e.contactInfoMoreList[0])?void 0:o.data},wr.addFriend(a).then((()=>{yd({message:Tr.t("TUIContact.申请已发送"),type:md})})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:185","delete friend failed:",e),yd({message:Tr.t("TUIContact.申请发送失败"),type:vd})}))}},deleteFriend:{key:"deleteFriend",label:"删除好友",type:Wu.CANCEL,onClick:e=>{var t,n;n=null==(t=null==e?void 0:e.contactInfoData)?void 0:t.userID,wr.deleteFriend({userIDList:[n],type:Cr.TYPES.SNS_DELETE_TYPE_BOTH}).then((e=>{const{successUserIDList:t}=e.data;t[0].userID===n?yd({message:Tr.t("TUIContact.删除好友成功"),type:md}):yd({message:Tr.t("TUIContact.删除好友失败"),type:vd})})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:167","delete friend failed:",e),yd({message:Tr.t("TUIContact.删除好友失败"),type:vd})}))}},enterC2CConversation:{key:"enterC2CConversation",label:"发送消息",type:Wu.SUBMIT,onClick:e=>{fp(null==e?void 0:e.contactInfoData)}},acceptFriendApplication:{key:"acceptFriendApplication",label:"同意",type:Wu.SUBMIT,onClick:e=>{var t;vp(null==(t=null==e?void 0:e.contactInfoData)?void 0:t.userID),kr.update(oi.CUSTOM,"currentContactListKey","friendList")}},refuseFriendApplication:{key:"refuseFriendApplication",label:"拒绝",type:Wu.CANCEL,onClick:e=>{var t,n;n=null==(t=null==e?void 0:e.contactInfoData)?void 0:t.userID,wr.refuseFriendApplication(n).then((()=>{yd({message:Tr.t("TUIContact.拒绝成功"),type:md})})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:240","accept friend application failed:",e),yd({message:Tr.t("TUIContact.拒绝好友申请失败"),type:vd})}))}}},bp="/assets/edit.4601124c.svg",wp=L(e.defineComponent({__name:"index",props:{value:{type:Boolean,default:!1}},setup:t=>(n,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["tui-switch",t.value?"tui-switch-checked":"tui-switch-no-checked"])},null,2))}),[["__scopeId","data-v-c4dd154a"]]),Np=L(e.defineComponent({__name:"index",emits:["switchConversation"],setup(t,{emit:n}){const o=n,a=e.ref({}),i=e.ref([]),s=e.ref([]),r=e.ref([]),c=e.computed((()=>{var e;return!!(null==(e=a.value)?void 0:e.groupID)})),l=e.computed((()=>mp(null==a?void 0:a.value))),u=e.ref(!1),d=e.computed((()=>{var e,t;return!!(null==(t=null==(e=a.value)?void 0:e.selfInfo)?void 0:t.userID)})),p=e.computed((()=>{var e;return!c.value&&(null==(e=h.value)?void 0:e.findIndex((e=>{var t;return(null==e?void 0:e.userID)===(null==(t=a.value)?void 0:t.userID)})))>=0})),h=e.ref([]);e.onMounted((()=>{kr.watch(oi.CUSTOM,{currentContactInfo:v}),kr.watch(oi.USER,{userBlacklist:f})})),e.onUnmounted((()=>{kr.unwatch(oi.CUSTOM,{currentContactInfo:v}),kr.unwatch(oi.USER,{userBlacklist:f})}));const g=()=>{kr.update(oi.CUSTOM,"currentContactInfo",{}),kr.update(oi.CUSTOM,"currentContactSearchingStatus",!1),(null==Fl?void 0:Fl.closeSearching)&&(null==Fl||Fl.closeSearching())},m=e=>{e.editSubmitHandler&&e.editSubmitHandler({item:e,contactInfoData:a.value,isBothFriend:u.value,isInBlackList:p.value})};function f(e){h.value=e}async function v(e){var t,n;a.value&&e&&JSON.stringify(a.value)===JSON.stringify(e)||(a.value={},i.value=[],s.value=[],r.value=[],a.value=Ip(e)||{},a.value&&0!==(null==(t=Object.keys(a.value))?void 0:t.length)&&(i.value=(e=>{var t;const n=[{label:(null==e?void 0:e.groupID)?"群ID":"ID",data:(null==e?void 0:e.groupID)||(null==e?void 0:e.userID)||""}];return mp(e)||n.push({label:(null==e?void 0:e.groupID)?"群类型":"个性签名",data:(null==e?void 0:e.type)||(null==(t=null==e?void 0:e.profile)?void 0:t.selfSignature)||""}),n})(a.value),u.value=await(n=a.value,new Promise(((e,t)=>{!(null==n?void 0:n.groupID)&&(null==n?void 0:n.userID)?(null==n?void 0:n.addTime)?e(!0):wr.checkFriend({userIDList:[null==n?void 0:n.userID],type:Cr.TYPES.SNS_CHECK_TYPE_BOTH}).then((t=>{var n,o;switch(null==(o=null==(n=null==t?void 0:t.data)?void 0:n.successUserIDList[0])?void 0:o.relation){case Cr.TYPES.SNS_TYPE_NO_RELATION:case Cr.TYPES.SNS_TYPE_A_WITH_B:case Cr.TYPES.SNS_TYPE_B_WITH_A:e(!1);break;case Cr.TYPES.SNS_TYPE_BOTH_WAY:e(!0);break;default:e(!1)}})).catch((e=>{I("warn","at TUIKit/components/TUIContact/utils/index.ts:111","checkFriend error",e),t(e)})):e(!1)}))),(async()=>{var e,t,n,o;l.value?(Sp.displayWords.data=(null==(o=a.value)?void 0:o.wording)||"",s.value.push(Sp.displayWords)):((!c.value&&!u.value&&!p.value||c.value&&!d.value&&(null==(e=a.value)?void 0:e.type)!==(null==(t=null==Cr?void 0:Cr.TYPES)?void 0:t.GRP_AVCHATROOM))&&(Sp.setWords.data="",s.value.push(Sp.setWords)),c.value||p.value||(Sp.setRemark.data=(null==(n=a.value)?void 0:n.remark)||"",Sp.setRemark.editing=!1,s.value.push(Sp.setRemark)),c.value||!u.value&&!p.value||(Sp.blackList.data=p.value||!1,s.value.push(Sp.blackList)))})(),(()=>{var e,t,n,o,i,s,h,g,m,f,v,_,y,I,E;p.value||(l.value?(null==(e=a.value)?void 0:e.type)===(null==(t=null==Cr?void 0:Cr.TYPES)?void 0:t.SNS_APPLICATION_SENT_TO_ME)&&(null==(n=null==r?void 0:r.value)||n.push(Dp.refuseFriendApplication),null==(o=null==r?void 0:r.value)||o.push(Dp.acceptFriendApplication)):c.value&&d.value?("Owner"===(null==(s=null==(i=a.value)?void 0:i.selfInfo)?void 0:s.role)?null==(h=null==r?void 0:r.value)||h.push(Dp.dismissGroup):null==(g=null==r?void 0:r.value)||g.push(Dp.quitGroup),null==(m=null==r?void 0:r.value)||m.push(Dp.enterGroupConversation)):!c.value&&u.value?(null==(f=null==r?void 0:r.value)||f.push(Dp.deleteFriend),null==(v=null==r?void 0:r.value)||v.push(Dp.enterC2CConversation)):c.value?null==(I=null==r?void 0:r.value)||I.push((null==(_=a.value)?void 0:_.type)===(null==(y=null==Cr?void 0:Cr.TYPES)?void 0:y.GRP_AVCHATROOM)?Dp.joinAVChatGroup:Dp.joinGroup):null==(E=null==r?void 0:r.value)||E.push(Dp.addFriend))})(),e.infoKeyList&&(s.value=e.infoKeyList.map((e=>Sp[e]))),e.btnKeyList&&(r.value=e.btnKeyList.map((e=>Dp[e])))))}return(t,n)=>"object"==typeof a.value&&Object.keys(a.value).length?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-contact-info",!e.unref(iu)&&"tui-contact-info-h5"])},[e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-contact-info-header",!e.unref(iu)&&"tui-contact-info-h5-header"])},[e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-info-header-icon",!e.unref(iu)&&"tui-contact-info-h5-header-icon"]),onClick:g},[e.createVNode(pu,{file:e.unref(tp)},null,8,["file"])],2),e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-info-header-title",!e.unref(iu)&&"tui-contact-info-h5-header-title"])},e.toDisplayString(e.unref(Tr).t("TUIContact.添加好友/群聊")),3)],2)),e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-info-basic",!e.unref(iu)&&"tui-contact-info-h5-basic"])},[e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-info-basic-text",!e.unref(iu)&&"tui-contact-info-h5-basic-text"])},[e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-info-basic-text-name",!e.unref(iu)&&"tui-contact-info-h5-basic-text-name"])},e.toDisplayString(e.unref(gp)(a.value)),3),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(t=>(e.openBlock(),e.createElementBlock("div",{key:t.label,class:e.normalizeClass(["tui-contact-info-basic-text-other",!e.unref(iu)&&"tui-contact-info-h5-basic-text-other"])},e.toDisplayString(`${e.unref(Tr).t(`TUIContact.${t.label}`)}:\n          ${t.data}`),3)))),128))],2),e.createElementVNode("img",{class:e.normalizeClass(["tui-contact-info-basic-avatar",!e.unref(iu)&&"tui-contact-info-h5-basic-avatar"]),src:e.unref(pp)(a.value)},null,10,["src"])],2),s.value[0]?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["tui-contact-info-more",!e.unref(iu)&&"tui-contact-info-h5-more"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(t=>(e.openBlock(),e.createElementBlock("div",{key:t.key,class:e.normalizeClass(["tui-contact-info-more-item",!e.unref(iu)&&"tui-contact-info-h5-more-item",t.labelPosition===e.unref($u).TOP?"tui-contact-info-more-item-top":"tui-contact-info-more-item-left"])},[e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-info-more-item-label",!e.unref(iu)&&"tui-contact-info-h5-more-item-label"])},e.toDisplayString(`${e.unref(Tr).t(`TUIContact.${t.label}`)}`),3),e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-info-more-item-content",!e.unref(iu)&&"tui-contact-info-h5-more-item-content"])},[t.editing?t.editType===e.unref(Yu).INPUT?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:1,"onUpdate:modelValue":e=>t.data=e,class:e.normalizeClass(["tui-contact-info-more-item-content-input",!e.unref(iu)&&"tui-contact-info-h5-more-item-content-input"]),type:"text",onConfirm:e=>m(t),onKeyup:e.withKeys((e=>m(t)),["enter"])},null,42,["onUpdate:modelValue","onConfirm","onKeyup"])),[[e.vModelText,t.data]]):t.editType===e.unref(Yu).TEXTAREA?e.withDirectives((e.openBlock(),e.createElementBlock("textarea",{key:2,"onUpdate:modelValue":e=>t.data=e,class:e.normalizeClass(["tui-contact-info-more-item-content-textarea",!e.unref(iu)&&"tui-contact-info-h5-more-item-content-textarea"]),"confirm-type":"done"},null,10,["onUpdate:modelValue"])),[[e.vModelText,t.data]]):t.editType===e.unref(Yu).SWITCH?(e.openBlock(),e.createElementBlock("div",{key:3,onClick:e=>m(t)},[e.createVNode(wp,{value:t.data},null,8,["value"])],8,["onClick"])):e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-contact-info-more-item-content-text",!e.unref(iu)&&"tui-contact-info-h5-more-item-content-text"])},[e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-info-more-item-content-text-data",!e.unref(iu)&&"tui-contact-info-h5-more-item-content-text-data"])},e.toDisplayString(t.data),3),t.editable?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-contact-info-more-item-content-text-icon",!e.unref(iu)&&"tui-contact-info-h5-more-item-content-text-icon"]),onClick:e=>(e=>{e.editing=!0})(t)},[e.createVNode(pu,{file:e.unref(bp),width:"14px",height:"14px"},null,8,["file"])],10,["onClick"])):e.createCommentVNode("",!0)],2))],2)],2)))),128))],2)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-info-button",!e.unref(iu)&&"tui-contact-info-h5-button"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(t=>(e.openBlock(),e.createElementBlock("button",{key:t.key,class:e.normalizeClass(["tui-contact-info-button-item",!e.unref(iu)&&"tui-contact-info-h5-button-item",t.type===e.unref(Wu).CANCEL?"tui-contact-info-button-item-cancel":"tui-contact-info-button-item-submit"]),onClick:e=>(e=>{e.onClick&&e.onClick({contactInfoData:a.value,contactInfoMoreList:s.value}),"enterGroupConversation"!==e.key&&"enterC2CConversation"!==e.key||(o("switchConversation",a.value),g())})(t)},e.toDisplayString(e.unref(Tr).t(`TUIContact.${t.label}`)),11,["onClick"])))),128))],2)],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-8d0d0ad5"]]),Lp=L(e.defineComponent({__name:"index",props:{displayType:{type:String,default:"contactList",require:!1}},emits:["switchConversation"],setup(t,{emit:n}){const o=n,a=t,i=e.ref(a.displayType||"contactList"),s=e.ref(!1),r=e.ref(!0),c=e.ref(!0);e.ref(1),e.ref([{label:"消息",icon:"/static/message.png"},{label:"通讯录",icon:"/static/profile-selected.png"}]),e.watchEffect((()=>{r.value="selectFriend"!==(null==a?void 0:a.displayType)})),kr.watch(oi.CUSTOM,{isShowSelectFriendComponent:e=>{var t;if(!lu&&"selectFriend"===(null==a?void 0:a.displayType))return s.value=e,void(r.value=!1);e?(s.value=!0,lu&&(i.value="selectFriend",null==Fl||Fl.hideTabBar())):(s.value=!1,lu&&(i.value=a.displayType,null==(t=null==Fl?void 0:Fl.showTabBar())||t.catch((()=>{}))))},currentContactInfo:e=>{var t;c.value=iu||e&&"object"==typeof e&&(null==(t=Object.keys(e))?void 0:t.length)>0}});const l=e=>{lu&&(null==Fl||Fl.navigateTo({url:"/TUIKit/components/TUIChat/index"})),o("switchConversation",e)};return(t,n)=>(e.openBlock(),e.createElementBlock("view",null,[s.value?(e.openBlock(),e.createBlock(sp,{key:0})):r.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["tui-contact",!e.unref(iu)&&"tui-contact-h5"])},[e.createElementVNode("div",{class:e.normalizeClass(["tui-contact-left",!e.unref(iu)&&"tui-contact-h5-left"])},[e.createVNode(dp),e.createVNode(Mp,{class:e.normalizeClass(["tui-contact-left-list",!e.unref(iu)&&"tui-contact-h5-left-list"])},null,8,["class"])],2),c.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-contact-right",!e.unref(iu)&&"tui-contact-h5-right"])},[e.createVNode(Np,{onSwitchConversation:l})],2)):e.createCommentVNode("",!0)],2)):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-56348ccb"]]);const Rp=L({components:{TUIContact:Lp},data:()=>({statusBarHeight:"",btnyes:!0,input_text:"",friends_List:[{name:"王老师",id:"000000",head:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/19217f29299e465481d28ae91dbf317b_mergeImage.png"},{name:"王老师",id:"000000",head:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/19217f29299e465481d28ae91dbf317b_mergeImage.png"}]}),onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{input_search(e){I("log","at pages/pagesall/home/search.vue:71",e.detail.value),this.input_text=e.detail.value,""==this.input_text?this.btnyes=!0:""!=this.input_text&&(this.btnyes=!1)},add_friend(){uni.navigateTo({url:"/pages/pagesall/home/add_friend"})},cancel_lation(){uni.navigateBack()}}},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("TUIContact");return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createVNode(r)])}]]);const Ap=L({},[["render",function(e,t){return" 我是扫一扫 "}]]);const Op=L({data:()=>({statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{goback(){uni.navigateBack()},mycode(){uni.navigateTo({url:"/pages/pagesall/home/mycode"})}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"codepage"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"code_titlebox"},[e.createElementVNode("view",{class:"messImg",onClick:n[0]||(n[0]=(...e)=>s.goback&&s.goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPnge1553c1d8d43568ee582b54f1deab731573c8804790b09e299c2e73eda1cfa68",alt:""})]),e.createElementVNode("view",{class:"code_title"}," 分享二维码 ")]),e.createElementVNode("view",{class:"code_codebox"},[e.createElementVNode("view",{class:"code_img"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngcd993bafb56f0fa9ca43f6a3a3f5885980722e955fcc6ed400fa9b64a364b72e",alt:""})]),e.createElementVNode("view",{class:"code_titileimg"},[e.createElementVNode("img",{src:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/a1f75ab65caa4ac6afc5909f8472ecba_mergeImage.png",alt:""}),e.createElementVNode("view",{class:"code_name"},[e.createElementVNode("view",{style:{"font-weight":"500","font-size":"28rpx",color:"#000000"}},"刘易阳的二维码"),e.createElementVNode("view",{style:{"font-weight":"400","font-size":"16rpx",color:"#666666","margin-top":"10rpx"}},"分享给老师们加个好友吧 ")])]),e.createElementVNode("view",{class:"code_codeimg"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngdec58e091c33964c716ceeb24df93a33629b032a848ee6ada66281e68aeaa069",alt:""})])]),e.createElementVNode("view",{class:"code_baocun"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPnga09d8270200e68c37da10c6fc926c63f90e314b103034a125a42216d2610bbbf",alt:""}),e.createElementVNode("text",null,"保存到手机")])])}]]);const Up=L({data:()=>({messList:[],statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top,this.loadNoticeList()},methods:{goback(){uni.navigateBack()},async adverbtn(e,t){I("log","at pages/pagesall/home/adverMess.vue:57",e,t);const n=this.messList[t];I("log","at pages/pagesall/home/adverMess.vue:59",n.id),uni.navigateTo({url:`/pages/pagesall/home/adver_detail?id=${n.id}`})},mycode(){uni.navigateTo({url:"/pages/pagesall/home/mycode"})},async loadNoticeList(){try{const t=se(),n=await Y("/user/notice",e);this.messList=n.rows,t.setMessageList(this.messList)}catch(t){I("error","at pages/pagesall/home/adverMess.vue:76","获取公告消息失败:",t)}var e}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"codepage"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"code_titlebox"},[e.createElementVNode("view",{class:"messImg",onClick:n[0]||(n[0]=(...e)=>s.goback&&s.goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"code_title"}," 公告消息 ")]),i.messList.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(i.messList,((n,o)=>(e.openBlock(),e.createElementBlock("view",{class:"adverbox",key:o},[e.createElementVNode("view",{class:"adver_time"},[e.createElementVNode("view",{class:"adver_hour",style:{"text-align":"center","font-weight":"400","font-size":"20rpx",color:"#000000",margin:"28rpx 0 28rpx 0"}},[e.createElementVNode("text",null,e.toDisplayString(n.createtime),1)]),e.createElementVNode("view",{class:"adver_content"},[e.createElementVNode("view",{class:"adver_text1"},e.toDisplayString(n.title),1),e.createElementVNode("view",{class:"adver_text2"},e.toDisplayString(n.description),1),e.createElementVNode("view",{class:"line"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng754b004becd9b25a8ebdc9d2cb98f423d3fa6fdf022dd0a97d950d38fe548f62",alt:""})]),e.createElementVNode("view",{class:"adver_btn",onClick:e=>s.adverbtn(t.event,o)}," 查看详情 ",8,["onClick"])])])])))),128)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"100vh"}},[e.createElementVNode("image",{style:{"margin-top":"-600rpx"},src:il,mode:"aspectFit"})]))])}],["__scopeId","data-v-519695a0"]]);const Pp=L({data:()=>({messageList:[],selectedMessage:null,statusBarHeight:""}),onLoad(e){this.statusBarHeight=getApp().globalData.top;const t=se();this.messageList=t.messageList;const n=e.id;this.selectedMessage=this.messageList.find((e=>e.id.toString()===n.toString()))},methods:{goback(){uni.navigateBack()}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"code_page"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"code_titlebox"},[e.createElementVNode("view",{class:"messImg",onClick:n[0]||(n[0]=(...e)=>s.goback&&s.goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"code_title"},e.toDisplayString(i.selectedMessage.title),1)]),e.createElementVNode("view",{class:"detail_title"},[e.createElementVNode("text",{style:{"font-weight":"500","font-size":"32rpx",color:"#000000",width:"70%",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},e.toDisplayString(i.selectedMessage.description),1),e.createElementVNode("view",{class:"detail_time"},[e.createElementVNode("view",{class:"time_1"},e.toDisplayString(i.selectedMessage.createtime),1)])]),e.createElementVNode("div",{class:"detail_box",innerHTML:i.selectedMessage.content},null,8,["innerHTML"])])}]]);const Gp=L({data:()=>({friend_heard:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/26483a4d5dc54c63ae2af524e81ebb4d_mergeImage.png",friend_name:"张老师",friend_id:"1232222",statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{fri_goback(){uni.navigateBack()}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"friend_goback",onClick:n[0]||(n[0]=(...e)=>s.fri_goback&&s.fri_goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"friend_name"},[e.createElementVNode("img",{src:i.friend_heard,alt:""},null,8,["src"]),e.createElementVNode("view",{class:"fri_text1",style:{"margin-top":"8rpx"}},e.toDisplayString(i.friend_name),1),e.createElementVNode("view",{class:"fri_text2",style:{"margin-top":"8rpx"}}," ID:"+e.toDisplayString(i.friend_id),1)]),e.createElementVNode("view",{class:"test_verify"},[e.createElementVNode("view",{class:"verify_text"}," 验证信息: "),e.createElementVNode("view",{class:"verify_input"},[e.createElementVNode("input",{type:"text",placeholder:"书法一班刘易阳"})])]),e.createElementVNode("view",{class:"centerbox"},[e.createElementVNode("view",{class:"friend_btn"},[e.createElementVNode("text",{style:{"font-weight":"500","font-size":"28rpx",color:"#FFFFFF"}},"添加好友")])])])}]]),xp={components:{timeline:Dl,timelineItem:bl},data:()=>({statusBarHeight:"",images:["/static/img/swiper1.png","https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngdadd194d15ae0a321cf1b69b42b82fbdb401e127f68d9e091f73b2ef2c6682a6","/static/img/swiper1.png"],infolist:[{title:"坚持练习书法的一百个理由",content:"书法比赛将在2024年7月15号开始本次举办自河南、浙江、广东、山西、湖南...",titleimg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng73002970eb6951969634d1ac818f9fbd983ad92340d21cf601ab0d495647806c",timeImg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng9124bf95026b34308d6bd993d7c3774578aa0f9fdf293cc08d4cb043bc1ba5a8",ressImg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng5b0a65fd47f768b4c8f59ba6e2c415f9fe8dd593587d9ad6bbcd9f647066dc01",infotime:"2024-06-14",inforess:"湛江市-麻章区-东风路校区",infoNumber:"10万人已观看",infoImg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng580a34d876cda0a5b37d451367934eb478865bb7b4b80bedde3f71fcaa5c8775",jiantouimg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng6deab9d71966dbbdc8297bb42543232fd5ab80e8f1b6e7650f9a66310b4f656e"},{title:"坚持练习书法的五百个理由",content:"书法比赛将在2024年7月15号开始本次举办自河南、浙江、广东、山西、湖南...",titleimg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng73002970eb6951969634d1ac818f9fbd983ad92340d21cf601ab0d495647806c",timeImg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng9124bf95026b34308d6bd993d7c3774578aa0f9fdf293cc08d4cb043bc1ba5a8",ressImg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng5b0a65fd47f768b4c8f59ba6e2c415f9fe8dd593587d9ad6bbcd9f647066dc01",infotime:"2024-06-23",inforess:"湛江市-丰台区-城景路校区",infoNumber:"10万人已观看",infoImg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng580a34d876cda0a5b37d451367934eb478865bb7b4b80bedde3f71fcaa5c8775",jiantouimg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng6deab9d71966dbbdc8297bb42543232fd5ab80e8f1b6e7650f9a66310b4f656e"}],site_imgList:[{site_img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/52c3b49276f64677810162df6b253e1c_mergeImage.png",title:"书法家张子豪现场观看指导"},{site_img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/52c3b49276f64677810162df6b253e1c_mergeImage.png",title:"书法家张子豪现场观看指导"},{site_img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/52c3b49276f64677810162df6b253e1c_mergeImage.png",title:"书法家张子豪现场观看指导"}],scrollTop:0,old:{scrollTop:0},matchDetail:{match_date:{data:[]},match_news:[{}],match_scene:{}}}),onLoad(){this.statusBarHeight=getApp().globalData.top},computed:{selectedIndex:()=>se().selectedSwiperIndex},mounted(){this.getMatchDetail(this.selectedIndex)},methods:{async getMatchDetail(e){try{I("log","at pages/pagesall/home/game.vue:186","请求比赛详情，当前下标:",e);const t=await(e=>Y("/match/detail?match_id="+e))(e);this.matchDetail=t.items,this.matchDetail.match_news&&Array.isArray(this.matchDetail.match_news)&&this.matchDetail.match_news.forEach((e=>{e.titleimg="https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng73002970eb6951969634d1ac818f9fbd983ad92340d21cf601ab0d495647806c",e.timeImg="https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng9124bf95026b34308d6bd993d7c3774578aa0f9fdf293cc08d4cb043bc1ba5a8"})),I("log","at pages/pagesall/home/game.vue:195","获取到的比赛详情:",this.matchDetail)}catch(t){I("error","at pages/pagesall/home/game.vue:198","请求接口出错:",t),uni.showToast({title:"获取比赛详情失败",icon:"none",duration:2e3})}},goback(){uni.navigateBack()},scroll:function(e){I("log","at pages/pagesall/home/game.vue:211",e),this.old.scrollTop=e.detail.scrollTop}}};const Bp=L(xp,[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("timelineItem"),c=e.resolveComponent("timeline");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"code_titlebox"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"messImg",onClick:n[0]||(n[0]=(...e)=>s.goback&&s.goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"code_title"}," 赛事比赛 ")]),e.createElementVNode("view",{class:"swibox"},[e.createElementVNode("swiper",{class:"swiper-container","indicator-dots":"true",autoplay:"true",interval:"3000",circular:"true","indicator-color":"#ddd","indicator-active-color":"#333"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.images,((t,n)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:n},[e.createElementVNode("image",{src:t,class:"swiper-image"},null,8,["src"])])))),128))])]),e.createElementVNode("view",{class:"game_time"},[e.createElementVNode("text",{style:{"font-weight":"500","font-size":"36rpx",color:"#000000"}},"活动时间安排")]),e.createVNode(c,null,{default:e.withCtx((()=>[i.matchDetail.match_date.data[0]?(e.openBlock(),e.createBlock(r,{key:0,leftTime:i.matchDetail.match_date.data[0].title,color:" #84F257"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tips"},e.toDisplayString(i.matchDetail.match_date.data[0].s_date)+"——"+e.toDisplayString(i.matchDetail.match_date.data[0].e_date),1)])),_:1},8,["leftTime"])):e.createCommentVNode("",!0),i.matchDetail.match_date.data[1]?(e.openBlock(),e.createBlock(r,{key:1,leftTime:i.matchDetail.match_date.data[1].title,color:"#84F257"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tips"},e.toDisplayString(i.matchDetail.match_date.data[1].s_date)+"——"+e.toDisplayString(i.matchDetail.match_date.data[1].e_date),1)])),_:1},8,["leftTime"])):e.createCommentVNode("",!0),i.matchDetail.match_date.data[2]?(e.openBlock(),e.createBlock(r,{key:2,leftTime:i.matchDetail.match_date.data[2].title,leftlist1:i.matchDetail.match_date.data[2].title,leftlist2:i.matchDetail.match_date.data[2].title,color:"#F25757"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tips"},e.toDisplayString(i.matchDetail.match_date.data[2].s_date)+"——"+e.toDisplayString(i.matchDetail.match_date.data[2].e_date),1)])),_:1},8,["leftTime","leftlist1","leftlist2"])):e.createCommentVNode("",!0),i.matchDetail.match_date.data[3]?(e.openBlock(),e.createBlock(r,{key:3,leftTime:i.matchDetail.match_date.data[3].title,leftlist1:i.matchDetail.match_date.data[3].title,leftlist2:i.matchDetail.match_date.data[3].title,color:"#F25757"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tips"},e.toDisplayString(i.matchDetail.match_date.data[3].s_date)+"——"+e.toDisplayString(i.matchDetail.match_date.data[3].e_date),1)])),_:1},8,["leftTime","leftlist1","leftlist2"])):e.createCommentVNode("",!0),e.createVNode(r,{leftTime:"颁奖晚会",color:"#5791F2"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"tips"},"2024.08.01——2024.08.02")])),_:1})])),_:1}),e.createElementVNode("view",{class:"infobox"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.matchDetail.match_news,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"infolistbox",key:n},[e.createElementVNode("view",{class:"infostr"},[e.createElementVNode("view",{class:"huatibox"},[e.createElementVNode("img",{src:t.titleimg,alt:""},null,8,["src"]),e.createElementVNode("text",{style:{"font-size":"32rpx","font-weight":"500"}},e.toDisplayString(t.title),1)]),e.createElementVNode("view",{class:"paddbox"},[e.createElementVNode("view",{class:"titleText"},e.toDisplayString(t.description),1),e.createElementVNode("view",{class:"huatibox"},[e.createElementVNode("img",{src:t.timeImg,alt:""},null,8,["src"]),e.createElementVNode("text",{style:{"font-weight":"400","font-size":"24rpx",color:"#666666","font-style":"normal","margin-left":"10rpx"}},e.toDisplayString(t.addtime),1)])])]),e.createElementVNode("view",{class:"infoImg"},[e.createElementVNode("view",{class:"proImg"},[e.createElementVNode("img",{src:t.infoImg,alt:""},null,8,["src"])])])])))),128))]),e.createElementVNode("view",{class:"event_site"},[e.createElementVNode("view",{class:"site_title"}," 活动现场 "),e.createElementVNode("view",null,[e.createElementVNode("scroll-view",{class:"scroll-view_H","scroll-x":"true",onScroll:n[1]||(n[1]=(...e)=>s.scroll&&s.scroll(...e)),"scroll-left":"120","show-scrollbar":"true"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.matchDetail.match_scene,((t,n)=>(e.openBlock(),e.createElementBlock("view",{id:"demo1",class:"scroll-view-item_H uni-bg-red",key:n},[e.createElementVNode("img",{src:t.thumb,alt:""},null,8,["src"]),e.createElementVNode("view",{class:"img_text"},e.toDisplayString(t.title),1)])))),128))],32)])])],64)}]]),Vp={data:()=>({statusBarHeight:"",messages_stu:[{username:"刘易阳",type:"text",status:"l",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/cf805a0bbe4b4f17abb1c215c9ec2df7_mergeImage.png",text:"刘易阳你今天表现不错哦1111111111111111111111111111111111111111111111",time:1683791638972},{username:"刘易阳",type:"text",status:"l",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/cf805a0bbe4b4f17abb1c215c9ec2df7_mergeImage.png",text:"刘易阳你今天表现不错哦1111111111111111111111111111111111111111111111",time:1683793245623},{username:"刘易阳",type:"text",status:"l",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/cf805a0bbe4b4f17abb1c215c9ec2df7_mergeImage.png",text:"刘易阳你今天表现不错哦1111111111111111111111111111111111111111111111",time:1683793245623},{username:"刘易阳",type:"text",status:"l",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/cf805a0bbe4b4f17abb1c215c9ec2df7_mergeImage.png",text:"刘易阳你今天表现不错哦",time:1683793245623},{username:"刘易阳",type:"img",status:"r",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/7872400aa4644186b920b0121d6a5136_mergeImage.png",text:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng580a34d876cda0a5b37d451367934eb478865bb7b4b80bedde3f71fcaa5c8775",time:1683793245623},{username:"刘易阳",type:"text",status:"l",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/cf805a0bbe4b4f17abb1c215c9ec2df7_mergeImage.png",text:"刘易阳你今天表现不错哦1111111111111111111111111111111111111111111111",time:1683793245623},{username:"刘易阳",type:"text",status:"r",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/7872400aa4644186b920b0121d6a5136_mergeImage.png",text:"刘易阳你今天表现不错哦1111111111111111111111111111111111111111111111",time:1683793245623},{username:"刘易阳",type:"text",status:"l",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/cf805a0bbe4b4f17abb1c215c9ec2df7_mergeImage.png",text:"刘易阳你今天表现不错哦1111111111111111111111111111111111111111111111",time:1683793245623},{username:"刘易阳",type:"text",status:"r",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/7872400aa4644186b920b0121d6a5136_mergeImage.png",text:"刘易阳你今天表现不错哦1111111111111111111111111111111111111111111111",time:1683793245623}],inputMessage:"",chat_name:"书法一班刘老师",change:!0,poaMessgae:"poaMessgae",scrollViewHeight:"",startTime:null,longPressDuration:6e3,show:!0}),methods:{onload(){this.statusBarHeight=getApp().globalData.top,I("log","at pages/pagesall/home/chat.vue:151","1111"),this.scrollToBottom(),this.poalast(),this.getHeight(".chat_box")},formatDate(e){if(void 0===e)return"";{let t=new Date(e),n=new Date,o=t.getFullYear(),a=t.getMonth()+1;a=a<10?"0"+a:a;let i=t.getDate();i=i<10?"0"+i:i;let s=t.getHours();s=s<10?"0"+s:s;let r=t.getMinutes();if(r=r<10?"0"+r:r,t.getSeconds(),n.getDate()-i==1&&n-t<1728e5)return"昨天"+s+":"+r;if(n-t<864e5)return s+":"+r;if(n-t>=864e5&&n-t<31536e6)return a+"-"+i+" "+s+":"+r;if(n-t>=31536e6)return o+"-"+a+"-"+i+" "+s+":"+r}},onSend(){let e={text:this.inputMessage,status:"r",type:"text",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/7872400aa4644186b920b0121d6a5136_mergeImage.png",time:new Date-0};this.sendmessage(JSON.stringify(e)),this.inputMessage=""},sendmessage(e){I("log","at pages/pagesall/home/chat.vue:206",e),this.messages_stu.push(JSON.parse(e)),this.scrollToBottom(),this.poalast()},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.messageList;e&&(e.scrollTop=e.scrollHeight)}))},poalast(){this.$nextTick((()=>{this.poaMessgae="",setTimeout((()=>{this.poaMessgae="poaMessgae"}),50)}))},input_change(){1==this.change?(I("log","at pages/pagesall/home/chat.vue:233",this.change),this.change=!1,I("log","at pages/pagesall/home/chat.vue:235",this.change)):0==this.change&&(this.change=!0)},inputchange(){1==this.change?(I("log","at pages/pagesall/home/chat.vue:242",this.change),this.change=!1,I("log","at pages/pagesall/home/chat.vue:244",this.change)):0==this.change&&(this.change=!0)},handleTouchStart(){I("log","at pages/pagesall/home/chat.vue:250","1111"),this.startTime=(new Date).getTime()},handleTouchEnd(){if(I("log","at pages/pagesall/home/chat.vue:254","1111"),this.startTime){let e=((new Date).getTime()-this.startTime)/1e3,t=Math.round(e);if(t<1)I("log","at pages/pagesall/home/chat.vue:260","时间太短了");else{I("log","at pages/pagesall/home/chat.vue:262",`${t}`);let e={username:"刘易阳",type:"record",status:"r",avatar:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/7872400aa4644186b920b0121d6a5136_mergeImage.png",text:t,time:new Date-0};this.messages_stu.push(e),this.poalast()}this.startTime=null}},chat_goback(){uni.navigateBack()}},mounted(){I("log","at pages/pagesall/home/chat.vue:287","1111"),this.poalast()}};const Fp=L(Vp,[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"chat_box","scroll-into-view":i.poaMessgae},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"chat_title_box"},[e.createElementVNode("view",{class:"chat_title"},[e.createElementVNode("view",{class:"chat_title_img",onClick:n[0]||(n[0]=(...e)=>s.chat_goback&&s.chat_goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"chat_head_img"},[e.createElementVNode("img",{src:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/cf805a0bbe4b4f17abb1c215c9ec2df7_mergeImage.png",alt:""})]),e.createElementVNode("view",{class:"chat_name"},e.toDisplayString(i.chat_name),1)])]),e.createElementVNode("view",{class:"chat-container"},[e.createElementVNode("scroll-view",{ref:"messageList","scroll-y":" true",class:"message-list","scroll-into-view":i.poaMessgae},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.messages_stu,((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,class:"message-item_stu"},[0==n||t.time-i.messages_stu[n-1].time>=3e5?(e.openBlock(),e.createElementBlock("view",{key:0,class:"time"},[e.createElementVNode("view",null,e.toDisplayString(s.formatDate(t.time)),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content1",id:"l"==t.status?"l":"r"},["img"==t.type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"text"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng580a34d876cda0a5b37d451367934eb478865bb7b4b80bedde3f71fcaa5c8775",alt:""})])):e.createCommentVNode("",!0),"record"==t.type?(e.openBlock(),e.createElementBlock("view",{key:1,class:"advio"},[e.createElementVNode("view",{class:""},e.toDisplayString(t.text)+' " ',1),e.createElementVNode("img",{src:"/static/img/advio.png",alt:""})])):e.createCommentVNode("",!0),"text"==t.type?(e.openBlock(),e.createElementBlock("view",{key:2,class:"text"},e.toDisplayString(t.text),1)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"avatar",style:{"margin-left":"20rpx"}},[e.createElementVNode("image",{src:t.avatar},null,8,["src"])])],8,["id"])])))),128)),e.createElementVNode("view",{id:"poaMessgae"})],8,["scroll-into-view"]),e.createElementVNode("view",{class:"input-container"},[e.createElementVNode("view",{class:"chat_input"},[i.change?(e.openBlock(),e.createElementBlock("img",{key:0,src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng8336930e00a2e304b3bd63727ff79ab21eb7c0da57bcc1da2dc88adc00ef2cbe",alt:"",onClick:n[1]||(n[1]=(...e)=>s.input_change&&s.input_change(...e))})):(e.openBlock(),e.createElementBlock("img",{key:1,src:"/static/img/Frame.png",alt:"",srcset:"",onClick:n[2]||(n[2]=(...e)=>s.inputchange&&s.inputchange(...e))})),i.change?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:2,"onUpdate:modelValue":n[3]||(n[3]=e=>i.inputMessage=e),placeholder:"发消息...",onFocus:n[4]||(n[4]=(...e)=>s.scrollToBottom&&s.scrollToBottom(...e)),"confirm-type":"send",onConfirm:n[5]||(n[5]=(...e)=>s.onSend&&s.onSend(...e))},null,544)),[[e.vModelText,i.inputMessage]]):(e.openBlock(),e.createElementBlock("view",{key:3,class:"voice",onTouchstart:n[6]||(n[6]=(...e)=>s.handleTouchStart&&s.handleTouchStart(...e)),onTouchend:n[7]||(n[7]=(...e)=>s.handleTouchEnd&&s.handleTouchEnd(...e))}," 按住说话 ",32)),e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng59f0b59c28758e28c9970d6e3110b53be29f04b99fded460a8f2a1cd5b32d1da",alt:"",class:"btn_img"})])])])],8,["scroll-into-view"])}]]);const Hp=L({data:()=>({images:["/static/img/swiper1.png","https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngdadd194d15ae0a321cf1b69b42b82fbdb401e127f68d9e091f73b2ef2c6682a6","/static/img/swiper1.png"],listdata:[{biaoti:"书法综合突破集训营(赠教学视频)",laoshi:" 书法综合突破集训营主导讲师刘老师经验丰富…",star:"2024.8.22",end:"2024.8.24",hearimg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngf75020ee967309de69964375963839256bf76467ffccdabe9efe77aefea8f6e1",techerimg:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng580a34d876cda0a5b37d451367934eb478865bb7b4b80bedde3f71fcaa5c8775",teachername:"李衣裳",pers:"2034",money:"免费",online:"线上",planum:"26000",quenum:"15999"}],hours:"",minutes:"",seconds:"",intervalId:null,audioContext:null,videoContext:null,learnList:{font_data:null,info:{}},homeworkFinishTime:null,statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top,this.startCountdown(),this.audioContext=uni.createInnerAudioContext(),this.loadHomeworkAudio()},onUnload(){this.stopCountdown(),this.audioContext.destroy()},mounted(){this.loadHomeworkAudio()},methods:{async submitHomework(){uni.chooseImage({count:1,sourceType:["camera","album"],success:e=>{this.images=e.tempFilePaths,this.uploadImage(e.tempFilePaths[0])},fail:e=>{I("error","at pages/pagesall/course/go_learn.vue:131","选择图片失败:",e)}})},async uploadImage(e){try{const t=await uni.uploadFile({url:"http://admin.zexishuhua.com/api/user/submithomework",filePath:e,name:"file",formData:{homework_id:this.learnList.info.id,token:uni.getStorageSync("token")}}),n=JSON.parse(t.data);1===n.code?uni.showToast({title:n.msg,icon:"none",duration:2e3}):uni.showToast({title:"上传失败，请重试",icon:"none",duration:2e3})}catch(t){I("error","at pages/pagesall/course/go_learn.vue:171","上传失败:",t),uni.showToast({title:"上传异常，请稍后再试",icon:"none",duration:2e3})}},async loadHomeworkAudio(){try{const e=await Y("/user/dohomework?homework_id=1");if(this.learnList.font_data=[],this.learnList.info=[],this.learnList.font_data=e.items.font_data||{},this.learnList.info=e.items[0],I("log","at pages/pagesall/course/go_learn.vue:196","Font Data:",this.learnList.font_data),I("log","at pages/pagesall/course/go_learn.vue:197","Info Data:",this.learnList.info),I("log","at pages/pagesall/course/go_learn.vue:198",this.learnList.font_data[0].voice_url),this.homeworkFinishTime=this.learnList.info.homeworkFinishTime,this.learnList.font_data.length>0){const e=this.learnList.font_data[0].voice_url;this.audioContext.src=e}}catch(e){I("error","at pages/pagesall/course/go_learn.vue:207","获取作业失败:",e)}},playAudio(){this.audioContext.play()},pauseAudio(){this.audioContext.pause()},stopAudio(){this.audioContext.stop()},formatTime:e=>e.toString().padStart(2,"0"),updateCountdown(){let e=new Date(this.homeworkFinishTime)-new Date;if(e>0){let t=Math.floor(e/1e3),n=Math.floor(t/3600),o=Math.floor(t%3600/60),a=t%60;this.hours=this.formatTime(n),this.minutes=this.formatTime(o),this.seconds=this.formatTime(a)}else this.hours="00",this.minutes="00",this.seconds="00"},startCountdown(){this.updateCountdown(),this.intervalId=setInterval(this.updateCountdown,1e3)},stopCountdown(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},back_learn(){uni.navigateBack()},btnsignup(){}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),i.learnList&&i.learnList.font_data&&i.learnList.font_data.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"learn_title"},[e.createElementVNode("img",{src:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/abf07bd571444c73aceb1d1b20093538_mergeImage.png",alt:"",onClick:n[0]||(n[0]=(...e)=>s.back_learn&&s.back_learn(...e))}),e.createElementVNode("view",null,"视频学习")]),i.learnList&&i.learnList.font_data&&i.learnList.font_data.length>0?(e.openBlock(),e.createElementBlock("video",{key:0,onPlay:n[1]||(n[1]=(...e)=>s.playAudio&&s.playAudio(...e)),onPause:n[2]||(n[2]=(...e)=>s.pauseAudio&&s.pauseAudio(...e)),onEnded:n[3]||(n[3]=(...e)=>s.stopAudio&&s.stopAudio(...e)),class:"learn_video",src:i.learnList.font_data[0].video,muted:"true"},null,40,["src"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"learn_text"},e.toDisplayString(i.learnList.info.content),1),e.createElementVNode("view",{class:"actiClass"},[e.createElementVNode("view",{class:"act_itme"},[e.createElementVNode("view",{class:"list_index"},[e.createElementVNode("view",{class:"act_Img"},[e.createElementVNode("img",{src:i.learnList.info.sub_image,alt:""},null,8,["src"]),e.createElementVNode("view",{class:"act_Teacher"},[e.createElementVNode("text",null,e.toDisplayString(i.learnList.info.teacher_name),1),e.createElementVNode("text",{style:{"font-size":"20rpx","margin-top":"10rpx"}},"授课")]),e.createElementVNode("view",{class:"act_time"},[e.createElementVNode("text",{style:{"font-size":"24rpx"}},"距结束还剩:"),e.createElementVNode("view",{class:"time_textbox"},[e.createElementVNode("text",{style:{"font-size":"20rpx",padding:"3rpx 5rpx 3rpx 5rpx","border-radius":"5rpx"}},e.toDisplayString(i.hours),1),e.createElementVNode("text",{style:{"font-size":"20rpx","background-color":"#fff",color:"#F53C38"}},":"),e.createElementVNode("text",{style:{"font-size":"20rpx",padding:"3rpx 5rpx 3rpx 5rpx","border-radius":"5rpx"}},e.toDisplayString(i.minutes),1),e.createElementVNode("text",{style:{"font-size":"20rpx","background-color":"#fff",color:"#F53C38"}},":"),e.createElementVNode("text",{style:{"font-size":"20rpx",padding:"3rpx 5rpx 3rpx 5rpx","border-radius":"5rpx"}},e.toDisplayString(i.seconds),1)])])])]),e.createElementVNode("view",{class:"peo_text"}," 已有30人学习 ")])]),e.createElementVNode("view",{class:"input_leabox"},[e.createElementVNode("view",{class:"ipt_learn"},[e.createElementVNode("textarea",{type:"text",placeholder:"本次横撇斜钩教学视频：相关作业就是多写多练多练多写",class:"input_padd"})]),e.createElementVNode("view",{class:"btn_leabox",onClick:n[4]||(n[4]=(...e)=>s.submitHomework&&s.submitHomework(...e))}," 提交作业 ")])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"100vh"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:"/static/img/noVideo.png",mode:"aspectFit"})]))])}]]),jp=[{font_class:"arrow-down",unicode:""},{font_class:"arrow-left",unicode:""},{font_class:"arrow-right",unicode:""},{font_class:"arrow-up",unicode:""},{font_class:"auth",unicode:""},{font_class:"auth-filled",unicode:""},{font_class:"back",unicode:""},{font_class:"bars",unicode:""},{font_class:"calendar",unicode:""},{font_class:"calendar-filled",unicode:""},{font_class:"camera",unicode:""},{font_class:"camera-filled",unicode:""},{font_class:"cart",unicode:""},{font_class:"cart-filled",unicode:""},{font_class:"chat",unicode:""},{font_class:"chat-filled",unicode:""},{font_class:"chatboxes",unicode:""},{font_class:"chatboxes-filled",unicode:""},{font_class:"chatbubble",unicode:""},{font_class:"chatbubble-filled",unicode:""},{font_class:"checkbox",unicode:""},{font_class:"checkbox-filled",unicode:""},{font_class:"checkmarkempty",unicode:""},{font_class:"circle",unicode:""},{font_class:"circle-filled",unicode:""},{font_class:"clear",unicode:""},{font_class:"close",unicode:""},{font_class:"closeempty",unicode:""},{font_class:"cloud-download",unicode:""},{font_class:"cloud-download-filled",unicode:""},{font_class:"cloud-upload",unicode:""},{font_class:"cloud-upload-filled",unicode:""},{font_class:"color",unicode:""},{font_class:"color-filled",unicode:""},{font_class:"compose",unicode:""},{font_class:"contact",unicode:""},{font_class:"contact-filled",unicode:""},{font_class:"down",unicode:""},{font_class:"bottom",unicode:""},{font_class:"download",unicode:""},{font_class:"download-filled",unicode:""},{font_class:"email",unicode:""},{font_class:"email-filled",unicode:""},{font_class:"eye",unicode:""},{font_class:"eye-filled",unicode:""},{font_class:"eye-slash",unicode:""},{font_class:"eye-slash-filled",unicode:""},{font_class:"fire",unicode:""},{font_class:"fire-filled",unicode:""},{font_class:"flag",unicode:""},{font_class:"flag-filled",unicode:""},{font_class:"folder-add",unicode:""},{font_class:"folder-add-filled",unicode:""},{font_class:"font",unicode:""},{font_class:"forward",unicode:""},{font_class:"gear",unicode:""},{font_class:"gear-filled",unicode:""},{font_class:"gift",unicode:""},{font_class:"gift-filled",unicode:""},{font_class:"hand-down",unicode:""},{font_class:"hand-down-filled",unicode:""},{font_class:"hand-up",unicode:""},{font_class:"hand-up-filled",unicode:""},{font_class:"headphones",unicode:""},{font_class:"heart",unicode:""},{font_class:"heart-filled",unicode:""},{font_class:"help",unicode:""},{font_class:"help-filled",unicode:""},{font_class:"home",unicode:""},{font_class:"home-filled",unicode:""},{font_class:"image",unicode:""},{font_class:"image-filled",unicode:""},{font_class:"images",unicode:""},{font_class:"images-filled",unicode:""},{font_class:"info",unicode:""},{font_class:"info-filled",unicode:""},{font_class:"left",unicode:""},{font_class:"link",unicode:""},{font_class:"list",unicode:""},{font_class:"location",unicode:""},{font_class:"location-filled",unicode:""},{font_class:"locked",unicode:""},{font_class:"locked-filled",unicode:""},{font_class:"loop",unicode:""},{font_class:"mail-open",unicode:""},{font_class:"mail-open-filled",unicode:""},{font_class:"map",unicode:""},{font_class:"map-filled",unicode:""},{font_class:"map-pin",unicode:""},{font_class:"map-pin-ellipse",unicode:""},{font_class:"medal",unicode:""},{font_class:"medal-filled",unicode:""},{font_class:"mic",unicode:""},{font_class:"mic-filled",unicode:""},{font_class:"micoff",unicode:""},{font_class:"micoff-filled",unicode:""},{font_class:"minus",unicode:""},{font_class:"minus-filled",unicode:""},{font_class:"more",unicode:""},{font_class:"more-filled",unicode:""},{font_class:"navigate",unicode:""},{font_class:"navigate-filled",unicode:""},{font_class:"notification",unicode:""},{font_class:"notification-filled",unicode:""},{font_class:"paperclip",unicode:""},{font_class:"paperplane",unicode:""},{font_class:"paperplane-filled",unicode:""},{font_class:"person",unicode:""},{font_class:"person-filled",unicode:""},{font_class:"personadd",unicode:""},{font_class:"personadd-filled",unicode:""},{font_class:"personadd-filled-copy",unicode:""},{font_class:"phone",unicode:""},{font_class:"phone-filled",unicode:""},{font_class:"plus",unicode:""},{font_class:"plus-filled",unicode:""},{font_class:"plusempty",unicode:""},{font_class:"pulldown",unicode:""},{font_class:"pyq",unicode:""},{font_class:"qq",unicode:""},{font_class:"redo",unicode:""},{font_class:"redo-filled",unicode:""},{font_class:"refresh",unicode:""},{font_class:"refresh-filled",unicode:""},{font_class:"refreshempty",unicode:""},{font_class:"reload",unicode:""},{font_class:"right",unicode:""},{font_class:"scan",unicode:""},{font_class:"search",unicode:""},{font_class:"settings",unicode:""},{font_class:"settings-filled",unicode:""},{font_class:"shop",unicode:""},{font_class:"shop-filled",unicode:""},{font_class:"smallcircle",unicode:""},{font_class:"smallcircle-filled",unicode:""},{font_class:"sound",unicode:""},{font_class:"sound-filled",unicode:""},{font_class:"spinner-cycle",unicode:""},{font_class:"staff",unicode:""},{font_class:"staff-filled",unicode:""},{font_class:"star",unicode:""},{font_class:"star-filled",unicode:""},{font_class:"starhalf",unicode:""},{font_class:"trash",unicode:""},{font_class:"trash-filled",unicode:""},{font_class:"tune",unicode:""},{font_class:"tune-filled",unicode:""},{font_class:"undo",unicode:""},{font_class:"undo-filled",unicode:""},{font_class:"up",unicode:""},{font_class:"top",unicode:""},{font_class:"upload",unicode:""},{font_class:"upload-filled",unicode:""},{font_class:"videocam",unicode:""},{font_class:"videocam-filled",unicode:""},{font_class:"vip",unicode:""},{font_class:"vip-filled",unicode:""},{font_class:"wallet",unicode:""},{font_class:"wallet-filled",unicode:""},{font_class:"weibo",unicode:""},{font_class:"weixin",unicode:""}];const qp=L({name:"UniIcons",emits:["click"],props:{type:{type:String,default:""},color:{type:String,default:"#333333"},size:{type:[Number,String],default:16},customPrefix:{type:String,default:""},fontFamily:{type:String,default:""}},data:()=>({icons:jp}),computed:{unicode(){let e=this.icons.find((e=>e.font_class===this.type));return e?e.unicode:""},iconSize(){return"number"==typeof(e=this.size)||/^[0-9]*$/g.test(e)?e+"px":e;var e},styleObj(){return""!==this.fontFamily?`color: ${this.color}; font-size: ${this.iconSize}; font-family: ${this.fontFamily};`:`color: ${this.color}; font-size: ${this.iconSize};`}},methods:{_onClick(){this.$emit("click")}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("text",{style:e.normalizeStyle(s.styleObj),class:e.normalizeClass(["uni-icons",["uniui-"+o.type,o.customPrefix,o.customPrefix?o.type:""]]),onClick:n[0]||(n[0]=(...e)=>s._onClick&&s._onClick(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],6)}],["__scopeId","data-v-5610c8db"]]),zp={name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],n=Math.floor(e),o=Math.ceil(e);for(let a=0;a<this.max;a++)n>a?t.push({activeWitch:"100%"}):o-1===a?t.push({activeWitch:100*(e-n)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100)},methods:{touchstart(e){if(this.readonly||this.disabled)return;const{clientX:t,screenX:n}=e.changedTouches[0];this._getRateCount(t||n)},touchmove(e){if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:n}=e.changedTouches[0];this._getRateCount(t||n)},mousedown(e){},mousemove(e){},mouseleave(e){},_getRateCount(e){this._getSize();const t=Number(this.size);if(isNaN(t))return new Error("size 属性只能设置为数字");const n=e-this._rateBoxLeft;let o=parseInt(n/(t+this.marginNumber));o=o<0?0:o,o=o>this.max?this.max:o;const a=parseInt(n-(t+this.marginNumber)*o);let i=0;(this._oldValue!==o||this.PC)&&(this._oldValue=o,i=this.allowHalf?a>t/2?o+1:o+.5:o+1,i=Math.max(.5,Math.min(i,this.max)),this.valueSync=i,this._onChange())},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(){uni.createSelectorQuery().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left)}))}}};const Kp=L(zp,[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uni-icons"),qp);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{ref:"uni-rate",class:"uni-rate"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.stars,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uni-rate__icon",{"uni-cursor-not-allowed":o.disabled}]),style:e.normalizeStyle({"margin-right":s.marginNumber+"px"}),key:a,onTouchstart:n[0]||(n[0]=e.withModifiers(((...e)=>s.touchstart&&s.touchstart(...e)),["stop"])),onTouchmove:n[1]||(n[1]=e.withModifiers(((...e)=>s.touchmove&&s.touchmove(...e)),["stop"])),onMousedown:n[2]||(n[2]=e.withModifiers(((...e)=>s.mousedown&&s.mousedown(...e)),["stop"])),onMousemove:n[3]||(n[3]=e.withModifiers(((...e)=>s.mousemove&&s.mousemove(...e)),["stop"])),onMouseleave:n[4]||(n[4]=(...e)=>s.mouseleave&&s.mouseleave(...e))},[e.createVNode(r,{color:o.color,size:o.size,type:o.isFill?"star-filled":"star"},null,8,["color","size","type"]),e.createElementVNode("view",{style:e.normalizeStyle({width:t.activeWitch}),class:"uni-rate__icon-on"},[e.createVNode(r,{color:o.disabled?o.disabledColor:o.activeColor,size:o.size,type:"star-filled"},null,8,["color","size"])],4)],38)))),128))],512)])}],["__scopeId","data-v-77c606f8"]]);const $p=L({data:()=>({canvasRef:null,stu_List:[{name:"刘琪琦",id:"1008601"}],score_List:[{title:"重心",score:5},{title:"位置",score:4},{title:"形态",score:3},{title:"笔画",score:2},{title:"大小",score:1}],comprehensiveLevel:"",imagePath:null,token:null,pageMark:0,canvasWidth:0,canvasHeight:0,chooseImageWidth:0,chooseImageHeight:0,ocrResults:null,wordMarks:null,scrollTop:0,mouseX:0,mouseY:0,evaluationDesc:"",statusBarHeight:""}),computed:{userInfo:()=>se().userinfo},mounted(){this.getToken(),this.store=se(),I("log","at pages/pagesall/aiDete/aiResult.vue:124",this.store.resultDivData,typeof this.store.resultDivData);let e=this.store.evaluationDesc;if(I("log","at pages/pagesall/aiDete/aiResult.vue:135",e),e){const t={"综合得分":null,"重心得分":null,"形态得分":null,"大小得分":null,"位置得分":null,"笔画得分":null},n=/(综合得分|重心得分|形态得分|大小得分|位置得分|笔画得分)[^\d]*(\d+)/g;let o;for(;null!==(o=n.exec(e));){const e=o[1],n=parseInt(o[2],10);t.hasOwnProperty(e)&&(t[e]=n)}const a=e=>e>=60?"优":"差";null!==t.综合得分&&(this.comprehensiveLevel=a(t.综合得分));const i=e=>e>=80?5:e>=60?4:e>=40?3:e>=20?2:1,s={"重心":t.重心得分,"位置":t.位置得分,"形态":t.形态得分,"笔画":t.笔画得分,"大小":t.大小得分};this.score_List.forEach((e=>{const t=s[e.title];void 0!==t&&(e.score=i(t))}))}},onLoad(){const e=uni.getSystemInfoSync();this.canvasWidth=e.windowWidth,this.chooseImage(),this.statusBarHeight=getApp().globalData.top},methods:{getToken(){uni.getStorage({key:"token",success:e=>{this.token=e.data,I("log","at pages/pagesall/aiDete/aiResult.vue:210","获取的 token:",this.token)},fail:e=>{I("error","at pages/pagesall/aiDete/aiResult.vue:213","获取 token 失败:",e)}})},chooseImage(){this.pageMark=0,uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{this.imageSrc=e.tempFilePaths[0],this.imagePath=e.tempFilePaths[0],I("log","at pages/pagesall/aiDete/aiResult.vue:227","choose file path ",e.tempFiles[0].path),I("log","at pages/pagesall/aiDete/aiResult.vue:228","choose file size ",e.tempFiles[0].size),uni.getImageInfo({src:e.tempFilePaths[0],success:e=>{I("log","at pages/pagesall/aiDete/aiResult.vue:235","choose image width",e.width),I("log","at pages/pagesall/aiDete/aiResult.vue:236","choose image height",e.height),this.chooseImageWidth=e.width,this.chooseImageHeight=e.height;const t=this.chooseImageHeight/this.chooseImageWidth;this.canvasHeight=this.canvasWidth*t,setTimeout((()=>{this.drawImage(),this.submitForm()}),100)}})},fail:e=>{I("error","at pages/pagesall/aiDete/aiResult.vue:252","选择图片失败：",e)}})},submitForm(){return this.imagePath?this.token?void uni.uploadFile({url:"http://admin.zexishuhua.com/api/common/detecthomework",filePath:this.imagePath,name:"file",header:{token:`${this.token}`},formData:{sdk:"WordEvaluation",device_id:"test_device_id",isCheckExamNum:"false",font:0},success:e=>{const t=JSON.parse(e.data);0==t.code&&(this.pageMark=t.data.pageMark,this.ocrResults=t.data.ocrResults,this.wordMarks=t.data.wordMarks,this.drawImageWithData())},fail:e=>{I("error","at pages/pagesall/aiDete/aiResult.vue:328","提交失败：",e),uni.showToast({title:"提交失败",icon:"none"})}}):uni.showToast({title:"请先登录",icon:"none"}):uni.showToast({title:"请先选择图片",icon:"none"})},drawImage(){const e=uni.createCanvasContext("myCanvas");e.clearRect(0,0,this.canvasWidth,this.canvasHeight),e.drawImage(this.imagePath,0,0,this.canvasWidth,this.canvasHeight),e.draw(!1,(()=>{I("log","at pages/pagesall/aiDete/aiResult.vue:342","draw image success")}))},handleCanvasClick(e){uni.createSelectorQuery().in(this).select("#myScrollView").scrollOffset((t=>{I("log","at pages/pagesall/aiDete/aiResult.vue:349",e),I("log","at pages/pagesall/aiDete/aiResult.vue:350",e.target),I("log","at pages/pagesall/aiDete/aiResult.vue:351",e.detail.x,e.detail.y),I("log","at pages/pagesall/aiDete/aiResult.vue:352",e.target.offsetLeft,e.target.offsetTop);const n=e.detail.x-e.target.offsetLeft,o=e.detail.y-e.target.offsetTop;I("log","at pages/pagesall/aiDete/aiResult.vue:355","x",n),I("log","at pages/pagesall/aiDete/aiResult.vue:356","y",o),I("log","at pages/pagesall/aiDete/aiResult.vue:357",t),this.mouseX=n,this.mouseY=o+t.scrollTop,this.drawImageWithData()})).exec()},drawImageWithData(){const e=uni.createCanvasContext("myCanvas");if(e.clearRect(0,0,this.canvasWidth,this.canvasHeight),e.drawImage(this.imagePath,0,0,this.canvasWidth,this.canvasHeight),!this.ocrResults&&!this.wordMarks)return;I("log","at pages/pagesall/aiDete/aiResult.vue:373","mouseX",this.mouseX),I("log","at pages/pagesall/aiDete/aiResult.vue:374","mouseY",this.mouseY),this.chooseImageHeight,this.chooseImageWidth;const t=this.canvasWidth/this.chooseImageWidth;this.ocrResults.forEach(((n,o)=>{const a=this.wordMarks[o];let i,s=n.points[0]*t,r=n.points[1]*t,c=(n.points[4]-n.points[0])*t,l=(n.points[5]-n.points[1])*t;if(i=a.mark>80?"优":a.mark>=60?"良":"学习",this.mouseX>=s&&this.mouseX<=s+c&&this.mouseY>=r&&this.mouseY<=r+l){e.strokeStyle="blue",e.fillStyle="blue",e.strokeRect(s,r,c,l),e.fillText(i,s,r+25),this.drawMask("wordMask",n.label,a.base64Mark),this.showWordsInfo(n,a);const t=(new TextEncoder).encode(n.label),o=btoa(String.fromCharCode(...t));if(I("log","at pages/pagesall/aiDete/aiResult.vue:413",`你点击了文字 "${n.label}"，分数: ${a.mark}，Base64格式: ${o}`),"学习"===i){let e={fonts:o};I("log","at pages/pagesall/aiDete/aiResult.vue:418",11111),(u=e,Y("/user/gostudy",u)).then((e=>{I("log","at pages/pagesall/aiDete/aiResult.vue:420","学习成功:",e);const{msg:t}=e;I("log","at pages/pagesall/aiDete/aiResult.vue:423",t),1===e.code?uni.navigateTo({url:"/pages/pagesall/course/go_learn"}):uni.showToast({title:t,icon:"error"})})).catch((e=>{}))}}else a.mark<70?(e.strokeStyle="red",e.fillStyle="red"):(e.strokeStyle="#2e8b57",e.fillStyle="#2e8b57"),e.strokeRect(s,r,c,l),e.fillText(i,s,r+25);var u})),0==this.mouseX&&0==this.mouseY&&this.ocrResults.length>0&&(this.drawMask("wordMask",this.ocrResults[0].label,this.wordMarks[0].base64Mark),this.showWordsInfo(this.ocrResults[0],this.wordMarks[0])),e.draw(!1,(()=>{I("log","at pages/pagesall/aiDete/aiResult.vue:466","draw image success")}))},drawMask(e,t,n){const o=uni.createCanvasContext("wordMask",this);o.clearRect(0,0,128,128),o.setFillStyle("#ffffff"),o.fillRect(0,0,128,128);o.setFillStyle("#FF5733"),o.font="106px simkai",o.setFontSize(106),o.setTextAlign("center"),o.setTextBaseline("middle"),o.fillText(t,64,64);const a=atob(n),i=new Uint8Array(a.length);for(var s=0;s<a.length;s++)i[s]=a.charCodeAt(s);!function(e){for(let t=0;t<128;++t)for(let n=0;n<128;++n){let a=e[128*t+n];if(0===a){const e=0===a?0:255;o.setFillStyle(`rgb(${e}, ${e}, ${e})`),o.fillRect(n,t,1,1)}}}(function(e){const t=[];for(let n=0;n<e.length;n++)for(let o=7;o>=0;o--){const a=e[n]>>o&1;t.push(a)}return t}(i)),o.draw(!1,(()=>{I("log","at pages/pagesall/aiDete/aiResult.vue:526","draw mask success"),se();I("log","at pages/pagesall/aiDete/aiResult.vue:529",this.$refs.aiBox)}))},showWordsInfo(e,t){let n=[];n.push(e.label+"\n"),t.mark<=0&&n.push("暂无识别字的评测数据\n"),n.push("综合得分 "+t.mark+"\n"),n.push("重心得分 "+t.centerMark),0===t.centerInfo?n.push("良好"):1===t.centerInfo?n.push("偏上"):2===t.centerInfo?n.push("偏下"):3===t.centerInfo?n.push("偏左"):4===t.centerInfo&&n.push("偏右"),n.push("\n"),n.push("形态得分 "+t.rateMark),0===t.rateInfo?n.push("良好"):1===t.rateInfo?n.push("太宽"):2===t.rateInfo&&n.push("太瘦"),n.push("\n"),n.push("大小得分 "+t.areaMark),0===t.areaInfo?n.push("良好"):1===t.areaInfo?n.push("太小"):2===t.areaInfo&&n.push("太大"),n.push("\n"),n.push("位置得分 "+t.posMark),0===t.posInfo?n.push("良好"):1===t.posInfo?n.push("偏上"):2===t.posInfo?n.push("偏下"):3===t.posInfo?n.push("偏左"):4===t.posInfo&&n.push("偏右"),n.push("\n"),n.push("笔画得分 "+t.conFMark),0===t.conFInfo?n.push("良好"):1===t.conFInfo&&n.push("不良"),n.push("\n"),this.evaluationDesc=n.join("");se().setEvaluationDesc(this.evaluationDesc)}}},[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uni-rate"),Kp);return e.openBlock(),e.createElementBlock("scroll-view",{id:"myScrollView","scroll-y":"true",style:{height:"100vh"}},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"res_box"},[e.createElementVNode("view",{class:"res_box2"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPnge1553c1d8d43568ee582b54f1deab731573c8804790b09e299c2e73eda1cfa68",alt:"",onClick:n[0]||(n[0]=(...e)=>t.res_goback&&t.res_goback(...e))}),e.createElementVNode("view",{class:"res_text"}," AI测评结果 ")]),e.createElementVNode("view",{class:"res_box3"},[e.createElementVNode("view",{class:"res_heard"},[e.createElementVNode("img",{style:{"border-radius":"50%"},src:s.userInfo.avatar,alt:""},null,8,["src"]),e.createElementVNode("view",{class:"head_text"},[e.createElementVNode("view",{class:"text_1"},e.toDisplayString(s.userInfo.nickname),1),e.createElementVNode("view",{class:"text_2"}," ID:"+e.toDisplayString(s.userInfo.id),1)])]),e.createElementVNode("view",{class:"score_box"},[e.createElementVNode("view",{class:"score_box1"},[e.createElementVNode("view",{class:"score_text"},e.toDisplayString(i.comprehensiveLevel),1),e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngfe293373ca510260bf25cf15905e96d33c640dc3b4be40d673f30a4860f69215",alt:""}),e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPngfe293373ca510260bf25cf15905e96d33c640dc3b4be40d673f30a4860f69215",alt:""})]),e.createElementVNode("view",{class:"scoring_box"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.score_List,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"xingxing1",key:n},[e.createElementVNode("view",{class:"xingxing"},e.toDisplayString(t.title),1),e.createVNode(r,{readonly:!0,size:"20",value:t.score},null,8,["value"])])))),128))])]),e.createElementVNode("textarea",{type:"text",class:"ipt_res",placeholder:"  重心写的很棒，注意整体形态，笔画再加长一些，加油！你距离成功仅仅一步之遥，多跟泽曦名师学习，相信可以写的更好！"})])]),e.createElementVNode("view",null,[e.createElementVNode("canvas",{ref:"myCanvas","canvas-id":"myCanvas",id:"myCanvas",style:e.normalizeStyle({width:"100vw",height:i.canvasHeight+"px"}),onClick:n[1]||(n[1]=(...e)=>s.handleCanvasClick&&s.handleCanvasClick(...e))},null,4)])])}]]);const Yp=L({data:()=>({statusBarHeight:"",searchQuery:"",hotCities:["北京","上海","广州","深圳","西安","郑州","重庆","武汉"],allCities:[{name:"阿坝",pinyin:"A"},{name:"阿城",pinyin:"A"},{name:"阿克苏",pinyin:"A"},{name:"阿拉善盟",pinyin:"A"},{name:"阿勒泰",pinyin:"A"},{name:"阿里",pinyin:"A"},{name:"北京市",pinyin:"B"},{name:"上海市",pinyin:"S"},{name:"广州市",pinyin:"G"},{name:"深圳市",pinyin:"S"},{name:"西安市",pinyin:"X"},{name:"郑州市",pinyin:"Z"}],filteredCities:[]}),onLoad(){this.statusBarHeight=getApp().globalData.top},mounted(){this.filteredCities=this.allCities},methods:{filterCities(){this.filteredCities=this.allCities.filter((e=>e.name.includes(this.searchQuery)))},goToCityDetail(e){const t=getCurrentPages();t[t.length-2].updateSelectedCity(e),uni.switchTab({url:"/pages/pagesall/oper"})}},computed:{sortedCities(){const e={};return this.filteredCities.forEach((t=>{const n=t.pinyin;e[n]||(e[n]=[]),e[n].push(t)})),e}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"search-bar"},[e.createElementVNode("text",null,"选择城市"),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=e=>i.searchQuery=e),placeholder:"请输入城市",onInput:n[1]||(n[1]=(...e)=>s.filterCities&&s.filterCities(...e))},null,544),[[e.vModelText,i.searchQuery]])]),e.createElementVNode("view",{class:"current-location"},[e.createElementVNode("text",null,"当前位置"),e.createElementVNode("view",{class:"city-tag"},"湛江市")]),e.createElementVNode("view",{class:"hot-cities"},[e.createElementVNode("text",null,"热门城市"),e.createElementVNode("view",{class:"city-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.hotCities,((t,n)=>(e.openBlock(),e.createElementBlock("text",{class:"city-tag",key:n,onClick:e=>s.goToCityDetail(t)},e.toDisplayString(t),9,["onClick"])))),128))])]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.sortedCities,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"city-list-group",key:n},[e.createElementVNode("text",null,e.toDisplayString(n),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t,((t,n)=>(e.openBlock(),e.createElementBlock("view",{onClick:e=>s.goToCityDetail(t.name),key:n,class:"city"},e.toDisplayString(t.name),9,["onClick"])))),128))])))),128))])}],["__scopeId","data-v-a636f38b"]]);const Wp=L({props:{placeholder:{type:String,default:"请输入"},disabled:{type:Boolean,default:!0},modelValue:{type:String,default:""},type:{type:String,default:"text"}},setup(t,{emit:n}){const o=e.ref(t.disabled),a=e.ref(t.modelValue),i=e.ref(t.type);return e.watch((()=>t.modelValue),(e=>{a.value=e})),e.watch((()=>t.disabled),(e=>{o.value=e})),e.watch((()=>t.type),(e=>{i.value=e})),{isDisabled:o,currentValue:a,updateValue:()=>{n("update:modelValue",a.value)},enableInput:()=>{o.value=!1},inputType:i}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("input",{type:a.inputType,placeholder:o.placeholder,disabled:a.isDisabled,class:"custom-input","onUpdate:modelValue":n[0]||(n[0]=e=>a.currentValue=e),onInput:n[1]||(n[1]=(...e)=>a.updateValue&&a.updateValue(...e))},null,40,["type","placeholder","disabled"]),[[e.vModelDynamic,a.currentValue]]),e.createElementVNode("image",{class:"icon_1",referrerpolicy:"no-referrer",src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng020f3b0f7825fdd6e79b0361c149b486540d9894e91feb72f43c076696f9d05f",style:{width:"28rpx",height:"28rpx"},onClick:n[2]||(n[2]=(...e)=>a.enableInput&&a.enableInput(...e))})])}],["__scopeId","data-v-0415c903"]]),Jp=L({__name:"BottomSheet",props:{isVisible:{type:Boolean,default:!1},options:{type:Array,default:()=>[]},fontColor:{type:String,default:"#000"}},emits:["update:isVisible","optionSelected"],setup(t,{emit:n}){const o=n,a=()=>{o("update:isVisible",!1)},i=()=>{};return(n,s)=>(e.openBlock(),e.createElementBlock("view",null,[t.isVisible?(e.openBlock(),e.createElementBlock("view",{key:0,class:"overlay",onClick:a})):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["bottom-sheet",{"is-active":t.isVisible}]),onTouchmove:e.withModifiers(i,["stop","prevent"])},[e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"options"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.options,((n,i)=>(e.openBlock(),e.createElementBlock("view",{class:"option",key:i,onClick:e=>{return t=n.text,o("optionSelected",t),void a();var t},style:e.normalizeStyle({color:t.fontColor})},[n.imageSrc?(e.openBlock(),e.createElementBlock("image",{key:0,src:n.imageSrc,class:"option-image"},null,8,["src"])):e.createCommentVNode("",!0),e.createElementVNode("text",null,e.toDisplayString(n.text),1)],12,["onClick"])))),128))]),e.createElementVNode("button",{style:e.normalizeStyle({color:t.fontColor}),class:"close-button",onClick:a},"取消",4)])],34)]))}},[["__scopeId","data-v-28f44a27"]]),Xp={__name:"PersonalData",setup(t){const n=se(),o=e.ref();M((()=>{o.value=getApp().globalData.top}));const a=e.reactive({name:"张三",age:33,referrer:"李老师",phone:"13812345678",password:"12315",value:""}),i=e.ref(!1),s=e.ref([{text:"拍照"},{text:"从手机相册选择"}]),r=e.ref(!0),c=e.ref(!0),l=e.ref(!0),u=e.ref("年/月/日"),d=e.ref("选择校区"),p=e.ref("请选择班级"),h=e.ref(null),g=e.ref(0),m=e.ref(),f=e.ref(),v=e.ref(),_=e.ref({}),y=e.ref(""),C=()=>{r.value=!r.value},k=()=>{c.value=!c.value},T=()=>{I("log","at pages/pagesall/mypage/PersonalData.vue:158",_.value),uni.navigateBack()},S=()=>{i.value=!0},D=e=>{"拍照"===e?b():w(),I("log","at pages/pagesall/mypage/PersonalData.vue:181","选择的选项:",e)},b=()=>{uni.chooseImage({count:1,sourceType:["camera"],success:async e=>{I("log","at pages/pagesall/mypage/PersonalData.vue:189",e,"+++++++++"),uni.uploadFile({url:"http://admin.zexishuhua.com/api/common/upload",filePath:e.tempFilePaths[0],name:"file",formData:{token:uni.getStorageSync("token")},success:t=>{I("log","at pages/pagesall/mypage/PersonalData.vue:198",t.data),y.value=e.tempFilePaths[0]}})},fail:e=>{I("error","at pages/pagesall/mypage/PersonalData.vue:204","拍照失败:",e)}})},w=()=>{uni.chooseImage({count:1,sourceType:["album"],success:async e=>{I("log","at pages/pagesall/mypage/PersonalData.vue:214",e,"+++++++++"),0!==e.tempFilePaths.length?uni.uploadFile({url:"http://admin.zexishuhua.com/api/common/upload",filePath:e.tempFilePaths[0],name:"file",formData:{token:uni.getStorageSync("token")},success:t=>{I("log","at pages/pagesall/mypage/PersonalData.vue:227",t.data),y.value=e.tempFilePaths[0]}}):I("error","at pages/pagesall/mypage/PersonalData.vue:216","未选择任何图片")},fail:e=>{I("error","at pages/pagesall/mypage/PersonalData.vue:234","选择图片失败:",e)}})},N=e=>{v.value=e.detail.value,isNaN(v.value)||0===v.value.length?(p.value=f.value[0].title,classlyId.value=f.value[0].id):(p.value=f.value[v.value].title,classlyId.value=f.value[v.value].id)},L=e=>{let t=new Date(e.value),n=t.getFullYear(),o=t.getMonth()+1;o=o<10?"0"+o:o;let a=t.getDate();a=a<10?"0"+a:a,t.getHours(),t.getMinutes(),t.getSeconds();let i=n+"."+o+"."+a;u.value=i};return e.onMounted((async()=>{I("log","at pages/pagesall/mypage/PersonalData.vue:274",n.campusData),m.value=n.campusData,I("log","at pages/pagesall/mypage/PersonalData.vue:276",m.value),f.value=n.classData;try{const e=await Y("/user/personal");I("log","at pages/pagesall/mypage/PersonalData.vue:280",e),a.name=e.data.nickname,a.age=e.data.age,a.referrer=e.data.referee,a.phone=e.data.mobile,a.password=e.data.password;const t=new Date(e.data.birthday);I("log","at pages/pagesall/mypage/PersonalData.vue:290",t);const o=t.getFullYear(),i=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0");I("log","at pages/pagesall/mypage/PersonalData.vue:294",o,i,s),u.value=`${o}.${i}.${s}`;const r=n.campusData.find((t=>t.id===e.data.school_id));r&&(d.value=r.title,g.value=n.campusData.indexOf(r)),I("log","at pages/pagesall/mypage/PersonalData.vue:307",n.classData),I("log","at pages/pagesall/mypage/PersonalData.vue:308",e.data.classly_id);const c=n.classData.find((t=>t.id===e.data.classly_id));if(I("log","at pages/pagesall/mypage/PersonalData.vue:311",c),c){const e=n.classData.indexOf(c);p.value=c.title,v.value=[e]}}catch(e){I("error","at pages/pagesall/mypage/PersonalData.vue:318","获取用户信息失败:",e)}})),(t,n)=>{const _=E(e.resolveDynamicComponent("uv-datetime-picker"),el);return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(o.value+5)+"px;")},null,4),e.createElementVNode("view",null,[e.createElementVNode("view",{style:{height:"100rpx"}}),e.createVNode(_,{ref_key:"datetimePicker",ref:h,modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=e=>a.value=e),mode:"date",minDate:946695809e3,onConfirm:L},null,8,["modelValue"]),e.createVNode(e.unref(Jp),{style:{"font-weight":"400"},isVisible:i.value,options:s.value,"onUpdate:isVisible":n[1]||(n[1]=e=>i.value=e),onOptionSelected:D},null,8,["isVisible","options"]),e.createElementVNode("view",{class:"container"},[e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"textTitle"},[e.createElementVNode("view",{class:"title1"}," 更换头像 ")]),e.createElementVNode("view",{class:"textlogin"},[e.createElementVNode("view",{class:"img1",onClick:S},[e.createElementVNode("img",{style:{width:"192rpx",height:"192rpx","border-radius":"50%"},src:y.value,alt:""},null,8,["src"]),e.createElementVNode("view",{class:"imgtext1"}," 男 ")])]),e.createElementVNode("view",{class:"title"},"姓名"),e.createElementVNode("view",{class:"input_po"},[e.createVNode(e.unref(Wp),{modelValue:a.name,"onUpdate:modelValue":n[2]||(n[2]=e=>a.name=e),placeholder:"输入姓名",disabled:!0},null,8,["modelValue"])]),e.createElementVNode("view",{class:"title"},"年龄"),e.createElementVNode("view",{class:"input_po"},[e.createVNode(e.unref(Wp),{modelValue:a.age,"onUpdate:modelValue":n[3]||(n[3]=e=>a.age=e),placeholder:"例如:12",disabled:!0},null,8,["modelValue"])]),e.createElementVNode("view",{class:"title"},"出生年月日"),e.createElementVNode("view",{class:"input_po"},[e.createElementVNode("view",{class:e.normalizeClass([{disabled:l.value},"image-text_1 flex-row justify-between input"])},[e.createElementVNode("text",null,e.toDisplayString(u.value),1)],2),e.createElementVNode("image",{class:"icon_1",referrerpolicy:"no-referrer",src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng020f3b0f7825fdd6e79b0361c149b486540d9894e91feb72f43c076696f9d05f",style:{width:"28rpx",height:"28rpx"},onClick:n[4]||(n[4]=e=>l.value?(h.value.open(),void I("log","at pages/pagesall/mypage/PersonalData.vue:136",h.value)):null)})]),e.createElementVNode("view",{class:"title"},"校区"),e.createElementVNode("view",{class:"input_po"},[e.createElementVNode("view",{class:"input"},[e.createElementVNode("picker",{disabled:r.value,onChange:n[5]||(n[5]=e=>((e,t)=>{I("log","at pages/pagesall/mypage/PersonalData.vue:163","picker发送选择改变，携带值为",e.detail.value);let n=e.detail.value;g.value=n,d.value=t[n].title})(e,m.value)),value:g.value,range:m.value&&m.value.map((e=>e.title)),"range-key":"gift"},[e.createElementVNode("view",{class:"uni-input text-group_2"},e.toDisplayString(d.value),1)],40,["disabled","value","range"])]),e.createElementVNode("image",{class:"icon_1",referrerpolicy:"no-referrer",src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng020f3b0f7825fdd6e79b0361c149b486540d9894e91feb72f43c076696f9d05f",style:{width:"28rpx",height:"28rpx"},onClick:C})]),e.createElementVNode("view",{class:"title"},"班级"),e.createElementVNode("view",{class:"input_po"},[e.createElementVNode("view",{class:"uni-list-cell-db input"},[e.createElementVNode("picker",{mode:"selector",onChange:N,value:v.value,range:f.value&&f.value.map((e=>e.title)),disabled:c.value},[e.createElementVNode("view",{class:"uni-input"},e.toDisplayString(p.value),1)],40,["value","range","disabled"])]),e.createElementVNode("image",{class:"icon_1",referrerpolicy:"no-referrer",src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng020f3b0f7825fdd6e79b0361c149b486540d9894e91feb72f43c076696f9d05f",style:{width:"28rpx",height:"28rpx"},onClick:k})]),e.createElementVNode("view",{class:"title"},"推荐人"),e.createElementVNode("view",{class:"input_po"},[e.createVNode(e.unref(Wp),{modelValue:a.referrer,"onUpdate:modelValue":n[6]||(n[6]=e=>a.referrer=e),placeholder:"输入推荐人",disabled:!0},null,8,["modelValue"])]),e.createElementVNode("view",{class:"title"},"手机号"),e.createElementVNode("view",{class:"input_po"},[e.createVNode(e.unref(Wp),{modelValue:a.phone,"onUpdate:modelValue":n[7]||(n[7]=e=>a.phone=e),placeholder:"输入手机号",disabled:!0},null,8,["modelValue"])]),e.createElementVNode("button",{class:"login-button",onClick:T},"完成")]),e.createElementVNode("view",{class:"footer"})])])])}}};const Zp=L({data:()=>({statusBarHeight:0}),onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{goBack(){uni.navigateBack()},goToPage(e){uni.navigateTo({url:`/pages/pagesall/mypage/${e}`})}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"list"},[e.createElementVNode("view",{class:"item",onClick:n[0]||(n[0]=e=>s.goToPage("privacy"))},[e.createElementVNode("text",null,"隐私"),e.createElementVNode("text",{class:"arrow"},"＞")]),e.createElementVNode("view",{class:"item",onClick:n[1]||(n[1]=e=>s.goToPage("changePassword"))},[e.createElementVNode("text",null,"修改密码"),e.createElementVNode("text",{class:"arrow"},"＞")]),e.createElementVNode("view",{class:"item",onClick:n[2]||(n[2]=e=>s.goToPage("changePhone"))},[e.createElementVNode("text",null,"修改手机号"),e.createElementVNode("text",{class:"arrow"},"＞")]),e.createElementVNode("view",{class:"item",onClick:n[3]||(n[3]=e=>s.goToPage("complaint"))},[e.createElementVNode("text",null,"投诉意见"),e.createElementVNode("text",{class:"arrow"},"＞")]),e.createElementVNode("view",{class:"item",onClick:n[4]||(n[4]=e=>s.goToPage("contactUs"))},[e.createElementVNode("text",null,"联系我们"),e.createElementVNode("text",{class:"arrow"},"＞")]),e.createElementVNode("view",{class:"item",onClick:n[5]||(n[5]=e=>s.goToPage("aboutUs"))},[e.createElementVNode("text",null,"关于我们"),e.createElementVNode("text",{class:"arrow"},"＞")])])])}]]);const Qp=L({data:()=>({statusBarHeight:"",oldPassword:"",newPassword:"",qrPassword:""}),onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{async submit(){try{if(""===this.oldPassword||""===this.newPassword)return void uni.showToast({title:"密码不能为空",icon:"none"});if(""===this.newPassword||""===this.qrPassword)return void uni.showToast({title:"密码不一致",icon:"none"});const e=await X({type:"oldpassword",newpassword:this.newPassword,oldpassword:this.oldPassword});I("log","at pages/pagesall/mypage/changePassword.vue:53",e),1===e.code?(uni.showToast({title:e.msg,icon:"success"}),uni.navigateBack()):uni.showToast({title:e.msg,icon:"error"})}catch(e){I("error","at pages/pagesall/mypage/changePassword.vue:70","修改密码接口失败：",e)}}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"form"},[e.withDirectives(e.createElementVNode("input",{type:"password",placeholder:"请输入旧密码",class:"input","onUpdate:modelValue":n[0]||(n[0]=e=>i.oldPassword=e)},null,512),[[e.vModelText,i.oldPassword]]),e.withDirectives(e.createElementVNode("input",{type:"password",placeholder:"请输入新密码",class:"input","onUpdate:modelValue":n[1]||(n[1]=e=>i.newPassword=e)},null,512),[[e.vModelText,i.newPassword]]),e.withDirectives(e.createElementVNode("input",{type:"password",placeholder:"请重新确认密码",class:"input","onUpdate:modelValue":n[2]||(n[2]=e=>i.qrPassword=e)},null,512),[[e.vModelText,i.qrPassword]]),e.createElementVNode("button",{class:"submit-button",onClick:n[3]||(n[3]=(...e)=>s.submit&&s.submit(...e))},"完成")])])}],["__scopeId","data-v-f16e0e61"]]);const eh=L({data:()=>({phone:"",code:"",isCodeSent:!1,countdown:60,timer:null,getCodeButtonText:"获取验证码",statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{goBack(){uni.navigateBack()},async getCode(){if(/^1[3-9]\d{9}$/.test(this.phone))try{const e=await J({mobile:this.phone,event:"changemobile"});I("log","at pages/pagesall/mypage/changePhone.vue:55",e),1===e.code?(uni.showToast({title:e.msg||"验证码发送成功",icon:"success",duration:2e3}),this.isCodeSent=!0,startCountdown()):uni.showToast({title:e.msg||"发送验证码失败，请重试",icon:"none",duration:2e3})}catch(e){}else uni.showToast({title:"手机号格式不正确",icon:"none"})},startCountdown(){this.isCodeSent=!0,this.getCodeButtonText=`${this.countdown}秒`,this.timer=setInterval((()=>{this.countdown--,this.getCodeButtonText=`${this.countdown}秒`,this.countdown<=0&&(clearInterval(this.timer),this.isCodeSent=!1,this.countdown=60,this.getCodeButtonText="获取验证码")}),1e3)},async submit(){if(!this.code)return void uni.showToast({title:"请输入验证码",icon:"none"});const e=await(t={mobile:this.phone,captcha:this.code},W("/user/changemobile",t));var t;1===e.code?(this.isCodeSent=!0,startCountdown(),uni.showToast({title:e.msg,icon:"none",duration:2e3}),uni.navigateBack()):uni.showToast({title:e.msg||"发送验证码失败，请重试",icon:"none",duration:2e3})}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"form"},[e.createElementVNode("view",{class:"input-container"},[e.withDirectives(e.createElementVNode("input",{type:"text",placeholder:"请输入新的手机号",class:"input","onUpdate:modelValue":n[0]||(n[0]=e=>i.phone=e)},null,512),[[e.vModelText,i.phone]]),e.createElementVNode("button",{class:"get-code-button",disabled:i.isCodeSent,onClick:n[1]||(n[1]=(...e)=>s.getCode&&s.getCode(...e))},e.toDisplayString(i.getCodeButtonText),9,["disabled"])]),e.withDirectives(e.createElementVNode("input",{type:"text",placeholder:"请输入验证码",class:"input","onUpdate:modelValue":n[2]||(n[2]=e=>i.code=e)},null,512),[[e.vModelText,i.code]]),e.createElementVNode("button",{class:"submit-button",onClick:n[3]||(n[3]=(...e)=>s.submit&&s.submit(...e))},"完成")])])}],["__scopeId","data-v-db4571ea"]]),th=L({__name:"complaint",setup(t){const n=e.ref();M((()=>{n.value=getApp().globalData.top}));const o=e.ref(""),a=e.ref(0),i=()=>{a.value=o.value.length},s=(e,t)=>{uni.showToast({title:e,icon:t})},r=async()=>{if(!o.value.trim())return s("请输入投诉意见","none");try{await(e={data:o.value},W("/user/feedback",e)),s("投诉意见已提交","success")}catch(t){s("提交失败，请稍后再试","none"),I("error","at pages/pagesall/mypage/complaint.vue:45","提交反馈失败:",t)}var e};return(t,s)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(n.value+5)+"px;")},null,4),e.createElementVNode("view",{class:"form"},[e.withDirectives(e.createElementVNode("textarea",{class:"textarea",placeholder:"请输入您的投诉意见","onUpdate:modelValue":s[0]||(s[0]=e=>o.value=e),onInput:i},null,544),[[e.vModelText,o.value]]),e.createElementVNode("text",{class:"char-count"},e.toDisplayString(a.value)+"/1000",1),e.createElementVNode("button",{class:"submit-button",onClick:r},"提交")])]))}},[["__scopeId","data-v-cb89c4b4"]]);const nh=L({components:{BottomSheet:Jp},data:()=>({statusBarHeight:"",isActionSheetVisible:!1,actionSheetOptions:[{text:null,imageSrc:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng508af3211aff2093c82948b6b714248f4e7c9dd737836b3b8d1449d9c81c5b12"}]}),onLoad(){this.statusBarHeight=getApp().globalData.top,this.getContactUs()},methods:{async getContactUs(){try{const e=await Y("/user/contact");I("log","at pages/pagesall/mypage/contactUs.vue:37",e),this.actionSheetOptions.text=e.tel,I("log","at pages/pagesall/mypage/contactUs.vue:39",this.actionSheetOptions.text)}catch(e){I("error","at pages/pagesall/mypage/contactUs.vue:41","获取关于我们的接口失败：",e)}},showActionSheet(){this.isActionSheetVisible=!0},handleOptionSelect(){this.makePhoneCall()},makePhoneCall(){uni.makePhoneCall({phoneNumber:"4000000000",success:()=>{I("log","at pages/pagesall/mypage/contactUs.vue:55","拨打电话成功")},fail:()=>{I("log","at pages/pagesall/mypage/contactUs.vue:58","拨打电话失败")}})}}},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("bottom-sheet");return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"content_box"},[e.createElementVNode("text",null,"客服电话"),e.createElementVNode("text",{class:"phone-number",onClick:n[0]||(n[0]=(...e)=>s.showActionSheet&&s.showActionSheet(...e))},e.toDisplayString(i.actionSheetOptions.text),1)]),e.createVNode(r,{isVisible:i.isActionSheetVisible,options:i.actionSheetOptions,fontColor:"#5791F2","onUpdate:isVisible":n[1]||(n[1]=e=>i.isActionSheetVisible=e),onOptionSelected:s.handleOptionSelect},null,8,["isVisible","options","onOptionSelected"])])}],["__scopeId","data-v-82c96e81"]]);const oh=L({data:()=>({constants:null,statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top,this.getAboutUs()},methods:{async getAboutUs(){try{const e=await Y("/user/aboutus");I("log","at pages/pagesall/mypage/aboutUs.vue:32",e),this.constants=e,I("log","at pages/pagesall/mypage/aboutUs.vue:34",this.constants)}catch(e){I("error","at pages/pagesall/mypage/aboutUs.vue:36","获取关于我们的接口失败：",e)}}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"box1"},[e.createElementVNode("image",{class:"image_2",referrerpolicy:"no-referrer",src:i.constants.downloadurl},null,8,["src"]),e.createElementVNode("text",{class:"text-group_2"},e.toDisplayString(i.constants.content),1)]),e.createElementVNode("view",{class:"box2"},[e.createElementVNode("text",{class:"text2"},"当前版本："+e.toDisplayString(i.constants.newversion),1)])])}]]),ah="/static/img/scan.png";const ih=L({components:{TUIChat1:Zd},data:()=>({classGroupListListLength:null,statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{mycode(){uni.navigateTo({url:"/pages/pagesall/home/mycode"})},goback(){uni.navigateBack()}}},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("TUIChat1");return e.openBlock(),e.createElementBlock("view",{class:"class-group"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"mess_Title"},[e.createElementVNode("view",{class:"messImg",onClick:n[0]||(n[0]=(...e)=>s.goback&&s.goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"title_text"}," 班级群 "),e.createElementVNode("view",{class:"title_img"},[e.createElementVNode("image",{style:{width:"36rpx",height:"36rpx"},src:ah,mode:"aspectFit",onClick:n[1]||(n[1]=(...e)=>s.mycode&&s.mycode(...e))}),e.createElementVNode("image",{style:{width:"36rpx",height:"36rpx"},src:nl,mode:"aspectFit",onClick:n[2]||(n[2]=(...e)=>t.btnscan&&t.btnscan(...e))}),e.createElementVNode("image",{style:{width:"36rpx",height:"36rpx"},src:ol,mode:"aspectFit"})])]),e.createElementVNode("view",{style:{padding:"0 28rpx"}},[e.createVNode(r)])])}]]);const sh=L({name:"histlist",props:{histList:{type:Array,default:[]}},data:()=>({}),onload(){},methods:{toCorr(){uni.navigateTo({url:"/pages/pagesall/mypage/correction"})}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"box-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.histList,((t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"boxlist",key:o,onClick:n[0]||(n[0]=(...e)=>s.toCorr&&s.toCorr(...e))},[e.createElementVNode("view",{class:"boxlistImg"},[e.createElementVNode("img",{src:t.img,alt:""},null,8,["src"])]),e.createElementVNode("view",{class:"boxlistText1"},e.toDisplayString(t.title),1),e.createElementVNode("view",{class:"boxlistText2"},[e.createElementVNode("text",null,e.toDisplayString(t.date?t.date:t.teacherName),1),e.createElementVNode("view",{class:"boxlistText3"},[e.createElementVNode("text",null,"评测:"),e.createElementVNode("text",{class:"boxlistText4"},e.toDisplayString(t.grade),1)])])])))),128))])}],["__scopeId","data-v-9afb1e7a"]]);const rh=L({components:{myhistList:sh},data:()=>({statusBarHeight:"",AIassessmentList:[],teacherList:[],params:{page:1,limit:4},params1:{page:1,limit:4}}),mounted(){this.getAIassessmentList()},onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{async getAIassessmentList(){try{const e=await ie(this.params),t=await oe(this.params1);I("log","at pages/pagesall/mypage/historyAssessment.vue:74",t),this.AIassessmentList=e.items.map((e=>({img:e.origin_img||"",title:e.title||"未命名",date:e.addtime||"未知日期",grade:e.result>=80?"优秀":"良好"}))),this.teacherList=t.items.map((e=>({img:e.origin_img||"",title:e.title||"未命名",date:e.addtime||"未知日期",grade:e.result>=80?"优秀":"良好"})))}catch(rn){}},hist_goback(){uni.navigateBack()},aihist(){uni.navigateTo({url:"/pages/pagesall/mypage/AIhist"})},teacherhist(){uni.navigateTo({url:"/pages/pagesall/mypage/teacherHist"})}}},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("myhistList");return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{class:"hist_Title"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"histImg",onClick:n[0]||(n[0]=(...e)=>s.hist_goback&&s.hist_goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"hist_text"}," 历史测评 ")]),e.createElementVNode("view",{class:"histbox"},[e.createElementVNode("text",{class:"box-text1"},"AI检测"),e.createElementVNode("text",{class:"box-text2",onClick:n[1]||(n[1]=(...e)=>s.aihist&&s.aihist(...e))},"更多")]),i.AIassessmentList.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,style:{height:"580rpx",overflow:"hidden"}},[e.createVNode(r,{histList:i.AIassessmentList},null,8,["histList"])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})])),e.createElementVNode("view",{class:"histbox"},[e.createElementVNode("text",{class:"box-text1"},"老师审阅"),e.createElementVNode("text",{class:"box-text2",onClick:n[2]||(n[2]=(...e)=>s.teacherhist&&s.teacherhist(...e))},"更多")]),i.teacherList.length>0?(e.openBlock(),e.createElementBlock("view",{key:2,style:{height:"580rpx",overflow:"hidden"}},[e.createVNode(r,{histList:i.teacherList},null,8,["histList"])])):(e.openBlock(),e.createElementBlock("view",{key:3,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))])}]]),ch={components:{myhistList:sh},data:()=>({statusBarHeight:"",AIhistList:[],params:{page:1,limit:10},isLoading:!1}),onLoad(){this.statusBarHeight=getApp().globalData.top,this.getAIassessmentList(),this.isLoading=!1},onPullDownRefresh(){this.getAIassessmentList(),uni.stopPullDownRefresh()},onReachBottom(){if(this.isLoading)return;this.params.page++;const e=this.AIhistList.length;this.getAIassessmentList().then((()=>{this.AIhistList.length===e?this.isLoading=!0:this.isLoading=!1})).catch((()=>{this.isLoading=!1}))},methods:{async getAIassessmentList(){try{const e=await ie(this.params);if(I("log","at pages/pagesall/mypage/AIhist.vue:79",e),e.items&&e.items.length>0){const t=e.items.map((e=>({img:e.origin_img||"",title:e.title||"未命名",date:e.addtime||"未知日期",grade:e.result>=80?"优秀":"良好"})));this.AIhistList=[...this.AIhistList,...t]}else uni.showToast({title:"没有更多数据",icon:"none",duration:2e3})}catch(rn){I("error","at pages/pagesall/mypage/AIhist.vue:101",rn)}},goback(){uni.navigateBack()}}};const lh=L(ch,[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("myhistList");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"AI_Title"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"aiImg",onClick:n[0]||(n[0]=(...e)=>s.goback&&s.goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"ai_text"}," AI历史测评 ")]),e.createElementVNode("view",{class:"aihist-box"},[e.createElementVNode("input",{type:"text",onClick:n[1]||(n[1]=(...e)=>t.searchCity&&t.searchCity(...e)),class:"aihist_input",placeholder:"请输入要查找的城市"})]),i.AIhistList.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createVNode(r,{histList:i.AIhistList},null,8,["histList"])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))],64)}]]),uh={components:{myhistList:sh},data:()=>({statusBarHeight:"",teacherhistList:[]}),onLoad(){this.statusBarHeight=getApp().globalData.top},onPullDownRefresh(){this.getAIassessmentList(),uni.stopPullDownRefresh()},onReachBottom(){if(this.isLoading)return;this.params.page++;const e=this.teacherhistList.length;this.getAIassessmentList().then((()=>{this.teacherhistList.length===e?this.isLoading=!0:this.isLoading=!1})).catch((()=>{this.isLoading=!1}))},methods:{async getAIassessmentList(){try{const e=await oe(this.params);if(I("log","at pages/pagesall/mypage/teacherHist.vue:71",e),e.items&&e.items.length>0){const t=e.items.map((e=>({img:e.origin_img||"",title:e.title||"未命名",date:e.addtime||"未知日期",grade:e.result>=80?"优秀":"良好"})));this.teacherhistList=[...this.teacherhistList,...t]}else uni.showToast({title:"没有更多数据",icon:"none",duration:2e3})}catch(rn){I("error","at pages/pagesall/mypage/teacherHist.vue:93",rn)}},teacherhist_goback(){uni.navigateBack()}}};const dh=L(uh,[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("myhistList");return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"teacher_Title"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"teacherImg",onClick:n[0]||(n[0]=(...e)=>s.teacherhist_goback&&s.teacherhist_goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"teacher_text"}," 老师历史审阅 ")]),i.teacherhistList.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createVNode(r,{histList:i.teacherhistList},null,8,["histList"])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))],64)}]]);const ph=L({data:()=>({statusBarHeight:"",temworkList:[],workList:[],isLoading:!1,params:{page:1,limit:6},params1:{page:1,limit:6}}),onPullDownRefresh(){this.loadMyTemporaryHomework(),uni.stopPullDownRefresh()},onReachBottom(){if(this.isLoading)return;this.params.page++,this.params1.page++;const e=this.temworkList.length,t=this.workList.length;this.loadMyTemporaryHomework().then((()=>{const n=this.temworkList.length,o=this.workList.length;n===e&&o===t?(this.isLoading=!0,uni.showToast({title:"没有更多数据",icon:"none",duration:2e3})):this.isLoading=!1})).catch((()=>{this.isLoading=!1}))},onLoad(){this.statusBarHeight=getApp().globalData.top,this.isLoading=!1},mounted(){this.loadMyTemporaryHomework()},methods:{goToVideoPage(e){uni.navigateTo({url:`/pages/pagesall/course/go_learn?id=${e}`})},goToVideoPage1(e){uni.navigateTo({url:`/pages/pagesall/course/go_learn?id=${e}`})},async loadMyTemporaryHomework(){try{const e=await ae(this.params),t=await oe(this.params1);if(e.items&&e.items.length>0){const t=new Set(this.temworkList.map((e=>e.id))),n=e.items.filter((e=>!t.has(e.id))).map((e=>({...e})));this.temworkList=[...this.temworkList,...n]}if(t.items&&t.items.length>0){const e=new Set(this.temworkList.map((e=>e.id))),n=t.items.filter((t=>!e.has(t.id))).map((e=>({...e})));this.workList=[...this.workList,...n]}I("log","at pages/pagesall/mypage/myHomework.vue:182","教师信息:",this.temworkList),I("log","at pages/pagesall/mypage/myHomework.vue:183","雪花酥呢个:",this.workList)}catch(e){I("error","at pages/pagesall/mypage/myHomework.vue:185","获取教学消息失败:",e)}},work_goback(){uni.navigateBack()}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"homework_Title"},[e.createElementVNode("view",{class:"homeworkImg",onClick:n[0]||(n[0]=(...e)=>s.work_goback&&s.work_goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"homework_Title_text"}," 我的作业 ")]),e.createElementVNode("view",{class:"homeworktbox"},[e.createElementVNode("text",{class:"box-text1"},"临时作业")]),i.temworkList.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("view",{class:"tem-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.temworkList,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"temlist",key:n,onClick:e=>s.goToVideoPage(t.id)},[e.createElementVNode("view",{class:"temlistImg"},[e.createElementVNode("img",{src:t.sub_image,alt:""},null,8,["src"])]),e.createElementVNode("view",{class:"temlistText1"},e.toDisplayString(t.content),1),e.createElementVNode("view",{class:"temlistText2"},[e.createElementVNode("text",null,"讲师："+e.toDisplayString(t.teacher_name),1),e.createElementVNode("text",null,e.toDisplayString((new Date(t.finish_time).getMonth()+1).toString().padStart(2,"0")+"-"+new Date(t.finish_time).getDate().toString().padStart(2,"0")),1)])],8,["onClick"])))),128))])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})])),e.createElementVNode("view",{class:"homeworktbox"},[e.createElementVNode("text",{class:"box-text1"},"近期作业")]),i.workList.length>0?(e.openBlock(),e.createElementBlock("view",{key:2},[e.createElementVNode("view",{class:"tem-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.workList,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"temlist",key:n,onClick:e=>s.goToVideoPage1(t.id)},[e.createElementVNode("view",{class:"temlistImg"},[e.createElementVNode("img",{src:t.img,alt:""},null,8,["src"])]),e.createElementVNode("view",{class:"temlistText1"},e.toDisplayString(t.title),1),e.createElementVNode("view",{class:"boxlistText3"},[e.createElementVNode("text",{class:"boxlistText4"},"优秀")]),e.createElementVNode("view",{class:"temlistText2"},[e.createElementVNode("text",null,e.toDisplayString(t.teacher),1)])],8,["onClick"])))),128))])])):(e.openBlock(),e.createElementBlock("view",{key:3,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"500rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))])}]]),hh={components:{myhistList:sh},data:()=>({statusBarHeight:"",indivimsg_heard:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/26483a4d5dc54c63ae2af524e81ebb4d_mergeImage.png",indivimsg_name:"刘易阳-田园路校区",indivimsg_id:"0000002",current:0,items:["AI检查","老师审阅"],AIhistList:[{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/fdef5ff762634f9f883ddd89c8af057a_mergeImage.png",title:"书法练习第一课",date:"2024-07-1"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/e5923dca4d594da3abf115ee5a05cf14_mergeImage.png",title:"书法练习第二课",date:"2024-07-1"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/e5923dca4d594da3abf115ee5a05cf14_mergeImage.png",title:"书法练习第三课",date:"2024-07-1"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/fdef5ff762634f9f883ddd89c8af057a_mergeImage.png",title:"书法练习第四课",date:"2024-07-1"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/fdef5ff762634f9f883ddd89c8af057a_mergeImage.png",title:"书法练习第一课",date:"2024-07-1"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/e5923dca4d594da3abf115ee5a05cf14_mergeImage.png",title:"书法练习第二课",date:"2024-07-1"}],teacherhistList:[{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/e5923dca4d594da3abf115ee5a05cf14_mergeImage.png",title:"有进步继续努力",teacherName:"王老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/fdef5ff762634f9f883ddd89c8af057a_mergeImage.png",title:"有进步继续努力",teacherName:"王老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/fdef5ff762634f9f883ddd89c8af057a_mergeImage.png",title:"有进步继续努力",teacherName:"王老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/e5923dca4d594da3abf115ee5a05cf14_mergeImage.png",title:"有进步继续努力",teacherName:"王老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/e5923dca4d594da3abf115ee5a05cf14_mergeImage.png",title:"有进步继续努力",teacherName:"王老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/fdef5ff762634f9f883ddd89c8af057a_mergeImage.png",title:"有进步继续努力",teacherName:"王老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/e5923dca4d594da3abf115ee5a05cf14_mergeImage.png",title:"有进步继续努力",teacherName:"王老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/fdef5ff762634f9f883ddd89c8af057a_mergeImage.png",title:"有进步继续努力",teacherName:"王老师"}]}),onLoad(){this.statusBarHeight=getApp().globalData.top},methods:{ind_goback(){uni.navigateBack()},onClickItem(e){this.current!==e.currentIndex&&(this.current=e.currentIndex)}}};const gh=L(hh,[["render",function(t,n,o,a,i,s){const r=E(e.resolveDynamicComponent("uni-segmented-control"),Rl),c=e.resolveComponent("uni-section"),l=e.resolveComponent("myhistList");return e.openBlock(),e.createElementBlock("view",{class:"indmsg"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"msg_Title"},[e.createElementVNode("view",{class:"msgImg",onClick:n[0]||(n[0]=(...e)=>s.ind_goback&&s.ind_goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"msg_text"}," 刘易阳信息 ")]),e.createElementVNode("view",{class:"bg_left"}),e.createElementVNode("view",{class:"bg_right"}),e.createElementVNode("view",{class:"bg_center"}),e.createElementVNode("view",{class:"indivimsg_name"},[e.createElementVNode("img",{src:i.indivimsg_heard,alt:""},null,8,["src"]),e.createElementVNode("view",{class:"msg_text1",style:{"margin-top":"8rpx"}},e.toDisplayString(i.indivimsg_name),1),e.createElementVNode("view",{class:"msg_text2",style:{"margin-top":"8rpx"}}," ID:"+e.toDisplayString(i.indivimsg_id),1),e.createElementVNode("view",{class:"textflex"},[e.createElementVNode("view",{class:"msgtext3"}," 书法一班 "),e.createElementVNode("view",{class:"msgtext4"}," 11岁 ")])]),e.createElementVNode("view",{class:"worksmsg"},[e.createVNode(c,{title:"实心标签",type:"line"},{default:e.withCtx((()=>[e.createElementVNode("view",{class:"uni-padding-wrap uni-common-mt"},[e.createVNode(r,{class:"uni_center",style:{"border-bottom":"0.5rpx solid #EEEEEE"},current:i.current,values:i.items,"active-color":"#5791F2",styleType:"text",onClickItem:s.onClickItem},null,8,["current","values","onClickItem"]),0===i.current?(e.openBlock(),e.createElementBlock("view",{key:0,class:"indi_oper"})):e.createCommentVNode("",!0),1===i.current?(e.openBlock(),e.createElementBlock("view",{key:1,class:"indi_oper1"})):e.createCommentVNode("",!0)])])),_:1}),0===i.current?(e.openBlock(),e.createElementBlock("view",{key:0,class:"AIlist"},[e.createVNode(l,{histList:i.AIhistList},null,8,["histList"])])):e.createCommentVNode("",!0),0!==i.current?(e.openBlock(),e.createElementBlock("view",{key:1,class:"AIlist"},[e.createVNode(l,{histList:i.teacherhistList},null,8,["histList"])])):e.createCommentVNode("",!0)])])}]]);const mh=L({data:()=>({corrlist:4,limit:5,page:1,statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top,this.getMyHistoryHomework()},methods:{async getMyHistoryHomework(){try{const e=await oe({limit:this.limit,page:this.page});I("log","at pages/pagesall/mypage/correction.vue:71",e),this.corrlist=e.items,I("log","at pages/pagesall/mypage/correction.vue:73",this.corrlist)}catch(e){I("error","at pages/pagesall/mypage/correction.vue:75","获取关于我们的接口失败：",e)}},corr_goback(){uni.navigateBack()}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"corr_Title"},[e.createElementVNode("view",{class:"corrImg",onClick:n[0]||(n[0]=(...e)=>s.corr_goback&&s.corr_goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"corr_text"}," 批改作业 ")]),e.createElementVNode("view",{class:"corr-banner"}),i.corrlist.length>0?(e.openBlock(),e.createElementBlock("view",{key:0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.corrlist,(t=>(e.openBlock(),e.createElementBlock("view",{class:"corr-work",key:t},[e.createElementVNode("view",{class:"box_3 flex-col"},[e.createElementVNode("view",{class:"section_2 flex-col"},[e.createElementVNode("image",{class:"image_2",referrerpolicy:"no-referrer",src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPnga8bdcdc42cb8abff5e083a6b06d4babd504f55028e66bd740598ca6e4c215f63"}),e.createElementVNode("view",{class:"section_3 flex-col justify-center"},[e.createElementVNode("view",{class:"box_4 flex-col"},[e.createElementVNode("text",{class:"text_4"},"飞"),e.createElementVNode("image",{class:"image_3",referrerpolicy:"no-referrer",src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng6cc8f7834ef7b5d3491c2d4dd44cb93fc443519c40d959f937e54216c0d0b745"})])])])]),e.createElementVNode("view",{class:"worktext"},[e.createElementVNode("view",null,[e.createElementVNode("text",{class:"workText3"},"评测:"),e.createElementVNode("text",{class:"workText4"},"优秀")]),e.createElementVNode("view",{class:"workinput"},[e.createElementVNode("view",{style:{"font-size":"20rpx"}},"请输入评语"),e.createElementVNode("view",{style:{"font-size":"20rpx",width:"466rpx","text-align":"right"}},"0/30")])])])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"800rpx"}},[e.createElementVNode("image",{style:{width:"400rpx",height:"400rpx"},src:al,mode:"aspectFit"})]))])}]]);const fh=L({components:{msglist:L({name:"histlist",props:{msgList:{type:Array,default:[]}},data:()=>({})},[["render",function(t,n,o,a,i,s){return e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.msgList,((o,a)=>(e.openBlock(),e.createElementBlock("view",{class:"classList",key:a},[e.createElementVNode("view",{class:"classbox",onClick:n[0]||(n[0]=(...e)=>t.classgoback&&t.classgoback(...e))},[e.createElementVNode("view",{class:"classbox2"},[e.createElementVNode("view",{class:"classbox_img"},[e.createElementVNode("img",{src:o.head,alt:""},null,8,["src"])]),e.createElementVNode("view",{class:"classinter"},[e.createElementVNode("view",{class:"class_text1"},[e.createElementVNode("text",{class:"text-classname"},e.toDisplayString(o.teacher_name),1),e.createElementVNode("text",{class:"text-hours"},"6-15")]),e.createElementVNode("view",{class:"class_text2"},e.toDisplayString(o.massage),1)])])])])))),128)}],["__scopeId","data-v-b28fb22b"]]),TUIChat:Wd},data:()=>({statusBarHeight:"",myteacher_List:[],teacherListLength:null}),onLoad(){this.statusBarHeight=getApp().globalData.top},mounted(){this.loadTeacherMessages()},methods:{btnsearch(){uni.navigateTo({url:"/pages/pagesall/home/search"})},mycode(){uni.navigateTo({url:"/pages/pagesall/home/mycode"})},btnscan(){uni.scanCode({success:e=>{I("log","at pages/pagesall/mypage/teachermsg.vue:99","条码类型："+e.scanType),I("log","at pages/pagesall/mypage/teachermsg.vue:100","条码内容："+e.result)},fail:e=>{uni.showToast({title:e.errMsg||"扫码失败",icon:"none",duration:2e3})}})},async loadTeacherMessages(){try{const t=await Y("/user/myteachers",e);this.myteacher_List=t.items||[],I("log","at pages/pagesall/mypage/teachermsg.vue:116","教师信息:",this.myteacher_List)}catch(t){I("error","at pages/pagesall/mypage/teachermsg.vue:118","获取教学消息失败:",t)}var e},teacher_goback(){uni.navigateBack()}}},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("TUIChat");return e.openBlock(),e.createElementBlock("view",null,[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"mess_Title"},[e.createElementVNode("view",{class:"messImg",onClick:n[0]||(n[0]=(...e)=>s.teacher_goback&&s.teacher_goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"title_text"}," 我的老师 "),e.createElementVNode("view",{class:"title_img"},[e.createElementVNode("image",{style:{width:"36rpx",height:"36rpx"},src:ah,mode:"aspectFit",onClick:n[1]||(n[1]=(...e)=>s.mycode&&s.mycode(...e))}),e.createElementVNode("image",{style:{width:"36rpx",height:"36rpx"},src:nl,mode:"aspectFit",onClick:n[2]||(n[2]=(...e)=>s.btnscan&&s.btnscan(...e))}),e.createElementVNode("image",{style:{width:"36rpx",height:"36rpx"},src:ol,mode:"aspectFit",onClick:n[3]||(n[3]=(...e)=>s.btnsearch&&s.btnsearch(...e))})])]),e.createElementVNode("view",{style:{padding:"28rpx"},class:"container"},[e.createVNode(r)])])}]]),vh=e.defineComponent({__name:"index",props:["isGroup"],emits:["openGroupManagement"],setup(t,{emit:n}){const o=n,a=t,i=e.ref(),s=e.ref(!1);N((()=>{a.isGroup&&o("openGroupManagement")}));const r=getCurrentPages(),c=r[r.length-1].$getAppWebview();a.isGroup||c.setStyle({titleNView:{...c.getStyle().titleNView,buttons:[]}});const l=e=>{null==Fl||Fl.setNavigationBarTitle({title:e||"云通信 IM"})};function u(e){var t;i.value=e,s.value||l(null==(t=null==i?void 0:i.value)?void 0:t.getShowName())}function d(e){var t;s.value=e,s.value?l(Tr.t("TUIChat.对方正在输入")):l(null==(t=i.value)?void 0:t.getShowName())}return e.onMounted((()=>{kr.watch(oi.CONV,{currentConversation:u}),kr.watch(oi.CHAT,{typingStatus:d})})),e.onUnmounted((()=>{kr.unwatch(oi.CONV,{currentConversation:u}),kr.unwatch(oi.CHAT,{typingStatus:d})})),M((()=>{var e;l(null==(e=i.value)?void 0:e.getShowName())})),(t,n)=>(e.openBlock(),e.createElementBlock("view",{style:{display:"none"}}))}}),_h={product:{label:"产品文档",url:"https://cloud.tencent.com/document/product/269/1499#.E7.BE.A4.E7.BB.84.E5.8A.9F.E8.83.BD"},customMessage:{label:"自定义消息",url:"https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#createCustomMessage"},complaint:{label:"点此投诉",url:"https://cloud.tencent.com/apply/p/xc3oaubi98g"},implement:{label:"集成TUICallKit",url:"https://cloud.tencent.com/document/product/269/79861"},purchase:{label:"开通腾讯实时音视频服务",url:"https://cloud.tencent.com/document/product/1640/79968"}},yh=L(e.defineComponent({__name:"message-container",props:{sender:{default:""},avatar:{default:""},type:{},time:{}},setup(t){const n=t,o=Cr.TYPES,a=e.computed((()=>[o.MSG_IMAGE,o.MSG_VIDEO,o.MSG_MERGER].includes(n.type)));return(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:"simple-message-container"},[e.createElementVNode("div",{class:"simple-message-avatar"},[e.createVNode(Pd,{url:n.avatar},null,8,["url"])]),e.createElementVNode("div",null,[e.createElementVNode("div",{class:"simple-message-sender"},e.toDisplayString(n.sender),1),e.createElementVNode("div",{class:"simple-message-body"},[e.createElementVNode("div",{class:e.normalizeClass({"simple-message-content":!0,"no-padding":a.value})},[e.renderSlot(t.$slots,"default",{},void 0,!0)],2),e.createElementVNode("div",{class:"timestamp"},e.toDisplayString(e.unref(Tp)(1e3*n.time)),1)])])]))}}),[["__scopeId","data-v-70e99dda"]]),Ih=e.defineComponent({__name:"index",props:{visible:{type:Boolean,default:!0},popDirection:{default:"bottom"},useMask:{type:Boolean,default:!0},isFullScreen:{type:Boolean,default:!0},overlayColor:{},drawerStyle:{default:()=>({})}},emits:["onOverlayClick"],setup(t,{expose:n,emit:o}){var a;const i=o,s=t,r=e.ref(),c=e.ref(),l=e.ref(!1),u=e.ref(s.drawerStyle[s.popDirection]||{});function d(e){i("onOverlayClick",e)}return e.watch((()=>s.visible),(e=>{e?l.value=!0:setTimeout((()=>{l.value=!1}),150)}),{immediate:!0}),n({drawerDomRef:r,overlayDomRef:null==(a=c.value)?void 0:a.overlayDomRef}),(t,n)=>(e.openBlock(),e.createBlock(Gd,{ref_key:"overlayDomInstanceRef",ref:c,visible:s.visible,useMask:s.useMask,maskColor:s.overlayColor,isFullScreen:s.isFullScreen,onOnOverlayClick:d},{default:e.withCtx((()=>[l.value?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"drawerDomRef",ref:r,class:e.normalizeClass({drawer:!0,"origin-bottom":"bottom"===s.popDirection,"origin-right":"right"===s.popDirection,"slide-bottom":t.visible&&"bottom"===s.popDirection,"slide-right":t.visible&&"right"===s.popDirection}),style:e.normalizeStyle({minHeight:u.value.minHeight,maxHeight:u.value.maxHeight,borderRadius:u.value.borderRadius,boxShadow:u.value.boxShadow,width:u.value.width})},[e.createElementVNode("div",{class:"drawer-container"},[e.renderSlot(t.$slots,"default",{},void 0,!0)])],6)):e.createCommentVNode("",!0)])),_:3},8,["visible","useMask","maskColor","isFullScreen"]))}}),Eh=L(Ih,[["__scopeId","data-v-cebc97f8"]]),Ch=L(e.defineComponent({__name:"index",props:{renderData:{},disabled:{type:Boolean,default:!1},messageItem:{default:()=>({})}},emits:["assignMessageIDInUniapp"],setup(t,{emit:n}){const o=n,a=t,i=e.ref(!1);function s(){a.disabled||(lu?o("assignMessageIDInUniapp",a.messageItem.ID):i.value=!0)}function r(){i.value=!1}return(t,n)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",{class:"message-record-container",onClick:s},[e.createElementVNode("div",{class:"record-title"},e.toDisplayString(a.renderData.title),1),e.createElementVNode("div",{class:"record-abstract-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.renderData.abstractList.slice(0,7),((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n,class:"record-abstract-item"},e.toDisplayString(e.unref(od)(t)),1)))),128))]),e.createElementVNode("div",{class:"record-footer"},e.toDisplayString(e.unref(Tr).t("TUIChat.聊天记录")),1)]),!a.disabled&&e.unref(iu)?(e.openBlock(),e.createBlock(Gd,{key:0,visible:i.value,onOnOverlayClick:n[0]||(n[0]=e=>i.value=!1)},{default:e.withCtx((()=>[e.createVNode(Th,{isMounted:i.value,renderData:a.renderData,messageID:a.messageItem.ID,onCloseOverlay:r},null,8,["isMounted","renderData","messageID"])])),_:1},8,["visible"])):a.disabled||!e.unref(su)||e.unref(lu)?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(Eh,{key:1,visible:i.value,isFullScreen:!0,overlayColor:"transparent",popDirection:"right"},{default:e.withCtx((()=>[e.createVNode(Th,{isMounted:i.value,renderData:a.renderData,messageID:a.messageItem.ID,onCloseOverlay:r},null,8,["isMounted","renderData","messageID"])])),_:1},8,["visible"]))]))}}),[["__scopeId","data-v-13fc1f14"]]),kh=e.defineComponent({__name:"index",props:{messageID:{default:""},isMounted:{type:Boolean,default:!1}},emits:["closeOverlay"],setup(t,{emit:n}){const o=n,a=t,i=Cr.TYPES,s=e.ref(!1),r=e.ref([]),c=e.ref({title:"",messageList:[]}),l=e.ref();e.watch((()=>r.value.length),(async e=>{if(s.value=!1,e<1)return;const t=r.value[r.value.length-1];if(t.downloadKey&&0===t.messageList.length)try{const e=await Dr.downloadMergedMessages({payload:t,type:Cr.TYPES.MSG_MERGER});r.value[r.value.length-1]=e.payload}catch(n){s.value=!0}c.value=r.value[r.value.length-1]})),e.watch((()=>a.isMounted),(e=>{if(e){if(!a.messageID)throw new Error("messageID is required when first render of simple-message-list.");const e=kr.getMessageModel(a.messageID).getMessage().payload;r.value=[e]}else r.value=[]}),{immediate:!0});const u=e.computed((()=>r.value.length>1)),d=e.computed((()=>{var e;return!!(null==(e=c.value)?void 0:e.messageList)&&c.value.messageList.length>0}));function p(){r.value.pop(),r.value.length<1&&o("closeOverlay")}function h(e){let t="";return e.indexOf("@custom")>-1?t=""+e:(t=Ju+e,-1===t.indexOf("@2x")?t+="@2x.png":t+=".png"),t}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"simple-message-list-container":!0,"simple-message-list-container-mobile":e.unref(uu)})},[e.createElementVNode("div",{class:"header-container"},[e.createElementVNode("span",{class:"back",onClick:p},[e.createVNode(pu,{class:"close-icon",file:e.unref(tp),size:"18px"},null,8,["file"]),u.value?(e.openBlock(),e.createElementBlock("span",{key:0},e.toDisplayString(e.unref(Tr).t("TUIChat.返回")),1)):(e.openBlock(),e.createElementBlock("span",{key:1},e.toDisplayString(e.unref(Tr).t("TUIChat.关闭")),1))]),e.createElementVNode("span",{class:"title"},e.toDisplayString(c.value.title),1)]),s.value?(e.openBlock(),e.createElementBlock("div",{key:0}," Load Merge Message Error ")):d.value?(e.openBlock(),e.createElementBlock("div",{key:1,ref_key:"simpleMessageListRef",ref:l,class:"message-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value.messageList,(t=>(e.openBlock(),e.createElementBlock("div",{key:t.ID,class:e.normalizeClass({"message-item":!0})},[e.createVNode(yh,{sender:t.nick,avatar:t.avatar,type:t.messageBody[0].type,time:t.time},{default:e.withCtx((()=>[t.messageBody[0].type===e.unref(i).MSG_TEXT?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-text"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(ad)(t.messageBody[0].payload.text),((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n,class:"message-text-container"},["text"===t.type?(e.openBlock(),e.createElementBlock("span",{key:0,class:"text"},e.toDisplayString(t.content),1)):(e.openBlock(),e.createElementBlock("img",{key:1,class:"simple-emoji",src:t.content,alt:"small-face"},null,8,["src"]))])))),128))])):t.messageBody[0].type===e.unref(i).MSG_IMAGE?(e.openBlock(),e.createElementBlock("div",{key:1,class:"message-image"},[e.createElementVNode("img",{class:"image",src:t.messageBody[0].payload.imageInfoArray[2].url,mode:"widthFix",alt:"image"},null,8,["src"])])):t.messageBody[0].type===e.unref(i).MSG_VIDEO?(e.openBlock(),e.createElementBlock("div",{key:2,class:"message-video"},[e.unref(lu)?(e.openBlock(),e.createElementBlock("div",{key:0,onClick:e=>function(e){if(lu){const t=encodeURIComponent(e);uni.navigateTo({url:`/TUIKit/components/TUIChat/video-play?videoUrl=${t}`})}}(t.messageBody[0].payload.remoteVideoUrl)},[e.createElementVNode("image",{class:"image",src:t.messageBody[0].payload.thumbUrl,mode:"widthFix",alt:"image"},null,8,["src"]),e.createVNode(pu,{class:"video-play-icon",file:e.unref(hd)},null,8,["file"])],8,["onClick"])):(e.openBlock(),e.createElementBlock("video",{key:1,class:"video",controls:"",poster:t.messageBody[0].payload.thumbUrl},[e.createElementVNode("source",{src:t.messageBody[0].payload.remoteVideoUrl,type:"video/mp4"},null,8,["src"])],8,["poster"]))])):t.messageBody[0].type===e.unref(i).MSG_AUDIO?(e.openBlock(),e.createElementBlock("div",{key:3,class:"message-audio"},[e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t("TUIChat.语音"))+" ",1),e.createElementVNode("span",null,e.toDisplayString(t.messageBody[0].payload.second)+"s",1)])):t.messageBody[0].type===e.unref(i).MSG_FACE?(e.openBlock(),e.createElementBlock("div",{key:4,class:"message-face"},[e.createElementVNode("img",{class:"image",src:h(t.messageBody[0].payload.data),alt:"face"},null,8,["src"])])):t.messageBody[0].type===e.unref(i).MSG_FILE?(e.openBlock(),e.createElementBlock("div",{key:5,class:"message-file"},e.toDisplayString(e.unref(Tr).t("TUIChat.[文件]")),1)):t.messageBody[0].type===e.unref(i).MSG_LOCATION?(e.openBlock(),e.createElementBlock("div",{key:6},e.toDisplayString(e.unref(Tr).t("TUIChat.[地理位置]")),1)):t.messageBody[0].type===e.unref(i).MSG_MERGER?(e.openBlock(),e.createElementBlock("div",{key:7,class:"message-merger",onClickCapture:e=>function(e,t){r.value.push(t.messageBody[0].payload),e.stopPropagation()}(e,t)},[e.createVNode(Ch,{disabled:"",renderData:t.messageBody[0].payload},null,8,["renderData"])],40,["onClickCapture"])):t.messageBody[0].type===e.unref(i).MSG_CUSTOM?(e.openBlock(),e.createElementBlock("div",{key:8},e.toDisplayString(e.unref(Tr).t("TUIChat.[自定义消息]")),1)):e.createCommentVNode("",!0)])),_:2},1032,["sender","avatar","type","time"])])))),128))],512)):e.createCommentVNode("",!0)],2))}}),Th=L(kh,[["__scopeId","data-v-ea2dfc9f"]]),Mh=L(e.defineComponent({__name:"index",props:{groupID:{default:""}},setup(t){const n=t,o=e.ref(),a=e.ref(0),i=e.ref(!1),s=e.ref([]);async function r(){return(await br.getGroupApplicationList()).data.applicationList.filter((e=>e.groupID===n.groupID))}function c(){i.value=!i.value}async function l(){const e=await r();if(0===e.length)return[];const t=e.map((e=>0===e.applicationType?e.applicant:e.userID)),{data:n}=await Sr.getUserProfile({userIDList:t}),o={};n.forEach((e=>{o[e.userID]=e}));return e.map((e=>{const t=o[0===e.applicationType?e.applicant:e.userID];return{nick:t.nick||t.userID||"anonymous",avatar:t.avatar||"",isRemoved:!1,application:e}}))}function u(e,t,n){br.handleGroupApplication({handleAction:t,application:e.application}).then((()=>{s.value[n].isRemoved=!0,setTimeout((()=>{s.value.splice(n,1),a.value-=1}),150)})).catch((()=>{}))}function d(){l().then((e=>{s.value=e,a.value=e.length}))}return e.watch(i,(e=>{e&&l().then((e=>{s.value=e,a.value=e.length}))})),e.watch((()=>s.value.length),((e,t)=>{t>0&&0===e&&(i.value=!1)})),e.onMounted((()=>{r().then((e=>{a.value=e.length})),kr.watch(oi.GRP,{groupSystemNoticeList:d})})),e.onUnmounted((()=>{kr.unwatch(oi.GRP,{groupSystemNoticeList:d})})),(t,n)=>(e.openBlock(),e.createElementBlock("div",null,[a.value>0?(e.openBlock(),e.createElementBlock("div",{key:0,class:"application-tips"},[e.createElementVNode("div",null,e.toDisplayString(a.value)+e.toDisplayString(e.unref(Tr).t("TUIChat.条入群申请")),1),e.createElementVNode("div",{class:"application-tips-btn",onClick:c},e.toDisplayString(e.unref(Tr).t("TUIChat.点击处理")),1)])):e.createCommentVNode("",!0),e.createVNode(Eh,{ref_key:"drawerDomInstanceRef",ref:o,visible:i.value,zIndex:998,popDirection:e.unref(uu)?"bottom":"right",isFullScreen:e.unref(uu),overlayColor:e.unref(uu)?void 0:"transparent",drawerStyle:{bottom:{minHeight:"60vh",maxHeight:"80vh",borderRadius:"12px 12px 0 0"},right:{width:"360px",borderRadius:"12px 0 0 12px",boxShadow:"0 0 10px 0 #d0d0d0"}},onOnOverlayClick:c},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass({"application-contaienr":!0})},[e.createElementVNode("header",{class:"application-header"},[e.createElementVNode("div",{onClick:c},[e.unref(iu)?(e.openBlock(),e.createBlock(pu,{key:0,file:e.unref(xu),size:"16px"},null,8,["file"])):(e.openBlock(),e.createElementBlock("div",{key:1},e.toDisplayString(e.unref(Tr).t("关闭")),1))])]),e.createElementVNode("main",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:t.nick,class:e.normalizeClass({"application-item":!0,removed:t.isRemoved})},[e.createVNode(Pd,{style:{flex:"0 0 auto"},url:t.avatar,useSkeletonAnimation:!0},null,8,["url"]),e.createElementVNode("div",{class:"application-item-info"},[e.createElementVNode("div",{class:"application-item-nick"},e.toDisplayString(t.nick),1),e.createElementVNode("div",{class:"application-item-note"},e.toDisplayString(e.unref(Tr).t("TUIChat.申请加入")),1)]),e.createElementVNode("div",{class:"application-item-operation"},[e.createElementVNode("div",{class:"agree",onClick:e=>u(t,"Agree",n)},e.toDisplayString(e.unref(Tr).t("TUIChat.同意")),9,["onClick"]),e.createElementVNode("div",{class:"reject",onClick:e=>u(t,"Reject",n)},e.toDisplayString(e.unref(Tr).t("TUIChat.拒绝")),9,["onClick"])])],2)))),128))])])])),_:1},8,["visible","popDirection","isFullScreen","overlayColor"])]))}}),[["__scopeId","data-v-c06db7e1"]]),Sh=L(e.defineComponent({__name:"message-text",props:{content:{default:()=>({})}},setup(t){const n=t,o=e.ref();return e.watchEffect((()=>{var e;o.value=n.content,null==(e=o.value.text)||e.forEach((e=>{"img"===e.name&&"custom"===(null==e?void 0:e.type)&&I("warn","at TUIKit/components/TUIChat/message-list/message-elements/message-text.vue:26","CUSTOM_BASIC_EMOJI_URL is required for custom emoji, please check your CUSTOM_BASIC_EMOJI_URL.")}))})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-text-container",e.unref(iu)&&"text-select"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value.text,((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n},["text"===t.name?(e.openBlock(),e.createElementBlock("span",{key:0,class:"text"},e.toDisplayString(t.text),1)):(e.openBlock(),e.createElementBlock("img",{key:1,class:"emoji",src:t.src,alt:t.emojiKey},null,8,["src","alt"]))])))),128))],2))}}),[["__scopeId","data-v-8181776b"]]),Dh=155,bh=L(e.defineComponent({__name:"message-image",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},emits:["previewImage"],setup(t,{emit:n}){const o=n,a=t,i=e.ref({width:"auto",height:"auto"}),s=e=>{const{width:t,height:n}=e;if(0===t||0===n)return;let o=0,a=0;t>=n?(o=Dh,a=Dh*n/t):(o=Dh*t/n,a=Dh),i.value.width=o+"px",i.value.height=a+"px"};e.watchEffect((()=>{s(a.content)}));const r=e=>{s(e.detail)},c=()=>{var e;"success"!==(null==(e=a.messageItem)?void 0:e.status)&&1!==a.messageItem.progress||o("previewImage")};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"image-container",onClick:c},[e.createElementVNode("image",{class:"message-image",mode:"aspectFit",src:a.content.url,style:e.normalizeStyle({width:i.value.width,height:i.value.height}),onLoad:r},null,44,["src"])]))}}),[["__scopeId","data-v-ef5e6871"]]),wh=L(e.defineComponent({__name:"message-audio",props:{broadcastNewAudioSrc:{},messageItem:{default:()=>({})},content:{default:()=>({})}},emits:["getGlobalAudioContext","setAudioPlayed"],setup(t,{emit:n}){const o=n,a=t,i=new Map,s=e.ref(!1);function r(){if(o("getGlobalAudioContext",i,{newAudioSrc:a.content.url}),a.messageItem.hasRiskContent||!a.content.url)return void yd({message:"暂不支持播放"});h()||(i.set("audio",uni.createInnerAudioContext()),function(){const e=h();if(!e)return;e.src=a.content.url,s.value=!1,e.onPlay(l),e.onStop(u),e.onEnded(d),e.onError(p)}()),s.value?c():function(){const e=h();e&&(e.play(),"in"===a.messageItem.flow&&o("setAudioPlayed",a.messageItem.ID))}()}function c(){const e=h();if(e)try{e.stop()}catch{}}function l(){s.value=!0}function u(){s.value=!1}function d(){s.value=!1}function p(){I("warn","at TUIKit/components/TUIChat/message-list/message-elements/message-audio.vue:145","audio played error")}function h(){return i.get("audio")}return e.onUnmounted((()=>{var e;const t=h();s.value&&c(),null==(e=null==t?void 0:t.destroy)||e.call(t),i.delete("audio")})),e.watch((()=>a.broadcastNewAudioSrc),(e=>{e!==a.content.url&&s.value&&(c(),s.value=!1)})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"message-audio":!0,reserve:"out"===a.messageItem.flow}),onClick:r},[e.createElementVNode("div",{class:"audio-icon-container"},[e.createElementVNode("div",{class:e.normalizeClass({mask:!0,play:s.value})},null,2),e.createVNode(pu,{class:"icon",width:"15px",height:"20px",file:e.unref("/assets/msg-audio.ac2cd1c9.svg")},null,8,["file"])]),e.createElementVNode("div",{class:"time",style:e.normalizeStyle({width:5*a.content.second+"px"})},e.toDisplayString(a.content.second||1)+' " ',5)],2))}}),[["__scopeId","data-v-800dee2a"]]),Nh=L(e.defineComponent({__name:"message-file",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},setup(t){const n=t,o=()=>{if(n.messageItem.hasRiskContent)return;const e={mode:"cors",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})};if(null==window?void 0:window.fetch)fetch(n.content.url,e).then((e=>e.blob())).then((e=>{const t=document.createElement("a"),o=window.URL.createObjectURL(e);t.href=o,t.download=n.content.name,t.click()}));else{const e=document.createElement("a");e.href=n.content.url,e.target="_blank",e.download=n.content.name,e.click()}};return(t,a)=>(e.openBlock(),e.createElementBlock("div",{class:"file-message-montainer",title:e.unref(Tr).t("TUIChat.单击下载"),onClick:o},[e.createVNode(pu,{file:e.unref("/assets/file-light.7beeea9d.svg"),class:"file-icon"},null,8,["file"]),e.createElementVNode("div",null,[e.createElementVNode("div",null,e.toDisplayString(n.content.name),1),e.createElementVNode("div",null,e.toDisplayString(n.content.size),1)])],8,["title"]))}}),[["__scopeId","data-v-546504fc"]]),Lh=L(e.defineComponent({__name:"message-face",props:{content:{type:Object,default:()=>({})}},setup(t){const n=t,o=e.ref(n.content.url);return e.onMounted((()=>{"custom"===n.content.type&&I("warn","at TUIKit/components/TUIChat/message-list/message-elements/message-face.vue:23","CUSTOM_BIG_EMOJI_URL is required for custom emoji, please check your CUSTOM_BIG_EMOJI_URL.")})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"message-image"},[e.createElementVNode("img",{mode:"aspectFit",class:"message-image",src:o.value},null,8,["src"])]))}}),[["__scopeId","data-v-75f4a2f8"]]),Rh=L(e.defineComponent({__name:"message-custom",props:{messageItem:{default:void 0},content:{default:void 0}},setup(t){const n=t,o=e.ref(),a=e.ref(),i=e.ref(),s=e.ref({businessID:""});e.watchEffect((()=>{o.value=n.content,a.value=n.messageItem;const{payload:e}=n.messageItem;s.value=e.data||"",s.value=ld(e.data),e.data===zu.SERVICE&&(i.value=ld(e.extension))}));return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"custom"},[s.value.businessID===e.unref(zu).SERVICE?(e.openBlock(),e.createElementBlock("div",{key:0},[e.createElementVNode("h1",null,[e.createElementVNode("label",null,e.toDisplayString(i.value.title),1),i.value.hyperlinks_text?(e.openBlock(),e.createElementBlock("a",{key:0,href:i.value.hyperlinks_text.value,target:"view_window"},e.toDisplayString(i.value.hyperlinks_text.key),9,["href"])):e.createCommentVNode("",!0)]),i.value.item&&i.value.item.length>0?(e.openBlock(),e.createElementBlock("ul",{key:0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value.item,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n},[e.unref(cd)(t.value)?(e.openBlock(),e.createElementBlock("a",{key:0,href:t.value,target:"view_window"},e.toDisplayString(t.key),9,["href"])):(e.openBlock(),e.createElementBlock("p",{key:1},e.toDisplayString(t.key),1))])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("article",null,e.toDisplayString(i.value.description),1)])):s.value.businessID===e.unref(zu).EVALUATE?(e.openBlock(),e.createElementBlock("div",{key:1,class:"evaluate"},[e.createElementVNode("h1",null,e.toDisplayString(e.unref(Tr).t("message.custom.对本次服务评价")),1),e.createElementVNode("ul",{class:"evaluate-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Math.max(s.value.score,0),((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"evaluate-list-item"},[e.createVNode(pu,{file:e.unref(ud),class:"file-icon"},null,8,["file"])])))),128))]),e.createElementVNode("article",null,e.toDisplayString(s.value.comment),1)])):s.value.businessID===e.unref(zu).ORDER?(e.openBlock(),e.createElementBlock("div",{key:2,class:"order",onClick:n[0]||(n[0]=e=>{return t=s.value.link,void window.open(t);var t})},[e.createElementVNode("img",{src:s.value.imageUrl},null,8,["src"]),e.createElementVNode("main",null,[e.createElementVNode("h1",null,e.toDisplayString(s.value.title),1),e.createElementVNode("p",null,e.toDisplayString(s.value.description),1),e.createElementVNode("span",null,e.toDisplayString(s.value.price),1)])])):s.value.businessID===e.unref(zu).LINK?(e.openBlock(),e.createElementBlock("div",{key:3,class:"textLink"},[e.createElementVNode("p",null,e.toDisplayString(s.value.text),1),e.createElementVNode("a",{href:s.value.link,target:"view_window"},e.toDisplayString(e.unref(Tr).t("message.custom.查看详情>>")),9,["href"])])):(e.openBlock(),e.createElementBlock("span",{key:4,innerHTML:t.content.custom},null,8,["innerHTML"]))]))}}),[["__scopeId","data-v-fd59a0c5"]]),Ah=L(e.defineComponent({__name:"message-tip",props:{content:{type:Object,default:()=>({})}},setup(t){const n=t,o=e.computed((()=>{var e,t;return(null==(e=n.content)?void 0:e.text)||(null==(t=n.content)?void 0:t.custom)||""}));return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"message-tip"},[e.createElementVNode("span",null,e.toDisplayString(o.value),1)]))}}),[["__scopeId","data-v-7bba1dea"]]);class Oh{constructor(){this.chatType="",this.features={DownloadFile:!0,CopyMessage:!0,DeleteMessage:!0,RevokeMessage:!0,QuoteMessage:!0,ForwardMessage:!0,TranslateMessage:!0,VoiceToText:!0,MultiSelection:!0,EmojiReaction:!0,InputEmoji:!0,InputStickers:!0,InputImage:!0,InputVoice:!0,InputVideo:!0,InputFile:!0,InputEvaluation:!0,InputQuickReplies:!0,InputMention:!0,MessageSearch:!0,ReadStatus:!0},this.theme="light"}static getInstance(){return Oh.instance||(Oh.instance=new Oh),Oh.instance}setChatType(e){this.chatType=e}getChatType(){return this.chatType}hideTUIChatFeatures(e){e&&e.forEach((e=>{this.features[e]&&(this.features[e]=!1)}))}getFeatureConfig(e){return e?this.features[e]:this.features}setTheme(e){this.theme=e}getTheme(){return this.theme}}const Uh=Oh.getInstance();Uh.hideTUIChatFeatures.bind(Uh);const Ph=L(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},emits:["openReadUserPanel"],setup(t,{emit:n}){const o=n,a=t,i=Uh.getFeatureConfig("ReadStatus"),s=Cr.TYPES,r=e.ref(kr.getData(oi.USER,"displayMessageReadReceipt"));e.onMounted((()=>{kr.watch(oi.USER,{displayMessageReadReceipt:g})})),e.onUnmounted((()=>{kr.unwatch(oi.USER,{displayMessageReadReceipt:g})}));const c=e.computed((()=>{if(!i)return!1;if(!r.value)return!1;const{ID:e,type:t,flow:n,status:o,hasRiskContent:c,conversationID:l,conversationType:u,needReadReceipt:d=!1}=a.message;if(c)return!1;const{groupProfile:p}=kr.getConversationModel(l)||{};if((null==p?void 0:p.type)===s.GRP_AVCHATROOM||(null==p?void 0:p.type)===s.GRP_COMMUNITY)return!1;if(t===s.MSG_CUSTOM){const t=kr.getMessageModel(e);if(null!==(null==t?void 0:t.getSignalingInfo()))return!1}return"out"===n&&"success"===o&&("GROUP"===u?d:"C2C"===u)})),l=e.computed((()=>{const{conversationType:e,needReadReceipt:t=!1,isPeerRead:n=!1}=a.message,{readCount:o=0,unreadCount:i=0,isPeerRead:s=!1}=a.message.readReceiptInfo;return"C2C"===e?t?s?0:1:n?0:1:"GROUP"===e?t?0===o?1:0===i?2:4:3:1})),u=e.computed((()=>{const{readCount:e=0}=a.message.readReceiptInfo;switch(l.value){case 0:return Tr.t("TUIChat.已读");case 1:return Tr.t("TUIChat.未读");case 2:return Tr.t("TUIChat.全部已读");case 4:return`${e}${Tr.t("TUIChat.人已读")}`;default:return""}})),d=e.computed((()=>{const{conversationType:e}=a.message;return"C2C"===e?0!==l.value:"GROUP"===e&&2!==l.value})),p=e.computed((()=>a.message.needReadReceipt&&"GROUP"===a.message.conversationType&&(4===l.value||1===l.value)));function h(){p.value&&o("openReadUserPanel")}function g(e){r.value=e}return(t,n)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"message-label":!0,unread:d.value,"finger-point":p.value}),onClick:h},[e.createElementVNode("span",null,e.toDisplayString(u.value),1)],2)),[[e.vShow,c.value]])}}),[["__scopeId","data-v-9da2ee63"]]);var Gh=(e=>(e[e.TYPE_NONE=0]="TYPE_NONE",e[e.TYPE_TEXT=1]="TYPE_TEXT",e[e.TYPE_CUSTOM=2]="TYPE_CUSTOM",e[e.TYPE_IMAGE=3]="TYPE_IMAGE",e[e.TYPE_SOUND=4]="TYPE_SOUND",e[e.TYPE_VIDEO=5]="TYPE_VIDEO",e[e.TYPE_FILE=6]="TYPE_FILE",e[e.TYPE_LOCATION=7]="TYPE_LOCATION",e[e.TYPE_FACE=8]="TYPE_FACE",e[e.TYPE_GROUP_TIPS=9]="TYPE_GROUP_TIPS",e[e.TYPE_MERGER=10]="TYPE_MERGER",e))(Gh||{});const xh=L(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},emits:["scrollTo","blinkMessage"],setup(t,{emit:n}){const o=n,a=t;let i=0;const s=e.ref(""),r=e.ref(!1),c=e.ref({}),l=e.computed((()=>{var e;try{const t=JSON.parse((null==(e=a.message)?void 0:e.cloudCustomData)||"{}"),n=kr.getMessageModel(t.messageReply.messageID);return null==n?void 0:n.isRevoked}catch(t){return!0}}));async function u(){var e;if(l.value)return;const t=null==(e=c.value)?void 0:e.messageID,n=kr.getData(oi.CHAT,"messageList").some((e=>e.ID===t));if(t&&n)try{const e=await eu("#messageScrollList","messageList"),n=await eu("#tui-"+t,"messageList"),{scrollTop:a}=await tu("#messageScrollList","messageList"),s=n.top+a-e.top-i++%2,r=n.top<e.top;if(!lu&&window){const e=document.getElementById("messageScrollList");r&&e&&(e.scrollTop=s)}else lu&&r&&o("scrollTo",s);o("blinkMessage",t)}catch(a){I("error","at TUIKit/components/TUIChat/message-list/message-elements/message-quote/index.vue:144",a)}else yd({message:Tr.t("TUIChat.无法定位到原消息"),type:fd})}return e.onMounted((()=>{var e;try{const t=JSON.parse((null==(e=a.message)?void 0:e.cloudCustomData)||"{}");r.value=Boolean(t.messageReply),r.value&&(c.value=t.messageReply,s.value=function(e){let t="",n="";switch(e.messageType){case Gh.TYPE_TEXT:t="[文本]";break;case Gh.TYPE_CUSTOM:t="[自定义消息]";break;case Gh.TYPE_IMAGE:t="[图片]";break;case Gh.TYPE_SOUND:t="[音频]";break;case Gh.TYPE_VIDEO:t="[视频]";break;case Gh.TYPE_FILE:t="[文件]";break;case Gh.TYPE_LOCATION:t="[地理位置]";break;case Gh.TYPE_FACE:t="[动画表情]";break;case Gh.TYPE_GROUP_TIPS:t="[群提示]";break;case Gh.TYPE_MERGER:t="[聊天记录]";break;default:t="[消息]"}[Gh.TYPE_TEXT,Gh.TYPE_MERGER].includes(e.messageType)&&(n=e.messageAbstract);return n||Tr.t(`TUIChat.${t}`)}(c.value))}catch(t){r.value=!1}})),(t,n)=>r.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"reference-content":!0,reverse:"out"===t.message.flow}),onClick:u},[l.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"revoked-text"},e.toDisplayString(e.unref(Tr).t("TUIChat.引用内容已撤回")),1)):(e.openBlock(),e.createElementBlock("div",{key:1,class:"max-double-line"},e.toDisplayString(c.value.messageSender)+": "+e.toDisplayString(e.unref(od)(s.value)),1))],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-d18331e6"]]),Bh=class e{constructor(){this.isUseCache=!0,this.translationCache=new Map}static getInstance(){return e.instance||(e.instance=new e),e.instance}async get(e){if(this.isUseCache){const t=this.translationCache.get(e.ID);if(void 0!==t)return t}const t=kr.getMessageModel(e.ID);if(!t)return[];const{text:n}=t.getMessageContent()||{},o=[],a=await this.getNickList(t);for(let r=0;r<n.length;++r){const e=n[r];if("img"===e.name){o.push({type:"face",value:e.src});continue}const{transSplitingList:t,atNickList:i}=this.getSplitResult(e.text,a);for(let n=0;n<t.length;++n)o.push({type:"text",value:t[n]}),n<i.length&&o.push({type:"mention",value:i[n]})}const i=[],s=o.filter(((e,t)=>"text"===e.type&&""!==e.value.trim()&&(i.push(t),!0))).map((e=>e.value));if(0===s.length)return this.translationCache.set(t.ID,o),o;return(await this.getTranslationStandard(s)).forEach(((e,t)=>{o[i[t]].value=e})),this.translationCache.set(t.ID,o),o}clear(){this.translationCache.clear()}disableCache(){this.isUseCache=!1}enableCache(){this.isUseCache=!0}getTranslationStandard(e){return new Promise(((t,n)=>{Dr.translateText({sourceTextList:e,sourceLanguage:"auto"}).then((e=>{const{data:{translatedTextList:n}}=e;t(n)})).catch((e=>{n(e)}))}))}async getNickList(e){const t=[],{atUserList:n=[]}=e,o=Cr.TYPES.MSG_AT_ALL;if(n.includes(o)&&t.push(`@${Tr.t("TUIChat.所有人")}`),n.length>0){const{data:e}=await Sr.getUserProfile({userIDList:n});e.forEach((e=>{const n=`@${e.nick||e.userID}`;t.push(n)}))}return[...new Set(t)]}getSplitResult(e,t){let n=0;const o=[],a=[];for(;n<e.length;){const i=e.indexOf("@",n);if(-1===i){o.push(e.substring(n));break}let s=!1;for(let r=0;r<t.length;++r){const c=e.indexOf(t[r],i);if(-1!==c&&c===i){o.push(e.substring(n,c)),a.push(t[r]),n=c+t[r].length,s=!0;break}}if(!s){o.push(e.substring(n));break}}return{transSplitingList:o,atNickList:a}}};Bh.instance=void 0;const Vh=Bh.getInstance(),Fh=L(e.defineComponent({__name:"translation-content",props:{message:{default:()=>({})},translationContentVisible:{type:Boolean},isSingleTranslation:{type:Boolean},translationWrapperRef:{}},setup(t){const n=t,o=e.ref(!1),a=e.ref(""),i=e.ref([]);return e.watch((()=>n.translationContentVisible),(e=>{e&&Vh.get(n.message).then((e=>{o.value=!0,i.value=e})).catch((e=>{o.value=!0,emits("toggleErrorStatus",!0),a.value=e.message}))}),{immediate:!0}),(t,s)=>(e.openBlock(),e.createElementBlock("div",{class:"message-translation-container"},[o.value?(e.openBlock(),e.createElementBlock("div",{key:0,id:`translation-content-${n.message.ID}`,class:e.normalizeClass({"translation-content":!0,occur:!0})},[i.value.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(i.value,((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n},["face"===t.type?(e.openBlock(),e.createElementBlock("img",{key:0,class:"text-face",src:t.value},null,8,["src"])):(e.openBlock(),e.createElementBlock("span",{key:1,class:"text-plain"},e.toDisplayString(t.value),1))])))),128)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(e.toDisplayString(a.value),1)],64))],8,["id"])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass({loading:!0,"loading-end":o.value})},e.toDisplayString(e.unref(Tr).t("TUIChat.翻译中"))+"... ",3)]))}}),[["__scopeId","data-v-a975b129"]]),Hh=L(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},setup(t){const n=t,o=e.ref(!1),a=e.ref(!1),i=e.ref();let s=!0;function r(e){a.value=e}function c(e){if(void 0===e)return;s=!1;const t=e.get(n.message.conversationID)||[];for(let i=0;i<t.length;++i){const{messageID:e,visible:r}=t[i];if(e===n.message.ID&&void 0!==r){1===t.length&&r&&(s=!0),a.value=!1,o.value=r;break}}}return e.onMounted((()=>{kr.watch(oi.CHAT,{translateTextInfo:c})})),e.onUnmounted((()=>{kr.unwatch(oi.CHAT,{translateTextInfo:c})})),(t,c)=>o.value?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"translationWrapperRef",ref:i,class:e.normalizeClass({"message-translation":!0,reverse:"out"===n.message.flow,error:a.value})},[e.createVNode(Fh,{message:n.message,translationContentVisible:o.value,translationWrapperRef:i.value,isSingleTranslation:e.unref(s),onToggleErrorStatus:r},null,8,["message","translationContentVisible","translationWrapperRef","isSingleTranslation"]),e.createElementVNode("div",{class:"copyright"},[e.createVNode(pu,{file:e.unref("/assets/check-sm.bfc05916.svg"),size:"13px"},null,8,["file"]),e.createElementVNode("div",{class:"copyright-text"},e.toDisplayString(e.unref(Tr).t("TUIChat.由IM提供翻译支持")),1)])],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-dc65be40"]]),jh=class e{constructor(){this.isUseCache=!0,this.convertCache=new Map}static getInstance(){return e.instance||(e.instance=new e),e.instance}async get(e){if(this.isUseCache){const t=this.convertCache.get(e.ID);if(void 0!==t)return t}const t=kr.getMessageModel(e.ID);if(!t)return Promise.reject("message not found");const n=await Dr.convertVoiceToText({message:t});let{data:{result:o}={}}=n;return o?this.convertCache.set(t.ID,o):o="",o}clear(){this.convertCache.clear()}disableCache(){this.isUseCache=!1}enableCache(){this.isUseCache=!0}};jh.instance=void 0;const qh=jh.getInstance(),zh=L(e.defineComponent({__name:"convert-content",props:{message:{default:()=>({})},contentVisible:{type:Boolean}},emits:["toggleErrorStatus"],setup(t,{emit:n}){const o=n,a=t,i=e.ref(!1),s=e.ref("");return e.watch((()=>a.contentVisible),(e=>{e&&qh.get(a.message).then((e=>{i.value=!0,s.value=e})).catch((e=>{i.value=!0,o("toggleErrorStatus",!0),s.value=e.message}))}),{immediate:!0}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"message-convert-container"},[i.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"convert-content":!0,occur:!0})},e.toDisplayString(s.value),1)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass({loading:!0,"loading-end":i.value})},e.toDisplayString(e.unref(Tr).t("TUIChat.转换中"))+"... ",3)]))}}),[["__scopeId","data-v-3307a280"]]),Kh=L(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},setup(t){const n=t,o=e.ref(!1),a=e.ref(!1),i=e.ref();let s=!0;function r(e){a.value=e}function c(e){if(void 0===e)return;s=!1;const t=e.get(n.message.conversationID)||[];for(let i=0;i<t.length;++i){const{messageID:e,visible:r}=t[i];if(e===n.message.ID&&void 0!==r){1===t.length&&r&&(s=!0),a.value=!1,o.value=r;break}}}return e.onMounted((()=>{kr.watch(oi.CHAT,{voiceToTextInfo:c})})),e.onUnmounted((()=>{kr.unwatch(oi.CHAT,{voiceToTextInfo:c})})),(t,c)=>o.value?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"convertWrapperRef",ref:i,class:e.normalizeClass({"message-convert":!0,reverse:"out"===n.message.flow,error:a.value})},[e.createVNode(zh,{message:n.message,contentVisible:o.value,isSingleConvert:e.unref(s),convertWrapperRef:i.value,onToggleErrorStatus:r},null,8,["message","contentVisible","isSingleConvert","convertWrapperRef"])],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-8cf40d37"]]),$h=L(e.defineComponent({__name:"index",props:{isSelected:{type:Boolean}},emits:["onChange"],setup(t,{emit:n}){const o=n,a=t;function i(){o("onChange",!a.isSelected)}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"radio-select",onClick:i},[a.isSelected?(e.openBlock(),e.createBlock(pu,{key:1,file:e.unref("/assets/radio.0422f0b5.svg"),size:"20px"},null,8,["file"])):(e.openBlock(),e.createElementBlock("div",{key:0,class:"radio-no-select"}))]))}}),[["__scopeId","data-v-70b6652d"]]),Yh=L(e.defineComponent({__name:"message-bubble",props:{messageItem:{default:()=>({})},content:{default:()=>({})},classNameList:{default:()=>[]},blinkMessageIDList:{default:()=>[]},isMultipleSelectMode:{type:Boolean,default:!1},isAudioPlayed:{type:Boolean,default:!1},multipleSelectedMessageIDList:{default:()=>[]}},emits:["resendMessage","blinkMessage","setReadReceiptPanelVisible","changeSelectMessageIDList","scrollTo"],setup(t,{emit:n}){const o=n,a=t,i=Cr.TYPES,s=[i.MSG_LOCATION,i.MSG_TEXT,i.MSG_CUSTOM,i.MSG_MERGER,i.MSG_FACE],{blinkMessageIDList:r,messageItem:c}=e.toRefs(a),l=e.computed((()=>a.multipleSelectedMessageIDList.includes(c.value.ID))),u=e.computed((()=>"in"===c.value.flow&&"success"===c.value.status&&c.value.type===i.MSG_AUDIO&&!a.isAudioPlayed)),d=e.computed((()=>["message-bubble",l.value?"multiple-selected":"",...a.classNameList])),p=e.computed((()=>[i.MSG_IMAGE,i.MSG_VIDEO,i.MSG_MERGER].includes(c.value.type))),h=e.computed((()=>{let e=Tr.t("TUIChat.涉及敏感内容")+", ";return"out"===c.value.flow?e+=Tr.t("TUIChat.发送失败"):e+=Tr.t(c.value.type===i.MSG_AUDIO?"TUIChat.无法收听":"TUIChat.无法查看"),e})),g=e.computed((()=>{var e,t;return!!(null==(e=c.value)?void 0:e.ID)&&(null==(t=null==r?void 0:r.value)?void 0:t.includes(c.value.ID))}));function m(e){o("changeSelectMessageIDList",{type:e?"add":"remove",messageID:c.value.ID})}function f(e){o("blinkMessage",e)}function v(e){o("scrollTo",e)}function _(){o("setReadReceiptPanelVisible",!0,c.value)}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(d.value)},[a.isMultipleSelectMode?(e.openBlock(),e.createBlock($h,{key:0,class:"multiple-select-radio",isSelected:l.value,onOnChange:m},null,8,["isSelected"])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass({"control-reverse":"out"===e.unref(c).flow})},[e.createElementVNode("div",{class:"message-bubble-content"},[e.createElementVNode("div",{class:e.normalizeClass(["message-bubble-main-content",["in"===e.unref(c).flow?"":"reverse"]])},[e.createVNode(Pd,{useSkeletonAnimation:"",url:e.unref(c).avatar||"",style:{flex:"0 0 auto"}},null,8,["url"]),e.createElementVNode("main",{class:"message-body",onClick:n[1]||(n[1]=e.withModifiers((()=>{}),["stop"]))},["in"===e.unref(c).flow&&"GROUP"===e.unref(c).conversationType?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-body-nick-name"},e.toDisplayString(a.content.showName),1)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["message-body-main","out"===e.unref(c).flow&&"message-body-main-reverse"])},[e.createElementVNode("div",{class:e.normalizeClass(["blink","message-body-content","out"===e.unref(c).flow?"content-out":"content-in",e.unref(c).hasRiskContent&&"content-has-risk",p.value?"content-no-padding":"",p.value&&g.value?"blink-shadow":"",!p.value&&g.value?"blink-content":""])},[e.createElementVNode("div",{class:"content-main"},[e.unref(c).type!==e.unref(i).MSG_IMAGE&&e.unref(c).type!==e.unref(i).MSG_VIDEO||!e.unref(c).hasRiskContent?e.renderSlot(t.$slots,"default",{key:1},void 0,!0):(e.openBlock(),e.createElementBlock("img",{key:0,class:e.normalizeClass(["message-risk-replace",!e.unref(iu)&&"message-risk-replace-h5"]),src:"https://web.sdk.qcloud.com/component/TUIKit/assets/has_risk_default.png"},null,2))]),e.unref(c).hasRiskContent?(e.openBlock(),e.createElementBlock("div",{key:0,class:"content-has-risk-tips"},e.toDisplayString(h.value),1)):e.createCommentVNode("",!0)],2),u.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"audio-unplay-mark"})):e.createCommentVNode("",!0),"fail"===e.unref(c).status||e.unref(c).hasRiskContent?(e.openBlock(),e.createElementBlock("div",{key:1,class:"message-label fail",onClick:n[0]||(n[0]=e=>{var t;(null==(t=c.value)?void 0:t.hasRiskContent)||o("resendMessage")})}," ! ")):e.createCommentVNode("",!0),"unSend"===e.unref(c).status&&s.includes(e.unref(c).type)?(e.openBlock(),e.createBlock(pu,{key:2,class:"message-label loading-circle",file:e.unref("/assets/loading.2a143778.png"),width:"15px",height:"15px"},null,8,["file"])):e.createCommentVNode("",!0),e.createVNode(Ph,{class:"message-label align-self-bottom",message:e.unref(kp)(e.unref(c)),onOpenReadUserPanel:_},null,8,["message"])],2)])],2),e.createElementVNode("div",{class:"message-bubble-extra-content"},[e.createVNode(Hh,{class:e.normalizeClass("out"===e.unref(c).flow?"reverse":"flex-row"),message:e.unref(c)},null,8,["class","message"]),e.createVNode(Kh,{class:e.normalizeClass("out"===e.unref(c).flow?"reverse":"flex-row"),message:e.unref(c)},null,8,["class","message"]),e.createVNode(xh,{class:e.normalizeClass("out"===e.unref(c).flow?"reverse":"flex-row"),message:e.unref(c),onBlinkMessage:f,onScrollTo:v},null,8,["class","message"])])])],2)],2))}}),[["__scopeId","data-v-b02f054e"]]),Wh=L(e.defineComponent({__name:"message-location",props:{content:{type:Object,default:()=>({})}},setup(t){const n=t,o=e.ref();return e.watchEffect((()=>{o.value=n.content})),(t,n)=>(e.openBlock(),e.createElementBlock("a",{class:"message-location",href:o.value.href,target:"_blank",title:"点击查看详情"},[e.createElementVNode("span",{class:"el-icon-location-outline"},e.toDisplayString(o.value.description),1),e.createElementVNode("img",{src:o.value.url},null,8,["src"])],8,["href"]))}}),[["__scopeId","data-v-8af3d505"]]),Jh=L(e.defineComponent({__name:"message-timestamp",props:{currTime:{type:Number,default:0},prevTime:{type:Number,default:0}},setup(t){const n=t,{currTime:o,prevTime:a}=e.toRefs(n),i=e.ref(!1),s=e.ref("");return e.watch((()=>[o.value,a.value]),((e,t)=>{var n,r;(null==e?void 0:e.toString())!==(null==t?void 0:t.toString())&&(s.value=(n=o.value,r=a.value,i.value=!1,n<=0?"":!r||r<=0||n-r>=600?(i.value=!0,Tp(1e3*n)):""))}),{immediate:!0}),(t,n)=>i.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-timestamp"},e.toDisplayString(s.value),1)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-334e7e11"]]),Xh=L(e.defineComponent({__name:"message-video",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},setup(t){const n=t;function o(){const e=encodeURIComponent(n.content.url);uni.navigateTo({url:`/TUIKit/components/TUIChat/video-play?videoUrl=${e}`})}return(t,a)=>(e.openBlock(),e.createElementBlock("div",{class:"message-video"},[e.createElementVNode("div",{class:"message-video-box",onClick:o},[e.createElementVNode("image",{src:n.content.snapshotUrl,class:"message-video-box"},null,8,["src"]),"success"===n.messageItem.status||1===n.messageItem.progress?(e.openBlock(),e.createBlock(pu,{key:0,class:"video-play",file:e.unref(hd)},null,8,["file"])):e.createCommentVNode("",!0)])]))}}),[["__scopeId","data-v-96de2cf1"]]),Zh="/assets/msg-copy.91b797d7.svg",Qh=L(e.defineComponent({__name:"index",props:{messageItem:{default:()=>({})},isMultipleSelectMode:{type:Boolean,default:!1}},emits:["toggleMultipleSelectMode"],setup(t,{expose:n,emit:o}){const a=o,i=t,s=Uh.getFeatureConfig(),r=Cr.TYPES,c=e.ref([{key:"open",text:Tr.t("TUIChat.打开"),iconUrl:Zh,renderCondition(){var e;return!(!s.DownloadFile||!l.value)&&(iu&&((null==(e=l.value)?void 0:e.type)===r.MSG_FILE||l.value.type===r.MSG_VIDEO||l.value.type===r.MSG_IMAGE))},clickEvent:function(){var e;let t="";switch(null==(e=l.value)?void 0:e.type){case Cr.TYPES.MSG_FILE:t=l.value.payload.fileUrl;break;case Cr.TYPES.MSG_VIDEO:t=l.value.payload.remoteVideoUrl;break;case Cr.TYPES.MSG_IMAGE:t=l.value.payload.imageInfoArray[0].url}null==window||window.open(t,"_blank")}},{key:"copy",text:Tr.t("TUIChat.复制"),iconUrl:Zh,renderCondition:()=>!(!s.CopyMessage||!l.value)&&l.value.type===r.MSG_TEXT,clickEvent:async function(){var e,t;lu&&(null==Fl||Fl.setClipboardData({data:od(null==(t=null==(e=l.value)?void 0:e.payload)?void 0:t.text)}))}},{key:"revoke",text:Tr.t("TUIChat.撤回"),iconUrl:"/assets/msg-revoke.a0b46d31.svg",renderCondition:()=>!(!s.RevokeMessage||!l.value)&&("out"===l.value.flow&&"success"===l.value.status),clickEvent:function(){if(!l.value)return;kr.getMessageModel(l.value.ID).revokeMessage().then((()=>{Nd("revokeMessage")})).catch((e=>{if(20016===e.code||10031===e.code){const e=Tr.t("TUIChat.已过撤回时限");yd({message:e,type:vd})}}))}},{key:"delete",text:Tr.t("TUIChat.删除"),iconUrl:"/assets/msg-del.8e1884b8.svg",renderCondition:()=>!(!s.DeleteMessage||!l.value)&&"success"===l.value.status,clickEvent:function(){if(!l.value)return;kr.getMessageModel(l.value.ID).deleteMessage()}},{key:"forward",text:Tr.t("TUIChat.转发"),iconUrl:"/assets/msg-forward.b9d14da1.svg",renderCondition:()=>!(!s.ForwardMessage||!l.value)&&"success"===l.value.status,clickEvent:function(){if(!l.value)return;kr.update(oi.CUSTOM,"singleForwardMessageID",l.value.ID)}},{key:"quote",text:Tr.t("TUIChat.引用"),iconUrl:"/assets/msg-quote.6ed4649b.svg",renderCondition(){if(!s.QuoteMessage||!l.value)return!1;const e=kr.getMessageModel(l.value.ID);return"success"===l.value.status&&!e.getSignalingInfo()},clickEvent:function(){if(!l.value)return;l.value.quoteMessage()}},{key:"translate",text:Tr.t("TUIChat.翻译"),visible:!1,iconUrl:"/assets/translate.a0cfa550.svg",renderCondition:()=>!(!s.TranslateMessage||!l.value)&&("success"===l.value.status&&l.value.type===r.MSG_TEXT),clickEvent:function(){if(!kr.getData(oi.APP,"enabledTranslationPlugin"))return void yd({message:Tr.t("TUIChat.请开通翻译功能"),type:fd});if(!l.value)return;const e=c.value.findIndex((e=>"translate"===e.key));kr.update(oi.CHAT,"translateTextInfo",{conversationID:l.value.conversationID,messageID:l.value.ID,visible:!c.value[e].visible})}},{key:"convert",text:Tr.t("TUIChat.转文字"),visible:!1,iconUrl:"/assets/convertText_zh.ea05cc29.svg",renderCondition:()=>!(!s.VoiceToText||!l.value)&&("success"===l.value.status&&l.value.type===r.MSG_AUDIO),clickEvent:function(){if(!kr.getData(oi.APP,"enabledVoiceToText"))return void yd({message:Tr.t("TUIChat.请开通语音转文字功能")});if(!l.value)return;const e=c.value.findIndex((e=>"convert"===e.key));kr.update(oi.CHAT,"voiceToTextInfo",{conversationID:l.value.conversationID,messageID:l.value.ID,visible:!c.value[e].visible})}},{key:"multi-select",text:Tr.t("TUIChat.多选"),iconUrl:"/assets/multiple-select.63011d60.svg",renderCondition:()=>!(!s.MultiSelection||!l.value)&&"success"===l.value.status,clickEvent:function(){a("toggleMultipleSelectMode")}}]),l=e.ref(),u=e.ref();e.onMounted((()=>{kr.watch(oi.CHAT,{translateTextInfo:p,voiceToTextInfo:h})})),e.onUnmounted((()=>{kr.unwatch(oi.CHAT,{translateTextInfo:p,voiceToTextInfo:h})})),e.watchEffect((()=>{l.value=kr.getMessageModel(i.messageItem.ID)}));const d=e.computed((()=>{for(let e=0;e<c.value.length;++e)if(c.value[e].renderCondition())return!1;return!0}));function p(e){if(void 0===e)return;const t=e.get(i.messageItem.conversationID)||[],n=c.value.findIndex((e=>"translate"===e.key));for(let o=0;o<t.length;++o){const{messageID:e,visible:a}=t[o];if(e===i.messageItem.ID)return c.value[n].text=Tr.t(a?"TUIChat.隐藏":"TUIChat.翻译"),void(c.value[n].visible=!!a)}c.value[n].text=Tr.t("TUIChat.翻译")}function h(e){if(void 0===e)return;const t=e.get(i.messageItem.conversationID)||[],n=c.value.findIndex((e=>"convert"===e.key));for(let o=0;o<t.length;++o){const{messageID:e,visible:a}=t[o];if(e===i.messageItem.ID)return c.value[n].text=Tr.t(a?"TUIChat.隐藏":"TUIChat.转文字"),void(c.value[n].visible=!!a)}c.value[n].text=Tr.t("TUIChat.转文字")}return n({messageToolDom:u}),(t,n)=>d.value||t.messageItem.hasRiskContent?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"messageToolDom",ref:u,class:e.normalizeClass(["dialog-item",e.unref(iu)?"dialog-item-web":"dialog-item-h5"])},[e.unref(s).EmojiReaction?e.renderSlot(t.$slots,"TUIEmojiPlugin",{key:0},void 0,!0):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["dialog-item-list",e.unref(iu)?"dialog-item-list-web":"dialog-item-list-h5"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[t.renderCondition()?(e.openBlock(),e.createElementBlock("div",{key:t.key,class:"list-item",onClick:e=>function(e){c.value[e].clickEvent()}(n),onMousedown:e=>{t.key}},[e.createVNode(pu,{file:t.iconUrl,size:"15px"},null,8,["file"]),e.createElementVNode("span",{class:"list-item-text"},e.toDisplayString(t.text),1)],40,["onClick","onMousedown"])):e.createCommentVNode("",!0)],64)))),256))],2)],2))}}),[["__scopeId","data-v-fa50c145"]]),eg=L(e.defineComponent({__name:"message-revoked",props:{isEdit:{type:Boolean,default:()=>!1},messageItem:{type:Object,default:()=>({})}},emits:["messageEdit"],setup(t,{emit:n}){const o=t,a=e.ref(),i=e.ref(!1),s=n;e.watchEffect((()=>{a.value=o.messageItem,i.value=o.isEdit}));const r=()=>{s("messageEdit")};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"revoke"},["in"===a.value.flow?(e.openBlock(),e.createElementBlock("span",{key:0},e.toDisplayString(a.value.nick||a.value.from),1)):a.value.from===a.value.revoker?(e.openBlock(),e.createElementBlock("span",{key:1},e.toDisplayString(e.unref(Tr).t("TUIChat.您")),1)):(e.openBlock(),e.createElementBlock("span",{key:2},e.toDisplayString(a.value.revoker),1)),e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t("TUIChat.撤回了一条消息")),1),"out"===a.value.flow&&i.value?(e.openBlock(),e.createElementBlock("span",{key:3,class:"edit",onClick:r},e.toDisplayString(e.unref(Tr).t("TUIChat.重新编辑")),1)):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-742a59d4"]]),tg={OFFICIAL_ACCOUNT:"1",MINI_APP:"2",MINI_APP_SERVICE_ACCOUNT:"3",BACKEND_INTERNAL:"4",WEB:"5",SESSION_MESSAGE_SLICE:"6",MINI_APP_AUTO:"7",INTERNAL:"8",MENU:"9",MENU_SELECTED:"10",CLIENT_STATE:"11",TYPING_STATE:"12",ROBOT:"13",BRANCH:"15",BRANCH_NUMBER:15,MEMBER:"17",NO_SEAT_ONLINE:"18",END:"19",TIMEOUT:"20",FROM_INPUT:"21",PRODUCT_CARD:"22",SATISFACTION_CON:"23",USER_SATISFACTION:"24"},ng={STAR:1,NUMBER:2},og="TIMCustomElem";function ag(e){return function(e){if("string"==typeof e)try{return!!JSON.parse(e)}catch(t){return!1}return!1}(e)?JSON.parse(e):e}function ig(e){var t;const n=ag(null==(t=null==e?void 0:e.payload)?void 0:t.data);return 0===Number(null==n?void 0:n.customerServicePlugin)||1===Number(null==n?void 0:n.chatbotPlugin)}const sg=e=>{var t;const n=ag(null==(t=null==e?void 0:e.payload)?void 0:t.data);return ig(e)&&n.src===tg.MENU},rg=e=>{var t,n;const o=ag(null==(t=null==e?void 0:e.payload)?void 0:t.data),a=[tg.MENU,tg.BRANCH,tg.BRANCH_NUMBER,tg.FROM_INPUT,tg.PRODUCT_CARD],i=(null==e?void 0:e.type)===og,s=a.includes(null==o?void 0:o.src),r=(null==o?void 0:o.src)===tg.ROBOT&&-1!==["feedback","updateBotStatus"].indexOf(null==(n=null==o?void 0:o.content)?void 0:n.command);return i&&(!s||r)};const cg=(v=class{constructor(){__publicField(this,"customerServiceAccounts"),I("log","at TUIKit/tui-customer-service-plugin/server.ts:12","TUICustomerServer.init ok"),Wr.registerService(Ar.TUICustomerServicePlugin.SERVICE.NAME,this),Wr.registerExtension(Ar.TUIContact.EXTENSION.CONTACT_LIST.EXT_ID,this),this.customerServiceAccounts=["@im_agent#online_shopping_mall","@im_agent#online_doctor"]}static getInstance(){return v.instance||(v.instance=new v),v.instance}setCustomerServiceAccounts(e){this.customerServiceAccounts=e}getCustomerServiceAccounts(){return this.customerServiceAccounts}isCustomerConversation(e){const t=e&&e.slice(3)||"";return this.customerServiceAccounts.indexOf(t)>-1}isCustomerServicePluginMessage(e){return!(!e||!this.isCustomerConversation(e.conversationID))&&(ig(e)||rg(e))}onGetExtension(e){if(e===Ar.TUIContact.EXTENSION.CONTACT_LIST.EXT_ID)return[{weight:0,icon:"",text:"客服号",data:{name:"customer",accountList:this.customerServiceAccounts}}]}onCall(e,t){if(e===Ar.TUICustomerServicePlugin.SERVICE.METHOD.ACTIVE_CONVERSATION)this.isCustomerConversation(t.conversationID)&&(Wr.callService({serviceName:Ar.TUIChat.SERVICE.NAME,method:Ar.TUIChat.SERVICE.METHOD.SET_CHAT_TYPE,params:{chatType:"customerService"}}),Wr.callService({serviceName:Ar.TUIChat.SERVICE.NAME,method:Ar.TUIChat.SERVICE.METHOD.SEND_CUSTOM_MESSAGE,params:{to:t.conversationID.slice(3),conversationType:"C2C",payload:{data:JSON.stringify({src:"7"})}}}))}},__publicField(v,"instance"),v).getInstance(),lg=cg.isCustomerServicePluginMessage.bind(cg);function ug(e){var t;const n=ld(null==(t=null==e?void 0:e.payload)?void 0:t.data);if(1===(null==n?void 0:n.businessID)&&(null==n?void 0:n.data)){if("av_call"===ld(n.data).businessID)return!0}return!1}function dg(e){var t;const n=ld(null==(t=null==e?void 0:e.payload)?void 0:t.data);return"group_room_message"===(null==n?void 0:n.businessID)}function pg(e){return e.type===Cr.TYPES.MSG_CUSTOM&&(ug(e)||lg(e)||dg(e)||function(e){var t;const n=ld(null==(t=null==e?void 0:e.payload)?void 0:t.data);return"ROOM_INVITE_ACTION"===(null==n?void 0:n.businessID)||"tuikit_engine_room"===(null==n?void 0:n.businessID)}(e))}cg.setCustomerServiceAccounts.bind(cg),cg.getCustomerServiceAccounts.bind(cg);const hg=e.defineComponent({__name:"message-plugin-layout",props:{message:{default:()=>({})},showStyle:{default:""},bubbleClassNameList:{default:()=>[]},blinkMessageIDList:{default:()=>[]}},emits:["resendMessage","handleToggleMessageItem","handleH5LongPress"],setup(t,{emit:n}){const o=t,a=n,i=e.computed((()=>{var e;return kr.getMessageModel(null==(e=o.message)?void 0:e.ID)})),s=(e,t,n=!1)=>{a("handleToggleMessageItem",e,t,n)},r=(e,t,n)=>{a("handleH5LongPress",e,t,n)};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"message-plugin"},["tip"===o.showStyle?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-plugin-tip"},[e.renderSlot(t.$slots,"messageTip",{},void 0,!0)])):"bubble"===o.showStyle?(e.openBlock(),e.createElementBlock("div",{key:1,class:"message-plugin-bubble-content",onLongpress:n[1]||(n[1]=e=>s(e,i.value,!0)),onContextmenu:n[2]||(n[2]=e.withModifiers((e=>s(e,i.value)),["prevent","right"])),onTouchstart:n[3]||(n[3]=e=>r(e,i.value,"touchstart")),onTouchend:n[4]||(n[4]=e=>r(e,i.value,"touchend")),onMouseover:n[5]||(n[5]=e=>r(e,i.value,"touchend"))},[e.createVNode(Yh,{messageItem:i.value,content:i.value.getMessageContent(),blinkMessageIDList:o.blinkMessageIDList,classNameList:o.bubbleClassNameList,onResendMessage:n[0]||(n[0]=e=>{return t=i.value,void a("resendMessage",t);var t})},{messageElement:e.withCtx((()=>[e.unref(lu)?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"messageBubble",{key:0},void 0,!0)])),default:e.withCtx((()=>[e.unref(lu)?e.renderSlot(t.$slots,"messageBubble",{key:0},void 0,!0):e.createCommentVNode("",!0)])),_:3},8,["messageItem","content","blinkMessageIDList","classNameList"])],32)):e.createCommentVNode("",!0)]))}}),gg=L(hg,[["__scopeId","data-v-dd7c60a3"]]),mg=L(e.defineComponent({__name:"message-call-group",props:{message:{default:()=>({})},signalingInfo:{default:()=>({})},customContent:{default:()=>({})},blinkMessageIDList:{default:()=>[]}},setup(t){const n=t,o=Cr.TYPES,a=e.computed((()=>!!n.signalingInfo)),i=e.computed((()=>{var e;return null==(e=n.message)?void 0:e.conversationType})),s=e.computed((()=>{var e;return null==(e=n.customContent)?void 0:e.custom})),r=e.computed((()=>{var e,t;return!!(null==(e=n.message)?void 0:e.ID)&&(null==(t=n.blinkMessageIDList)?void 0:t.includes(n.message.ID))}));return(t,n)=>a.value&&i.value===e.unref(o).CONV_GROUP?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"blink-text":r.value})},e.toDisplayString(s.value),3)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-db734b39"]]),fg={androidInfo:{sound:"private_ring.mp3",XiaoMiChannelID:"high_custom_1",OPPOChannelID:"tuikit"},apnsInfo:{sound:"01.caf",image:"https://web.sdk.qcloud.com/im/demo/latest/faviconnew.png"}},vg={title:"call",description:"you have a call",androidSound:"private_ring",androidOPPOChannelID:"tuikit",iOSSound:"01.caf"},_g={[Cr.TYPES.MSG_TEXT]:"[文本]",[Cr.TYPES.MSG_FACE]:"[动画表情]",[Cr.TYPES.MSG_IMAGE]:"[图片]",[Cr.TYPES.MSG_FILE]:"[文件]",[Cr.TYPES.MSG_AUDIO]:"[语音]",[Cr.TYPES.MSG_VIDEO]:"[视频]",[Cr.TYPES.MSG_LOCATION]:"[地理位置]",[Cr.TYPES.MSG_MERGER]:"[聊天记录]",[Cr.TYPES.MSG_CUSTOM]:"[自定义消息]"};var yg=(e=>(e.CHAT="chat",e.CALL="call",e))(yg||{});const Ig=((_=class{constructor(){this.name="OfflinePushInfoManager",this.offlinePushInfo={},this.offlinePushInfo={[yg.CHAT]:fg,[yg.CALL]:vg}}static getInstance(){return _.instance||(_.instance=new _),_.instance}getOfflinePushInfo(e){return Object.values(yg).includes(e)?this.offlinePushInfo[e]:(I("error","at TUIKit/components/TUIChat/offlinePushInfoManager/offlinePushInfoManager.ts:32",`${this.name} getOfflinePushInfo scene: ${e} is invalid`),null)}genTitle(e,t){let n=null==e?void 0:e.getShowName();return e.type===Cr.TYPES.CONV_C2C&&(n=(null==t?void 0:t.nick)||(null==t?void 0:t.userID)),n}genDesc(e,t){let n="";return e===Cr.TYPES.MSG_TEXT&&(n=od(t.text)),e===Cr.TYPES.MSG_CUSTOM&&(n=t.description),n||Tr.t(`TUIChat.${_g[e]}`)}create(e){var t;const{conversation:n,messageType:o="",payload:a={}}=e||{},i=kr.getData(oi.USER,"userProfile"),s={sender:n.type===Cr.TYPES.CONV_GROUP?null==(t=n.groupProfile)?void 0:t.groupID:null==i?void 0:i.userID,nickName:null==i?void 0:i.nick,chatType:n.type===Cr.TYPES.CONV_GROUP?2:1,version:1,action:1};return{title:this.genTitle(n,i),description:this.genDesc(o,a),extension:JSON.stringify({entity:s}),...this.offlinePushInfo[yg.CHAT]}}}).instance=null,_).getInstance(),Eg=L(e.defineComponent({__name:"message-call-c2c",props:{message:{type:Object,default:()=>({})},signalingInfo:{type:Object,default:()=>({})},customContent:{type:Object,default:()=>({})}},setup(t){const n=t,o=e.ref(Cr.TYPES),a=e.computed((()=>null!=n.signalingInfo)),i=e.computed((()=>{var e,t;switch(null==(t=ld(null==(e=n.signalingInfo)?void 0:e.data))?void 0:t.call_type){case 1:return{type:1,icon:"/assets/call-voice.f8912d47.svg"};case 2:return{type:2,icon:"/assets/call-video.6c7799e9.svg"}}return{type:0,icon:""}})),s=e.computed((()=>{var e;return null==(e=n.message)?void 0:e.conversationType})),r=e.computed((()=>{var e;return null==(e=n.customContent)?void 0:e.custom})),c=()=>{var e,t,o,a;if(s.value===Cr.TYPES.CONV_C2C){const s="out"===(null==(e=n.message)?void 0:e.flow)?null==(t=n.message)?void 0:t.to:null==(o=n.message)?void 0:o.from;Wr.callService({serviceName:Ar.TUICalling.SERVICE.NAME,method:Ar.TUICalling.SERVICE.METHOD.START_CALL,params:{userIDList:[s],type:null==(a=null==i?void 0:i.value)?void 0:a.type,callParams:{offlinePushInfo:Ig.getOfflinePushInfo(yg.CALL)}}})}};return(n,l)=>a.value&&s.value===o.value.CONV_C2C?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["call",["call-"+s.value,"out"===t.message.flow&&"call-reverse"]]),onClick:c},[e.createElementVNode("div",{class:e.normalizeClass(["icon","out"===t.message.flow&&2===i.value.type&&"icon-reverse"])},[e.createVNode(pu,{file:i.value.icon},null,8,["file"])],2),e.createElementVNode("span",{class:"call-content"},e.toDisplayString(r.value),1)],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-64bc5083"]]);Zl(),Zl(),Zl();const Cg="app"===Zl();const kg=L({props:{src:{type:String,default:""},width:{type:String,default:"16px"},height:{type:String,default:"16px"}},setup:e=>({props:e,isApp:Cg})},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("div",{class:"common-icon-container"},[a.isApp?(e.openBlock(),e.createElementBlock("image",{key:0,class:"common-icon",src:a.props.src,style:e.normalizeStyle({width:a.props.width,height:a.props.height})},null,12,["src"])):(e.openBlock(),e.createElementBlock("img",{key:1,class:"common-icon",src:a.props.src,style:e.normalizeStyle({width:a.props.width,height:a.props.height})},null,12,["src"]))])}],["__scopeId","data-v-888d20ac"]]);const Tg=L({components:{MessageCustomerService:L({components:{MessageBranch:L({components:{Icon:kg},props:{payload:{type:Object,default:()=>({})}},emits:["sendMessage"],setup:(t,{emit:n})=>({content:e.computed((()=>{var e;return(null==(e=null==t?void 0:t.payload)?void 0:e.content)||{header:void 0,items:[]}})),handleContentListItemClick:e=>{n("sendMessage",{text:e.content})},iconRight:"/assets/iconRight.eac74a1a.svg"})},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("Icon");return e.openBlock(),e.createElementBlock("div",{class:"branch-card"},[a.content.header||a.content.title?(e.openBlock(),e.createElementBlock("p",{key:0,class:"branch-title"},e.toDisplayString(a.content.header||a.content.title),1)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.content.items,((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n,class:"branch-item",style:e.normalizeStyle({borderWidth:a.content.header?"1px 0 0px 0":"0px 0 1px 0"}),onClick:e=>a.handleContentListItemClick(t)},[e.createTextVNode(e.toDisplayString(t.content)+" ",1),e.createVNode(r,{src:a.iconRight},null,8,["src"])],12,["onClick"])))),128))])}],["__scopeId","data-v-b5af6c17"]]),MessageForm:L({components:{FormBranch:L({props:{title:{type:String,default:""},list:{type:Array,default:()=>[]}},emits:["input-click"],setup:(e,{emit:t})=>({props:e,listItemClick:e=>{t("input-click",e)}})},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("div",null,[a.props.title?(e.openBlock(),e.createElementBlock("p",{key:0,class:"card-title"},e.toDisplayString(a.props.title),1)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.props.list,((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n,class:"form-branch-item",onClick:e=>a.listItemClick(t)},e.toDisplayString(t.content),9,["onClick"])))),128))])}],["__scopeId","data-v-882e5344"]]),FormInput:L({props:{title:{type:String,default:""}},emits:["input-submit"],setup(t,{emit:n}){const o=e.ref(!1),a=e.ref("");return{disabled:o,text:a,listItemClick:()=>{o.value=!0,n("input-submit",a.value)},props:t}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",{class:"card-title"},e.toDisplayString(a.props.title),1),e.createElementVNode("div",{class:"form-input-box"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>a.text=e),class:"form-input"},null,512),[[e.vModelText,a.text]]),e.createElementVNode("button",{class:"form-button",disabled:a.disabled,onClick:n[1]||(n[1]=(...e)=>a.listItemClick&&a.listItemClick(...e))},null,8,["disabled"])])])}],["__scopeId","data-v-6832e5ae"]])},props:{payload:{type:Object,default:()=>({})}},emits:["sendMessage"],setup:(t,{emit:n})=>({content:e.computed((()=>{var e;return(null==(e=t.payload)?void 0:e.content)||{type:0,header:"",items:[]}})),handleContentListItemClick:e=>{n("sendMessage",{text:e.content})},handleFormSaveInputSubmit:e=>{n("sendMessage",{text:e})}})},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("FormBranch"),c=e.resolveComponent("FormInput");return 1===a.content.type?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-form"},[e.createVNode(r,{title:a.content.header,list:a.content.items,onInputClick:a.handleContentListItemClick},null,8,["title","list","onInputClick"])])):(e.openBlock(),e.createElementBlock("div",{key:1,class:"message-form"},[e.createVNode(c,{title:a.content.header,onInputSubmit:a.handleFormSaveInputSubmit},null,8,["title","onInputSubmit"])]))}],["__scopeId","data-v-8ae36b43"]]),MessageProductCard:L({props:{payload:{type:Object,default:()=>({})}},emits:["sendMessage"],setup:e=>({props:e,isApp:Cg,jumpProductCard:()=>{window?window.open(e.payload.content.url,"_blank"):uni&&uni.navigateTo({url:`/TUIKit/components/TUIChat/web-view?url=${e.payload.content.url}`})}})},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("div",{class:"message-product-card",onClick:n[0]||(n[0]=(...e)=>a.jumpProductCard&&a.jumpProductCard(...e))},[a.isApp?(e.openBlock(),e.createElementBlock("image",{key:0,class:"product-img",src:a.props.payload.content.pic},null,8,["src"])):(e.openBlock(),e.createElementBlock("img",{key:1,class:"product-img",src:a.props.payload.content.pic},null,8,["src"])),e.createElementVNode("div",{class:"product-card-information"},[e.createElementVNode("div",{class:"product-card-title"},e.toDisplayString(a.props.payload.content.header),1),e.createElementVNode("div",{class:"product-card-description"},e.toDisplayString(a.props.payload.content.desc),1)])])}],["__scopeId","data-v-8dc8e39c"]])},props:{message:{type:Object,default:()=>({})}},emits:["sendMessage"],setup:(t,{emit:n})=>({payload:e.computed((()=>{var e,n;return t.message&&ag(null==(n=null==(e=t.message)?void 0:e.payload)?void 0:n.data)})),sendTextMessage:e=>{n("sendMessage",e)},CUSTOM_MESSAGE_SRC:tg})},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("MessageBranch"),c=e.resolveComponent("MessageForm"),l=e.resolveComponent("MessageProductCard");return e.openBlock(),e.createElementBlock("div",{class:"custom"},[a.payload.src===a.CUSTOM_MESSAGE_SRC.BRANCH||a.payload.src===a.CUSTOM_MESSAGE_SRC.BRANCH_NUMBER?(e.openBlock(),e.createElementBlock("div",{key:0},[e.createVNode(r,{payload:a.payload,onSendMessage:a.sendTextMessage},null,8,["payload","onSendMessage"])])):e.createCommentVNode("",!0),a.payload.src===a.CUSTOM_MESSAGE_SRC.FROM_INPUT?(e.openBlock(),e.createElementBlock("div",{key:1},[e.createVNode(c,{payload:a.payload,onSendMessage:a.sendTextMessage},null,8,["payload","onSendMessage"])])):e.createCommentVNode("",!0),a.payload.src===a.CUSTOM_MESSAGE_SRC.PRODUCT_CARD?(e.openBlock(),e.createElementBlock("div",{key:2},[e.createVNode(l,{payload:a.payload},null,8,["payload"])])):e.createCommentVNode("",!0)])}]]),MessageRating:L({components:{RatingStar:L({components:{Icon:kg},props:{ratingTemplate:{type:Object,default:()=>({})}},emits:["sendMessage"],setup(t,{emit:n}){const o=e.ref(!1),a=e.ref(""),i=e.ref(-1),s=e.ref(-1),r=e.ref(!1);e.watchEffect((()=>{if(a.value=t.ratingTemplate.sessionId||"",null!=t.ratingTemplate.selected)for(let e=0;e<t.ratingTemplate.menu.length;e++)if(t.ratingTemplate.menu[e].id==t.ratingTemplate.selected.id){o.value=!0,i.value=e;break}Math.floor((new Date).getTime()/1e3)>t.ratingTemplate.expireTime&&(r.value=!0)}));const c=e.computed((()=>{var e;return null==(e=t.ratingTemplate)?void 0:e.menu.map((e=>e.content))})),l=e.computed((()=>{var e;return null==(e=t.ratingTemplate)?void 0:e.menu.map(((e,t)=>-1!==s.value?t<=s.value?1:0:t<=i.value?1:0))}));return{props:t,hasReply:o,sessionId:a,value:i,hoverValue:s,hasExpire:r,desc:c,starList:l,setValue:e=>{o.value||(i.value=e)},setHoverValue:e=>{o.value||(s.value=e)},submitRatingStar:async()=>{if(i.value<0)return;const e={data:JSON.stringify({src:tg.MENU_SELECTED,menuSelected:{id:t.ratingTemplate.menu[i.value].id,content:t.ratingTemplate.menu[i.value].content,sessionId:a.value},customerServicePlugin:0})};o.value=!0,n("sendMessage",e)},star:"/assets/star.0d13712b.png",starLine:"/assets/starLine.f4211758.png"}}},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("Icon");return e.openBlock(),e.createElementBlock("div",{class:"message-rating-star"},[e.createElementVNode("p",{class:"rating-head"},e.toDisplayString(a.props.ratingTemplate.head),1),e.createElementVNode("div",{class:"rating-card"},[e.createElementVNode("span",{class:"card-title"},"请对本次服务进行评价"),e.createElementVNode("div",{class:"card-wrapper"},[e.createElementVNode("div",{style:{"max-width":"200px"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.starList,((t,o)=>(e.openBlock(),e.createElementBlock("div",{key:o,style:{display:"inline-block"},onClick:e=>a.setValue(o),onMouseenter:e=>a.setHoverValue(o),onMouseleave:n[0]||(n[0]=e=>a.setHoverValue(-1))},[1===t?(e.openBlock(),e.createBlock(r,{key:0,src:a.star,width:"30px",height:"30px"},null,8,["src"])):(e.openBlock(),e.createBlock(r,{key:1,src:a.starLine,width:"30px",height:"30px"},null,8,["src"]))],40,["onClick","onMouseenter"])))),128))])]),e.createElementVNode("div",{style:{marginTop:"10px",marginBottom:"10px"}},e.toDisplayString(-1===a.hoverValue?-1===a.value?"如果满意请给好评哦～":a.desc[a.value]:a.desc[a.hoverValue]),1),e.createElementVNode("button",{class:"submit-button",disabled:a.hasReply||a.hasExpire,onClick:n[1]||(n[1]=(...e)=>a.submitRatingStar&&a.submitRatingStar(...e))}," 提交评价 ",8,["disabled"])]),a.hasReply?(e.openBlock(),e.createElementBlock("p",{key:0,class:"rating-tail",style:{marginTop:"20px"}},e.toDisplayString(a.props.ratingTemplate.tail),1)):e.createCommentVNode("",!0)])}],["__scopeId","data-v-6679906e"]]),RatingNumber:L({props:{ratingTemplate:{type:Object,default:()=>({})}},emits:["sendMessage"],setup(t,{emit:n}){const o=e.ref(!1),a=e.ref(""),i=e.ref(-1),s=e.ref(-1),r=e.ref(!1),c=e.computed((()=>{var e;return null==(e=t.ratingTemplate)?void 0:e.menu.map((e=>e.content))})),l=e.computed((()=>{var e;return null==(e=t.ratingTemplate)?void 0:e.menu.map(((e,t)=>t))}));e.watchEffect((()=>{if(a.value=t.ratingTemplate.sessionId||"",null!=t.ratingTemplate.selected)for(let e=0;e<t.ratingTemplate.menu.length;e++)if(t.ratingTemplate.menu[e].id==t.ratingTemplate.selected.id){o.value=!0,i.value=e;break}Math.floor((new Date).getTime()/1e3)>t.ratingTemplate.expireTime&&(r.value=!0)}));return{props:t,hasReply:o,sessionId:a,selectValue:i,hoverValue:s,hasExpire:r,desc:c,numberList:l,setValue:e=>{o.value||(i.value=e)},setHoverValue:e=>{o.value||(s.value=e)},submitRatingStar:()=>{if(i.value>=0){const e={data:JSON.stringify({src:tg.MENU_SELECTED,menuSelected:{id:t.ratingTemplate.menu[i.value].id,content:t.ratingTemplate.menu[i.value].content,sessionId:a.value},customerServicePlugin:0})};o.value=!0,n("sendMessage",e)}}}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("div",{class:"message-rating-star"},[e.createElementVNode("p",{class:"rating-head"},e.toDisplayString(a.props.ratingTemplate.head),1),e.createElementVNode("div",{class:"rating-card"},[e.createElementVNode("span",{class:"card-title"},"请对本次服务进行评价"),e.createElementVNode("div",{class:"card-wrapper"},[e.createElementVNode("div",{style:{"max-width":"250px"}},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.numberList,((t,o)=>(e.openBlock(),e.createElementBlock("div",{key:o,class:e.normalizeClass({active:!(o!==a.selectValue&&o!==a.hoverValue),"de-active":o!==a.selectValue&&o!==a.hoverValue}),style:e.normalizeStyle({marginLeft:0===o?"0px":"20px",margin:"5px"}),onClick:e=>a.setValue(o),onMouseenter:e=>a.setHoverValue(o),onMouseleave:n[0]||(n[0]=e=>a.setHoverValue(-1))},e.toDisplayString(t+1),47,["onClick","onMouseenter"])))),128))])]),e.createElementVNode("div",{style:{marginTop:"10px",marginBottom:"10px"}},e.toDisplayString(-1===a.hoverValue?-1===a.selectValue?"如果满意请给好评哦～":a.desc[a.selectValue]:a.desc[a.hoverValue]),1),e.createElementVNode("button",{class:"submit-button",disabled:a.hasReply||a.hasExpire,onClick:n[1]||(n[1]=(...e)=>a.submitRatingStar&&a.submitRatingStar(...e))}," 提交评价 ",8,["disabled"])]),a.hasReply?(e.openBlock(),e.createElementBlock("p",{key:0,class:"rating-tail",style:{marginTop:"20px"}},e.toDisplayString(a.props.ratingTemplate.tail),1)):e.createCommentVNode("",!0)])}],["__scopeId","data-v-6bee4411"]])},props:{message:{type:Object,default:()=>({})}},emits:["sendMessage"],setup:(t,{emit:n})=>({sendCustomMessage:e=>{n("sendMessage",e)},ratingTemplate:e.computed((()=>{const e=t.message&&ag(t.message.payload.data);return null==e?void 0:e.menuContent})),RATING_TEMPLATE_TYPE:ng})},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("RatingStar"),c=e.resolveComponent("RatingNumber");return a.ratingTemplate.type===a.RATING_TEMPLATE_TYPE.STAR?(e.openBlock(),e.createBlock(r,{key:0,ratingTemplate:a.ratingTemplate,onSendMessage:a.sendCustomMessage},null,8,["ratingTemplate","onSendMessage"])):(e.openBlock(),e.createBlock(c,{key:1,ratingTemplate:a.ratingTemplate,onSendMessage:a.sendCustomMessage},null,8,["ratingTemplate","onSendMessage"]))}]])},props:{message:{type:Object,default:()=>({})}},setup:e=>({props:e,sendTextMessage:e=>{Wr.callService({serviceName:Ar.TUIChat.SERVICE.NAME,method:Ar.TUIChat.SERVICE.METHOD.SEND_TEXT_MESSAGE,params:{payload:e}})},sendCustomMessage:e=>{Wr.callService({serviceName:Ar.TUIChat.SERVICE.NAME,method:Ar.TUIChat.SERVICE.METHOD.SEND_CUSTOM_MESSAGE,params:{payload:e}})},isCustomerServiceMessage:ig,isMessageRating:sg})},[["render",function(t,n,o,a,i,s){const r=e.resolveComponent("MessageRating"),c=e.resolveComponent("MessageCustomerService");return e.openBlock(),e.createElementBlock("div",{class:"message-custom"},[a.isMessageRating(a.props.message)?(e.openBlock(),e.createBlock(r,{key:0,message:a.props.message,onSendMessage:a.sendCustomMessage},null,8,["message","onSendMessage"])):a.isCustomerServiceMessage(a.props.message)?(e.openBlock(),e.createBlock(c,{key:1,message:a.props.message,onSendMessage:a.sendTextMessage},null,8,["message","onSendMessage"])):e.createCommentVNode("",!0)])}]]),Mg=L(e.defineComponent({__name:"message-customer-service",props:{message:{default:()=>({})}},setup(t){const n=t;return(t,o)=>(e.openBlock(),e.createBlock(Tg,{message:n.message},null,8,["message"]))}}),[["__scopeId","data-v-4299f902"]]),Sg=L(e.defineComponent({__name:"message-room-default",props:{message:{default:()=>({})}},setup(t){const n=t;return(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["room-default",e.unref(lu)&&"room-default-uni","in"===n.message.flow?"room-default-in":"room-default-out"])},e.toDisplayString(e.unref(Tr).t("message.custom.自定义消息")),3))}}),[["__scopeId","data-v-3b840b9d"]]),Dg=e.defineComponent({__name:"message-plugin",props:{message:{default:()=>({})},blinkMessageIDList:{default:()=>[]}},emits:["resendMessage","handleToggleMessageItem","handleH5LongPress"],setup(t,{emit:n}){const o=t,a=n,i=e.computed((()=>kr.getMessageModel(o.message.ID))),s=e.computed((()=>{var e;return null==(e=null==i?void 0:i.value)?void 0:e.getSignalingInfo()})),r=e.computed((()=>{var e;return null==(e=null==i?void 0:i.value)?void 0:e.getMessageContent()})),c=e.computed((()=>{var e;let t={pluginType:"",showStyle:""};return ug(i.value)?t={pluginType:"call",showStyle:(null==(e=i.value)?void 0:e.conversationType)===Cr.TYPES.CONV_GROUP?"tip":"bubble"}:dg(i.value)?t={pluginType:"room",showStyle:"bubble"}:lg(i.value)&&(t={pluginType:"customer",showStyle:rg(i.value)?"":"bubble"}),t})),l=e=>{a("resendMessage",e)},u=(e,t,n=!1)=>{a("handleToggleMessageItem",e,t,n)},d=(e,t,n)=>{a("handleH5LongPress",e,t,n)};return(t,n)=>(e.openBlock(),e.createBlock(gg,{message:o.message,showStyle:c.value.showStyle,bubbleClassNameList:["room"===c.value.pluginType?"message-bubble-room":""],onResendMessage:l,onHandleToggleMessageItem:u,onHandleH5LongPress:d},{messageTip:e.withCtx((()=>[e.createVNode(mg,{message:o.message,signalingInfo:s.value,customContent:r.value,blinkMessageIDList:o.blinkMessageIDList},null,8,["message","signalingInfo","customContent","blinkMessageIDList"])])),messageBubble:e.withCtx((()=>["call"===c.value.pluginType?(e.openBlock(),e.createBlock(Eg,{key:0,message:o.message,signalingInfo:s.value,customContent:r.value},null,8,["message","signalingInfo","customContent"])):e.createCommentVNode("",!0),"customer"===c.value.pluginType?(e.openBlock(),e.createBlock(Mg,{key:1,message:o.message},null,8,["message"])):e.createCommentVNode("",!0),"room"===c.value.pluginType?(e.openBlock(),e.createBlock(Sg,{key:2,message:o.message},null,8,["message"])):e.createCommentVNode("",!0)])),_:1},8,["message","showStyle","bubbleClassNameList"]))}}),bg=L(Dg,[["__scopeId","data-v-0356bd97"]]),wg="/assets/icon-close.00e2ef94.svg",Ng=L(e.defineComponent({__name:"index",props:{isFetching:{type:Boolean,default:!1},isTerminateObserve:{type:Boolean,default:!1}},emits:["onExposed"],setup(t,{emit:n}){var o;const a=n,i=t;let s=null;const r=e.ref(),c=(null==(o=e.getCurrentInstance())?void 0:o.proxy)||e.getCurrentInstance();return e.onMounted((()=>{i.isTerminateObserve||(lu?(s=uni.createIntersectionObserver(c).relativeToViewport(),s.observe(".fetch-more-block",(()=>{a("onExposed")}))):(s=new IntersectionObserver((([e])=>{e.isIntersecting&&a("onExposed")}),{threshold:1}),r.value&&s.observe(r.value)))})),e.onUnmounted((()=>{s&&(s.disconnect(),s=null)})),e.watch((()=>i.isTerminateObserve),(e=>{s&&(e?s.disconnect():r.value&&(s.disconnect(),lu?s.observe(".fetch-more-block",(()=>{a("onExposed")})):s.observe(r.value)))})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"selfDomRef",ref:r,class:"fetch-more-block"},[i.isFetching?e.renderSlot(t.$slots,"fetching",{key:0},(()=>[e.createElementVNode("div",null,e.toDisplayString(e.unref(Tr).t("TUIChat.正在加载")),1)]),!0):e.renderSlot(t.$slots,"fetchEnd",{key:1},(()=>[e.createElementVNode("div",null,e.toDisplayString(e.unref(Tr).t("TUIChat.加载结束")),1)]),!0)],512))}}),[["__scopeId","data-v-5db1ae57"]]),Lg=L(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},emits:["setReadReceiptPanelVisible"],setup(t,{emit:n}){const o=n,a=t;let i="",s="";const r=["unread","read"],c={unread:!1,read:!1,close:!1},l=e.ref(!1),u=e.ref(!1),d=e.ref(!1),p=e.ref(!1),h=e.ref("unread"),g=e.ref({read:{tabName:Tr.t("TUIChat.已读"),count:void 0,memberList:[]},unread:{tabName:Tr.t("TUIChat.未读"),count:void 0,memberList:[]},close:{tabName:Tr.t("TUIChat.关闭"),count:void 0,memberList:[]}});async function m(e="all"){const t=kr.getMessageModel(a.message.ID);let n={},o={};"all"!==e&&"unread"!==e||(n=await Dr.getGroupMessageReadMemberList({message:t,filter:1,cursor:i,count:100}),n&&(i=n.data.cursor,n.data.isCompleted&&(c.unread=!0))),"all"!==e&&"read"!==e||(o=await Dr.getGroupMessageReadMemberList({message:t,filter:0,cursor:s,count:100}),o&&(s=o.data.cursor,o.data.isCompleted&&(c.read=!0)));const{unreadCount:r,readCount:l}=t.readReceiptInfo;return{unreadResult:{count:r,...n.data},readResult:{count:l,...o.data}}}async function f(){if(!c[h.value]&&!l.value&&(l.value=!0,"unread"===h.value||"read"===h.value)){const{unreadResult:e,readResult:t}=await m(h.value);_();try{g.value.unread.memberList=g.value.unread.memberList.concat(e.unreadUserInfoList||[]),g.value.read.memberList=g.value.read.memberList.concat(t.readUserInfoList||[])}finally{l.value=!1}}}async function v(){i="",s="",p.value=!1,c.unread=!1,c.read=!1;const{unreadResult:e,readResult:t}=await m("all");_(),y("read",t.count,t.readUserInfoList),y("unread",e.count,e.unreadUserInfoList),y("close")}function _(){c.read&&c.unread&&(p.value=!0)}function y(e,t,n){g.value[e].count=t,g.value[e].memberList=n||[]}function I(){u.value=!0,setTimeout((()=>{o("setReadReceiptPanelVisible",!1)}),200)}return e.onMounted((async()=>{await v(),e.nextTick((()=>{d.value=!0}))})),e.watch((()=>a.message.readReceiptInfo.readCount),(()=>{v()})),(t,n)=>(e.openBlock(),e.createBlock(Gd,{maskColor:"transparent",onOnOverlayClick:I},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass({"read-receipt-panel":!0,"read-receipt-panel-mobile":e.unref(uu),"read-receipt-panel-uni":e.unref(lu),"read-receipt-panel-close-mobile":e.unref(uu)&&u.value})},[e.createElementVNode("div",{class:"header"},[e.createElementVNode("div",{class:"header-text"},e.toDisplayString(e.unref(Tr).t("TUIChat.消息详情")),1),e.createElementVNode("div",{class:"header-close-icon"},[e.createVNode(pu,{size:"12px",hotAreaSize:"8",file:e.unref(wg),onOnClick:I},null,8,["file"])])]),e.createElementVNode("div",{class:"read-status-counter-container"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(r,(t=>e.createElementVNode("div",{key:t,class:e.normalizeClass({"read-status-counter":!0,active:t===h.value}),onClick:e=>function(e){h.value=e}(t)},[e.createElementVNode("div",{class:"status-text"},e.toDisplayString(g.value[t].tabName),1),e.createElementVNode("div",{class:"status-count"},e.toDisplayString(void 0===g.value[t].count?"":g.value[t].count),1)],10,["onClick"]))),64))]),e.createElementVNode("div",{class:"read-status-member-list"},[0===g.value[h.value].count&&d.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"empty-list-tip"}," - "+e.toDisplayString(e.unref(Tr).t("TUIChat.空"))+" - ",1)):d.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},["unread"===h.value?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(g.value[h.value].memberList,(t=>(e.openBlock(),e.createElementBlock("div",{key:t.userID,class:"read-status-member-container"},[e.createVNode(Pd,{class:"read-status-avatar",useSkeletonAnimation:"",url:t.avatar||""},null,8,["url"]),e.createElementVNode("div",{class:"username"},e.toDisplayString(t.nick||t.userID),1)])))),128)):e.createCommentVNode("",!0),"read"===h.value?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(g.value[h.value].memberList,(t=>(e.openBlock(),e.createElementBlock("div",{key:t.userID,class:"read-status-member-container"},[e.createVNode(Pd,{class:"read-status-avatar",useSkeletonAnimation:"",url:t.avatar},null,8,["url"]),e.createElementVNode("div",{class:"username"},e.toDisplayString(t.nick||t.userID),1)])))),128)):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0),d.value?(e.openBlock(),e.createElementBlock("div",{key:2,class:"fetch-more-container"},[e.createVNode(Ng,{isFetching:l.value,isTerminateObserve:p.value,onOnExposed:f},null,8,["isFetching","isTerminateObserve"])])):e.createCommentVNode("",!0)])],2)])),_:1}))}}),[["__scopeId","data-v-175d669d"]]),Rg=e.defineComponent({__name:"index",emits:["scrollToLatestMessage"],setup(t,{expose:n,emit:o}){const a=o,i=e.ref([]),s=e.ref(""),r=e.ref(0),c=e.ref(0),l=e.ref(!1),u=e.ref(!1),d=e.ref(!1),p=e.computed((()=>c.value?`${c.value}${Tr.t("TUIChat.条新消息")}`:Tr.t("TUIChat.回到最新位置")));function h(e){var t,n;i.value=e||[];const o=null==(n=i.value)?void 0:n[(null==(t=i.value)?void 0:t.length)-1];u.value=!!(o&&(null==o?void 0:o.time)<(null==r?void 0:r.value))}function g(e){Array.isArray(e)&&d.value&&e.forEach((e=>{!e||e.conversationID!==s.value||e.isDeleted||e.isRevoked||function(e){var t,n;return"user_typing_status"===(null==(n=ld(null==(t=e.payload)?void 0:t.data))?void 0:n.businessID)}(e)||(c.value+=1)}))}function m(e){var t;(null==e?void 0:e.conversationID)!==s.value&&f(),s.value=(null==e?void 0:e.conversationID)||"",r.value=(null==(t=null==e?void 0:e.lastMessage)?void 0:t.lastTime)||0}function f(){c.value=0}function v(){void 0!==kr.getData(oi.CHAT,"messageSource")&&kr.update(oi.CHAT,"messageSource",void 0),f(),a("scrollToLatestMessage")}return e.watch((()=>[l.value,u.value]),(()=>{d.value=l.value||u.value,d.value||f()}),{immediate:!0}),e.onMounted((()=>{kr.watch(oi.CHAT,{messageList:h,newMessageList:g}),kr.watch(oi.CONV,{currentConversation:m})})),e.onUnmounted((()=>{kr.unwatch(oi.CHAT,{messageList:h,newMessageList:g}),kr.unwatch(oi.CONV,{currentConversation:m})})),n({judgeScrollOverOneScreen:async function(e){var t,n,o,a,i;if(e.target)try{const{height:s}=await eu(`#${null==(t=e.target)?void 0:t.id}`,"messageList")||{},r=(null==(n=e.target)?void 0:n.scrollHeight)||(null==(o=e.detail)?void 0:o.scrollHeight);if(r-((null==(a=e.target)?void 0:a.scrollTop)||(null==(i=e.detail)?void 0:i.scrollTop)||0)>2*s)return void(l.value=!0);l.value=!1}catch(s){l.value=!1}},isScrollButtonVisible:d}),(t,n)=>d.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"scroll-button",onClick:v},[e.createVNode(pu,{width:"10px",height:"10px",file:e.unref("/assets/double-arrow.a1a15b8b.svg")},null,8,["file"]),e.createElementVNode("div",{class:"scroll-button-text"},e.toDisplayString(p.value),1)])):e.createCommentVNode("",!0)}}),Ag=L(Rg,[["__scopeId","data-v-3ddb8410"]]),Og=L(e.defineComponent({__name:"index",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},setup(t){const n=t;return(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:"progress-message"},[e.renderSlot(t.$slots,"default",{},void 0,!0),"unSend"===n.messageItem.status&&n.messageItem.progress<1?(e.openBlock(),e.createElementBlock("div",{key:0,class:"progress-container"},[e.unref(lu)?(e.openBlock(),e.createElementBlock("progress",{key:1,activeColor:"#006EFF",class:"progress-common",percent:Math.round(100*n.messageItem.progress)},null,8,["percent"])):(e.openBlock(),e.createElementBlock("progress",{key:0,class:"progress",value:n.messageItem.progress,max:"1"},null,8,["value"]))])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-952aeaa7"]]),Ug=class e{constructor(){this.chatStorage=null}static getInstance(){return e.instance||(e.instance=new e),e.instance}getChatStorage(e){if(this.chatStorage||(this.chatStorage=this.getChatStorageFromLocalStorage()),e)return this.chatStorage[e];throw new Error("No key provided")}setChatStorage(t,n){this.chatStorage||(this.chatStorage=this.getChatStorageFromLocalStorage()),this.chatStorage[t]=n;try{lu?Fl.setStorageSync(e.CHAT_STORAGE_KEY,JSON.stringify(this.chatStorage)):localStorage.setItem(e.CHAT_STORAGE_KEY,JSON.stringify(this.chatStorage))}catch(o){throw new Error("Fail to set chat storage")}}getChatStorageFromLocalStorage(){let t="";if(t=lu?Fl.getStorageSync(e.CHAT_STORAGE_KEY)||"":localStorage.getItem(e.CHAT_STORAGE_KEY)||"",!t)return{};try{this.chatStorage=JSON.parse(t)}catch(n){this.chatStorage={}}return this.chatStorage}};Ug.instance=null,Ug.CHAT_STORAGE_KEY="TUI_CHAT_STORAGE";const Pg=Ug.getInstance(),Gg=e.defineComponent({__name:"index",props:{isGroup:{type:Boolean,default:!1},groupID:{default:""},isNotInGroup:{type:Boolean,default:!1},isMultipleSelectMode:{type:Boolean,default:!1}},emits:["closeInputToolBar","handleEditor","toggleMultipleSelectMode"],setup(t,{expose:n,emit:o}){var a;const i=o,s=t;let r,c=0,l=null;const u=new Set,d=kr.getData(oi.APP,"isOfficial"),p=(null==(a=e.getCurrentInstance())?void 0:a.proxy)||e.getCurrentInstance(),h=e.ref(),g=e.ref([]),m=e.ref(!1),f=e.ref(""),v=e.ref(""),_=e.ref(5e3),y=e.ref(Cr.TYPES),I=e.ref(!1),E=e.ref(!1),C=e.ref([]),k=e.ref(),T=e.ref(),M=e.ref(""),S=e.ref(!1),D=e.ref(),b=e.ref({}),w=e.ref(""),N=e.ref(),L=e.ref(!1),R=e.ref(!1),A=e.ref(),O=()=>{_.value+=300;const e=setTimeout((()=>{_.value+=1,clearTimeout(e)}),300)},U=e=>{if(f.value=e,Cp()){const{groupProfile:t}=kr.getConversationModel(e)||{};r=null==t?void 0:t.type}Object.keys(b.value).length>0&&Pg.setChatStorage("audioPlayedMapping",b.value)};e.onMounted((()=>{b.value=Pg.getChatStorage("audioPlayedMapping")||{},kr.watch(oi.CHAT,{messageList:x,messageSource:V,isCompleted:H}),kr.watch(oi.CONV,{currentConversationID:U}),function(e,t){Ql.set(e,t)}("messageList",p),uni.$on("scroll-to-bottom",B)})),e.onUnmounted((()=>{kr.unwatch(oi.CHAT,{messageList:x,isCompleted:H}),kr.unwatch(oi.CONV,{currentConversationID:U}),null==l||l.disconnect(),l=null,uni.$off("scroll-to-bottom"),Object.keys(b.value).length>0&&Pg.setChatStorage("audioPlayedMapping",b.value)}));const P=cp((function(e){var t;null==(t=T.value)||t.judgeScrollOverOneScreen(e)}),500,{leading:!0});function G(e,t){(null==t?void 0:t.newAudioSrc)&&(w.value=t.newAudioSrc)}async function x(t){var n,o,a;null==l||l.disconnect(),h.value=t.filter((e=>!e.isDeleted)).map((e=>(e.vueForRenderKey=`${e.ID}`,e)));const i=null==(o=h.value)?void 0:o[(null==(n=h.value)?void 0:n.length)-1];k.value?F(k.value):I.value||(null==(a=T.value)?void 0:a.isScrollButtonVisible)&&"in"===(null==i?void 0:i.flow)||e.nextTick((()=>{O()})),Cp()&&e.nextTick((()=>async function(){if(!h.value||0===h.value.length)return;if(r===y.value.GRP_AVCHATROOM||r===y.value.GRP_COMMUNITY)return;null==l||l.disconnect(),l=uni.createIntersectionObserver(p,{threshold:[.7],observeAll:!0}).relativeTo("#messageScrollList",{top:-70}),null==l||l.observe(".message-li.in .message-bubble-container",(e=>{var t;if(u.has(e.id))return;const n=h.value.find((t=>e.id.indexOf(t.ID)>-1));n&&n.needReadReceipt&&"in"===n.flow&&!(null==(t=n.readReceiptInfo)?void 0:t.isPeerRead)&&(Dr.sendMessageReadReceipt([n]),u.add(e.id))}))}()))}async function B(){try{const{scrollHeight:e}=await tu("#messageScrollList","messageList");e?_.value===e?_.value=e+1:_.value=e:O()}catch(e){O()}}async function V(e){k.value=e,F(k.value)}function F(t){var n;(null==(n=h.value)?void 0:n.some((e=>(null==e?void 0:e.ID)===(null==t?void 0:t.ID))))&&e.nextTick((async()=>{await async function(e){const t=e.ID,n=h.value&&h.value.some((e=>e.ID===t));if(t&&n){const e=setTimeout((async()=>{try{const n=await eu("#messageScrollList","messageList"),o=await eu("#tui-"+t,"messageList"),{scrollTop:a}=await tu("#messageScrollList","messageList");W(o.top+a-n.top-c++%2),clearTimeout(e)}catch(n){}}),500)}else yd({message:Tr.t("TUIChat.无法定位到原消息"),type:fd})}(t),await Y(null==t?void 0:t.ID),k.value=void 0}))}function H(e){m.value=e}const j=()=>{var t,n;I.value=!0;const o=(null==(n=null==(t=h.value)?void 0:t[0])?void 0:n.ID)||"";Dr.getMessageList().then((()=>{e.nextTick((()=>{M.value=o;const e=setTimeout((()=>{M.value="",I.value=!1,clearTimeout(e)}),500)}))}))},q=(e,t,n,o=!1)=>{s.isMultipleSelectMode||s.isNotInGroup||(o&&(E.value=!0),v.value=t.ID)};let z;const K=(e,t,n,o)=>{if(!s.isMultipleSelectMode&&!s.isNotInGroup&&su)switch(o){case"touchstart":z=setTimeout(a,500);break;case"touchend":clearTimeout(z),setTimeout((()=>{E.value=!1}),200)}function a(){clearTimeout(z),q(0,t,0,!0)}},$=e=>{R.value=!0,A.value=e};function Y(e){return new Promise((t=>{if(C.value.indexOf(e)<0){C.value.push(e);const n=setTimeout((()=>{C.value.splice(C.value.indexOf(e),1),clearTimeout(n),t()}),3e3)}}))}function W(e){_.value=e}function J(e,t){e&&s.isNotInGroup||(N.value=e?t:void 0,L.value=e)}function X(){i("closeInputToolBar")}function Z({type:e,messageID:t}){"clearAll"===e?g.value=[]:"add"!==e||g.value.includes(t)?"remove"===e&&(g.value=g.value.filter((e=>e!==t))):g.value.push(t)}function Q(e){D.value=e,S.value=!0}function ee(e){b.value[e]=!0}return e.watch((()=>s.isMultipleSelectMode),(e=>{e||Z({type:"clearAll",messageID:""})})),n({oneByOneForwardMessage:function(){kr.update(oi.CUSTOM,"multipleForwardMessageID",{isMergeForward:!1,messageIDList:g.value})},mergeForwardMessage:function(){kr.update(oi.CUSTOM,"multipleForwardMessageID",{isMergeForward:!0,messageIDList:g.value})},scrollToLatestMessage:B}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"tui-chat":!0,"tui-chat-h5":e.unref(uu)}),onClick:X},[e.createElementVNode("div",{class:"tui-chat-main"},[e.unref(d)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-chat-safe-tips"},[e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t("TUIChat.【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。")),1),e.createElementVNode("a",{onClick:n[0]||(n[0]=t=>{e.unref(_h).complaint})},e.toDisplayString(e.unref(Tr).t("TUIChat.点此投诉")),1)])):e.createCommentVNode("",!0),t.isGroup?(e.openBlock(),e.createBlock(Mh,{key:s.groupID,groupID:s.groupID},null,8,["groupID"])):e.createCommentVNode("",!0),e.createElementVNode("scroll-view",{id:"messageScrollList",class:"tui-message-list","scroll-y":"true","scroll-top":_.value,"scroll-into-view":`tui-${M.value}`,onScroll:n[3]||(n[3]=(...t)=>e.unref(P)&&e.unref(P)(...t))},[m.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("p",{key:0,class:"message-more",onClick:j},e.toDisplayString(e.unref(Tr).t("TUIChat.查看更多")),1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,((o,a)=>(e.openBlock(),e.createElementBlock("li",{id:`tui-${o.ID}`,key:o.vueForRenderKey,class:e.normalizeClass("message-li "+o.flow)},[e.createVNode(Jh,{currTime:o.time,prevTime:a>0?h.value[a-1].time:0},null,8,["currTime","prevTime"]),e.createElementVNode("div",{class:"message-item",onClick:n[2]||(n[2]=e=>v.value="")},[o.type===y.value.MSG_GRP_TIP||e.unref(Ep)(o)?(e.openBlock(),e.createBlock(Ah,{key:0,content:o.getMessageContent()},null,8,["content"])):o.isRevoked||e.unref(pg)(o)?!o.isRevoked&&e.unref(pg)(o)?(e.openBlock(),e.createBlock(bg,{key:2,message:o,onResendMessage:$,onHandleToggleMessageItem:q,onHandleH5LongPress:K},null,8,["message"])):(e.openBlock(),e.createBlock(eg,{key:3,isEdit:o.type===y.value.MSG_TEXT,messageItem:o,onMessageEdit:e=>{i("handleEditor",o,"reedit")}},null,8,["isEdit","messageItem","onMessageEdit"])):(e.openBlock(),e.createElementBlock("div",{key:1,id:`msg-bubble-${o.ID}`,class:"message-bubble-container",onLongpress:e=>q(0,o,0,!0),onTouchstart:e=>K(0,o,0,"touchstart"),onTouchend:e=>K(0,o,0,"touchend"),onMouseover:e=>K(0,o,0,"touchend")},[e.createVNode(Yh,{messageItem:e.unref(Ip)(o),content:o.getMessageContent(),isAudioPlayed:b.value[o.ID],blinkMessageIDList:C.value,isMultipleSelectMode:t.isMultipleSelectMode,multipleSelectedMessageIDList:g.value,onResendMessage:e=>$(o),onBlinkMessage:Y,onScrollTo:W,onChangeSelectMessageIDList:Z,onSetReadReceiptPanelVisible:J},{default:e.withCtx((()=>[o.type===y.value.MSG_TEXT?(e.openBlock(),e.createBlock(Sh,{key:0,content:o.getMessageContent()},null,8,["content"])):o.type===y.value.MSG_IMAGE?(e.openBlock(),e.createBlock(Og,{key:1,content:o.getMessageContent(),messageItem:e.unref(Ip)(o)},{default:e.withCtx((()=>[e.createVNode(bh,{content:o.getMessageContent(),messageItem:o,onPreviewImage:e=>(e=>{if(!h.value)return;const t=[],n=h.value.filter(((e,n)=>!e.isRevoked&&!e.hasRiskContent&&e.type===y.value.MSG_IMAGE&&(t.push(n),!0)));uni.previewImage({current:t.indexOf(e),urls:n.map((e=>{var t;return null==(t=e.payload.imageInfoArray)?void 0:t[2].url})),indicator:"number"})})(a)},null,8,["content","messageItem","onPreviewImage"])])),_:2},1032,["content","messageItem"])):o.type===y.value.MSG_VIDEO?(e.openBlock(),e.createBlock(Og,{key:2,content:o.getMessageContent(),messageItem:e.unref(Ip)(o)},{default:e.withCtx((()=>[e.createVNode(Xh,{content:o.getMessageContent(),messageItem:o},null,8,["content","messageItem"])])),_:2},1032,["content","messageItem"])):o.type===y.value.MSG_AUDIO?(e.openBlock(),e.createBlock(wh,{key:3,content:o.getMessageContent(),messageItem:o,broadcastNewAudioSrc:w.value,onSetAudioPlayed:ee,onGetGlobalAudioContext:G},null,8,["content","messageItem","broadcastNewAudioSrc"])):o.type===y.value.MSG_MERGER?(e.openBlock(),e.createBlock(Ch,{key:4,renderData:o.payload,messageItem:o,onAssignMessageIDInUniapp:Q},null,8,["renderData","messageItem"])):o.type===y.value.MSG_FILE?(e.openBlock(),e.createBlock(Nh,{key:5,content:o.getMessageContent()},null,8,["content"])):o.type===y.value.MSG_FACE?(e.openBlock(),e.createBlock(Lh,{key:6,content:o.getMessageContent()},null,8,["content"])):o.type===y.value.MSG_LOCATION?(e.openBlock(),e.createBlock(Wh,{key:7,content:o.getMessageContent()},null,8,["content"])):o.type===y.value.MSG_CUSTOM?(e.openBlock(),e.createBlock(Rh,{key:8,content:o.getMessageContent(),messageItem:o},null,8,["content","messageItem"])):e.createCommentVNode("",!0)])),_:2},1032,["messageItem","content","isAudioPlayed","blinkMessageIDList","isMultipleSelectMode","multipleSelectedMessageIDList","onResendMessage"])],40,["id","onLongpress","onTouchstart","onTouchend","onMouseover"])),o.ID===v.value?(e.openBlock(),e.createBlock(Qh,{key:4,class:e.normalizeClass({"message-tool":!0,"message-tool-out":"out"===o.flow,"message-tool-in":"in"===o.flow}),messageItem:o,isMultipleSelectMode:t.isMultipleSelectMode,onToggleMultipleSelectMode:n[1]||(n[1]=()=>i("toggleMultipleSelectMode"))},null,8,["class","messageItem","isMultipleSelectMode"])):e.createCommentVNode("",!0)])],10,["id"])))),128))],40,["scroll-top","scroll-into-view"]),e.createVNode(Ag,{ref_key:"scrollButtonInstanceRef",ref:T,onScrollToLatestMessage:B},null,512),R.value?(e.openBlock(),e.createBlock(xd,{key:2,show:R.value,isH5:!e.unref(iu),center:!0,isHeaderShow:e.unref(iu),onSubmit:n[4]||(n[4]=e=>(R.value=!R.value,void A.value.resendMessage())),"onUpdate:show":n[5]||(n[5]=e=>R.value=e)},{default:e.withCtx((()=>[e.createElementVNode("p",{class:"delDialog-title"},e.toDisplayString(e.unref(Tr).t("TUIChat.确认重发该消息？")),1)])),_:1},8,["show","isH5","isHeaderShow"])):e.createCommentVNode("",!0),L.value?(e.openBlock(),e.createBlock(Lg,{key:3,message:Object.assign({},N.value),onSetReadReceiptPanelVisible:J},null,8,["message"])):e.createCommentVNode("",!0),e.createVNode(Eh,{visible:S.value,overlayColor:"transparent",popDirection:"right"},{default:e.withCtx((()=>[e.createVNode(Th,{style:{height:"100%"},isMounted:S.value,messageID:D.value,onCloseOverlay:n[6]||(n[6]=e=>S.value=!1)},null,8,["isMounted","messageID"])])),_:1},8,["visible"])])],2))}}),xg=L(Gg,[["__scopeId","data-v-a9332d71"]]),Bg=class e{constructor(){this.quoteMessageMap=new Map}static getInstance(){return e.instance||(e.instance=new e),e.instance}setStore(e,t,n,o){var a,i;if(e&&(this.isEditorNotEmpty(t)||(null==(a=null==o?void 0:o.message)?void 0:a.ID))){let a={};(null==(i=null==o?void 0:o.message)?void 0:i.ID)&&(this.quoteMessageMap.set(o.message.ID,o.message),a={messageID:o.message.ID,type:o.type});const s={conversationID:e,draftInfo:{html:t,abstract:n,...a}};Mr.setConversationDraft(s),kr.update(oi.CHAT,"quoteMessage",{message:void 0,type:"quote"})}}getStore(e,t){const n=kr.getConversationModel(e);if(n){if(n.conversationID&&n.draftText){const e=ld(n.draftText);kr.update(oi.CHAT,"quoteMessage",{message:this.quoteMessageMap.get(e.messageID)||void 0,type:e.type}),t(e.html)}Mr.setConversationDraft({conversationID:n.conversationID})}}generateAbstract(e){let t="";return null==e||e.forEach((e=>{switch(e.type){case"text":t+=od(e.payload.text||"");break;case"image":t+=Tr.t("TUIChat.图片");break;case"video":t+=Tr.t("TUIChat.视频");break;case"file":t+=Tr.t("TUIChat.文件")}})),t}isEditorNotEmpty(e){return e&&!e.includes("is-empty")&&"<p></p>"!==e}};Bg.instance=null;const Vg=Bg.getInstance(),Fg=new Map([[3123,"文本包含本地审核拦截词"],[4004,"图片消息失败,无效的图片格式"],[4005,"文件消息失败,禁止发送违规封禁的文件"],[7004,"文件不存在,请检查文件路径是否正确"],[7005,"文件大小超出了限制,如果上传文件,最大限制是100MB"],[8001,"消息长度超出限制,消息长度不要超过12K"],[80001,"消息或者资料中文本存在敏感内容,发送失败"],[80004,"消息中图片存在敏感内容,发送失败"]]),Hg=e.defineComponent({__name:"message-input-editor",props:{placeholder:{type:String,default:"this is placeholder"},replayOrReferenceMessage:{type:Object,default:()=>({}),required:!1},isMuted:{type:Boolean,default:!0},muteText:{type:String,default:""},enableInput:{type:Boolean,default:!0},enableAt:{type:Boolean,default:!0},enableTyping:{type:Boolean,default:!0},isGroup:{type:Boolean,default:!1}},emits:["onTyping","onFocus","onAt"],setup(t,{expose:n,emit:o}){const a=t,i=o,s=e.ref(""),r=e.ref(),c=e.ref(!0),l=e.ref(!0),u=new Map,d=e.ref(),p=e.ref(""),h=e.ref();e.onMounted((()=>{kr.watch(oi.CONV,{currentConversation:E}),kr.watch(oi.CHAT,{quoteMessage:C}),uni.$on("insert-emoji",(e=>{var t;s.value+=null==(t=null==e?void 0:e.emoji)?void 0:t.name})),uni.$on("send-message-in-emoji-picker",(()=>{g()}))})),e.onUnmounted((()=>{p.value&&Vg.setStore(p.value,s.value,s.value,h.value),uni.$off("insertEmoji"),uni.$off("send-message-in-emoji-picker"),kr.unwatch(oi.CONV,{currentConversation:E}),kr.unwatch(oi.CHAT,{quoteMessage:C}),c.value=!0,d.value=null,p.value="",h.value=null,f()}));const g=()=>{const e=m();f(),(async(e,t)=>{kr.getData(oi.CHAT,"messageSource")&&kr.update(oi.CHAT,"messageSource",void 0),null==e||e.forEach((async e=>{var n,o,a,i,s,r,c;try{const l={to:(null==(n=null==t?void 0:t.groupProfile)?void 0:n.groupID)||(null==(o=null==t?void 0:t.userProfile)?void 0:o.userID),conversationType:null==t?void 0:t.type,payload:{},needReadReceipt:Cp()};let u;const d={offlinePushInfo:{}},p={conversation:t,payload:e.payload,messageType:""};switch(null==e?void 0:e.type){case"text":if(u=JSON.parse(JSON.stringify(null==(a=e.payload)?void 0:a.text)),!u)break;l.payload={text:u},p.messageType=Cr.TYPES.MSG_TEXT,d.offlinePushInfo=Ig.create(p),(null==(i=e.payload)?void 0:i.atUserList)?(l.payload.atUserList=e.payload.atUserList,await Dr.sendTextAtMessage(l,d)):await Dr.sendTextMessage(l,d);break;case"image":l.payload={file:null==(s=e.payload)?void 0:s.file},p.messageType=Cr.TYPES.MSG_IMAGE,d.offlinePushInfo=Ig.create(p),await Dr.sendImageMessage(l,d);break;case"video":l.payload={file:null==(r=e.payload)?void 0:r.file},p.messageType=Cr.TYPES.MSG_VIDEO,d.offlinePushInfo=Ig.create(p),await Dr.sendVideoMessage(l,d);break;case"file":l.payload={file:null==(c=e.payload)?void 0:c.file},p.messageType=Cr.TYPES.MSG_FILE,d.offlinePushInfo=Ig.create(p),await Dr.sendFileMessage(l,d)}Nd("sendMessage")}catch(l){yd({message:Fg.get(null==l?void 0:l.code)?Tr.t(`TUIChat.${Fg.get(l.code)}`):null==l?void 0:l.message,type:vd}),kr.getData(oi.CHAT,"quoteMessage")&&kr.update(oi.CHAT,"quoteMessage",{})}}))})(e,d.value)},m=()=>{let e=s.value;e=(e=>{if(!e)return"";const t=/(\[.+?\])/g;let n=e;return t.test(e)&&(n=e.replace(t,(e=>Zu[e]||e))),n})(e);const t=[];null==u||u.forEach(((n,o)=>{(null==e?void 0:e.includes("@"+n))&&t.push(o)}));const n={text:e};return(null==t?void 0:t.length)&&(n.atUserList=t),[{type:"text",payload:n}]},f=()=>{s.value="",l.value=!0,null==u||u.clear()},v=e=>{s.value=e},_=()=>{c.value=!0},y=e=>{var t;c.value=!1,i("onFocus",null==(t=null==e?void 0:e.detail)?void 0:t.height)},I=e=>{var t;const n=null==(t=null==e?void 0:e.detail)?void 0:t.value;(()=>{var e;l.value=!(null==(e=null==s?void 0:s.value)?void 0:e.length)})(),a.isGroup&&(n.endsWith("@")||n.endsWith("@\n"))&&(null==Fl||Fl.hideKeyboard(),i("onAt",!0))};function E(e){const t=p.value;d.value=e,p.value=null==e?void 0:e.conversationID,t!==p.value&&(t&&Vg.setStore(t,s.value,s.value,h.value),f(),p.value&&Vg.getStore(p.value,v))}function C(e){h.value=e}return e.watch((()=>[l.value,c.value]),((e,t)=>{e!==t&&i("onTyping",l.value,c.value)}),{immediate:!0,deep:!0}),n({insertAt:e=>{(null==u?void 0:u.has(null==e?void 0:e.id))||null==u||u.set(null==e?void 0:e.id,null==e?void 0:e.label),s.value+=null==e?void 0:e.label},resetEditor:f,setEditorContent:v,getEditorContent:m}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"message-input-container":!0,"message-input-container-h5":!e.unref(iu)})},[a.isMuted?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-input-mute"},e.toDisplayString(a.muteText),1)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",{id:"editor",ref_key:"inputRef",ref:r,"onUpdate:modelValue":n[0]||(n[0]=e=>s.value=e),"adjust-position":!0,"cursor-spacing":"20","confirm-type":"send","confirm-hold":!0,maxlength:"140",type:"text","placeholder-class":"input-placeholder",class:"message-input-area",placeholder:a.placeholder,"auto-blur":"",onConfirm:g,onInput:I,onBlur:_,onFocus:y},null,40,["placeholder"]),[[e.vModelText,s.value]])],2))}}),jg=L(Hg,[["__scopeId","data-v-373d8ac3"]]),qg=L(e.defineComponent({__name:"index",props:{show:{type:Boolean,default:!1},modal:{type:Boolean,default:!0},height:{type:String,default:"fit-content"},closeByClickOutside:{type:Boolean,default:!0},borderRadius:{type:String,default:"0px"},title:{type:String,default:""},showHeaderCloseButton:{type:Boolean,default:!1},showFooterSubmitButton:{type:Boolean,default:!1},submitButtonContent:{type:String,default:()=>Tr.t("确定")}},emits:["onOpen","onClose","onSubmit"],setup(t,{emit:n}){const o=t,a=n,i=e.ref();e.watch((()=>o.show),((t,n)=>{if(t!==n)switch(t){case!0:a("onOpen",i),e.nextTick((()=>{su&&!lu&&o.closeByClickOutside&&au.listen({domRefs:i.value,handler:s})}));break;case!1:a("onClose",i)}}));const s=()=>{(lu||su)&&a("onClose",i)},r=()=>{a("onSubmit"),s()};return(n,a)=>o.show?(e.openBlock(),e.createElementBlock("div",{key:0},[e.unref(iu)?e.renderSlot(n.$slots,"default",{key:1},void 0,!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["bottom-popup",!e.unref(iu)&&"bottom-popup-h5",!e.unref(iu)&&o.modal&&"bottom-popup-modal",e.unref(lu)&&"bottom-popup-uni"]),onClick:s},[e.createElementVNode("div",{ref_key:"dialogRef",ref:i,class:e.normalizeClass(["bottom-popup-main",!e.unref(iu)&&"bottom-popup-h5-main"]),style:e.normalizeStyle({height:o.height,borderTopLeftRadius:o.borderRadius,borderTopRightRadius:o.borderRadius}),onClick:a[0]||(a[0]=e.withModifiers((()=>{}),["stop"]))},[t.title||t.showHeaderCloseButton?(e.openBlock(),e.createElementBlock("div",{key:0,class:"header"},[t.title?(e.openBlock(),e.createElementBlock("div",{key:0,class:"header-title"},e.toDisplayString(t.title),1)):e.createCommentVNode("",!0),t.showHeaderCloseButton?(e.openBlock(),e.createElementBlock("div",{key:1,class:"header-close",onClick:s},e.toDisplayString(e.unref(Tr).t("关闭")),1)):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),e.renderSlot(n.$slots,"default",{},void 0,!0),t.showFooterSubmitButton?(e.openBlock(),e.createElementBlock("div",{key:1,class:"footer"},[e.createElementVNode("div",{class:"footer-submit",onClick:r},e.toDisplayString(t.submitButtonContent),1)])):e.createCommentVNode("",!0)],6)],2))])):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-48ae20a8"]]),zg=L(e.defineComponent({__name:"index",emits:["onAtListOpen","insertAt"],setup(t,{expose:n,emit:o}){const a=o,i=e.ref(),s=e.ref(),r=e.ref(!1),c=e.ref(),l=e.ref(),u=e.ref(),d=e.ref(!1),p=e.ref({left:0,top:0}),h=e.ref(0),g=e.ref(""),m={userID:Cr.TYPES.MSG_AT_ALL,nick:"所有人",isAll:!0,avatar:"https://web.sdk.qcloud.com/im/assets/images/at.svg"};kr.watch(oi.CONV,{currentConversationID:e=>{var t,n;if(e!==g.value)if(g.value=e,c.value=[],l.value=[],u.value=[],d.value=!1,kr.update(oi.CUSTOM,"memberList",c.value),null==(t=null==g?void 0:g.value)?void 0:t.startsWith("GROUP")){d.value=!0;const e=null==(n=null==g?void 0:g.value)?void 0:n.substring(5);br.switchGroup(e)}else br.switchGroup("")}}),kr.watch(oi.GRP,{currentGroupMemberList:e=>{c.value=e,l.value=[m,...c.value],u.value=l.value,kr.update(oi.CUSTOM,"memberList",c.value)}});const f=e=>{d.value&&(r.value=e,r.value&&a("onAtListOpen"))};Fl.toggleAtList=f,Fl.handleAtListPosition=e=>{p.value=e},Fl.setCurrentSelectIndex=e=>{var t,n;h.value=e,null==(n=null==(t=s.value)?void 0:t[h.value])||n.scrollIntoView(!1)},Fl.setShowMemberList=e=>{u.value=e},n({toggleAtList:f}),e.watch((()=>[p.value,null==i?void 0:i.value]),(()=>{var e;!su&&(null==i?void 0:i.value)&&(null==(e=null==i?void 0:i.value)?void 0:e.style)&&(i.value.style.left=p.value.left+"px",i.value.style.top=p.value.top-i.value.clientHeight+"px")}));const v=()=>{r.value=!1,u.value=l.value,p.value={left:0,top:0}},_=e=>(null==e?void 0:e.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",y=e=>(null==e?void 0:e.nick)?null==e?void 0:e.nick:null==e?void 0:e.userID;return(t,n)=>(e.openBlock(),e.createBlock(qg,{show:r.value,onOnClose:v},{default:e.withCtx((()=>[e.createElementVNode("div",{ref_key:"MessageInputAt",ref:i,class:e.normalizeClass([e.unref(iu)?"message-input-at":"message-input-at-h5"])},[e.createElementVNode("div",{ref:"dialog",class:"member-list"},[e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("header",{key:0,class:"member-list-title"},[e.createElementVNode("span",{class:"title"},e.toDisplayString(e.unref(Tr).t("TUIChat.选择提醒的人")),1)])),e.createElementVNode("ul",{class:"member-list-box"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,ref_for:!0,ref_key:"memberListItems",ref:s,class:e.normalizeClass(["member-list-box-body",[n===h.value&&"selected"]]),onClick:e=>(e=>{var t;if(iu&&Fl.selectItem)Fl.selectItem(e);else if(null==(t=null==u?void 0:u.value)?void 0:t.length){const t=null==u?void 0:u.value[e];a("insertAt",{id:null==t?void 0:t.userID,label:(null==t?void 0:t.nick)||(null==t?void 0:t.userID)})}v()})(n)},[e.createElementVNode("img",{class:"member-list-box-body-avatar",src:_(t)},null,8,["src"]),e.createElementVNode("span",{class:"member-list-box-body-name"},e.toDisplayString(y(t)),1)],10,["onClick"])))),128))])],512)],2)])),_:1},8,["show"]))}}),[["__scopeId","data-v-1c393c5e"]]),Kg=e.defineComponent({__name:"message-input-audio",props:{isEnableAudio:{type:Boolean,default:!1}},emits:["changeDisplayType"],setup(t,{emit:n}){const o=n,a=t;let i,s=0,r=!1,c=-1,l=!1,u=!1;const d=null==Fl?void 0:Fl.getRecorderManager(),p=e.ref(!1),h=e.ref("按住说话"),g=e.ref("正在录音"),m=e.ref(!1),f=e.ref(),v={duration:6e4,sampleRate:44100,numberOfChannels:1,encodeBitRate:192e3,format:"mp3"};function _(){o("changeDisplayType",a.isEnableAudio?"editor":"audio")}function y(e){f.value=e}function I(){C(),E()}function E(){p.value=!1,h.value="按住说话",g.value="正在录音"}function C(e){clearInterval(i),i=void 0,s=0,c=-1,r=!1,(null==e?void 0:e.hasError)||d.stop()}function k(){l&&(u=!0)}function T(){l=!0,d.start(v)}e.onMounted((()=>{d.onStart(D),d.onStop(b),d.onError(w),kr.watch(oi.CONV,{currentConversation:y})})),e.onUnmounted((()=>{kr.unwatch(oi.CONV,{currentConversation:y})}));const M=cp((function(e){if(p.value){const t=e.changedTouches[e.changedTouches.length-1].pageY;c<0&&(c=t);const n=c-t;n>150?(h.value="抬起取消",g.value="松开手指 取消发送",r=!0):n>50?(h.value="抬起发送",g.value="继续上滑可取消",r=!1):(h.value="抬起发送",g.value="正在录音",r=!1)}}),100);function S(){l=!1,d.stop()}function D(){if(!l)return u=!0,void d.stop();i=setInterval((()=>{s+=1}),1e3),h.value="抬起发送",p.value=!0}function b(e){var t,n,o,a,c;if(u)return u=!1,void I();if(r||!p.value)return void I();clearInterval(i);const l=e.tempFilePath,d=e.duration?e.duration:1e3*s,h=e.fileSize?e.fileSize:48*s/8*1024;if(d<1e3)yd({message:"录音时间太短",type:_d,duration:1500});else{const e={to:(null==(n=null==(t=null==f?void 0:f.value)?void 0:t.groupProfile)?void 0:n.groupID)||(null==(a=null==(o=null==f?void 0:f.value)?void 0:o.userProfile)?void 0:a.userID),conversationType:null==(c=null==f?void 0:f.value)?void 0:c.type,payload:{file:{duration:d,tempFilePath:l,fileSize:h}},needReadReceipt:Cp()};null==Dr||Dr.sendAudioMessage(e)}I()}function w(){C({hasError:!0}),E()}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"message-input-audio":!0,"message-input-audio-open":m.value})},[e.createVNode(pu,{class:"audio-message-icon",file:e.unref("/assets/audio.3e97d529.svg"),size:"23px",hotAreaSize:"3px",onOnClick:_},null,8,["file"]),a.isEnableAudio?(e.openBlock(),e.createElementBlock("view",{key:0,class:"audio-input-touch-bar",onTouchstart:k,onLongpress:T,onTouchmove:n[0]||(n[0]=(...t)=>e.unref(M)&&e.unref(M)(...t)),onTouchend:S},[e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t(`TUIChat.${h.value}`)),1),p.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"record-modal"},[e.createElementVNode("div",{class:"red-mask"}),e.createElementVNode("view",{class:"float-element moving-slider"}),e.createElementVNode("view",{class:"float-element modal-title"},e.toDisplayString(e.unref(Tr).t(`TUIChat.${g.value}`)),1)])):e.createCommentVNode("",!0)],32)):e.createCommentVNode("",!0)],2))}}),$g=L(Kg,[["__scopeId","data-v-aea6d550"]]),Yg=L(e.defineComponent({__name:"index",props:{displayType:{default:"editor"}},setup(t){const n=t,o=Cr.TYPES,a=e.ref();e.onMounted((()=>{kr.watch(oi.CHAT,{quoteMessage:r})})),e.onUnmounted((()=>{kr.unwatch(oi.CHAT,{quoteMessage:r})}));const i=e.computed((()=>{var e,t;let n;switch(null==(e=a.value)?void 0:e.type){case o.MSG_TEXT:n=od(null==(t=a.value.payload)?void 0:t.text);break;case o.MSG_IMAGE:n=Tr.t("TUIChat.图片");break;case o.MSG_AUDIO:n=Tr.t("TUIChat.语音");break;case o.MSG_VIDEO:n=Tr.t("TUIChat.视频");break;case o.MSG_FILE:n=Tr.t("TUIChat.文件");break;case o.MSG_CUSTOM:n=Tr.t("TUIChat.自定义");break;case o.MSG_FACE:n=Tr.t("TUIChat.表情");break;case o.MSG_MERGER:n=Tr.t("TUIChat.聊天记录");break;default:n=Tr.t("TUIChat.消息")}return n}));function s(){kr.update(oi.CHAT,"quoteMessage",{message:void 0,type:"quote"})}function r(e){(null==e?void 0:e.message)&&"quote"===(null==e?void 0:e.type)?a.value=e.message:a.value=void 0}return(t,o)=>Boolean(a.value)&&"audio"!==n.displayType?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"input-quote-container":!0,"input-quote-container-uni":e.unref(lu),"input-quote-container-h5":e.unref(su)})},[e.createElementVNode("div",{class:"input-quote-content"},[e.createElementVNode("div",{class:"max-one-line"},e.toDisplayString(a.value.nick||a.value.from)+": "+e.toDisplayString(i.value),1),e.createVNode(pu,{class:"input-quote-close-icon",file:e.unref(wg),width:"11px",height:"11px",onOnClick:s},null,8,["file"])])],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-59ae790d"]]),Wg=L(e.defineComponent({__name:"index",props:{placeholder:{default:"this is placeholder"},isMuted:{type:Boolean,default:!0},muteText:{default:""},enableInput:{type:Boolean,default:!0},enableAt:{type:Boolean,default:!0},enableTyping:{type:Boolean,default:!0},replyOrReference:{default:()=>({})},inputToolbarDisplayType:{default:"none"}},emits:["changeToolbarDisplayType"],setup(t,{expose:n,emit:o}){const a=o,i=t,s=e.ref(),r=e.ref(),c=e.ref(),l=e.ref(!1),u=e.ref("editor"),d=Uh.getFeatureConfig(),p=e.ref(d.InputVoice),h=e.ref(d.InputEmoji||d.InputStickers),g=e.ref(d.InputImage||d.InputVideo||d.InputEvaluation||d.InputQuickReplies);function m(e){u.value=e,"audio"===e&&a("changeToolbarDisplayType","none")}function f(e){a("changeToolbarDisplayType",e)}e.onMounted((()=>{kr.watch(oi.CONV,{currentConversation:C}),kr.watch(oi.CHAT,{quoteMessage:k})})),e.onUnmounted((()=>{kr.unwatch(oi.CONV,{currentConversation:C}),kr.unwatch(oi.CHAT,{quoteMessage:k})})),e.watch((()=>i.inputToolbarDisplayType),(e=>{"none"!==e&&m("editor")}));const v=(e,t)=>{((e,t)=>{e||t?Dr.leaveTypingState():Dr.enterTypingState()})(e,t)},_=e=>{var t;null==(t=null==r?void 0:r.value)||t.toggleAtList(e)},y=()=>{su&&a("changeToolbarDisplayType","none")},I=e=>{var t,n;(null==(t=null==s?void 0:s.value)?void 0:t.insertAt)&&(null==(n=null==s?void 0:s.value)||n.insertAt(e))},E=()=>{var e,t;(null==(e=null==s?void 0:s.value)?void 0:e.blur)&&(null==(t=null==s?void 0:s.value)||t.blur())};function C(e){var t;c.value=e,l.value=(null==(t=c.value)?void 0:t.type)===Cr.TYPES.CONV_GROUP}function k(e){(null==e?void 0:e.message)&&"quote"===(null==e?void 0:e.type)&&m("editor")}return n({insertEmoji:e=>{var t,n;(null==(t=null==s?void 0:s.value)?void 0:t.addEmoji)&&(null==(n=null==s?void 0:s.value)||n.addEmoji(e))},reEdit:e=>{var t,n;null==(t=null==s?void 0:s.value)||t.resetEditor(),null==(n=null==s?void 0:s.value)||n.setEditorContent(e)}}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-input",!e.unref(iu)&&"message-input-h5"])},[e.createElementVNode("div",{class:"audio-main-content-line"},[(e.unref(ru)||e.unref(cu))&&p.value?(e.openBlock(),e.createBlock($g,{key:0,class:e.normalizeClass({"message-input-wx-audio-open":"audio"===u.value}),isEnableAudio:"audio"===u.value,onChangeDisplayType:m},null,8,["class","isEnableAudio"])):e.createCommentVNode("",!0),e.withDirectives(e.createVNode(jg,{ref_key:"editor",ref:s,class:"message-input-editor",placeholder:i.placeholder,isMuted:i.isMuted,muteText:i.muteText,enableInput:i.enableInput,enableAt:i.enableAt,enableTyping:i.enableTyping,isGroup:l.value,onOnTyping:v,onOnAt:_,onOnFocus:y},null,8,["placeholder","isMuted","muteText","enableInput","enableAt","enableTyping","isGroup"]),[[e.vShow,"editor"===u.value]]),i.enableAt?(e.openBlock(),e.createBlock(zg,{key:1,ref_key:"messageInputAtRef",ref:r,onInsertAt:I,onOnAtListOpen:E},null,512)):e.createCommentVNode("",!0),h.value?(e.openBlock(),e.createBlock(pu,{key:2,class:"icon icon-face",file:e.unref("/assets/face-uni.e33f5632.png"),size:"23px",hotAreaSize:"3px",onOnClick:n[0]||(n[0]=e=>f("emojiPicker"))},null,8,["file"])):e.createCommentVNode("",!0),g.value?(e.openBlock(),e.createBlock(pu,{key:3,class:"icon icon-more",file:e.unref("/assets/more-uni.030c2d9a.png"),size:"23px",hotAreaSize:"3px",onOnClick:n[1]||(n[1]=e=>f("tools"))},null,8,["file"])):e.createCommentVNode("",!0)]),e.createElementVNode("div",null,[e.createVNode(Yg,{style:{minWidth:0},displayType:u.value},null,8,["displayType"])])],2))}}),[["__scopeId","data-v-d6da1f82"]]),Jg=L(e.defineComponent({__name:"index",emits:["oneByOneForwardMessage","mergeForwardMessage","toggleMultipleSelectMode"],setup(t,{emit:n}){const o=n,a=e.ref(uu?"25px":"30px");function i(){o("oneByOneForwardMessage")}function s(){o("mergeForwardMessage")}function r(){o("toggleMultipleSelectMode")}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"mulitple-select-panel":!0,"mulitple-select-panel-mobile":e.unref(uu)})},[e.createElementVNode("div",{class:"forward-button",onClick:i},[e.createVNode(pu,{file:e.unref("/assets/forward-each.9e79e381.svg"),size:a.value},null,8,["file","size"]),e.createElementVNode("span",{class:e.normalizeClass({"forward-button-text":!0,"forward-button-text-mobile":e.unref(uu)})},e.toDisplayString(e.unref(Tr).t("TUIChat.逐条转发")),3)]),e.createElementVNode("div",{class:"forward-button",onClick:s},[e.createVNode(pu,{file:e.unref("/assets/forward-merge.eef115cf.svg"),size:a.value},null,8,["file","size"]),e.createElementVNode("span",{class:e.normalizeClass({"forward-button-text":!0,"forward-button-text-mobile":e.unref(uu)})},e.toDisplayString(e.unref(Tr).t("TUIChat.合并转发")),3)]),e.createElementVNode("div",{class:"forward-button",onClick:r},[e.createVNode(pu,{class:"cancel-button-icon",file:e.unref("/assets/add-circle.b2afe9dc.svg"),size:a.value},null,8,["file","size"]),e.createElementVNode("span",{class:e.normalizeClass({"forward-button-text":!0,"forward-button-text-mobile":e.unref(uu)})},e.toDisplayString(e.unref(Tr).t("TUIChat.取消")),3)])],2))}}),[["__scopeId","data-v-ac6105cd"]]),Xg=e.defineComponent({__name:"index",emits:["toggleMultipleSelectMode"],setup(t,{emit:n}){const o=n;let a=[],i=!1;const s=e.ref(!1),r=e.ref();function c(e){void 0!==e&&(i=!1,a=[e],p())}function l(e){if(!e)return;i=!1;const{isMergeForward:t,messageIDList:n}=e||{};(null==n?void 0:n.length)>0?(i=t,a=n,p()):yd({message:Tr.t("TUIChat.未选择消息"),type:vd})}function u(){kr.update(oi.CUSTOM,"singleForwardMessageID",void 0),kr.update(oi.CUSTOM,"multipleForwardMessageID",void 0)}function d(){u(),s.value=!1}function p(){!function(){const e=kr.getData(oi.CONV,"conversationList");r.value=e.map((e=>({userID:e.conversationID,nick:e.getShowName(),avatar:e.getAvatar()})))}(),s.value=!0}function h(e){if(0===(null==e?void 0:e.length))return;const t=e.map((e=>kr.getConversationModel(e.userID))),n=a.map((e=>kr.getMessageModel(e))).sort(((e,t)=>e.time-t.time)),s=t.map((e=>{const t={conversation:e,messageType:Cr.TYPES.MSG_MERGER};return Dr.sendForwardMessage([e],n,{needMerge:i,offlinePushInfo:Ig.create(t),params:{needReadReceipt:Cp()}})}));Promise.allSettled(s).then((e=>{for(const t of e){const{status:e}=t;if("rejected"===e){const e=80001===t.reason.code?Tr.t("TUIChat.内容包含敏感词汇"):t.reason.message;yd({message:e,type:vd});break}}})),d(),o("toggleMultipleSelectMode",!1)}return e.onMounted((()=>{kr.watch(oi.CUSTOM,{singleForwardMessageID:c,multipleForwardMessageID:l})})),e.onUnmounted((()=>{kr.unwatch(oi.CUSTOM,{singleForwardMessageID:c,multipleForwardMessageID:l}),u()})),(t,n)=>(e.openBlock(),e.createBlock(Gd,{visible:s.value,useMask:!1},{default:e.withCtx((()=>[e.createVNode(op,{title:e.unref(Tr).t("TUIChat.转发"),isSearch:!1,isCustomItem:!1,list:r.value,isHiddenBackIcon:e.unref(lu),onCancel:d,onSubmit:h},null,8,["title","list","isHiddenBackIcon"])])),_:1},8,["visible"]))}}),Zg=L(e.defineComponent({__name:"index",props:{iconFile:{type:String,required:!0},title:{type:String,default:""},needDialog:{type:Boolean,default:!0},iconWidth:{type:String,default:"20px"},iconHeight:{type:String,default:"20px"},needBottomPopup:{type:Boolean,default:!1}},emits:["onIconClick","onDialogClose","onDialogShow"],setup(t,{expose:n,emit:o}){const a=t,i=o,s=e.ref("dark"===Uh.getTheme()),r=e.ref(!1),c=e.ref(),l=e.ref(),u=()=>{i("onIconClick",l),iu&&au.listen({domRefs:c.value,handler:d}),a.needDialog&&p(!r.value)},d=()=>{r.value=!1,i("onDialogClose",l)},p=e=>{if(r.value!==e)switch(r.value=e,e){case!0:i("onDialogShow",l);break;case!1:i("onDialogClose",l)}},h=()=>{r.value=!1};return n({toggleDialogDisplay:p}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"toolbarItemRef",ref:c,class:e.normalizeClass(["toolbar-item-container",!e.unref(iu)&&"toolbar-item-container-h5",e.unref(lu)&&"toolbar-item-container-uni"])},[e.createElementVNode("div",{class:e.normalizeClass(["toolbar-item-container-icon",e.unref(lu)&&"toolbar-item-container-uni-icon"]),onClick:u},[e.createVNode(pu,{file:a.iconFile,class:"icon",width:a.iconWidth,height:a.iconHeight},null,8,["file","width","height"])],2),e.unref(lu)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["toolbar-item-container-uni-title"])},e.toDisplayString(a.title),1)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("div",{ref_key:"dialogRef",ref:l,class:e.normalizeClass(["toolbar-item-container-dialog",s.value&&"toolbar-item-container-dialog-dark",!e.unref(iu)&&"toolbar-item-container-h5-dialog",e.unref(lu)&&"toolbar-item-container-uni-dialog"])},[a.needBottomPopup&&!e.unref(iu)?(e.openBlock(),e.createBlock(qg,{key:0,class:"toolbar-bottom-popup",show:r.value,onTouchmove:n[0]||(n[0]=e.withModifiers((()=>{}),["stop","prevent"])),onOnClose:h},{default:e.withCtx((()=>[e.renderSlot(t.$slots,"default",{},void 0,!0)])),_:3},8,["show"])):e.renderSlot(t.$slots,"default",{key:1},void 0,!0)],2),[[e.vShow,r.value]])],2))}}),[["__scopeId","data-v-3577c2ab"]]),Qg="/assets/camera-uni.e7fd6e1a.png",em=e.defineComponent({__name:"index",props:{imageSourceType:{type:String,default:"album"}},setup(t){const n=t,o=e.ref(),a=e.ref(),i={web_album:{icon:"dark"===Uh.getTheme()?"/assets/image-dark.bf322028.svg":"/assets/image-light.3da9cf2c.svg",title:"图片"},uni_album:{icon:"/assets/image-uni.3e951cbb.png",title:"图片"},uni_camera:{icon:Qg,title:"拍照"}};kr.watch(oi.CONV,{currentConversation:e=>{a.value=e}});const s=e.computed((()=>lu?"camera"===n.imageSourceType?i.uni_camera:i.uni_album:i.web_album)),r=()=>{var e;lu?ru&&(null==Fl?void 0:Fl.chooseMedia)?null==Fl||Fl.chooseMedia({count:1,mediaType:["image"],sizeType:["original","compressed"],sourceType:[n.imageSourceType],success:function(e){l(e)}}):null==Fl||Fl.chooseImage({count:1,sourceType:[n.imageSourceType],success:function(e){l(e)}}):(null==(e=o.value)?void 0:e.click)&&o.value.click()},c=e=>{var t,n;(null==(n=null==(t=null==e?void 0:e.target)?void 0:t.files)?void 0:n.length)<=0||(l(null==e?void 0:e.target),e.target.value="")},l=e=>{var t,n,o,i,s;if(!e)return;const r={to:(null==(n=null==(t=null==a?void 0:a.value)?void 0:t.groupProfile)?void 0:n.groupID)||(null==(i=null==(o=null==a?void 0:a.value)?void 0:o.userProfile)?void 0:i.userID),conversationType:null==(s=null==a?void 0:a.value)?void 0:s.type,payload:{file:e},needReadReceipt:Cp()},c={conversation:a.value,payload:r.payload,messageType:Cr.TYPES.MSG_IMAGE},l={offlinePushInfo:Ig.create(c)};Dr.sendImageMessage(r,l)};return(t,n)=>(e.openBlock(),e.createBlock(Zg,{iconFile:s.value.icon,title:s.value.title,iconWidth:e.unref(lu)?"32px":"20px",iconHeight:e.unref(lu)?"25px":"18px",needDialog:!1,onOnIconClick:r},{default:e.withCtx((()=>[e.unref(lu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["image-upload",!e.unref(iu)&&"image-upload-h5"])},[e.createElementVNode("input",{ref_key:"inputRef",ref:o,title:"图片",type:"file","data-type":"image",accept:"image/gif,image/jpeg,image/jpg,image/png,image/bmp,image/webp",onChange:c},null,544)],2))])),_:1},8,["iconFile","title","iconWidth","iconHeight"]))}}),tm=L(em,[["__scopeId","data-v-a4e5cec0"]]),nm="/assets/video-uni.0b4d3e53.png",om=e.defineComponent({__name:"index",props:{videoSourceType:{type:String,default:"album"}},setup(t){const n=t,o=e.ref(),a=e.ref();kr.watch(oi.CONV,{currentConversation:e=>{a.value=e}});const i=()=>{if(!lu){return"dark"===Uh.getTheme()?"/assets/video-dark.e7ceead3.svg":"/assets/video-light.48615dd3.svg"}switch(n.videoSourceType){case"album":default:return nm;case"camera":return Qg}},s=()=>{var e,t;lu?ru&&(null==Fl?void 0:Fl.chooseMedia)?null==Fl||Fl.chooseMedia({mediaType:["video"],count:1,sourceType:[n.videoSourceType],maxDuration:60,success:function(e){c(e)}}):null==Fl||Fl.chooseVideo({count:1,sourceType:[n.videoSourceType],compressed:!1,success:function(e){c(e)}}):(null==(e=null==o?void 0:o.value)?void 0:e.click)&&(null==(t=null==o?void 0:o.value)||t.click())},r=e=>{var t,n;(null==(n=null==(t=null==e?void 0:e.target)?void 0:t.files)?void 0:n.length)<=0||(c(null==e?void 0:e.target),e.target.value="")},c=e=>{var t,n,o,i,s;if(!e)return;const r={to:(null==(n=null==(t=null==a?void 0:a.value)?void 0:t.groupProfile)?void 0:n.groupID)||(null==(i=null==(o=null==a?void 0:a.value)?void 0:o.userProfile)?void 0:i.userID),conversationType:null==(s=null==a?void 0:a.value)?void 0:s.type,payload:{file:e},needReadReceipt:Cp()},c={conversation:a.value,payload:r.payload,messageType:Cr.TYPES.MSG_VIDEO},l={offlinePushInfo:Ig.create(c)};Dr.sendVideoMessage(r,l)};return(t,a)=>(e.openBlock(),e.createBlock(Zg,{iconFile:i(),title:lu&&"camera"===n.videoSourceType?"录制":"视频",needDialog:!1,iconWidth:e.unref(lu)?"32px":"20px",iconHeight:e.unref(lu)?"album"===n.videoSourceType?"20px":"25px":"18px",onOnIconClick:s},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass(["video-upload",!e.unref(iu)&&"video-upload-h5"])},[e.createElementVNode("input",{ref_key:"inputRef",ref:o,title:"视频",type:"file","data-type":"video",accept:"video/*",onChange:r},null,544)],2)])),_:1},8,["iconFile","title","iconWidth","iconHeight"]))}}),am=L(om,[["__scopeId","data-v-919f84b8"]]),im={product:{label:"产品文档",url:"https://cloud.tencent.com/document/product/269/1499#.E7.BE.A4.E7.BB.84.E5.8A.9F.E8.83.BD"},customMessage:{label:"自定义消息",url:"https://web.sdk.qcloud.com/im/doc/v3/zh-cn/SDK.html#createCustomMessage"},complaint:{label:"点此投诉",url:"https://cloud.tencent.com/apply/p/xc3oaubi98g"},implement:{label:"集成TUICallKit",url:"https://cloud.tencent.com/document/product/269/79861"},purchase:{label:"开通腾讯实时音视频服务",url:"https://cloud.tencent.com/document/product/1640/79968"}},sm=L(e.defineComponent({__name:"index",props:{starTotal:{type:Number,default:5}},emits:["onDialogPopupShowOrHide"],setup(t,{emit:n}){const o="dark"===Uh.getTheme()?"/assets/evalute-dark.e265e635.svg":"/assets/evalute-light.8db79ed8.svg",a=t,i=n,s=e.ref(),r=e.ref(a.starTotal),c=e.ref(-1),l=e.ref(""),u=e.ref();kr.watch(oi.CONV,{currentConversation:e=>{u.value=e}});const d=e.computed((()=>l.value.length||c.value>=0)),p=()=>{i("onDialogPopupShowOrHide",!0)},h=()=>{m(),i("onDialogPopupShowOrHide",!1)},g=()=>{var e;null==(e=null==s?void 0:s.value)||e.toggleDialogDisplay(!1)},m=()=>{c.value=-1,l.value=""},f=()=>{var e,t,n,o,a,i;if(c.value<0&&!l.value.length)return;const r={data:JSON.stringify({businessID:zu.EVALUATE,version:1,score:c.value+1,comment:l.value}),description:"对本次的服务评价",extension:"对本次的服务评价"},d={to:(null==(t=null==(e=null==u?void 0:u.value)?void 0:e.groupProfile)?void 0:t.groupID)||(null==(o=null==(n=null==u?void 0:u.value)?void 0:n.userProfile)?void 0:o.userID),conversationType:null==(a=null==u?void 0:u.value)?void 0:a.type,payload:r,needReadReceipt:Cp()},p={conversation:u.value,payload:d.payload,messageType:Cr.TYPES.MSG_CUSTOM},h={offlinePushInfo:Ig.create(p)};Dr.sendCustomMessage(d,h),null==(i=null==s?void 0:s.value)||i.toggleDialogDisplay(!1)};return(t,n)=>(e.openBlock(),e.createBlock(Zg,{ref_key:"container",ref:s,iconFile:e.unref(o),title:"评价",needBottomPopup:!0,iconWidth:e.unref(lu)?"26px":"20px",iconHeight:e.unref(lu)?"26px":"20px",onOnDialogShow:p,onOnDialogClose:h},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass(["evaluate",!e.unref(iu)&&"evaluate-h5"])},[e.createElementVNode("div",{class:e.normalizeClass(["evaluate-header",!e.unref(iu)&&"evaluate-h5-header"])},[e.createElementVNode("div",{class:e.normalizeClass(["evaluate-header-content",!e.unref(iu)&&"evaluate-h5-header-content"])},e.toDisplayString(e.unref(Tr).t("Evaluate.请对本次服务进行评价")),3),e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["evaluate-header-close",!e.unref(iu)&&"evaluate-h5-header-close"]),onClick:e.withModifiers(g,["stop"])},e.toDisplayString(e.unref(Tr).t("关闭")),3))],2),e.createElementVNode("div",{class:e.normalizeClass(["evaluate-content",!e.unref(iu)&&"evaluate-h5-content"])},[e.createElementVNode("ul",{class:e.normalizeClass(["evaluate-content-list",!e.unref(iu)&&"evaluate-h5-content-list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:e.normalizeClass(["evaluate-content-list-item",!e.unref(iu)&&"evaluate-h5-content-list-item"]),onClick:e.withModifiers((e=>{return t=n,void(c.value===t?c.value=c.value-1:c.value=t);var t}),["stop"])},[n<=c.value?(e.openBlock(),e.createBlock(pu,{key:0,file:e.unref(ud),width:e.unref(iu)?"20px":"30px",height:e.unref(iu)?"20px":"30px"},null,8,["file","width","height"])):(e.openBlock(),e.createBlock(pu,{key:1,file:e.unref("/assets/star.8a9a7e2e.png"),width:e.unref(iu)?"20px":"30px",height:e.unref(iu)?"20px":"30px"},null,8,["file","width","height"]))],10,["onClick"])))),128))],2),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":n[0]||(n[0]=e=>l.value=e),class:e.normalizeClass(["evaluate-content-text",!e.unref(iu)&&"evaluate-h5-content-text"])},null,2),[[e.vModelText,l.value]]),e.createElementVNode("div",{class:e.normalizeClass(["evaluate-content-button",!e.unref(iu)&&"evaluate-h5-content-button"])},[e.createElementVNode("button",{class:e.normalizeClass(["btn",d.value?"btn-valid":"btn-invalid"]),onClick:f},e.toDisplayString(e.unref(Tr).t("Evaluate.提交评价")),3)],2)],2),e.createElementVNode("div",{class:e.normalizeClass(["evaluate-adv",!e.unref(iu)&&"evaluate-h5-adv"])},[e.createTextVNode(e.toDisplayString(e.unref(Tr).t("Evaluate.服务评价工具"))+" "+e.toDisplayString("("+e.unref(Tr).t("Evaluate.使用"))+" ",1),e.createElementVNode("a",{onClick:n[1]||(n[1]=t=>{return e.unref(im).customMessage,void((iu||su)&&window.open(null==(n=null==im?void 0:im.customMessage)?void 0:n.url));var n})},e.toDisplayString(e.unref(Tr).t(`Evaluate.${e.unref(im).customMessage.label}`)),1),e.createTextVNode(" "+e.toDisplayString(e.unref(Tr).t("Evaluate.搭建")+")"),1)],2)],2)])),_:1},8,["iconFile","iconWidth","iconHeight"]))}}),[["__scopeId","data-v-15150327"]]),rm=[{value:"在吗？在吗？在吗？重要的话说三遍。"},{value:"好久没聊天了，快来和我说说话～"},{value:"好的，就这么说定了。"},{value:"感恩的心，感谢有你。"},{value:"糟糕！是心动的感觉！"},{value:"心疼地抱抱自己，我太难了！"},{value:"没关系，别在意，事情过去就过去了。"},{value:"早上好，今天也是让人期待的一天呢！"},{value:"熬夜有什么用，又没人陪你聊天，早点休息吧。"}],cm=L(e.defineComponent({__name:"index",emits:["onDialogPopupShowOrHide"],setup(t,{emit:n}){const o="dark"===Uh.getTheme()?"/assets/words-dark.6a706f9a.svg":"/assets/words-light.c8aec883.svg",a=n,i=e.ref(),s=e.ref();kr.watch(oi.CONV,{currentConversation:e=>{i.value=e}});const r=()=>{var e;null==(e=null==s?void 0:s.value)||e.toggleDialogDisplay(!1)},c=()=>{a("onDialogPopupShowOrHide",!0)},l=()=>{a("onDialogPopupShowOrHide",!1)};return(t,n)=>(e.openBlock(),e.createBlock(Zg,{ref_key:"container",ref:s,iconFile:e.unref(o),title:"常用语",needBottomPopup:!0,iconWidth:e.unref(lu)?"26px":"20px",iconHeight:e.unref(lu)?"26px":"20px",onOnDialogShow:c,onOnDialogClose:l},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass(["words",!e.unref(iu)&&"words-h5"])},[e.createElementVNode("div",{class:e.normalizeClass(["words-header",!e.unref(iu)&&"words-h5-header"])},[e.createElementVNode("span",{class:e.normalizeClass(["words-header-title",!e.unref(iu)&&"words-h5-header-title"])},e.toDisplayString(e.unref(Tr).t("Words.常用语-快捷回复工具")),3),e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",{key:0,class:e.normalizeClass(["words-header-close",!e.unref(iu)&&"words-h5-header-close"]),onClick:r}," 关闭 ",2))],2),e.createElementVNode("ul",{class:e.normalizeClass(["words-list",!e.unref(iu)&&"words-h5-list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(rm),((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:e.normalizeClass(["words-list-item",!e.unref(iu)&&"words-h5-list-item"]),onClick:e=>(e=>{var t,n,o,a,r,c;const l={to:(null==(n=null==(t=null==i?void 0:i.value)?void 0:t.groupProfile)?void 0:n.groupID)||(null==(a=null==(o=null==i?void 0:i.value)?void 0:o.userProfile)?void 0:a.userID),conversationType:null==(r=null==i?void 0:i.value)?void 0:r.type,payload:{text:Tr.t(`Words.${e.value}`)},needReadReceipt:Cp()};Dr.sendTextMessage(l),null==(c=null==s?void 0:s.value)||c.toggleDialogDisplay(!1)})(t)},e.toDisplayString(e.unref(Tr).t(`Words.${t.value}`)),11,["onClick"])))),128))],2)],2)])),_:1},8,["iconFile","iconWidth","iconHeight"]))}}),[["__scopeId","data-v-98ba6752"]]),lm=L(e.defineComponent({__name:"emoji-picker-dialog",emits:["insertEmoji","onClose","sendMessage"],setup(t,{emit:n}){var o;const a="dark"===Uh.getTheme()?"/assets/face-dark.1ce4b9fa.svg":"/assets/face-light.b3a6acfa.svg",i=n,s=e.ref(0),r=e.ref(),c=e.ref(),l=e.ref(),u=Uh.getFeatureConfig(),d=e.ref(td.filter((e=>e.type===Ku.BASIC?u.InputEmoji:e.type===Ku.BIG?u.InputStickers:void 0))),p=e.ref(null==d?void 0:d.value[0]),h=e.ref(null==(o=null==d?void 0:d.value[0])?void 0:o.list);e.onMounted((()=>{kr.watch(oi.CONV,{currentConversation:f})})),e.onUnmounted((()=>{kr.unwatch(oi.CONV,{currentConversation:f})}));const g=(e,t)=>{var n,o,a,i,s;const c={to:(null==(o=null==(n=null==r?void 0:r.value)?void 0:n.groupProfile)?void 0:o.groupID)||(null==(i=null==(a=null==r?void 0:r.value)?void 0:a.userProfile)?void 0:i.userID),conversationType:null==(s=null==r?void 0:r.value)?void 0:s.type,payload:{index:t.emojiGroupID,data:t.list[e]},needReadReceipt:Cp()};Dr.sendFaceMessage(c)};function m(){uni.$emit("send-message-in-emoji-picker")}function f(e){r.value=e}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"emojiPickerDialog",ref:c,class:e.normalizeClass({"emoji-picker":!0,"emoji-picker-h5":!e.unref(iu)})},[e.createElementVNode("ul",{ref_key:"emojiPickerListRef",ref:l,class:e.normalizeClass(["emoji-picker-list",!e.unref(iu)&&"emoji-picker-h5-list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"emoji-picker-list-item",onClick:e=>((e,t)=>{var n,o,a;const s={emoji:{key:e,name:nd(e)},type:null==(n=null==p?void 0:p.value)?void 0:n.type};switch(null==(o=null==p?void 0:p.value)?void 0:o.type){case Ku.BASIC:s.url=(null==(a=null==p?void 0:p.value)?void 0:a.url)+ed[e],lu?uni.$emit("insert-emoji",s):i("insertEmoji",s);break;case Ku.BIG:case Ku.CUSTOM:g(t,p.value)}iu&&i("onClose")})(t,n)},[p.value.type===e.unref(Ku).BASIC?(e.openBlock(),e.createElementBlock("img",{key:0,class:"emoji",src:p.value.url+e.unref(ed)[t]},null,8,["src"])):p.value.type===e.unref(Ku).BIG?(e.openBlock(),e.createElementBlock("img",{key:1,class:"emoji-big",src:p.value.url+t+"@2x.png"},null,8,["src"])):(e.openBlock(),e.createElementBlock("img",{key:2,class:"emoji-custom emoji-big",src:p.value.url+t},null,8,["src"]))],8,["onClick"])))),128))],2),e.createElementVNode("ul",{class:"emoji-picker-tab"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"emoji-picker-tab-item",onClick:e=>(e=>{var t;s.value=e,p.value=null==d?void 0:d.value[e],h.value=null==(t=null==d?void 0:d.value[e])?void 0:t.list,lu||(null==l?void 0:l.value)&&(l.value.scrollTop=0)})(n)},[t.type===e.unref(Ku).BASIC?(e.openBlock(),e.createBlock(pu,{key:0,class:"icon",file:e.unref(a)},null,8,["file"])):t.type===e.unref(Ku).BIG?(e.openBlock(),e.createElementBlock("img",{key:1,class:"icon-big",src:t.url+t.list[0]+"@2x.png"},null,8,["src"])):(e.openBlock(),e.createElementBlock("img",{key:2,class:"icon-custom icon-big",src:t.url+t.list[0]},null,8,["src"]))],8,["onClick"])))),128)),e.unref(lu)?(e.openBlock(),e.createElementBlock("li",{key:0,class:"send-btn",onClick:m}," 发送 ")):e.createCommentVNode("",!0)])],2))}}),[["__scopeId","data-v-535d1c48"]]),um=e.defineComponent({__name:"index",props:{type:{type:String,default:""},currentConversation:{type:Object,default:()=>({})},isGroup:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(t,{expose:n,emit:o}){const a=t,i=o,s=e.ref(!1),r=e.ref(""),c=e.ref([]),l=e.ref([]),u=e.ref(""),d={voiceCall:"发起群语音",videoCall:"发起群视频"},p=e.computed((()=>d[a.type]?d[a.type]:""));Sr.getUserProfile().then((e=>{var t;(null==(t=null==e?void 0:e.data)?void 0:t.userID)&&(u.value=e.data.userID)})),e.watch((()=>{var e;return[null==(e=null==a?void 0:a.currentConversation)?void 0:e.conversationID,s.value]}),((e,t)=>{e&&e!==t&&(a.isGroup&&s.value?(r.value=a.currentConversation.groupProfile.groupID,br.getGroupMemberList({groupID:r.value}).then((e=>{var t,n;c.value=null==(n=null==(t=null==e?void 0:e.data)?void 0:t.memberList)?void 0:n.filter((e=>(null==e?void 0:e.userID)!==u.value)),l.value=c.value}))):(r.value="",c.value=[],l.value=c.value))}),{immediate:!0});const h=e=>{var t;const n=null==(t=c.value)?void 0:t.filter((t=>(null==t?void 0:t.userID)===e));l.value=(null==n?void 0:n.length)?n:c.value},g=e=>{const t=[];null==e||e.forEach((e=>{(null==e?void 0:e.userID)&&t.push(e.userID)})),"voiceCall"===a.type?i("submit",{userIDList:t,groupID:r.value,type:1}):"videoCall"===a.type&&i("submit",{userIDList:t,groupID:r.value,type:2}),l.value=c.value,f(!1)},m=()=>{l.value=c.value,i("cancel"),f(!1)},f=e=>{s.value=e};return n({toggleShow:f}),(t,n)=>(e.openBlock(),e.createBlock(xd,{show:s.value,isH5:!e.unref(iu),isHeaderShow:!1,isFooterShow:!1,background:!1,"onUpdate:show":f},{default:e.withCtx((()=>[e.createVNode(op,{isSearch:!0,title:p.value,list:l.value,isH5:!e.unref(iu),isRadio:!1,onSearch:h,onSubmit:g,onCancel:m},null,8,["title","list","isH5"])])),_:1},8,["show","isH5"]))}}),dm=L(e.defineComponent({options:{styleIsolation:"shared"},__name:"index",props:{displayType:{}},setup(t){const n=t,o=e.ref(),a=e.ref(!1),i=e.ref(""),s=e.ref(),r=e.ref(),c=e.ref([]),l=e.ref(!1),u=Uh.getFeatureConfig(),d=e.ref(8),p=e.ref(0);e.onMounted((()=>{kr.watch(oi.CUSTOM,{activeConversation:h})})),e.onUnmounted((()=>{kr.unwatch(oi.CUSTOM,{activeConversation:h})}));const h=e=>{var t;e&&e!==(null==(t=o.value)?void 0:t.conversationID)&&(g(),u.InputImage&&u.InputVideo?d.value-=4:(u.InputImage||u.InputVideo)&&(d.value-=2),p.value=d.value,d.value-=c.value.length,1===d.value?l.value=u.InputEvaluation&&u.InputQuickReplies:d.value<1&&(l.value=u.InputEvaluation||u.InputQuickReplies),o.value=kr.getConversationModel(e),a.value=e.startsWith(Cr.TYPES.CONV_GROUP))},g=()=>{const e=Uh.getChatType(),t={chatType:e};e===Ar.TUIChat.TYPE.CUSTOMER_SERVICE&&(t.filterVoice=!0,t.filterVideo=!0,Nd("customerService")),c.value=[...Wr.getExtensionList(Ar.TUIChat.EXTENSION.INPUT_MORE.EXT_ID,t)].filter((e=>{var t;return"search"!==(null==(t=null==e?void 0:e.data)?void 0:t.name)||u.MessageSearch}))},m=e=>{var t,n,o;const a=c.value.find((t=>{var n,o;return(null==(n=null==t?void 0:t.data)?void 0:n.name)===(null==(o=null==e?void 0:e.data)?void 0:o.name)}));switch(null==(t=null==a?void 0:a.data)?void 0:t.name){case"voiceCall":f(a,1);break;case"videoCall":f(a,2);break;case"search":null==(o=null==(n=null==a?void 0:a.listener)?void 0:n.onClicked)||o.call(n)}},f=(e,t)=>{var n,c,l,u,d,p,h;i.value=null==(n=null==e?void 0:e.data)?void 0:n.name,(null==(c=null==o?void 0:o.value)?void 0:c.type)===Cr.TYPES.CONV_C2C?null==(p=null==(l=null==e?void 0:e.listener)?void 0:l.onClicked)||p.call(l,{userIDList:[null==(d=null==(u=null==o?void 0:o.value)?void 0:u.conversationID)?void 0:d.slice(3)],type:t,callParams:{offlinePushInfo:Ig.getOfflinePushInfo(yg.CALL)}}):a.value&&(r.value=e,(null==(h=null==s?void 0:s.value)?void 0:h.toggleShow)&&s.value.toggleShow(!0))},v=e=>null==e?void 0:e.icon,_=e=>null==e?void 0:e.text,y=e=>{var t,n,o;null==(o=null==(n=null==(t=r.value)?void 0:t.listener)?void 0:n.onClicked)||o.call(n,{...e,callParams:{offlinePushInfo:Ig.getOfflinePushInfo(yg.CALL)}}),r.value=null},I=()=>{r.value=null},E=e=>{l.value=d.value<=1&&!e};return(t,r)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-input-toolbar","message-input-toolbar-h5","message-input-toolbar-uni"])},["emojiPicker"===n.displayType?(e.openBlock(),e.createElementBlock("div",{key:0},[e.createVNode(lm)])):(e.openBlock(),e.createElementBlock("div",{key:1},[e.createElementVNode("swiper",{class:e.normalizeClass(["message-input-toolbar-swiper"]),"indicator-dots":l.value,autoplay:!1,circular:!1},[e.createElementVNode("swiper-item",{class:e.normalizeClass(["message-input-toolbar-list","message-input-toolbar-h5-list","message-input-toolbar-uni-list"])},[e.unref(u).InputImage?(e.openBlock(),e.createBlock(tm,{key:0,imageSourceType:"camera"})):e.createCommentVNode("",!0),e.unref(u).InputImage?(e.openBlock(),e.createBlock(tm,{key:1,imageSourceType:"album"})):e.createCommentVNode("",!0),e.unref(u).InputVideo?(e.openBlock(),e.createBlock(am,{key:2,videoSourceType:"album"})):e.createCommentVNode("",!0),e.unref(u).InputVideo?(e.openBlock(),e.createBlock(am,{key:3,videoSourceType:"camera"})):e.createCommentVNode("",!0),c.value.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:4},e.renderList(c.value.slice(0,p.value),((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n},[t?(e.openBlock(),e.createBlock(Zg,{key:0,iconFile:v(t),title:_(t),iconWidth:"25px",iconHeight:"25px",needDialog:!1,onOnIconClick:e=>m(t)},null,8,["iconFile","title","onOnIconClick"])):e.createCommentVNode("",!0)])))),128)):e.createCommentVNode("",!0),1===d.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:5},[e.unref(u).InputEvaluation?(e.openBlock(),e.createBlock(sm,{key:0,onOnDialogPopupShowOrHide:E})):e.unref(u).InputQuickReplies?(e.openBlock(),e.createBlock(cm,{key:1,onOnDialogPopupShowOrHide:E})):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0),d.value>1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:6},[e.unref(u).InputEvaluation?(e.openBlock(),e.createBlock(sm,{key:0,onOnDialogPopupShowOrHide:E})):e.createCommentVNode("",!0),e.unref(u).InputQuickReplies?(e.openBlock(),e.createBlock(cm,{key:1,onOnDialogPopupShowOrHide:E})):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)]),d.value<=1?(e.openBlock(),e.createElementBlock("swiper-item",{key:0,class:e.normalizeClass(["message-input-toolbar-list","message-input-toolbar-h5-list","message-input-toolbar-uni-list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value.slice(p.value),((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n},[t?(e.openBlock(),e.createBlock(Zg,{key:0,iconFile:v(t),title:_(t),iconWidth:"25px",iconHeight:"25px",needDialog:!1,onOnIconClick:e=>m(t)},null,8,["iconFile","title","onOnIconClick"])):e.createCommentVNode("",!0)])))),128)),1===d.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.unref(u).InputQuickReplies?(e.openBlock(),e.createBlock(cm,{key:0,onOnDialogPopupShowOrHide:E})):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.unref(u).InputEvaluation?(e.openBlock(),e.createBlock(sm,{key:0,onOnDialogPopupShowOrHide:E})):e.createCommentVNode("",!0),e.unref(u).InputQuickReplies?(e.openBlock(),e.createBlock(cm,{key:1,onOnDialogPopupShowOrHide:E})):e.createCommentVNode("",!0)],64))])):e.createCommentVNode("",!0)],8,["indicator-dots"])])),e.createVNode(um,{ref_key:"userSelectorRef",ref:s,type:i.value,currentConversation:o.value,isGroup:a.value,onSubmit:y,onCancel:I},null,8,["type","currentConversation","isGroup"])]))}}),[["__scopeId","data-v-0ca17d70"]]),pm=L(e.defineComponent({__name:"index",emits:["closeChat"],setup(t,{emit:n}){M((e=>{(e=>{const{chat:t}=Jr.getContext();if(e&&e.conversationID&&(null==t?void 0:t.isReady())){const{conversationID:t}=e;if(!t.startsWith("C2C")&&!t.startsWith("GROUP"))return void I("warn","at TUIKit/components/TUIChat/entry-chat-only.ts:22","conversationID from options is invalid.");Mr.switchConversation(t)}})(e)})),D((()=>{var e;(e=!1,e?Jr.logout():Promise.resolve()).then((()=>{})).catch((()=>{}))}));const o=n,a=e.ref(void 0),i=e.ref(!1),s=e.ref(!1),r=e.ref(),c=e.ref(),l=e.ref(!1),u=e.ref("none"),d=e.ref(),p=e.ref(),h=e.ref([]),g=Uh.getFeatureConfig();e.onMounted((()=>{kr.watch(oi.CONV,{currentConversationID:L,currentConversation:N})})),e.onUnmounted((()=>{kr.unwatch(oi.CONV,{currentConversationID:L,currentConversation:N}),v()}));const m=e.computed((()=>!lu||"none"!==u.value)),f=e.computed((()=>{let e="";switch(r.value){case 4:e=Tr.t("TUIChat.您已被管理员移出群聊");break;case 5:e=Tr.t("TUIChat.该群聊已被解散");break;default:e=Tr.t("TUIChat.您已退出该群聊")}return e})),v=()=>{Mr.switchConversation("")},_=e=>{o("closeChat",e),v()},y=e=>{var t;null==(t=d.value)||t.insertEmoji(e)},E=(e,t)=>{var n,o,a;if(e&&t)switch(t){case"reference":case"reply":break;case"reedit":(null==(n=null==e?void 0:e.payload)?void 0:n.text)&&(null==(a=null==d?void 0:d.value)||a.reEdit(null==(o=null==e?void 0:e.payload)?void 0:o.text))}},C=()=>{h.value[0].listener.onClicked({groupID:a.value})};function k(e){u.value=u.value===e?"none":e,"none"!==u.value&&lu&&uni.$emit("scroll-to-bottom")}function T(){var e;null==(e=p.value)||e.scrollToLatestMessage()}function S(e){l.value=void 0===e?!l.value:e}function b(){var e;null==(e=p.value)||e.mergeForwardMessage()}function w(){var e;null==(e=p.value)||e.oneByOneForwardMessage()}function N(e){(null==e?void 0:e.operationType)>0?(h.value=[],s.value=!0,r.value=null==e?void 0:e.operationType):(s.value=!1,r.value=void 0)}function L(e){if(c.value===e)return;i.value=!1;let t=Cr.TYPES.CONV_C2C;if(e.startsWith(Cr.TYPES.CONV_GROUP)&&(t=Cr.TYPES.CONV_GROUP,i.value=!0,a.value=e.replace(Cr.TYPES.CONV_GROUP,"")),h.value=[],l.value=!1,Uh.setChatType(t),Wr.notifyEvent(Ar.TUIChat.EVENT.CHAT_STATE_CHANGED,Ar.TUIChat.EVENT_SUB_KEY.CHAT_OPENED,{groupID:a.value}),Wr.callService({serviceName:Ar.TUICustomerServicePlugin.SERVICE.NAME,method:Ar.TUICustomerServicePlugin.SERVICE.METHOD.ACTIVE_CONVERSATION,params:{conversationID:e}}),Uh.getChatType()===Ar.TUIChat.TYPE.ROOM&&!0===Uh.getFeatureConfig(Ar.TUIChat.FEATURE.InputVoice))return Uh.setTheme("light"),void(c.value="");Uh.getChatType()===Ar.TUIChat.TYPE.GROUP&&(h.value=Wr.getExtensionList(Ar.TUIChat.EXTENSION.CHAT_HEADER.EXT_ID)),kr.update(oi.CUSTOM,"activeConversation",e),c.value=e}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"chat"},[e.createElementVNode("div",{class:e.normalizeClass(["tui-chat",!e.unref(iu)&&"tui-chat-h5"])},[c.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-chat-default",!e.unref(iu)&&"tui-chat-h5-default"])},[e.renderSlot(t.$slots,"default",{},void 0,!0)],2)),c.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["tui-chat",!e.unref(iu)&&"tui-chat-h5"])},[e.createVNode(vh,{class:e.normalizeClass(["tui-chat-header",!e.unref(iu)&&"tui-chat-H5-header",e.unref(lu)&&"tui-chat-uniapp-header"]),isGroup:i.value,headerExtensionList:h.value,onCloseChat:_,onOpenGroupManagement:C},null,8,["class","isGroup","headerExtensionList"]),e.createVNode(Xg,{onToggleMultipleSelectMode:S}),e.createVNode(xg,{ref_key:"messageListRef",ref:p,class:e.normalizeClass(["tui-chat-message-list",!e.unref(iu)&&"tui-chat-h5-message-list"]),isGroup:i.value,groupID:a.value,isNotInGroup:s.value,isMultipleSelectMode:l.value,onHandleEditor:E,onCloseInputToolBar:n[0]||(n[0]=()=>k("none")),onToggleMultipleSelectMode:S},null,8,["class","isGroup","groupID","isNotInGroup","isMultipleSelectMode"]),s.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"tui-chat-leave-group":!0,"tui-chat-leave-group-mobile":e.unref(uu)})},e.toDisplayString(f.value),3)):l.value?(e.openBlock(),e.createBlock(Jg,{key:1,onOneByOneForwardMessage:w,onMergeForwardMessage:b,onToggleMultipleSelectMode:S})):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[m.value?(e.openBlock(),e.createBlock(dm,{key:0,class:e.normalizeClass(["tui-chat-message-input-toolbar",!e.unref(iu)&&"tui-chat-h5-message-input-toolbar",e.unref(lu)&&"tui-chat-uni-message-input-toolbar"]),displayType:u.value,onInsertEmoji:y,onChangeToolbarDisplayType:k,onScrollToLatestMessage:T},null,8,["class","displayType"])):e.createCommentVNode("",!0),e.createVNode(Wg,{ref_key:"messageInputRef",ref:d,class:e.normalizeClass(["tui-chat-message-input",!e.unref(iu)&&"tui-chat-h5-message-input",e.unref(lu)&&"tui-chat-uni-message-input",e.unref(ru)&&"tui-chat-wx-message-input"]),enableAt:e.unref(g).InputMention,isMuted:!1,muteText:e.unref(Tr).t("TUIChat.您已被管理员禁言"),placeholder:e.unref(Tr).t("TUIChat.请输入消息"),inputToolbarDisplayType:u.value,onChangeToolbarDisplayType:k},null,8,["class","enableAt","muteText","placeholder","inputToolbarDisplayType"])],64))],2)):e.createCommentVNode("",!0),!s.value&&!e.unref(cu)&&e.unref(lu)&&i.value&&h.value.length>0?(e.openBlock(),e.createElementBlock("div",{key:2,class:"group-profile",onClick:C},e.toDisplayString(h.value[0].text),1)):e.createCommentVNode("",!0)],2)]))}}),[["__scopeId","data-v-cfd48359"]]);const hm=L(e.defineComponent({__name:"profile",props:{displayType:{type:String,default:"all"},showSetting:{type:Boolean,default:!1}},setup(t){const n=e.ref(),o=e.ref({}),a=e.ref({editProfile:{value:"editProfile",label:"编辑资料（暂未开放）",onClick:e=>{I("warn","at pages/views/profile.vue:145","编辑资料功能努力开发中，敬请期待")}},allowType:{value:"allowType",label:"加我为好友时",selectedChild:"",childrenShowType:"bottomPopup",showChildren:!1,onClick:e=>{iu||(e.showChildren=!0)},children:{[Cr.TYPES.ALLOW_TYPE_ALLOW_ANY]:{value:Cr.TYPES.ALLOW_TYPE_ALLOW_ANY,label:"同意任何用户加好友",onClick:e=>{r({allowType:e.value})}},[Cr.TYPES.ALLOW_TYPE_NEED_CONFIRM]:{value:Cr.TYPES.ALLOW_TYPE_NEED_CONFIRM,label:"需要验证",onClick:e=>{r({allowType:e.value})}},[Cr.TYPES.ALLOW_TYPE_DENY_ANY]:{value:Cr.TYPES.ALLOW_TYPE_DENY_ANY,label:"拒绝任何人加好友",onClick:e=>{r({allowType:e.value})}}}},displayMessageReadReceipt:{value:"displayMessageReadReceipt",label:"消息阅读状态",selectedChild:"userLevelReadReceiptOpen",childrenShowType:"bottomPopup",showChildren:!1,onClick(e){iu||(e.showChildren=!0)},children:{userLevelReadReceiptOpen:{value:"userLevelReadReceiptOpen",label:"开启",onClick(){c(!0)}},userLevelReadReceiptClose:{value:"userLevelReadReceiptClose",label:"关闭",onClick(){c(!1)}}}},displayOnlineStatus:{value:"displayOnlineStatus",label:"显示在线状态",selectedChild:"userLevelOnlineStatusOpen",childrenShowType:"bottomPopup",showChildren:!1,onClick(e){iu||(e.showChildren=!0)},children:{userLevelOnlineStatusOpen:{value:"userLevelOnlineStatusOpen",label:"开启",onClick(){l(!0)}},userLevelOnlineStatusClose:{value:"userLevelOnlineStatusClose",label:"关闭",onClick(){l(!1)}}}},translateLanguage:{value:"translateLanguage",label:"翻译语言",selectedChild:"zh",childrenShowType:"bottomPopup",showChildren:!1,onClick(e){iu||(e.showChildren=!0)},children:{zh:{value:"zh",label:"中文",onClick(){u("zh")}},en:{value:"en",label:"English",onClick(){u("en")}},jp:{value:"jp",label:"日本語",onClick(){u("jp")}},kr:{value:"kr",label:"한국인",onClick(){u("kr")}}}},exit:{value:"exit",label:"退出登录",onClick:e=>{Jr.logout().then((()=>{uni.removeStorage({key:"userInfo"}),new Promise(((e,t)=>{wx.removeStorage({key:"token",success:e,fail:t})})),null==Fl||Fl.reLaunch({url:"/pages/views/login"})}))}}}),i=e=>{(null==e?void 0:e.onClick)&&"function"==typeof(null==e?void 0:e.onClick)&&e.onClick(e)},s=e=>{var t;return null==(t=null==e?void 0:e.children[null==e?void 0:e.selectedChild])?void 0:t.label},r=e=>{Sr.updateMyProfile(e).then((t=>{yd({message:"更新用户资料成功",type:md,duration:0}),"allowType"in e&&(a.value.allowType.showChildren=!1)})).catch((e=>{I("warn","at pages/views/profile.vue:325","更新用户资料失败",e),yd({message:"更新用户资料失败",type:vd,duration:0})}))};function c(e){kr.update(oi.USER,"displayMessageReadReceipt",e),a.value.displayMessageReadReceipt.showChildren=!1}function l(e){Sr.switchUserStatus({displayOnlineStatus:e}),a.value.displayOnlineStatus.showChildren=!1}function u(e){Vh.clear(),Dr.setTranslationLanguage(e),a.value.translateLanguage.selectedChild=e,a.value.translateLanguage.showChildren=!1}return kr.watch(oi.USER,{userProfile:e=>{var t,n;o.value=e,(null==(t=null==o?void 0:o.value)?void 0:t.allowType)&&(a.value.allowType.selectedChild=null==(n=null==o?void 0:o.value)?void 0:n.allowType)},displayMessageReadReceipt(e){a.value.displayMessageReadReceipt.selectedChild=e?"userLevelReadReceiptOpen":"userLevelReadReceiptClose"},displayOnlineStatus(e){a.value.displayOnlineStatus.selectedChild=e?"userLevelOnlineStatusOpen":"userLevelOnlineStatusClose"}}),e.onMounted((()=>{Sr.getUserProfile().then((e=>{o.value=e.data}))})),T((()=>{var e;for(const t in a.value)(null==(e=null==a?void 0:a.value[t])?void 0:e.hasOwnProperty("showChildren"))&&(a.value[t].showChildren=!1)})),(r,c)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["TUI-profile",!e.unref(iu)&&"TUI-profile-h5"])},["setting"!==t.displayType?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["TUI-profile-basic",!e.unref(iu)&&"TUI-profile-h5-basic"])},[e.createElementVNode("img",{class:e.normalizeClass(["TUI-profile-basic-avatar",!e.unref(iu)&&"TUI-profile-h5-basic-avatar"]),src:o.value.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png"},null,10,["src"]),e.createElementVNode("div",{class:e.normalizeClass(["TUI-profile-basic-info",!e.unref(iu)&&"TUI-profile-h5-basic-info"])},[e.createElementVNode("div",{class:e.normalizeClass(["TUI-profile-basic-info-nick",!e.unref(iu)&&"TUI-profile-h5-basic-info-nick"])},e.toDisplayString(o.value.nick||"-"),3),e.createElementVNode("div",{class:e.normalizeClass(["TUI-profile-basic-info-id",!e.unref(iu)&&"TUI-profile-h5-basic-info-id"])},[e.createElementVNode("label",{class:e.normalizeClass(["TUI-profile-basic-info-id-label",!e.unref(iu)&&"TUI-profile-h5-basic-info-id-label"])},e.toDisplayString("用户ID")+":",2),e.createElementVNode("div",{class:e.normalizeClass(["TUI-profile-basic-info-id-value",!e.unref(iu)&&"TUI-profile-h5-basic-info-id-value"])},e.toDisplayString(o.value.userID),3)],2)],2)],2)):e.createCommentVNode("",!0),"profile"===t.displayType||e.unref(iu)&&!t.showSetting?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:1,ref_key:"settingDomRef",ref:n,class:e.normalizeClass(["TUI-profile-setting",!e.unref(iu)&&"TUI-profile-h5-setting"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n,class:e.normalizeClass(["TUI-profile-setting-item",!e.unref(iu)&&"TUI-profile-h5-setting-item","exit"===t.value&&"TUI-profile-h5-setting-item-exit"])},[e.createElementVNode("div",{class:e.normalizeClass(["TUI-profile-setting-item-label",!e.unref(iu)&&"TUI-profile-h5-setting-item-label"]),onClick:e=>i(t)},[e.createElementVNode("div",{class:e.normalizeClass(["label-left"])},[e.createElementVNode("div",{class:e.normalizeClass(["label-title"])},e.toDisplayString(t.label),1),t.children&&!e.unref(iu)&&"switch"===t.childrenShowType?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["label-desc"])},e.toDisplayString(t.value),1)):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:e.normalizeClass(["label-right"])},[!e.unref(iu)&&t.children&&t.selectedChild&&"bottomPopup"===t.childrenShowType?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["TUI-profile-setting-item-label-value",!e.unref(iu)&&"TUI-profile-h5-setting-item-label-value"])},e.toDisplayString(s(t)),3)):e.createCommentVNode("",!0),t.children?(e.openBlock(),e.createBlock(pu,{key:1,file:e.unref(wd),width:"14px",height:"14px",style:{width:"14px",height:"14px",display:"flex"}},null,8,["file"])):e.createCommentVNode("",!0)])],10,["onClick"]),t.children&&!e.unref(iu)&&"bottomPopup"===t.childrenShowType?(e.openBlock(),e.createBlock(qg,{key:0,show:t.showChildren,onOnClose:e=>(e=>{e.showChildren=!1})(t)},{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.children,(t=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["TUI-profile-setting-item-bottom-popup",!e.unref(iu)&&"TUI-profile-h5-setting-item-bottom-popup"]),onClick:e=>i(t)},e.toDisplayString(t.label),11,["onClick"])))),256))])),_:2},1032,["show","onOnClose"])):e.createCommentVNode("",!0)],2)))),128))],2))],2))}}),[["__scopeId","data-v-b0522da5"]]),gm=L(e.defineComponent({__name:"video-play",setup(t){const n=e.ref(),o=e.ref(!1),a=e.ref();return M((e=>{const t=decodeURIComponent(null==e?void 0:e.videoUrl);n.value=t,o.value=!0})),S((()=>{o.value=!0,a.value=Fl.createVideoContext("videoEle")})),(t,a)=>(e.openBlock(),e.createElementBlock("div",{class:"dialog-video"},[o.value?(e.openBlock(),e.createElementBlock("video",{key:0,id:"videoEle",class:"video-box",src:n.value,controls:"",autoplay:""},null,8,["src"])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-6813a508"]]),mm=e.defineComponent({__name:"web-view",setup(t){const n=e.ref("");return M((e=>{n.value=e&&e.url})),(t,o)=>(e.openBlock(),e.createElementBlock("web-view",{src:n.value},null,8,["src"]))}}),fm=[{icon:"https://web.sdk.qcloud.com/im/assets/images/Public.svg",label:"陌生人社交群（Public）",type:Cr.TYPES.GRP_PUBLIC,detail:"类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见",src:"产品文档"},{icon:"https://web.sdk.qcloud.com/im/assets/images/Meeting.svg",label:"临时会议群（Meeting）",type:Cr.TYPES.GRP_MEETING,detail:"创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见",src:"产品文档"},{icon:"https://web.sdk.qcloud.com/im/assets/images/Work.svg",label:"好友工作群（Work）",type:Cr.TYPES.GRP_WORK,detail:"类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主审批。详见",src:"产品文档"},{icon:"https://web.sdk.qcloud.com/im/assets/images/AVChatroom.svg",label:"直播群（AVChatroom）",type:Cr.TYPES.GRP_AVCHATROOM,detail:"创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见",src:"产品文档"},{icon:"https://web.sdk.qcloud.com/im/assets/images/Community.png",label:"社群（Community）",type:Cr.TYPES.GRP_COMMUNITY,detail:"创建后可以随意进出，最多支持100000人，支持历史消息存储，用户搜索群 ID 发起加群申请后，无需管理员审批即可进群。详见",src:"产品文档"}],vm=e=>fm.filter((t=>t.type===e))[0],_m=L(e.defineComponent({__name:"index",props:{groupType:{type:String,default:""}},emits:["selectType"],setup(t,{emit:n}){const o=t,a=fm,i=e.ref(),s=n;e.watchEffect((()=>{i.value=o.groupType}));return(t,n)=>(e.openBlock(),e.createElementBlock("ul",{class:"group-introduction-list select"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),((t,o)=>(e.openBlock(),e.createElementBlock("li",{key:o,class:e.normalizeClass(["select-item",[i.value===t.type&&"selected"]]),onClick:e=>(e=>{i.value=e.type,s("selectType",e.type)})(t)},[e.createElementVNode("main",{class:"select-item-type"},[e.createElementVNode("div",{class:"select-item-header"},[e.createElementVNode("aside",{class:"left"},[e.createVNode(pu,{class:"icon",file:t.icon},null,8,["file"]),e.createElementVNode("span",{class:"select-item-label"},e.toDisplayString(e.unref(Tr).t(`TUIGroup.${t.label}`)),1)]),i.value===t.type?(e.openBlock(),e.createBlock(pu,{key:0,file:e.unref(ep)},null,8,["file"])):e.createCommentVNode("",!0)]),e.createElementVNode("span",{class:"select-item-detail"},e.toDisplayString(e.unref(Tr).t(`TUIGroup.${t.detail}`)),1),e.createElementVNode("a",{class:"link",href:e.unref(im).product.url,target:"_blank",onClick:n[0]||(n[0]=t=>{return n=e.unref(im).product.url,void(lu||null==Fl||Fl.open(n));var n})},e.toDisplayString(e.unref(Tr).t(`TUIGroup.${t.src}`)),9,["href"])])],10,["onClick"])))),128))]))}}),[["__scopeId","data-v-d7c30c85"]]);class ym{constructor(){Wr.registerService(Ar.TUIGroup.SERVICE.NAME,this),Wr.registerExtension(Ar.TUIChat.EXTENSION.CHAT_HEADER.EXT_ID,this),this.onCallParamsMap=new Map,this.onCallCallbackMap=new Map,this.constants=Ar}static getInstance(){return ym.instance||(ym.instance=new ym),ym.instance}getOnCallParams(e){return this.onCallParamsMap.get(e)}getOnCallCallback(e){return this.onCallCallbackMap.get(e)}async onCall(e,t,n){switch(this.onCallParamsMap.set(e,t),this.onCallCallbackMap.set(e,n),e){case Ar.TUIGroup.SERVICE.METHOD.CREATE_GROUP:kr.update(oi.GRP,"isShowCreateComponent",!0),lu&&(null==Fl||Fl.reLaunch({url:"/TUIKit/components/TUIGroup/index"}));break;case Ar.TUIGroup.SERVICE.METHOD.OPEN_GROUP_MANAGEMENT:br.switchGroup(t.groupID),kr.update(oi.GRP,"isShowManageComponent",!0),lu&&(null==Fl||Fl.navigateTo({url:"/TUIKit/components/TUIGroup/index"}));break;case Ar.TUIGroup.SERVICE.METHOD.SELECT_GROUP_MEMBER:br.switchGroup(t.groupID),kr.update(oi.GRP,"isShowSelectComponent",!0),lu&&(null==Fl||Fl.navigateTo({url:"/TUIKit/components/TUIGroup/index"}))}}onGetExtension(e){const t=[];if(e===Ar.TUIChat.EXTENSION.CHAT_HEADER.EXT_ID)t.push({weight:100,icon:"/assets/setting.a15e5daf.svg",text:"更多",data:{},listener:{onClicked:this.groupManage.bind(this)}});return t}groupManage(e){Wr.callService({serviceName:Ar.TUIGroup.SERVICE.NAME,method:Ar.TUIGroup.SERVICE.METHOD.OPEN_GROUP_MANAGEMENT,params:e,callback:()=>{lu&&(null==Fl||Fl.navigateBack())}})}}const Im=L(e.defineComponent({__name:"index",setup(t){const n=ym.getInstance(),o=n.constants,a=e.reactive({profile:{groupID:"",name:"",type:fm[0].type,avatar:fm[0].icon,introduction:"",notification:"",memberList:[],isSupportTopic:!1},groupConfig:{title:"",value:"",key:"",type:"",placeholder:""},isEdit:!1});e.watchEffect((()=>{const e=n.getOnCallParams(o.TUIGroup.SERVICE.METHOD.CREATE_GROUP);a.profile.memberList=e.memberList,a.groupConfig.title=e.title}));const i=e.computed((()=>vm(a.profile.type))),s=e.computed((()=>{let e="添加群聊";return a.isEdit&&(e=a.groupConfig.title),Tr.t(`TUIGroup.${e}`)})),r=e.computed((()=>{const e={name:Tr.t("TUIGroup.群名称"),key:"name",placeholder:Tr.t("TUIGroup.请输入群名称")},t={name:`${Tr.t("TUIGroup.群ID")}(${Tr.t("TUIGroup.选填")})`,key:"groupID",placeholder:Tr.t("TUIGroup.请输入群ID")};return a.profile.type===Cr.TYPES.GRP_COMMUNITY?[e]:[e,t]})),c=e.computed((()=>""===a.profile.name&&!a.isEdit)),l=e=>{a.profile.type!==e&&(a.profile.type=e,a.profile.avatar=vm(e).icon,a.isEdit&&(a.groupConfig.value=e))},u=()=>{const{profile:e}=a;if(a.isEdit)return a.profile[a.groupConfig.key]=a.groupConfig.value,a.isEdit=!a.isEdit;(async e=>{try{e.memberList=e.memberList.map((e=>({userID:e.userID}))),e.type===Cr.TYPES.GRP_COMMUNITY&&delete e.groupID;const t=await br.createGroup(e),{type:n}=t.data.group;n===Cr.TYPES.GRP_AVCHATROOM&&await br.joinGroup({groupID:t.data.group.groupID,applyMessage:""}),h(t.data.group),yd({message:Tr.t("TUIGroup.群组创建成功"),type:md})}catch(t){yd({message:t.message,type:vd})}})(e)},d=()=>{if(a.isEdit)return a.isEdit=!a.isEdit;h(null)},p=e=>{switch(a.isEdit=!a.isEdit,a.groupConfig.key=e,a.groupConfig.value=a.profile[e],e){case"name":a.groupConfig.title="设置群名称",a.groupConfig.placeholder="请输入群名称",a.groupConfig.type="input";break;case"groupID":a.groupConfig.title="设置群ID",a.groupConfig.placeholder="请输入群ID",a.groupConfig.type="input";break;case"type":a.groupConfig.title="选择群类型",a.groupConfig.type="select"}},h=e=>{kr.update(oi.GRP,"isShowCreateComponent",!1);const t=n.getOnCallCallback(o.TUIGroup.SERVICE.METHOD.CREATE_GROUP);t&&t(e)};return(t,n)=>(e.openBlock(),e.createBlock(xd,{show:!0,isH5:!e.unref(iu),isHeaderShow:!1,isFooterShow:!1,background:!1,"onUpdate:show":d},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass(["group",[e.unref(iu)?"":"group-h5"]])},[e.createElementVNode("div",{class:"group-box"},[e.createElementVNode("header",{class:"group-box-header"},[e.createVNode(pu,{file:e.unref(iu)?e.unref(wg):e.unref(tp),class:"icon-close",size:"16px",onOnClick:d},null,8,["file"]),e.createElementVNode("h1",{class:"group-box-header-title"},e.toDisplayString(s.value),1)]),a.isEdit?(e.openBlock(),e.createElementBlock("div",{key:1,class:"group-list group-list-edit"},["input"===a.groupConfig.type?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,"onUpdate:modelValue":n[1]||(n[1]=e=>a.groupConfig.value=e),class:"group-name-input",type:"text",placeholder:e.unref(Tr).t(`TUIGroup.${a.groupConfig.placeholder}`)},null,8,["placeholder"])),[[e.vModelText,a.groupConfig.value]]):(e.openBlock(),e.createBlock(_m,{key:1,class:"group-introduction-list",groupType:a.groupConfig.value,onSelectType:l},null,8,["groupType"]))])):(e.openBlock(),e.createElementBlock("ul",{key:0,class:"group-list"},[e.createElementVNode("li",{class:"group-list-item"},[e.createElementVNode("label",{class:"group-list-item-label"},e.toDisplayString(e.unref(Tr).t("TUIGroup.群头像")),1),e.createVNode(Pd,{url:a.profile.avatar},null,8,["url"])]),e.createElementVNode("ul",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"group-list-item"},[e.createElementVNode("label",{class:"group-list-item-label"},e.toDisplayString(t.name),1),e.unref(iu)?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,"onUpdate:modelValue":e=>a.profile[t.key]=e,type:"text",placeholder:t.placeholder},null,8,["onUpdate:modelValue","placeholder"])),[[e.vModelText,a.profile[t.key]]]):(e.openBlock(),e.createElementBlock("span",{key:1,class:"group-h5-list-item-content",onClick:e=>p(t.key)},[e.createElementVNode("p",{class:"content"},e.toDisplayString(a.profile[t.key]),1),e.createVNode(pu,{file:e.unref(wd)},null,8,["file"])],8,["onClick"]))])))),128)),e.createElementVNode("li",{class:"group-list-introduction"},[e.createElementVNode("div",{class:"group-list-item"},[e.createElementVNode("label",{class:"group-list-item-label"},e.toDisplayString(e.unref(Tr).t("TUIGroup.群类型")),1),e.unref(iu)?(e.openBlock(),e.createBlock(_m,{key:0,groupType:a.profile.type,onSelectType:l},null,8,["groupType"])):(e.openBlock(),e.createElementBlock("span",{key:1,class:"group-h5-list-item-content",onClick:n[0]||(n[0]=e=>p("type"))},[e.createElementVNode("p",{class:"content"},e.toDisplayString(i.value.label),1),e.createVNode(pu,{file:e.unref(wd)},null,8,["file"])]))]),e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("article",{key:0,class:"group-h5-list-item-introduction"},[e.createElementVNode("label",{class:"introduction-name"},e.toDisplayString(i.value.label)+"：",1),e.createElementVNode("span",{class:"introduction-detail"},e.toDisplayString(i.value.detail),1),e.createElementVNode("a",{href:e.unref(im).product.url,target:"view_window"},e.toDisplayString(e.unref(Tr).t(`TUIGroup.${i.value.src}`)),9,["href"])]))])])])),e.createElementVNode("footer",{class:"group-profile-footer"},[e.unref(iu)&&!a.isEdit?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn-default",onClick:d},e.toDisplayString(e.unref(Tr).t("TUIGroup.取消")),1)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"btn-submit",disabled:c.value,onClick:u},e.toDisplayString(e.unref(Tr).t("TUIGroup.确认")),9,["disabled"])])])],2)])),_:1},8,["isH5"]))}}),[["__scopeId","data-v-fdcff7bd"]]),Em=L(e.defineComponent({__name:"index",props:{show:{type:Boolean,default:()=>!1}},emits:["update:show"],setup(t,{emit:n}){const o=t,a=e.ref(!1);e.watchEffect((()=>{a.value=o.show}));const i=n,s=()=>{a.value=!a.value,i("update:show",a.value)};return(t,n)=>a.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"mask",onClick:n[0]||(n[0]=e.withModifiers((t=>!e.unref(ru)&&s),["self"]))},[e.renderSlot(t.$slots,"default",{},void 0,!0)])):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-11e933ca"]]),Cm=L(e.defineComponent({__name:"manage-name",props:{data:{type:Object,default:()=>({})},isAuthor:{type:Boolean,default:!1}},emits:["update"],setup(t,{emit:n}){const o=t,a=e.ref({}),i=e.ref(""),s=e.ref(!1),r=e.ref(null);e.watchEffect((()=>{a.value=o.data}));const c=n,l=()=>{i.value?(i.value!==a.value.name&&(c("update",{key:"name",value:i.value}),a.value.name=i.value,i.value="",yd({message:Tr.t("TUIGroup.群名称修改成功"),type:md})),u()):yd({message:Tr.t("TUIGroup.群名称不能为空"),type:vd})},u=()=>{o.isAuthor&&(s.value=!s.value),s.value&&(i.value=a.value.name)};return e.watch((()=>s.value),(t=>{t&&e.nextTick((()=>{var e;null==(e=r.value)||e.focus()}))})),(n,o)=>(e.openBlock(),e.createElementBlock("div",{class:"group-name"},[e.createElementVNode("label",null,e.toDisplayString(e.unref(Tr).t("TUIGroup.群名称")),1),s.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"edit-h5":e.unref(uu)})},[e.createElementVNode("main",{class:"edit-h5-main"},[e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("header",{key:0,class:"edit-h5-header"},[e.createElementVNode("aside",{class:"left"},[e.createElementVNode("h1",null,e.toDisplayString(e.unref(Tr).t("TUIGroup.修改群聊名称")),1),e.createElementVNode("span",null,e.toDisplayString(e.unref(Tr).t("TUIGroup.修改群聊名称后，将在群内通知其他成员")),1)]),e.createElementVNode("span",{class:"close",onClick:u},e.toDisplayString(e.unref(Tr).t("关闭")),1)])),e.createElementVNode("div",{class:"input-box"},[s.value?e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,ref_key:"nameInputRef",ref:r,"onUpdate:modelValue":o[0]||(o[0]=e=>i.value=e),class:"input",type:"text",onBlur:l},null,544)),[[e.vModelText,i.value]]):e.createCommentVNode("",!0),e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",{key:1,class:"tip"},e.toDisplayString(e.unref(Tr).t("TUIGroup.仅限中文、字母、数字和下划线，2-20个字")),1))]),e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("footer",{key:1,class:"edit-h5-footer"},[e.createElementVNode("button",{class:"btn",onClick:l},e.toDisplayString(e.unref(Tr).t("确认")),1)]))])],2)):e.createCommentVNode("",!0),s.value&&e.unref(iu)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("p",{key:1,class:"name",onClick:u},[e.createElementVNode("span",null,e.toDisplayString(a.value.name),1),t.isAuthor?(e.openBlock(),e.createBlock(pu,{key:0,class:"icon",file:e.unref(bp),width:"14px",height:"14px"},null,8,["file"])):e.createCommentVNode("",!0)]))]))}}),[["__scopeId","data-v-47906bb9"]]),km=L(e.defineComponent({__name:"manage-notification",props:{data:{type:Object,default:()=>({})},isAuthor:{type:Boolean,default:!1}},emits:["update","close"],setup(t,{emit:n}){const o=t,a=e.ref({}),i=e.ref(""),s=e.ref(!1),r=e.ref(!1);e.watchEffect((()=>{a.value=o.data,i.value=a.value.notification,s.value=o.isAuthor}));const c=n,l=()=>{i.value.length>150?yd({message:Tr.t("TUIGroup.群公告字数超出限制，最大长度为150"),type:vd}):(i.value&&i.value!==a.value.notification&&(c("update",{key:"notification",value:i.value}),e.nextTick((()=>{i.value=""}))),r.value=!r.value)};return(t,n)=>e.unref(lu)?(e.openBlock(),e.createElementBlock("div",{key:1,class:"edit-h5"},[e.createElementVNode("main",{class:"edit-h5-main"},[e.createElementVNode("header",{class:"edit-h5-header"},[e.createElementVNode("aside",{class:"left"},[e.createElementVNode("h1",null,e.toDisplayString(e.unref(Tr).t("TUIGroup.群公告")),1)]),e.createElementVNode("span",{class:"close",onClick:n[2]||(n[2]=e=>{c("close","notification")})},e.toDisplayString(e.unref(Tr).t("关闭")),1)]),e.createElementVNode("div",{class:"notification"},[r.value?e.withDirectives((e.openBlock(),e.createElementBlock("textarea",{key:0,"onUpdate:modelValue":n[3]||(n[3]=e=>i.value=e),class:e.normalizeClass([e.unref(lu)?"uni-height":"","textarea"]),onKeyup:e.withKeys(l,["enter"])},null,34)),[[e.vModelText,i.value]]):(e.openBlock(),e.createElementBlock("section",{key:1,class:"row"},[a.value.notification?(e.openBlock(),e.createElementBlock("article",{key:1},e.toDisplayString(a.value.notification),1)):(e.openBlock(),e.createElementBlock("p",{key:0,class:"row-p"},e.toDisplayString(e.unref(Tr).t("TUIGroup.暂无公告")),1))])),s.value?(e.openBlock(),e.createElementBlock("footer",{key:2,class:"footer"},[r.value?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn",onClick:l},e.toDisplayString(e.unref(Tr).t("TUIGroup.发布")),1)):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn",onClick:n[4]||(n[4]=e=>r.value=!r.value)},e.toDisplayString(e.unref(Tr).t("TUIGroup.编辑")),1))])):e.createCommentVNode("",!0)])])])):(e.openBlock(),e.createElementBlock("main",{key:0,class:"notification"},[r.value?e.withDirectives((e.openBlock(),e.createElementBlock("textarea",{key:0,"onUpdate:modelValue":n[0]||(n[0]=e=>i.value=e),class:"textarea",onKeyup:e.withKeys(l,["enter"])},null,544)),[[e.vModelText,i.value]]):(e.openBlock(),e.createElementBlock("section",{key:1},[a.value.notification?(e.openBlock(),e.createElementBlock("article",{key:1},e.toDisplayString(a.value.notification),1)):(e.openBlock(),e.createElementBlock("p",{key:0},e.toDisplayString(e.unref(Tr).t("TUIGroup.暂无公告")),1))])),s.value?(e.openBlock(),e.createElementBlock("footer",{key:2},[r.value?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn",onClick:l},e.toDisplayString(e.unref(Tr).t("TUIGroup.发布")),1)):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn",onClick:n[1]||(n[1]=e=>r.value=!r.value)},e.toDisplayString(e.unref(Tr).t("TUIGroup.编辑")),1))])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-0c19d2c6"]]),Tm="/assets/del-icon.e0d1d417.svg",Mm=L(e.defineComponent({__name:"manage-member",props:{list:{type:Array,default:()=>[]},total:{type:Number,default:()=>0},isShowDel:{type:Boolean,default:()=>!1},self:{type:Object,default:()=>({})}},emits:["more","del","handleMemberProfileShow","close"],setup(t,{emit:n}){const o=t,a=e.ref(0),i=e.ref([]),s=e.ref(!1),r=e.ref({});e.watchEffect((()=>{a.value=o.total,s.value=o.isShowDel,i.value=o.list,r.value=o.self}));const c=n,l=e=>{let t="";switch(null==e?void 0:e.role){case Cr.TYPES.GRP_MBR_ROLE_ADMIN:t=Tr.t("TUIGroup.管理员");break;case Cr.TYPES.GRP_MBR_ROLE_OWNER:t=Tr.t("TUIGroup.群主")}return t&&(t=`(${t})`),e.userID===r.value.userID&&(t+=` (${Tr.t("TUIGroup.我")})`),t},u=()=>{c("more")},d=e=>{c("del",[e])},p=e=>{c("handleMemberProfileShow",e)};return(t,n)=>e.unref(lu)?(e.openBlock(),e.createElementBlock("div",{key:1,class:"edit-h5"},[e.createElementVNode("main",{class:"main"},[e.createElementVNode("header",{class:"edit-h5-header"},[e.createElementVNode("aside",{class:"left"},[e.createElementVNode("h1",null,e.toDisplayString(e.unref(Tr).t("TUIGroup.群成员")),1)]),e.createElementVNode("span",{class:"close",onClick:n[0]||(n[0]=e=>{c("close","member")})},e.toDisplayString(e.unref(Tr).t("关闭")),1)]),e.createElementVNode("div",{class:"member"},[e.createElementVNode("ul",{class:"list list-uniapp"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"list-item"},[e.createElementVNode("aside",{class:"aside",onClick:e=>p(t)},[e.createElementVNode("img",{class:"avatar",src:t.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"]),e.createElementVNode("span",{class:"name"},e.toDisplayString(t.nick||t.userID),1),e.createElementVNode("span",null,e.toDisplayString(l(t)),1)],8,["onClick"]),e.createElementVNode("div",{onClick:e=>d(t)},["Owner"!==t.role&&s.value?(e.openBlock(),e.createBlock(pu,{key:0,file:e.unref(Tm),width:"16px",height:"16px"},null,8,["file"])):e.createCommentVNode("",!0)],8,["onClick"])])))),128)),i.value.length<a.value?(e.openBlock(),e.createElementBlock("li",{key:0,class:"list-item",onClick:u},e.toDisplayString(e.unref(Tr).t("TUIGroup.查看更多")),1)):e.createCommentVNode("",!0)])])])])):(e.openBlock(),e.createElementBlock("main",{key:0,class:"member"},[e.createElementVNode("ul",{class:"list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"list-item"},[e.createElementVNode("aside",{class:"aside",onClick:e=>p(t)},[e.createElementVNode("img",{class:"avatar",src:t.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"]),e.createElementVNode("span",{class:"name"},e.toDisplayString(t.nick||t.userID),1),e.createElementVNode("span",null,e.toDisplayString(l(t)),1)],8,["onClick"]),e.createElementVNode("div",{onClick:e=>d(t)},["Owner"!==t.role&&s.value?(e.openBlock(),e.createBlock(pu,{key:0,file:e.unref(Tm),width:"16px",height:"16px"},null,8,["file"])):e.createCommentVNode("",!0)],8,["onClick"])])))),128)),i.value.length<a.value?(e.openBlock(),e.createElementBlock("li",{key:0,class:"list-item",onClick:u},e.toDisplayString(e.unref(Tr).t("TUIGroup.查看更多")),1)):e.createCommentVNode("",!0)])]))}}),[["__scopeId","data-v-595816c1"]]),Sm=L(e.defineComponent({__name:"manage-profile",props:{userInfo:{type:Object,default:()=>({})}},emits:["handleSwitchConversation","close","openConversation"],setup(t,{emit:n}){const o=t,a=e.ref(!1),i=e.ref({});e.watchEffect((()=>{i.value=o.userInfo}));const s=n;e.watch((()=>o.userInfo),(async(e,t)=>{if(e===t)return;const n=await Sr.getUserProfile({userIDList:[o.userInfo.userID]});i.value=null==n?void 0:n.data[0],c()}),{deep:!0,immediate:!0});const r=async(e,t)=>{const n=`${t}${e}`;Mr.getConversationProfile(n).then((e=>{Mr.switchConversation(e.data.conversation.conversationID).then((()=>{kr.update(oi.GRP,"isShowManageComponent",!1),lu&&(null==Fl||Fl.navigateBack())}))})).catch((e=>{I("warn","at TUIKit/components/TUIGroup/manage-group/manage-profile.vue:122","获取会话资料失败",e.code,e.msg)}))},c=async()=>{i.value.userID&&wr.checkFriend({userIDList:[i.value.userID],type:Cr.TYPES.SNS_CHECK_TYPE_BOTH}).then((e=>{var t,n,o;const i=null==(o=null==(n=null==(t=null==e?void 0:e.data)?void 0:t.successUserIDList)?void 0:n[0])?void 0:o.relation;a.value=i===Cr.TYPES.SNS_TYPE_BOTH_WAY}))},l=()=>a.value||!kr.getData(oi.APP,"isOfficial");return(t,n)=>e.unref(lu)?(e.openBlock(),e.createElementBlock("div",{key:1,class:"edit-h5"},[e.createElementVNode("main",{class:"main"},[e.createElementVNode("header",{class:"edit-h5-header"},[e.createElementVNode("aside",{class:"left"},[e.createElementVNode("h1",null,e.toDisplayString(e.unref(Tr).t("TUIGroup.群成员")),1)]),e.createElementVNode("span",{class:"close",onClick:n[1]||(n[1]=e=>{s("close","profile")})},e.toDisplayString(e.unref(Tr).t("关闭")),1)]),e.createElementVNode("div",{class:"edit-h5-profile"},[e.createElementVNode("div",{class:"memeber-profile-main"},[e.createVNode(Pd,{class:"avatar",url:i.value.avatar,size:"60px"},null,8,["url"]),e.createElementVNode("ul",{class:"list"},[e.createElementVNode("h1",null,e.toDisplayString(i.value.nick||i.value.userID),1),e.createElementVNode("li",null,[e.createElementVNode("label",null,"ID："),e.createElementVNode("span",null,e.toDisplayString(i.value.userID),1)]),e.createElementVNode("li",null,[e.createElementVNode("label",null,e.toDisplayString(e.unref(Tr).t("TUIContact.个性签名"))+"：",1),e.createElementVNode("span",null,e.toDisplayString(i.value.selfSignature),1)])])]),e.createElementVNode("div",{class:"memeber-profile-footer"},[l()?(e.openBlock(),e.createElementBlock("div",{key:0,class:"button",onClick:n[2]||(n[2]=e=>r(i.value.userID,"C2C"))},e.toDisplayString(e.unref(Tr).t("TUIContact.发送消息")),1)):e.createCommentVNode("",!0)])])])])):(e.openBlock(),e.createElementBlock("div",{key:0,class:"memeber-profile"},[e.createElementVNode("div",{class:"memeber-profile-main"},[e.createElementVNode("img",{class:"avatar",src:i.value.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"]),e.createElementVNode("ul",{class:"list"},[e.createElementVNode("h2",null,e.toDisplayString(i.value.nick||i.value.userID),1),e.createElementVNode("li",null,[e.createElementVNode("label",null,"ID："),e.createElementVNode("span",null,e.toDisplayString(i.value.userID),1)]),e.createElementVNode("li",null,[e.createElementVNode("label",null,e.toDisplayString(e.unref(Tr).t("TUIContact.个性签名"))+"：",1),e.createElementVNode("span",null,e.toDisplayString(i.value.selfSignature),1)])])]),e.createElementVNode("div",{class:"memeber-profile-footer"},[l()?(e.openBlock(),e.createElementBlock("div",{key:0,class:"button",onClick:n[0]||(n[0]=e=>r(i.value.userID,"C2C"))},e.toDisplayString(e.unref(Tr).t("TUIContact.发送消息")),1)):e.createCommentVNode("",!0)])]))}}),[["__scopeId","data-v-748e9c78"]]),Dm=L(e.defineComponent({__name:"index",props:{open:{type:Boolean,default:!1}},emits:["change"],setup(t,{emit:n}){const o=t,a=e.ref(!1),i=n;e.watchEffect((()=>{a.value=o.open}));const s=()=>{a.value=!a.value,i("change",a.value)};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["slider-box",[a.value&&"slider-open"]]),onClick:s},[e.createElementVNode("span",{class:"slider-block"})],2))}}),[["__scopeId","data-v-844a13f7"]]),bm="/assets/plus.dfad243b.svg",wm="/assets/minus.28312fe8.svg",Nm=L(e.defineComponent({__name:"manage-admin",props:{member:{type:Object,default:()=>{}},isSetMuteTime:{type:Boolean,default:()=>!1},currentGroup:{type:Object,default:()=>{}}},emits:["addAdmin","removeAdmin","setAllMuteTime","addMute","removeMute","close"],setup(t,{emit:n}){const o=t,a=e.ref(!1),i=e.ref({admin:[],member:[],muteMember:[]}),s=e.ref();e.watchEffect((()=>{i.value=o.member,a.value=o.isSetMuteTime,s.value=o.currentGroup}));const r=n,c=()=>{r("addAdmin")},l=()=>{r("removeAdmin")},u=e=>{r("setAllMuteTime",e)},d=()=>{r("addMute")},p=()=>{r("removeMute")};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"admin-main"},[e.createElementVNode("div",{class:"admin-manage"},[e.createElementVNode("div",{class:"admin-manage-header"},e.toDisplayString(e.unref(Tr).t("TUIGroup.群管理员")),1),e.createElementVNode("ul",{class:"admin-manage-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value.admin,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"admin-manage-list-item"},[e.createElementVNode("div",{class:"item-main"},[e.createElementVNode("img",{class:"item-main-avatar",src:t.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"])]),e.createElementVNode("div",{class:"item-name"},e.toDisplayString(t.nick||t.userID),1)])))),128)),e.createElementVNode("li",{class:"admin-manage-list-item"},[e.createElementVNode("div",{class:"item-main",onClick:c},[e.createVNode(pu,{file:e.unref(bm),width:"16px",height:"16px"},null,8,["file"])])]),e.createElementVNode("li",{class:"admin-manage-list-item"},[i.value.admin.length>0?(e.openBlock(),e.createElementBlock("div",{key:0,class:"item-main",onClick:l},[e.createVNode(pu,{file:e.unref(wm),width:"16px",height:"16px"},null,8,["file"])])):e.createCommentVNode("",!0)])])]),a.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"admin-mute-all"},[e.createElementVNode("div",null,[e.createElementVNode("div",{class:"admin-mute-all-title"},e.toDisplayString(e.unref(Tr).t("TUIGroup.全员禁言")),1),e.createElementVNode("div",{class:"admin-mute-all-content"},e.toDisplayString(e.unref(Tr).t("TUIGroup.全员禁言开启后，只允许群主和管理员发言。")),1)]),e.createVNode(Dm,{open:s.value.muteAllMembers,onChange:u},null,8,["open"])])):e.createCommentVNode("",!0),a.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:"admin-mute"},[e.createElementVNode("div",{class:"admin-mute-header"},e.toDisplayString(e.unref(Tr).t("TUIGroup.单独禁言人员")),1),e.createElementVNode("ul",{class:"admin-mute-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value.muteMember,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"admin-mute-list-item"},[e.createElementVNode("div",{class:"item-main"},[e.createElementVNode("img",{class:"item-main-avatar",src:t.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"])]),e.createElementVNode("div",{class:"item-name"},e.toDisplayString(t.nick||t.userID),1)])))),128)),e.createElementVNode("li",{class:"admin-mute-list-item"},[e.createElementVNode("div",{class:"item-main",onClick:d},[e.createVNode(pu,{file:e.unref(bm),width:"16px",height:"16px"},null,8,["file"])])]),e.createElementVNode("li",{class:"admin-mute-list-item"},[i.value.muteMember.length>0?(e.openBlock(),e.createElementBlock("div",{key:0,class:"item-main",onClick:p},[e.createVNode(pu,{file:e.unref(wm),width:"16px",height:"16px"},null,8,["file"])])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-affcd0c1"]]),Lm=e.defineComponent({__name:"index",props:{groupID:{type:String,default:""},groupCurrentTab:{type:String,default:""}},setup(t){const n=ym.getInstance(),o=n.constants,a=t,i=e.ref(void 0),s=e.ref(""),r=e.ref(""),c=e.ref(""),l=e.ref(!1),u=e.ref(""),d=e.ref({list:[]}),p=e.ref({}),h=e.ref({[Cr.TYPES.GRP_WORK]:"好友工作群",[Cr.TYPES.GRP_PUBLIC]:"陌生人社交群",[Cr.TYPES.GRP_MEETING]:"临时会议群",[Cr.TYPES.GRP_AVCHATROOM]:"直播群",[Cr.TYPES.GRP_COMMUNITY]:"社群",[Cr.TYPES.JOIN_OPTIONS_FREE_ACCESS]:"自由加入",[Cr.TYPES.JOIN_OPTIONS_NEED_PERMISSION]:"需要验证",[Cr.TYPES.JOIN_OPTIONS_DISABLE_APPLY]:"禁止加群"}),g=e.ref({admin:[],member:[],muteMember:[]}),m=e.ref([]),f=e.ref(""),v=e.ref(!1),_=e.ref(!1),y=e.ref([]),I=e.ref(!1),E=e.ref([]),C=e.ref([]),k=e.ref(),T=e.ref(""),M=e.ref("");e.onMounted((()=>{e.nextTick((()=>{i.value&&!lu&&au.listen({domRefs:i.value,handler:Z})}))})),kr.watch(oi.GRP,{currentGroup:e=>{var t,n;e&&(k.value=e,T.value=null==(n=null==(t=k.value)?void 0:t.selfInfo)?void 0:n.role)},currentGroupMemberList:e=>{E.value=e,g.value={admin:[],member:[],muteMember:[]},Array.from(e).map((e=>{switch(null==e?void 0:e.role){case Cr.TYPES.GRP_MBR_ROLE_ADMIN:g.value.admin.push(e);break;case Cr.TYPES.GRP_MBR_ROLE_MEMBER:g.value.member.push(e)}return e}));const t=(new Date).getTime();g.value.muteMember=Array.from(e).filter((e=>1e3*(null==e?void 0:e.muteUntil)-t>0))}}),kr.watch(oi.CONV,{currentConversation:e=>{var t;M.value=null==(t=null==e?void 0:e.groupProfile)?void 0:t.groupID}}),e.watchEffect((()=>{const e=n.getOnCallParams(o.TUIGroup.SERVICE.METHOD.OPEN_GROUP_MANAGEMENT);u.value=(null==e?void 0:e.groupID)||M.value,s.value=a.groupCurrentTab}));const S=e.computed((()=>{let e="";switch(s.value){case"notification":e="群公告";break;case"member":case"profile":e="群成员";break;default:e="群管理"}return e})),D=e.computed((()=>{var e,t;return(null==(t=null==(e=k.value)?void 0:e.selfInfo)?void 0:t.role)===Cr.TYPES.GRP_MBR_ROLE_OWNER})),b=e.computed((()=>{var e,t;return(null==(t=null==(e=k.value)?void 0:e.selfInfo)?void 0:t.role)===Cr.TYPES.GRP_MBR_ROLE_OWNER})),w=e.computed((()=>{var e;return(null==(e=k.value)?void 0:e.type)===Cr.TYPES.GRP_WORK})),N=e.computed((()=>!(w.value||!D.value&&!b.value))),L=e.computed((()=>{var e;return!((null==(e=null==k?void 0:k.value)?void 0:e.type)===Cr.TYPES.GRP_AVCHATROOM)})),R=async e=>{const{key:t,value:n}=e,o={groupID:k.value.groupID,[t]:n};br.updateGroupProfile(o).then((e=>{k.value=e.data.group,r.value=""})).catch((e=>{yd({message:null==e?void 0:e.message,type:vd})}))},A=e=>{s.value=e,r.value="","member"===s.value&&(c.value="remove"),s.value||(c.value="")},O=()=>{U()},U=async e=>{var t;y.value=[];let n=[];switch(e){case"add":_.value=!1,n=[...g.value.admin,...g.value.member].map((e=>e.userID)),m.value=(await P()).filter((e=>e.userID&&n.indexOf(e.userID)<0)),f.value="添加成员";break;case"remove":_.value=!1,m.value=E.value.filter((e=>{var t,n;return e.userID!==(null==(n=null==(t=null==k?void 0:k.value)?void 0:t.selfInfo)?void 0:n.userID)})),f.value="删除成员";break;case"addAdmin":_.value=!0,m.value=g.value.member,f.value="新增管理员";break;case"removeAdmin":_.value=!0,m.value=g.value.admin,f.value="移除管理员";break;case"changeOwner":_.value=!0,m.value=[...g.value.admin,...g.value.member],f.value="转让群组";break;case"addMute":_.value=!0,m.value=g.value.member,"Owner"===k.value.selfInfo.role&&(m.value=[...g.value.admin,...g.value.member]),m.value=null==(t=null==m?void 0:m.value)?void 0:t.filter((e=>{var t,n;return(null==(n=null==(t=null==g?void 0:g.value)?void 0:t.muteMember)?void 0:n.indexOf(e))<0})),f.value="新增禁言用户";break;case"removeMute":_.value=!0,m.value=g.value.muteMember,f.value="移除禁言用户"}e&&(c.value=e),l.value=!l.value},P=async()=>(await wr.getFriendList()).data.map((e=>null==e?void 0:e.profile)).filter((e=>!d.value.list.some((t=>t.userID===e.userID)))),G=e.computed((()=>{var e,t,n;const o=null==(t=null==(e=null==k?void 0:k.value)?void 0:e.selfInfo)?void 0:t.role,a=null==(n=null==k?void 0:k.value)?void 0:n.type;return o===Cr.TYPES.GRP_MBR_ROLE_OWNER&&a!==Cr.TYPES.GRP_WORK})),x=e.computed((()=>{var e;return(null==(e=null==k?void 0:k.value)?void 0:e.type)===Cr.TYPES.GRP_WORK})),B=e.computed((()=>{var e,t;let n=3;return x.value||(n+=1),"Owner"!==(null==(t=null==(e=null==k?void 0:k.value)?void 0:e.selfInfo)?void 0:t.role)&&(n+=1),n})),V=e=>{p.value=e,A("profile")},F=e=>{"remove"===c.value?(C.value=e,I.value=!I.value):z(e,c.value),l.value=!1},H=()=>{lu?null==Fl||Fl.switchTab({url:"/TUIKit/components/TUIConversation/index"}):(Z(),Mr.switchConversation())},j=e=>{R({key:"muteAllMembers",value:e}),e?(Nd("muteGroup"),yd({message:Tr.t("TUIGroup.禁言设置成功"),type:md})):yd({message:Tr.t("TUIGroup.取消禁言成功"),type:md})},q=async e=>{var t,n;let o={},a={};const i={groupID:u.value,userIDList:[e]};switch(c.value){case"add":try{a=await br.getGroupMemberProfile(i),m.value=m.value.filter((e=>{var t;return e.userID!==(null==(t=o.data[0])?void 0:t.userID)})),m.value=[...m.value,...o.data],(null==(t=null==a?void 0:a.data)?void 0:t.memberList.length)>0&&(m.value=m.value.map((e=>{var t;return e.userID===(null==(t=null==a?void 0:a.data)?void 0:t.memberList[0].userID)&&(e.isDisabled=!0),e})))}catch(s){const e=Tr.t("TUIGroup.该用户不存在");yd({message:e,type:vd})}break;case"remove":try{if(o=await br.getGroupMemberProfile(i),0===o.data.memberList.length){const e=Tr.t("TUIGroup.该用户不在群组内");yd({message:e,type:vd})}m.value=m.value.filter((e=>{var t,n;return e.userID!==(null==(n=null==(t=null==o?void 0:o.data)?void 0:t.memberList[0])?void 0:n.userID)})),(null==(n=null==o?void 0:o.data)?void 0:n.memberList.length)&&(m.value=[...m.value,...o.data.memberList])}catch(s){const e=Tr.t("TUIGroup.该用户不存在");yd({message:e,type:vd})}}},z=(e,t)=>{const n=[];switch(e.map((e=>(n.push(e.userID),e))),t){case"add":K(n);break;case"remove":J(n);break;case"addAdmin":case"removeAdmin":W(e[0]);break;case"changeOwner":$(n[0]);break;case"addMute":Y(n[0],"add");break;case"removeMute":Y(n[0],"remove")}},K=async e=>{const t={groupID:u.value,userIDList:e};await br.addGroupMember(t)},$=async e=>{const t={groupID:u.value,newOwnerID:e},n=await br.changeGroupOwner(t);k.value={},k.value=n.data.group},Y=async(e,t)=>{const n={groupID:u.value,userID:e,muteTime:"add"===t?2592e3:0};await br.setGroupMemberMuteTime(n)},W=async e=>{let t="";switch(e.role){case Cr.TYPES.GRP_MBR_ROLE_ADMIN:t=Cr.TYPES.GRP_MBR_ROLE_MEMBER;break;case Cr.TYPES.GRP_MBR_ROLE_MEMBER:t=Cr.TYPES.GRP_MBR_ROLE_ADMIN}const n={groupID:u.value,userID:e.userID,role:t};await br.setGroupMemberRole(n)},J=async e=>{const t={groupID:u.value,userIDList:e,reason:""};await br.deleteGroupMember(t)},X=()=>{s.value?A(""):Z()},Z=()=>{kr.update(oi.GRP,"isShowManageComponent",!1);const e=n.getOnCallCallback(o.TUIGroup.SERVICE.METHOD.OPEN_GROUP_MANAGEMENT);e&&e()};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"manageRef",ref:i,class:"manage"},[e.unref(lu)&&"admin"!==s.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("header",{key:0,class:"manage-header"},[e.createVNode(pu,{file:e.unref(tp),onOnClick:X},null,8,["file"]),e.createElementVNode("div",{class:"manage-header-content"},e.toDisplayString(e.unref(Tr).t(`TUIGroup.${S.value}`)),1),e.createElementVNode("div")])),!s.value||e.unref(lu)&&"admin"!=s.value?(e.openBlock(),e.createElementBlock("main",{key:1,class:"main"},[e.createVNode(Cm,{class:"space-top",isAuthor:D.value||b.value||w.value,data:k.value,onUpdate:R},null,8,["isAuthor","data"]),e.createElementVNode("div",{class:"user-info space-top"},[e.createElementVNode("header",{class:"user-info-header",onClick:n[0]||(n[0]=e=>A("member"))},[e.createElementVNode("label",{class:"user-info-header-left"},e.toDisplayString(e.unref(Tr).t("TUIGroup.群成员")),1),e.createElementVNode("div",{class:"user-info-header-right"},[e.createElementVNode("span",{class:"span"},e.toDisplayString(k.value.memberCount||E.value.length)+" "+e.toDisplayString(e.unref(Tr).t("TUIGroup.人")),1),e.createVNode(pu,{file:e.unref(wd)},null,8,["file"])])]),e.createElementVNode("ol",{class:"user-info-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.value.slice(0,B.value),((t,n)=>(e.openBlock(),e.createElementBlock("dl",{key:n,class:"user-info-list-item"},[e.createElementVNode("dt",{class:"user-info-list-item-main",onClick:e=>V(t)},[e.createElementVNode("img",{class:"avatar",src:t.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"])],8,["onClick"]),e.createElementVNode("dd",{class:"user-info-list-item-info"},e.toDisplayString(t.nick||t.userID),1)])))),128)),x.value?(e.openBlock(),e.createElementBlock("dl",{key:0,class:"user-info-list-item"},[e.createElementVNode("dt",{class:"avatar",onClick:n[1]||(n[1]=e=>U("add"))}," + ")])):e.createCommentVNode("",!0),"Owner"===T.value?(e.openBlock(),e.createElementBlock("dl",{key:1,class:"user-info-list-item"},[e.createElementVNode("dt",{class:"avatar",onClick:n[2]||(n[2]=e=>U("remove"))}," - ")])):e.createCommentVNode("",!0)])]),e.createElementVNode("ul",{class:"content list space-top",onClick:n[5]||(n[5]=e=>r.value="")},[e.createElementVNode("li",{class:"list-item",onClick:n[3]||(n[3]=e=>A("notification"))},[e.createElementVNode("aside",{class:"aside"},[e.createElementVNode("label",{class:"label"},e.toDisplayString(e.unref(Tr).t("TUIGroup.群公告")),1),e.createElementVNode("article",{class:"article"},e.toDisplayString(k.value.notification),1)]),e.createVNode(pu,{file:e.unref(wd),class:"end"},null,8,["file"])]),(b.value||D.value)&&N.value?(e.openBlock(),e.createElementBlock("li",{key:0,class:"list-item",onClick:n[4]||(n[4]=e=>A("admin"))},[e.createElementVNode("label",{class:"label"},e.toDisplayString(e.unref(Tr).t("TUIGroup.群管理")),1),e.createVNode(pu,{file:e.unref(wd)},null,8,["file"])])):e.createCommentVNode("",!0),e.createElementVNode("li",{class:"list-item"},[e.createElementVNode("label",{class:"label"},e.toDisplayString(e.unref(Tr).t("TUIGroup.群ID")),1),e.createElementVNode("div",{class:"groupID"},[e.createElementVNode("span",{class:"span"},e.toDisplayString(u.value),1)])]),e.createElementVNode("li",{class:"list-item"},[e.createElementVNode("label",{class:"label"},e.toDisplayString(e.unref(Tr).t("TUIGroup.群头像")),1),e.createElementVNode("img",{class:"avatar",src:k.value.avatar||"https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg'"},null,8,["src"])]),e.createElementVNode("li",{class:"list-item"},[e.createElementVNode("label",{class:"label"},e.toDisplayString(e.unref(Tr).t("TUIGroup.群类型")),1),e.createElementVNode("span",{class:"span"},e.toDisplayString(e.unref(Tr).t(`TUIGroup.${h.value[k.value.type]}`)),1)]),e.createElementVNode("li",{class:"list-item"},[e.createElementVNode("label",{class:"label"},e.toDisplayString(e.unref(Tr).t("TUIGroup.加群方式")),1),e.createElementVNode("span",{class:"span"},e.toDisplayString(e.unref(Tr).t(`TUIGroup.${h.value[k.value.joinOption]}`)),1)])]),e.createElementVNode("ul",{class:"footer list space-top"},["Owner"===T.value&&E.value.length>1?(e.openBlock(),e.createElementBlock("li",{key:0,class:"list-item",onClick:n[6]||(n[6]=e.withModifiers((e=>U("changeOwner")),["stop"]))},e.toDisplayString(e.unref(Tr).t("TUIGroup.转让群组")),1)):e.createCommentVNode("",!0),G.value?(e.openBlock(),e.createElementBlock("li",{key:1,class:"list-item",onClick:n[7]||(n[7]=e.withModifiers((e=>(async e=>{await br.dismissGroup(e.groupID),Nd("dismissGroup"),yd({message:Tr.t("TUIGroup.群组解散成功"),type:md}),H()})(k.value)),["stop"]))},e.toDisplayString(e.unref(Tr).t("TUIGroup.解散群聊")),1)):(e.openBlock(),e.createElementBlock("li",{key:2,class:"list-item",onClick:n[8]||(n[8]=e.withModifiers((e=>(async e=>{await br.quitGroup(e.groupID),H()})(k.value)),["stop"]))},e.toDisplayString(e.unref(Tr).t("TUIGroup.退出群组")),1))])])):e.createCommentVNode("",!0),"member"===s.value?(e.openBlock(),e.createBlock(Mm,{key:2,self:k.value.selfInfo,list:E.value,total:~~k.value.memberCount,isShowDel:"Owner"===T.value&&L.value,onMore:n[9]||(n[9]=e=>(async e=>{const t={groupID:u.value,count:100,offset:e&&"more"===e?d.value.list.length:0};await br.getGroupMemberList(t).then((t=>{d.value.list=e&&"more"===e?[...d.value.list,...t.data.memberList]:t.data.memberList}))})("more")),onDel:F,onHandleMemberProfileShow:V,onClose:n[10]||(n[10]=e=>A(""))},null,8,["self","list","total","isShowDel"])):e.createCommentVNode("",!0),"profile"===s.value?(e.openBlock(),e.createBlock(Sm,{key:3,userInfo:p.value,onClose:n[11]||(n[11]=e=>A(""))},null,8,["userInfo"])):e.createCommentVNode("",!0),"notification"===s.value?(e.openBlock(),e.createBlock(km,{key:4,isAuthor:D.value||b.value||w.value,data:k.value,onUpdate:R,onClose:n[12]||(n[12]=e=>A(""))},null,8,["isAuthor","data"])):e.createCommentVNode("",!0),"admin"===s.value?e.withDirectives((e.openBlock(),e.createBlock(Nm,{key:5,isSetMuteTime:N.value,member:g.value,currentGroup:k.value,onAddAdmin:n[13]||(n[13]=e=>U("addAdmin")),onRemoveAdmin:n[14]||(n[14]=e=>U("removeAdmin")),onSetAllMuteTime:j,onAddMute:n[15]||(n[15]=e=>U("addMute")),onRemoveMute:n[16]||(n[16]=e=>U("removeMute")),onClose:n[17]||(n[17]=e=>A(""))},null,8,["isSetMuteTime","member","currentGroup"])),[[e.vShow,b.value]]):e.createCommentVNode("",!0),e.createVNode(Em,{show:l.value,"onUpdate:show":n[18]||(n[18]=e=>l.value=e)},{default:e.withCtx((()=>[e.createVNode(op,{title:e.unref(Tr).t(`TUIGroup.${f.value}`),list:m.value,isSearch:v.value,isRadio:_.value,selectedList:y.value,isH5:!e.unref(iu),onSubmit:F,onCancel:O,onSearch:q},null,8,["title","list","isSearch","isRadio","selectedList","isH5"])])),_:1},8,["show"]),e.createVNode(xd,{class:"deleted-dialog",title:e.unref(Tr).t("TUIGroup.删除成员"),show:I.value,isH5:!e.unref(iu),center:!0,isHeaderShow:e.unref(iu),onSubmit:n[19]||(n[19]=e=>z(C.value,"remove")),"onUpdate:show":n[20]||(n[20]=e=>I.value=e)},{default:e.withCtx((()=>[1===C.value.length?(e.openBlock(),e.createElementBlock("p",{key:0,class:"del-dialog-title"},e.toDisplayString(e.unref(Tr).t("TUIGroup.确定从群聊中删除该成员？")),1)):e.createCommentVNode("",!0),C.value.length>1?(e.openBlock(),e.createElementBlock("p",{key:1,class:"del-dialog-title"},e.toDisplayString(e.unref(Tr).t("TUIGroup.确定从群聊中删除所选成员？")),1)):e.createCommentVNode("",!0)])),_:1},8,["title","show","isH5","isHeaderShow"])],512))}}),Rm=L(Lm,[["__scopeId","data-v-ed0c0c6a"]]),Am=e.defineComponent({__name:"index",setup(t){const n=ym.getInstance(),o=n.constants,a=e.ref(!1),i=e.ref([]),s=e.ref([]),r=e.ref({}),c=e.ref({groupID:"",isRadio:!1,isNeedSearch:!1,title:"",filterUserIDList:[]}),l=e.ref(null);e.watchEffect((()=>{const e=n.getOnCallParams(o.TUIContact.SERVICE.METHOD.SELECT_FRIEND);var t;c.value.groupID=e.groupID,c.value.title=e.title,c.value.isRadio=e.isRadio,c.value.isNeedSearch=e.isNeedSearch,c.value.filterUserIDList=e.filterUserIDList,e.isNeedSearch&&(t=e.isNeedSearch,l.value=Wr.getService(o.TUISearch.SERVICE.NAME),l.value?a.value=t:I("warn","at TUIKit/components/TUIGroup/select-member/index.vue:41","请添加 TUISearch 组件"))})),kr.watch(oi.GRP,{currentGroup:e=>{r.value=e},currentGroupMemberList:e=>{i.value=e.map((e=>{c.value.filterUserIDList.indexOf(e.userID)>-1&&(e.isDisabled=!0)})),s.value=i.value}});const u=async()=>{const e={groupID:r.value.groupID,count:100,offset:i.value.length};await br.getGroupMemberList(e)},d=e=>{kr.update(oi.GRP,"isShowSelectComponent",!1);const t=n.getOnCallCallback(o.TUIGroup.SERVICE.METHOD.SELECT_GROUP_MEMBER);t&&t(e)},p=()=>{yd({message:Tr.t("TUIGroup.该用户不存在"),type:vd}),s.value=[...i.value]},h=async e=>{if(!e)return s.value=i.value;try{const t=await l.value.searchGroupMember(e);if(!t.data[0])return p();s.value=t.data;const n=i.value.filter((e=>e.userID===t.data[0].userID));i.value=n.length?i.value:[...i.value,...s.value]}catch(t){return p()}};return(t,n)=>(e.openBlock(),e.createBlock(ap,{isRadio:c.value.isRadio,isNeedSearch:c.value.isNeedSearch,title:c.value.title,userList:s.value,total:r.value.memberCount,onGetMore:u,onSearch:h,onComplete:d},null,8,["isRadio","isNeedSearch","title","userList","total"]))}}),Om=L(e.defineComponent({__name:"index",setup(t){const n=e.ref(!1),o=e.ref(!1),a=e.ref(!1);return kr.watch(oi.GRP,{isShowCreateComponent:e=>{n.value=!!e},isShowManageComponent:e=>{o.value=!!e},isShowSelectComponent:e=>{a.value=!!e}}),(t,i)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass([(n.value||o.value||a.value)&&"tui-group"])},[n.value?(e.openBlock(),e.createBlock(Im,{key:0})):e.createCommentVNode("",!0),o.value?(e.openBlock(),e.createBlock(Rm,{key:1})):e.createCommentVNode("",!0),a.value?(e.openBlock(),e.createBlock(Am,{key:2})):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-b5e49046"]]);const Um=L({data:()=>({infoList:[],statusBarHeight:""}),onLoad(){this.statusBarHeight=getApp().globalData.top,this.loadNoticeList()},methods:{goback(){uni.navigateBack()},async adverbtn(e,t){I("log","at pages/pagesall/home/informationDetails.vue:59",e,t);const n=this.infoList[t];I("log","at pages/pagesall/home/informationDetails.vue:61",n.id),uni.navigateTo({url:`/pages/pagesall/home/informationDetailsmess?id=${n.id}`})},mycode(){uni.navigateTo({url:"/pages/pagesall/home/mycode"})},async loadNoticeList(){try{const e=se();this.infoList=e.infoList,I("log","at pages/pagesall/home/informationDetails.vue:75","+++++++++++",this.infoList)}catch(e){I("error","at pages/pagesall/home/informationDetails.vue:77","获取公告消息失败:",e)}}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"codepage"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"code_titlebox"},[e.createElementVNode("view",{class:"messImg",onClick:n[0]||(n[0]=(...e)=>s.goback&&s.goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"code_title"}," 资讯 ")]),i.infoList.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(i.infoList,((n,o)=>(e.openBlock(),e.createElementBlock("view",{class:"adverbox",key:o},[e.createElementVNode("view",{class:"adver_time"},[e.createElementVNode("view",{class:"adver_hour",style:{"text-align":"center","font-weight":"400","font-size":"20rpx",color:"#000000",margin:"28rpx 0 28rpx 0"}},[e.createElementVNode("text",null,e.toDisplayString(n.month),1),e.createElementVNode("text",{style:{"margin-left":"20rpx"}},e.toDisplayString(n.hour),1)]),e.createElementVNode("view",{class:"adver_content"},[e.createElementVNode("view",{class:"adver_text1"},e.toDisplayString(n.title),1),e.createElementVNode("view",null,[e.createElementVNode("image",{src:n.thumb,mode:"scaleToFill"},null,8,["src"])]),e.createElementVNode("view",{class:"adver_text2"},e.toDisplayString(n.description),1),e.createElementVNode("view",{class:"line"},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng754b004becd9b25a8ebdc9d2cb98f423d3fa6fdf022dd0a97d950d38fe548f62",alt:""})]),e.createElementVNode("view",{class:"adver_btn",onClick:e=>s.adverbtn(t.event,o)}," 查看详情 ",8,["onClick"])])])])))),128)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"kong",style:{display:"flex","justify-content":"center","align-items":"center",height:"100vh"}},[e.createElementVNode("image",{style:{"margin-top":"-600rpx"},src:il,mode:"aspectFit"})]))])}],["__scopeId","data-v-baf8051c"]]);const Pm=L({data:()=>({messageList:[],selectedMessage:null,statusBarHeight:""}),onLoad(e){this.statusBarHeight=getApp().globalData.top;const t=se();this.messageList=t.infoList;const n=e.id;this.selectedMessage=this.messageList.find((e=>e.id.toString()===n.toString())),I("log","at pages/pagesall/home/informationDetailsmess.vue:52",this.selectedMessage)},methods:{goback(){uni.navigateBack()}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock("view",{class:"code_page"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"code_titlebox"},[e.createElementVNode("view",{class:"messImg",onClick:n[0]||(n[0]=(...e)=>s.goback&&s.goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"code_title"},e.toDisplayString(i.selectedMessage.title),1)]),e.createElementVNode("view",{class:"detail_title"},[e.createElementVNode("text",{style:{"font-weight":"500","font-size":"32rpx",color:"#000000",width:"70%",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}}),e.createElementVNode("view",{class:"detail_time"},[e.createElementVNode("view",{class:"time_1"},e.toDisplayString(i.selectedMessage.addtime),1)])]),e.createElementVNode("div",{class:"detail_box",innerHTML:i.selectedMessage.content},null,8,["innerHTML"])])}]]);const Gm=L({data:()=>({statusBarHeight:"",temworkList:[{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/ea7d95474d6a417b957c39bcd0690a48_mergeImage.png",title:'硬比书法"三点水"书写',teacher:"讲师:李晓华",date:"6-22"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/ea7d95474d6a417b957c39bcd0690a48_mergeImage.png",title:'硬比书法"三点水"书写',teacher:"讲师:李晓华",date:"6-22"}],workList:[{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/ea7d95474d6a417b957c39bcd0690a48_mergeImage.png",title:"有进步继续努力",teacher:"审阅:李晓华老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/ea7d95474d6a417b957c39bcd0690a48_mergeImage.png",title:"有进步继续努力",teacher:"审阅:李晓华老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/ea7d95474d6a417b957c39bcd0690a48_mergeImage.png",title:"有进步继续努力",teacher:"审阅:李晓华老师"},{img:"https://lanhu-dds-backend.oss-cn-beijing.aliyuncs.com/merge_image/imgs/ea7d95474d6a417b957c39bcd0690a48_mergeImage.png",title:"有进步继续努力",teacher:"审阅:李晓华老师"}]}),onLoad(){this.statusBarHeight=getApp().globalData.top},mounted(){this.loadMyTemporaryHomework()},methods:{async loadMyTemporaryHomework(){try{const e=await te();this.temworkList=e.items||[],I("log","at pages/pagesall/mypage/myCourses.vue:121","教师信息:",this.temworkList)}catch(e){I("error","at pages/pagesall/mypage/myCourses.vue:123","获取教学消息失败:",e)}},work_goback(){uni.navigateBack()}}},[["render",function(t,n,o,a,i,s){return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"homework_Title"},[e.createElementVNode("view",{style:e.normalizeStyle("height:"+(i.statusBarHeight+5)+"px;")},null,4),e.createElementVNode("view",{class:"homeworkImg",onClick:n[0]||(n[0]=(...e)=>s.work_goback&&s.work_goback(...e))},[e.createElementVNode("img",{src:"https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng427bd6433cc6e0a8e82f63b3174b2c817dc9c299bd0c4414c8d258f46cf46f94",alt:""})]),e.createElementVNode("view",{class:"homework_Title_text"}," 我的课程 ")]),e.createElementVNode("swiper",{class:"swiper-container","indicator-dots":"",autoplay:"",interval:"3000",circular:"","indicator-color":"#ddd","indicator-active-color":"#333"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.images,((n,o)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:o,onClick:()=>t.swiper_click(o+1)},[e.createElementVNode("image",{src:n.thumb,class:"swiper-image"},null,8,["src"])],8,["onClick"])))),128))]),e.createElementVNode("view",{class:"homeworktbox"},[e.createElementVNode("text",{class:"box-text1"},"最近在看")]),e.createElementVNode("view",{class:"tem-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.temworkList,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"temlist",key:n},[e.createElementVNode("view",{class:"temlistImg"},[e.createElementVNode("img",{src:t.sub_image,alt:""},null,8,["src"])]),e.createElementVNode("view",{class:"temlistText1"},e.toDisplayString(t.content),1),e.createElementVNode("view",{class:"temlistText2"},[e.createElementVNode("text",null,"讲师："+e.toDisplayString(t.teacher_name),1),e.createElementVNode("text",null,e.toDisplayString((new Date(t.finish_time).getMonth()+1).toString().padStart(2,"0")+"-"+new Date(t.finish_time).getDate().toString().padStart(2,"0")),1)])])))),128))]),e.createElementVNode("view",{class:"homeworktbox"},[e.createElementVNode("text",{class:"box-text1"},"最新解锁")]),e.createElementVNode("view",{class:"tem-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.workList,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"temlist",key:n},[e.createElementVNode("view",{class:"temlistImg"},[e.createElementVNode("img",{src:t.img,alt:""},null,8,["src"])]),e.createElementVNode("view",{class:"temlistText1"},e.toDisplayString(t.title),1),e.createElementVNode("view",{class:"boxlistText3"},[e.createElementVNode("text",{class:"boxlistText4"},"优秀")]),e.createElementVNode("view",{class:"temlistText2"},[e.createElementVNode("text",null,e.toDisplayString(t.teacher),1)])])))),128))])],64)}]]);__definePage("pages/index/index",R),__definePage("pages/login/login",Qr),__definePage("pages/login/ratpass",ec),__definePage("pages/login/register",tl),__definePage("pages/pagesall/home",Sl),__definePage("pages/pagesall/course",wl),__definePage("pages/pagesall/aiDete",Ll),__definePage("pages/pagesall/oper",Ol),__definePage("pages/pagesall/mypage",Ul),__definePage("pages/pagesall/home/signUp",Pl),__definePage("pages/pagesall/home/message",Qd),__definePage("pages/pagesall/home/search",Rp),__definePage("pages/pagesall/home/sacnpage",Ap),__definePage("pages/pagesall/home/mycode",Op),__definePage("pages/pagesall/home/adverMess",Up),__definePage("pages/pagesall/home/adver_detail",Pp),__definePage("pages/pagesall/home/add_friend",Gp),__definePage("pages/pagesall/home/game",Bp),__definePage("pages/pagesall/home/chat",Fp),__definePage("pages/pagesall/course/go_learn",Hp),__definePage("pages/pagesall/aiDete/aiResult",$p),__definePage("pages/pagesall/SelectCity",Yp),__definePage("pages/pagesall/mypage/PersonalData",Xp),__definePage("pages/pagesall/mypage/Set",Zp),__definePage("pages/pagesall/mypage/changePassword",Qp),__definePage("pages/pagesall/mypage/changePhone",eh),__definePage("pages/pagesall/mypage/complaint",th),__definePage("pages/pagesall/mypage/contactUs",nh),__definePage("pages/pagesall/mypage/aboutUs",oh),__definePage("pages/pagesall/mypage/classGroup",ih),__definePage("pages/pagesall/mypage/historyAssessment",rh),__definePage("pages/pagesall/mypage/AIhist",lh),__definePage("pages/pagesall/mypage/teacherHist",dh),__definePage("pages/pagesall/mypage/myHomework",ph),__definePage("pages/pagesall/mypage/individualmsg",gh),__definePage("pages/pagesall/mypage/correction",mh),__definePage("pages/pagesall/mypage/teachermsg",fh),__definePage("TUIKit/components/TUIConversation/index",Wd),__definePage("TUIKit/components/TUIChat/index",pm),__definePage("TUIKit/components/TUIContact/index",Lp),__definePage("pages/views/profile",hm),__definePage("TUIKit/components/TUIChat/video-play",gm),__definePage("TUIKit/components/TUIChat/web-view",mm),__definePage("TUIKit/components/TUIGroup/index",Om),__definePage("TUIKit/components/TUISearch/index",Ad),__definePage("pages/pagesall/home/informationDetails",Um),__definePage("pages/pagesall/home/informationDetailsmess",Pm),__definePage("pages/pagesall/mypage/myCourses",Gm);class xm{constructor(){Wr.registerEvent(Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED,Ar.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS,this),Wr.registerService(Ar.TUICalling.SERVICE.NAME,this),Wr.registerExtension(Ar.TUIChat.EXTENSION.INPUT_MORE.EXT_ID,this)}onNotifyEvent(e,t){if(e===Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED){let e,n,o,a;if(t===Ar.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS)a=Jr.getContext(),e=a.SDKAppID,n=a.userID,o=a.userSig,Fl.$TUICallKit&&Fl.$TUICallKit.login({SDKAppID:e,userID:n,userSig:o},(e=>{0===e.code?(I("log","at TUIKit/plugins/extension-server/callkit.ts:32","TUICallkit login success!"),Fl.$TUICallKit.enableFloatWindow(!0)):I("error","at TUIKit/plugins/extension-server/callkit.ts:36",`TUICallkit login failed,${e.msg}`)}))}}onGetExtension(e,t){if(!Fl.$TUICallKit)return I("warn","at TUIKit/plugins/extension-server/callkit.ts:49","请检查原生插件 TencentCloud-TUICallKit 是否已集成"),[];if(e===Ar.TUIChat.EXTENSION.INPUT_MORE.EXT_ID){const e=[],n={weight:1e3,text:"语音通话",icon:"https://web.sdk.qcloud.com/component/TUIKit/assets/call.png",data:{name:"voiceCall"},listener:{onClicked:e=>{this.setCallExtension(e)}}},o={weight:900,text:"视频通话",icon:"https://web.sdk.qcloud.com/component/TUIKit/assets/call-video-reverse.svg",data:{name:"videoCall"},listener:{onClicked:e=>{this.setCallExtension(e)}}};return(null==t?void 0:t.filterVoice)||e.push(n),(null==t?void 0:t.filterVideo)||e.push(o),e}}onCall(e,t){if(Fl.$TUICallKit){if(e===Ar.TUICalling.SERVICE.METHOD.START_CALL){const{groupID:e,userIDList:n=[],type:o,callParams:a}=t;e?Fl.$TUICallKit.groupCall({groupID:e,userIDList:n,callMediaType:o,callParams:a},(e=>{0===e.code?I("log","at TUIKit/plugins/extension-server/callkit.ts:108","TUICallkit groupCall success"):I("error","at TUIKit/plugins/extension-server/callkit.ts:110",`TUICallkit groupCall failed,${e.msg}`)})):1===n.length&&Fl.$TUICallKit.call({userID:n[0],callMediaType:o,callParams:a},(e=>{0===e.code?I("log","at TUIKit/plugins/extension-server/callkit.ts:122","TUICallkit call success"):I("log","at TUIKit/plugins/extension-server/callkit.ts:124",`TUICallkit call failed,${e.msg}`)}))}}else I("warn","at TUIKit/plugins/extension-server/callkit.ts:95","请检查原生插件 TencentCloud-TUICallKit 是否已集成")}setCallExtension(e){const{groupID:t,userIDList:n=[],type:o,callParams:a}=e;try{t?Fl.$TUICallKit.groupCall({groupID:t,userIDList:n,callMediaType:o,callParams:a},(e=>{0===e.code?I("log","at TUIKit/plugins/extension-server/callkit.ts:143","TUICallkit groupCall success"):I("log","at TUIKit/plugins/extension-server/callkit.ts:145",`TUICallkit groupCall failed,${e.msg}`)})):1===n.length&&Fl.$TUICallKit.call({userID:n[0],callMediaType:o,callParams:a},(e=>{0===e.code?I("log","at TUIKit/plugins/extension-server/callkit.ts:158","TUICallkit call success"):I("log","at TUIKit/plugins/extension-server/callkit.ts:160",`TUICallkit call failed,${e.msg}`)}))}catch(i){Fl.showToast({title:"拨打失败！",icon:"error"})}}}const Bm={...{en:{"取消":"Cancel","发送":"Send","系统通知":"System notification","关闭":"Close","确定":"Save","开始时间":"Start Date","结束时间":"End Date","消息":"Messages","通讯录":"Contacts","欢迎使用腾讯云即时通信IM":"Welcome to Tencent Cloud Chat",TUIChat:{"【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。":"【Security Tips】This APP is only used to experience the functions of Tencent Cloud Instant Messaging products, and cannot be used for business negotiation and expansion. Don't trust money-related information such as remittances and lottery wins, don't make unfamiliar phone calls easily, and beware of being deceived.","按Enter发送，Ctrl+Enter换行":"Press Enter to send a message and Ctrl+Enter to start a new line","表情":"[Face]","查看更多":"View more","撤回":"Recall","撤回了一条消息":" recalled a message","打开":"Open","单击下载":"Click download","点此投诉":"Complain","点击处理":"Click action","对方正在输入":"Typing...","发起群视频":"Make group video call","发起群语音":"Make group voice call","发起通话":"Start Call","发送失败":"send failed","复制":"Copy","该消息不存在":"The message does not exist","关闭阅读状态":"Read status closed","管理员开启全员禁言":"The admin enables Mute All","欢迎使用TUICallKit":"Welcome to TUICallKit","回到最新位置":"Back to the latest location","回复":"Reply","回复详情":"Replies","集成TUICallKit":" Integrate TUICallKit ","检测到您暂未集成TUICallKit，无法体验音视频通话功能":"It is detected that you have not integrated TUI CallKit yet, so you cannot experience the audio and video call. ","结束群聊":"Edit Group Call","进行体验":"to experience.","经度":"Longitude","拒绝":"Reject","拒绝通话":"Decline Call","开通腾讯实时音视频服务":"Integration Tencent Real-Time Communication","聊天记录":"[Chat history]","描述":"Description","内容包含敏感词汇":"Content contains sensitive words","您":"You","您当前购买使用的套餐包暂未开通此功能":"The package you purchased does not support this ability.","您当前购买使用的套餐包暂未开通群消息已读回执功能":"The package you purchased does not support the read receipt of group messages.","您当前购买使用的套餐包暂未开通在线用户列表功能":"The package you purchased does not support the online user list.","您已被管理员禁言":"You have been muted by the admin","您有":"You have","请点击":"Please click","请输入消息":"Enter a message","取消":"Cancel","取消通话":"Cancel Call","全部已读":"All read","确定":"Submit","确认重发该消息？":"Confirm to resend the message?","人关闭阅读状态":" read status closed","人未读":" unread","人已读":" read","删除":"Delete","涉及敏感内容":"Sensitive content","申请加入":"Application for join in","视频":"[video]","视频通话":"Video Call","条回复":"replies","条入群申请":"Item group application","条新消息":" new messages","通话时长":"Duration","同意":"Agree","图片":"[Image]","图片消息失败,无效的图片格式":"Image message failed, invalid image format.","纬度":"Latitude","未读":"Unread","位置":"[Location]","文件":"[File]","文件不存在,请检查文件路径是否正确":"The file does not exist, please check if the file path is correct.","文件大小超出了限制,如果上传文件,最大限制是100MB":"The file size exceeds the limit; if uploading a file, the maximum limit is 100MB.","文件消息失败,禁止发送违规封禁的文件":"File message failed, sending prohibited and banned files is not allowed.","我":"I","无法查看":"unable to view","无法定位到原消息":"Unable to navigate to the original message","无法收听":"unable to listen","正在加载":"Loading...","加载结束":"Load end","无应答":"No Answer","系统消息":"System message","消息":"[message]","消息或者资料中文本存在敏感内容,发送失败":"Sensitive content found in the message or information text, sending failed.","消息详情":"Message Detail","消息长度超出限制,消息长度不要超过12K":"Message length exceeds the limit; please keep the message length under 12K.","消息中图片存在敏感内容,发送失败":" Sensitive content is found in the picture in the message, sending failed.","选择提醒的人":"Select Contact","已读":"Read","已过撤回时限":"Withdrawal deadline has passed","已接听":"Answered","已拒绝":"Rejected","已同意":"Approved","引用":"Reference","引用失败":"quote failed","语音":"[Voice]","语音通话":"Voice Call","重新编辑":"Re-edit","重新发送":"Resend","转发":"Forward","翻译":"Translate","转文字":"Convert","隐藏":"Hidden","转发给":"Forward to","自定义":"[custom message]","自定义消息":"Custom message","腾讯云 IM":"Tencent Cloud Chat","空":"Empty","文本包含本地审核拦截词":"Text contains local moderation blocking words","按住说话":"Hold to speak","抬起发送":"Release to send","抬起取消":"Release to cancel","正在录音":"Recording","继续上滑可取消":"Continue to swipe to cancel","松开手指 取消发送":"Release to cancel","此机型暂不支持复制功能":"This model does not support the copy","请开通翻译功能":"Please open the translation feature","请开通语音转文字功能":"Please open the convert feature","翻译中":"Translating","转换中":"Converting","由IM提供翻译支持":"support by IM","所有人":"All","已达到表情回应上限数量":"You have reached the max reaction limit","等":"and others","人":"users","返回":"Back","关闭":"Close","多选":"Select","合并转发":"Combine Forward","逐条转发":"One-By-One Forward","未选择消息":"No message selected","[草稿]":"[Drafts]","[消息]":"[Message]","[文本]":"[Text]","[自定义消息]":"[Custom Message]","[图片]":"[Image]","[音频]":"[Voice]","[语音]":"[Voice]","[视频]":"[Video]","[文件]":"[File]","[位置]":"[Location]","[地理位置]":"[Location]","[动画表情]":"[Animated Sticker]","[群提示]":"[Group Tip]","[群提示消息]":"[Group Notification]","[聊天记录]":"[Chat History]","引用内容已撤回":"The quoted message has been withdrawn","群聊的聊天记录":"Chat history for Group Chat","和":"and","的聊天记录":"chat history","请升级IMSDK到v2.10.1或更高版本查看此消息":"Please upgrade IMSDK to v2.10.1 or higher to view this message","该群聊已被解散":"The group has been dismissed","您已被管理员移出群聊":"You have been removed from the group by the admin.","您已退出该群聊":"You have left the group."},TUIConversation:{"发起会话":"Start chat","发起单聊":"New one-to-one chat","发起群聊":"New group chat","请输入userID":"Enter a user ID","删除会话":"Delete","删除后，将清空该聊天的消息记录":"Once deleted, all chat messages will be cleared.","删除后，将清空该群聊的消息记录":"Once deleted, group chat history will be cleared.","系统通知":"System notification","置顶会话":"Pin","取消置顶":"Unpin","消息免打扰":"Mute Notifications","取消免打扰":"Enable Notifications","有人@我":"Someone @ me","@所有人":"@All","条":"strip","我":"me","网络异常，请您检查网络设置":"Network exception, please check the network settings","您已被群管理员移出群聊":"You have been removed from the group chat by the group administrator","该群聊已被解散":"The group chat has been disband","您已退出该群聊":"You have left the group chat"},TUIGroup:{"输入groupID搜索":"Enter groupId search","群名称":"Group name","群ID":"Group ID","加入群聊":"Join","解散群聊":"Dissolution","退出群聊":"Quit","群类型":"Group type","请填写验证信息":"Please fill in the verification information","申请加入":"Apply Join","群公告":"Group notice","群成员":"Group member","群管理":"Manage group","好友工作群":"Work","陌生人社交群":"Public","临时会议群":"Meeting","直播群":"AVChatRoom","社群":"Community","自由加入":"Join freely","需要验证":"Require approval","禁止加群":"Disallow group joining","人":"","确认":"Confirm","群头像":"Group profile photo","加群方式":"Group joining mode","转让群组":"Transfer ownership","退出群组":"Quit group","群管理员":"Group admin","全员禁言":"Mute All","全员禁言开启后，只允许群主和管理员发言。":"If Mute All is enabled, only the group owner and admin can speak.","单独禁言人员":"Mute a member","删除成员":"Remove member","确定从群聊中删除该成员？":"Are you sure you want to remove this member from the group chat?","确定从群聊中删除所选成员？":"Are you sure you want to remove selected member(s) from the group chat?","暂无公告":"No notice","发布":"Post","编辑":"Edit","查看更多":"View more","管理员":"Admin","群主":"Group owner","我":"me","添加成员":"Add member","新增管理员":"Add admin","移除管理员":"Revoke admin","新增禁言用户":"Add muted member","移除禁言用户":"Remove muted member","修改群聊名称":"Edit group name","修改群聊名称后，将在群内通知其他成员":"After modifying the group chat name, other members will be notified in the group","仅限中文、字母、数字和下划线，2-20个字":"Chinese, letters, numbers and underscores only, 2-20 words","请先注册 TUIGroup 模块":"Please register the TUIGroup module first","该用户不存在":"The user does not exist","该用户不在群组内":"The user is not in the group","添加群聊":"Add a group chat","该群组不存在":"The group does not exist","创建群聊，请注册 TUIGroup 模块":"To create a group chat, please register the TUIGroup module","创建成功":"Creation successful","发起多人会话（群聊）":"New group chat","选填":"Optional","取消":"Cancel","创建":"Create","类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主审批。详见":"Similar to a WeChat group. Users can join the group only via invitation by existing members. The invitation does not need to be agreed by the invitee or approved by the group owner. See the documentation for details.","类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见":"Similar to a QQ group. After a public group is created, the group owner can designate group admins. To join the group, a user needs to search the group ID and send a request, which needs to be approved by the group owner or an admin before the user can join the group. See the documentation for details. ","创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见":"After the group is created, a user can join and quit the group freely and can view the messages sent before joining the group. It is suitable for scenarios that integrate Tencent Real-Time Communication (TRTC), such as audio and video conferences and online education. See the documentation for details.","创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见":"After creation, a user can join and quit the group freely. The group can have an unlimited number of members, but it does not store message history. It can be combined with Live Video Broadcasting (LVB) to support on-screen comment scenarios. See the documentation for details. ","创建后可以随意进出，最多支持100000人，支持历史消息存储，用户搜索群 ID 发起加群申请后，无需管理员审批即可进群。详见":"After creation, you can enter and leave at will, support up to 100,000 people, support historical message storage, and after users search for group ID and initiate a group application, they can join the group without administrator approval. See product documentation for details. ","产品文档":"product documentation","设置群名称":"Group name","请输入群名称":"Enter the group name","设置群ID":"Group ID","请输入群ID":"Enter the group ID","选择群类型":"Group type","陌生人社交群（Public）":"Stranger social group (Public)","临时会议群（Meeting）":"Temporary meeting group (Meeting)","好友工作群（Work）":"Friends work group (Work)","直播群（AVChatroom）":"Live Streaming Group (AVChatroom)","社群（Community）":"Community（Community）","群组创建成功":"Create group success","群组解散成功":"Dismiss group success","禁言设置成功":"Mute all success","取消禁言成功":"Remove mute success","群名称不能为空":"Group name cannot be empty","群名称修改成功":"Group name modified success","群公告字数超出限制，最大长度为150":"The number of characters in the group announcement exceeds the limit, the maximum length is 150"},TUIContact:{"群聊通知":"Group Chat Notifications","系统通知":"System Notifications","我的群聊":"My Group Chats","输入ID":"Enter a groupID/userID","群名称":"Group name","群ID":"Group ID","加入群聊":"Join group chat","解散群聊":"Disband group chat","退出群聊":"Quit group chat","进入群聊":"Enter group chat","群类型":"Group type","请填写验证信息":"Enter the verification info","申请加入":"Request to join","已申请":"Requested","接受":"Accept","拒绝":"Refuse","已处理":"Handled","添加群聊":"add group chat","已加入":"joined","该群组不存在":"The group does not exist","加群":"join","我的好友":"Friend","发送消息":"Send Message","个性签名":"Signature","等待管理员同意":"Successful application, waiting for the administrator to agree to join the group application","加群成功":"Join the group successfully","您已是群成员":"You are already a group member","新的联系人":"New Contacts","黑名单":"Blocked List","无搜索结果":"No Result","客服号":"Customer Service List",ID:"ID","联系人":"User","群聊":"Group","添加好友/群聊":"Add friend/group","备注名":"remark","加入黑名单":"block","删除好友":"Delete friend","等待验证":"waiting for verification","验证信息":"verification info","发送申请":"Send application","加入直播群":"Join AVChatRoom","同意":"Agree","删除好友成功":"Delete friend success","删除好友失败":"Delete friend failed","申请已发送":"Application has been sent","申请发送失败":"Application failed to send","进入会话失败":"Failed to enter session","添加好友成功":"Add friend success","同意好友申请失败":"Failed to agree to friend request","拒绝成功":"Reject friend request success","拒绝好友申请失败":"Failed to reject friend request","解散群聊成功":"Dismissed group success","解散群聊失败":"Dismissed group failed","退出群组成功":"Quit group success","退出群组失败":"Quit group failed","申请入群失败":"Application to join the group failed","加入黑名单失败":"Add to blocklist failed","移除黑名单失败":"Remove from blocklist failed","修改备注失败: 备注长度不得超过 96 字节":"Failed to modify the remark: the length of the remark cannot exceed 96 bytes","修改备注成功":"Remark modified success","修改备注失败":"Remark modified failed"},message:{tip:{"群成员":"group members","加入群组":"joined the group","退出群组":"left the group","被":"by","踢出群组":"was kicked out of the group","成为管理员":"was set as an admin","被撤销管理员":"was revoked","被禁言":" was muted","被取消禁言":"cancel the prohibition","群提示消息":"group prompt message","管理员":"The admin","开启全员禁言":"enabled Mute All","取消全员禁言":"disabled Mute All","成为新的群主":"became the new group owner","修改群名为":"changed the group name to","发布新公告":"posted a new notice","把群公告修改为":"changed the group notice to","申请加入群组":"requested to join the group","成功加入群组":"Successfully joined the group","被拒绝":"The request to join the group was refused","你被管理员":"You","群":"group","解散":"disbanded","创建群":"created the group","邀请你加群":"invite you to join the group","你退出群组":"You left the group","你被":"You were","设置为群":"set as group","的管理员":"as an admin","撤销群":"revoked","的管理员身份":"admin role of the group","同意加群":"agreed to join the group","拒接加群":"refused to join the group","自定义群系统通知":"Custom group system notification"},custom:{"自定义消息":"Custom message","通话时长":"Call duration","通话结束":"Call End","切换语音通话":"Switch voice call","切换视频通话":"Switch video call","发起通话":"Start a call","取消通话":"Cancel","已接听":"Answered","拒绝通话":"Decline","无应答":"No answer","已取消":"Canceled","对方已取消":"Call canceled by caller","已拒绝":"Declined","对方已拒绝":"Call declined by user","对方忙线中":"Line busy","忙线未接听":"\tLine busy. Call not received.","对方无应答":"Call wasn't answered","超时无应答":"Call not answered","对本次服务评价":"Rate this service","查看详情>>":"View details >>"}},component:{"取消":"Cancel","完成":"Done","已选中":"Selected","人":"","保存":"Save","请输入userID":"Enter a userID","请输入groupID":"Enter a groupID","确定":"submit","全选":"All","已在群聊中":"exists","查看更多":"More","图片 url 不存在":"Image url does not exist","已取消":"Cancelled","获取权限失败":"Failed to obtain permission","已保存至相册":"Saved to album","图片下载失败":"Image download failed","暂不支持下载此类型图片":"Downloading this type of pictures is not supported yet"},time:{"周":"week(s) ","天":"day(s)","小时":"hour(s) ","分钟":"minute(s)","刚刚":"Just now","前":" ago","昨天":"Yesterday","星期一":"Monday","星期二":"Tuesday","星期三":"Wednesday","星期四":"Thursday","星期五":"Friday","星期六":"Saturday","星期日":"Sunday","一月":"January","二月":"February","三月":"March","四月":"April","五月":"May","六月":"June","七月":"July","八月":"August","九月":"September","十月":"October","十一月":"November","十二月":"December","一":"Mon","二":"Tues","三":"Wed","四":"Thur","五":"Fri","六":"Sat","日":"Sun"},Evaluate:{"请对本次服务进行评价":"Please rate this service","提交评价":"Feedback","服务评价工具":"Service rate tool","使用":"Build with","自定义消息":"Custom message","搭建":"","星":"Star"},Words:{"请对本次服务进行评价":"Please rate this service","提交评价":"Feedback","常用语-快捷回复工具":"Common Expressions - Quick Reply Tool","使用":"Build with","自定义消息":"Custom message","搭建":"","在吗？在吗？在吗？重要的话说三遍。":"Are you there? ","好久没聊天了，快来和我说说话～":"It’s been a long time. How about you?","好的，就这么说定了。":"Okay. It's a deal.","感恩的心，感谢有你。":"So grateful! ","糟糕！是心动的感觉！":"Oh, no. Flipped.","心疼地抱抱自己，我太难了！":"Give myself a warm hug. ","没关系，别在意，事情过去就过去了。":"Take it easy.","早上好，今天也是让人期待的一天呢！":"Good morning. Have a wonderful day.","熬夜有什么用，又没人陪你聊天，早点休息吧。":"It's better to go to bed early."},TUISearch:{"搜索":"Search","全部":"All","联系人":"Contacts","群聊":"Groups","聊天记录":"Chat History","文本":"Text","文件":"File","其他":"Other","图片/视频":"Image/Video","选择时间":"Select time","今天":"Today","近三天":"Nearly three days","近七天":"Nearly seven days","查看更多":"View more ","条相关":" related ","条与":" related to ","相关的":"keywords","进入聊天":"enter","定位到聊天位置":"Navigate to the chat position","搜索会话内容":"Search in conversation","查看更多历史记录":"View more history message","暂无搜索结果":"No Results","结果":"results","取消":"Cancel","[文本]":"[Text Message]","[图片]":"[Image Message]","[语音]":"[Audio Message]","[视频]":"[Video Message]","[文件]":"[File Message]","[自定义消息]":"[Custom Message]","[系统消息]":"[System Message]","[合并消息]":"[Merged Message]","[位置消息]":"[Position Message]","消息云端搜索失败：":"Message cloud search failed: ","查找联系人失败：":"Failed to find contact: ","查找群聊失败：":"Failed to find group: ","进入会话失败":"Failed to enter conversation"},Emoji:Fu}},...{zh_cn:{"取消":"取消","发送":"发送","系统通知":"系统通知","关闭":"关闭","确定":"确定","开始时间":"开始时间","结束时间":"结束时间","消息":"消息","通讯录":"通讯录","欢迎使用腾讯云即时通信IM":"欢迎使用腾讯云即时通信IM",TUIChat:{"【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。":"【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。","按Enter发送，Ctrl+Enter换行":"按Enter发送，Ctrl+Enter换行","表情":"[表情]","查看更多":"查看更多","撤回":"撤回","撤回了一条消息":"撤回了一条消息","打开":"打开","单击下载":"单击下载","点此投诉":"点此投诉","点击处理":"点击处理","对方正在输入":"对方正在输入...","发起群视频":"发起群视频","发起群语音":"发起群语音","发起通话":"发起通话","发送失败":"发送失败","复制":"复制","该消息不存在":"该消息不存在","关闭阅读状态":"关闭","管理员开启全员禁言":"管理员开启全员禁言","欢迎使用TUICallKit":"欢迎使用腾讯云音视频通话组件TUICallKit ","回到最新位置":"回到最新位置","回复":"回复","回复详情":"回复详情","集成TUICallKit":"集成 TUICallKit ","检测到您暂未集成TUICallKit，无法体验音视频通话功能":"检测到您暂未集成TUICallKit，无法体验音视频通话功能。","结束群聊":"结束群聊","进行体验":"进行体验。","经度":"经度","拒绝":"拒绝","拒绝通话":"拒绝通话","开通腾讯实时音视频服务":"开通腾讯实时音视频服务","聊天记录":"[聊天记录]","描述":"描述","内容包含敏感词汇":"内容包含敏感词汇","您":"您","您当前购买使用的套餐包暂未开通此功能":"您当前购买使用的套餐包暂未开通此功能。","您当前购买使用的套餐包暂未开通群消息已读回执功能":"您当前购买使用的套餐包暂未开通【群消息已读回执】功能，请升级至旗舰版进行体验","您当前购买使用的套餐包暂未开通在线用户列表功能":"您当前购买使用的套餐包暂未开通【在线用户列表】功能，请升级至旗舰版进行体验","您已被管理员禁言":"您已被管理员禁言","您有":"您有","请点击":"请点击","请输入消息":"请输入消息","取消":"取消","取消通话":"取消通话","全部已读":"全部已读","确定":"确定","确认重发该消息？":"确认重发该消息？","人关闭阅读状态":"人关闭阅读状态","人未读":"人未读","人已读":"人已读","删除":"删除","涉及敏感内容":"涉及敏感内容","申请加入":"申请加入","视频":"[视频]","视频通话":"视频通话","条回复":"条回复","条入群申请":"条入群申请","条新消息":"条新消息","通话时长":"通话时长","同意":"同意","图片":"[图片]","图片消息失败,无效的图片格式":"图片消息失败,无效的图片格式","纬度":"纬度","未读":"未读","位置":"[位置]","文件":"[文件]","文件不存在,请检查文件路径是否正确":"文件不存在,请检查文件路径是否正确","文件大小超出了限制,如果上传文件,最大限制是100MB":"文件大小超出了限制,如果上传文件,最大限制是100MB","文件消息失败,禁止发送违规封禁的文件":"文件消息失败,禁止发送违规封禁的文件","我":"我","无法查看":"无法查看","无法定位到原消息":"无法定位到原消息","无法收听":"无法收听","正在加载":"正在加载...","加载结束":"加载结束","无应答":"无应答","系统消息":"系统消息","消息":"message","消息或者资料中文本存在敏感内容,发送失败":"消息或者资料中文本存在敏感内容,发送失败","消息详情":"消息详情","消息长度超出限制,消息长度不要超过12K":"消息长度超出限制,消息长度不要超过12K","消息中图片存在敏感内容,发送失败":"消息中图片存在敏感内容,发送失败","选择提醒的人":"选择提醒的人","已读":"已读","已过撤回时限":"已过撤回时限","已接听":"已接听","已拒绝":"已拒绝","已同意":"已同意","引用":"引用","引用失败":"引用失败","语音":"[语音]","语音通话":"语音通话","重新编辑":"重新编辑","重新发送":"重新发送","转发":"转发","翻译":"翻译","转文字":"转文字","隐藏":"隐藏","转发给":"转发给","自定义":"[自定义消息]","自定义消息":"自定义消息","腾讯云 IM":"腾讯云 IM","空":"空","文本包含本地审核拦截词":"文本包含本地审核拦截词","按住说话":"按住说话","抬起发送":"抬起发送","抬起取消":"抬起取消","正在录音":"正在录音","继续上滑可取消":"继续上滑可取消","松开手指 取消发送":"松开手指 取消发送","此机型暂不支持复制功能":"此机型暂不支持复制功能","请开通翻译功能":"请开通翻译功能","请开通语音转文字功能":"请开通语音转文字功能","翻译中":"翻译中","转换中":"转换中","由IM提供翻译支持":"由IM提供翻译支持","所有人":"所有人","已达到表情回应上限数量":"已达到表情回应上限数量","等":"等","人":"人","返回":"返回","关闭":"关闭","多选":"多选","合并转发":"合并转发","逐条转发":"逐条转发","未选择消息":"未选择消息","引用内容已撤回":"引用内容已撤回","[草稿]":"[草稿]","[消息]":"[消息]","[文本]":"[文本]","[自定义消息]":"[自定义消息]","[图片]":"[图片]","[音频]":"[音频]","[语音]":"[语音]","[视频]":"[视频]","[文件]":"[文件]","[位置]":"[地理位置]","[地理位置]":"[地理位置]","[动画表情]":"[动画表情]","[群提示]":"[群提示]","[群提示消息]":"[群提示消息]","[聊天记录]":"[聊天记录]","群聊的聊天记录":"群聊的聊天记录","和":"和","的聊天记录":"的聊天记录","请升级IMSDK到v2.10.1或更高版本查看此消息":"请升级IMSDK到v2.10.1或更高版本查看此消息","您已被管理员移出群聊":"您已被管理员移出群聊","该群聊已被解散":"该群聊已被解散","您已退出该群聊":"您已退出该群聊"},TUIConversation:{"发起会话":"发起会话","发起单聊":"发起单聊","发起群聊":"发起群聊","请输入userID":"请输入userID","删除会话":"删除会话","删除后，将清空该聊天的消息记录":"删除后，将清空该聊天的消息记录","删除后，将清空该群聊的消息记录":"删除后，将清空该群聊的消息记录","置顶会话":"置顶会话","取消置顶":"取消置顶","消息免打扰":"消息免打扰","取消免打扰":"取消免打扰","系统通知":"系统通知","有人@我":"有人@我","@所有人":"@所有人","条":"条","我":"我","网络异常，请您检查网络设置":"网络异常，请您检查网络设置","您已被群管理员移出群聊":"您已被群管理员移出群聊","该群聊已被解散":"该群聊已被解散","您已退出该群聊":"您已退出该群聊"},TUIGroup:{"输入groupID搜索":"输入groupID搜索","群名称":"群名称","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","群类型":"群类型","请填写验证信息":"请填写验证信息","申请加入":"申请加入","已申请":"已申请","群公告":"群公告","群成员":"群成员","群管理":"群管理","好友工作群":"好友工作群","陌生人社交群":"陌生人社交群","临时会议群":"临时会议群","直播群":"直播群","社群":"社群","自由加入":"自由加入","需要验证":"需要验证","禁止加群":"禁止加群","人":"人","群头像":"群头像","加群方式":"加群方式","转让群组":"转让群组","退出群组":"退出群组","群管理员":"群管理员","全员禁言":"全员禁言","全员禁言开启后，只允许群主和管理员发言。":"全员禁言开启后，只允许群主和管理员发言。","单独禁言人员":"单独禁言人员","删除成员":"删除成员","确定从群聊中删除该成员？":"确定从群聊中删除该成员？","确定从群聊中删除所选成员？":"确定从群聊中删除所选成员？","暂无公告":"暂无公告","发布":"发布","编辑":"编辑","查看更多":"查看更多","管理员":"管理员","群主":"群主","我":"我","确认":"确认","添加成员":"添加成员","新增管理员":"新增管理员","移除管理员":"移除管理员","新增禁言用户":"新增禁言用户","移除禁言用户":"移除禁言用户","修改群聊名称":"修改群聊名称","修改群聊名称后，将在群内通知其他成员":"修改群聊名称后，将在群内通知其他成员","仅限中文、字母、数字和下划线，2-20个字":"仅限中文、字母、数字和下划线，2-20个字","请先注册 TUIGroup 模块":"请先注册 TUIGroup 模块","该用户不存在":"该用户不存在","该用户不在群组内":"该用户不在群组内","添加群聊":"添加群聊","该群组不存在":"该群组不存在","创建群聊，请注册 TUIGroup 模块":"创建群聊，请注册 TUIGroup 模块","创建成功":"创建成功","发起多人会话（群聊）":"发起多人会话（群聊）","选填":"选填","取消":"取消","创建":"创建","类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主审批。详见":"类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主审批。详见","类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见":"类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见","创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见":"创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见","创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见":"创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见","创建后可以随意进出，最多支持100000人，支持历史消息存储，用户搜索群 ID 发起加群申请后，无需管理员审批即可进群。详见":"创建后可以随意进出，最多支持100000人，支持历史消息存储，用户搜索群 ID 发起加群申请后，无需管理员审批即可进群。详见","产品文档":"产品文档","设置群名称":"设置群名称","请输入群名称":"请输入群名称","设置群ID":"设置群ID","请输入群ID":"请输入群ID","选择群类型":"选择群类型","陌生人社交群（Public）":"陌生人社交群（Public）","临时会议群（Meeting）":"临时会议群（Meeting）","好友工作群（Work）":"好友工作群（Work）","直播群（AVChatroom）":"直播群（AVChatroom）","社群（Community）":"社群（Community）","群组创建成功":"群组创建成功","群组解散成功":"群组解散成功","禁言设置成功":"禁言设置成功","取消禁言成功":"取消禁言成功","群名称不能为空":"群名称不能为空","群名称修改成功":"群名称修改成功","群公告字数超出限制，最大长度为150":"群公告字数超出限制，最大长度为150"},TUIContact:{"群聊通知":"群聊通知","系统通知":"系统通知","我的群聊":"我的群聊","输入ID":"请输入用户/群聊 ID，回车搜索","群名称":"群名称","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","进入群聊":"进入群聊","群类型":"群类型","请填写验证信息":"请填写验证信息","申请加入":"申请加入","已申请":"已申请","接受":"接受","拒绝":"拒绝","已处理":"已处理","添加群聊":"添加群聊","已加入":"已加入","该群组不存在":"该群组不存在","加群":"加群","我的好友":"我的好友","发送消息":"发送消息","个性签名":"个性签名","等待管理员同意":"申请成功，等待管理员同意入群申请","加群成功":"加群成功","您已是群成员":"您已是群成员","新的联系人":"新的联系人","黑名单":"黑名单","无搜索结果":"无搜索结果","客服号":"客服号",ID:"ID","联系人":"联系人","群聊":"群聊","添加好友/群聊":"添加好友/群聊","备注名":"备注名","加入黑名单":"加入黑名单","删除好友":"删除好友","等待验证":"等待验证","验证信息":"验证信息","发送申请":"发送申请","加入直播群":"加入直播群","同意":"同意","删除好友成功":"删除好友成功","删除好友失败":"删除好友失败","申请已发送":"申请已发送","申请发送失败":"申请发送失败","进入会话失败":"进入会话失败","添加好友成功":"添加好友成功","同意好友申请失败":"同意好友申请失败","拒绝成功":"拒绝成功","拒绝好友申请失败":"拒绝好友申请失败","解散群聊成功":"解散群聊成功","解散群聊失败":"解散群聊失败","退出群组成功":"退出群组成功","退出群组失败":"退出群组失败","申请入群失败":"申请入群失败","加入黑名单失败":"加入黑名单失败","移除黑名单失败":"移除黑名单失败","修改备注失败: 备注长度不得超过 96 字节":"修改备注失败: 备注长度不得超过 96 字节","修改备注成功":"修改备注成功","修改备注失败":"修改备注失败"},message:{tip:{"群成员":"群成员","加入群组":"加入群组","退出群组":"退出群组","被":"被","踢出群组":"踢出群组","成为管理员":"成为管理员","被撤销管理员":"被撤销管理员","被禁言":"被禁言","被取消禁言":"被取消禁言","群提示消息":"群提示消息","管理员":"管理员","开启全员禁言":"开启全员禁言","取消全员禁言":"取消全员禁言","成为新的群主":"成为新的群主","修改群名为":"修改群名为","发布新公告":"发布新公告","把群公告修改为":"把群公告修改为","申请加入群组":"申请加入群组","成功加入群组":"成功加入群组","被拒绝":"被拒绝","你被管理员":"你被管理员","群":"群","解散":"解散","创建群":"创建群","邀请你加群":"邀请你加群","你退出群组":"你退出群组","你被":"你被","设置为群":"设置为群","的管理员":"的管理员","撤销群":"撤销群","的管理员身份":"的管理员身份","同意加群":"同意加群","拒接加群":"拒接加群","自定义群系统通知":"自定义群系统通知"},custom:{"自定义消息":"自定义消息","通话时长":"通话时长","通话结束":"通话结束","切换语音通话":"切换语音通话","切换视频通话":"切换视频通话","发起通话":"发起通话","取消通话":"取消通话","已接听":"已接听","拒绝通话":"拒绝通话","无应答":"无应答","对本次服务评价":"对本次服务评价","查看详情>>":"查看详情>>","已取消":"已取消","对方已取消":"对方已取消","已拒绝":"已拒绝","对方已拒绝":"对方已拒绝","对方忙线中":"对方忙线中","忙线未接听":"忙线未接听","对方无应答":"对方无应答","超时无应答":"超时无应答"}},component:{"取消":"取消","完成":"完成","已选中":"已选中","人":"人","保存":"保存","请输入userID":"请输入userID","请输入groupID":"请输入groupID","确定":"确定","全选":"全选","已在群聊中":"已在群聊中","查看更多":"查看更多","图片 url 不存在":"图片 url 不存在","已取消":"已取消","获取权限失败":"获取权限失败","已保存至相册":"已保存至相册","图片下载失败":"图片下载失败","暂不支持下载此类型图片":"暂不支持下载此类型图片"},time:{"周":"周","天":"天","小时":"小时","分钟":"分钟","刚刚":"刚刚","前":"前","昨天":"昨天","星期一":"星期一","星期二":"星期二","星期三":"星期三","星期四":"星期四","星期五":"星期五","星期六":"星期六","星期日":"星期日","一月":"一月","二月":"二月","三月":"三月","四月":"四月","五月":"五月","六月":"六月","七月":"七月","八月":"八月","九月":"九月","十月":"十月","十一月":"十一月","十二月":"十二月","一":"一","二":"二","三":"三","四":"四","五":"五","六":"六","日":"日"},Evaluate:{"请对本次服务进行评价":"请对本次服务进行评价","提交评价":"提交评价","服务评价工具":"服务评价工具","使用":"使用","自定义消息":"自定义消息","搭建":"搭建","星":"星"},Words:{"常用语-快捷回复工具":"常用语-快捷回复工具","在吗？在吗？在吗？重要的话说三遍。":"在吗？在吗？在吗？重要的话说三遍。","好久没聊天了，快来和我说说话～":"好久没聊天了，快来和我说说话～","好的，就这么说定了。":"好的，就这么说定了。","感恩的心，感谢有你。":"感恩的心，感谢有你。","糟糕！是心动的感觉！":"糟糕！是心动的感觉！","心疼地抱抱自己，我太难了！":"心疼地抱抱自己，我太难了！","没关系，别在意，事情过去就过去了。":"没关系，别在意，事情过去就过去了。","早上好，今天也是让人期待的一天呢！":"早上好，今天也是让人期待的一天呢！","熬夜有什么用，又没人陪你聊天，早点休息吧。":"熬夜有什么用，又没人陪你聊天，早点休息吧。"},TUISearch:{"搜索":"搜索","全部":"全部","联系人":"联系人","群聊":"群聊","聊天记录":"聊天记录","文本":"文本","文件":"文件","图片/视频":"图片/视频","其他":"其他","选择时间":"选择时间","今天":"今天","近三天":"近三天","近七天":"近七天","查看更多":"查看更多","条相关":"条相关","条与":"条与","相关的":"相关的","进入聊天":"进入聊天","定位到聊天位置":"定位到聊天位置","搜索会话内容":"搜索会话内容","查看更多历史记录":"查看更多历史记录","暂无搜索结果":"暂无搜索结果","结果":"结果","取消":"取消","[文本]":"[文本]","[图片]":"[图片]","[语音]":"[语音]","[视频]":"[视频]","[文件]":"[文件]","[自定义消息]":"[自定义消息]","[系统消息]":"[系统消息]","[合并消息]":"[合并消息]","[位置消息]":"[位置消息]","消息云端搜索失败：":"消息云端搜索失败：","查找联系人失败：":"查找联系人失败：","查找群聊失败：":"查找群聊失败：","进入会话失败":"进入会话失败"},Emoji:Vu}},...{zh_tw:{"取消":"取消","发送":"發送","系统通知":"系統通知","关闭":"關閉","确定":"確定","开始时间":"開始時間","结束时间":"結束時間","消息":"消息","通讯录":"通訊錄","欢迎使用腾讯云即时通信IM":"歡迎使用騰訊雲即時通信IM",TUIChat:{"【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。":"【安全提示】本 APP 僅用於體驗騰訊雲即時通信 IM 產品功能，不可用於業務洽談與拓展。請勿輕信匯款、中奖等涉及錢款的信息，勿輕易撥打陌生電話，謹防上當受騙。","按Enter发送，Ctrl+Enter换行":"按Enter發送，Ctrl+Enter換行","表情":"[表情]","查看更多":"查看更多","撤回":"撤回","撤回了一条消息":"撤回了一條消息","打开":"打開","单击下载":"單擊下載","点此投诉":"點此投訴","点击处理":"點擊處理","对方正在输入":"對方正在輸入...","发起群视频":"發起群視頻","发起群语音":"發起群語音","发起通话":"發起通話","发送失败":"發送失敗","复制":"複製","该消息不存在":"該消息不存在","关闭阅读状态":"關閉","管理员开启全员禁言":"管理員開啟全員禁言","欢迎使用TUICallKit":"歡迎使用騰訊雲音視頻通話組件TUICallKit","回到最新位置":"回到最新位置","回复":"回覆","回复详情":"回覆詳情","集成TUICallKit":"集成 TUICallKit","检测到您暂未集成TUICallKit，无法体验音视频通话功能":"檢測到您暫未集成TUICallKit，無法體驗音視頻通話功能。","结束群聊":"結束群聊","进行体验":"進行體驗。","经度":"經度","拒绝":"拒絕","拒绝通话":"拒絕通話","开通腾讯实时音视频服务":"開通騰訊實時音視頻服務","聊天记录":"[聊天記錄]","描述":"描述","内容包含敏感词汇":"內容包含敏感詞彙","您":"您","您当前购买使用的套餐包暂未开通此功能":"您當前購買使用的套餐包暫未開通此功能。","您当前购买使用的套餐包暂未开通群消息已读回执功能":"您當前購買使用的套餐包暫未開通【群消息已讀回執】功能，請升級至旗艦版進行體驗","您当前购买使用的套餐包暂未开通在线用户列表功能":"您當前購買使用的套餐包暫未開通【在線用戶列表】功能，請升級至旗艦版進行體驗","您已被管理员禁言":"您已被管理員禁言","您有":"您有","请点击":"請點擊","请输入消息":"請輸入消息","取消":"取消","取消通话":"取消通話","全部已读":"全部已讀","确定":"確定","确认重发该消息？":"確認重發該消息？","人关闭阅读状态":"人關閉閱讀狀態","人未读":"人未讀","人已读":"人已讀","删除":"刪除","涉及敏感内容":"涉及敏感內容","申请加入":"申請加入","视频":"[視頻]","视频通话":"視頻通話","条回复":"條回覆","条入群申请":"條入群申請","条新消息":"條新消息","通话时长":"通話時長","同意":"同意","图片":"[圖片]","图片消息失败,无效的图片格式":"圖片消息失敗,無效的圖片格式","纬度":"緯度","未读":"未讀","位置":"[位置]","文件":"[文件]","文件不存在,请检查文件路径是否正确":"文件不存在,請檢查文件路徑是否正確","文件大小超出了限制,如果上传文件,最大限制是100MB":"文件大小超出了限制,如果上傳文件,最大限制是100MB","文件消息失败,禁止发送违规封禁的文件":"文件消息失敗,禁止發送違規封禁的文件","我":"我","无法查看":"無法查看","无法定位到原消息":"無法定位到原消息","无法收听":"無法收聽","正在加载":"正在加載...","加载结束":"加載結束","无应答":"無應答","系统消息":"系統消息","消息":"message","消息或者资料中文本存在敏感内容,发送失败":"消息或者資料中文本存在敏感內容,發送失敗","消息详情":"消息詳情","消息长度超出限制,消息长度不要超过12K":"消息長度超出限制,消息長度不要超過12K","消息中图片存在敏感内容,发送失败":"消息中圖片存在敏感內容,發送失敗","选择提醒的人":"選擇提醒的人","已读":"已讀","已过撤回时限":"已過撤回時限","已接听":"已接聽","已拒绝":"已拒絕","已同意":"已同意","引用":"引用","引用失败":"引用失敗","语音":"[語音]","语音通话":"語音通話","重新编辑":"重新編輯","重新发送":"重新發送","转发":"轉發","翻译":"翻譯","转文字":"轉文字","隐藏":"隱藏","转发给":"轉發給","自定义":"[自定義消息]","自定义消息":"自定義消息","腾讯云 IM":"騰訊雲 IM","空":"空","文本包含本地审核拦截词":"文本包含本地審核攔截詞","按住说话":"按住說話","抬起发送":"抬起發送","抬起取消":"抬起取消","正在录音":"正在錄音","继续上滑可取消":"繼續上滑可取消","松开手指 取消发送":"松開手指 取消發送","此机型暂不支持复制功能":"此機型暫不支持複製功能","请开通翻译功能":"請開通翻譯功能","请开通语音转文字功能":"請開通語音轉文字功能","翻译中":"翻譯中","转换中":"轉換中","由IM提供翻译支持":"由IM提供翻譯支持","所有人":"所有人","已达到表情回应上限数量":"已達到表情回應上限數量","等":"等","人":"人","返回":"返回","关闭":"關閉","多选":"多選","合并转发":"合併轉發","逐条转发":"逐條轉發","未选择消息":"未選擇消息","引用内容已撤回":"引用內容已撤回","[草稿]":"[草稿]","[消息]":"[消息]","[文本]":"[文本]","[自定义消息]":"[自定義消息]","[图片]":"[圖片]","[音频]":"[音頻]","[语音]":"[語音]","[视频]":"[視頻]","[文件]":"[文件]","[位置]":"[地理位置]","[地理位置]":"[地理位置]","[动画表情]":"[動畫表情]","[群提示]":"[群提示]","[群提示消息]":"[群提示消息]","[聊天记录]":"[聊天記錄]","群聊的聊天记录":"群聊的聊天記錄","和":"和","的聊天记录":"的聊天記錄","请升级IMSDK到v2.10.1或更高版本查看此消息":"請升級IMSDK到v2.10.1或更高版本查看此消息","您已被管理员移出群聊":"您已被管理員移出群聊","该群聊已被解散":"該群聊已被解散","您已退出该群聊":"您已退出該群聊"},TUIConversation:{"发起会话":"發起會話","发起单聊":"發起單聊","发起群聊":"發起群聊","请输入userID":"請輸入userID","删除会话":"刪除會話","删除后，将清空该聊天的消息记录":"刪除後，將清空該聊天的消息記錄","删除后，将清空该群聊的消息记录":"刪除後，將清空該群聊的消息記錄","置顶会话":"置頂會話","取消置顶":"取消置頂","消息免打扰":"消息免打擾","取消免打扰":"取消免打擾","系统通知":"系統通知","有人@我":"有人@我","@所有人":"@所有人","条":"條","我":"我","网络异常，请您检查网络设置":"網絡異常，請您檢查網絡設置","您已被群管理员移出群聊":"您已被群管理員移出群聊","该群聊已被解散":"該群聊已被解散","您已退出该群聊":"您已退出該群聊"},TUIGroup:{"输入groupID搜索":"輸入groupID搜索","群名称":"群名稱","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","群类型":"群類型","请填写验证信息":"請填寫驗證信息","申请加入":"申請加入","已申请":"已申請","群公告":"群公告","群成员":"群成員","群管理":"群管理","好友工作群":"好友工作群","陌生人社交群":"陌生人社交群","临时会议群":"臨時會議群","直播群":"直播群","社群":"社群","自由加入":"自由加入","需要验证":"需要驗證","禁止加群":"禁止加群","人":"人","群头像":"群頭像","加群方式":"加群方式","转让群组":"轉讓群組","退出群组":"退出群組","群管理员":"群管理員","全员禁言":"全員禁言","全员禁言开启后，只允许群主和管理员发言。":"全員禁言開啟後，只允許群主和管理員發言。","单独禁言人员":"單獨禁言人員","删除成员":"刪除成員","确定从群聊中删除该成员？":"確定從群聊中刪除該成員？","确定从群聊中删除所选成员？":"確定從群聊中刪除所選成員？","暂无公告":"暫無公告","发布":"發布","编辑":"編輯","查看更多":"查看更多","管理员":"管理員","群主":"群主","我":"我","确认":"確認","添加成员":"添加成員","新增管理员":"新增管理員","移除管理员":"移除管理員","新增禁言用户":"新增禁言用戶","移除禁言用户":"移除禁言用戶","修改群聊名称":"修改群聊名稱","修改群聊名称后，将在群内通知其他成员":"修改群聊名稱後，將在群內通知其他成員","仅限中文、字母、数字和下划线，2-20个字":"僅限中文、字母、數字和下劃線，2-20個字","请先注册 TUIGroup 模块":"請先註冊 TUIGroup 模塊","该用户不存在":"該用戶不存在","该用户不在群组内":"該用戶不在群組內","添加群聊":"添加群聊","该群组不存在":"該群組不存在","创建群聊，请注册 TUIGroup 模块":"創建群聊，請註冊 TUIGroup 模塊","创建成功":"創建成功","发起多人会话（群聊）":"發起多人會話（群聊）","选填":"選填","取消":"取消","创建":"創建","类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主审批。详见":"類似普通微信群，創建後僅支持已在群內的好友邀請加群，且無需被邀請方同意或群主審批。詳見","类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见":"類似 QQ 群，創建後群主可以指定群管理員，用戶搜索群 ID 發起加群申請後，需要群主或管理員審批通過才能入群。詳見","创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见":"創建後可以隨意進出，且支持查看入群前消息；適合用於音視頻會議場景、在線教育場景等與實時音視頻產品結合的場景。詳見","创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见":"創建後可以隨意進出，沒有群成員數量上限，但不支持歷史消息存儲；適合與直播產品結合，用於彈幕聊天場景。詳見","创建后可以随意进出，最多支持100000人，支持历史消息存储，用户搜索群 ID 发起加群申请后，无需管理员审批即可进群。详见":"創建後可以隨意進出，最多支持100000人，支持歷史消息存儲，用戶搜索群 ID 發起加群申請後，無需管理員審批即可進群。詳見","产品文档":"產品文檔","设置群名称":"設置群名稱","请输入群名称":"請輸入群名稱","设置群ID":"設置群ID","请输入群ID":"請輸入群ID","选择群类型":"選擇群類型","陌生人社交群（Public）":"陌生人社交群（Public）","临时会议群（Meeting）":"臨時會議群（Meeting）","好友工作群（Work）":"好友工作群（Work）","直播群（AVChatroom）":"直播群（AVChatroom）","社群（Community）":"社群（Community）","群组创建成功":"群組創建成功","群组解散成功":"群組解散成功","禁言设置成功":"禁言設置成功","取消禁言成功":"取消禁言成功","群名称不能为空":"群名稱不能為空","群名称修改成功":"群名稱修改成功","群公告字数超出限制，最大长度为150":"群公告字數超出限制，最大長度為150"},TUIContact:{"群聊通知":"群聊通知","系统通知":"系統通知","我的群聊":"我的群聊","输入ID":"請輸入用戶/群聊 ID，回車搜索","群名称":"群名稱","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","进入群聊":"進入群聊","群类型":"群類型","请填写验证信息":"請填寫驗證信息","申请加入":"申請加入","已申请":"已申請","接受":"接受","拒绝":"拒絕","已处理":"已處理","添加群聊":"添加群聊","已加入":"已加入","该群组不存在":"該群組不存在","加群":"加群","我的好友":"我的好友","发送消息":"發送消息","个性签名":"個性簽名","等待管理员同意":"申請成功，等待管理員同意入群申請","加群成功":"加群成功","您已是群成员":"您已是群成員","新的联系人":"新的聯繫人","黑名单":"黑名單","无搜索结果":"無搜索結果","客服号":"客服號",ID:"ID","联系人":"聯繫人","群聊":"群聊","添加好友/群聊":"添加好友/群聊","备注名":"備註名","加入黑名单":"加入黑名單","删除好友":"刪除好友","等待验证":"等待驗證","验证信息":"驗證信息","发送申请":"發送申請","加入直播群":"加入直播群","同意":"同意","删除好友成功":"刪除好友成功","删除好友失败":"刪除好友失敗","申请已发送":"申請已發送","申请发送失败":"申請發送失敗","进入会话失败":"進入會話失敗","添加好友成功":"添加好友成功","同意好友申请失败":"同意好友申請失敗","拒绝成功":"拒絕成功","拒绝好友申请失败":"拒絕好友申請失敗","解散群聊成功":"解散群聊成功","解散群聊失败":"解散群聊失敗","退出群组成功":"退出群組成功","退出群组失败":"退出群組失敗","申请入群失败":"申請入群失敗","加入黑名单失败":"加入黑名單失敗","移除黑名单失败":"移除黑名單失敗","修改备注失败: 备注长度不得超过 96 字节":"修改備註失敗: 備註長度不得超過 96 字節","修改备注成功":"修改備註成功","修改备注失败":"修改備註失敗"},message:{tip:{"群成员":"群成員","加入群组":"加入群組","退出群组":"退出群組","被":"被","踢出群组":"踢出群組","成为管理员":"成為管理員","被撤销管理员":"被撤銷管理員","被禁言":"被禁言","被取消禁言":"被取消禁言","群提示消息":"群提示消息","管理员":"管理員","开启全员禁言":"開啟全員禁言","取消全员禁言":"取消全員禁言","成为新的群主":"成為新的群主","修改群名为":"修改群名為","发布新公告":"發布新公告","把群公告修改为":"把群公告修改為","申请加入群组":"申請加入群組","成功加入群组":"成功加入群組","被拒绝":"被拒絕","你被管理员":"你被管理員","群":"群","解散":"解散","创建群":"創建群","邀请你加群":"邀請你加群","你退出群组":"你退出群組","你被":"你被","设置为群":"設置為群","的管理员":"的管理員","撤销群":"撤銷群","的管理员身份":"的管理員身份","同意加群":"同意加群","拒接加群":"拒接加群","自定义群系统通知":"自定義群系統通知"},custom:{"自定义消息":"自定義消息","通话时长":"通話時長","通话结束":"通話結束","切换语音通话":"切換語音通話","切换视频通话":"切換視頻通話","发起通话":"發起通話","取消通话":"取消通話","已接听":"已接聽","拒绝通话":"拒絕通話","无应答":"無應答","对本次服务评价":"對本次服務評價","查看详情>>":"查看詳情>>","已取消":"已取消","对方已取消":"對方已取消","已拒绝":"已拒絕","对方已拒绝":"對方已拒絕","对方忙线中":"對方忙線中","忙线未接听":"忙線未接聽","对方无应答":"對方無應答","超时无应答":"超時無應答"}},component:{"取消":"取消","完成":"完成","已选中":"已選中","人":"人","保存":"保存","请输入userID":"請輸入userID","请输入groupID":"請輸入groupID","确定":"確定","全选":"全選","已在群聊中":"已在群聊中","查看更多":"查看更多","图片 url 不存在":"圖片 url 不存在","已取消":"已取消","获取权限失败":"獲取權限失敗","已保存至相册":"已保存至相冊","图片下载失败":"圖片下載失敗","暂不支持下载此类型图片":"暫不支持下載此類型圖片"},time:{"周":"週","天":"天","小时":"小時","分钟":"分鐘","刚刚":"剛剛","前":"前","昨天":"昨天","星期一":"星期一","星期二":"星期二","星期三":"星期三","星期四":"星期四","星期五":"星期五","星期六":"星期六","星期日":"星期日","一月":"一月","二月":"二月","三月":"三月","四月":"四月","五月":"五月","六月":"六月","七月":"七月","八月":"八月","九月":"九月","十月":"十月","十一月":"十一月","十二月":"十二月","一":"一","二":"二","三":"三","四":"四","五":"五","六":"六","日":"日"},Evaluate:{"请对本次服务进行评价":"請對本次服務進行評價","提交评价":"提交評價","服务评价工具":"服務評價工具","使用":"使用","自定义消息":"自定義消息","搭建":"搭建","星":"星"},Words:{"常用语-快捷回复工具":"常用語-快捷回覆工具","在吗？在吗？在吗？重要的话说三遍。":"在嗎？在嗎？在嗎？重要的話說三遍。","好久没聊天了，快来和我说说话～":"好久沒聊天了，快來和我說說話～","好的，就这么说定了。":"好的，就這麼說定了。","感恩的心，感谢有你。":"感恩的心，感謝有你。","糟糕！是心动的感觉！":"糟糕！是心動的感覺！","心疼地抱抱自己，我太难了！":"心疼地抱抱自己，我太難了！","没关系，别在意，事情过去就过去了。":"沒關係，別在意，事情過去就過去了。","早上好，今天也是让人期待的一天呢！":"早上好，今天也是讓人期待的一天呢！","熬夜有什么用，又没人陪你聊天，早点休息吧。":"熬夜有什麼用，又沒人陪你聊天，早點休息吧。"},TUISearch:{"搜索":"搜索","全部":"全部","联系人":"聯繫人","群聊":"群聊","聊天记录":"聊天記錄","文本":"文本","文件":"文件","图片/视频":"圖片/視頻","其他":"其他","选择时间":"選擇時間","今天":"今天","近三天":"近三天","近七天":"近七天","查看更多":"查看更多","条相关":"條相關","条与":"條與","相关的":"相關的","进入聊天":"進入聊天","定位到聊天位置":"定位到聊天位置","搜索会话内容":"搜索會話內容","查看更多历史记录":"查看更多歷史記錄","暂无搜索结果":"暫無搜索結果","结果":"結果","取消":"取消","[文本]":"[文本]","[图片]":"[圖片]","[语音]":"[語音]","[视频]":"[視頻]","[文件]":"[文件]","[自定义消息]":"[自定義消息]","[系统消息]":"[系統消息]","[合并消息]":"[合併消息]","[位置消息]":"[位置消息]","消息云端搜索失败：":"消息雲端搜索失敗：","查找联系人失败：":"查找聯繫人失敗：","查找群聊失败：":"查找群聊失敗：","进入会话失败":"進入會話失敗"},Emoji:{"[TUIEmoji_Smile]":"[微笑]","[TUIEmoji_Expect]":"[期待]","[TUIEmoji_Blink]":"[眨眼]","[TUIEmoji_Guffaw]":"[大笑]","[TUIEmoji_KindSmile]":"[姨母笑]","[TUIEmoji_Haha]":"[哈哈哈]","[TUIEmoji_Cheerful]":"[愉快]","[TUIEmoji_Speechless]":"[無語]","[TUIEmoji_Amazed]":"[驚訝]","[TUIEmoji_Sorrow]":"[悲傷]","[TUIEmoji_Complacent]":"[得意]","[TUIEmoji_Silly]":"[傻了]","[TUIEmoji_Lustful]":"[色]","[TUIEmoji_Giggle]":"[憨笑]","[TUIEmoji_Kiss]":"[親親]","[TUIEmoji_Wail]":"[大哭]","[TUIEmoji_TearsLaugh]":"[哭笑]","[TUIEmoji_Trapped]":"[困]","[TUIEmoji_Mask]":"[口罩]","[TUIEmoji_Fear]":"[恐懼]","[TUIEmoji_BareTeeth]":"[齜牙]","[TUIEmoji_FlareUp]":"[發怒]","[TUIEmoji_Yawn]":"[打哈欠]","[TUIEmoji_Tact]":"[機智]","[TUIEmoji_Stareyes]":"[星星眼]","[TUIEmoji_ShutUp]":"[閉嘴]","[TUIEmoji_Sigh]":"[嘆氣]","[TUIEmoji_Hehe]":"[呵呵]","[TUIEmoji_Silent]":"[收聲]","[TUIEmoji_Surprised]":"[驚喜]","[TUIEmoji_Askance]":"[白眼]","[TUIEmoji_Ok]":"[OK]","[TUIEmoji_Shit]":"[便便]","[TUIEmoji_Monster]":"[怪獸]","[TUIEmoji_Daemon]":"[惡魔]","[TUIEmoji_Rage]":"[惡魔怒]","[TUIEmoji_Fool]":"[衰]","[TUIEmoji_Pig]":"[豬]","[TUIEmoji_Cow]":"[牛]","[TUIEmoji_Ai]":"[AI]","[TUIEmoji_Skull]":"[骷髏]","[TUIEmoji_Bombs]":"[炸彈]","[TUIEmoji_Coffee]":"[咖啡]","[TUIEmoji_Cake]":"[蛋糕]","[TUIEmoji_Beer]":"[啤酒]","[TUIEmoji_Flower]":"[花]","[TUIEmoji_Watermelon]":"[瓜]","[TUIEmoji_Rich]":"[壕]","[TUIEmoji_Heart]":"[愛心]","[TUIEmoji_Moon]":"[月亮]","[TUIEmoji_Sun]":"[太陽]","[TUIEmoji_Star]":"[星星]","[TUIEmoji_RedPacket]":"[紅包]","[TUIEmoji_Celebrate]":"[慶祝]","[TUIEmoji_Bless]":"[福]","[TUIEmoji_Fortune]":"[發]","[TUIEmoji_Convinced]":"[服]","[TUIEmoji_Prohibit]":"[禁]","[TUIEmoji_666]":"[666]","[TUIEmoji_857]":"[857]","[TUIEmoji_Knife]":"[刀]","[TUIEmoji_Like]":"[讚]"}}}};new class{constructor(){this.currentConversationID="",this.currentMessageList=[],Wr.registerService(Ar.TUIChat.SERVICE.NAME,this),Wr.registerEvent(Ar.TUITheme.EVENT.THEME_CHANGED,Ar.TUITheme.EVENT_SUB_KEY.CHANGE_SUCCESS,this),Wr.registerEvent(Ar.TUIChat.EVENT.CHAT_TYPE_CHANGED,Ar.TUIChat.EVENT_SUB_KEY.CHANGE_SUCCESS,this),kr.watch(oi.CONV,{currentConversationID:e=>{this.currentConversationID=e}})}onCall(e,t,n){let o;switch(e){case Ar.TUIChat.SERVICE.METHOD.UPDATE_MESSAGE_LIST:o=t.message,(null==o?void 0:o.conversationID)===this.currentConversationID&&Dr.updateMessageList([o],"push");break;case Ar.TUIChat.SERVICE.METHOD.SEND_CUSTOM_MESSAGE:Dr.sendCustomMessage(t).then((e=>{n&&n(e)}));break;case Ar.TUIChat.SERVICE.METHOD.SEND_TEXT_MESSAGE:Dr.sendTextMessage(t).then((e=>{n&&n(e)}));break;case Ar.TUIChat.SERVICE.METHOD.SET_CHAT_TYPE:Uh.setChatType(null==t?void 0:t.chatType);break;case Ar.TUIChat.SERVICE.METHOD.CLOSE_MESSAGE_POP_MENU:kr.update(oi.CUSTOM,"isShowMessagePopMenu",!1);break;case Ar.TUIChat.SERVICE.METHOD.UPDATE_MESSAGE_INFO:Dr.updateMessageInfo(null==t?void 0:t.userInfo)}}onNotifyEvent(e,t,n){if(e===Ar.TUITheme.EVENT.THEME_CHANGED&&t===Ar.TUITheme.EVENT_SUB_KEY.CHANGE_SUCCESS)(null==n?void 0:n.theme)&&Uh.setTheme(n.theme.toLowerCase());if(e===Ar.TUIChat.EVENT.CHAT_TYPE_CHANGED&&t===Ar.TUIChat.EVENT_SUB_KEY.CHANGE_SUCCESS)(null==n?void 0:n.chatType)&&Uh.setChatType(null==n?void 0:n.chatType)}};class Vm{constructor(){this.hideConversationHeader=()=>{kr.update(oi.CUSTOM,"isShowConversationHeader",!1)},Wr.registerService(Ar.TUIConversation.SERVICE.NAME,this),Wr.registerExtension(Ar.TUISearch.EXTENSION.SEARCH_MORE.EXT_ID,this),this.onCallParamsMap=new Map,this.onCallCallbackMap=new Map,this.constants=Ar}static getInstance(){return Vm.instance||(Vm.instance=new Vm),Vm.instance}getOnCallParams(e){return this.onCallParamsMap.get(e)}getOnCallCallback(e){return this.onCallCallbackMap.get(e)}onCall(e,t,n){switch(this.onCallParamsMap.set(e,t),this.onCallCallbackMap.set(e,n),e){case Ar.TUIConversation.SERVICE.METHOD.CREATE_CONVERSATION:this.createConversation(t);break;case Ar.TUIConversation.SERVICE.METHOD.HIDE_CONVERSATION_HEADER:this.hideConversationHeader()}}onGetExtension(e){if(e===Ar.TUISearch.EXTENSION.SEARCH_MORE.EXT_ID){return[{weight:100,icon:qd,text:Tr.t("TUIConversation.发起单聊"),data:{name:ju},listener:{onClicked:this.createConversation.bind(this)}},{weight:100,icon:Hd,text:Tr.t("TUIConversation.发起群聊"),data:{name:qu},listener:{onClicked:this.createConversation.bind(this)}}]}}createConversation(e){Wr.callService({serviceName:Ar.TUIContact.SERVICE.NAME,method:Ar.TUIContact.SERVICE.METHOD.SELECT_FRIEND,params:{title:e.text,isRadio:e.data.name!==qu,isNeedSearch:!kr.getData(oi.APP,"isOfficial")},callback:async t=>{if(!t||0===t.length)return this.routerForward(null);if(e.data.name===qu)this.createGroup(t);else{const{userID:e}=t[0];await this.generateConversation(`C2C${e}`),this.routerForward(`C2C${e}`)}}})}createGroup(e){Wr.callService({serviceName:Ar.TUIGroup.SERVICE.NAME,method:Ar.TUIGroup.SERVICE.METHOD.CREATE_GROUP,params:{title:Tr.t("TUIConversation.发起群聊"),memberList:e},callback:async e=>{let t=null;if(e){const{groupID:n}=e;await this.generateConversation(`GROUP${n}`),t=`GROUP${n}`}this.routerForward(t)}})}async routerForward(e){lu&&(await(null==Fl?void 0:Fl.reLaunch({url:"/TUIKit/components/TUIConversation/index"})),e&&(null==Fl||Fl.navigateTo({url:"/TUIKit/components/TUIChat/index"})))}generateConversation(e){Mr.switchConversation(e).then((()=>{e.startsWith("GROUP")&&Nd("groupChat"),I("warn","at TUIKit/components/TUIConversation/server.ts:153","打开会话成功")})).catch((e=>{I("warn","at TUIKit/components/TUIConversation/server.ts:156","打开会话失败",e.code,e.msg)}))}}new Vm;new class{constructor(){Wr.registerService(Ar.TUISearch.SERVICE.NAME,this),Wr.registerExtension(Ar.TUIChat.EXTENSION.INPUT_MORE.EXT_ID,this)}onCall(e,t){switch(e){case Ar.TUISearch.SERVICE.METHOD.SEARCH_GROUP:return this.searchGroup(null==t?void 0:t.groupID);case Ar.TUISearch.SERVICE.METHOD.SEARCH_USER:return this.searchUser(null==t?void 0:t.userID);case Ar.TUISearch.SERVICE.METHOD.SEARCH_FRIEND:return this.searchFriend(null==t?void 0:t.userID);case Ar.TUISearch.SERVICE.METHOD.SEARCH_GROUP_MEMBER:return this.searchGroupMember(null==t?void 0:t.groupID,null==t?void 0:t.userID)}}onGetExtension(e){if(e===Ar.TUIChat.EXTENSION.INPUT_MORE.EXT_ID){const e=[],t={weight:3e3,text:"搜索",icon:"https://web.sdk.qcloud.com/component/TUIKit/assets/message-search.svg",data:{name:"search"},listener:{onClicked:()=>{kr.update(oi.SEARCH,"isShowInConversationSearch",!0),lu&&(null==Fl||Fl.navigateTo({url:"/TUIKit/components/TUISearch/index"}))}}};return e.push(t),e}}async searchFriend(e){return wr.getFriendProfile({userIDList:[e]})}async searchUser(e){return Sr.getUserProfile({userIDList:[e]})}async searchGroup(e){return br.searchGroupByID(e)}async searchGroupMember(e,t){return br.getGroupMemberProfile({groupID:e,userIDList:[t]})}},ip.getInstance(),ym.getInstance();const Fm=new class e{constructor(){this.TUIComponents={},this.TUIPlugins={},this.TUICore=Wr,this.TUIChatEngine=Cr,this.TUIGlobal=Fl,this.SDKAppID=0,this.TUIGlobal._isTIMCallKit=!0,Wr.registerEvent(Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED,Ar.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS,this),Wr.registerEvent(Ar.TUITranslate.EVENT.LANGUAGE_CHANGED,Ar.TUITranslate.EVENT_SUB_KEY.CHANGE_SUCCESS,this),Wr.registerService(Ar.TUITranslatePlugin.SERVICE.NAME,1),Wr.registerService(Ar.TUIVoiceToTextPlugin.SERVICE.NAME,1)}onNotifyEvent(e,t,n){if(e===Ar.TUILogin.EVENT.LOGIN_STATE_CHANGED&&t===Ar.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS)this.login();if(e===Ar.TUITranslate.EVENT.LANGUAGE_CHANGED&&t===Ar.TUITranslate.EVENT_SUB_KEY.CHANGE_SUCCESS)(null==n?void 0:n.language)&&Tr.changeLanguage(n.language)}init(){e.isInitialized||(e.isInitialized=!0,cu&&new xm,Tr.provideLanguages({...Bm}),Tr.useI18n(),Fl.TUIComponents=this.TUIComponents,Fl.TUIPlugins=this.TUIPlugins,I("warn","at TUIKit/server.ts:79","[TUIChatKit]: init success."))}login(){const{chat:e,SDKAppID:t,userID:n,userSig:o}=Jr.getContext();return this.SDKAppID=t,this.TUIChatEngine.login({chat:e,SDKAppID:t,userID:n,userSig:o}),this.chat=e,this.TUIChatEngine}component(e,t,n){var o,a;return(null==(o=null==this?void 0:this.TUIComponents)?void 0:o.componentName)?I("warn","at TUIKit/server.ts:108",`[TUIChatKit]: ${null==(a=null==this?void 0:this.TUIComponents)?void 0:a.componentName} component has already been applied to target TUIChatEngine.`):(this.TUIComponents[e]=t,null==n||n.component(e,t)),n&&!Fl.Vue&&(Fl.Vue=n),this.TUIChatEngine}components(e,t){var n,o;return e&&(null!==(o=e)&&"object"==typeof o)?null==(n=null==Object?void 0:Object.keys(e))||n.forEach((n=>{this.component(n,e[n],t)})):I("warn","at TUIKit/server.ts:130","[TUIChatKit]: components is empty or not object."),this.TUIChatEngine}use(e,t,n){if(this.TUICore)return this.TUIPlugins[e]?I("warn","at TUIKit/server.ts:154",`[TUIChatKit]: Plugin ${this.TUIPlugins[e]} has already been applied to target TUIChatEngine.`):t&&rd(null==t?void 0:t.plugin)?(this.TUIPlugins[e]=t,null==t||t.plugin(this,n)):rd(t)?(this.TUIPlugins[e]=t,t(this,n)):I("warn","at TUIKit/server.ts:164",'[TUIChatKit]: A plugin must either be a function or an object with an "plugin" function.'+this.TUIPlugins[e]+"does not comply with the above rules."),this.TUIChatEngine;I("warn","at TUIKit/server.ts:148",`[TUIChatKit]: Plugin ${this.TUIPlugins[e]} can't be used before init.`)}};Fm.init();const Hm={...{en:{"当前语言":"English","即时通信":"Chat","即时通信IM":"Chat","社交娱乐":"Entertaining & Socializing","腾讯云":"Tencent Cloud","使用指引":"User Guide",Login:{"登录":"log in","登录当前账号":"Log in with current account","切换其他账号":"Switch accounts","我已阅读并同意":"I have read and agree to","和":"and","隐私条例":"Privacy Policy","用户协议":"User Agreement","免费体验":"Free trial","体验更多Demo":"More demos","访问官网":"Official website","超10亿用户的信赖":"1+ billion users trust Tencent Cloud Instant Messenger","一分钟":"1 Minute","改2行代码，1分钟跑通demo":"Quick demo run in 1 minute with changing only 2 lines of code required","每月服务客户数超过10000家":"Over 10,000 customers per month","消息收发成功率":"Success rate of message sending & receiving and service reliability higher than 99.99%","10亿":"1 billion","每月活跃用户数超过10亿":"Over 1 billion active users per month","请输入手机号":"Enter a mobile number","请输入userID":"Please enter your userID","请输入验证码":"Enter the verification code","请输入正确的手机号":"Enter a valid mobile number","请先勾选用户协议":"Agree to the User Agreement first","获取验证码":"Send verification code","登录失败":"Login failed","登录过期":"Login expired","操作失败":"failed","验证码发送成功":"Verification code sent successfully","发送验证码失败":"Failed to send the verification code",Android:"Android",iOS:"iOS","小程序":"WeChat Mini Program",Windows:"Windows","Mac OS":"Mac OS","扫描二维码下载":"Applet scanning QR code download","微信扫码进入":" WeChat scanning QR code to enter","点击直接下载":"Click to download directly","更多客户端体验":"More client experiences","微信扫一扫，免费体验腾讯云 IM 小程序":"Scan the QR code on WeChat to experience the Tencent Cloud Chat mini program for free","或者截图至相册，切换微信扫一扫识别体验":"Or take a screenshot to the photo album to switch the wechat scanning recognition experience"}}},...{zh_cn:{"当前语言":"简体中文","即时通信":"即时通信","即时通信IM":"即时通信IM","社交娱乐":"社交娱乐","腾讯云":"腾讯云","使用指引":"使用指引",Login:{"登录":"登录","登录当前账号":"登录当前账号","切换其他账号":"切换其他账号","我已阅读并同意":"我已阅读并同意","和":"和","隐私条例":"隐私条例","用户协议":"用户协议","免费体验":"免费体验","体验更多Demo":"体验更多Demo","访问官网":"访问官网","超10亿用户的信赖":"超10亿用户的信赖","一分钟":"一分钟","改2行代码，1分钟跑通demo":"改2行代码，1分钟跑通demo","每月服务客户数超过10000家":"每月服务客户数超过10000家","消息收发成功率":"消息收发成功率，服务可靠性高于99.99%","10亿":"10亿","每月活跃用户数超过10亿":"每月活跃用户数超过10亿","请输入手机号":"请输入手机号","请输入userID":"请输入userID","请输入正确的手机号":"请输入正确的手机号","请先勾选用户协议":"请先勾选用户协议","请输入验证码":"请输入验证码","获取验证码":"获取验证码","登录失败":"登录失败","登录过期":"登录过期","操作失败":"操作失败","验证码发送成功":"验证码发送成功","发送验证码失败":"验证码发送失败",Android:"Android",iOS:"iOS","小程序":"小程序",Windows:"Windows","Mac OS":"Mac OS","扫描二维码下载":"扫描二维码下载","微信扫码进入":"微信扫码进入","点击直接下载":"点击直接下载","更多客户端体验":"更多客户端体验","微信扫一扫，免费体验腾讯云 IM 小程序":"微信扫一扫，免费体验腾讯云 IM 小程序","或者截图至相册，切换微信扫一扫识别体验":"或者截图至相册，切换微信扫一扫识别体验"}}},...{zh_tw:{"当前语言":"繁體中文","即时通信":"即時通信","即时通信IM":"即時通信IM","社交娱乐":"社交娛樂","腾讯云":"騰訊雲","使用指引":"使用指引",Login:{"登录":"登錄","登录当前账号":"登錄當前賬號","切换其他账号":"切換其他賬號","我已阅读并同意":"我已閱讀並同意","和":"和","隐私条例":"隱私條例","用户协议":"用戶協議","免费体验":"免費體驗","体验更多Demo":"體驗更多Demo","访问官网":"訪問官網","超10亿用户的信赖":"超10億用戶的信賴","一分钟":"一分鐘","改2行代码，1分钟跑通demo":"改2行代碼，1分鐘跑通demo","每月服务客户数超过10000家":"每月服務客戶數超過10000家","消息收发成功率":"消息收發成功率，服務可靠性高於99.99%","10亿":"10億","每月活跃用户数超过10亿":"每月活躍用戶數超過10億","请输入手机号":"請輸入手機號","请输入userID":"請輸入userID","请输入正确的手机号":"請輸入正確的手機號","请先勾选用户协议":"請先勾選用戶協議","请输入验证码":"請輸入驗證碼","获取验证码":"獲取驗證碼","登录失败":"登錄失敗","登录过期":"登錄過期","操作失败":"操作失敗","验证码发送成功":"驗證碼發送成功","发送验证码失败":"驗證碼發送失敗",Android:"Android",iOS:"iOS","小程序":"小程序",Windows:"Windows","Mac OS":"Mac OS","扫描二维码下载":"掃描二維碼下載","微信扫码进入":"微信掃碼進入","点击直接下载":"點擊直接下載","更多客户端体验":"更多客戶端體驗","微信扫一扫，免费体验腾讯云 IM 小程序":"微信掃一掃，免費體驗騰訊雲 IM 小程序","或者截图至相册，切换微信扫一扫识别体验":"或者截圖至相冊，切換微信掃一掃識別體驗"}}}},jm={};new Set([...Object.keys(Hm),...Object.keys(Bm)]).forEach((e=>{jm[e]={...Hm[e]||{},...Bm[e]||{}}}));const qm=()=>{const e=uni.getSystemInfoSync().platform;"ios"===e?(()=>{const e=plus.ios.import("UIApplication").sharedApplication();if(e.currentUserNotificationSettings){const t=e.currentUserNotificationSettings(),n=null==t?void 0:t.plusGetAttribute("types");I("log","at utils/getNotificationAuth.js:35","enabledTypes:"+n),0===n&&uni.showModal({title:"推送需要通知栏权限",content:"是否开启通知栏权限?",success:e=>{e.confirm?Km():e.cancel&&I("log","at utils/getNotificationAuth.js:44","用户点击取消")}}),plus.ios.deleteObject(t)}})():"android"===e&&(()=>{const e=plus.android.runtimeMainActivity();let t=plus.android.importClass("android.support.v4.app.NotificationManagerCompat");t||(t=plus.android.importClass("androidx.core.app.NotificationManagerCompat")),t.from(e).areNotificationsEnabled()||uni.showModal({title:"推送需要通知栏权限",content:"是否开启通知栏权限?",success:e=>{e.confirm?zm():e.cancel&&I("warn","at utils/getNotificationAuth.js:22","用户点击取消")}})})()},zm=()=>{const e=plus.android.runtimeMainActivity(),t=e.getPackageName(),n=e.getApplicationInfo().plusGetAttribute("uid"),o=plus.android.importClass("android.content.Intent"),a=plus.android.importClass("android.os.Build"),i=new o("android.settings.APP_NOTIFICATION_SETTINGS");if(a.VERSION.SDK_INT>=26)i.putExtra("android.provider.extra.APP_PACKAGE",t);else if(a.VERSION.SDK_INT>=21)i.putExtra("app_package",t),i.putExtra("app_uid",n);else{i.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);const e=Uri.fromParts("package",mainActivity.getPackageName(),null);i.setData(e)}e.startActivity(i)},Km=()=>{const e=plus.ios.import("UIApplication"),t=e.sharedApplication().currentUserNotificationSettings(),n=plus.ios.import("NSURL"),o=n.URLWithString("app-settings:"),a=e.sharedApplication();a.openURL(o),plus.ios.deleteObject(o),plus.ios.deleteObject(n),plus.ios.deleteObject(a),plus.ios.deleteObject(t)},$m=y("TencentCloud-TIMPush");I("warn","at App.vue:16","TencentCloud-TIMPush: uni.requireNativePlugin "+($m?"success":"fail")),uni.$TIMPush=$m,uni.$TIMPushConfigs={};const Ym={isLoginChat:!1,conversationID:""},Wm=y("TencentCloud-TUICallKit");I("warn","at App.vue:30","TencentCloud-TUICallKit: uni.requireNativePlugin "+(Wm?"success":"fail")),uni.$TUICallKit=Wm,Tr.provideLanguages(jm),Tr.useI18n(),Fm.init();uni.$chat_SDKAppID=1600059782,uni.$chat_secretKey="de59c03814fa68ec61476566140ae06fdcd9f17fe05bcb33e5162571924e6246";const Jm=L({globalData:{windowHeight:0,windowWidth:0,screenHeight:0,safeArea:0,top:0,safeAreaBottom:0,statusBarHeight:0,pageHeight:0,tabBarHeight:0,token:"",platform:""},onLaunch:function(){uni.onTabBarMidButtonTap((()=>{uni.navigateTo({url:"/pages/release/release"})})),this.getAreaSize(),void 0===uni.$TIMPush?I("warn","at App.vue:92","如果您使用推送功能，需集成 TIMPush 插件，使用真机运行并且自定义基座调试，请参考官网文档：https://cloud.tencent.com/document/product/269/103522"):(qm(),uni.$on("uikitLogin",(()=>{Ym.isLoginChat=!0,Zr(Ym)})),uni.$TIMPush.setOfflinePushListener((e=>{const{notification:t=""}=(null==e?void 0:e.data)||{};if(!t)return;const{entity:n}=JSON.parse(t);I("log","at App.vue:107","推送消息:",111111);const o=1===n.chatType?Cr.TYPES.CONV_C2C:Cr.TYPES.CONV_GROUP;Ym.conversationID=`${o}${n.sender}`,Ym.isLoginChat&&n.sender&&Zr(Ym)})),null==uni||uni.getStorage({key:"userInfo",success:function(e){if(e.data){const t={...JSON.parse(e.data)};(null==uni?void 0:uni.$TIMPush)&&(t.TIMPush=null==uni?void 0:uni.$TIMPush,t.pushConfig={androidConfig:null==uni?void 0:uni.$TIMPushConfigs,iOSConfig:{iOSBusinessID:"29064"}}),Xr(t).catch((()=>{null==uni||uni.removeStorage({key:"userInfo"})}))}}}))},onShow:function(){setTimeout((()=>{plus.navigator.closeSplashscreen()}),2e3)},onHide:function(){},methods:{getAreaSize(){var e=uni.getSystemInfoSync();I("log","at App.vue:137","设备信息",e),this.globalData.platform=e.platform,I("log","at App.vue:139","手机设备",this.globalData.model),this.globalData.windowHeight=e.windowHeight,this.globalData.windowWidth=e.windowWidth,this.globalData.screenHeight=e.screenHeight,this.globalData.safeArea=e.safeArea,this.globalData.top=e.safeArea.top,I("log","at App.vue:150","safeAreaTop",this.globalData.top),this.globalData.safeAreaBottom=e.screenHeight-e.safeArea.bottom,this.globalData.tabBarHeight=e.screenHeight-e.windowWidth-e.statusBarHeight,this.globalData.statusBarHeight=e.statusBarHeight,this.globalData.pageHeight=this.globalData.windowHeight,this.globalData.platform=e.platform}}},[["__scopeId","data-v-523f25d1"]]);function Xm(e,t){var n;return e="object"==typeof(n=e)&&null!==n?e:Object.create(null),new Proxy(e,{get:(e,n,o)=>"key"===n?Reflect.get(e,n,o):Reflect.get(e,n,o)||Reflect.get(t,n,o)})}function Zm(e,{storage:t,serializer:n,key:o,debug:a}){try{const a=null==t?void 0:t.getItem(o);a&&e.$patch(null==n?void 0:n.deserialize(a))}catch(rn){a&&I("error","at uni_modules/pinia-plugin-unistorage/index.js:77","[pinia-plugin-persistedstate]",rn)}}function Qm(e,{storage:t,serializer:n,key:o,paths:a,debug:i}){try{const i=Array.isArray(a)?function(e,t){return t.reduce(((t,n)=>{const o=n.split(".");return function(e,t,n){return t.slice(0,-1).reduce(((e,t)=>/^(__proto__)$/.test(t)?{}:e[t]=e[t]||{}),e)[t[t.length-1]]=n,e}(t,o,function(e,t){return t.reduce(((e,t)=>null==e?void 0:e[t]),e)}(e,o))}),{})}(e,a):e;t.setItem(o,n.serialize(i))}catch(rn){i&&I("error","at uni_modules/pinia-plugin-unistorage/index.js:86","[pinia-plugin-persistedstate]",rn)}}function ef(e={}){return t=>{const{auto:n=!1}=e,{options:{persist:o=n},store:a,pinia:i}=t;if(!o)return;if(!(a.$id in i.state.value)){const e=i._s.get(a.$id.replace("__hot:",""));return void(e&&Promise.resolve().then((()=>e.$persist())))}const s=(Array.isArray(o)?o.map((t=>Xm(t,e))):[Xm(o,e)]).map(function(e,t){return n=>{var o;try{const{storage:a=localStorage,beforeRestore:i,afterRestore:s,serializer:r={serialize:JSON.stringify,deserialize:JSON.parse},key:c=t.$id,paths:l=null,debug:u=!1}=n;return{storage:a,beforeRestore:i,afterRestore:s,serializer:r,key:(null!=(o=e.key)?o:e=>e)("string"==typeof c?c:c(t.$id)),paths:l,debug:u}}catch(rn){return n.debug&&I("error","at uni_modules/pinia-plugin-unistorage/index.js:65","[pinia-plugin-persistedstate]",rn),null}}}(e,a)).filter(Boolean);a.$persist=()=>{s.forEach((e=>{Qm(a.$state,e)}))},a.$hydrate=({runHooks:e=!0}={})=>{s.forEach((n=>{const{beforeRestore:o,afterRestore:i}=n;e&&(null==o||o(t)),Zm(a,n),e&&(null==i||i(t))}))},s.forEach((e=>{const{beforeRestore:n,afterRestore:o}=e;null==n||n(t),Zm(a,e),null==o||o(t),a.$subscribe(((t,n)=>{Qm(n,e)}),{detached:!0})}))}}const{app:tf,Vuex:nf,Pinia:of}=function(){const t=e.createVueApp(Jm),n=function(){const t=e.effectScope(!0),n=t.run((()=>e.ref({})));let o=[],a=[];const i=e.markRaw({install(e){O(i),i._a=e,e.provide(U,i),e.config.globalProperties.$pinia=i,a.forEach((e=>o.push(e))),a=[]},use(e){return this._a?o.push(e):a.push(e),this},_p:o,_a:null,_e:t,_s:new Map,state:n});return i}();return n.use(function(e={}){const t=ef({storage:{getItem:e=>uni.getStorageSync(e),setItem(e,t){uni.setStorageSync(e,t)}},serializer:{deserialize:JSON.parse,serialize:JSON.stringify},...e});return e=>(e.options.unistorage&&(e.options.persist=e.options.unistorage),t(e))}()),t.use(n),{app:t}}();uni.Vuex=nf,uni.Pinia=of,tf.provide("__globalStyles",__uniConfig.styles),tf._component.mpType="app",tf._component.render=()=>{},tf.mount("#app")}(Vue);
